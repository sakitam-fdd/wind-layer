(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{668:function(t,i,e){"use strict";e.r(i),e.d(i,"Field",(function(){return v})),e.d(i,"WindLayer",(function(){return M}));e(79),e(80),e(147),e(36),e(144),e(12),e(148),e(149),e(150),e(151),e(39),e(152),e(153),e(154),e(100),e(155),e(78),e(156),e(5),e(145),e(157),e(158),e(159),e(160),e(161),e(162),e(163),e(164),e(165),e(166),e(167),e(168),e(169),e(170),e(171),e(172),e(173),e(174),e(175),e(176),e(177),e(178),e(179),e(180),e(37);var n=e(30),o=function(t,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};
/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * wind-core v1.0.0-alpha.5
 * build-time: 2020-5-19 14:0
 * LICENSE: MIT
 * (c) 2017-2020 https://github.com/sakitam-fdd/wind-layer#readme
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(t,i){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};function s(){for(var t=arguments,i=0,e=0,n=arguments.length;e<n;e++)i+=t[e].length;var o=Array(i),r=0;for(e=0;e<n;e++)for(var s=arguments[e],a=0,h=s.length;a<h;a++,r++)o[r]=s[a];return o}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,i){var e=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),o=1;o<arguments.length;o++){var r=e[o];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=r[s])}return n},writable:!0,configurable:!0});var a=Object.prototype.hasOwnProperty,h="undefined"!=typeof Symbol?Symbol.toStringTag:void 0;function p(t){if(!function(t){var i=Object(n.a)(t);return null!==t&&("object"===i||"function"===i)}(t))return!1;var i=function(t){if(null===t)return void 0===t?"[object Undefined]":"[object Null]";if(!(h&&h in Object(t)))return toString.call(t);var i=a.call(t,h),e=t[h],n=!1;try{t[h]=void 0,n=!0}catch(t){}var o=Object.prototype.toString.call(t);return n&&(i?t[h]=e:delete t[h]),o}(t);return"[object Function]"===i||"[object AsyncFunction]"===i||"[object GeneratorFunction]"===i||"[object Proxy]"===i}function c(t){return"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)}function u(t){for(var i=arguments,e=[],n=1;n<arguments.length;n++)e[n-1]=i[n];return Object.assign.apply(Object,s([t],e))}function l(t){console.warn("wind-layer: "+t)}function d(t){return null!=t&&!isNaN(t)}var f=function(){function t(t,i){this.u=t,this.v=i,this.m=this.magnitude()}return t.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},t.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v)*(180/Math.PI);return t<0&&(t+=360),t},t.prototype.directionFrom=function(){return(this.directionTo()+180)%360},t}(),v=function(){function t(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin),this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.isFields=!0;var i=Math.ceil((this.xmax-this.xmin)/t.deltaX),e=Math.ceil((this.ymax-this.ymin)/t.deltaY);i===this.cols&&e===this.rows||console.warn("The data grid not equal"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.wrappedX="wrappedX"in t?t.wrappedX:this.xmax>180,this.grid=this.buildGrid(),this.range=this.calculateRange()}return t.prototype.buildGrid=function(){for(var t=[],i=0,e=this.rows,n=this.cols,o=this.us,r=this.vs,s=0;s<e;s++){for(var a=[],h=0;h<n;h++,i++){var p=o[i],c=r[i],u=this.isValid(p)&&this.isValid(c);a[h]=u?new f(p,c):null}this.isContinuous&&a.push(a[0]),t[s]=a}return t},t.prototype.release=function(){this.grid=[],this.columns=[]},t.prototype.extent=function(){return[this.xmin,this.ymin,this.xmax,this.ymax]},t.prototype.bilinearInterpolateVector=function(t,i,e,n,o,r){var s=1-t,a=1-i,h=s*a,p=t*a,c=s*i,u=t*i,l=e.u*h+n.u*p+o.u*c+r.u*u,d=e.v*h+n.v*p+o.v*c+r.v*u;return new f(l,d)},t.prototype.calculateRange=function(){if(this.grid&&this.grid[0]){for(var t,i,e=this.grid.length,n=this.grid[0].length,o=0;o<e;o++)for(var r=0;r<n;r++){var s=this.grid[o][r];if(null!==s){var a=s.m||s.magnitude();void 0===t?t=a:void 0===i?(i=a,t=Math.min(t,i),i=Math.max(t,i)):(t=Math.min(a,t),i=Math.max(a,i))}}return[t,i]}},t.prototype.isValid=function(t){return null!=t},t.prototype.getWrappedLongitudes=function(){var t=this.xmin,i=this.xmax;return this.wrappedX&&(this.isContinuous?(t=-180,i=180):(i=this.xmax-360,t=this.xmin-360)),[t,i]},t.prototype.contains=function(t,i){var e=this.getWrappedLongitudes(),n=e[0],o=e[1],r=t>=n&&t<=o,s=i>=this.ymin&&i<=this.ymax;return r&&s},t.prototype.getDecimalIndexes=function(t,i){var e,n;return[((e=t-this.xmin)-(n=360)*Math.floor(e/n))/this.deltaX,(this.ymax-i)/this.deltaY]},t.prototype.valueAt=function(t,i){if(!this.contains(t,i))return null;var e=this.getDecimalIndexes(t,i),n=Math.floor(e[0]),o=Math.floor(e[1]),r=this.clampColumnIndex(n),s=this.clampRowIndex(o);return this.valueAtIndexes(r,s)},t.prototype.interpolatedValueAt=function(t,i){if(!this.contains(t,i))return null;var e=this.getDecimalIndexes(t,i),n=e[0],o=e[1];return this.interpolatePoint(n,o)},t.prototype.hasValueAt=function(t,i){return null!==this.valueAt(t,i)},t.prototype.interpolatePoint=function(t,i){var e=this.getFourSurroundingIndexes(t,i),n=e[0],o=e[1],r=e[2],s=e[3],a=this.getFourSurroundingValues(n,o,r,s);if(a){var h=a[0],p=a[1],c=a[2],u=a[3];return this.bilinearInterpolateVector(t-n,i-r,h,p,c,u)}return null},t.prototype.clampColumnIndex=function(t){var i=t;t<0&&(i=0);var e=this.cols-1;return t>e&&(i=e),i},t.prototype.clampRowIndex=function(t){var i=t;t<0&&(i=0);var e=this.rows-1;return t>e&&(i=e),i},t.prototype.getFourSurroundingIndexes=function(t,i){var e=Math.floor(t),n=e+1;this.isContinuous&&n>=this.cols&&(n=0),n=this.clampColumnIndex(n);var o=this.clampRowIndex(Math.floor(i));return[e,n,o,this.clampRowIndex(o+1)]},t.prototype.getFourSurroundingValues=function(t,i,e,n){var o;if(o=this.grid[e]){var r=o[t],s=o[i];if(this.isValid(r)&&this.isValid(s)&&(o=this.grid[n])){var a=o[t],h=o[i];if(this.isValid(a)&&this.isValid(h))return[r,s,a,h]}}return null},t.prototype.valueAtIndexes=function(t,i){return this.grid[i][t]},t.prototype.lonLatAtIndexes=function(t,i){return[this.longitudeAtX(t),this.latitudeAtY(i)]},t.prototype.longitudeAtX=function(t){var i=this.deltaX/2,e=this.xmin+i+t*this.deltaX;return this.wrappedX&&(e=e>180?e-360:e),e},t.prototype.latitudeAtY=function(t){var i=this.deltaY/2;return this.ymax-i-t*this.deltaY},t.prototype.randomize=function(t,i,e,n){void 0===t&&(t={});var o=Math.random()*(i||this.cols)|0,r=Math.random()*(e||this.rows)|0,s=n([o,r]);return null!==s?(t.x=s[0],t.y=s[1]):(t.x=this.longitudeAtX(o),t.y=this.latitudeAtY(r)),t},t.prototype.checkFields=function(){return this.isFields},t.prototype.startBatchInterpolate=function(t,i,e){},t}();function m(t,i){if(!t)return!1;if(i=i||devicePixelRatio||1,!(t instanceof OffscreenCanvas)){var e=t.clientWidth*i,n=t.clientHeight*i;if(e<=0||n<=0)return!1;if(t.width!==e||t.height!==n)return t.width=e,t.height=n,!0}return!1}function y(t,i,e){var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw t.deleteShader(n),new Error(t.getShaderInfoLog(n)||"");return n}var g="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=arguments,i=0,e=arguments.length;e--;)i+=t[e]*t[e];return Math.sqrt(i)});var x=function(){function t(t,i,e){var n;this.vertShader="",this.fragShader="",i&&(this.vertShader=i),e&&(this.fragShader=e),this.program=function(t,i,e){var n=y(t,t.VERTEX_SHADER,i),o=y(t,t.FRAGMENT_SHADER,e),r=t.createProgram();if(null!==r&&(t.attachShader(r,n),t.attachShader(r,o),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS)))throw new Error(t.getProgramInfoLog(r)||"");return r}(t,this.vertShader,this.fragShader),this.gl=t,this.textureUnit=0,this.uniformSetters=this.createUniformSetters(),this.attribSetters=this.createAttributeSetters(),this.transfromStack=[],this.projection=(n=new g(9),g!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n)}return t.prototype.active=function(){return this.gl.useProgram(this.program),this},t.prototype.deactive=function(){return this.gl.deleteProgram(this.program),this},t.prototype.getBindPointForSamplerType=function(t,i){return i===t.SAMPLER_2D?t.TEXTURE_2D:i===t.SAMPLER_CUBE?t.TEXTURE_CUBE_MAP:void 0},t.prototype.createUniformSetter=function(t,i){var e,n,o=this.gl,r=o.getUniformLocation(t,i.name),s=i.type,a=i.size>1&&"[0]"===i.name.substr(-3);if(s===o.FLOAT&&a)return function(t){o.uniform1fv(r,t)};if(s===o.FLOAT)return function(t){o.uniform1f(r,t)};if(s===o.FLOAT_VEC2)return function(t){o.uniform2fv(r,t)};if(s===o.FLOAT_VEC3)return function(t){o.uniform3fv(r,t)};if(s===o.FLOAT_VEC4)return function(t){o.uniform4fv(r,t)};if(s===o.INT&&a)return function(t){o.uniform1iv(r,t)};if(s===o.INT)return function(t){o.uniform1i(r,t)};if(s===o.INT_VEC2)return function(t){o.uniform2iv(r,t)};if(s===o.INT_VEC3)return function(t){o.uniform3iv(r,t)};if(s===o.INT_VEC4)return function(t){o.uniform4iv(r,t)};if(s===o.BOOL)return function(t){o.uniform1iv(r,t)};if(s===o.BOOL_VEC2)return function(t){o.uniform2iv(r,t)};if(s===o.BOOL_VEC3)return function(t){o.uniform3iv(r,t)};if(s===o.BOOL_VEC4)return function(t){o.uniform4iv(r,t)};if(s===o.FLOAT_MAT2)return function(t){o.uniformMatrix2fv(r,!1,t)};if(s===o.FLOAT_MAT3)return function(t){o.uniformMatrix3fv(r,!1,t)};if(s===o.FLOAT_MAT4)return function(t){o.uniformMatrix4fv(r,!1,t)};if((s===o.SAMPLER_2D||s===o.SAMPLER_CUBE)&&a){for(var h=[],p=0;p<i.size;++p)h.push(this.textureUnit++);return function(t,i){return function(e){o.uniform1iv(r,i),e.forEach((function(e,n){o.activeTexture(o.TEXTURE0+i[n]),void 0!==t&&o.bindTexture(t,e)}))}}(this.getBindPointForSamplerType(o,s),h)}if(s===o.SAMPLER_2D||s===o.SAMPLER_CUBE)return e=this.getBindPointForSamplerType(o,s),n=this.textureUnit++,function(t){o.uniform1i(r,n),o.activeTexture(o.TEXTURE0+n),void 0!==e&&o.bindTexture(e,t)};throw"unknown type: 0x"+s.toString(16)},t.prototype.createUniformSetters=function(){var t=this.gl;this.textureUnit=0;var i={};if(null!==this.program)for(var e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),n=0;n<e;++n){var o=t.getActiveUniform(this.program,n);if(!o)break;var r=o.name;"[0]"===r.substr(-3)&&(r=r.substr(0,r.length-3));var s=this.createUniformSetter(this.program,o);i[r]=s}return i},t.prototype.createAttribSetter=function(t){var i=this.gl;return function(e){i.bindBuffer(i.ARRAY_BUFFER,e.buffer),i.enableVertexAttribArray(t),void 0===e.numComponents&&void 0===e.size||i.vertexAttribPointer(t,e.numComponents||e.size,e.type||i.FLOAT,e.normalize||!1,e.stride||0,e.offset||0)}},t.prototype.createAttributeSetters=function(){var t=this.gl,i={};if(null!==this.program)for(var e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),n=0;n<e;++n){var o=t.getActiveAttrib(this.program,n);if(!o)break;var r=t.getAttribLocation(this.program,o.name);i[o.name]=this.createAttribSetter(r)}return i},t.prototype.setAttributes=function(t,i){return i=i?i.attribSetters||i:this.attribSetters,Object.keys(t).forEach((function(e){var n=i[e];n&&n(t[e])})),this},t.prototype.setUniforms=function(t,i){return i=i?i.uniformSetters||i:this.uniformSetters,Object.keys(t).forEach((function(e){var n=i[e];n&&n(t[e])})),this},t.prototype.clear=function(t){return function(t,i){var e=i[0],n=i[1],o=i[2],r=i[3];t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(e,n,o,r),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST)}(this.gl,t),this.transfromStack=[],this},t.prototype.runTimes=function(t){return this.count=t||0,this},t.prototype.updateProjection=function(){var t=this.gl.canvas,i=t.width,e=t.height;return function(t,i,e){t[0]=2/i,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/e,t[5]=0,t[6]=-1,t[7]=1,t[8]=1}(this.projection,i,e),this},t.prototype.resize=function(t){return m(this.gl.canvas),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),t&&this.updateProjection(),this},t.prototype.draw=function(){throw new Error("should override")},t.prototype.translate=function(){throw new Error("should override")},t.prototype.rotate=function(){throw new Error("should override")},t.prototype.scale=function(){throw new Error("should override")},t}(),w="precision mediump float;\n#define GLSLIFY 1\n\n// 从顶点着色器中传入\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",S="#define GLSLIFY 1\nattribute vec2 a_position;\nattribute vec4 a_color;\n\n//uniform mat4 u_matrix;\nuniform vec2 u_resolution;\nvarying vec4 v_color;\nuniform float u_pointSize;\n\nvoid main() {\n  // convert the rectangle from pixels to 0.0 to 1.0\n  vec2 zeroToOne = a_position / u_resolution;\n\n  // convert from 0->1 to 0->2\n  vec2 zeroToTwo = zeroToOne * 2.0;\n\n  // convert from 0->2 to -1->+1 (clipspace)\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  // 未翻转Y轴\n  //  gl_Position = vec4(a_position, 0, 1);\n  // 翻转Y轴\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  // Multiply the position by the matrix.\n//  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n  // 将颜色传递给片断着色器\n  v_color = a_color;\n\n  gl_PointSize = u_pointSize;\n}\n",b=(function(t){function i(i,e,n){var o=t.call(this,i,e||S,n||w)||this;return o.vertShader=S,o.fragShader=w,o}(function(t,i){function e(){this.constructor=t}r(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)})(i,t),i.prototype.updateProjection=function(){return this},i.prototype.draw=function(){var t=this.gl.POINTS;return this.gl.drawArrays(t,0,this.count),this},i.prototype.translate=function(){return this},i.prototype.rotate=function(){return this},i.prototype.scale=function(){return this}}(x),{globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:.04,maxAge:90,paths:800,frameRate:20,useCoordsDraw:!0,gpet:!0});function A(t,i,e,n){return Math.max(0,Math.min(n.length-1,Math.round((t-i)/(e-i)*(n.length-1))))}var E,P=function(){function t(t,i,e){if(this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.animate=this.animate.bind(this),this.setOptions(i),e&&this.updateData(e)}return t.prototype.setOptions=function(t){this.options=Object.assign({},b,t);var i=this.ctx.canvas,e=i.width,n=i.height;"particleAge"in t&&!("maxAge"in t)&&c(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&c(this.options.particleMultiplier)&&(this.options.paths=Math.round(e*n*this.options.particleMultiplier)),this.prerender()},t.prototype.getOptions=function(){return this.options},t.prototype.updateData=function(t){this.field=t},t.prototype.moveParticles=function(){for(var t=this.ctx.canvas,i=t.width,e=t.height,n=this.particles,o=this.options.maxAge,r=p(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale,s=0,a=n.length;s<a;s++){var h=n[s];h.age>o&&(h.age=0,this.field.randomize(h,i,e,this.unproject));var c=h.x,u=h.y,l=this.field.interpolatedValueAt(c,u);if(null===l)h.age=o;else{var d=c+l.u*r,f=u+l.v*r;this.field.hasValueAt(d,f)?(h.xt=d,h.yt=f,h.m=l.m):(h.x=d,h.y=f,h.age=o)}h.age++}},t.prototype.fadeIn=function(){var t=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=t},t.prototype.drawParticles=function(){var t,i,e=this.particles;this.fadeIn(),this.ctx.globalAlpha=this.options.globalAlpha,this.ctx.fillStyle="rgba(0, 0, 0, "+this.options.globalAlpha+")",this.ctx.lineWidth=c(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=null!=(i=this.options.colorScale)&&("string"==typeof i||null!==i.constructor&&i.constructor===String)?this.options.colorScale:"#fff";var n=0,o=e.length;if(this.field&&o>0){var r=void 0,s=void 0;for(d(this.options.minVelocity)&&d(this.options.maxVelocity)?(r=this.options.minVelocity,s=this.options.maxVelocity):(r=(t=this.field.range)[0],s=t[1]);n<o;n++)this[this.options.useCoordsDraw?"drawCoordsParticle":"drawPixelParticle"](e[n],r,s)}},t.prototype.drawPixelParticle=function(t,i,e){var n=[t.x,t.y],o=[t.xt,t.yt];if(o&&n&&d(o[0])&&d(o[1])&&d(n[0])&&d(n[1])&&t.age<=this.options.maxAge){if(this.ctx.beginPath(),this.ctx.moveTo(n[0],n[1]),this.ctx.lineTo(o[0],o[1]),p(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var r=A(t.m,i,e,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[r]}p(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),t.x=t.xt,t.y=t.yt,this.ctx.stroke()}},t.prototype.drawCoordsParticle=function(t,i,e){var n=[t.x,t.y],o=[t.xt,t.yt];if(o&&n&&d(o[0])&&d(o[1])&&d(n[0])&&d(n[1])&&this.intersectsCoordinate(o)&&t.age<=this.options.maxAge){var r=this.project(n),s=this.project(o);if(r&&s){if(this.ctx.beginPath(),this.ctx.moveTo(r[0],r[1]),this.ctx.lineTo(s[0],s[1]),t.x=t.xt,t.y=t.yt,p(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var a=A(t.m,i,e,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[a]}p(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}},t.prototype.prepareParticlePaths=function(){var t=this.ctx.canvas,i=t.width,e=t.height,n="function"==typeof this.options.paths?this.options.paths(this):this.options.paths,o=[];if(!this.field)return[];"startBatchInterpolate"in this.field&&this.field.startBatchInterpolate(i,e,this.unproject);for(var r=0;r<n;r++)o.push(this.field.randomize({age:this.randomize()},i,e,this.unproject));return o},t.prototype.randomize=function(){return Math.floor(Math.random()*this.options.maxAge)},t.prototype.project=function(){for(var t=arguments,i=[],e=0;e<arguments.length;e++)i[e]=t[e];throw new Error("project must be overriden")},t.prototype.unproject=function(){for(var t=arguments,i=[],e=0;e<arguments.length;e++)i[e]=t[e];throw new Error("unproject must be overriden")},t.prototype.intersectsCoordinate=function(t){throw new Error("must be overriden")},t.prototype.clearCanvas=function(){this.stop(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.forceStop=!1},t.prototype.start=function(){this.starting=!0,this.forceStop=!1,this._then=Date.now(),this.animate()},t.prototype.stop=function(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0},t.prototype.animate=function(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);var t=Date.now(),i=t-this._then;i>this.options.frameRate&&(this._then=t-i%this.options.frameRate,this.render())},t.prototype.prerender=function(){this.generated=!1,this.particles=this.prepareParticlePaths(),this.generated=!0,this.starting||this.forceStop||(this.starting=!0,this._then=Date.now(),this.animate())},t.prototype.render=function(){this.moveParticles(),this.drawParticles(),this.postrender()},t.prototype.postrender=function(){},t.Field=v,t}(),O="undefined"==typeof window?global:window,T={context:"2d",paneName:"mapPane",opacity:1,zIndex:1,windOptions:{}},_=null===(E=O)||void 0===E?void 0:E.BMap;if(!_)throw new Error("Before using this plugin, you must first introduce the BMap JS API <http://lbsyun.baidu.com/index.php?title=jspopular3.0>");var j=function(t){function i(i,e){void 0===e&&(e={});var n=this,o=u({},T,e);return(n=t.call(this,e)||this).options=o,n.paneName=n.options.paneName,n.context=n.options.context,n.zIndex=n.options.zIndex,n.mixBlendMode=n.options.mixBlendMode||null,n.enableMassClear=n.options.enableMassClear,n.canvas=null,n.wind=null,n.start=n.start.bind(n),n.stop=n.stop.bind(n),n.handleResize=n.handleResize.bind(n),n.pickWindOptions(),i&&n.setData(i),n}return function(t,i){function e(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}(i,t),i.prototype.appendTo=function(t){if(!t)throw new Error("not map object");t.addOverlay(this)},i.prototype.initialize=function(t){this.map=t;var i=this.canvas=document.createElement("canvas");return i.style.cssText="position:absolute; left:0; top:0; z-index: "+this.zIndex+" ;user-select:none;",i.style.mixBlendMode=this.mixBlendMode,this.adjustSize(),t.getPanes()[this.paneName].appendChild(i),this.bindEvent(),this.canvas},i.prototype.handleResize=function(){this.adjustSize(),this._draw()},i.prototype.bindEvent=function(){this.map.addEventListener("resize",this.handleResize),this.map.addEventListener("dragstart",this.stop),this.map.addEventListener("dragend",this.start),this.map.addEventListener("movestart",this.stop),this.map.addEventListener("moveend",this.start),this.map.addEventListener("zoomstart",this.stop),this.map.addEventListener("zoomend",this.start),this.map.addEventListener("touchstart",this.stop),this.map.addEventListener("touchend",this.start)},i.prototype.unbindEvent=function(){this.map.removeEventListener("resize",this.handleResize),this.map.removeEventListener("dragstart",this.stop),this.map.removeEventListener("dragend",this.start),this.map.removeEventListener("movestart",this.stop),this.map.removeEventListener("moveend",this.start),this.map.removeEventListener("zoomstart",this.stop),this.map.removeEventListener("zoomend",this.start),this.map.removeEventListener("touchstart",this.stop),this.map.removeEventListener("touchend",this.start)},i.prototype.start=function(){this.wind&&this.wind.start()},i.prototype.stop=function(){this.wind&&this.wind.stop()},i.prototype.adjustSize=function(){var t=this.map.getSize(),i=this.canvas,e=window.devicePixelRatio||1;null!==i&&(i.width=t.width*e,i.height=t.height*e,"2d"===this.context&&i.getContext(this.context).scale(e,e),i.style.width=t.width+"px",i.style.height=t.height+"px")},i.prototype.draw=function(){this._draw()},i.prototype._draw=function(){var t=this.map,i=t.getSize(),e=t.getCenter();if(e&&this.canvas){var n=t.pointToOverlayPixel(e);this.canvas.style.left=n.x-i.width/2+"px",this.canvas.style.top=n.y-i.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this),this.render(this.canvas)}},i.prototype.render=function(t){if(!this.getData()||!this.map)return this;var i=this.getWindOptions();if(t&&!this.wind){var e=this.getData(),n=this.getContext();n&&(this.wind=new P(n,i,e),this.wind.project=this.project.bind(this),this.wind.unproject=this.unproject.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=function(){})}return this.wind&&(this.wind.prerender(),this.wind.render()),this},i.prototype.getContext=function(){if(null!==this.canvas)return this.canvas.getContext(this.context)},i.prototype.getContainer=function(){return this.canvas},i.prototype.getProjection=function(){var t=this.map,i=t.getMapType();return i.getProjection?i.getProjection():{lngLatToPoint:function(i){var e=t.lnglatToMercator(i.lng,i.lat);return{x:e[0],y:e[1]}}}},i.prototype.transferToMercator=function(t){var i=this.getProjection();if(t[0]<-180||t[0]>180||t[1]<-90||t[1]>90)return t;var e=i.lngLatToPoint({lng:t[0],lat:t[1]});return[e.x,e.y]},i.prototype.projectInner=function(t){var i=this.map,e=1;"2d"!=this.context&&(e=window.devicePixelRatio);var n,o,r=this.getProjection();n=i.getMapType().getProjection?r.lngLatToPoint(i.getCenter()):{x:i.getCenter().lng,y:i.getCenter().lat},o=r.getZoomUnits?r.getZoomUnits(i.getZoom()):Math.pow(2,18-i.getZoom());var s=new _.Pixel(n.x-i.getSize().width/2*o,n.y+i.getSize().height/2*o);return[(t[0]-s.x)/o*e,(s.y-t[1])/o*e]},i.prototype.project=function(t){var i=this.transferToMercator(t);return this.projectInner(i)},i.prototype.unproject=function(t){var i=this.map.pixelToPoint(new _.Pixel(t[0],t[1]));return[i.lng,i.lat]},i.prototype.intersectsCoordinate=function(t){return this.map.getBounds().containsPoint(new _.Point(t[0],t[1]))},i.prototype.pickWindOptions=function(){var t=this;Object.keys(b).forEach((function(i){i in t.options&&(void 0===t.options.windOptions&&(t.options.windOptions={}),t.options.windOptions[i]=t.options[i])}))},i.prototype.getData=function(){return this.field},i.prototype.setData=function(t){var i;return t&&t.checkFields&&t.checkFields()?this.field=t:(i=t,Array.isArray(i)?this.field=function(t){var i,e;if(console.time("format-data"),t.forEach((function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":i=t;break;case"1,3":case"2,3":e=t}})),e&&i){var n=i.header,o=new v({xmin:n.lo1,ymin:n.la2,xmax:n.lo2,ymax:n.la1,deltaX:n.dx,deltaY:n.dy,cols:n.nx,rows:n.ny,us:i.data,vs:e.data});return console.timeEnd("format-data"),o}}(t):console.error("Illegal data")),this.map&&this.canvas&&this.field&&this.render(this.canvas),this},i.prototype.updateParams=function(t){return void 0===t&&(t={}),l("will move to setWindOptions"),this.setWindOptions(t),this},i.prototype.getParams=function(){return l("will move to getWindOptions"),this.getWindOptions()},i.prototype.setWindOptions=function(t){var i=this.options.windOptions||{};this.options=u(this.options,{windOptions:u(i,t||{})}),this.wind&&(this.wind.setOptions(this.options.windOptions),this.wind.prerender())},i.prototype.getWindOptions=function(){return this.options.windOptions||{}},i.prototype.show=function(){this.canvas?this.canvas.style.display="block":this.map.addOverlay(this)},i.prototype.hide=function(){this.canvas&&(this.canvas.style.display="none")},i.prototype.setZIndex=function(t){this.zIndex=t,this.canvas&&(this.canvas.style.zIndex=String(this.zIndex))},i.prototype.getZIndex=function(){return this.zIndex},i}(_.Overlay),M=j;i.default=j}}]);