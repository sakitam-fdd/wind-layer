import{E as C,i as E,e as L}from"./Object.DdgBWT7D.js";import{I as y}from"./ImageState.BQAwWc_S.js";import{a as g,U as P,V as I,W as S,X as O,S as w}from"./proj.BNE8J585.js";import{c as T,R as D,a as _}from"./Event.BTHd1TaF.js";import{a as x,b as u,c as b}from"./transform.CU9krZJA.js";import{d as A}from"./dom.i4NIYYs1.js";var M=function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),k=function(i){M(r,i);function r(t){var e=i.call(this)||this;return e.ready=!0,e.boundHandleImageChange_=e.handleImageChange_.bind(e),e.layer_=t,e.declutterExecutorGroup=null,e}return r.prototype.getFeatures=function(t){return g()},r.prototype.getData=function(t){return null},r.prototype.prepareFrame=function(t){return g()},r.prototype.renderFrame=function(t,e){return g()},r.prototype.loadedTileCallback=function(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n},r.prototype.createLoadedTileFinder=function(t,e,n){return(function(a,o){var s=this.loadedTileCallback.bind(this,n,a);return t.forEachLoadedTile(e,a,o,s)}).bind(this)},r.prototype.forEachFeatureAtCoordinate=function(t,e,n,a,o){},r.prototype.getDataAtPixel=function(t,e,n){return null},r.prototype.getLayer=function(){return this.layer_},r.prototype.handleFontsChanged=function(){},r.prototype.handleImageChange_=function(t){var e=t.target;e.getState()===y.LOADED&&this.renderIfReadyAndVisible()},r.prototype.loadImage=function(t){var e=t.getState();return e!=y.LOADED&&e!=y.ERROR&&t.addEventListener(C.CHANGE,this.boundHandleImageChange_),e==y.IDLE&&(t.load(),e=t.getState()),e==y.LOADED},r.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()},r.prototype.disposeInternal=function(){delete this.layer_,i.prototype.disposeInternal.call(this)},r}(E);const N=k;var j=function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),q=[],p=null;function F(){var i=document.createElement("canvas");i.width=1,i.height=1,p=i.getContext("2d")}var W=function(i){j(r,i);function r(t){var e=i.call(this,t)||this;return e.container=null,e.renderedResolution,e.tempTransform=x(),e.pixelTransform=x(),e.inversePixelTransform=x(),e.context=null,e.containerReused=!1,e.pixelContext_=null,e.frameState=null,e}return r.prototype.getImageData=function(t,e,n){p||F(),p.clearRect(0,0,1,1);var a;try{p.drawImage(t,e,n,1,1,0,0,1,1),a=p.getImageData(0,0,1,1).data}catch{return p=null,null}return a},r.prototype.getBackground=function(t){var e=this.getLayer(),n=e.getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0},r.prototype.useContainer=function(t,e,n){var a=this.getLayer().getClassName(),o,s;if(t&&t.className===a&&(!n||t&&t.style.backgroundColor&&L(T(t.style.backgroundColor),T(n)))){var c=t.firstElementChild;c instanceof HTMLCanvasElement&&(s=c.getContext("2d"))}if(s&&s.canvas.style.transform===e?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){o=document.createElement("div"),o.className=a;var l=o.style;l.position="absolute",l.width="100%",l.height="100%",s=A();var c=s.canvas;o.appendChild(c),l=c.style,l.position="absolute",l.left="0",l.transformOrigin="top left",this.container=o,this.context=s}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)},r.prototype.clipUnrotated=function(t,e,n){var a=P(n),o=I(n),s=S(n),c=O(n);u(e.coordinateToPixelTransform,a),u(e.coordinateToPixelTransform,o),u(e.coordinateToPixelTransform,s),u(e.coordinateToPixelTransform,c);var l=this.inversePixelTransform;u(l,a),u(l,o),u(l,s),u(l,c),t.save(),t.beginPath(),t.moveTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(c[0]),Math.round(c[1])),t.clip()},r.prototype.dispatchRenderEvent_=function(t,e,n){var a=this.getLayer();if(a.hasListener(t)){var o=new D(t,this.inversePixelTransform,n,e);a.dispatchEvent(o)}},r.prototype.preRender=function(t,e){this.frameState=e,this.dispatchRenderEvent_(_.PRERENDER,t,e)},r.prototype.postRender=function(t,e){this.dispatchRenderEvent_(_.POSTRENDER,t,e)},r.prototype.getRenderTransform=function(t,e,n,a,o,s,c){var l=o/2,m=s/2,v=a/e,d=-v,h=-t[0]+c,f=-t[1];return b(this.tempTransform,l,m,v,d,-n,h,f)},r.prototype.getDataAtPixel=function(t,e,n){var a=u(this.inversePixelTransform,t.slice()),o=this.context,s=this.getLayer(),c=s.getExtent();if(c){var l=u(e.pixelToCoordinateTransform,t.slice());if(!w(c,l))return null}var m=Math.round(a[0]),v=Math.round(a[1]),d=this.pixelContext_;if(!d){var h=document.createElement("canvas");h.width=1,h.height=1,d=h.getContext("2d"),this.pixelContext_=d}d.clearRect(0,0,1,1);var f;try{d.drawImage(o.canvas,m,v,1,1,0,0,1,1),f=d.getImageData(0,0,1,1).data}catch(R){return R.name==="SecurityError"?(this.pixelContext_=null,new Uint8Array):f}return f[3]===0?null:f},r.prototype.disposeInternal=function(){delete this.frameState,i.prototype.disposeInternal.call(this)},r}(N);export{W as C,q as c};
