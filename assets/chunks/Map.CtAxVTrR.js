import{g as Y,c as Zi,a as rt,l as ki}from"./math.E5ukR3YQ.js";import{A as Nr,a as Mt,g as ze,b as kr,i as fi,e as Se,c as hi,d as $i,f as Gt,h as Gr,j as ji,k as qi,s as Kr,l as Wr,m as ht,n as Qt,o as Ji,p as Vr,q as te,r as Ur,t as jt,u as Yr,v as Hr,w as zr,R as Xr,x as re,y as Br,z as Zr,U as $r}from"./proj.Cr1UOlyj.js";import{B as Xe,E as oe,a as D,l as x,u as wt,b as vi,c as Q,d as _i,O as we,e as Oe,g as qt,T as Ft,s as jr,V as li,f as qr,F as Be,D as Qi,h as Jr,i as tr}from"./Object.BbzoBtIW.js";import{r as Qr,e as ne,a as pt,l as tn,s as en,i as rn,b as nn,n as ui}from"./easing.BmLONCSm.js";import{B as an,R as yt,v as Ae,L as Kt}from"./LayerType.DIbWEofJ.js";import{T as H,r as di,h as on,a as sn,b as Gi,L as hn,c as mt,d as ln}from"./TileRange.DvsT0Zm5.js";import{a as J,V as U,c as tt,b as un,s as er,r as ir,d as dn,e as rr,P as pn,t as ee,f as nt,g as cn,G,i as fn,h as nr,j as vn,k as _n,l as gn,m as yn,n as mn,o as En,p as Tn}from"./View.Cge0UzIc.js";import{S as gi}from"./State.DdpVcuyW.js";import{r as ar}from"./index.B6qUrsMJ.js";import"./commonjsHelpers.Cpj98o6Y.js";const it={ADD:"add",REMOVE:"remove"};var Ki={LENGTH:"length"},ye=function(a){function e(n,t){a.call(this,n),this.element=t}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(oe),lt=function(a){function e(n,t){a.call(this);var i=t||{};if(this.unique_=!!i.unique,this.array_=n||[],this.unique_)for(var r=0,o=this.array_.length;r<o;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var i=0,r=t.length;i<r;++i)this.push(t[i]);return this},e.prototype.forEach=function(t){for(var i=this.array_,r=0,o=i.length;r<o;++r)t(i[r],r,i)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(Ki.LENGTH)},e.prototype.insertAt=function(t,i){this.unique_&&this.assertUnique_(i),this.array_.splice(t,0,i),this.updateLength_(),this.dispatchEvent(new ye(it.ADD,i))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var i=this.getLength();return this.insertAt(i,t),this.getLength()},e.prototype.remove=function(t){for(var i=this.array_,r=0,o=i.length;r<o;++r)if(i[r]===t)return this.removeAt(r)},e.prototype.removeAt=function(t){var i=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new ye(it.REMOVE,i)),i},e.prototype.setAt=function(t,i){var r=this.getLength();if(t<r){this.unique_&&this.assertUnique_(i,t);var o=this.array_[t];this.array_[t]=i,this.dispatchEvent(new ye(it.REMOVE,o)),this.dispatchEvent(new ye(it.ADD,i))}else{for(var s=r;s<t;++s)this.insertAt(s,void 0);this.insertAt(t,i)}},e.prototype.updateLength_=function(){this.set(Ki.LENGTH,this.array_.length)},e.prototype.assertUnique_=function(t,i){for(var r=0,o=this.array_.length;r<o;++r)if(this.array_[r]===t&&r!==i)throw new Nr(58)},e}(Xe),Ee=function(a){function e(n,t,i){a.call(this,n),this.map=t,this.frameState=i!==void 0?i:null}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(oe),or=function(a){function e(n,t,i,r,o){a.call(this,n,t,o),this.originalEvent=i,this.pixel=t.getEventPixel(i),this.coordinate=t.getCoordinateFromPixel(this.pixel),this.dragging=r!==void 0?r:!1}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.preventDefault=function(){a.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){a.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},e}(Ee),Wt=typeof navigator<"u"?navigator.userAgent.toLowerCase():"",Cn=Wt.indexOf("firefox")!==-1,Rn=Wt.indexOf("safari")!==-1&&Wt.indexOf("chrom")==-1,In=Wt.indexOf("webkit")!==-1&&Wt.indexOf("edge")==-1,Ln=Wt.indexOf("macintosh")!==-1,xe=window.devicePixelRatio||1,De=function(){var a=!1;try{a=!!document.createElement("canvas").getContext("2d").setLineDash}catch{}return a}(),sr="ontouchstart"in window,Sn="PointerEvent"in window,wn=!!navigator.msPointerEnabled;const K={SINGLECLICK:"singleclick",CLICK:D.CLICK,DBLCLICK:D.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var On=function(a){function e(n,t,i,r,o){a.call(this,n,t,i.originalEvent,r,o),this.pointerEvent=i}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(or);const It=On,st={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var yi=function(e,n){this.dispatcher=e,this.mapping_=n};yi.prototype.getEvents=function(){return Object.keys(this.mapping_)};yi.prototype.getHandlerForEvent=function(e){return this.mapping_[e]};const Ze=yi;var At=1,An="mouse",Wi=25;function xn(a){if(!this.isEventSimulatedFromTouch_(a)){At.toString()in this.pointerMap&&this.cancel(a);var e=xt(a,this.dispatcher);this.pointerMap[At.toString()]=a,this.dispatcher.down(e,a)}}function Dn(a){if(!this.isEventSimulatedFromTouch_(a)){var e=xt(a,this.dispatcher);this.dispatcher.move(e,a)}}function Pn(a){if(!this.isEventSimulatedFromTouch_(a)){var e=this.pointerMap[At.toString()];if(e&&e.button===a.button){var n=xt(a,this.dispatcher);this.dispatcher.up(n,a),this.cleanupMouse()}}}function bn(a){if(!this.isEventSimulatedFromTouch_(a)){var e=xt(a,this.dispatcher);this.dispatcher.enterOver(e,a)}}function Mn(a){if(!this.isEventSimulatedFromTouch_(a)){var e=xt(a,this.dispatcher);this.dispatcher.leaveOut(e,a)}}var Fn=function(a){function e(n){var t={mousedown:xn,mousemove:Dn,mouseup:Pn,mouseover:bn,mouseout:Mn};a.call(this,n,t),this.pointerMap=n.pointerMap,this.lastTouches=[]}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.isEventSimulatedFromTouch_=function(t){for(var i=this.lastTouches,r=t.clientX,o=t.clientY,s=0,h=i.length,l=void 0;s<h&&(l=i[s]);s++){var u=Math.abs(r-l[0]),d=Math.abs(o-l[1]);if(u<=Wi&&d<=Wi)return!0}return!1},e.prototype.cancel=function(t){var i=xt(t,this.dispatcher);this.dispatcher.cancel(i,t),this.cleanupMouse()},e.prototype.cleanupMouse=function(){delete this.pointerMap[At.toString()]},e}(Ze);function xt(a,e){var n=e.cloneEvent(a,a),t=n.preventDefault;return n.preventDefault=function(){a.preventDefault(),t()},n.pointerId=At,n.isPrimary=!0,n.pointerType=An,n}var Nn=["","unavailable","touch","pen","mouse"];function kn(a){this.pointerMap[a.pointerId.toString()]=a;var e=this.prepareEvent_(a);this.dispatcher.down(e,a)}function Gn(a){var e=this.prepareEvent_(a);this.dispatcher.move(e,a)}function Kn(a){var e=this.prepareEvent_(a);this.dispatcher.up(e,a),this.cleanup(a.pointerId)}function Wn(a){var e=this.prepareEvent_(a);this.dispatcher.leaveOut(e,a)}function Vn(a){var e=this.prepareEvent_(a);this.dispatcher.enterOver(e,a)}function Un(a){var e=this.prepareEvent_(a);this.dispatcher.cancel(e,a),this.cleanup(a.pointerId)}function Yn(a){var e=this.dispatcher.makeEvent("lostpointercapture",a,a);this.dispatcher.dispatchEvent(e)}function Hn(a){var e=this.dispatcher.makeEvent("gotpointercapture",a,a);this.dispatcher.dispatchEvent(e)}var zn=function(a){function e(n){var t={MSPointerDown:kn,MSPointerMove:Gn,MSPointerUp:Kn,MSPointerOut:Wn,MSPointerOver:Vn,MSPointerCancel:Un,MSGotPointerCapture:Hn,MSLostPointerCapture:Yn};a.call(this,n,t),this.pointerMap=n.pointerMap}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.prepareEvent_=function(t){var i=t;return typeof t.pointerType=="number"&&(i=this.dispatcher.cloneEvent(t,t),i.pointerType=Nn[t.pointerType]),i},e.prototype.cleanup=function(t){delete this.pointerMap[t.toString()]},e}(Ze);function Xn(a){this.dispatcher.fireNativeEvent(a)}function Bn(a){this.dispatcher.fireNativeEvent(a)}function Zn(a){this.dispatcher.fireNativeEvent(a)}function $n(a){this.dispatcher.fireNativeEvent(a)}function jn(a){this.dispatcher.fireNativeEvent(a)}function qn(a){this.dispatcher.fireNativeEvent(a)}function Jn(a){this.dispatcher.fireNativeEvent(a)}function Qn(a){this.dispatcher.fireNativeEvent(a)}var ta=function(a){function e(n){var t={pointerdown:Xn,pointermove:Bn,pointerup:Zn,pointerout:$n,pointerover:jn,pointercancel:qn,gotpointercapture:Qn,lostpointercapture:Jn};a.call(this,n,t)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(Ze),hr=!1,ea=function(a){function e(n,t,i){a.call(this,n),this.originalEvent=t;var r=i||{};this.buttons=ia(r),this.pressure=ra(r,this.buttons),this.bubbles="bubbles"in r?r.bubbles:!1,this.cancelable="cancelable"in r?r.cancelable:!1,this.view="view"in r?r.view:null,this.detail="detail"in r?r.detail:null,this.screenX="screenX"in r?r.screenX:0,this.screenY="screenY"in r?r.screenY:0,this.clientX="clientX"in r?r.clientX:0,this.clientY="clientY"in r?r.clientY:0,this.ctrlKey="ctrlKey"in r?r.ctrlKey:!1,this.altKey="altKey"in r?r.altKey:!1,this.shiftKey="shiftKey"in r?r.shiftKey:!1,this.metaKey="metaKey"in r?r.metaKey:!1,this.button="button"in r?r.button:0,this.relatedTarget="relatedTarget"in r?r.relatedTarget:null,this.pointerId="pointerId"in r?r.pointerId:0,this.width="width"in r?r.width:0,this.height="height"in r?r.height:0,this.tiltX="tiltX"in r?r.tiltX:0,this.tiltY="tiltY"in r?r.tiltY:0,this.pointerType="pointerType"in r?r.pointerType:"",this.hwTimestamp="hwTimestamp"in r?r.hwTimestamp:0,this.isPrimary="isPrimary"in r?r.isPrimary:!1,t.preventDefault&&(this.preventDefault=function(){t.preventDefault()})}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(oe);function ia(a){var e;if(a.buttons||hr)e=a.buttons;else switch(a.which){case 1:e=1;break;case 2:e=4;break;case 3:e=2;break;default:e=0}return e}function ra(a,e){var n=0;return a.pressure?n=a.pressure:n=e?.5:0,n}(function(){try{var a=new MouseEvent("click",{buttons:1});hr=a.buttons===1}catch{}})();const na=ea;var aa=200,oa="touch";function sa(a){this.vacuumTouches_(a),this.setPrimaryTouch_(a.changedTouches[0]),this.dedupSynthMouse_(a),this.clickCount_++,this.processTouches_(a,this.overDown_)}function ha(a){this.processTouches_(a,this.moveOverOut_)}function la(a){this.dedupSynthMouse_(a),this.processTouches_(a,this.upOut_)}function ua(a){this.processTouches_(a,this.cancelOut_)}var da=function(a){function e(n,t){var i={touchstart:sa,touchmove:ha,touchend:la,touchcancel:ua};a.call(this,n,i),this.pointerMap=n.pointerMap,this.mouseSource=t,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_,this.dedupTimeout_=2500}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.isPrimaryTouch_=function(t){return this.firstTouchId_===t.identifier},e.prototype.setPrimaryTouch_=function(t){var i=Object.keys(this.pointerMap).length;(i===0||i===1&&At.toString()in this.pointerMap)&&(this.firstTouchId_=t.identifier,this.cancelResetClickCount_())},e.prototype.removePrimaryPointer_=function(t){t.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())},e.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),aa)},e.prototype.resetClickCountHandler_=function(){this.clickCount_=0,this.resetId_=void 0},e.prototype.cancelResetClickCount_=function(){this.resetId_!==void 0&&clearTimeout(this.resetId_)},e.prototype.touchToPointer_=function(t,i){var r=this.dispatcher.cloneEvent(t,i);return r.pointerId=i.identifier+2,r.bubbles=!0,r.cancelable=!0,r.detail=this.clickCount_,r.button=0,r.buttons=1,r.width=i.radiusX||0,r.height=i.radiusY||0,r.pressure=i.force||.5,r.isPrimary=this.isPrimaryTouch_(i),r.pointerType=oa,r.clientX=i.clientX,r.clientY=i.clientY,r.screenX=i.screenX,r.screenY=i.screenY,r},e.prototype.processTouches_=function(t,i){var r=Array.prototype.slice.call(t.changedTouches),o=r.length;function s(){t.preventDefault()}for(var h=0;h<o;++h){var l=this.touchToPointer_(t,r[h]);l.preventDefault=s,i.call(this,t,l)}},e.prototype.findTouch_=function(t,i){for(var r=t.length,o=0;o<r;o++){var s=t[o];if(s.identifier===i)return!0}return!1},e.prototype.vacuumTouches_=function(t){var i=t.touches,r=Object.keys(this.pointerMap),o=r.length;if(o>=i.length){for(var s=[],h=0;h<o;++h){var l=Number(r[h]),u=this.pointerMap[l];l!=At&&!this.findTouch_(i,l-2)&&s.push(u.out)}for(var d=0;d<s.length;++d)this.cancelOut_(t,s[d])}},e.prototype.overDown_=function(t,i){this.pointerMap[i.pointerId]={target:i.target,out:i,outTarget:i.target},this.dispatcher.over(i,t),this.dispatcher.enter(i,t),this.dispatcher.down(i,t)},e.prototype.moveOverOut_=function(t,i){var r=i,o=this.pointerMap[r.pointerId];if(o){var s=o.out,h=o.outTarget;this.dispatcher.move(r,t),s&&h!==r.target&&(s.relatedTarget=r.target,r.relatedTarget=h,s.target=h,r.target?(this.dispatcher.leaveOut(s,t),this.dispatcher.enterOver(r,t)):(r.target=h,r.relatedTarget=null,this.cancelOut_(t,r))),o.out=r,o.outTarget=r.target}},e.prototype.upOut_=function(t,i){this.dispatcher.up(i,t),this.dispatcher.out(i,t),this.dispatcher.leave(i,t),this.cleanUpPointer_(i)},e.prototype.cancelOut_=function(t,i){this.dispatcher.cancel(i,t),this.dispatcher.out(i,t),this.dispatcher.leave(i,t),this.cleanUpPointer_(i)},e.prototype.cleanUpPointer_=function(t){delete this.pointerMap[t.pointerId],this.removePrimaryPointer_(t)},e.prototype.dedupSynthMouse_=function(t){var i=this.mouseSource.lastTouches,r=t.changedTouches[0];if(this.isPrimaryTouch_(r)){var o=[r.clientX,r.clientY];i.push(o),setTimeout(function(){Qr(i,o)},this.dedupTimeout_)}},e}(Ze),ei=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]],Vi=function(a){function e(n){a.call(this),this.element_=n,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.registerSources=function(){if(Sn)this.registerSource("native",new ta(this));else if(wn)this.registerSource("ms",new zn(this));else{var t=new Fn(this);this.registerSource("mouse",t),sr&&this.registerSource("touch",new da(this,t))}this.register_()},e.prototype.registerSource=function(t,i){var r=i,o=r.getEvents();o&&(o.forEach((function(s){var h=r.getHandlerForEvent(s);h&&(this.eventMap_[s]=h.bind(r))}).bind(this)),this.eventSourceList_.push(r))},e.prototype.register_=function(){for(var t=this.eventSourceList_.length,i=0;i<t;i++){var r=this.eventSourceList_[i];this.addEvents_(r.getEvents())}},e.prototype.unregister_=function(){for(var t=this.eventSourceList_.length,i=0;i<t;i++){var r=this.eventSourceList_[i];this.removeEvents_(r.getEvents())}},e.prototype.eventHandler_=function(t){var i=t.type,r=this.eventMap_[i];r&&r(t)},e.prototype.addEvents_=function(t){t.forEach((function(i){x(this.element_,i,this.eventHandler_,this)}).bind(this))},e.prototype.removeEvents_=function(t){t.forEach((function(i){wt(this.element_,i,this.eventHandler_,this)}).bind(this))},e.prototype.cloneEvent=function(t,i){for(var r={},o=0,s=ei.length;o<s;o++){var h=ei[o][0];r[h]=t[h]||i[h]||ei[o][1]}return r},e.prototype.down=function(t,i){this.fireEvent(st.POINTERDOWN,t,i)},e.prototype.move=function(t,i){this.fireEvent(st.POINTERMOVE,t,i)},e.prototype.up=function(t,i){this.fireEvent(st.POINTERUP,t,i)},e.prototype.enter=function(t,i){t.bubbles=!1,this.fireEvent(st.POINTERENTER,t,i)},e.prototype.leave=function(t,i){t.bubbles=!1,this.fireEvent(st.POINTERLEAVE,t,i)},e.prototype.over=function(t,i){t.bubbles=!0,this.fireEvent(st.POINTEROVER,t,i)},e.prototype.out=function(t,i){t.bubbles=!0,this.fireEvent(st.POINTEROUT,t,i)},e.prototype.cancel=function(t,i){this.fireEvent(st.POINTERCANCEL,t,i)},e.prototype.leaveOut=function(t,i){this.out(t,i),this.contains_(t.target,t.relatedTarget)||this.leave(t,i)},e.prototype.enterOver=function(t,i){this.over(t,i),this.contains_(t.target,t.relatedTarget)||this.enter(t,i)},e.prototype.contains_=function(t,i){return!t||!i?!1:t.contains(i)},e.prototype.makeEvent=function(t,i,r){return new na(t,r,i)},e.prototype.fireEvent=function(t,i,r){var o=this.makeEvent(t,i,r);this.dispatchEvent(o)},e.prototype.fireNativeEvent=function(t){var i=this.makeEvent(t.type,t,t);this.dispatchEvent(i)},e.prototype.wrapMouseEvent=function(t,i){var r=this.makeEvent(t,xt(i,this),i);return r},e.prototype.disposeInternal=function(){this.unregister_(),a.prototype.disposeInternal.call(this)},e}(vi),pa=function(a){function e(n,t){a.call(this),this.map_=n,this.clickTimeoutId_,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t?t*xe:xe,this.down_=null;var i=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new Vi(i),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=x(this.pointerEventHandler_,st.POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=x(this.pointerEventHandler_,st.POINTERMOVE,this.relayEvent_,this)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.emulateClick_=function(t){var i=new It(K.CLICK,this.map_,t);this.dispatchEvent(i),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,i=new It(K.DBLCLICK,this.map_,t),this.dispatchEvent(i)):this.clickTimeoutId_=setTimeout((function(){this.clickTimeoutId_=void 0;var r=new It(K.SINGLECLICK,this.map_,t);this.dispatchEvent(r)}).bind(this),250)},e.prototype.updateActivePointers_=function(t){var i=t;i.type==K.POINTERUP||i.type==K.POINTERCANCEL?delete this.trackedTouches_[i.pointerId]:i.type==K.POINTERDOWN&&(this.trackedTouches_[i.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},e.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var i=new It(K.POINTERUP,this.map_,t);this.dispatchEvent(i),!i.propagationStopped&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_===0&&(this.dragListenerKeys_.forEach(Q),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)},e.prototype.isMouseActionButton_=function(t){return t.button===0},e.prototype.handlePointerDown_=function(t){this.updateActivePointers_(t);var i=new It(K.POINTERDOWN,this.map_,t);this.dispatchEvent(i),this.down_=t,this.dragListenerKeys_.length===0&&(this.documentPointerEventHandler_=new Vi(document),this.dragListenerKeys_.push(x(this.documentPointerEventHandler_,K.POINTERMOVE,this.handlePointerMove_,this),x(this.documentPointerEventHandler_,K.POINTERUP,this.handlePointerUp_,this),x(this.pointerEventHandler_,K.POINTERCANCEL,this.handlePointerUp_,this)))},e.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var i=new It(K.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(i)}t.preventDefault()},e.prototype.relayEvent_=function(t){var i=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new It(t.type,this.map_,t,i))},e.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},e.prototype.disposeInternal=function(){this.relayedListenerKey_&&(Q(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(Q(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Q),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),a.prototype.disposeInternal.call(this)},e}(vi);const ca=pa,Te={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},Z={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};var Pe=1/0,$=function(e,n){this.priorityFunction_=e,this.keyFunction_=n,this.elements_=[],this.priorities_=[],this.queuedElements_={}};$.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,_i(this.queuedElements_)};$.prototype.dequeue=function(){var e=this.elements_,n=this.priorities_,t=e[0];e.length==1?(e.length=0,n.length=0):(e[0]=e.pop(),n[0]=n.pop(),this.siftUp_(0));var i=this.keyFunction_(t);return delete this.queuedElements_[i],t};$.prototype.enqueue=function(e){Mt(!(this.keyFunction_(e)in this.queuedElements_),31);var n=this.priorityFunction_(e);return n!=Pe?(this.elements_.push(e),this.priorities_.push(n),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1};$.prototype.getCount=function(){return this.elements_.length};$.prototype.getLeftChildIndex_=function(e){return e*2+1};$.prototype.getRightChildIndex_=function(e){return e*2+2};$.prototype.getParentIndex_=function(e){return e-1>>1};$.prototype.heapify_=function(){var e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)};$.prototype.isEmpty=function(){return this.elements_.length===0};$.prototype.isKeyQueued=function(e){return e in this.queuedElements_};$.prototype.isQueued=function(e){return this.isKeyQueued(this.keyFunction_(e))};$.prototype.siftUp_=function(e){for(var n=this.elements_,t=this.priorities_,i=n.length,r=n[e],o=t[e],s=e;e<i>>1;){var h=this.getLeftChildIndex_(e),l=this.getRightChildIndex_(e),u=l<i&&t[l]<t[h]?l:h;n[e]=n[u],t[e]=t[u],e=u}n[e]=r,t[e]=o,this.siftDown_(s,e)};$.prototype.siftDown_=function(e,n){for(var t=this.elements_,i=this.priorities_,r=t[n],o=i[n];n>e;){var s=this.getParentIndex_(n);if(i[s]>o)t[n]=t[s],i[n]=i[s],n=s;else break}t[n]=r,i[n]=o};$.prototype.reprioritize=function(){var e=this.priorityFunction_,n=this.elements_,t=this.priorities_,i=0,r=n.length,o,s,h;for(s=0;s<r;++s)o=n[s],h=e(o),h==Pe?delete this.queuedElements_[this.keyFunction_(o)]:(t[i]=h,n[i++]=o);n.length=i,t.length=i,this.heapify_()};var fa=function(a){function e(n,t){a.call(this,function(i){return n.apply(null,i)},function(i){return i[0].getKey()}),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.enqueue=function(t){var i=a.prototype.enqueue.call(this,t);if(i){var r=t[0];x(r,D.CHANGE,this.handleTileChange,this)}return i},e.prototype.getTilesLoading=function(){return this.tilesLoading_},e.prototype.handleTileChange=function(t){var i=t.target,r=i.getState();if(r===H.LOADED||r===H.ERROR||r===H.EMPTY||r===H.ABORT){wt(i,D.CHANGE,this.handleTileChange,this);var o=i.getKey();o in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[o],--this.tilesLoading_),this.tileChangeCallback_()}},e.prototype.loadMoreTiles=function(t,i){for(var r=0,o=!1,s,h,l;this.tilesLoading_<t&&r<i&&this.getCount()>0;)h=this.dequeue()[0],l=h.getKey(),s=h.getState(),s===H.ABORT?o=!0:s===H.IDLE&&!(l in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[l]=!0,++this.tilesLoading_,++r,h.load());r===0&&o&&this.tileChangeCallback_()},e}($);const va=fa;var ii={LAYERS:"layers"},_a=function(a){function e(n){var t=n||{},i=Oe({},t);delete i.layers;var r=t.layers;a.call(this,i),this.layersListenerKeys_=[],this.listenerKeys_={},x(this,qt(ii.LAYERS),this.handleLayersChanged_,this),r?Array.isArray(r)?r=new lt(r.slice(),{unique:!0}):Mt(typeof r.getArray=="function",43):r=new lt(void 0,{unique:!0}),this.setLayers(r)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.handleLayerChange_=function(){this.changed()},e.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(Q),this.layersListenerKeys_.length=0;var t=this.getLayers();this.layersListenerKeys_.push(x(t,it.ADD,this.handleLayersAdd_,this),x(t,it.REMOVE,this.handleLayersRemove_,this));for(var i in this.listenerKeys_)this.listenerKeys_[i].forEach(Q);_i(this.listenerKeys_);for(var r=t.getArray(),o=0,s=r.length;o<s;o++){var h=r[o];this.listenerKeys_[Y(h)]=[x(h,we.PROPERTYCHANGE,this.handleLayerChange_,this),x(h,D.CHANGE,this.handleLayerChange_,this)]}this.changed()},e.prototype.handleLayersAdd_=function(t){var i=t.element;this.listenerKeys_[Y(i)]=[x(i,we.PROPERTYCHANGE,this.handleLayerChange_,this),x(i,D.CHANGE,this.handleLayerChange_,this)],this.changed()},e.prototype.handleLayersRemove_=function(t){var i=t.element,r=Y(i);this.listenerKeys_[r].forEach(Q),delete this.listenerKeys_[r],this.changed()},e.prototype.getLayers=function(){return this.get(ii.LAYERS)},e.prototype.setLayers=function(t){this.set(ii.LAYERS,t)},e.prototype.getLayersArray=function(t){var i=t!==void 0?t:[];return this.getLayers().forEach(function(r){r.getLayersArray(i)}),i},e.prototype.getLayerStatesArray=function(t){var i=t!==void 0?t:[],r=i.length;this.getLayers().forEach(function(u){u.getLayerStatesArray(i)});for(var o=this.getLayerState(),s=r,h=i.length;s<h;s++){var l=i[s];l.opacity*=o.opacity,l.visible=l.visible&&o.visible,l.maxResolution=Math.min(l.maxResolution,o.maxResolution),l.minResolution=Math.max(l.minResolution,o.minResolution),o.extent!==void 0&&(l.extent!==void 0?l.extent=ze(l.extent,o.extent):l.extent=o.extent)}return i},e.prototype.getSourceState=function(){return gi.READY},e}(an);const ga=_a;var ya=function(a){function e(n){a.call(this);var t=ma(n);this.maxTilesLoading_=n.maxTilesLoading!==void 0?n.maxTilesLoading:16,this.loadTilesWhileAnimating_=n.loadTilesWhileAnimating!==void 0?n.loadTilesWhileAnimating:!1,this.loadTilesWhileInteracting_=n.loadTilesWhileInteracting!==void 0?n.loadTilesWhileInteracting:!1,this.pixelRatio_=n.pixelRatio!==void 0?n.pixelRatio:xe,this.animationDelayKey_,this.animationDelay_=(function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}).bind(this),this.coordinateToPixelTransform_=tt(),this.pixelToCoordinateTransform_=tt(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+(sr?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.viewport_.style.msTouchAction="none",this.viewport_.style.touchAction="none",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var i=[D.CLICK,D.DBLCLICK,D.MOUSEDOWN,D.TOUCHSTART,D.MSPOINTERDOWN,K.POINTERDOWN,D.MOUSEWHEEL,D.WHEEL],r=0,o=i.length;r<o;++r)x(this.overlayContainerStopEvent_,i[r],jr);this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new ca(this,n.moveTolerance);for(var s in K)x(this.mapBrowserEventHandler_,K[s],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=t.keyboardEventTarget,this.keyHandlerKeys_=null,x(this.viewport_,D.CONTEXTMENU,this.handleBrowserEvent,this),x(this.viewport_,D.WHEEL,this.handleBrowserEvent,this),x(this.viewport_,D.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=t.controls||new lt,this.interactions=t.interactions||new lt,this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=this.createRenderer(),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new va(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},x(this,qt(Z.LAYERGROUP),this.handleLayerGroupChanged_,this),x(this,qt(Z.VIEW),this.handleViewChanged_,this),x(this,qt(Z.SIZE),this.handleSizeChanged_,this),x(this,qt(Z.TARGET),this.handleTargetChanged_,this),this.setProperties(t.values),this.controls.forEach((function(h){h.setMap(this)}).bind(this)),x(this.controls,it.ADD,function(h){h.element.setMap(this)},this),x(this.controls,it.REMOVE,function(h){h.element.setMap(null)},this),this.interactions.forEach((function(h){h.setMap(this)}).bind(this)),x(this.interactions,it.ADD,function(h){h.element.setMap(this)},this),x(this.interactions,it.REMOVE,function(h){h.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_.bind(this)),x(this.overlays_,it.ADD,function(h){this.addOverlayInternal_(h.element)},this),x(this.overlays_,it.REMOVE,function(h){var l=h.element,u=l.getId();u!==void 0&&delete this.overlayIdIndex_[u.toString()],h.element.setMap(null)},this)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},e.prototype.addControl=function(t){this.getControls().push(t)},e.prototype.addInteraction=function(t){this.getInteractions().push(t)},e.prototype.addLayer=function(t){var i=this.getLayerGroup().getLayers();i.push(t)},e.prototype.addOverlay=function(t){this.getOverlays().push(t)},e.prototype.addOverlayInternal_=function(t){var i=t.getId();i!==void 0&&(this.overlayIdIndex_[i.toString()]=t),t.setMap(this)},e.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),wt(this.viewport_,D.CONTEXTMENU,this.handleBrowserEvent,this),wt(this.viewport_,D.WHEEL,this.handleBrowserEvent,this),wt(this.viewport_,D.MOUSEWHEEL,this.handleBrowserEvent,this),this.handleResize_!==void 0&&(removeEventListener(D.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),a.prototype.disposeInternal.call(this)},e.prototype.forEachFeatureAtPixel=function(t,i,r){if(this.frameState_){var o=this.getCoordinateFromPixel(t);r=r!==void 0?r:{};var s=r.hitTolerance!==void 0?r.hitTolerance*this.frameState_.pixelRatio:0,h=r.layerFilter!==void 0?r.layerFilter:Ft;return this.renderer_.forEachFeatureAtCoordinate(o,this.frameState_,s,i,null,h,null)}},e.prototype.getFeaturesAtPixel=function(t,i){var r=null;return this.forEachFeatureAtPixel(t,function(o){r||(r=[]),r.push(o)},i),r},e.prototype.forEachLayerAtPixel=function(t,i,r){if(this.frameState_){var o=r||{},s=o.hitTolerance!==void 0?r.hitTolerance*this.frameState_.pixelRatio:0,h=o.layerFilter||Ft;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,s,i,null,h,null)}},e.prototype.hasFeatureAtPixel=function(t,i){if(!this.frameState_)return!1;var r=this.getCoordinateFromPixel(t);i=i!==void 0?i:{};var o=i.layerFilter!==void 0?i.layerFilter:Ft,s=i.hitTolerance!==void 0?i.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,s,o,null)},e.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},e.prototype.getEventPixel=function(t){var i=this.viewport_.getBoundingClientRect(),r="changedTouches"in t?t.changedTouches[0]:t;return[r.clientX-i.left,r.clientY-i.top]},e.prototype.getTarget=function(){return this.get(Z.TARGET)},e.prototype.getTargetElement=function(){var t=this.getTarget();return t!==void 0?typeof t=="string"?document.getElementById(t):t:null},e.prototype.getCoordinateFromPixel=function(t){var i=this.frameState_;return i?J(i.pixelToCoordinateTransform,t.slice()):null},e.prototype.getControls=function(){return this.controls},e.prototype.getOverlays=function(){return this.overlays_},e.prototype.getOverlayById=function(t){var i=this.overlayIdIndex_[t.toString()];return i!==void 0?i:null},e.prototype.getInteractions=function(){return this.interactions},e.prototype.getLayerGroup=function(){return this.get(Z.LAYERGROUP)},e.prototype.getLayers=function(){var t=this.getLayerGroup().getLayers();return t},e.prototype.getPixelFromCoordinate=function(t){var i=this.frameState_;return i?J(i.coordinateToPixelTransform,t.slice(0,2)):null},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.getSize=function(){return this.get(Z.SIZE)},e.prototype.getView=function(){return this.get(Z.VIEW)},e.prototype.getViewport=function(){return this.viewport_},e.prototype.getOverlayContainer=function(){return this.overlayContainer_},e.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},e.prototype.getTilePriority=function(t,i,r,o){var s=this.frameState_;if(!s||!(i in s.wantedTiles)||!s.wantedTiles[i][t.getKey()])return Pe;var h=r[0]-s.focus[0],l=r[1]-s.focus[1];return 65536*Math.log(o)+Math.sqrt(h*h+l*l)/o},e.prototype.handleBrowserEvent=function(t,i){var r=i||t.type,o=new or(r,this,t);this.handleMapBrowserEvent(o)},e.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){this.focus_=t.coordinate,t.frameState=this.frameState_;var i=this.getInteractions().getArray();if(this.dispatchEvent(t)!==!1)for(var r=i.length-1;r>=0;r--){var o=i[r];if(o.getActive()){var s=o.handleEvent(t);if(!s)break}}}},e.prototype.handlePostRender=function(){var t=this.frameState_,i=this.tileQueue_;if(!i.isEmpty()){var r=this.maxTilesLoading_,o=r;if(t){var s=t.viewHints;s[U.ANIMATING]&&(r=this.loadTilesWhileAnimating_?8:0,o=2),s[U.INTERACTING]&&(r=this.loadTilesWhileInteracting_?8:0,o=2)}i.getTilesLoading()<r&&(i.reprioritize(),i.loadMoreTiles(r,o))}t&&this.hasListener(yt.RENDERCOMPLETE)&&!t.animate&&!this.tileQueue_.getTilesLoading()&&!lr(this.getLayers().getArray())&&this.renderer_.dispatchRenderEvent(yt.RENDERCOMPLETE,t);for(var h=this.postRenderFunctions_,l=0,u=h.length;l<u;++l)h[l](this,t);h.length=0},e.prototype.handleSizeChanged_=function(){this.render()},e.prototype.handleTargetChanged_=function(){var t;if(this.getTarget()&&(t=this.getTargetElement()),this.keyHandlerKeys_){for(var i=0,r=this.keyHandlerKeys_.length;i<r;++i)Q(this.keyHandlerKeys_[i]);this.keyHandlerKeys_=null}if(!t)this.renderer_.removeLayerRenderers(),di(this.viewport_),this.handleResize_!==void 0&&(removeEventListener(D.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);else{t.appendChild(this.viewport_);var o=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[x(o,D.KEYDOWN,this.handleBrowserEvent,this),x(o,D.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(D.RESIZE,this.handleResize_,!1))}this.updateSize()},e.prototype.handleTileChange_=function(){this.render()},e.prototype.handleViewPropertyChanged_=function(){this.render()},e.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(Q(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Q(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.viewport_.setAttribute("data-view",Y(t)),this.viewPropertyListenerKey_=x(t,we.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=x(t,D.CHANGE,this.handleViewPropertyChanged_,this)),this.render()},e.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Q),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.layerGroupPropertyListenerKeys_=[x(t,we.PROPERTYCHANGE,this.render,this),x(t,D.CHANGE,this.render,this)]),this.render()},e.prototype.isRendered=function(){return!!this.frameState_},e.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},e.prototype.render=function(){this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},e.prototype.removeControl=function(t){return this.getControls().remove(t)},e.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},e.prototype.removeLayer=function(t){var i=this.getLayerGroup().getLayers();return i.remove(t)},e.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},e.prototype.renderFrame_=function(t){var i,r=this.getSize(),o=this.getView(),s=Gt(),h=this.frameState_,l=null;if(r!==void 0&&on(r)&&o&&o.isDef()){for(var u=o.getHints(this.frameState_?this.frameState_.viewHints:void 0),d=this.getLayerGroup().getLayerStatesArray(),p={},c=0,f=d.length;c<f;++c)p[Y(d[c].layer)]=d[c];i=o.getState(this.pixelRatio_),l={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:s,focus:this.focus_?this.focus_:i.center,index:this.frameIndex_++,layerStates:p,layerStatesArray:d,pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:r,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:i,viewHints:u,wantedTiles:{}}}if(l&&(l.extent=kr(i.center,i.resolution,i.rotation,l.size,s)),this.frameState_=l,this.renderer_.renderFrame(l),l){if(l.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,l.postRenderFunctions),h){var v=!this.previousExtent_||!fi(this.previousExtent_)&&!Se(l.extent,this.previousExtent_);v&&(this.dispatchEvent(new Ee(Te.MOVESTART,this,h)),this.previousExtent_=hi(this.previousExtent_))}var g=this.previousExtent_&&!l.viewHints[U.ANIMATING]&&!l.viewHints[U.INTERACTING]&&!Se(l.extent,this.previousExtent_);g&&(this.dispatchEvent(new Ee(Te.MOVEEND,this,l)),$i(l.extent,this.previousExtent_))}this.dispatchEvent(new Ee(Te.POSTRENDER,this,l)),setTimeout(this.handlePostRender.bind(this),0)},e.prototype.setLayerGroup=function(t){this.set(Z.LAYERGROUP,t)},e.prototype.setSize=function(t){this.set(Z.SIZE,t)},e.prototype.setTarget=function(t){this.set(Z.TARGET,t)},e.prototype.setView=function(t){this.set(Z.VIEW,t)},e.prototype.skipFeature=function(t){this.skippedFeatureUids_[Y(t)]=!0,this.render()},e.prototype.updateSize=function(){var t=this.getTargetElement();if(!t)this.setSize(void 0);else{var i=getComputedStyle(t);this.setSize([t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth)])}},e.prototype.unskipFeature=function(t){delete this.skippedFeatureUids_[Y(t)],this.render()},e}(Xe);function ma(a){var e=null;a.keyboardEventTarget!==void 0&&(e=typeof a.keyboardEventTarget=="string"?document.getElementById(a.keyboardEventTarget):a.keyboardEventTarget);var n={},t=a.layers&&typeof a.layers.getLayers=="function"?a.layers:new ga({layers:a.layers});n[Z.LAYERGROUP]=t,n[Z.TARGET]=a.target,n[Z.VIEW]=a.view!==void 0?a.view:new un;var i;a.controls!==void 0&&(Array.isArray(a.controls)?i=new lt(a.controls.slice()):(Mt(typeof a.controls.getArray=="function",47),i=a.controls));var r;a.interactions!==void 0&&(Array.isArray(a.interactions)?r=new lt(a.interactions.slice()):(Mt(typeof a.interactions.getArray=="function",48),r=a.interactions));var o;return a.overlays!==void 0?Array.isArray(a.overlays)?o=new lt(a.overlays.slice()):(Mt(typeof a.overlays.getArray=="function",49),o=a.overlays):o=new lt,{controls:i,interactions:r,keyboardEventTarget:e,overlays:o,values:n}}const Ea=ya;function lr(a){for(var e=0,n=a.length;e<n;++e){var t=a[e];if(typeof t.getLayers=="function")return lr(t.getLayers().getArray());var i=t.getSource();if(i&&i.loading)return!0}return!1}var Ta=function(a){function e(n){a.call(this),this.element=n.element?n.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=n.render?n.render:li,n.target&&this.setTarget(n.target)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){di(this.element),a.prototype.disposeInternal.call(this)},e.prototype.getMap=function(){return this.map_},e.prototype.setMap=function(t){this.map_&&di(this.element);for(var i=0,r=this.listenerKeys.length;i<r;++i)Q(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=t,this.map_){var o=this.target_?this.target_:t.getOverlayContainerStopEvent();o.appendChild(this.element),this.render!==li&&this.listenerKeys.push(x(t,Te.POSTRENDER,this.render,this)),t.render()}},e.prototype.setTarget=function(t){this.target_=typeof t=="string"?document.getElementById(t):t},e}(Xe);const mi=Ta;var Ce="ol-hidden",$e="ol-unselectable",Ei="ol-control",Ui="ol-collapsed",Ca=function(){var a,e={};return function(n){if(a||(a=document.createElement("div").style),!(n in e)){a.font=n;var t=a.fontFamily;if(a.font="",!t)return null;e[n]=t.split(/,\s?/)}return e[n]}}(),Ra=function(a){function e(n){var t=n||{};a.call(this,{element:document.createElement("div"),render:t.render||Ia,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);var i=t.className!==void 0?t.className:"ol-attribution",r=t.tipLabel!==void 0?t.tipLabel:"Attributions",o=t.collapseLabel!==void 0?t.collapseLabel:"»";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;var s=t.label!==void 0?t.label:"i";typeof s=="string"?(this.label_=document.createElement("span"),this.label_.textContent=s):this.label_=s;var h=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button"),l.title=r,l.appendChild(h),x(l,D.CLICK,this.handleClick_,this);var u=i+" "+$e+" "+Ei+(this.collapsed_&&this.collapsible_?" "+Ui:"")+(this.collapsible_?"":" ol-uncollapsible"),d=this.element;d.className=u,d.appendChild(this.ulElement_),d.appendChild(l),this.renderedAttributions_=[],this.renderedVisible_=!0}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.collectSourceAttributions_=function(t){for(var i={},r=[],o=t.layerStatesArray,s=t.viewState.resolution,h=0,l=o.length;h<l;++h){var u=o[h];if(Ae(u,s)){var d=u.layer.getSource();if(d){var p=d.getAttributions();if(p){var c=p(t);if(c)if(!this.overrideCollapsible_&&d.getAttributionsCollapsible()===!1&&this.setCollapsible(!1),Array.isArray(c))for(var f=0,v=c.length;f<v;++f)c[f]in i||(r.push(c[f]),i[c[f]]=!0);else c in i||(r.push(c),i[c]=!0)}}}}return r},e.prototype.updateElement_=function(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}var i=this.collectSourceAttributions_(t),r=i.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!ne(i,this.renderedAttributions_)){sn(this.ulElement_);for(var o=0,s=i.length;o<s;++o){var h=document.createElement("li");h.innerHTML=i[o],this.ulElement_.appendChild(h)}this.renderedAttributions_=i}},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_()},e.prototype.handleToggle_=function(){this.element.classList.toggle(Ui),this.collapsed_?Gi(this.collapseLabel_,this.label_):Gi(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){!this.collapsible_||this.collapsed_===t||this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e}(mi);function Ia(a){this.updateElement_(a.frameState)}const La=Ra;var Sa=function(a){function e(n){var t=n||{};a.call(this,{element:document.createElement("div"),render:t.render||wa,target:t.target});var i=t.className!==void 0?t.className:"ol-rotate",r=t.label!==void 0?t.label:"⇧";this.label_=null,typeof r=="string"?(this.label_=document.createElement("span"),this.label_.className="ol-compass",this.label_.textContent=r):(this.label_=r,this.label_.classList.add("ol-compass"));var o=t.tipLabel?t.tipLabel:"Reset rotation",s=document.createElement("button");s.className=i+"-reset",s.setAttribute("type","button"),s.title=o,s.appendChild(this.label_),x(s,D.CLICK,this.handleClick_,this);var h=i+" "+$e+" "+Ei,l=this.element;l.className=h,l.appendChild(s),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Ce)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.handleClick_=function(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()},e.prototype.resetNorth_=function(){var t=this.getMap(),i=t.getView();i&&i.getRotation()!==void 0&&(this.duration_>0?i.animate({rotation:0,duration:this.duration_,easing:pt}):i.setRotation(0))},e}(mi);function wa(a){var e=a.frameState;if(e){var n=e.viewState.rotation;if(n!=this.rotation_){var t="rotate("+n+"rad)";if(this.autoHide_){var i=this.element.classList.contains(Ce);!i&&n===0?this.element.classList.add(Ce):i&&n!==0&&this.element.classList.remove(Ce)}this.label_.style.msTransform=t,this.label_.style.webkitTransform=t,this.label_.style.transform=t}this.rotation_=n}}const Oa=Sa;var Aa=function(a){function e(n){var t=n||{};a.call(this,{element:document.createElement("div"),target:t.target});var i=t.className!==void 0?t.className:"ol-zoom",r=t.delta!==void 0?t.delta:1,o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",s=t.zoomOutLabel!==void 0?t.zoomOutLabel:"−",h=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",l=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=i+"-in",u.setAttribute("type","button"),u.title=h,u.appendChild(typeof o=="string"?document.createTextNode(o):o),x(u,D.CLICK,this.handleClick_.bind(this,r));var d=document.createElement("button");d.className=i+"-out",d.setAttribute("type","button"),d.title=l,d.appendChild(typeof s=="string"?document.createTextNode(s):s),x(d,D.CLICK,this.handleClick_.bind(this,-r));var p=i+" "+$e+" "+Ei,c=this.element;c.className=p,c.appendChild(u),c.appendChild(d),this.duration_=t.duration!==void 0?t.duration:250}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.handleClick_=function(t,i){i.preventDefault(),this.zoomByDelta_(t)},e.prototype.zoomByDelta_=function(t){var i=this.getMap(),r=i.getView();if(r){var o=r.getResolution();if(o){var s=r.constrainResolution(o,t);this.duration_>0?(r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:s,duration:this.duration_,easing:pt})):r.setResolution(s)}}},e}(mi);const xa=Aa;function Da(a){var e=a||{},n=new lt,t=e.zoom!==void 0?e.zoom:!0;t&&n.push(new xa(e.zoomOptions));var i=e.rotate!==void 0?e.rotate:!0;i&&n.push(new Oa(e.rotateOptions));var r=e.attribution!==void 0?e.attribution:!0;return r&&n.push(new La(e.attributionOptions)),n}var Vt=function(e,n,t){this.decay_=e,this.minVelocity_=n,this.delay_=t,this.points_=[],this.angle_=0,this.initialVelocity_=0};Vt.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0};Vt.prototype.update=function(e,n){this.points_.push(e,n,Date.now())};Vt.prototype.end=function(){if(this.points_.length<6)return!1;var e=Date.now()-this.delay_,n=this.points_.length-3;if(this.points_[n+2]<e)return!1;for(var t=n-3;t>0&&this.points_[t+2]>e;)t-=3;var i=this.points_[n+2]-this.points_[t+2];if(i<1e3/60)return!1;var r=this.points_[n]-this.points_[t],o=this.points_[n+1]-this.points_[t+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/i,this.initialVelocity_>this.minVelocity_};Vt.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_};Vt.prototype.getAngle=function(){return this.angle_};const Yi={ACTIVE:"active"};var Pa=function(a){function e(n){a.call(this),n.handleEvent&&(this.handleEvent=n.handleEvent),this.map_=null,this.setActive(!0)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.getActive=function(){return this.get(Yi.ACTIVE)},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(Yi.ACTIVE,t)},e.prototype.setMap=function(t){this.map_=t},e}(Xe);function ba(a,e,n){var t=a.getCenter();if(t){var i=a.constrainCenter([t[0]+e[0],t[1]+e[1]]);n?a.animate({duration:n,easing:tn,center:i}):a.setCenter(i)}}function ur(a,e,n,t){e=a.constrainRotation(e,0),Ti(a,e,n,t)}function Ti(a,e,n,t){if(e!==void 0){var i=a.getRotation(),r=a.getCenter();i!==void 0&&r&&t>0?a.animate({rotation:e,anchor:n,duration:t,easing:pt}):a.rotate(e,n)}}function Ma(a,e,n,t,i){e=a.constrainResolution(e,0,i),Ri(a,e,n,t)}function Ci(a,e,n,t){var i=a.getResolution(),r=a.constrainResolution(i,e,0);if(r!==void 0){var o=a.getResolutions();r=Zi(r,a.getMinResolution()||o[o.length-1],a.getMaxResolution()||o[0])}if(n&&r!==void 0&&r!==i){var s=a.getCenter(),h=a.calculateCenterZoom(r,n);h=a.constrainCenter(h),n=[(r*s[0]-i*h[0])/(r-i),(r*s[1]-i*h[1])/(r-i)]}Ri(a,r,n,t)}function Ri(a,e,n,t){if(e){var i=a.getResolution(),r=a.getCenter();if(i!==void 0&&r&&e!==i&&t)a.animate({resolution:e,anchor:n,duration:t,easing:pt});else{if(n){var o=a.calculateCenterZoom(e,n);a.setCenter(o)}a.setResolution(e)}}}const se=Pa;var Fa=function(a){function e(n){a.call(this,{handleEvent:Na});var t=n||{};this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(se);function Na(a){var e=!1;if(a.type==K.DBLCLICK){var n=a.originalEvent,t=a.map,i=a.coordinate,r=n.shiftKey?-this.delta_:this.delta_,o=t.getView();Ci(o,r,i,this.duration_),a.preventDefault(),e=!0}return!e}const ka=Fa;var Ga=function(a){var e=a.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Hi=function(a){return a.target.getTargetElement()===document.activeElement},dr=Ft,pr=function(a){var e=a.originalEvent;return e.button==0&&!(In&&Ln&&e.ctrlKey)},cr=function(a){var e=a.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Ka=function(a){var e=a.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},fr=function(a){var e=a.originalEvent.target,n=e.tagName;return n!=="INPUT"&&n!=="SELECT"&&n!=="TEXTAREA"},Nt=function(a){var e=a.pointerEvent;return Mt(e!==void 0,56),e.pointerType=="mouse"},Wa=function(a){function e(n){var t=n||{};a.call(this,t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.handleDownEvent=function(t){return!1},e.prototype.handleDragEvent=function(t){},e.prototype.handleEvent=function(t){if(!t.pointerEvent)return!0;var i=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==K.POINTERDRAG)this.handleDragEvent(t);else if(t.type==K.POINTERUP){var r=this.handleUpEvent(t);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(t.type==K.POINTERDOWN){var o=this.handleDownEvent(t);o&&t.preventDefault(),this.handlingDownUpSequence=o,i=this.stopDown(o)}else t.type==K.POINTERMOVE&&this.handleMoveEvent(t);return!i},e.prototype.handleMoveEvent=function(t){},e.prototype.handleUpEvent=function(t){return!1},e.prototype.stopDown=function(t){return t},e.prototype.updateTrackedPointers_=function(t){if(Va(t)){var i=t.pointerEvent,r=i.pointerId.toString();t.type==K.POINTERUP?delete this.trackedPointers_[r]:t.type==K.POINTERDOWN?this.trackedPointers_[r]=i:r in this.trackedPointers_&&(this.trackedPointers_[r]=i),this.targetPointers=qr(this.trackedPointers_)}},e}(se);function Ii(a){for(var e=a.length,n=0,t=0,i=0;i<e;i++)n+=a[i].clientX,t+=a[i].clientY;return[n/e,t/e]}function Va(a){var e=a.type;return e===K.POINTERDOWN||e===K.POINTERDRAG||e===K.POINTERUP}const he=Wa;var Ua=function(a){function e(n){a.call(this,{stopDown:Be});var t=n||{};this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1,this.condition_=t.condition?t.condition:cr,this.noKinetic_=!1}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().setHint(U.INTERACTING,1));var i=this.targetPointers,r=Ii(i);if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){var o=this.lastCentroid[0]-r[0],s=r[1]-this.lastCentroid[1],h=t.map,l=h.getView(),u=[o,s];er(u,l.getResolution()),ir(u,l.getRotation()),dn(u,l.getCenter()),u=l.constrainCenter(u),l.setCenter(u)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length},e.prototype.handleUpEvent=function(t){var i=t.map,r=i.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var o=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),h=r.getCenter(),l=i.getPixelFromCoordinate(h),u=i.getCoordinateFromPixel([l[0]-o*Math.cos(s),l[1]-o*Math.sin(s)]);r.animate({center:r.constrainCenter(u),duration:500,easing:pt})}return this.panning_&&(this.panning_=!1,r.setHint(U.INTERACTING,-1)),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var i=t.map,r=i.getView();return this.lastCentroid=null,r.getAnimating()&&r.setCenter(t.frameState.viewState.center),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1},e}(he);const Ya=Ua;var Ha=function(a){function e(n){var t=n||{};a.call(this,{stopDown:Be}),this.condition_=t.condition?t.condition:Ga,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){if(Nt(t)){var i=t.map,r=i.getView();if(r.getConstraints().rotation!==rr){var o=i.getSize(),s=t.pixel,h=Math.atan2(o[1]/2-s[1],s[0]-o[0]/2);if(this.lastAngle_!==void 0){var l=h-this.lastAngle_,u=r.getRotation();Ti(r,u-l)}this.lastAngle_=h}}},e.prototype.handleUpEvent=function(t){if(!Nt(t))return!0;var i=t.map,r=i.getView();r.setHint(U.INTERACTING,-1);var o=r.getRotation();return ur(r,o,void 0,this.duration_),!1},e.prototype.handleDownEvent=function(t){if(!Nt(t))return!1;if(pr(t)&&this.condition_(t)){var i=t.map;return i.getView().setHint(U.INTERACTING,1),this.lastAngle_=void 0,!0}else return!1},e}(he),za=function(a){function e(n){a.call(this),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.className="ol-box "+n,this.map_=null,this.startPixel_=null,this.endPixel_=null}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.setMap(null)},e.prototype.render_=function(){var t=this.startPixel_,i=this.endPixel_,r="px",o=this.element_.style;o.left=Math.min(t[0],i[0])+r,o.top=Math.min(t[1],i[1])+r,o.width=Math.abs(i[0]-t[0])+r,o.height=Math.abs(i[1]-t[1])+r},e.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var i=this.element_.style;i.left=i.top=i.width=i.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},e.prototype.setPixels=function(t,i){this.startPixel_=t,this.endPixel_=i,this.createOrUpdateGeometry(),this.render_()},e.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,i=this.endPixel_,r=[t,[t[0],i[1]],i,[i[0],t[1]]],o=r.map(this.map_.getCoordinateFromPixel,this.map_);o[4]=o[0].slice(),this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new pn([o])},e.prototype.getGeometry=function(){return this.geometry_},e}(Qi);const Xa=za;var ri={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"},ni=function(a){function e(n,t,i){a.call(this,n),this.coordinate=t,this.mapBrowserEvent=i}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(oe),Ba=function(a){function e(n){a.call(this);var t=n||{};this.box_=new Xa(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,this.onBoxEnd_=t.onBoxEnd?t.onBoxEnd:li,this.startPixel_=null,this.condition_=t.condition?t.condition:dr,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.defaultBoxEndCondition=function(t,i,r){var o=r[0]-i[0],s=r[1]-i[1];return o*o+s*s>=this.minArea_},e.prototype.getGeometry=function(){return this.box_.getGeometry()},e.prototype.handleDragEvent=function(t){Nt(t)&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new ni(ri.BOXDRAG,t.coordinate,t)))},e.prototype.handleUpEvent=function(t){return Nt(t)?(this.box_.setMap(null),this.boxEndCondition_(t,this.startPixel_,t.pixel)&&(this.onBoxEnd_(t),this.dispatchEvent(new ni(ri.BOXEND,t.coordinate,t))),!1):!0},e.prototype.handleDownEvent=function(t){return Nt(t)&&pr(t)&&this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ni(ri.BOXSTART,t.coordinate,t)),!0):!1},e}(he);const Za=Ba;var $a=function(a){function e(n){var t=n||{},i=t.condition?t.condition:Ka;a.call(this,{condition:i,className:t.className||"ol-dragzoom",onBoxEnd:ja}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(Za);function ja(){var a=this.getMap(),e=a.getView(),n=a.getSize(),t=this.getGeometry().getExtent();if(this.out_){var i=e.calculateExtent(n),r=Gr([a.getPixelFromCoordinate(ji(t)),a.getPixelFromCoordinate(qi(t))]),o=e.getResolutionForExtent(r,n);Kr(i,1/o),t=i}var s=e.constrainResolution(e.getResolutionForExtent(t,n)),h=Wr(t);h=e.constrainCenter(h),e.animate({resolution:s,center:h,duration:this.duration_,easing:pt})}const qa=$a,Lt={LEFT:37,UP:38,RIGHT:39,DOWN:40};var Ja=function(a){function e(n){a.call(this,{handleEvent:Qa});var t=n||{};this.defaultCondition_=function(i){return cr(i)&&fr(i)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(se);function Qa(a){var e=!1;if(a.type==D.KEYDOWN){var n=a.originalEvent,t=n.keyCode;if(this.condition_(a)&&(t==Lt.DOWN||t==Lt.LEFT||t==Lt.RIGHT||t==Lt.UP)){var i=a.map,r=i.getView(),o=r.getResolution()*this.pixelDelta_,s=0,h=0;t==Lt.DOWN?h=-o:t==Lt.LEFT?s=-o:t==Lt.RIGHT?s=o:h=o;var l=[s,h];ir(l,r.getRotation()),ba(r,l,this.duration_),a.preventDefault(),e=!0}}return!e}var to=function(a){function e(n){a.call(this,{handleEvent:eo});var t=n||{};this.condition_=t.condition?t.condition:fr,this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(se);function eo(a){var e=!1;if(a.type==D.KEYDOWN||a.type==D.KEYPRESS){var n=a.originalEvent,t=n.charCode;if(this.condition_(a)&&(t==43||t==45)){var i=a.map,r=t==43?this.delta_:-this.delta_,o=i.getView();Ci(o,r,void 0,this.duration_),a.preventDefault(),e=!0}}return!e}const io=to;var ro=1,ai={TRACKPAD:"trackpad",WHEEL:"wheel"},no=function(a){function e(n){var t=n||{};a.call(this,t),this.delta_=0,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution||!1,this.condition_=t.condition?t.condition:dr,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.trackpadDeltaPerZoom_=300,this.trackpadZoomBuffer_=1.5}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0;var t=this.getMap().getView();t.setHint(U.INTERACTING,-1)},e.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;var i=t.type;if(i!==D.WHEEL&&i!==D.MOUSEWHEEL)return!0;t.preventDefault();var r=t.map,o=t.originalEvent;this.useAnchor_&&(this.lastAnchor_=t.coordinate);var s;if(t.type==D.WHEEL?(s=o.deltaY,Cn&&o.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=xe),o.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)):t.type==D.MOUSEWHEEL&&(s=-o.wheelDeltaY,Rn&&(s/=3)),s===0)return!1;var h=Date.now();if(this.startTime_===void 0&&(this.startTime_=h),(!this.mode_||h-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?ai.TRACKPAD:ai.WHEEL),this.mode_===ai.TRACKPAD){var l=r.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):l.setHint(U.INTERACTING,1),this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var u=l.getResolution()*Math.pow(2,s/this.trackpadDeltaPerZoom_),d=l.getMinResolution(),p=l.getMaxResolution(),c=0;if(u<d?(u=Math.max(u,d/this.trackpadZoomBuffer_),c=1):u>p&&(u=Math.min(u,p*this.trackpadZoomBuffer_),c=-1),this.lastAnchor_){var f=l.calculateCenterZoom(u,this.lastAnchor_);l.setCenter(l.constrainCenter(f))}return l.setResolution(u),c===0&&this.constrainResolution_&&l.animate({resolution:l.constrainResolution(u,s>0?-1:1),easing:pt,anchor:this.lastAnchor_,duration:this.duration_}),c>0?l.animate({resolution:d,easing:pt,anchor:this.lastAnchor_,duration:500}):c<0&&l.animate({resolution:p,easing:pt,anchor:this.lastAnchor_,duration:500}),this.startTime_=h,!1}this.delta_+=s;var v=Math.max(this.timeout_-(h-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),v),!1},e.prototype.handleWheelZoom_=function(t){var i=t.getView();i.getAnimating()&&i.cancelAnimations();var r=ro,o=Zi(this.delta_,-r,r);Ci(i,-o,this.lastAnchor_,this.duration_),this.mode_=void 0,this.delta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},e.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},e}(se);const ao=no;var oo=function(a){function e(n){var t=n||{},i=t;i.stopDown||(i.stopDown=Be),a.call(this,i),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){var i=0,r=this.targetPointers[0],o=this.targetPointers[1],s=Math.atan2(o.clientY-r.clientY,o.clientX-r.clientX);if(this.lastAngle_!==void 0){var h=s-this.lastAngle_;this.rotationDelta_+=h,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),i=h}this.lastAngle_=s;var l=t.map,u=l.getView();if(u.getConstraints().rotation!==rr){var d=l.getViewport().getBoundingClientRect(),p=Ii(this.targetPointers);if(p[0]-=d.left,p[1]-=d.top,this.anchor_=l.getCoordinateFromPixel(p),this.rotating_){var c=u.getRotation();l.render(),Ti(u,c+i,this.anchor_)}}},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var i=t.map,r=i.getView();if(r.setHint(U.INTERACTING,-1),this.rotating_){var o=r.getRotation();ur(r,o,this.anchor_,this.duration_)}return!1}else return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var i=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||i.getView().setHint(U.INTERACTING,1),!0}else return!1},e}(he),so=function(a){function e(n){var t=n||{},i=t;i.stopDown||(i.stopDown=Be),a.call(this,i),this.constrainResolution_=t.constrainResolution||!1,this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){var i=1,r=this.targetPointers[0],o=this.targetPointers[1],s=r.clientX-o.clientX,h=r.clientY-o.clientY,l=Math.sqrt(s*s+h*h);this.lastDistance_!==void 0&&(i=this.lastDistance_/l),this.lastDistance_=l;var u=t.map,d=u.getView(),p=d.getResolution(),c=d.getMaxResolution(),f=d.getMinResolution(),v=p*i;v>c?(i=c/p,v=c):v<f&&(i=f/p,v=f),i!=1&&(this.lastScaleDelta_=i);var g=u.getViewport().getBoundingClientRect(),_=Ii(this.targetPointers);_[0]-=g.left,_[1]-=g.top,this.anchor_=u.getCoordinateFromPixel(_),u.render(),Ri(d,v,this.anchor_)},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var i=t.map,r=i.getView();r.setHint(U.INTERACTING,-1);var o=r.getResolution();if(this.constrainResolution_||o<r.getMinResolution()||o>r.getMaxResolution()){var s=this.lastScaleDelta_-1;Ma(r,o,this.anchor_,this.duration_,s)}return!1}else return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var i=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||i.getView().setHint(U.INTERACTING,1),!0}else return!1},e}(he);const ho=so;function lo(a,e,n,t){for(var i=a[e],r=a[e+1],o=0,s=e+t;s<n;s+=t){var h=a[s],l=a[s+1];o+=Math.sqrt((h-i)*(h-i)+(l-r)*(l-r)),i=h,r=l}return o}const uo={IMAGE:"image",VECTOR:"vector"};function Re(a){return typeof a=="string"?a:vr(a)}function vr(a){var e=a[0];e!=(e|0)&&(e=e+.5|0);var n=a[1];n!=(n|0)&&(n=n+.5|0);var t=a[2];t!=(t|0)&&(t=t+.5|0);var i=a[3]===void 0?1:a[3];return"rgba("+e+","+n+","+t+","+i+")"}function _t(a){return Array.isArray(a)?vr(a):a}const B={IDLE:0,LOADING:1,LOADED:2,ERROR:3};var _r="10px sans-serif",Ot=[0,0,0,1],be="round",Me=[],Fe=0,Ne="round",ke=10,Ge=[0,0,0,1],ie="center",gr="middle",kt=[0,0,0,0],Ke=1,ut=new hn,po={},Ie=null,yr={},co=function(){var a=60,e=po,n="32px ",t=["monospace","serif"],i=t.length,r="wmytzilWMYTZIL@#/&?$%10",o,s;function h(u){for(var d=mr(),p=100;p<=700;p+=300){for(var c=p+" ",f=!0,v=0;v<i;++v){var g=t[v];if(d.font=c+n+g,s=d.measureText(r).width,u!=g){d.font=c+n+u+","+g;var _=d.measureText(r).width;f=f&&_!=s}}if(f)return!0}return!1}function l(){var u=!0;for(var d in e)e[d]<a&&(h(d)?(e[d]=a,_i(yr),Ie=null,ut.clear()):(++e[d],u=!1));u&&(clearInterval(o),o=void 0)}return function(u){var d=Ca(u);if(d)for(var p=0,c=d.length;p<c;++p){var f=d[p];f in e||(e[f]=a,h(f)||(e[f]=0,o===void 0&&(o=setInterval(l,32))))}}}();function mr(){return Ie||(Ie=mt(1,1)),Ie}var fo=function(){var a,e=yr;return function(n){var t=e[n];return t==null&&(a||(a=document.createElement("span"),a.textContent="M",a.style.margin=a.style.padding="0 !important",a.style.position="absolute !important",a.style.left="-99999px !important"),a.style.font=n,document.body.appendChild(a),t=e[n]=a.offsetHeight,document.body.removeChild(a)),t}}();function pi(a,e){var n=mr();return a!=n.font&&(n.font=a),n.measureText(e).width}function dt(a,e,n,t){e!==0&&(a.translate(n,t),a.rotate(e),a.translate(-n,-t))}var Er=tt();function zi(a,e,n,t,i,r,o,s,h,l,u){var d;n!=1&&(d=a.globalAlpha,a.globalAlpha=d*n),e&&a.setTransform.apply(a,e),a.drawImage(t,i,r,o,s,h,l,o*u,s*u),d&&(a.globalAlpha=d),e&&a.setTransform.apply(a,Er)}function vo(a){var e=a||{},n=new lt,t=new Vt(-.005,.05,100),i=e.altShiftDragRotate!==void 0?e.altShiftDragRotate:!0;i&&n.push(new Ha);var r=e.doubleClickZoom!==void 0?e.doubleClickZoom:!0;r&&n.push(new ka({delta:e.zoomDelta,duration:e.zoomDuration}));var o=e.dragPan!==void 0?e.dragPan:!0;o&&n.push(new Ya({condition:e.onFocusOnly?Hi:void 0,kinetic:t}));var s=e.pinchRotate!==void 0?e.pinchRotate:!0;s&&n.push(new oo);var h=e.pinchZoom!==void 0?e.pinchZoom:!0;h&&n.push(new ho({constrainResolution:e.constrainResolution,duration:e.zoomDuration}));var l=e.keyboard!==void 0?e.keyboard:!0;l&&(n.push(new Ja),n.push(new io({delta:e.zoomDelta,duration:e.zoomDuration})));var u=e.mouseWheelZoom!==void 0?e.mouseWheelZoom:!0;u&&n.push(new ao({condition:e.onFocusOnly?Hi:void 0,constrainResolution:e.constrainResolution,duration:e.zoomDuration}));var d=e.shiftDragZoom!==void 0?e.shiftDragZoom:!0;return d&&n.push(new qa({duration:e.zoomDuration})),n}var _o=function(a){function e(n,t,i,r){a.call(this),this.extent=n,this.pixelRatio_=i,this.resolution=t,this.state=r}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.changed=function(){this.dispatchEvent(D.CHANGE)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return rt()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){rt()},e}(vi);const go=_o;var yo=function(a){function e(n,t,i,r,o){var s=o!==void 0?B.IDLE:B.LOADED;a.call(this,n,t,i,s),this.loader_=o!==void 0?o:null,this.canvas_=r,this.error_=null}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.getError=function(){return this.error_},e.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=B.ERROR):this.state=B.LOADED,this.changed()},e.prototype.load=function(){this.state==B.IDLE&&(this.state=B.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},e.prototype.getImage=function(){return this.canvas_},e}(go);const mo=yo;var Tr=function(a){function e(n,t,i,r,o){a.call(this,n),this.vectorContext=t,this.frameState=i,this.context=r,this.glContext=o}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e}(oe),z=function(){};z.prototype.drawCustom=function(e,n,t){};z.prototype.drawGeometry=function(e){};z.prototype.setStyle=function(e){};z.prototype.drawCircle=function(e,n){};z.prototype.drawFeature=function(e,n){};z.prototype.drawGeometryCollection=function(e,n){};z.prototype.drawLineString=function(e,n){};z.prototype.drawMultiLineString=function(e,n){};z.prototype.drawMultiPoint=function(e,n){};z.prototype.drawMultiPolygon=function(e,n){};z.prototype.drawPoint=function(e,n){};z.prototype.drawPolygon=function(e,n){};z.prototype.drawText=function(e,n){};z.prototype.setFillStrokeStyle=function(e,n){};z.prototype.setImageStyle=function(e,n){};z.prototype.setTextStyle=function(e,n){};const Cr=z;var Rr=function(a){function e(n,t,i,r,o){a.call(this),this.context_=n,this.pixelRatio_=t,this.extent_=i,this.transform_=r,this.viewRotation_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=0,this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=tt()}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.drawImages_=function(t,i,r,o){if(this.image_){var s=ee(t,i,r,2,this.transform_,this.pixelCoordinates_),h=this.context_,l=this.tmpLocalTransform_,u=h.globalAlpha;this.imageOpacity_!=1&&(h.globalAlpha=u*this.imageOpacity_);var d=this.imageRotation_;this.imageRotateWithView_&&(d+=this.viewRotation_);for(var p=0,c=s.length;p<c;p+=2){var f=s[p]-this.imageAnchorX_,v=s[p+1]-this.imageAnchorY_;if(d!==0||this.imageScale_!=1){var g=f+this.imageAnchorX_,_=v+this.imageAnchorY_;nt(l,g,_,this.imageScale_,this.imageScale_,d,-g,-_),h.setTransform.apply(h,l)}h.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,v,this.imageWidth_,this.imageHeight_)}(d!==0||this.imageScale_!=1)&&h.setTransform(1,0,0,1,0,0),this.imageOpacity_!=1&&(h.globalAlpha=u)}},e.prototype.drawText_=function(t,i,r,o){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var s=ee(t,i,r,o,this.transform_,this.pixelCoordinates_),h=this.context_,l=this.textRotation_;for(this.textRotateWithView_&&(l+=this.viewRotation_);i<r;i+=o){var u=s[i]+this.textOffsetX_,d=s[i+1]+this.textOffsetY_;if(l!==0||this.textScale_!=1){var p=nt(this.tmpLocalTransform_,u,d,this.textScale_,this.textScale_,l,-u,-d);h.setTransform.apply(h,p)}this.textStrokeState_&&h.strokeText(this.text_,u,d),this.textFillState_&&h.fillText(this.text_,u,d)}(l!==0||this.textScale_!=1)&&h.setTransform(1,0,0,1,0,0)}},e.prototype.moveToLineTo_=function(t,i,r,o,s){var h=this.context_,l=ee(t,i,r,o,this.transform_,this.pixelCoordinates_);h.moveTo(l[0],l[1]);var u=l.length;s&&(u-=2);for(var d=2;d<u;d+=2)h.lineTo(l[d],l[d+1]);return s&&h.closePath(),r},e.prototype.drawRings_=function(t,i,r,o){for(var s=0,h=r.length;s<h;++s)i=this.moveToLineTo_(t,i,r[s],o,!0);return i},e.prototype.drawCircle=function(t){if(ht(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i=cn(t,this.transform_,this.pixelCoordinates_),r=i[2]-i[0],o=i[3]-i[1],s=Math.sqrt(r*r+o*o),h=this.context_;h.beginPath(),h.arc(i[0],i[1],s,0,2*Math.PI),this.fillState_&&h.fill(),this.strokeState_&&h.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.drawGeometry=function(t){var i=t.getType();switch(i){case G.POINT:this.drawPoint(t);break;case G.LINE_STRING:this.drawLineString(t);break;case G.POLYGON:this.drawPolygon(t);break;case G.MULTI_POINT:this.drawMultiPoint(t);break;case G.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case G.MULTI_POLYGON:this.drawMultiPolygon(t);break;case G.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case G.CIRCLE:this.drawCircle(t);break}},e.prototype.drawFeature=function(t,i){var r=i.getGeometryFunction()(t);!r||!ht(this.extent_,r.getExtent())||(this.setStyle(i),this.drawGeometry(r))},e.prototype.drawGeometryCollection=function(t){for(var i=t.getGeometriesArray(),r=0,o=i.length;r<o;++r)this.drawGeometry(i[r])},e.prototype.drawPoint=function(t){var i=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(i,0,i.length,r),this.text_!==""&&this.drawText_(i,0,i.length,r)},e.prototype.drawMultiPoint=function(t){var i=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(i,0,i.length,r),this.text_!==""&&this.drawText_(i,0,i.length,r)},e.prototype.drawLineString=function(t){if(ht(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,r=t.getFlatCoordinates();i.beginPath(),this.moveToLineTo_(r,0,r.length,t.getStride(),!1),i.stroke()}if(this.text_!==""){var o=t.getFlatMidpoint();this.drawText_(o,0,2,2)}}},e.prototype.drawMultiLineString=function(t){var i=t.getExtent();if(ht(this.extent_,i)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var r=this.context_,o=t.getFlatCoordinates(),s=0,h=t.getEnds(),l=t.getStride();r.beginPath();for(var u=0,d=h.length;u<d;++u)s=this.moveToLineTo_(o,s,h[u],l,!1);r.stroke()}if(this.text_!==""){var p=t.getFlatMidpoints();this.drawText_(p,0,p.length,2)}}},e.prototype.drawPolygon=function(t){if(ht(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i=this.context_;i.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){var r=t.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(ht(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i=this.context_,r=t.getOrientedFlatCoordinates(),o=0,s=t.getEndss(),h=t.getStride();i.beginPath();for(var l=0,u=s.length;l<u;++l){var d=s[l];o=this.drawRings_(r,o,d,h)}this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){var p=t.getFlatInteriorPoints();this.drawText_(p,0,p.length,2)}}},e.prototype.setContextFillState_=function(t){var i=this.context_,r=this.contextFillState_;r?r.fillStyle!=t.fillStyle&&(r.fillStyle=i.fillStyle=t.fillStyle):(i.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var i=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=t.lineCap&&(r.lineCap=i.lineCap=t.lineCap),De&&(ne(r.lineDash,t.lineDash)||i.setLineDash(r.lineDash=t.lineDash),r.lineDashOffset!=t.lineDashOffset&&(r.lineDashOffset=i.lineDashOffset=t.lineDashOffset)),r.lineJoin!=t.lineJoin&&(r.lineJoin=i.lineJoin=t.lineJoin),r.lineWidth!=t.lineWidth&&(r.lineWidth=i.lineWidth=t.lineWidth),r.miterLimit!=t.miterLimit&&(r.miterLimit=i.miterLimit=t.miterLimit),r.strokeStyle!=t.strokeStyle&&(r.strokeStyle=i.strokeStyle=t.strokeStyle)):(i.lineCap=t.lineCap,De&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineJoin=t.lineJoin,i.lineWidth=t.lineWidth,i.miterLimit=t.miterLimit,i.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var i=this.context_,r=this.contextTextState_,o=t.textAlign?t.textAlign:ie;r?(r.font!=t.font&&(r.font=i.font=t.font),r.textAlign!=o&&(r.textAlign=i.textAlign=o),r.textBaseline!=t.textBaseline&&(r.textBaseline=i.textBaseline=t.textBaseline)):(i.font=t.font,i.textAlign=o,i.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:o,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,i){if(!t)this.fillState_=null;else{var r=t.getColor();this.fillState_={fillStyle:_t(r||Ot)}}if(!i)this.strokeState_=null;else{var o=i.getColor(),s=i.getLineCap(),h=i.getLineDash(),l=i.getLineDashOffset(),u=i.getLineJoin(),d=i.getWidth(),p=i.getMiterLimit();this.strokeState_={lineCap:s!==void 0?s:be,lineDash:h||Me,lineDashOffset:l||Fe,lineJoin:u!==void 0?u:Ne,lineWidth:this.pixelRatio_*(d!==void 0?d:Ke),miterLimit:p!==void 0?p:ke,strokeStyle:_t(o||Ge)}}},e.prototype.setImageStyle=function(t){if(!t)this.image_=null;else{var i=t.getAnchor(),r=t.getImage(1),o=t.getOrigin(),s=t.getSize();this.imageAnchorX_=i[0],this.imageAnchorY_=i[1],this.imageHeight_=s[1],this.image_=r,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScale()*this.pixelRatio_,this.imageWidth_=s[0]}},e.prototype.setTextStyle=function(t){if(!t)this.text_="";else{var i=t.getFill();if(!i)this.textFillState_=null;else{var r=i.getColor();this.textFillState_={fillStyle:_t(r||Ot)}}var o=t.getStroke();if(!o)this.textStrokeState_=null;else{var s=o.getColor(),h=o.getLineCap(),l=o.getLineDash(),u=o.getLineDashOffset(),d=o.getLineJoin(),p=o.getWidth(),c=o.getMiterLimit();this.textStrokeState_={lineCap:h!==void 0?h:be,lineDash:l||Me,lineDashOffset:u||Fe,lineJoin:d!==void 0?d:Ne,lineWidth:p!==void 0?p:Ke,miterLimit:c!==void 0?c:ke,strokeStyle:_t(s||Ge)}}var f=t.getFont(),v=t.getOffsetX(),g=t.getOffsetY(),_=t.getRotateWithView(),y=t.getRotation(),m=t.getScale(),T=t.getText(),E=t.getTextAlign(),C=t.getTextBaseline();this.textState_={font:f!==void 0?f:_r,textAlign:E!==void 0?E:ie,textBaseline:C!==void 0?C:gr},this.text_=T!==void 0?T:"",this.textOffsetX_=v!==void 0?this.pixelRatio_*v:0,this.textOffsetY_=g!==void 0?this.pixelRatio_*g:0,this.textRotateWithView_=_!==void 0?_:!1,this.textRotation_=y!==void 0?y:0,this.textScale_=this.pixelRatio_*(m!==void 0?m:1)}},e}(Cr),Ut=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32};Ut.prototype.clear=function(){this.cache_={},this.cacheSize_=0};Ut.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var e=0;for(var n in this.cache_){var t=this.cache_[n];!(e++&3)&&!t.hasListener()&&(delete this.cache_[n],--this.cacheSize_)}}};Ut.prototype.get=function(e,n,t){var i=Ir(e,n,t);return i in this.cache_?this.cache_[i]:null};Ut.prototype.set=function(e,n,t,i){var r=Ir(e,n,t);this.cache_[r]=i,++this.cacheSize_};Ut.prototype.setSize=function(e){this.maxCacheSize_=e,this.expire()};function Ir(a,e,n){var t=n?Re(n):"null";return e+":"+a+":"+t}var Eo=new Ut,To=function(a){function e(n){a.call(this),this.map_=n,this.layerRenderers_={},this.layerRendererListeners_={},this.layerRendererConstructors_=[]}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.dispatchRenderEvent=function(t,i){rt()},e.prototype.registerLayerRenderers=function(t){this.layerRendererConstructors_.push.apply(this.layerRendererConstructors_,t)},e.prototype.calculateMatrices2D=function(t){var i=t.viewState,r=t.coordinateToPixelTransform,o=t.pixelToCoordinateTransform;nt(r,t.size[0]/2,t.size[1]/2,1/i.resolution,-1/i.resolution,-i.rotation,-i.center[0],-i.center[1]),fn(nr(o,r))},e.prototype.removeLayerRenderers=function(){for(var t in this.layerRenderers_)this.removeLayerRendererByKey_(t).dispose()},e.prototype.forEachFeatureAtCoordinate=function(t,i,r,o,s,h,l){var u,d=i.viewState,p=d.resolution;function c(F,O){var P=i.layerStates[Y(O)].managed;if(!(Y(F)in i.skippedFeatureUids&&!P))return o.call(s,F,P?O:null)}var f=d.projection,v=t;if(f.canWrapX()){var g=f.getExtent(),_=Qt(g),y=t[0];if(y<g[0]||y>g[2]){var m=Math.ceil((g[0]-y)/_);v=[y+_*m,t[1]]}}var T=i.layerStatesArray,E=T.length,C;for(C=E-1;C>=0;--C){var I=T[C],S=I.layer;if(Ae(I,p)&&h.call(l,S)){var w=this.getLayerRenderer(S),L=S.getSource();if(L&&(u=w.forEachFeatureAtCoordinate(L.getWrapX()?v:t,i,r,c)),u)return u}}},e.prototype.forEachLayerAtPixel=function(t,i,r,o,s,h,l){return rt()},e.prototype.hasFeatureAtCoordinate=function(t,i,r,o,s){var h=this.forEachFeatureAtCoordinate(t,i,r,Ft,this,o,s);return h!==void 0},e.prototype.getLayerRenderer=function(t){var i=Y(t);if(i in this.layerRenderers_)return this.layerRenderers_[i];for(var r,o=0,s=this.layerRendererConstructors_.length;o<s;++o){var h=this.layerRendererConstructors_[o];if(h.handles(t)){r=h.create(this,t);break}}if(r)this.layerRenderers_[i]=r,this.layerRendererListeners_[i]=x(r,D.CHANGE,this.handleLayerRendererChange_,this);else throw new Error("Unable to create renderer for layer: "+t.getType());return r},e.prototype.getLayerRendererByKey=function(t){return this.layerRenderers_[t]},e.prototype.getLayerRenderers=function(){return this.layerRenderers_},e.prototype.getMap=function(){return this.map_},e.prototype.handleLayerRendererChange_=function(){this.map_.render()},e.prototype.removeLayerRendererByKey_=function(t){var i=this.layerRenderers_[t];return delete this.layerRenderers_[t],Q(this.layerRendererListeners_[t]),delete this.layerRendererListeners_[t],i},e.prototype.removeUnusedLayerRenderers_=function(t,i){for(var r in this.layerRenderers_)(!i||!(r in i.layerStates))&&this.removeLayerRendererByKey_(r).dispose()},e.prototype.renderFrame=function(t){rt()},e.prototype.scheduleExpireIconCache=function(t){t.postRenderFunctions.push(Co)},e.prototype.scheduleRemoveUnusedLayerRenderers=function(t){for(var i in this.layerRenderers_)if(!(i in t.layerStates)){t.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this));return}},e}(Qi);function Co(a,e){Eo.expire()}function Ro(a,e){return a.zIndex-e.zIndex}const Io=To;var We=[],Lo=function(a){function e(n){a.call(this,n);var t=n.getViewport();this.context_=mt(),this.canvas_=this.context_.canvas,this.canvas_.style.width="100%",this.canvas_.style.height="100%",this.canvas_.style.display="block",this.canvas_.className=$e,t.insertBefore(this.canvas_,t.childNodes[0]||null),this.renderedVisible_=!0,this.transform_=tt()}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.dispatchRenderEvent=function(t,i){var r=this.getMap(),o=this.context_;if(r.hasListener(t)){var s=i.extent,h=i.pixelRatio,l=i.viewState,u=l.rotation,d=this.getTransform(i),p=new Rr(o,h,s,d,u),c=new Tr(t,p,i,o,null);r.dispatchEvent(c)}},e.prototype.getTransform=function(t){var i=t.viewState,r=this.canvas_.width/2,o=this.canvas_.height/2,s=t.pixelRatio/i.resolution,h=-s,l=-i.rotation,u=-i.center[0],d=-i.center[1];return nt(this.transform_,r,o,s,h,l,u,d)},e.prototype.renderFrame=function(t){if(!t){this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1);return}var i=this.context_,r=t.pixelRatio,o=Math.round(t.size[0]*r),s=Math.round(t.size[1]*r);this.canvas_.width!=o||this.canvas_.height!=s?(this.canvas_.width=o,this.canvas_.height=s):i.clearRect(0,0,o,s);var h=t.viewState.rotation;this.calculateMatrices2D(t),this.dispatchRenderEvent(yt.PRECOMPOSE,t);var l=t.layerStatesArray;en(l,Ro),h&&(i.save(),dt(i,h,o/2,s/2));var u=t.viewState.resolution,d,p;for(d=0,p=l.length;d<p;++d){var c=l[d],f=c.layer,v=this.getLayerRenderer(f);!Ae(c,u)||c.sourceState!=gi.READY||v.prepareFrame(t,c)&&v.composeFrame(t,c,i)}h&&i.restore(),this.dispatchRenderEvent(yt.POSTCOMPOSE,t),this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(t),this.scheduleExpireIconCache(t)},e.prototype.forEachLayerAtPixel=function(t,i,r,o,s,h,l){var u,d=i.viewState,p=d.resolution,c=i.layerStatesArray,f=c.length,v=J(i.pixelToCoordinateTransform,t.slice()),g;for(g=f-1;g>=0;--g){var _=c[g],y=_.layer;if(Ae(_,p)&&h.call(l,y)){var m=this.getLayerRenderer(y);if(u=m.forEachLayerAtCoordinate(v,i,r,o,s),u)return u}}},e.prototype.registerLayerRenderers=function(t){a.prototype.registerLayerRenderers.call(this,t);for(var i=0,r=t.length;i<r;++i){var o=t[i];rn(We,o)||We.push(o)}},e}(Io),So=function(a){function e(n){a.call(this),this.layer_=n}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.createLoadedTileFinder=function(t,i,r){return function(o,s){function h(l){r[o]||(r[o]={}),r[o][l.tileCoord.toString()]=l}return t.forEachLoadedTile(i,o,s,h)}},e.prototype.forEachFeatureAtCoordinate=function(t,i,r,o){},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleImageChange_=function(t){var i=t.target;i.getState()===B.LOADED&&this.renderIfReadyAndVisible()},e.prototype.hasFeatureAtCoordinate=function(t,i){return!1},e.prototype.loadImage=function(t){var i=t.getState();return i!=B.LOADED&&i!=B.ERROR&&x(t,D.CHANGE,this.handleImageChange_,this),i==B.IDLE&&(t.load(),i=t.getState()),i==B.LOADED},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==gi.READY&&this.changed()},e.prototype.scheduleExpireCache=function(t,i){if(i.canExpireCache()){var r=(function(o,s,h){var l=Y(o);l in h.usedTiles&&o.expireCache(h.viewState.projection,h.usedTiles[l])}).bind(null,i);t.postRenderFunctions.push(r)}},e.prototype.updateUsedTiles=function(t,i,r,o){var s=Y(i),h=r.toString();s in t?h in t[s]?t[s][h].extend(o):t[s][h]=o:(t[s]={},t[s][h]=o)},e.prototype.manageTilePyramid=function(t,i,r,o,s,h,l,u,d,p){var c=Y(i);c in t.wantedTiles||(t.wantedTiles[c]={});var f=t.wantedTiles[c],v=t.tileQueue,g=r.getMinZoom(),_,y,m,T,E,C;for(C=g;C<=l;++C)for(y=r.getTileRangeForExtentAndZ(h,C,y),m=r.getResolution(C),T=y.minX;T<=y.maxX;++T)for(E=y.minY;E<=y.maxY;++E)l-C<=u?(_=i.getTile(C,T,E,o,s),_.getState()==H.IDLE&&(f[_.getKey()]=!0,v.isKeyQueued(_.getKey())||v.enqueue([_,c,r.getTileCoordCenter(_.tileCoord),m])),d!==void 0&&d.call(p,_)):i.useTile(C,T,E,s)},e}(Jr);const wo=So;var Oo=function(a){function e(n){a.call(this,n),this.renderedResolution,this.transform_=tt()}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.clip=function(t,i,r){var o=i.pixelRatio,s=i.size[0]*o,h=i.size[1]*o,l=i.viewState.rotation,u=Ji(r),d=qi(r),p=Vr(r),c=ji(r);J(i.coordinateToPixelTransform,u),J(i.coordinateToPixelTransform,d),J(i.coordinateToPixelTransform,p),J(i.coordinateToPixelTransform,c),t.save(),dt(t,-l,s/2,h/2),t.beginPath(),t.moveTo(u[0]*o,u[1]*o),t.lineTo(d[0]*o,d[1]*o),t.lineTo(p[0]*o,p[1]*o),t.lineTo(c[0]*o,c[1]*o),t.clip(),dt(t,l,s/2,h/2)},e.prototype.dispatchComposeEvent_=function(t,i,r,o){var s=this.getLayer();if(s.hasListener(t)){var h=r.size[0]*r.pixelRatio,l=r.size[1]*r.pixelRatio,u=r.viewState.rotation;dt(i,-u,h/2,l/2);var d=o!==void 0?o:this.getTransform(r,0),p=new Rr(i,r.pixelRatio,r.extent,d,r.viewState.rotation),c=new Tr(t,p,r,i,null);s.dispatchEvent(c),dt(i,u,h/2,l/2)}},e.prototype.forEachLayerAtCoordinate=function(t,i,r,o,s){var h=this.forEachFeatureAtCoordinate(t,i,r,Ft);if(h)return o.call(s,this.getLayer(),null)},e.prototype.postCompose=function(t,i,r,o){this.dispatchComposeEvent_(yt.POSTCOMPOSE,t,i,o)},e.prototype.preCompose=function(t,i,r){this.dispatchComposeEvent_(yt.PRECOMPOSE,t,i,r)},e.prototype.dispatchRenderEvent=function(t,i,r){this.dispatchComposeEvent_(yt.RENDER,t,i,r)},e.prototype.getTransform=function(t,i){var r=t.viewState,o=t.pixelRatio,s=o*t.size[0]/2,h=o*t.size[1]/2,l=o/r.resolution,u=-l,d=-r.rotation,p=-r.center[0]+i,c=-r.center[1];return nt(this.transform_,s,h,l,u,d,p,c)},e.prototype.composeFrame=function(t,i,r){rt()},e.prototype.prepareFrame=function(t,i){return rt()},e}(wo);const Lr=Oo;var Ao=function(a){function e(n){a.call(this,n),this.coordinateToCanvasPixelTransform=tt(),this.hitCanvasContext_=null}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.composeFrame=function(t,i,r){this.preCompose(r,t);var o=this.getImage();if(o){var s=i.extent,h=s!==void 0&&!te(s,t.extent)&&ht(s,t.extent);h&&this.clip(r,t,s);var l=this.getImageTransform(),u=r.globalAlpha;r.globalAlpha=i.opacity;var d=l[4],p=l[5],c=o.width*l[0],f=o.height*l[3];c>=.5&&f>=.5&&r.drawImage(o,0,0,+o.width,+o.height,Math.round(d),Math.round(p),Math.round(c),Math.round(f)),r.globalAlpha=u,h&&r.restore()}this.postCompose(r,t,i)},e.prototype.getImage=function(){return rt()},e.prototype.getImageTransform=function(){return rt()},e.prototype.forEachLayerAtCoordinate=function(t,i,r,o,s){if(this.getImage()){var h=J(this.coordinateToCanvasPixelTransform,t.slice());er(h,i.viewState.resolution/this.renderedResolution),this.hitCanvasContext_||(this.hitCanvasContext_=mt(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.getImage(),h[0],h[1],1,1,0,0,1,1);var l=this.hitCanvasContext_.getImageData(0,0,1,1).data;if(l[3]>0)return o.call(s,this.getLayer(),l)}},e}(Lr);const Sr=Ao;var Ve=function(a){function e(n){if(a.call(this,n),this.image_=null,this.imageTransform_=tt(),this.skippedFeatures_=[],this.vectorRenderer_=null,n.getType()===Kt.VECTOR)for(var t=0,i=We.length;t<i;++t){var r=We[t];if(r!==e&&r.handles(n)){this.vectorRenderer_=new r(n);break}}}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.vectorRenderer_&&this.vectorRenderer_.dispose(),a.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.image_?this.image_.getImage():null},e.prototype.getImageTransform=function(){return this.imageTransform_},e.prototype.prepareFrame=function(t,i){var r=t.pixelRatio,o=t.size,s=t.viewState,h=s.center,l=s.resolution,u,d=this.getLayer(),p=d.getSource(),c=t.viewHints,f=this.vectorRenderer_,v=t.extent;if(!f&&i.extent!==void 0&&(v=ze(v,i.extent)),!c[U.ANIMATING]&&!c[U.INTERACTING]&&!fi(v)){var g=s.projection,_=this.skippedFeatures_;if(f){var y=f.context,m=Oe({},t,{size:[Qt(v)/l,Ur(v)/l],viewState:Oe({},t.viewState,{rotation:0})}),T=Object.keys(m.skippedFeatureUids).sort();u=new mo(v,l,r,y.canvas,function(L){f.prepareFrame(m,i)&&(f.replayGroupChanged||!ne(_,T))&&(y.canvas.width=m.size[0]*r,y.canvas.height=m.size[1]*r,f.compose(y,m,i),_=T,L())})}else u=p.getImage(v,l,r,g);u&&this.loadImage(u)&&(this.image_=u,this.skippedFeatures_=_)}if(this.image_){u=this.image_;var E=u.getExtent(),C=u.getResolution(),I=u.getPixelRatio(),S=r*C/(l*I),w=nt(this.imageTransform_,r*o[0]/2,r*o[1]/2,S,S,0,I*(E[0]-h[0])/C,I*(h[1]-E[3])/C);nt(this.coordinateToCanvasPixelTransform,r*o[0]/2-w[4],r*o[1]/2-w[5],r/l,-r/l,0,-h[0],-h[1]),this.renderedResolution=C*r/I}return!!this.image_},e.prototype.forEachFeatureAtCoordinate=function(t,i,r,o){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,i,r,o):a.prototype.forEachFeatureAtCoordinate.call(this,t,i,r,o)},e}(Sr);Ve.handles=function(a){return a.getType()===Kt.IMAGE||a.getType()===Kt.VECTOR&&a.getRenderMode()===uo.IMAGE};Ve.create=function(a,e){return new Ve(e)};const xo=Ve;var ae=function(a){function e(n,t){a.call(this,n),this.context=t?null:mt(),this.oversampling_,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Gt(),this.tmpTileRange_=new ln(0,0,0,0),this.imageTransform_=tt(),this.zDirection=0}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.isDrawableTile_=function(t){var i=this.getLayer(),r=t.getState(),o=i.getUseInterimTilesOnError();return r==H.LOADED||r==H.EMPTY||r==H.ERROR&&!o},e.prototype.getTile=function(t,i,r,o,s){var h=this.getLayer(),l=h.getSource(),u=l.getTile(t,i,r,o,s);return u.getState()==H.ERROR&&(h.getUseInterimTilesOnError()?h.getPreload()>0&&(this.newTiles_=!0):u.setState(H.LOADED)),this.isDrawableTile_(u)||(u=u.getInterimTile()),u},e.prototype.prepareFrame=function(t,i){var r=t.pixelRatio,o=t.size,s=t.viewState,h=s.projection,l=s.resolution,u=s.center,d=this.getLayer(),p=d.getSource(),c=p.getRevision(),f=p.getTileGridForProjection(h),v=f.getZForResolution(l,this.zDirection),g=f.getResolution(v),_=Math.round(l/g)||1,y=t.extent;if(i.extent!==void 0&&(y=ze(y,i.extent)),fi(y))return!1;var m=f.getTileRangeForExtentAndZ(y,v),T=f.getTileRangeExtent(v,m),E=p.getTilePixelRatio(r),C={};C[v]={};var I=this.createLoadedTileFinder(p,h,C),S=t.viewHints,w=S[U.ANIMATING]||S[U.INTERACTING],L=this.tmpExtent,F=this.tmpTileRange_;this.newTiles_=!1;var O,P,N;for(P=m.minX;P<=m.maxX;++P)for(N=m.minY;N<=m.maxY;++N)if(!(Date.now()-t.time>16&&w)){if(O=this.getTile(v,P,N,r,h),this.isDrawableTile_(O)){var k=Y(this);if(O.getState()==H.LOADED){C[v][O.tileCoord.toString()]=O;var M=O.inTransition(k);!this.newTiles_&&(M||this.renderedTiles.indexOf(O)===-1)&&(this.newTiles_=!0)}if(O.getAlpha(k,t.time)===1)continue}var W=f.getTileCoordChildTileRange(O.tileCoord,F,L),V=!1;W&&(V=I(v+1,W)),V||f.forEachTileCoordParentTileRange(O.tileCoord,I,null,F,L)}var R=g*r/E*_;if(!(this.renderedResolution&&Date.now()-t.time>16&&w)&&(this.newTiles_||!(this.renderedExtent_&&te(this.renderedExtent_,y))||this.renderedRevision!=c||_!=this.oversampling_||!w&&R!=this.renderedResolution)){var X=this.context;if(X){var q=p.getTilePixelSize(v,r,h),j=Math.round(m.getWidth()*q[0]/_),Yt=Math.round(m.getHeight()*q[1]/_),Dt=X.canvas;Dt.width!=j||Dt.height!=Yt?(this.oversampling_=_,Dt.width=j,Dt.height=Yt):((this.renderedExtent_&&!Se(T,this.renderedExtent_)||this.renderedRevision!=c)&&X.clearRect(0,0,j,Yt),_=this.oversampling_)}this.renderedTiles.length=0;var Pt=Object.keys(C).map(Number);Pt.sort(function(Ct,Rt){return Ct===v?1:Rt===v?-1:Ct>Rt?1:Ct<Rt?-1:0});var Ht,bt,zt,Et,Tt,ct,Xt,ue,Bt,de,pe;for(Tt=0,ct=Pt.length;Tt<ct;++Tt){Et=Pt[Tt],zt=p.getTilePixelSize(Et,r,h),Ht=f.getResolution(Et),bt=Ht/g,ue=E*p.getGutterForProjection(h),Bt=C[Et];for(var ce in Bt)O=Bt[ce],Xt=f.getTileCoordExtent(O.getTileCoord(),L),P=(Xt[0]-T[0])/g*E/_,N=(T[3]-Xt[3])/g*E/_,de=zt[0]*bt/_,pe=zt[1]*bt/_,this.drawTileImage(O,t,i,P,N,de,pe,ue,v===Et),this.renderedTiles.push(O)}this.renderedRevision=c,this.renderedResolution=g*r/E*_,this.renderedExtent_=T}var fe=this.renderedResolution/l,ve=nt(this.imageTransform_,r*o[0]/2,r*o[1]/2,fe,fe,0,(this.renderedExtent_[0]-u[0])/this.renderedResolution*r,(u[1]-this.renderedExtent_[3])/this.renderedResolution*r);return nt(this.coordinateToCanvasPixelTransform,r*o[0]/2-ve[4],r*o[1]/2-ve[5],r/l,-r/l,0,-u[0],-u[1]),this.updateUsedTiles(t.usedTiles,p,v,m),this.manageTilePyramid(t,p,f,r,h,y,v,d.getPreload()),this.scheduleExpireCache(t,p),this.renderedTiles.length>0},e.prototype.drawTileImage=function(t,i,r,o,s,h,l,u,d){var p=this.getTileImage(t);if(p){var c=Y(this),f=d?t.getAlpha(c,i.time):1,v=this.getLayer(),g=v.getSource();f===1&&!g.getOpaque(i.viewState.projection)&&this.context.clearRect(o,s,h,l);var _=f!==this.context.globalAlpha;_&&(this.context.save(),this.context.globalAlpha=f),this.context.drawImage(p,u,u,p.width-2*u,p.height-2*u,o,s,h,l),_&&this.context.restore(),f!==1?i.animate=!0:d&&t.endTransition(c)}},e.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},e.prototype.getImageTransform=function(){return this.imageTransform_},e.prototype.getTileImage=function(t){return t.getImage()},e}(Sr);ae.handles=function(a){return a.getType()===Kt.TILE};ae.create=function(a,e){return new ae(e)};ae.prototype.getLayer;const wr=ae;var je=function(){};je.prototype.getReplay=function(e,n){return rt()};je.prototype.isEmpty=function(){return rt()};je.prototype.addDeclutter=function(e){return rt()};const Do=je,b={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function Po(a,e,n,t,i,r,o,s){var h=[],l=a[e]>a[n-t],u=i.length,d=a[e],p=a[e+1];e+=t;for(var c=a[e],f=a[e+1],v=0,g=Math.sqrt(Math.pow(c-d,2)+Math.pow(f-p,2)),_="",y=0,m,T,E,C=0;C<u;++C){T=l?u-C-1:C;var I=i.charAt(T);_=l?I+_:_+I;var S=r(_)-y;y+=S;for(var w=o+S/2;e<n-t&&v+g<w;)d=c,p=f,e+=t,c=a[e],f=a[e+1],v+=g,g=Math.sqrt(Math.pow(c-d,2)+Math.pow(f-p,2));var L=w-v,F=Math.atan2(f-p,c-d);if(l&&(F+=F>0?-Math.PI:Math.PI),E!==void 0){var O=F-E;if(O+=O>Math.PI?-2*Math.PI:O<-Math.PI?2*Math.PI:0,Math.abs(O)>s)return null}var P=L/g,N=ki(d,c,P),k=ki(p,f,P);E==F?(l&&(m[0]=N,m[1]=k,m[2]=S/2),m[4]=_):(_=I,y=S,m=[N,k,S/2,F,_],l?h.unshift(m):h.push(m),E=F),o+=S}return h}var A={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},me=[A.FILL],gt=[A.STROKE],St=[A.BEGIN_PATH],Xi=[A.CLOSE_PATH],Le=[b.POLYGON,b.CIRCLE,b.LINE_STRING,b.IMAGE,b.TEXT,b.DEFAULT],Jt={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},at=Gt(),$t=tt(),bo=function(a){function e(n,t,i,r,o,s){a.call(this),this.declutterTree=s,this.tolerance=n,this.maxExtent=t,this.overlaps=o,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.alignFill_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=tt(),this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.replayTextBackground_=function(t,i,r,o,s,h,l){t.beginPath(),t.moveTo.apply(t,i),t.lineTo.apply(t,r),t.lineTo.apply(t,o),t.lineTo.apply(t,s),t.lineTo.apply(t,i),h&&(this.alignFill_=h[2],this.fill_(t)),l&&(this.setStrokeStyle_(t,l),t.stroke())},e.prototype.replayImage_=function(t,i,r,o,s,h,l,u,d,p,c,f,v,g,_,y,m,T){var E=m||T;s*=v,h*=v,i-=s,r-=h;var C=_+p>o.width?o.width-p:_,I=u+c>o.height?o.height-c:u,S=y[3]+C*v+y[1],w=y[0]+I*v+y[2],L=i-y[3],F=r-y[0],O,P,N,k;(E||f!==0)&&(O=[L,F],P=[L+S,F],N=[L+S,F+w],k=[L,F+w]);var M=null;if(f!==0){var W=i+s,V=r+h;M=nt($t,W,V,1,1,f,-W,-V),hi(at),jt(at,J($t,O)),jt(at,J($t,P)),jt(at,J($t,N)),jt(at,J($t,k))}else Yr(L,F,L+S,F+w,at);var R=t.canvas,X=T?T[2]*v/2:0,q=at[0]-X<=R.width&&at[2]+X>=0&&at[1]-X<=R.height&&at[3]+X>=0;if(g&&(i=Math.round(i),r=Math.round(r)),l){if(!q&&l[4]==1)return;Hr(l,at);var j=q?[t,M?M.slice(0):null,d,o,p,c,C,I,i,r,v]:null;j&&E&&j.push(m,T,O,P,N,k),l.push(j)}else q&&(E&&this.replayTextBackground_(t,O,P,N,k,m,T),zi(t,M,d,o,p,c,C,I,i,r,v))},e.prototype.applyPixelRatio=function(t){var i=this.pixelRatio;return i==1?t:t.map(function(r){return r*i})},e.prototype.appendFlatCoordinates=function(t,i,r,o,s,h){var l=this.coordinates.length,u=this.getBufferedMaxExtent();h&&(i+=o);var d=[t[i],t[i+1]],p=[NaN,NaN],c=!0,f,v,g;for(f=i+o;f<r;f+=o)p[0]=t[f],p[1]=t[f+1],g=zr(u,p),g!==v?(c&&(this.coordinates[l++]=d[0],this.coordinates[l++]=d[1]),this.coordinates[l++]=p[0],this.coordinates[l++]=p[1],c=!1):g===Xr.INTERSECTING?(this.coordinates[l++]=p[0],this.coordinates[l++]=p[1],c=!1):c=!0,d[0]=p[0],d[1]=p[1],v=g;return(s&&c||f===i+o)&&(this.coordinates[l++]=d[0],this.coordinates[l++]=d[1]),l},e.prototype.drawCustomCoordinates_=function(t,i,r,o,s){for(var h=0,l=r.length;h<l;++h){var u=r[h],d=this.appendFlatCoordinates(t,i,u,o,!1,!1);s.push(d),i=u}return i},e.prototype.drawCustom=function(t,i,r){this.beginGeometry(t,i);var o=t.getType(),s=t.getStride(),h=this.coordinates.length,l,u,d,p,c;if(o==G.MULTI_POLYGON){t=t,l=t.getOrientedFlatCoordinates(),p=[];var f=t.getEndss();c=0;for(var v=0,g=f.length;v<g;++v){var _=[];c=this.drawCustomCoordinates_(l,c,f[v],s,_),p.push(_)}this.instructions.push([A.CUSTOM,h,p,t,r,vn])}else o==G.POLYGON||o==G.MULTI_LINE_STRING?(d=[],l=o==G.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),c=this.drawCustomCoordinates_(l,0,t.getEnds(),s,d),this.instructions.push([A.CUSTOM,h,d,t,r,_n])):o==G.LINE_STRING||o==G.MULTI_POINT?(l=t.getFlatCoordinates(),u=this.appendFlatCoordinates(l,0,l.length,s,!1,!1),this.instructions.push([A.CUSTOM,h,u,t,r,gn])):o==G.POINT&&(l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),u=this.coordinates.length,this.instructions.push([A.CUSTOM,h,u,t,r]));this.endGeometry(t,i)},e.prototype.beginGeometry=function(t,i){this.beginGeometryInstruction1_=[A.BEGIN_GEOMETRY,i,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[A.BEGIN_GEOMETRY,i,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){},e.prototype.fill_=function(t){if(this.alignFill_){var i=J(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.translate(i[0]%r,i[1]%r),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.setTransform.apply(t,Er)},e.prototype.setStrokeStyle_=function(t,i){t.strokeStyle=i[1],t.lineWidth=i[2],t.lineCap=i[3],t.lineJoin=i[4],t.miterLimit=i[5],De&&(t.lineDashOffset=i[7],t.setLineDash(i[6]))},e.prototype.renderDeclutter_=function(t,i){if(t&&t.length>5){var r=t[4];if(r==1||r==t.length-5){var o={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:i};if(!this.declutterTree.collides(o)){this.declutterTree.insert(o);for(var s=5,h=t.length;s<h;++s){var l=t[s];l&&(l.length>11&&this.replayTextBackground_(l[0],l[13],l[14],l[15],l[16],l[11],l[12]),zi.apply(void 0,l))}}t.length=5,hi(t)}}},e.prototype.replay_=function(t,i,r,o,s,h,l){var u;this.pixelCoordinates_&&ne(i,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=ee(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),nr(this.renderedTransform_,i));for(var d=!tr(r),p=0,c=o.length,f=0,v,g,_,y,m,T,E,C,I,S=0,w=0,L=null,F=null,O=this.coordinateCache_,P=this.viewRotation_,N={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:P},k=this.instructions!=o||this.overlaps?0:200,M,W,V;p<c;){var R=o[p],X=R[0];switch(X){case A.BEGIN_GEOMETRY:M=R[1],d&&r[Y(M)]||!M.getGeometry()?p=R[2]:l!==void 0&&!ht(l,M.getGeometry().getExtent())?p=R[2]+1:++p;break;case A.BEGIN_PATH:S>k&&(this.fill_(t),S=0),w>k&&(t.stroke(),w=0),!S&&!w&&(t.beginPath(),y=m=NaN),++p;break;case A.CIRCLE:f=R[1];var q=u[f],j=u[f+1],Yt=u[f+2],Dt=u[f+3],Pt=Yt-q,Ht=Dt-j,bt=Math.sqrt(Pt*Pt+Ht*Ht);t.moveTo(q+bt,j),t.arc(q,j,bt,0,2*Math.PI,!0),++p;break;case A.CLOSE_PATH:t.closePath(),++p;break;case A.CUSTOM:f=R[1],v=R[2];var zt=R[3],Et=R[4],Tt=R.length==6?R[5]:void 0;N.geometry=zt,N.feature=M,p in O||(O[p]=[]);var ct=O[p];Tt?Tt(u,f,v,2,ct):(ct[0]=u[f],ct[1]=u[f+1],ct.length=2),Et(ct,N),++p;break;case A.DRAW_IMAGE:f=R[1],v=R[2],I=R[3],g=R[4],_=R[5],C=h?null:R[6];var Xt=R[7],ue=R[8],Bt=R[9],de=R[10],pe=R[11],ce=R[12],fe=R[13],ve=R[14],Ct=void 0,Rt=void 0,qe=void 0;for(R.length>16?(Ct=R[15],Rt=R[16],qe=R[17]):(Ct=kt,Rt=qe=!1),pe&&(ce+=P);f<v;f+=2)this.replayImage_(t,u[f],u[f+1],I,g,_,C,Xt,ue,Bt,de,ce,fe,s,ve,Ct,Rt?L:null,qe?F:null);this.renderDeclutter_(C,M),++p;break;case A.DRAW_CHARS:var Li=R[1],Si=R[2],Je=R[3];C=h?null:R[4];var Pr=R[5],wi=R[6],br=R[7],Oi=R[8],Ai=R[9],xi=R[10],Di=R[11],Pi=R[12],Qe=R[13],bi=R[14],Mi=lo(u,Li,Si,2),Fi=Oi(Pi);if(Pr||Fi<=Mi){var ti=this,Mr=ti.textStates[Qe].textAlign,Fr=(Mi-Fi)*Jt[Mr],Zt=Po(u,Li,Si,2,Pi,Oi,Fr,br);if(Zt){var ft=void 0,_e=void 0,ge=void 0,ot=void 0,et=void 0;if(xi)for(ft=0,_e=Zt.length;ft<_e;++ft)et=Zt[ft],ge=et[4],ot=ti.getImage(ge,Qe,"",xi),g=et[2]+Di,_=Je*ot.height+(.5-Je)*2*Di-Ai,this.replayImage_(t,et[0],et[1],ot,g,_,C,ot.height,1,0,0,et[3],bi,!1,ot.width,kt,null,null);if(wi)for(ft=0,_e=Zt.length;ft<_e;++ft)et=Zt[ft],ge=et[4],ot=ti.getImage(ge,Qe,wi,""),g=et[2],_=Je*ot.height-Ai,this.replayImage_(t,et[0],et[1],ot,g,_,C,ot.height,1,0,0,et[3],bi,!1,ot.width,kt,null,null)}}this.renderDeclutter_(C,M),++p;break;case A.END_GEOMETRY:if(h!==void 0){M=R[1];var Ni=h(M);if(Ni)return Ni}++p;break;case A.FILL:k?S++:this.fill_(t),++p;break;case A.MOVE_TO_LINE_TO:for(f=R[1],v=R[2],W=u[f],V=u[f+1],T=W+.5|0,E=V+.5|0,(T!==y||E!==m)&&(t.moveTo(W,V),y=T,m=E),f+=2;f<v;f+=2)W=u[f],V=u[f+1],T=W+.5|0,E=V+.5|0,(f==v-2||T!==y||E!==m)&&(t.lineTo(W,V),y=T,m=E);++p;break;case A.SET_FILL_STYLE:L=R,this.alignFill_=R[2],S&&(this.fill_(t),S=0,w&&(t.stroke(),w=0)),t.fillStyle=R[1],++p;break;case A.SET_STROKE_STYLE:F=R,w&&(t.stroke(),w=0),this.setStrokeStyle_(t,R),++p;break;case A.STROKE:k?w++:t.stroke(),++p;break;default:++p;break}}S&&this.fill_(t),w&&t.stroke()},e.prototype.replay=function(t,i,r,o,s){this.viewRotation_=r,this.replay_(t,i,o,this.instructions,s,void 0,void 0)},e.prototype.replayHitDetection=function(t,i,r,o,s,h){return this.viewRotation_=r,this.replay_(t,i,o,this.hitDetectionInstructions,!0,s,h)},e.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var i,r=t.length,o,s,h=-1;for(i=0;i<r;++i)o=t[i],s=o[0],s==A.END_GEOMETRY?h=i:s==A.BEGIN_GEOMETRY&&(o[2]=i,nn(this.hitDetectionInstructions,h,i),h=-1)},e.prototype.setFillStrokeStyle=function(t,i){var r=this.state;if(t){var o=t.getColor();r.fillStyle=_t(o||Ot)}else r.fillStyle=void 0;if(i){var s=i.getColor();r.strokeStyle=_t(s||Ge);var h=i.getLineCap();r.lineCap=h!==void 0?h:be;var l=i.getLineDash();r.lineDash=l?l.slice():Me;var u=i.getLineDashOffset();r.lineDashOffset=u||Fe;var d=i.getLineJoin();r.lineJoin=d!==void 0?d:Ne;var p=i.getWidth();r.lineWidth=p!==void 0?p:Ke;var c=i.getMiterLimit();r.miterLimit=c!==void 0?c:ke,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0},e.prototype.createFill=function(t,i){var r=t.fillStyle,o=[A.SET_FILL_STYLE,r];return typeof r!="string"&&o.push(!0),o},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[A.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,i,r){var o=t.fillStyle;(typeof o!="string"||t.currentFillStyle!=o)&&(o!==void 0&&this.instructions.push(i.call(this,t,r)),t.currentFillStyle=o)},e.prototype.updateStrokeStyle=function(t,i){var r=t.strokeStyle,o=t.lineCap,s=t.lineDash,h=t.lineDashOffset,l=t.lineJoin,u=t.lineWidth,d=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=o||s!=t.currentLineDash&&!ne(t.currentLineDash,s)||t.currentLineDashOffset!=h||t.currentLineJoin!=l||t.currentLineWidth!=u||t.currentMiterLimit!=d)&&(r!==void 0&&i.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=o,t.currentLineDash=s,t.currentLineDashOffset=h,t.currentLineJoin=l,t.currentLineWidth=u,t.currentMiterLimit=d)},e.prototype.endGeometry=function(t,i){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var r=[A.END_GEOMETRY,i];this.instructions.push(r),this.hitDetectionInstructions.push(r)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=$i(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;re(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(Cr);const le=bo;var Mo=function(a){function e(n,t,i,r,o,s){a.call(this,n,t,i,r,o,s),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.drawCoordinates_=function(t,i,r,o){return this.appendFlatCoordinates(t,i,r,o,!1,!1)},e.prototype.drawPoint=function(t,i){if(this.image_){this.beginGeometry(t,i);var r=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length,h=this.drawCoordinates_(r,0,r.length,o);this.instructions.push([A.DRAW_IMAGE,s,h,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([A.DRAW_IMAGE,s,h,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(t,i)}},e.prototype.drawMultiPoint=function(t,i){if(this.image_){this.beginGeometry(t,i);var r=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length,h=this.drawCoordinates_(r,0,r.length,o);this.instructions.push([A.DRAW_IMAGE,s,h,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([A.DRAW_IMAGE,s,h,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(t,i)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0},e.prototype.setImageStyle=function(t,i){var r=t.getAnchor(),o=t.getSize(),s=t.getHitDetectionImage(1),h=t.getImage(1),l=t.getOrigin();this.anchorX_=r[0],this.anchorY_=r[1],this.declutterGroup_=i,this.hitDetectionImage_=s,this.image_=h,this.height_=o[1],this.opacity_=t.getOpacity(),this.originX_=l[0],this.originY_=l[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScale(),this.width_=o[0]},e}(le);const Fo=Mo;var No=function(a){function e(n,t,i,r,o,s){a.call(this,n,t,i,r,o,s)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.drawFlatCoordinates_=function(t,i,r,o){var s=this.coordinates.length,h=this.appendFlatCoordinates(t,i,r,o,!1,!1),l=[A.MOVE_TO_LINE_TO,s,h];return this.instructions.push(l),this.hitDetectionInstructions.push(l),r},e.prototype.drawLineString=function(t,i){var r=this.state,o=r.strokeStyle,s=r.lineWidth;if(!(o===void 0||s===void 0)){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,i),this.hitDetectionInstructions.push([A.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],St);var h=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(h,0,h.length,l),this.hitDetectionInstructions.push(gt),this.endGeometry(t,i)}},e.prototype.drawMultiLineString=function(t,i){var r=this.state,o=r.strokeStyle,s=r.lineWidth;if(!(o===void 0||s===void 0)){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,i),this.hitDetectionInstructions.push([A.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],St);for(var h=t.getEnds(),l=t.getFlatCoordinates(),u=t.getStride(),d=0,p=0,c=h.length;p<c;++p)d=this.drawFlatCoordinates_(l,d,h[p],u);this.hitDetectionInstructions.push(gt),this.endGeometry(t,i)}},e.prototype.finish=function(){var t=this.state;t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(gt),this.reverseHitDetectionInstructions(),this.state=null},e.prototype.applyStroke=function(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(gt),t.lastStroke=this.coordinates.length),t.lastStroke=0,a.prototype.applyStroke.call(this,t),this.instructions.push(St)},e}(le);const ko=No;var Go=function(a){function e(n,t,i,r,o,s){a.call(this,n,t,i,r,o,s)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.drawFlatCoordinatess_=function(t,i,r,o){var s=this.state,h=s.fillStyle!==void 0,l=s.strokeStyle!=null,u=r.length;this.instructions.push(St),this.hitDetectionInstructions.push(St);for(var d=0;d<u;++d){var p=r[d],c=this.coordinates.length,f=this.appendFlatCoordinates(t,i,p,o,!0,!l),v=[A.MOVE_TO_LINE_TO,c,f];this.instructions.push(v),this.hitDetectionInstructions.push(v),l&&(this.instructions.push(Xi),this.hitDetectionInstructions.push(Xi)),i=p}return h&&(this.instructions.push(me),this.hitDetectionInstructions.push(me)),l&&(this.instructions.push(gt),this.hitDetectionInstructions.push(gt)),i},e.prototype.drawCircle=function(t,i){var r=this.state,o=r.fillStyle,s=r.strokeStyle;if(!(o===void 0&&s===void 0)){this.setFillStrokeStyles_(t),this.beginGeometry(t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([A.SET_FILL_STYLE,Re(Ot)]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([A.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var h=t.getFlatCoordinates(),l=t.getStride(),u=this.coordinates.length;this.appendFlatCoordinates(h,0,h.length,l,!1,!1);var d=[A.CIRCLE,u];this.instructions.push(St,d),this.hitDetectionInstructions.push(St,d),this.hitDetectionInstructions.push(me),r.fillStyle!==void 0&&this.instructions.push(me),r.strokeStyle!==void 0&&(this.instructions.push(gt),this.hitDetectionInstructions.push(gt)),this.endGeometry(t,i)}},e.prototype.drawPolygon=function(t,i){var r=this.state,o=r.fillStyle,s=r.strokeStyle;if(!(o===void 0&&s===void 0)){this.setFillStrokeStyles_(t),this.beginGeometry(t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([A.SET_FILL_STYLE,Re(Ot)]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([A.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var h=t.getEnds(),l=t.getOrientedFlatCoordinates(),u=t.getStride();this.drawFlatCoordinatess_(l,0,h,u),this.endGeometry(t,i)}},e.prototype.drawMultiPolygon=function(t,i){var r=this.state,o=r.fillStyle,s=r.strokeStyle;if(!(o===void 0&&s===void 0)){this.setFillStrokeStyles_(t),this.beginGeometry(t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([A.SET_FILL_STYLE,Re(Ot)]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([A.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);for(var h=t.getEndss(),l=t.getOrientedFlatCoordinates(),u=t.getStride(),d=0,p=0,c=h.length;p<c;++p)d=this.drawFlatCoordinatess_(l,d,h[p],u);this.endGeometry(t,i)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(t!==0)for(var i=this.coordinates,r=0,o=i.length;r<o;++r)i[r]=yn(i[r],t)},e.prototype.setFillStrokeStyles_=function(t){var i=this.state,r=i.fillStyle;r!==void 0&&this.updateFillStyle(i,this.createFill,t),i.strokeStyle!==void 0&&this.updateStrokeStyle(i,this.applyStroke)},e}(le);const Bi=Go;function Ko(a,e,n,t,i){var r=n,o=n,s=0,h=0,l=n,u,d,p,c,f,v,g,_,y,m;for(d=n;d<t;d+=i){var T=e[d],E=e[d+1];f!==void 0&&(y=T-f,m=E-v,c=Math.sqrt(y*y+m*m),g!==void 0&&(h+=p,u=Math.acos((g*y+_*m)/(p*c)),u>a&&(h>s&&(s=h,r=l,o=d),h=0,l=d-i)),p=c,g=y,_=m),f=T,v=E}return h+=c,h>s?[l,d]:[r,o]}const Wo={POINT:"point",LINE:"line"};var Vo=function(a){function e(n,t,i,r,o,s){a.call(this,n,t,i,r,o,s),this.declutterGroup_,this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.widths_={},ut.prune()}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.drawText=function(t,i){var r=this.textFillState_,o=this.textStrokeState_,s=this.textState_;if(!(this.text_===""||!s||!r&&!o)){var h=this.coordinates.length,l=t.getType(),u=null,d=2,p=2,c,f;if(s.placement===Wo.LINE){if(!ht(this.getBufferedMaxExtent(),t.getExtent()))return;var v;if(u=t.getFlatCoordinates(),p=t.getStride(),l==G.LINE_STRING)v=[u.length];else if(l==G.MULTI_LINE_STRING)v=t.getEnds();else if(l==G.POLYGON)v=t.getEnds().slice(0,1);else if(l==G.MULTI_POLYGON){var g=t.getEndss();for(v=[],c=0,f=g.length;c<f;++c)v.push(g[c][0])}this.beginGeometry(t,i);for(var _=s.textAlign,y=0,m,T=0,E=v.length;T<E;++T){if(_==null){var C=Ko(s.maxAngle,u,y,v[T],p);y=C[0],m=C[1]}else m=v[T];for(c=y;c<m;c+=p)this.coordinates.push(u[c],u[c+1]);d=this.coordinates.length,y=v[T],this.drawChars_(h,d,this.declutterGroup_),h=d}this.endGeometry(t,i)}else{var I=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),S=I.width/this.pixelRatio;switch(l){case G.POINT:case G.MULTI_POINT:u=t.getFlatCoordinates(),d=u.length;break;case G.LINE_STRING:u=t.getFlatMidpoint();break;case G.CIRCLE:u=t.getCenter();break;case G.MULTI_LINE_STRING:u=t.getFlatMidpoints(),d=u.length;break;case G.POLYGON:if(u=t.getFlatInteriorPoint(),!s.overflow&&u[2]/this.resolution<S)return;p=3;break;case G.MULTI_POLYGON:var w=t.getFlatInteriorPoints();for(u=[],c=0,f=w.length;c<f;c+=3)(s.overflow||w[c+2]/this.resolution>=S)&&u.push(w[c],w[c+1]);if(d=u.length,d==0)return;break}d=this.appendFlatCoordinates(u,0,d,p,!1,!1),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill,t),this.hitDetectionInstructions.push(this.createFill(this.state,t))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,i),this.drawTextImage_(I,h,d),this.endGeometry(t,i)}}},e.prototype.getImage=function(t,i,r,o){var s,h=o+i+t+r+this.pixelRatio;if(!ut.containsKey(h)){var l=o?this.strokeStates[o]||this.textStrokeState_:null,u=r?this.fillStates[r]||this.textFillState_:null,d=this.textStates[i]||this.textState_,p=this.pixelRatio,c=d.scale*p,f=Jt[d.textAlign||ie],v=o&&l.lineWidth?l.lineWidth:0,g=t.split(`
`),_=g.length,y=[],m=Uo(d.font,g,y),T=fo(d.font),E=T*_,C=m+v,I=mt(Math.ceil(C*c),Math.ceil((E+v)*c));s=I.canvas,ut.set(h,s),c!=1&&I.scale(c,c),I.font=d.font,o&&(I.strokeStyle=l.strokeStyle,I.lineWidth=v,I.lineCap=l.lineCap,I.lineJoin=l.lineJoin,I.miterLimit=l.miterLimit,De&&l.lineDash.length&&(I.setLineDash(l.lineDash),I.lineDashOffset=l.lineDashOffset)),r&&(I.fillStyle=u.fillStyle),I.textBaseline="middle",I.textAlign="center";var S=.5-f,w=f*s.width/c+S*v,L;if(o)for(L=0;L<_;++L)I.strokeText(g[L],w+S*y[L],.5*(v+T)+L*T);if(r)for(L=0;L<_;++L)I.fillText(g[L],w+S*y[L],.5*(v+T)+L*T)}return ut.get(h)},e.prototype.drawTextImage_=function(t,i,r){var o=this.textState_,s=this.textStrokeState_,h=this.pixelRatio,l=Jt[o.textAlign||ie],u=Jt[o.textBaseline],d=s&&s.lineWidth?s.lineWidth:0,p=l*t.width/h+2*(.5-l)*d,c=u*t.height/h+2*(.5-u)*d;this.instructions.push([A.DRAW_IMAGE,i,r,t,(p-this.textOffsetX_)*h,(c-this.textOffsetY_)*h,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,t.width,o.padding==kt?kt:o.padding.map(function(f){return f*h}),!!o.backgroundFill,!!o.backgroundStroke]),this.hitDetectionInstructions.push([A.DRAW_IMAGE,i,r,t,(p-this.textOffsetX_)*h,(c-this.textOffsetY_)*h,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/h,t.width,o.padding,!!o.backgroundFill,!!o.backgroundStroke])},e.prototype.drawChars_=function(t,i,r){var o=this.textStrokeState_,s=this.textState_,h=this.textFillState_,l=this.strokeKey_;o&&(l in this.strokeStates||(this.strokeStates[l]={strokeStyle:o.strokeStyle,lineCap:o.lineCap,lineDashOffset:o.lineDashOffset,lineWidth:o.lineWidth,lineJoin:o.lineJoin,miterLimit:o.miterLimit,lineDash:o.lineDash}));var u=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:s.font,textAlign:s.textAlign||ie,scale:s.scale});var d=this.fillKey_;h&&(d in this.fillStates||(this.fillStates[d]={fillStyle:h.fillStyle}));var p=this.pixelRatio,c=Jt[s.textBaseline],f=this.textOffsetY_*p,v=this.text_,g=s.font,_=s.scale,y=o?o.lineWidth*_/2:0,m=this.widths_[g];m||(this.widths_[g]=m={}),this.instructions.push([A.DRAW_CHARS,t,i,c,r,s.overflow,d,s.maxAngle,function(T){var E=m[T];return E||(E=m[T]=pi(g,T)),E*_*p},f,l,y*p,v,u,1]),this.hitDetectionInstructions.push([A.DRAW_CHARS,t,i,c,r,s.overflow,d,s.maxAngle,function(T){var E=m[T];return E||(E=m[T]=pi(g,T)),E*_},f,l,y,v,u,1/p])},e.prototype.setTextStyle=function(t,i){var r,o,s;if(!t)this.text_="";else{this.declutterGroup_=i;var h=t.getFill();h?(o=this.textFillState_,o||(o=this.textFillState_={}),o.fillStyle=_t(h.getColor()||Ot)):o=this.textFillState_=null;var l=t.getStroke();if(!l)s=this.textStrokeState_=null;else{s=this.textStrokeState_,s||(s=this.textStrokeState_={});var u=l.getLineDash(),d=l.getLineDashOffset(),p=l.getWidth(),c=l.getMiterLimit();s.lineCap=l.getLineCap()||be,s.lineDash=u?u.slice():Me,s.lineDashOffset=d===void 0?Fe:d,s.lineJoin=l.getLineJoin()||Ne,s.lineWidth=p===void 0?Ke:p,s.miterLimit=c===void 0?ke:c,s.strokeStyle=_t(l.getColor()||Ge)}r=this.textState_;var f=t.getFont()||_r;co(f);var v=t.getScale();r.overflow=t.getOverflow(),r.font=f,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.textBaseline=t.getTextBaseline()||gr,r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||kt,r.scale=v===void 0?1:v;var g=t.getOffsetX(),_=t.getOffsetY(),y=t.getRotateWithView(),m=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=g===void 0?0:g,this.textOffsetY_=_===void 0?0:_,this.textRotateWithView_=y===void 0?!1:y,this.textRotation_=m===void 0?0:m,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:Y(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?"),this.fillKey_=o?typeof o.fillStyle=="string"?o.fillStyle:"|"+Y(o.fillStyle):""}},e}(le);function Uo(a,e,n){for(var t=e.length,i=0,r=0;r<t;++r){var o=pi(a,e[r]);i=Math.max(i,o),n.push(o)}return i}const Yo=Vo;var Ho={Circle:Bi,Default:le,Image:Fo,LineString:ko,Polygon:Bi,Text:Yo},zo=function(a){function e(n,t,i,r,o,s,h){a.call(this),this.declutterTree_=s,this.declutterGroup_=null,this.tolerance_=n,this.maxExtent_=t,this.overlaps_=o,this.pixelRatio_=r,this.resolution_=i,this.renderBuffer_=h,this.replaysByZIndex_={},this.hitDetectionContext_=mt(1,1),this.hitDetectionTransform_=tt()}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.addDeclutter=function(t){var i=null;return this.declutterTree_&&(t?(i=this.declutterGroup_,i[4]++):(i=this.declutterGroup_=Gt(),i.push(1))),i},e.prototype.clip=function(t,i){var r=this.getClipCoords(i);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()},e.prototype.hasReplays=function(t){for(var i in this.replaysByZIndex_)for(var r=this.replaysByZIndex_[i],o=0,s=t.length;o<s;++o)if(t[o]in r)return!0;return!1},e.prototype.finish=function(){for(var t in this.replaysByZIndex_){var i=this.replaysByZIndex_[t];for(var r in i)i[r].finish()}},e.prototype.forEachFeatureAtCoordinate=function(t,i,r,o,s,h,l){o=Math.round(o);var u=o*2+1,d=nt(this.hitDetectionTransform_,o+.5,o+.5,1/i,-1/i,-r,-t[0],-t[1]),p=this.hitDetectionContext_;p.canvas.width!==u||p.canvas.height!==u?(p.canvas.width=u,p.canvas.height=u):p.clearRect(0,0,u,u);var c;this.renderBuffer_!==void 0&&(c=Gt(),jt(c,t),re(c,i*(this.renderBuffer_+o),c));var f=Xo(o),v;this.declutterTree_&&(v=this.declutterTree_.all().map(function(L){return L.value}));var g;function _(L){for(var F=p.getImageData(0,0,u,u).data,O=0;O<u;O++)for(var P=0;P<u;P++)if(f[O][P]&&F[(P*u+O)*4+3]>0){var N=void 0;if((!(v&&(g==b.IMAGE||g==b.TEXT))||v.indexOf(L)!==-1)&&(N=h(L)),N)return N;p.clearRect(0,0,u,u);return}}var y=Object.keys(this.replaysByZIndex_).map(Number);y.sort(ui);var m,T,E,C,I;for(m=y.length-1;m>=0;--m){var S=y[m].toString();for(E=this.replaysByZIndex_[S],T=Le.length-1;T>=0;--T)if(g=Le[T],C=E[g],C!==void 0){if(l&&(g==b.IMAGE||g==b.TEXT)){var w=l[S];w?w.push(C,d.slice(0)):l[S]=[C,d.slice(0)]}else if(I=C.replayHitDetection(p,d,r,s,_,c),I)return I}}},e.prototype.getClipCoords=function(t){var i=this.maxExtent_,r=i[0],o=i[1],s=i[2],h=i[3],l=[r,o,r,h,s,h,s,o];return ee(l,0,8,2,t,l),l},e.prototype.getReplay=function(t,i){var r=t!==void 0?t.toString():"0",o=this.replaysByZIndex_[r];o===void 0&&(o={},this.replaysByZIndex_[r]=o);var s=o[i];if(s===void 0){var h=Ho[i];s=new h(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),o[i]=s}return s},e.prototype.getReplays=function(){return this.replaysByZIndex_},e.prototype.isEmpty=function(){return tr(this.replaysByZIndex_)},e.prototype.replay=function(t,i,r,o,s,h,l){var u=Object.keys(this.replaysByZIndex_).map(Number);u.sort(ui),t.save(),this.clip(t,i);var d=h||Le,p,c,f,v,g,_;for(p=0,c=u.length;p<c;++p){var y=u[p].toString();for(g=this.replaysByZIndex_[y],f=0,v=d.length;f<v;++f){var m=d[f];if(_=g[m],_!==void 0)if(l&&(m==b.IMAGE||m==b.TEXT)){var T=l[y];T?T.push(_,i.slice(0)):l[y]=[_,i.slice(0)]}else _.replay(t,i,r,o,s)}}t.restore()},e}(Do),oi={0:[[!0]]};function vt(a,e,n){var t,i=Math.floor(a.length/2);if(e>=i)for(t=i;t<e;t++)a[t][n]=!0;else if(e<i)for(t=e+1;t<i;t++)a[t][n]=!0}function Xo(a){if(oi[a]!==void 0)return oi[a];for(var e=a*2+1,n=new Array(e),t=0;t<e;t++)n[t]=new Array(e);for(var i=a,r=0,o=0;i>=r;)vt(n,a+i,a+r),vt(n,a+r,a+i),vt(n,a-r,a+i),vt(n,a-i,a+r),vt(n,a-i,a-r),vt(n,a-r,a-i),vt(n,a+r,a-i),vt(n,a+i,a-r),r++,o+=1+2*r,2*(o-i)+1>0&&(i-=1,o+=1-2*i);return oi[a]=n,n}function Bo(a,e,n,t){for(var i=Object.keys(a).map(Number).sort(ui),r={},o=0,s=i.length;o<s;++o)for(var h=a[i[o].toString()],l=0,u=h.length;l<u;){var d=h[l++],p=h[l++];d.replay(e,p,n,r,t)}}const Or=zo;var Zo=.5,Ar={Point:is,LineString:Qo,Polygon:ns,MultiPoint:rs,MultiLineString:ts,MultiPolygon:es,GeometryCollection:Jo,Circle:jo};function $o(a,e){return parseInt(Y(a),10)-parseInt(Y(e),10)}function ci(a,e){var n=xr(a,e);return n*n}function xr(a,e){return Zo*a/e}function jo(a,e,n,t){var i=n.getFill(),r=n.getStroke();if(i||r){var o=a.getReplay(n.getZIndex(),b.CIRCLE);o.setFillStrokeStyle(i,r),o.drawCircle(e,t)}var s=n.getText();if(s){var h=a.getReplay(n.getZIndex(),b.TEXT);h.setTextStyle(s,a.addDeclutter(!1)),h.drawText(e,t)}}function Ue(a,e,n,t,i,r){var o=!1,s=n.getImage();if(s){var h=s.getImageState();h==B.LOADED||h==B.ERROR?s.unlistenImageChange(i,r):(h==B.IDLE&&s.load(),h=s.getImageState(),s.listenImageChange(i,r),o=!0)}return qo(a,e,n,t),o}function qo(a,e,n,t){var i=n.getGeometryFunction()(e);if(i){var r=i.getSimplifiedGeometry(t),o=n.getRenderer();if(o)Dr(a,r,n,e);else{var s=Ar[r.getType()];s(a,r,n,e)}}}function Dr(a,e,n,t){if(e.getType()==G.GEOMETRY_COLLECTION){for(var i=e.getGeometries(),r=0,o=i.length;r<o;++r)Dr(a,i[r],n,t);return}var s=a.getReplay(n.getZIndex(),b.DEFAULT);s.drawCustom(e,t,n.getRenderer())}function Jo(a,e,n,t){var i=e.getGeometriesArray(),r,o;for(r=0,o=i.length;r<o;++r){var s=Ar[i[r].getType()];s(a,i[r],n,t)}}function Qo(a,e,n,t){var i=n.getStroke();if(i){var r=a.getReplay(n.getZIndex(),b.LINE_STRING);r.setFillStrokeStyle(null,i),r.drawLineString(e,t)}var o=n.getText();if(o){var s=a.getReplay(n.getZIndex(),b.TEXT);s.setTextStyle(o,a.addDeclutter(!1)),s.drawText(e,t)}}function ts(a,e,n,t){var i=n.getStroke();if(i){var r=a.getReplay(n.getZIndex(),b.LINE_STRING);r.setFillStrokeStyle(null,i),r.drawMultiLineString(e,t)}var o=n.getText();if(o){var s=a.getReplay(n.getZIndex(),b.TEXT);s.setTextStyle(o,a.addDeclutter(!1)),s.drawText(e,t)}}function es(a,e,n,t){var i=n.getFill(),r=n.getStroke();if(r||i){var o=a.getReplay(n.getZIndex(),b.POLYGON);o.setFillStrokeStyle(i,r),o.drawMultiPolygon(e,t)}var s=n.getText();if(s){var h=a.getReplay(n.getZIndex(),b.TEXT);h.setTextStyle(s,a.addDeclutter(!1)),h.drawText(e,t)}}function is(a,e,n,t){var i=n.getImage();if(i){if(i.getImageState()!=B.LOADED)return;var r=a.getReplay(n.getZIndex(),b.IMAGE);r.setImageStyle(i,a.addDeclutter(!1)),r.drawPoint(e,t)}var o=n.getText();if(o){var s=a.getReplay(n.getZIndex(),b.TEXT);s.setTextStyle(o,a.addDeclutter(!!i)),s.drawText(e,t)}}function rs(a,e,n,t){var i=n.getImage();if(i){if(i.getImageState()!=B.LOADED)return;var r=a.getReplay(n.getZIndex(),b.IMAGE);r.setImageStyle(i,a.addDeclutter(!1)),r.drawMultiPoint(e,t)}var o=n.getText();if(o){var s=a.getReplay(n.getZIndex(),b.TEXT);s.setTextStyle(o,a.addDeclutter(!!i)),s.drawText(e,t)}}function ns(a,e,n,t){var i=n.getFill(),r=n.getStroke();if(i||r){var o=a.getReplay(n.getZIndex(),b.POLYGON);o.setFillStrokeStyle(i,r),o.drawPolygon(e,t)}var s=n.getText();if(s){var h=a.getReplay(n.getZIndex(),b.TEXT);h.setTextStyle(s,a.addDeclutter(!1)),h.drawText(e,t)}}var Ye=function(a){function e(n){a.call(this,n),this.declutterTree_=n.getDeclutter()?ar(9,void 0):null,this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Gt(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.context=mt(),x(ut,D.CLEAR,this.handleFontsChanged_,this)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){wt(ut,D.CLEAR,this.handleFontsChanged_,this),a.prototype.disposeInternal.call(this)},e.prototype.compose=function(t,i,r){var o=i.extent,s=i.pixelRatio,h=r.managed?i.skippedFeatureUids:{},l=i.viewState,u=l.projection,d=l.rotation,p=u.getExtent(),c=this.getLayer().getSource(),f=this.getTransform(i,0),v=r.extent,g=v!==void 0;g&&this.clip(t,i,v);var _=this.replayGroup_;if(_&&!_.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var y=this.getLayer(),m=0,T=0,E,C=r.opacity!==1,I=y.hasListener(yt.RENDER);if(C||I){var S=t.canvas.width,w=t.canvas.height;if(d){var L=Math.round(Math.sqrt(S*S+w*w));m=(L-S)/2,T=(L-w)/2,S=w=L}this.context.canvas.width=S,this.context.canvas.height=w,E=this.context}else E=t;var F=E.globalAlpha;C||(E.globalAlpha=r.opacity),E!=t&&E.translate(m,T);var O=i.viewHints,P=!(O[U.ANIMATING]||O[U.INTERACTING]),N=i.size[0]*s,k=i.size[1]*s;if(dt(E,-d,N/2,k/2),_.replay(E,f,d,h,P),c.getWrapX()&&u.canWrapX()&&!te(p,o)){for(var M=o[0],W=Qt(p),V=0,R;M<p[0];)--V,R=W*V,f=this.getTransform(i,R),_.replay(E,f,d,h,P),M+=W;for(V=0,M=o[2];M>p[2];)++V,R=W*V,f=this.getTransform(i,R),_.replay(E,f,d,h,P),M-=W}if(dt(E,d,N/2,k/2),I&&this.dispatchRenderEvent(E,i,f),E!=t){if(C){var X=t.globalAlpha;t.globalAlpha=r.opacity,t.drawImage(E.canvas,-m,-T),t.globalAlpha=X}else t.drawImage(E.canvas,-m,-T);E.translate(-m,-T)}C||(E.globalAlpha=F)}g&&t.restore()},e.prototype.composeFrame=function(t,i,r){var o=this.getTransform(t,0);this.preCompose(r,t,o),this.compose(r,t,i),this.postCompose(r,t,i,o)},e.prototype.forEachFeatureAtCoordinate=function(t,i,r,o,s){if(this.replayGroup_){var h=i.viewState.resolution,l=i.viewState.rotation,u=this.getLayer(),d={},p=this.replayGroup_.forEachFeatureAtCoordinate(t,h,l,r,{},function(c){var f=Y(c);if(!(f in d))return d[f]=!0,o.call(s,c,u)},null);return p}else return},e.prototype.handleFontsChanged_=function(t){var i=this.getLayer();i.getVisible()&&this.replayGroup_&&i.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.prepareFrame=function(t,i){var r=this.getLayer(),o=r.getSource(),s=t.viewHints[U.ANIMATING],h=t.viewHints[U.INTERACTING],l=r.getUpdateWhileAnimating(),u=r.getUpdateWhileInteracting();if(!this.dirty_&&!l&&s||!u&&h)return!0;var d=t.extent,p=t.viewState,c=p.projection,f=p.resolution,v=t.pixelRatio,g=r.getRevision(),_=r.getRenderBuffer(),y=r.getRenderOrder();y===void 0&&(y=$o);var m=re(d,_*f),T=p.projection.getExtent();if(o.getWrapX()&&p.projection.canWrapX()&&!te(T,t.extent)){var E=Qt(T),C=Math.max(Qt(m)/2,E);m[0]=T[0]-C,m[2]=T[2]+C}if(!this.dirty_&&this.renderedResolution_==f&&this.renderedRevision_==g&&this.renderedRenderOrder_==y&&te(this.renderedExtent_,m))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var I=new Or(xr(f,v),m,f,v,o.getOverlaps(),this.declutterTree_,r.getRenderBuffer());o.loadFeatures(m,f,c);var S=(function(O){var P,N=O.getStyleFunction()||r.getStyleFunction();if(N&&(P=N(O,f)),P){var k=this.renderFeature(O,f,v,P,I);this.dirty_=this.dirty_||k}}).bind(this);if(y){var w=[];o.forEachFeatureInExtent(m,function(O){w.push(O)}),w.sort(y);for(var L=0,F=w.length;L<F;++L)S(w[L])}else o.forEachFeatureInExtent(m,S);return I.finish(),this.renderedResolution_=f,this.renderedRevision_=g,this.renderedRenderOrder_=y,this.renderedExtent_=m,this.replayGroup_=I,this.replayGroupChanged=!0,!0},e.prototype.renderFeature=function(t,i,r,o,s){if(!o)return!1;var h=!1;if(Array.isArray(o))for(var l=0,u=o.length;l<u;++l)h=Ue(s,t,o[l],ci(i,r),this.handleStyleImageChange_,this)||h;else h=Ue(s,t,o,ci(i,r),this.handleStyleImageChange_,this);return h},e}(Lr);Ye.handles=function(a){return a.getType()===Kt.VECTOR};Ye.create=function(a,e){return new Ye(e)};const as=Ye,si={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"};var os={image:[b.POLYGON,b.CIRCLE,b.LINE_STRING,b.IMAGE,b.TEXT],hybrid:[b.POLYGON,b.LINE_STRING]},ss={image:[b.DEFAULT],hybrid:[b.IMAGE,b.TEXT,b.DEFAULT],vector:Le},He=function(a){function e(n){a.call(this,n,!0),this.declutterTree_=n.getDeclutter()?ar(9,void 0):null,this.dirty_=!1,this.renderedLayerRevision_,this.tmpTransform_=tt();var t=n.getRenderMode();this.zDirection=t===si.VECTOR?1:0,t!==si.VECTOR&&(this.context=mt()),x(ut,D.CLEAR,this.handleFontsChanged_,this)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){wt(ut,D.CLEAR,this.handleFontsChanged_,this),a.prototype.disposeInternal.call(this)},e.prototype.getTile=function(t,i,r,o,s){var h=a.prototype.getTile.call(this,t,i,r,o,s);return h.getState()===H.LOADED&&(this.createReplayGroup_(h,o,s),this.context&&this.renderTileImage_(h,o,s)),h},e.prototype.getTileImage=function(t){var i=this.getLayer();return t.getImage(i)},e.prototype.prepareFrame=function(t,i){var r=this.getLayer(),o=r.getRevision();return this.renderedLayerRevision_!=o&&(this.renderedTiles.length=0),this.renderedLayerRevision_=o,a.prototype.prepareFrame.call(this,t,i)},e.prototype.createReplayGroup_=function(t,i,r){var o=this,s=this.getLayer(),h=s.getRevision(),l=s.getRenderOrder()||null,u=t.getReplayState(s);if(!(!u.dirty&&u.renderedRevision==h&&u.renderedRenderOrder==l)){for(var d=s.getSource(),p=d.getTileGrid(),c=d.getTileGridForProjection(r),f=c.getResolution(t.tileCoord[0]),v=t.extent,g=function(m,T){var E=t.getTile(t.tileKeys[m]);if(E.getState()==H.LOADED){var C=E.tileCoord,I=p.getTileCoordExtent(C),S=ze(v,I),w=Se(I,S)?null:re(S,s.getRenderBuffer()*f,o.tmpExtent),L=E.getProjection(),F=!1;Zr(r,L)||(F=!0,E.setProjection(r)),u.dirty=!1;var O=new Or(0,S,f,i,d.getOverlaps(),o.declutterTree_,s.getRenderBuffer()),P=ci(f,i),N=function(R){var X,q=R.getStyleFunction()||s.getStyleFunction();if(q&&(X=q(R,f)),X){var j=this.renderFeature(R,P,X,O);this.dirty_=this.dirty_||j,u.dirty=u.dirty||j}},k=E.getFeatures();l&&l!==u.renderedRenderOrder&&k.sort(l);for(var M=0,W=k.length;M<W;++M){var V=k[M];F&&(L.getUnits()==$r.TILE_PIXELS&&(L.setWorldExtent(I),L.setExtent(E.getExtent())),V.getGeometry().transform(L,r)),(!w||ht(w,V.getGeometry().getExtent()))&&N.call(o,V)}O.finish(),E.setReplayGroup(s,t.tileCoord.toString(),O)}},_=0,y=t.tileKeys.length;_<y;++_)g(_);u.renderedRevision=h,u.renderedRenderOrder=l}},e.prototype.forEachFeatureAtCoordinate=function(t,i,r,o,s){var h=i.viewState.resolution,l=i.viewState.rotation;r=r??0;var u=this.getLayer(),d={},p=this.renderedTiles,c,f,v,g;for(v=0,g=p.length;v<g;++v){var _=p[v];if(c=re(_.extent,r*h,c),!!Br(c,t))for(var y=0,m=_.tileKeys.length;y<m;++y){var T=_.getTile(_.tileKeys[y]);if(T.getState()==H.LOADED){var E=T.getReplayGroup(u,_.tileCoord.toString());f=f||E.forEachFeatureAtCoordinate(t,h,l,r,{},function(C){var I=Y(C);if(!(I in d))return d[I]=!0,o.call(s,C,u)},null)}}}return f},e.prototype.getReplayTransform_=function(t,i){var r=this.getLayer(),o=r.getSource(),s=o.getTileGrid(),h=t.tileCoord,l=s.getResolution(h[0]),u=i.viewState,d=i.pixelRatio,p=u.resolution/d,c=s.getTileCoordExtent(h,this.tmpExtent),f=u.center,v=Ji(c),g=i.size,_=Math.round(d*g[0]/2),y=Math.round(d*g[1]/2);return nt(this.tmpTransform_,_,y,l/p,l/p,u.rotation,(v[0]-f[0])/l,(f[1]-v[1])/l)},e.prototype.handleFontsChanged_=function(t){var i=this.getLayer();i.getVisible()&&this.renderedLayerRevision_!==void 0&&i.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.postCompose=function(t,i,r){var o=this.getLayer(),s=o.getRenderMode();if(s!=si.IMAGE){var h=o.getDeclutter()?{}:null,l=o.getSource(),u=ss[s],d=i.pixelRatio,p=i.viewState.rotation,c=i.size,f,v;p&&(f=Math.round(d*c[0]/2),v=Math.round(d*c[1]/2),dt(t,-p,f,v)),h&&this.declutterTree_.clear();for(var g=i.viewHints,_=!(g[U.ANIMATING]||g[U.INTERACTING]),y=this.renderedTiles,m=l.getTileGridForProjection(i.viewState.projection),T=[],E=[],C=y.length-1;C>=0;--C){var I=y[C];if(I.getState()!=H.ABORT)for(var S=I.tileCoord,w=m.getTileCoordExtent(S,this.tmpExtent)[0]-I.extent[0],L=void 0,F=0,O=I.tileKeys.length;F<O;++F){var P=I.getTile(I.tileKeys[F]);if(P.getState()==H.LOADED){var N=P.getReplayGroup(o,S.toString());if(!(!N||!N.hasReplays(u))){L||(L=this.getTransform(i,w));var k=P.tileCoord[0],M=N.getClipCoords(L);t.save(),t.globalAlpha=r.opacity;for(var W=0,V=T.length;W<V;++W){var R=T[W];k<E[W]&&(t.beginPath(),t.moveTo(M[0],M[1]),t.lineTo(M[2],M[3]),t.lineTo(M[4],M[5]),t.lineTo(M[6],M[7]),t.moveTo(R[6],R[7]),t.lineTo(R[4],R[5]),t.lineTo(R[2],R[3]),t.lineTo(R[0],R[1]),t.clip())}N.replay(t,L,p,{},_,u,h),t.restore(),T.push(M),E.push(k)}}}}h&&Bo(h,t,p,_),p&&dt(t,p,f,v)}a.prototype.postCompose.call(this,t,i,r)},e.prototype.renderFeature=function(t,i,r,o){if(!r)return!1;var s=!1;if(Array.isArray(r))for(var h=0,l=r.length;h<l;++h)s=Ue(o,t,r[h],i,this.handleStyleImageChange_,this)||s;else s=Ue(o,t,r,i,this.handleStyleImageChange_,this);return s},e.prototype.renderTileImage_=function(t,i,r){var o=this.getLayer(),s=t.getReplayState(o),h=o.getRevision(),l=os[o.getRenderMode()];if(l&&s.renderedTileRevision!==h){s.renderedTileRevision=h;var u=t.wrappedTileCoord,d=u[0],p=o.getSource(),c=p.getTileGridForProjection(r),f=c.getResolution(d),v=t.getContext(o),g=p.getTilePixelSize(d,i,r);v.canvas.width=g[0],v.canvas.height=g[1];for(var _=c.getTileCoordExtent(u,this.tmpExtent),y=0,m=t.tileKeys.length;y<m;++y){var T=t.getTile(t.tileKeys[y]);if(T.getState()==H.LOADED){var E=i/f,C=mn(this.tmpTransform_);En(C,E,-E),Tn(C,-_[0],-_[3]);var I=T.getReplayGroup(o,t.tileCoord.toString());I.replay(v,C,0,{},!0,l)}}}},e}(wr);He.handles=function(a){return a.getType()===Kt.VECTOR_TILE};He.create=function(a,e){return new He(e)};const hs=He;var ms=function(a){function e(n){n=Oe({},n),n.controls||(n.controls=Da()),n.interactions||(n.interactions=vo()),a.call(this,n)}return a&&(e.__proto__=a),e.prototype=Object.create(a&&a.prototype),e.prototype.constructor=e,e.prototype.createRenderer=function(){var t=new Lo(this);return t.registerLayerRenderers([xo,wr,as,hs]),t},e}(Ea);export{ms as default};
