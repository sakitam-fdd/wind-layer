import{t as _i,c as Ue,L as pi,b as vi}from"./Event.BTHd1TaF.js";import{R as gi}from"./index.C4-A-GQb.js";import{a as yi,r as mi,e as Kt,n as fe,p as xi,E as ce,b as Si}from"./Object.DdgBWT7D.js";import{I as H}from"./ImageState.BQAwWc_S.js";import{a as J,b as Xt,S as Ii,ae as Ci,af as Ti,k as wi,ag as _e,P as U,c as dt,D as ut,a4 as Le,H as jt,$ as Oi,l as ke,g as Nt,q as Di,Q as bt,w as Ri,ah as Ei,x as Fe,ai as Li,aj as ki,B as Fi}from"./proj.BNE8J585.js";import{t as Me}from"./size.DSor2vHC.js";import{d as ot,e as Mi}from"./dom.i4NIYYs1.js";import{e as tt,f as _t,g as Ot,h as Dt,i as Rt,j as Jt,k as Et,l as Lt,m as ht,n as kt,o as Ut,p as Ze,r as Ai,q as Pi,t as Wi,u as Ae,s as Pe}from"./canvas.BECzGFiW.js";import{i as Vt,a as We,c as Be,s as Bi,r as Gi,t as Tt,g as Yi}from"./inflate.CR1fXO-E.js";import{c as Ge,C as Ni}from"./Layer.Bev_0Xed.js";import{a as bi}from"./has.DEIyT5tI.js";import{a as Zt,c as qt,b as ct,s as Vi,d as Hi,m as zi,t as Xi}from"./transform.CU9krZJA.js";import{l as ji}from"./length.Db1PyEzj.js";import{V as Ht}from"./ViewHint.DCjjP5DW.js";import{l as Ji}from"./Image.C3dCXgkY.js";import"./index.cI_fw6Fh.js";import"./Projection.Bg0YEavu.js";var Ui=function(){function o(n){this.opacity_=n.opacity,this.rotateWithView_=n.rotateWithView,this.rotation_=n.rotation,this.scale_=n.scale,this.scaleArray_=Me(n.scale),this.displacement_=n.displacement,this.declutterMode_=n.declutterMode}return o.prototype.clone=function(){var n=this.getScale();return new o({opacity:this.getOpacity(),scale:Array.isArray(n)?n.slice():n,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})},o.prototype.getOpacity=function(){return this.opacity_},o.prototype.getRotateWithView=function(){return this.rotateWithView_},o.prototype.getRotation=function(){return this.rotation_},o.prototype.getScale=function(){return this.scale_},o.prototype.getScaleArray=function(){return this.scaleArray_},o.prototype.getDisplacement=function(){return this.displacement_},o.prototype.getDeclutterMode=function(){return this.declutterMode_},o.prototype.getAnchor=function(){return J()},o.prototype.getImage=function(n){return J()},o.prototype.getHitDetectionImage=function(){return J()},o.prototype.getPixelRatio=function(n){return 1},o.prototype.getImageState=function(){return J()},o.prototype.getImageSize=function(){return J()},o.prototype.getOrigin=function(){return J()},o.prototype.getSize=function(){return J()},o.prototype.setDisplacement=function(n){this.displacement_=n},o.prototype.setOpacity=function(n){this.opacity_=n},o.prototype.setRotateWithView=function(n){this.rotateWithView_=n},o.prototype.setRotation=function(n){this.rotation_=n},o.prototype.setScale=function(n){this.scale_=n,this.scaleArray_=Me(n)},o.prototype.listenImageChange=function(n){J()},o.prototype.load=function(){J()},o.prototype.unlistenImageChange=function(n){J()},o}();const qe=Ui;function q(o){return Array.isArray(o)?_i(o):o}var Zi=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),qi=function(o){Zi(n,o);function n(t){var e=this,i=t.rotateWithView!==void 0?t.rotateWithView:!1;return e=o.call(this,{opacity:1,rotateWithView:i,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})||this,e.canvas_=void 0,e.hitDetectionCanvas_=null,e.fill_=t.fill!==void 0?t.fill:null,e.origin_=[0,0],e.points_=t.points,e.radius_=t.radius!==void 0?t.radius:t.radius1,e.radius2_=t.radius2,e.angle_=t.angle!==void 0?t.angle:0,e.stroke_=t.stroke!==void 0?t.stroke:null,e.size_=null,e.renderOptions_=null,e.render(),e}return n.prototype.clone=function(){var t=this.getScale(),e=new n({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e},n.prototype.getAnchor=function(){var t=this.size_;if(!t)return null;var e=this.getDisplacement();return[t[0]/2-e[0],t[1]/2+e[1]]},n.prototype.getAngle=function(){return this.angle_},n.prototype.getFill=function(){return this.fill_},n.prototype.setFill=function(t){this.fill_=t,this.render()},n.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},n.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var i=this.renderOptions_,r=ot(i.size*t,i.size*t);this.draw_(i,r,t),e=r.canvas,this.canvas_[t]=e}return e},n.prototype.getPixelRatio=function(t){return t},n.prototype.getImageSize=function(){return this.size_},n.prototype.getImageState=function(){return H.LOADED},n.prototype.getOrigin=function(){return this.origin_},n.prototype.getPoints=function(){return this.points_},n.prototype.getRadius=function(){return this.radius_},n.prototype.getRadius2=function(){return this.radius2_},n.prototype.getSize=function(){return this.size_},n.prototype.getStroke=function(){return this.stroke_},n.prototype.setStroke=function(t){this.stroke_=t,this.render()},n.prototype.listenImageChange=function(t){},n.prototype.load=function(){},n.prototype.unlistenImageChange=function(t){},n.prototype.calculateLineJoinSize_=function(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;var r=this.radius_,a=this.radius2_===void 0?r:this.radius2_;if(r<a){var s=r;r=a,a=s}var l=this.radius2_===void 0?this.points_:this.points_*2,h=2*Math.PI/l,u=a*Math.sin(h),f=Math.sqrt(a*a-u*u),c=r-f,d=Math.sqrt(u*u+c*c),_=d/u;if(t==="miter"&&_<=i)return _*e;var p=e/2/_,v=e/2*(c/d),y=Math.sqrt((r+p)*(r+p)+v*v),m=y-r;if(this.radius2_===void 0||t==="bevel")return m*2;var x=r*Math.sin(h),w=Math.sqrt(r*r-x*x),C=a-w,S=Math.sqrt(x*x+C*C),O=S/x;if(O<=i){var T=O*e/2-a-r;return 2*Math.max(m,T)}return m*2},n.prototype.createRenderOptions=function(){var t=_t,e=0,i=null,r=0,a,s=0;this.stroke_&&(a=this.stroke_.getColor(),a===null&&(a=Ot),a=q(a),s=this.stroke_.getWidth(),s===void 0&&(s=Dt),i=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=_t),e=this.stroke_.getMiterLimit(),e===void 0&&(e=Rt));var l=this.calculateLineJoinSize_(t,s,e),h=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*h+l);return{strokeStyle:a,strokeWidth:s,size:u,lineDash:i,lineDashOffset:r,lineJoin:t,miterLimit:e}},n.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]},n.prototype.draw_=function(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var r=this.fill_.getColor();r===null&&(r=tt),e.fillStyle=q(r),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},n.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),i=0;if(typeof e=="string"&&(e=Ue(e)),e===null?i=1:Array.isArray(e)&&(i=e.length===4?e[3]:1),i===0){var r=ot(t.size,t.size);this.hitDetectionCanvas_=r.canvas,this.drawHitDetectionCanvas_(t,r)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},n.prototype.createPath_=function(t){var e=this.points_,i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{var r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);for(var a=this.angle_-Math.PI/2,s=2*Math.PI/e,l=0;l<e;l++){var h=a+l*s,u=l%2===0?i:r;t.lineTo(u*Math.cos(h),u*Math.sin(h))}t.closePath()}},n.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=tt,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},n}(qe);const Ki=qi;var $i=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Qi=function(o){$i(n,o);function n(t){var e=t||{};return o.call(this,{points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})||this}return n.prototype.clone=function(){var t=this.getScale(),e=new n({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e},n.prototype.setRadius=function(t){this.radius_=t,this.render()},n}(Ki),tn=function(){function o(n){var t=n||{};this.color_=t.color!==void 0?t.color:null}return o.prototype.clone=function(){var n=this.getColor();return new o({color:Array.isArray(n)?n.slice():n||void 0})},o.prototype.getColor=function(){return this.color_},o.prototype.setColor=function(n){this.color_=n},o}(),en=function(){function o(n){var t=n||{};this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}return o.prototype.clone=function(){var n=this.getColor();return new o({color:Array.isArray(n)?n.slice():n||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},o.prototype.getColor=function(){return this.color_},o.prototype.getLineCap=function(){return this.lineCap_},o.prototype.getLineDash=function(){return this.lineDash_},o.prototype.getLineDashOffset=function(){return this.lineDashOffset_},o.prototype.getLineJoin=function(){return this.lineJoin_},o.prototype.getMiterLimit=function(){return this.miterLimit_},o.prototype.getWidth=function(){return this.width_},o.prototype.setColor=function(n){this.color_=n},o.prototype.setLineCap=function(n){this.lineCap_=n},o.prototype.setLineDash=function(n){this.lineDash_=n},o.prototype.setLineDashOffset=function(n){this.lineDashOffset_=n},o.prototype.setLineJoin=function(n){this.lineJoin_=n},o.prototype.setMiterLimit=function(n){this.miterLimit_=n},o.prototype.setWidth=function(n){this.width_=n},o}(),nn=function(){function o(n){var t=n||{};this.geometry_=null,this.geometryFunction_=Ye,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}return o.prototype.clone=function(){var n=this.getGeometry();return n&&typeof n=="object"&&(n=n.clone()),new o({geometry:n,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},o.prototype.getRenderer=function(){return this.renderer_},o.prototype.setRenderer=function(n){this.renderer_=n},o.prototype.setHitDetectionRenderer=function(n){this.hitDetectionRenderer_=n},o.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},o.prototype.getGeometry=function(){return this.geometry_},o.prototype.getGeometryFunction=function(){return this.geometryFunction_},o.prototype.getFill=function(){return this.fill_},o.prototype.setFill=function(n){this.fill_=n},o.prototype.getImage=function(){return this.image_},o.prototype.setImage=function(n){this.image_=n},o.prototype.getStroke=function(){return this.stroke_},o.prototype.setStroke=function(n){this.stroke_=n},o.prototype.getText=function(){return this.text_},o.prototype.setText=function(n){this.text_=n},o.prototype.getZIndex=function(){return this.zIndex_},o.prototype.setGeometry=function(n){typeof n=="function"?this.geometryFunction_=n:typeof n=="string"?this.geometryFunction_=function(t){return t.get(n)}:n?n!==void 0&&(this.geometryFunction_=function(){return n}):this.geometryFunction_=Ye,this.geometry_=n},o.prototype.setZIndex=function(n){this.zIndex_=n},o}();function rn(o){var n;if(typeof o=="function")n=o;else{var t;if(Array.isArray(o))t=o;else{Xt(typeof o.getZIndex=="function",41);var e=o;t=[e]}n=function(){return t}}return n}var he=null;function an(o,n){if(!he){var t=new tn({color:"rgba(255,255,255,0.4)"}),e=new en({color:"#3399CC",width:1.25});he=[new nn({image:new Qi({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return he}function Ye(o){return o.getGeometry()}var on=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ne={RENDER_ORDER:"renderOrder"},sn=function(o){on(n,o);function n(t){var e=this,i=t||{},r=yi({},i);return delete r.style,delete r.renderBuffer,delete r.updateWhileAnimating,delete r.updateWhileInteracting,e=o.call(this,r)||this,e.declutter_=i.declutter!==void 0?i.declutter:!1,e.renderBuffer_=i.renderBuffer!==void 0?i.renderBuffer:100,e.style_=null,e.styleFunction_=void 0,e.setStyle(i.style),e.updateWhileAnimating_=i.updateWhileAnimating!==void 0?i.updateWhileAnimating:!1,e.updateWhileInteracting_=i.updateWhileInteracting!==void 0?i.updateWhileInteracting:!1,e}return n.prototype.getDeclutter=function(){return this.declutter_},n.prototype.getFeatures=function(t){return o.prototype.getFeatures.call(this,t)},n.prototype.getRenderBuffer=function(){return this.renderBuffer_},n.prototype.getRenderOrder=function(){return this.get(Ne.RENDER_ORDER)},n.prototype.getStyle=function(){return this.style_},n.prototype.getStyleFunction=function(){return this.styleFunction_},n.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},n.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},n.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new gi(9)),this.getRenderer().renderDeclutter(t)},n.prototype.setRenderOrder=function(t){this.set(Ne.RENDER_ORDER,t)},n.prototype.setStyle=function(t){this.style_=t!==void 0?t:an,this.styleFunction_=t===null?void 0:rn(this.style_),this.changed()},n}(pi);const hn=sn;var I={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},zt=[I.FILL],at=[I.STROKE],lt=[I.BEGIN_PATH],be=[I.CLOSE_PATH],ln=function(){function o(){}return o.prototype.drawCustom=function(n,t,e,i){},o.prototype.drawGeometry=function(n){},o.prototype.setStyle=function(n){},o.prototype.drawCircle=function(n,t){},o.prototype.drawFeature=function(n,t){},o.prototype.drawGeometryCollection=function(n,t){},o.prototype.drawLineString=function(n,t){},o.prototype.drawMultiLineString=function(n,t){},o.prototype.drawMultiPoint=function(n,t){},o.prototype.drawMultiPolygon=function(n,t){},o.prototype.drawPoint=function(n,t){},o.prototype.drawPolygon=function(n,t){},o.prototype.drawText=function(n,t){},o.prototype.setFillStrokeStyle=function(n,t){},o.prototype.setImageStyle=function(n,t){},o.prototype.setTextStyle=function(n,t){},o}();const Ke=ln;var un=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),fn=function(o){un(n,o);function n(t,e,i,r){var a=o.call(this)||this;return a.tolerance=t,a.maxExtent=e,a.pixelRatio=r,a.maxLineWidth=0,a.resolution=i,a.beginGeometryInstruction1_=null,a.beginGeometryInstruction2_=null,a.bufferedMaxExtent_=null,a.instructions=[],a.coordinates=[],a.tmpCoordinate_=[],a.hitDetectionInstructions=[],a.state={},a}return n.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})},n.prototype.appendFlatPointCoordinates=function(t,e){for(var i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,a=this.coordinates,s=a.length,l=0,h=t.length;l<h;l+=e)r[0]=t[l],r[1]=t[l+1],Ii(i,r)&&(a[s++]=r[0],a[s++]=r[1]);return s},n.prototype.appendFlatLineCoordinates=function(t,e,i,r,a,s){var l=this.coordinates,h=l.length,u=this.getBufferedMaxExtent();s&&(e+=r);var f=t[e],c=t[e+1],d=this.tmpCoordinate_,_=!0,p,v,y;for(p=e+r;p<i;p+=r)d[0]=t[p],d[1]=t[p+1],y=Ci(u,d),y!==v?(_&&(l[h++]=f,l[h++]=c,_=!1),l[h++]=d[0],l[h++]=d[1]):y===Ti.INTERSECTING?(l[h++]=d[0],l[h++]=d[1],_=!1):_=!0,f=d[0],c=d[1],v=y;return(a&&_||p===e+r)&&(l[h++]=f,l[h++]=c),h},n.prototype.drawCustomCoordinates_=function(t,e,i,r,a){for(var s=0,l=i.length;s<l;++s){var h=i[s],u=this.appendFlatLineCoordinates(t,e,h,r,!1,!1);a.push(u),e=h}return e},n.prototype.drawCustom=function(t,e,i,r){this.beginGeometry(t,e);var a=t.getType(),s=t.getStride(),l=this.coordinates.length,h,u,f,c,d;switch(a){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),c=[];var _=t.getEndss();d=0;for(var p=0,v=_.length;p<v;++p){var y=[];d=this.drawCustomCoordinates_(h,d,_[p],s,y),c.push(y)}this.instructions.push([I.CUSTOM,l,c,t,i,Be]),this.hitDetectionInstructions.push([I.CUSTOM,l,c,t,r||i,Be]);break;case"Polygon":case"MultiLineString":f=[],h=a=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(h,0,t.getEnds(),s,f),this.instructions.push([I.CUSTOM,l,f,t,i,We]),this.hitDetectionInstructions.push([I.CUSTOM,l,f,t,r||i,We]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(h,0,h.length,s,!1,!1),this.instructions.push([I.CUSTOM,l,u,t,i,Vt]),this.hitDetectionInstructions.push([I.CUSTOM,l,u,t,r||i,Vt]);break;case"MultiPoint":h=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(h,s),u>l&&(this.instructions.push([I.CUSTOM,l,u,t,i,Vt]),this.hitDetectionInstructions.push([I.CUSTOM,l,u,t,r||i,Vt]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),u=this.coordinates.length,this.instructions.push([I.CUSTOM,l,u,t,i]),this.hitDetectionInstructions.push([I.CUSTOM,l,u,t,r||i]);break}this.endGeometry(e)},n.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[I.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[I.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},n.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},n.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var e,i=t.length,r,a,s=-1;for(e=0;e<i;++e)r=t[e],a=r[0],a==I.END_GEOMETRY?s=e:a==I.BEGIN_GEOMETRY&&(r[2]=e,mi(this.hitDetectionInstructions,s,e),s=-1)},n.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var r=t.getColor();i.fillStyle=q(r||tt)}else i.fillStyle=void 0;if(e){var a=e.getColor();i.strokeStyle=q(a||Ot);var s=e.getLineCap();i.lineCap=s!==void 0?s:Jt;var l=e.getLineDash();i.lineDash=l?l.slice():Et;var h=e.getLineDashOffset();i.lineDashOffset=h||Lt;var u=e.getLineJoin();i.lineJoin=u!==void 0?u:_t;var f=e.getWidth();i.lineWidth=f!==void 0?f:Dt;var c=e.getMiterLimit();i.miterLimit=c!==void 0?c:Rt,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0},n.prototype.createFill=function(t){var e=t.fillStyle,i=[I.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(!0),i},n.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},n.prototype.createStroke=function(t){return[I.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},n.prototype.updateFillStyle=function(t,e){var i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)},n.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,r=t.lineCap,a=t.lineDash,s=t.lineDashOffset,l=t.lineJoin,h=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=r||a!=t.currentLineDash&&!Kt(t.currentLineDash,a)||t.currentLineDashOffset!=s||t.currentLineJoin!=l||t.currentLineWidth!=h||t.currentMiterLimit!=u)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=r,t.currentLineDash=a,t.currentLineDashOffset=s,t.currentLineJoin=l,t.currentLineWidth=h,t.currentMiterLimit=u)},n.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[I.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},n.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=wi(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;_e(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},n}(Ke);const Ft=fn;var cn=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),dn=function(o){cn(n,o);function n(t,e,i,r){var a=o.call(this,t,e,i,r)||this;return a.hitDetectionImage_=null,a.image_=null,a.imagePixelRatio_=void 0,a.anchorX_=void 0,a.anchorY_=void 0,a.height_=void 0,a.opacity_=void 0,a.originX_=void 0,a.originY_=void 0,a.rotateWithView_=void 0,a.rotation_=void 0,a.scale_=void 0,a.width_=void 0,a.declutterMode_=void 0,a.declutterImageWithText_=void 0,a}return n.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),r=t.getStride(),a=this.coordinates.length,s=this.appendFlatPointCoordinates(i,r);this.instructions.push([I.DRAW_IMAGE,a,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,a,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}},n.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),r=t.getStride(),a=this.coordinates.length,s=this.appendFlatPointCoordinates(i,r);this.instructions.push([I.DRAW_IMAGE,a,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,a,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}},n.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,o.prototype.finish.call(this)},n.prototype.setImageStyle=function(t,e){var i=t.getAnchor(),r=t.getSize(),a=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=a[0],this.originY_=a[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=r[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e},n}(Ft);const _n=dn;var pn=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),vn=function(o){pn(n,o);function n(t,e,i,r){return o.call(this,t,e,i,r)||this}return n.prototype.drawFlatCoordinates_=function(t,e,i,r){var a=this.coordinates.length,s=this.appendFlatLineCoordinates(t,e,i,r,!1,!1),l=[I.MOVE_TO_LINE_TO,a,s];return this.instructions.push(l),this.hitDetectionInstructions.push(l),i},n.prototype.drawLineString=function(t,e){var i=this.state,r=i.strokeStyle,a=i.lineWidth;if(!(r===void 0||a===void 0)){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Et,Lt],lt);var s=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(s,0,s.length,l),this.hitDetectionInstructions.push(at),this.endGeometry(e)}},n.prototype.drawMultiLineString=function(t,e){var i=this.state,r=i.strokeStyle,a=i.lineWidth;if(!(r===void 0||a===void 0)){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],lt);for(var s=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride(),u=0,f=0,c=s.length;f<c;++f)u=this.drawFlatCoordinates_(l,u,s[f],h);this.hitDetectionInstructions.push(at),this.endGeometry(e)}},n.prototype.finish=function(){var t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(at),this.reverseHitDetectionInstructions(),this.state=null,o.prototype.finish.call(this)},n.prototype.applyStroke=function(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(at),t.lastStroke=this.coordinates.length),t.lastStroke=0,o.prototype.applyStroke.call(this,t),this.instructions.push(lt)},n}(Ft);const gn=vn;var yn=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),mn=function(o){yn(n,o);function n(t,e,i,r){return o.call(this,t,e,i,r)||this}return n.prototype.drawFlatCoordinatess_=function(t,e,i,r){var a=this.state,s=a.fillStyle!==void 0,l=a.strokeStyle!==void 0,h=i.length;this.instructions.push(lt),this.hitDetectionInstructions.push(lt);for(var u=0;u<h;++u){var f=i[u],c=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,f,r,!0,!l),_=[I.MOVE_TO_LINE_TO,c,d];this.instructions.push(_),this.hitDetectionInstructions.push(_),l&&(this.instructions.push(be),this.hitDetectionInstructions.push(be)),e=f}return s&&(this.instructions.push(zt),this.hitDetectionInstructions.push(zt)),l&&(this.instructions.push(at),this.hitDetectionInstructions.push(at)),e},n.prototype.drawCircle=function(t,e){var i=this.state,r=i.fillStyle,a=i.strokeStyle;if(!(r===void 0&&a===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,tt]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var s=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(s,0,s.length,l,!1,!1);var u=[I.CIRCLE,h];this.instructions.push(lt,u),this.hitDetectionInstructions.push(lt,u),i.fillStyle!==void 0&&(this.instructions.push(zt),this.hitDetectionInstructions.push(zt)),i.strokeStyle!==void 0&&(this.instructions.push(at),this.hitDetectionInstructions.push(at)),this.endGeometry(e)}},n.prototype.drawPolygon=function(t,e){var i=this.state,r=i.fillStyle,a=i.strokeStyle;if(!(r===void 0&&a===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,tt]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var s=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,s,h),this.endGeometry(e)}},n.prototype.drawMultiPolygon=function(t,e){var i=this.state,r=i.fillStyle,a=i.strokeStyle;if(!(r===void 0&&a===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,tt]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);for(var s=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride(),u=0,f=0,c=s.length;f<c;++f)u=this.drawFlatCoordinatess_(l,u,s[f],h);this.endGeometry(e)}},n.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(t!==0)for(var e=this.coordinates,i=0,r=e.length;i<r;++i)e[i]=Bi(e[i],t);return o.prototype.finish.call(this)},n.prototype.setFillStrokeStyles_=function(){var t=this.state,e=t.fillStyle;e!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)},n}(Ft);const Ve=mn,xn={POINT:"point",LINE:"line"};function Sn(o,n,t,e,i){var r=t,a=t,s=0,l=0,h=t,u,f,c,d,_,p,v,y,m,x;for(f=t;f<e;f+=i){var w=n[f],C=n[f+1];_!==void 0&&(m=w-_,x=C-p,d=Math.sqrt(m*m+x*x),v!==void 0&&(l+=c,u=Math.acos((v*m+y*x)/(c*d)),u>o&&(l>s&&(s=l,r=h,a=f),l=0,h=f-i)),c=d,v=m,y=x),_=w,p=C}return l+=d,l>s?[h,f]:[r,a]}var In=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),wt={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Cn=function(o){In(n,o);function n(t,e,i,r){var a=o.call(this,t,e,i,r)||this;return a.labels_=null,a.text_="",a.textOffsetX_=0,a.textOffsetY_=0,a.textRotateWithView_=void 0,a.textRotation_=0,a.textFillState_=null,a.fillStates={},a.textStrokeState_=null,a.strokeStates={},a.textState_={},a.textStates={},a.textKey_="",a.fillKey_="",a.strokeKey_="",a.declutterImageWithText_=void 0,a}return n.prototype.finish=function(){var t=o.prototype.finish.call(this);return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t},n.prototype.drawText=function(t,e){var i=this.textFillState_,r=this.textStrokeState_,a=this.textState_;if(!(this.text_===""||!a||!i&&!r)){var s=this.coordinates,l=s.length,h=t.getType(),u=null,f=t.getStride();if(a.placement===xn.LINE&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!U(this.getBufferedMaxExtent(),t.getExtent()))return;var c=void 0;if(u=t.getFlatCoordinates(),h=="LineString")c=[u.length];else if(h=="MultiLineString")c=t.getEnds();else if(h=="Polygon")c=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){var d=t.getEndss();c=[];for(var _=0,p=d.length;_<p;++_)c.push(d[_][0])}this.beginGeometry(t,e);for(var v=a.textAlign,y=0,m=void 0,x=0,w=c.length;x<w;++x){if(v==null){var C=Sn(a.maxAngle,u,y,c[x],f);y=C[0],m=C[1]}else m=c[x];for(var _=y;_<m;_+=f)s.push(u[_],u[_+1]);var S=s.length;y=c[x],this.drawChars_(l,S),l=S}this.endGeometry(e)}else{var O=a.overflow?null:[];switch(h){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),f=2;break;case"Polygon":u=t.getFlatInteriorPoint(),a.overflow||O.push(u[2]/this.resolution),f=3;break;case"MultiPolygon":var T=t.getFlatInteriorPoints();u=[];for(var _=0,p=T.length;_<p;_+=3)a.overflow||O.push(T[_+2]/this.resolution),u.push(T[_],T[_+1]);if(u.length===0)return;f=2;break}var S=this.appendFlatPointCoordinates(u,f);if(S===l)return;if(O&&(S-l)/2!==u.length/f){var D=l/2;O=O.filter(function(P,A){var W=s[(D+A)*2]===u[A*f]&&s[(D+A)*2+1]===u[A*f+1];return W||--D,W})}this.saveTextStates_(),(a.backgroundFill||a.backgroundStroke)&&(this.setFillStrokeStyle(a.backgroundFill,a.backgroundStroke),a.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),a.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var L=a.padding;if(L!=ht&&(a.scale[0]<0||a.scale[1]<0)){var F=a.padding[0],E=a.padding[1],R=a.padding[2],k=a.padding[3];a.scale[0]<0&&(E=-E,k=-k),a.scale[1]<0&&(F=-F,R=-R),L=[F,E,R,k]}var G=this.pixelRatio;this.instructions.push([I.DRAW_IMAGE,l,S,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,L==ht?ht:L.map(function(P){return P*G}),!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,O]);var B=1/G;this.hitDetectionInstructions.push([I.DRAW_IMAGE,l,S,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[B,B],NaN,void 0,this.declutterImageWithText_,L,!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,O]),this.endGeometry(e)}}},n.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var a=this.textKey_;a in this.textStates||(this.textStates[a]={font:e.font,textAlign:e.textAlign||kt,justify:e.justify,textBaseline:e.textBaseline||Ut,scale:e.scale});var s=this.fillKey_;i&&(s in this.fillStates||(this.fillStates[s]={fillStyle:i.fillStyle}))},n.prototype.drawChars_=function(t,e){var i=this.textStrokeState_,r=this.textState_,a=this.strokeKey_,s=this.textKey_,l=this.fillKey_;this.saveTextStates_();var h=this.pixelRatio,u=wt[r.textBaseline],f=this.textOffsetY_*h,c=this.text_,d=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([I.DRAW_CHARS,t,e,u,r.overflow,l,r.maxAngle,h,f,a,d*h,c,s,1]),this.hitDetectionInstructions.push([I.DRAW_CHARS,t,e,u,r.overflow,l,r.maxAngle,1,f,a,d,c,s,1/h])},n.prototype.setTextStyle=function(t,e){var i,r,a;if(!t)this.text_="";else{var s=t.getFill();s?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=q(s.getColor()||tt)):(r=null,this.textFillState_=r);var l=t.getStroke();if(!l)a=null,this.textStrokeState_=a;else{a=this.textStrokeState_,a||(a={},this.textStrokeState_=a);var h=l.getLineDash(),u=l.getLineDashOffset(),f=l.getWidth(),c=l.getMiterLimit();a.lineCap=l.getLineCap()||Jt,a.lineDash=h?h.slice():Et,a.lineDashOffset=u===void 0?Lt:u,a.lineJoin=l.getLineJoin()||_t,a.lineWidth=f===void 0?Dt:f,a.miterLimit=c===void 0?Rt:c,a.strokeStyle=q(l.getColor()||Ot)}i=this.textState_;var d=t.getFont()||Ze;Ai(d);var _=t.getScaleArray();i.overflow=t.getOverflow(),i.font=d,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Ut,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||ht,i.scale=_===void 0?[1,1]:_;var p=t.getOffsetX(),v=t.getOffsetY(),y=t.getRotateWithView(),m=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=p===void 0?0:p,this.textOffsetY_=v===void 0?0:v,this.textRotateWithView_=y===void 0?!1:y,this.textRotation_=m===void 0?0:m,this.strokeKey_=a?(typeof a.strokeStyle=="string"?a.strokeStyle:dt(a.strokeStyle))+a.lineCap+a.lineDashOffset+"|"+a.lineWidth+a.lineJoin+a.miterLimit+"["+a.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r?typeof r.fillStyle=="string"?r.fillStyle:"|"+dt(r.fillStyle):""}this.declutterImageWithText_=e},n}(Ft),Tn={Circle:Ve,Default:Ft,Image:_n,LineString:gn,Polygon:Ve,Text:Cn},He=function(){function o(n,t,e,i){this.tolerance_=n,this.maxExtent_=t,this.pixelRatio_=i,this.resolution_=e,this.buildersByZIndex_={}}return o.prototype.finish=function(){var n={};for(var t in this.buildersByZIndex_){n[t]=n[t]||{};var e=this.buildersByZIndex_[t];for(var i in e){var r=e[i].finish();n[t][i]=r}}return n},o.prototype.getBuilder=function(n,t){var e=n!==void 0?n.toString():"0",i=this.buildersByZIndex_[e];i===void 0&&(i={},this.buildersByZIndex_[e]=i);var r=i[t];if(r===void 0){var a=Tn[t];r=new a(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[t]=r}return r},o}();function wn(o,n,t,e,i,r,a,s,l,h,u,f){var c=o[n],d=o[n+1],_=0,p=0,v=0,y=0;function m(){_=c,p=d,n+=e,c=o[n],d=o[n+1],y+=v,v=Math.sqrt((c-_)*(c-_)+(d-p)*(d-p))}do m();while(n<t-e&&y+v<r);for(var x=v===0?0:(r-y)/v,w=ut(_,c,x),C=ut(p,d,x),S=n-e,O=y,T=r+s*l(h,i,u);n<t-e&&y+v<T;)m();x=v===0?0:(T-y)/v;var D=ut(_,c,x),L=ut(p,d,x),F;if(f){var E=[w,C,D,L];Gi(E,0,4,2,f,E,E),F=E[0]>E[2]}else F=w>D;var R=Math.PI,k=[],G=S+e===n;n=S,v=0,y=O,c=o[n],d=o[n+1];var B;if(G){m(),B=Math.atan2(d-p,c-_),F&&(B+=B>0?-R:R);var M=(D+w)/2,P=(L+C)/2;return k[0]=[M,P,(T-r)/2,B,i],k}i=i.replace(/\n/g," ");for(var A=0,W=i.length;A<W;){m();var Y=Math.atan2(d-p,c-_);if(F&&(Y+=Y>0?-R:R),B!==void 0){var g=Y-B;if(g+=g>R?-2*R:g<-R?2*R:0,Math.abs(g)>a)return null}B=Y;for(var b=A,N=0;A<W;++A){var K=F?W-A-1:A,st=s*l(h,i[K],u);if(n+e<t&&y+v<r+N+st/2)break;N+=st}if(A!==b){var pt=F?i.substring(W-b,W-A):i.substring(b,A);x=v===0?0:(r+N/2-y)/v;var M=ut(_,c,x),P=ut(p,d,x);k.push([M,P,N/2,Y,pt]),r+=N}}return k}var ft=jt(),it=[],$=[],Q=[],nt=[];function ze(o){return o[3].declutterBox}var On=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function Xe(o,n){return(n==="start"||n==="end")&&!On.test(o)&&(n=n==="start"?"left":"right"),wt[n]}function Dn(o,n,t){return t>0&&o.push(`
`,""),o.push(n,""),o}var Rn=function(){function o(n,t,e,i){this.overlaps=e,this.pixelRatio=t,this.resolution=n,this.alignFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=Zt(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={}}return o.prototype.createLabel=function(n,t,e,i){var r=n+t+e+i;if(this.labels_[r])return this.labels_[r];var a=i?this.strokeStates[i]:null,s=e?this.fillStates[e]:null,l=this.textStates[t],h=this.pixelRatio,u=[l.scale[0]*h,l.scale[1]*h],f=Array.isArray(n),c=l.justify?wt[l.justify]:Xe(Array.isArray(n)?n[0]:n,l.textAlign||kt),d=i&&a.lineWidth?a.lineWidth:0,_=f?n:n.split(`
`).reduce(Dn,[]),p=Pi(l,_),v=p.width,y=p.height,m=p.widths,x=p.heights,w=p.lineWidths,C=v+d,S=[],O=(C+2)*u[0],T=(y+d)*u[1],D={width:O<0?Math.floor(O):Math.ceil(O),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:S};if((u[0]!=1||u[1]!=1)&&S.push("scale",u),i){S.push("strokeStyle",a.strokeStyle),S.push("lineWidth",d),S.push("lineCap",a.lineCap),S.push("lineJoin",a.lineJoin),S.push("miterLimit",a.miterLimit);var L=bi?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D;L.prototype.setLineDash&&(S.push("setLineDash",[a.lineDash]),S.push("lineDashOffset",a.lineDashOffset))}e&&S.push("fillStyle",s.fillStyle),S.push("textBaseline","middle"),S.push("textAlign","center");for(var F=.5-c,E=c*C+F*d,R=[],k=[],G=0,B=0,M=0,P=0,A,W=0,Y=_.length;W<Y;W+=2){var g=_[W];if(g===`
`){B+=G,G=0,E=c*C+F*d,++P;continue}var b=_[W+1]||l.font;b!==A&&(i&&R.push("font",b),e&&k.push("font",b),A=b),G=Math.max(G,x[M]);var N=[g,E+F*m[M]+c*(m[M]-w[P]),.5*(d+G)+B];E+=m[M],i&&R.push("strokeText",N),e&&k.push("fillText",N),++M}return Array.prototype.push.apply(S,R),Array.prototype.push.apply(S,k),this.labels_[r]=D,D},o.prototype.replayTextBackground_=function(n,t,e,i,r,a,s){n.beginPath(),n.moveTo.apply(n,t),n.lineTo.apply(n,e),n.lineTo.apply(n,i),n.lineTo.apply(n,r),n.lineTo.apply(n,t),a&&(this.alignFill_=a[2],this.fill_(n)),s&&(this.setStrokeStyle_(n,s),n.stroke())},o.prototype.calculateImageOrLabelDimensions_=function(n,t,e,i,r,a,s,l,h,u,f,c,d,_,p,v){s*=c[0],l*=c[1];var y=e-s,m=i-l,x=r+h>n?n-h:r,w=a+u>t?t-u:a,C=_[3]+x*c[0]+_[1],S=_[0]+w*c[1]+_[2],O=y-_[3],T=m-_[0];(p||f!==0)&&(it[0]=O,nt[0]=O,it[1]=T,$[1]=T,$[0]=O+C,Q[0]=$[0],Q[1]=T+S,nt[1]=Q[1]);var D;return f!==0?(D=qt(Zt(),e,i,1,1,f,-e,-i),ct(D,it),ct(D,$),ct(D,Q),ct(D,nt),Le(Math.min(it[0],$[0],Q[0],nt[0]),Math.min(it[1],$[1],Q[1],nt[1]),Math.max(it[0],$[0],Q[0],nt[0]),Math.max(it[1],$[1],Q[1],nt[1]),ft)):Le(Math.min(O,O+C),Math.min(T,T+S),Math.max(O,O+C),Math.max(T,T+S),ft),d&&(y=Math.round(y),m=Math.round(m)),{drawImageX:y,drawImageY:m,drawImageW:x,drawImageH:w,originX:h,originY:u,declutterBox:{minX:ft[0],minY:ft[1],maxX:ft[2],maxY:ft[3],value:v},canvasTransform:D,scale:c}},o.prototype.replayImageOrLabel_=function(n,t,e,i,r,a,s){var l=!!(a||s),h=i.declutterBox,u=n.canvas,f=s?s[2]*i.scale[0]/2:0,c=h.minX-f<=u.width/t&&h.maxX+f>=0&&h.minY-f<=u.height/t&&h.maxY+f>=0;return c&&(l&&this.replayTextBackground_(n,it,$,Q,nt,a,s),Wi(n,i.canvasTransform,r,e,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0},o.prototype.fill_=function(n){if(this.alignFill_){var t=ct(this.renderedTransform_,[0,0]),e=512*this.pixelRatio;n.save(),n.translate(t[0]%e,t[1]%e),n.rotate(this.viewRotation_)}n.fill(),this.alignFill_&&n.restore()},o.prototype.setStrokeStyle_=function(n,t){n.strokeStyle=t[1],n.lineWidth=t[2],n.lineCap=t[3],n.lineJoin=t[4],n.miterLimit=t[5],n.setLineDash&&(n.lineDashOffset=t[7],n.setLineDash(t[6]))},o.prototype.drawLabelWithPointPlacement_=function(n,t,e,i){var r=this.textStates[t],a=this.createLabel(n,t,i,e),s=this.strokeStates[e],l=this.pixelRatio,h=Xe(Array.isArray(n)?n[0]:n,r.textAlign||kt),u=wt[r.textBaseline||Ut],f=s&&s.lineWidth?s.lineWidth:0,c=a.width/l-2*r.scale[0],d=h*c+2*(.5-h)*f,_=u*a.height/l+2*(.5-u)*f;return{label:a,anchorX:d,anchorY:_}},o.prototype.execute_=function(n,t,e,i,r,a,s,l){var h;this.pixelCoordinates_&&Kt(e,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Tt(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_),Vi(this.renderedTransform_,e));for(var u=0,f=i.length,c=0,d,_,p,v,y,m,x,w,C,S,O,T,D=0,L=0,F=null,E=null,R=this.coordinateCache_,k=this.viewRotation_,G=Math.round(Math.atan2(-e[1],e[0])*1e12)/1e12,B={context:n,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:k},M=this.instructions!=i||this.overlaps?0:200,P,A,W,Y;u<f;){var g=i[u],b=g[0];switch(b){case I.BEGIN_GEOMETRY:P=g[1],Y=g[3],P.getGeometry()?s!==void 0&&!U(s,Y.getExtent())?u=g[2]+1:++u:u=g[2];break;case I.BEGIN_PATH:D>M&&(this.fill_(n),D=0),L>M&&(n.stroke(),L=0),!D&&!L&&(n.beginPath(),v=NaN,y=NaN),++u;break;case I.CIRCLE:c=g[1];var N=h[c],K=h[c+1],st=h[c+2],pt=h[c+3],pe=st-N,ve=pt-K,ge=Math.sqrt(pe*pe+ve*ve);n.moveTo(N+ge,K),n.arc(N,K,ge,0,2*Math.PI,!0),++u;break;case I.CLOSE_PATH:n.closePath(),++u;break;case I.CUSTOM:c=g[1],d=g[2];var ti=g[3],ei=g[4],ye=g.length==6?g[5]:void 0;B.geometry=ti,B.feature=P,u in R||(R[u]=[]);var vt=R[u];ye?ye(h,c,d,2,vt):(vt[0]=h[c],vt[1]=h[c+1],vt.length=2),ei(vt,B),++u;break;case I.DRAW_IMAGE:c=g[1],d=g[2],w=g[3],_=g[4],p=g[5];var $t=g[6],ii=g[7],ni=g[8],ri=g[9],me=g[10],Qt=g[11],ai=g[12],Mt=g[13],xe=g[14],gt=g[15];if(!w&&g.length>=20){C=g[19],S=g[20],O=g[21],T=g[22];var te=this.drawLabelWithPointPlacement_(C,S,O,T);w=te.label,g[3]=w;var oi=g[23];_=(te.anchorX-oi)*this.pixelRatio,g[4]=_;var si=g[24];p=(te.anchorY-si)*this.pixelRatio,g[5]=p,$t=w.height,g[6]=$t,Mt=w.width,g[13]=Mt}var ee=void 0;g.length>25&&(ee=g[25]);var ie=void 0,At=void 0,Pt=void 0;g.length>17?(ie=g[16],At=g[17],Pt=g[18]):(ie=ht,At=!1,Pt=!1),me&&G?Qt+=k:!me&&!G&&(Qt-=k);for(var hi=0;c<d;c+=2)if(!(ee&&ee[hi++]<Mt/this.pixelRatio)){var j=this.calculateImageOrLabelDimensions_(w.width,w.height,h[c],h[c+1],Mt,$t,_,p,ni,ri,Qt,ai,r,ie,At||Pt,P),Se=[n,t,w,j,ii,At?F:null,Pt?E:null];if(l){if(xe==="none")continue;if(xe==="obstacle"){l.insert(j.declutterBox);continue}else{var Wt=void 0,ne=void 0;if(gt){var Bt=d-c;if(!gt[Bt]){gt[Bt]=Se;continue}if(Wt=gt[Bt],delete gt[Bt],ne=ze(Wt),l.collides(ne))continue}if(l.collides(j.declutterBox))continue;Wt&&(l.insert(ne),this.replayImageOrLabel_.apply(this,Wt)),l.insert(j.declutterBox)}}this.replayImageOrLabel_.apply(this,Se)}++u;break;case I.DRAW_CHARS:var Ie=g[1],Ce=g[2],re=g[3],li=g[4];T=g[5];var ui=g[6],Te=g[7],we=g[8];O=g[9];var ae=g[10];C=g[11],S=g[12];var Oe=[g[13],g[13]],oe=this.textStates[S],yt=oe.font,mt=[oe.scale[0]*Te,oe.scale[1]*Te],xt=void 0;yt in this.widths_?xt=this.widths_[yt]:(xt={},this.widths_[yt]=xt);var De=ji(h,Ie,Ce,2),Re=Math.abs(mt[0])*Ae(yt,C,xt);if(li||Re<=De){var fi=this.textStates[S].textAlign,ci=(De-Re)*wt[fi],St=wn(h,Ie,Ce,2,C,ci,ui,Math.abs(mt[0]),Ae,yt,xt,G?0:this.viewRotation_);t:if(St){var It=[],et=void 0,Gt=void 0,Yt=void 0,V=void 0,z=void 0;if(O)for(et=0,Gt=St.length;et<Gt;++et){z=St[et],Yt=z[4],V=this.createLabel(Yt,S,"",O),_=z[2]+(mt[0]<0?-ae:ae),p=re*V.height+(.5-re)*2*ae*mt[1]/mt[0]-we;var j=this.calculateImageOrLabelDimensions_(V.width,V.height,z[0],z[1],V.width,V.height,_,p,0,0,z[3],Oe,!1,ht,!1,P);if(l&&l.collides(j.declutterBox))break t;It.push([n,t,V,j,1,null,null])}if(T)for(et=0,Gt=St.length;et<Gt;++et){z=St[et],Yt=z[4],V=this.createLabel(Yt,S,T,""),_=z[2],p=re*V.height-we;var j=this.calculateImageOrLabelDimensions_(V.width,V.height,z[0],z[1],V.width,V.height,_,p,0,0,z[3],Oe,!1,ht,!1,P);if(l&&l.collides(j.declutterBox))break t;It.push([n,t,V,j,1,null,null])}l&&l.load(It.map(ze));for(var se=0,di=It.length;se<di;++se)this.replayImageOrLabel_.apply(this,It[se])}}++u;break;case I.END_GEOMETRY:if(a!==void 0){P=g[1];var Ee=a(P,Y);if(Ee)return Ee}++u;break;case I.FILL:M?D++:this.fill_(n),++u;break;case I.MOVE_TO_LINE_TO:for(c=g[1],d=g[2],A=h[c],W=h[c+1],m=A+.5|0,x=W+.5|0,(m!==v||x!==y)&&(n.moveTo(A,W),v=m,y=x),c+=2;c<d;c+=2)A=h[c],W=h[c+1],m=A+.5|0,x=W+.5|0,(c==d-2||m!==v||x!==y)&&(n.lineTo(A,W),v=m,y=x);++u;break;case I.SET_FILL_STYLE:F=g,this.alignFill_=g[2],D&&(this.fill_(n),D=0,L&&(n.stroke(),L=0)),n.fillStyle=g[1],++u;break;case I.SET_STROKE_STYLE:E=g,L&&(n.stroke(),L=0),this.setStrokeStyle_(n,g),++u;break;case I.STROKE:M?L++:n.stroke(),++u;break;default:++u;break}}D&&this.fill_(n),L&&n.stroke()},o.prototype.execute=function(n,t,e,i,r,a){this.viewRotation_=i,this.execute_(n,t,e,this.instructions,r,void 0,void 0,a)},o.prototype.executeHitDetection=function(n,t,e,i,r){return this.viewRotation_=e,this.execute_(n,1,t,this.hitDetectionInstructions,!0,i,r)},o}();const En=Rn;var le=["Polygon","Circle","LineString","Image","Text","Default"],Ln=function(){function o(n,t,e,i,r,a){this.maxExtent_=n,this.overlaps_=i,this.pixelRatio_=e,this.resolution_=t,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Zt(),this.createExecutors_(r)}return o.prototype.clip=function(n,t){var e=this.getClipCoords(t);n.beginPath(),n.moveTo(e[0],e[1]),n.lineTo(e[2],e[3]),n.lineTo(e[4],e[5]),n.lineTo(e[6],e[7]),n.clip()},o.prototype.createExecutors_=function(n){for(var t in n){var e=this.executorsByZIndex_[t];e===void 0&&(e={},this.executorsByZIndex_[t]=e);var i=n[t];for(var r in i){var a=i[r];e[r]=new En(this.resolution_,this.pixelRatio_,this.overlaps_,a)}}},o.prototype.hasExecutors=function(n){for(var t in this.executorsByZIndex_)for(var e=this.executorsByZIndex_[t],i=0,r=n.length;i<r;++i)if(n[i]in e)return!0;return!1},o.prototype.forEachFeatureAtCoordinate=function(n,t,e,i,r,a){i=Math.round(i);var s=i*2+1,l=qt(this.hitDetectionTransform_,i+.5,i+.5,1/t,-1/t,-e,-n[0],-n[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=ot(s,s));var u=this.hitDetectionContext_;u.canvas.width!==s||u.canvas.height!==s?(u.canvas.width=s,u.canvas.height=s):h||u.clearRect(0,0,s,s);var f;this.renderBuffer_!==void 0&&(f=jt(),Oi(f,n),_e(f,t*(this.renderBuffer_+i),f));var c=kn(i),d;function _(S,O){for(var T=u.getImageData(0,0,s,s).data,D=0,L=c.length;D<L;D++)if(T[c[D]]>0){if(!a||d!=="Image"&&d!=="Text"||a.indexOf(S)!==-1){var F=(c[D]-3)/4,E=i-F%s,R=i-(F/s|0),k=r(S,O,E*E+R*R);if(k)return k}u.clearRect(0,0,s,s);break}}var p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(fe);var v,y,m,x,w;for(v=p.length-1;v>=0;--v){var C=p[v].toString();for(m=this.executorsByZIndex_[C],y=le.length-1;y>=0;--y)if(d=le[y],x=m[d],x!==void 0&&(w=x.executeHitDetection(u,l,e,_,f),w))return w}},o.prototype.getClipCoords=function(n){var t=this.maxExtent_;if(!t)return null;var e=t[0],i=t[1],r=t[2],a=t[3],s=[e,i,e,a,r,a,r,i];return Tt(s,0,8,2,n,s),s},o.prototype.isEmpty=function(){return xi(this.executorsByZIndex_)},o.prototype.execute=function(n,t,e,i,r,a,s){var l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(fe),this.maxExtent_&&(n.save(),this.clip(n,e));var h=a||le,u,f,c,d,_,p;for(s&&l.reverse(),u=0,f=l.length;u<f;++u){var v=l[u].toString();for(_=this.executorsByZIndex_[v],c=0,d=h.length;c<d;++c){var y=h[c];p=_[y],p!==void 0&&p.execute(n,t,e,i,r,s)}}this.maxExtent_&&n.restore()},o}(),ue={};function kn(o){if(ue[o]!==void 0)return ue[o];for(var n=o*2+1,t=o*o,e=new Array(t+1),i=0;i<=o;++i)for(var r=0;r<=o;++r){var a=i*i+r*r;if(a>t)break;var s=e[a];s||(s=[],e[a]=s),s.push(((o+i)*n+(o+r))*4+3),i>0&&s.push(((o-i)*n+(o+r))*4+3),r>0&&(s.push(((o+i)*n+(o-r))*4+3),i>0&&s.push(((o-i)*n+(o-r))*4+3))}for(var l=[],i=0,h=e.length;i<h;++i)e[i]&&l.push.apply(l,e[i]);return ue[o]=l,l}const je=Ln;var Fn=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Mn=function(o){Fn(n,o);function n(t,e,i,r,a,s,l){var h=o.call(this)||this;return h.context_=t,h.pixelRatio_=e,h.extent_=i,h.transform_=r,h.viewRotation_=a,h.squaredTolerance_=s,h.userTransform_=l,h.contextFillState_=null,h.contextStrokeState_=null,h.contextTextState_=null,h.fillState_=null,h.strokeState_=null,h.image_=null,h.imageAnchorX_=0,h.imageAnchorY_=0,h.imageHeight_=0,h.imageOpacity_=0,h.imageOriginX_=0,h.imageOriginY_=0,h.imageRotateWithView_=!1,h.imageRotation_=0,h.imageScale_=[0,0],h.imageWidth_=0,h.text_="",h.textOffsetX_=0,h.textOffsetY_=0,h.textRotateWithView_=!1,h.textRotation_=0,h.textScale_=[0,0],h.textFillState_=null,h.textStrokeState_=null,h.textState_=null,h.pixelCoordinates_=[],h.tmpLocalTransform_=Zt(),h}return n.prototype.drawImages_=function(t,e,i,r){if(this.image_){var a=Tt(t,e,i,r,this.transform_,this.pixelCoordinates_),s=this.context_,l=this.tmpLocalTransform_,h=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=h*this.imageOpacity_);var u=this.imageRotation_;this.imageRotateWithView_&&(u+=this.viewRotation_);for(var f=0,c=a.length;f<c;f+=2){var d=a[f]-this.imageAnchorX_,_=a[f+1]-this.imageAnchorY_;if(u!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){var p=d+this.imageAnchorX_,v=_+this.imageAnchorY_;qt(l,p,v,1,1,u,-p,-v),s.setTransform.apply(s,l),s.translate(p,v),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.setTransform(1,0,0,1,0,0)}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,_,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=h)}},n.prototype.drawText_=function(t,e,i,r){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var a=Tt(t,e,i,r,this.transform_,this.pixelCoordinates_),s=this.context_,l=this.textRotation_;for(this.textRotateWithView_&&(l+=this.viewRotation_);e<i;e+=r){var h=a[e]+this.textOffsetX_,u=a[e+1]+this.textOffsetY_;if(l!==0||this.textScale_[0]!=1||this.textScale_[1]!=1){var f=qt(this.tmpLocalTransform_,h,u,1,1,l,-h,-u);s.setTransform.apply(s,f),s.translate(h,u),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&s.strokeText(this.text_,h,u),this.textFillState_&&s.fillText(this.text_,h,u)}}},n.prototype.moveToLineTo_=function(t,e,i,r,a){var s=this.context_,l=Tt(t,e,i,r,this.transform_,this.pixelCoordinates_);s.moveTo(l[0],l[1]);var h=l.length;a&&(h-=2);for(var u=2;u<h;u+=2)s.lineTo(l[u],l[u+1]);return a&&s.closePath(),i},n.prototype.drawRings_=function(t,e,i,r){for(var a=0,s=i.length;a<s;++a)e=this.moveToLineTo_(t,e,i[a],r,!0);return e},n.prototype.drawCircle=function(t){if(U(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=Yi(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],r=e[3]-e[1],a=Math.sqrt(i*i+r*r),s=this.context_;s.beginPath(),s.arc(e[0],e[1],a,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}},n.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},n.prototype.setTransform=function(t){this.transform_=t},n.prototype.drawGeometry=function(t){var e=t.getType();switch(e){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}},n.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);!i||!U(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))},n.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,r=e.length;i<r;++i)this.drawGeometry(e[i])},n.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)},n.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)},n.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!U(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){var r=t.getFlatMidpoint();this.drawText_(r,0,2,2)}}},n.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(U(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,r=t.getFlatCoordinates(),a=0,s=t.getEnds(),l=t.getStride();i.beginPath();for(var h=0,u=s.length;h<u;++h)a=this.moveToLineTo_(r,a,s[h],l,!1);i.stroke()}if(this.text_!==""){var f=t.getFlatMidpoints();this.drawText_(f,0,f.length,2)}}},n.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!U(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},n.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!U(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),r=0,a=t.getEndss(),s=t.getStride();e.beginPath();for(var l=0,h=a.length;l<h;++l){var u=a[l];r=this.drawRings_(i,r,u,s)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var f=t.getFlatInteriorPoints();this.drawText_(f,0,f.length,2)}}},n.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},n.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(Kt(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},n.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,r=t.textAlign?t.textAlign:kt;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=r&&(i.textAlign=r,e.textAlign=r),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})},n.prototype.setFillStrokeStyle=function(t,e){var i=this;if(!t)this.fillState_=null;else{var r=t.getColor();this.fillState_={fillStyle:q(r||tt)}}if(!e)this.strokeState_=null;else{var a=e.getColor(),s=e.getLineCap(),l=e.getLineDash(),h=e.getLineDashOffset(),u=e.getLineJoin(),f=e.getWidth(),c=e.getMiterLimit(),d=l||Et;this.strokeState_={lineCap:s!==void 0?s:Jt,lineDash:this.pixelRatio_===1?d:d.map(function(_){return _*i.pixelRatio_}),lineDashOffset:(h||Lt)*this.pixelRatio_,lineJoin:u!==void 0?u:_t,lineWidth:(f!==void 0?f:Dt)*this.pixelRatio_,miterLimit:c!==void 0?c:Rt,strokeStyle:q(a||Ot)}}},n.prototype.setImageStyle=function(t){var e;if(!t||!(e=t.getSize())){this.image_=null;return}var i=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*this.pixelRatio_,this.imageAnchorY_=i[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_},n.prototype.setTextStyle=function(t){if(!t)this.text_="";else{var e=t.getFill();if(!e)this.textFillState_=null;else{var i=e.getColor();this.textFillState_={fillStyle:q(i||tt)}}var r=t.getStroke();if(!r)this.textStrokeState_=null;else{var a=r.getColor(),s=r.getLineCap(),l=r.getLineDash(),h=r.getLineDashOffset(),u=r.getLineJoin(),f=r.getWidth(),c=r.getMiterLimit();this.textStrokeState_={lineCap:s!==void 0?s:Jt,lineDash:l||Et,lineDashOffset:h||Lt,lineJoin:u!==void 0?u:_t,lineWidth:f!==void 0?f:Dt,miterLimit:c!==void 0?c:Rt,strokeStyle:q(a||Ot)}}var d=t.getFont(),_=t.getOffsetX(),p=t.getOffsetY(),v=t.getRotateWithView(),y=t.getRotation(),m=t.getScaleArray(),x=t.getText(),w=t.getTextAlign(),C=t.getTextBaseline();this.textState_={font:d!==void 0?d:Ze,textAlign:w!==void 0?w:kt,textBaseline:C!==void 0?C:Ut},this.text_=x!==void 0?Array.isArray(x)?x.reduce(function(S,O,T){return S+=T%2?" ":O},""):x:"",this.textOffsetX_=_!==void 0?this.pixelRatio_*_:0,this.textOffsetY_=p!==void 0?this.pixelRatio_*p:0,this.textRotateWithView_=v!==void 0?v:!1,this.textRotation_=y!==void 0?y:0,this.textScale_=[this.pixelRatio_*m[0],this.pixelRatio_*m[1]]}},n}(Ke);const rt={FRACTION:"fraction",PIXELS:"pixels"},X={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};var An=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ct=null,Pn=function(o){An(n,o);function n(t,e,i,r,a,s){var l=o.call(this)||this;return l.hitDetectionImage_=null,l.image_=t||new Image,r!==null&&(l.image_.crossOrigin=r),l.canvas_={},l.color_=s,l.unlisten_=null,l.imageState_=a,l.size_=i,l.src_=e,l.tainted_,l}return n.prototype.isTainted_=function(){if(this.tainted_===void 0&&this.imageState_===H.LOADED){Ct||(Ct=ot(1,1)),Ct.drawImage(this.image_,0,0);try{Ct.getImageData(0,0,1,1),this.tainted_=!1}catch{Ct=null,this.tainted_=!0}}return this.tainted_===!0},n.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(ce.CHANGE)},n.prototype.handleImageError_=function(){this.imageState_=H.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},n.prototype.handleImageLoad_=function(){this.imageState_=H.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},n.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},n.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},n.prototype.getImageState=function(){return this.imageState_},n.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],i=ot(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},n.prototype.getSize=function(){return this.size_},n.prototype.getSrc=function(){return this.src_},n.prototype.load=function(){if(this.imageState_==H.IDLE){this.imageState_=H.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=Ji(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},n.prototype.replaceColor_=function(t){if(!(!this.color_||this.canvas_[t]||this.imageState_!==H.LOADED)){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var i=e.getContext("2d");if(i.scale(t,t),i.drawImage(this.image_,0,0),i.globalCompositeOperation="multiply",i.globalCompositeOperation==="multiply"||this.isTainted_())i.fillStyle=vi(this.color_),i.fillRect(0,0,e.width/t,e.height/t),i.globalCompositeOperation="destination-in",i.drawImage(this.image_,0,0);else{for(var r=i.getImageData(0,0,e.width,e.height),a=r.data,s=this.color_[0]/255,l=this.color_[1]/255,h=this.color_[2]/255,u=this.color_[3],f=0,c=a.length;f<c;f+=4)a[f]*=s,a[f+1]*=l,a[f+2]*=h,a[f+3]*=u;i.putImageData(r,0,0)}}},n.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},n}(Si);function Wn(o,n,t,e,i,r){var a=Pe.get(n,e,r);return a||(a=new Pn(o,n,t,e,i,r),Pe.set(n,e,r,a)),a}var Bn=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Gn=function(o){Bn(n,o);function n(t){var e=this,i=t||{},r=i.opacity!==void 0?i.opacity:1,a=i.rotation!==void 0?i.rotation:0,s=i.scale!==void 0?i.scale:1,l=i.rotateWithView!==void 0?i.rotateWithView:!1;e=o.call(this,{opacity:r,rotation:a,scale:s,displacement:i.displacement!==void 0?i.displacement:[0,0],rotateWithView:l,declutterMode:i.declutterMode})||this,e.anchor_=i.anchor!==void 0?i.anchor:[.5,.5],e.normalizedAnchor_=null,e.anchorOrigin_=i.anchorOrigin!==void 0?i.anchorOrigin:X.TOP_LEFT,e.anchorXUnits_=i.anchorXUnits!==void 0?i.anchorXUnits:rt.FRACTION,e.anchorYUnits_=i.anchorYUnits!==void 0?i.anchorYUnits:rt.FRACTION,e.crossOrigin_=i.crossOrigin!==void 0?i.crossOrigin:null;var h=i.img!==void 0?i.img:null;e.imgSize_=i.imgSize;var u=i.src;Xt(!(u!==void 0&&h),4),Xt(!h||h&&e.imgSize_,5),(u===void 0||u.length===0)&&h&&(u=h.src||dt(h)),Xt(u!==void 0&&u.length>0,6);var f=i.src!==void 0?H.IDLE:H.LOADED;return e.color_=i.color!==void 0?Ue(i.color):null,e.iconImage_=Wn(h,u,e.imgSize_!==void 0?e.imgSize_:null,e.crossOrigin_,f,e.color_),e.offset_=i.offset!==void 0?i.offset:[0,0],e.offsetOrigin_=i.offsetOrigin!==void 0?i.offsetOrigin:X.TOP_LEFT,e.origin_=null,e.size_=i.size!==void 0?i.size:null,e}return n.prototype.clone=function(){var t=this.getScale();return new n({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})},n.prototype.getAnchor=function(){var t=this.normalizedAnchor_;if(!t){t=this.anchor_;var e=this.getSize();if(this.anchorXUnits_==rt.FRACTION||this.anchorYUnits_==rt.FRACTION){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==rt.FRACTION&&(t[0]*=e[0]),this.anchorYUnits_==rt.FRACTION&&(t[1]*=e[1])}if(this.anchorOrigin_!=X.TOP_LEFT){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_==X.TOP_RIGHT||this.anchorOrigin_==X.BOTTOM_RIGHT)&&(t[0]=-t[0]+e[0]),(this.anchorOrigin_==X.BOTTOM_LEFT||this.anchorOrigin_==X.BOTTOM_RIGHT)&&(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}var i=this.getDisplacement();return[t[0]-i[0],t[1]+i[1]]},n.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},n.prototype.getColor=function(){return this.color_},n.prototype.getImage=function(t){return this.iconImage_.getImage(t)},n.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},n.prototype.getImageSize=function(){return this.iconImage_.getSize()},n.prototype.getImageState=function(){return this.iconImage_.getImageState()},n.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},n.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=X.TOP_LEFT){var e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_==X.TOP_RIGHT||this.offsetOrigin_==X.BOTTOM_RIGHT)&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_==X.BOTTOM_LEFT||this.offsetOrigin_==X.BOTTOM_RIGHT)&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_},n.prototype.getSrc=function(){return this.iconImage_.getSrc()},n.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},n.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(ce.CHANGE,t)},n.prototype.load=function(){this.iconImage_.load()},n.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(ce.CHANGE,t)},n}(qe);const Yn=Gn;var Z=.5;function Nn(o,n,t,e,i,r,a){var s=o[0]*Z,l=o[1]*Z,h=ot(s,l);h.imageSmoothingEnabled=!1;for(var u=h.canvas,f=new Mn(h,Z,i,null,a),c=t.length,d=Math.floor((256*256*256-1)/c),_={},p=1;p<=c;++p){var v=t[p-1],y=v.getStyleFunction()||e;if(e){var m=y(v,r);if(m){Array.isArray(m)||(m=[m]);for(var x=p*d,w="#"+("000000"+x.toString(16)).slice(-6),C=0,S=m.length;C<S;++C){var O=m[C],T=O.getGeometryFunction()(v);if(!(!T||!U(i,T.getExtent()))){var D=O.clone(),L=D.getFill();L&&L.setColor(w);var F=D.getStroke();F&&(F.setColor(w),F.setLineDash(null)),D.setText(void 0);var E=O.getImage();if(E&&E.getOpacity()!==0){var R=E.getImageSize();if(!R)continue;var k=ot(R[0],R[1],void 0,{alpha:!1}),G=k.canvas;k.fillStyle=w,k.fillRect(0,0,G.width,G.height),D.setImage(new Yn({img:G,imgSize:R,anchor:E.getAnchor(),anchorXUnits:rt.PIXELS,anchorYUnits:rt.PIXELS,offset:E.getOrigin(),opacity:1,size:E.getSize(),scale:E.getScale(),rotation:E.getRotation(),rotateWithView:E.getRotateWithView()}))}var B=D.getZIndex()||0,M=_[B];M||(M={},_[B]=M,M.Polygon=[],M.Circle=[],M.LineString=[],M.Point=[]),M[T.getType().replace("Multi","")].push(T,D)}}}}}for(var P=Object.keys(_).map(Number).sort(fe),p=0,A=P.length;p<A;++p){var M=_[P[p]];for(var W in M)for(var Y=M[W],C=0,S=Y.length;C<S;C+=2){f.setStyle(Y[C+1]);for(var g=0,b=n.length;g<b;++g)f.setTransform(n[g]),f.drawGeometry(Y[C])}}return h.getImageData(0,0,u.width,u.height)}function bn(o,n,t){var e=[];if(t){var i=Math.floor(Math.round(o[0])*Z),r=Math.floor(Math.round(o[1])*Z),a=(ke(i,0,t.width-1)+ke(r,0,t.height-1)*t.width)*4,s=t.data[a],l=t.data[a+1],h=t.data[a+2],u=h+256*(l+256*s),f=Math.floor((256*256*256-1)/n.length);u&&u%f===0&&e.push(n[u/f-1])}return e}var Vn=.5,$e={Point:Kn,LineString:Un,Polygon:Qn,MultiPoint:$n,MultiLineString:Zn,MultiPolygon:qn,GeometryCollection:Jn,Circle:Xn};function Hn(o,n){return parseInt(dt(o),10)-parseInt(dt(n),10)}function zn(o,n){var t=de(o,n);return t*t}function de(o,n){return Vn*o/n}function Xn(o,n,t,e,i){var r=t.getFill(),a=t.getStroke();if(r||a){var s=o.getBuilder(t.getZIndex(),"Circle");s.setFillStrokeStyle(r,a),s.drawCircle(n,e)}var l=t.getText();if(l&&l.getText()){var h=(i||o).getBuilder(t.getZIndex(),"Text");h.setTextStyle(l),h.drawText(n,e)}}function Je(o,n,t,e,i,r,a){var s=!1,l=t.getImage();if(l){var h=l.getImageState();h==H.LOADED||h==H.ERROR?l.unlistenImageChange(i):(h==H.IDLE&&l.load(),l.listenImageChange(i),s=!0)}return jn(o,n,t,e,r,a),s}function jn(o,n,t,e,i,r){var a=t.getGeometryFunction()(n);if(a){var s=a.simplifyTransformed(e,i),l=t.getRenderer();if(l)Qe(o,s,t,n);else{var h=$e[s.getType()];h(o,s,t,n,r)}}}function Qe(o,n,t,e){if(n.getType()=="GeometryCollection"){for(var i=n.getGeometries(),r=0,a=i.length;r<a;++r)Qe(o,i[r],t,e);return}var s=o.getBuilder(t.getZIndex(),"Default");s.drawCustom(n,e,t.getRenderer(),t.getHitDetectionRenderer())}function Jn(o,n,t,e,i){var r=n.getGeometriesArray(),a,s;for(a=0,s=r.length;a<s;++a){var l=$e[r[a].getType()];l(o,r[a],t,e,i)}}function Un(o,n,t,e,i){var r=t.getStroke();if(r){var a=o.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(n,e)}var s=t.getText();if(s&&s.getText()){var l=(i||o).getBuilder(t.getZIndex(),"Text");l.setTextStyle(s),l.drawText(n,e)}}function Zn(o,n,t,e,i){var r=t.getStroke();if(r){var a=o.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(n,e)}var s=t.getText();if(s&&s.getText()){var l=(i||o).getBuilder(t.getZIndex(),"Text");l.setTextStyle(s),l.drawText(n,e)}}function qn(o,n,t,e,i){var r=t.getFill(),a=t.getStroke();if(a||r){var s=o.getBuilder(t.getZIndex(),"Polygon");s.setFillStrokeStyle(r,a),s.drawMultiPolygon(n,e)}var l=t.getText();if(l&&l.getText()){var h=(i||o).getBuilder(t.getZIndex(),"Text");h.setTextStyle(l),h.drawText(n,e)}}function Kn(o,n,t,e,i){var r=t.getImage(),a=t.getText(),s;if(r){if(r.getImageState()!=H.LOADED)return;var l=o;if(i){var h=r.getDeclutterMode();if(h!=="none")if(l=i,h==="obstacle"){var u=o.getBuilder(t.getZIndex(),"Image");u.setImageStyle(r,s),u.drawPoint(n,e)}else a&&a.getText()&&(s={})}var f=l.getBuilder(t.getZIndex(),"Image");f.setImageStyle(r,s),f.drawPoint(n,e)}if(a&&a.getText()){var c=o;i&&(c=i);var d=c.getBuilder(t.getZIndex(),"Text");d.setTextStyle(a,s),d.drawText(n,e)}}function $n(o,n,t,e,i){var r=t.getImage(),a=t.getText(),s;if(r){if(r.getImageState()!=H.LOADED)return;var l=o;if(i){var h=r.getDeclutterMode();if(h!=="none")if(l=i,h==="obstacle"){var u=o.getBuilder(t.getZIndex(),"Image");u.setImageStyle(r,s),u.drawMultiPoint(n,e)}else a&&a.getText()&&(s={})}var f=l.getBuilder(t.getZIndex(),"Image");f.setImageStyle(r,s),f.drawMultiPoint(n,e)}if(a&&a.getText()){var c=o;i&&(c=i);var d=c.getBuilder(t.getZIndex(),"Text");d.setTextStyle(a,s),d.drawText(n,e)}}function Qn(o,n,t,e,i){var r=t.getFill(),a=t.getStroke();if(r||a){var s=o.getBuilder(t.getZIndex(),"Polygon");s.setFillStrokeStyle(r,a),s.drawPolygon(n,e)}var l=t.getText();if(l&&l.getText()){var h=(i||o).getBuilder(t.getZIndex(),"Text");h.setTextStyle(l),h.drawText(n,e)}}var tr=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),er=function(o){tr(n,o);function n(t){var e=o.call(this,t)||this;return e.boundHandleStyleImageChange_=e.handleStyleImageChange_.bind(e),e.animatingOrInteracting_,e.hitDetectionImageData_=null,e.renderedFeatures_=null,e.renderedRevision_=-1,e.renderedResolution_=NaN,e.renderedExtent_=jt(),e.wrappedRenderedExtent_=jt(),e.renderedRotation_,e.renderedCenter_=null,e.renderedProjection_=null,e.renderedRenderOrder_=null,e.replayGroup_=null,e.replayGroupChanged=!0,e.declutterExecutorGroup=null,e.clipping=!0,e.compositionContext_=null,e.opacity_=1,e}return n.prototype.renderWorlds=function(t,e,i){var r=e.extent,a=e.viewState,s=a.center,l=a.resolution,h=a.projection,u=a.rotation,f=h.getExtent(),c=this.getLayer().getSource(),d=e.pixelRatio,_=e.viewHints,p=!(_[Ht.ANIMATING]||_[Ht.INTERACTING]),v=this.compositionContext_,y=Math.round(e.size[0]*d),m=Math.round(e.size[1]*d),x=c.getWrapX()&&h.canWrapX(),w=x?Nt(f):null,C=x?Math.ceil((r[2]-f[2])/w)+1:1,S=x?Math.floor((r[0]-f[0])/w):0;do{var O=this.getRenderTransform(s,l,u,d,y,m,S*w);t.execute(v,1,O,u,p,void 0,i)}while(++S<C)},n.prototype.setupCompositionContext_=function(){if(this.opacity_!==1){var t=ot(this.context.canvas.width,this.context.canvas.height,Ge);this.compositionContext_=t}else this.compositionContext_=this.context},n.prototype.releaseCompositionContext_=function(){if(this.opacity_!==1){var t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,Mi(this.compositionContext_),Ge.push(this.compositionContext_.canvas),this.compositionContext_=null}},n.prototype.renderDeclutter=function(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())},n.prototype.renderFrame=function(t,e){var i=t.pixelRatio,r=t.layerStatesArray[t.layerIndex];Hi(this.pixelTransform,1/i,1/i),zi(this.inversePixelTransform,this.pixelTransform);var a=Xi(this.pixelTransform);this.useContainer(e,a,this.getBackground(t));var s=this.context,l=s.canvas,h=this.replayGroup_,u=this.declutterExecutorGroup;if((!h||h.isEmpty())&&(!u||u.isEmpty()))return null;var f=Math.round(t.size[0]*i),c=Math.round(t.size[1]*i);l.width!=f||l.height!=c?(l.width=f,l.height=c,l.style.transform!==a&&(l.style.transform=a)):this.containerReused||s.clearRect(0,0,f,c),this.preRender(s,t);var d=t.viewState,_=d.projection;this.opacity_=r.opacity,this.setupCompositionContext_();var p=!1,v=!0;if(r.extent&&this.clipping){var y=Di(r.extent,_);v=U(y,t.extent),p=v&&!bt(y,t.extent),p&&this.clipUnrotated(this.compositionContext_,t,y)}return v&&this.renderWorlds(h,t),p&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(s,t),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container},n.prototype.getFeatures=function(t){return new Promise((function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var i=[this.context.canvas.width,this.context.canvas.height];ct(this.pixelTransform,i);var r=this.renderedCenter_,a=this.renderedResolution_,s=this.renderedRotation_,l=this.renderedProjection_,h=this.wrappedRenderedExtent_,u=this.getLayer(),f=[],c=i[0]*Z,d=i[1]*Z;f.push(this.getRenderTransform(r,a,s,Z,c,d,0).slice());var _=u.getSource(),p=l.getExtent();if(_.getWrapX()&&l.canWrapX()&&!bt(p,h)){for(var v=h[0],y=Nt(p),m=0,x=void 0;v<p[0];)--m,x=y*m,f.push(this.getRenderTransform(r,a,s,Z,c,d,x).slice()),v+=y;for(m=0,v=h[2];v>p[2];)++m,x=y*m,f.push(this.getRenderTransform(r,a,s,Z,c,d,x).slice()),v-=y}this.hitDetectionImageData_=Nn(i,f,this.renderedFeatures_,u.getStyleFunction(),h,a,s)}e(bn(t,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))},n.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,a){var s=this;if(this.replayGroup_){var l=e.viewState.resolution,h=e.viewState.rotation,u=this.getLayer(),f={},c=function(p,v,y){var m=dt(p),x=f[m];if(x){if(x!==!0&&y<x.distanceSq){if(y===0)return f[m]=!0,a.splice(a.lastIndexOf(x),1),r(p,u,v);x.geometry=v,x.distanceSq=y}}else{if(y===0)return f[m]=!0,r(p,u,v);a.push(f[m]={feature:p,layer:u,geometry:v,distanceSq:y,callback:r})}},d,_=[this.replayGroup_];return this.declutterExecutorGroup&&_.push(this.declutterExecutorGroup),_.some(function(p){return d=p.forEachFeatureAtCoordinate(t,l,h,i,c,p===s.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(function(v){return v.value}):null)}),d}},n.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},n.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},n.prototype.prepareFrame=function(t){var e=this.getLayer(),i=e.getSource();if(!i)return!1;var r=t.viewHints[Ht.ANIMATING],a=t.viewHints[Ht.INTERACTING],s=e.getUpdateWhileAnimating(),l=e.getUpdateWhileInteracting();if(this.ready&&!s&&r||!l&&a)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var h=t.extent,u=t.viewState,f=u.projection,c=u.resolution,d=t.pixelRatio,_=e.getRevision(),p=e.getRenderBuffer(),v=e.getRenderOrder();v===void 0&&(v=Hn);var y=u.center.slice(),m=_e(h,p*c),x=m.slice(),w=[m.slice()],C=f.getExtent();if(i.getWrapX()&&f.canWrapX()&&!bt(C,t.extent)){var S=Nt(C),O=Math.max(Nt(m)/2,S);m[0]=C[0]-O,m[2]=C[2]+O,Ri(y,f);var T=Ei(w[0],f);T[0]<C[0]&&T[2]<C[2]?w.push([T[0]+S,T[1],T[2]+S,T[3]]):T[0]>C[0]&&T[2]>C[2]&&w.push([T[0]-S,T[1],T[2]-S,T[3]])}if(this.ready&&this.renderedResolution_==c&&this.renderedRevision_==_&&this.renderedRenderOrder_==v&&bt(this.wrappedRenderedExtent_,m))return Kt(this.renderedExtent_,x)||(this.hitDetectionImageData_=null,this.renderedExtent_=x),this.renderedCenter_=y,this.replayGroupChanged=!1,!0;this.replayGroup_=null;var D=new He(de(c,d),m,c,d),L;this.getLayer().getDeclutter()&&(L=new He(de(c,d),m,c,d));var F=Fi(),E;if(F){for(var R=0,k=w.length;R<k;++R){var G=w[R],B=Fe(G,f);i.loadFeatures(B,Li(c,f),F)}E=ki(F,f)}else for(var R=0,k=w.length;R<k;++R)i.loadFeatures(w[R],c,f);var M=zn(c,d),P=!0,A=(function(N){var K,st=N.getStyleFunction()||e.getStyleFunction();if(st&&(K=st(N,c)),K){var pt=this.renderFeature(N,M,K,D,E,L);P=P&&!pt}}).bind(this),W=Fe(m,f),Y=i.getFeaturesInExtent(W);v&&Y.sort(v);for(var R=0,k=Y.length;R<k;++R)A(Y[R]);this.renderedFeatures_=Y,this.ready=P;var g=D.finish(),b=new je(m,c,d,i.getOverlaps(),g,e.getRenderBuffer());return L&&(this.declutterExecutorGroup=new je(m,c,d,i.getOverlaps(),L.finish(),e.getRenderBuffer())),this.renderedResolution_=c,this.renderedRevision_=_,this.renderedRenderOrder_=v,this.renderedExtent_=x,this.wrappedRenderedExtent_=m,this.renderedCenter_=y,this.renderedProjection_=f,this.replayGroup_=b,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},n.prototype.renderFeature=function(t,e,i,r,a,s){if(!i)return!1;var l=!1;if(Array.isArray(i))for(var h=0,u=i.length;h<u;++h)l=Je(r,t,i[h],e,this.boundHandleStyleImageChange_,a,s)||l;else l=Je(r,t,i,e,this.boundHandleStyleImageChange_,a,s);return l},n}(Ni);const ir=er;var nr=function(){var o=function(n,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},o(n,t)};return function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Sr=function(o){nr(n,o);function n(t){return o.call(this,t)||this}return n.prototype.createRenderer=function(){return new ir(this)},n}(hn);export{Sr as default};
