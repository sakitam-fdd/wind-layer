import{E as f,b as _,j as h,u as g}from"./Object.DdgBWT7D.js";import{a as l,m as p}from"./proj.BNE8J585.js";import{I as u}from"./ImageState.BQAwWc_S.js";import{I as m}from"./has.DEIyT5tI.js";var y=function(){var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},o(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),d=function(o){y(t,o);function t(e,n,i,r){var s=o.call(this)||this;return s.extent=e,s.pixelRatio_=i,s.resolution=n,s.state=r,s}return t.prototype.changed=function(){this.dispatchEvent(f.CHANGE)},t.prototype.getExtent=function(){return this.extent},t.prototype.getImage=function(){return l()},t.prototype.getPixelRatio=function(){return this.pixelRatio_},t.prototype.getResolution=function(){return this.resolution},t.prototype.getState=function(){return this.state},t.prototype.load=function(){l()},t}(_);const I=d;var E=function(){var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},o(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();(function(o){E(t,o);function t(e,n,i,r,s,c){var a=o.call(this,e,n,i,u.IDLE)||this;return a.src_=r,a.image_=new Image,s!==null&&(a.image_.crossOrigin=s),a.unlisten_=null,a.state=u.IDLE,a.imageLoadFunction_=c,a}return t.prototype.getImage=function(){return this.image_},t.prototype.handleImageError_=function(){this.state=u.ERROR,this.unlistenImage_(),this.changed()},t.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=p(this.extent)/this.image_.height),this.state=u.LOADED,this.unlistenImage_(),this.changed()},t.prototype.load=function(){(this.state==u.IDLE||this.state==u.ERROR)&&(this.state=u.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=v(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.setImage=function(e){this.image_=e,this.resolution=p(this.extent)/this.image_.height},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t})(I);function v(o,t,e){var n=o,i=!0,r=!1,s=!1,c=[h(n,f.LOAD,function(){s=!0,r||t()})];return n.src&&m?(r=!0,n.decode().then(function(){i&&t()}).catch(function(a){i&&(s?t():e())})):c.push(h(n,f.ERROR,e)),function(){i=!1,c.forEach(g)}}export{v as l};
