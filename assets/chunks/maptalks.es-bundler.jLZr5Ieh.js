import{c as En,g as Mh}from"./commonjsHelpers.Cpj98o6Y.js";import{r as Il}from"./index.B6qUrsMJ.js";var Sh={exports:{}};(function(s){(function(a){var i,r,t="fulfilled",e="undefined",n=function(){var l=[],f=0;function c(){for(;l.length-f;){try{l[f]()}catch(g){a.console&&a.console.error(g)}l[f++]=r,f==1024&&(l.splice(0,1024),f=0)}}var d=function(){if(typeof MutationObserver===e)return typeof process!==e&&typeof process.nextTick=="function"?function(){process.nextTick(c)}:typeof setImmediate!==e?function(){setImmediate(c)}:function(){setTimeout(c,0)};var g=document.createElement("div");return new MutationObserver(c).observe(g,{attributes:!0}),function(){g.setAttribute("a",0)}}();return function(g){l.push(g),l.length-f==1&&d()}}();function o(l){if(!(this instanceof o))throw new TypeError("Zousan must be created with the new keyword");if(typeof l=="function"){var f=this;try{l(function(c){f.resolve(c)},function(c){f.reject(c)})}catch(c){f.reject(c)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+l+" is not a function")}function h(l,f){if(typeof l.y=="function")try{var c=l.y.call(r,f);l.p.resolve(c)}catch(d){l.p.reject(d)}else l.p.resolve(f)}function u(l,f){if(typeof l.n=="function")try{var c=l.n.call(r,f);l.p.resolve(c)}catch(d){l.p.reject(d)}else l.p.reject(f)}o.prototype={resolve:function(l){if(this.state===i){if(l===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var f=this;if(l&&(typeof l=="function"||typeof l=="object"))try{var c=!0,d=l.then;if(typeof d=="function")return void d.call(l,function(g){c&&(c=!1,f.resolve(g))},function(g){c&&(c=!1,f.reject(g))})}catch(g){return void(c&&this.reject(g))}this.state=t,this.v=l,f.c&&n(function(){for(var g=0,v=f.c.length;g<v;g++)h(f.c[g],l)})}},reject:function(l){if(this.state===i){var f=this;this.state="rejected",this.v=l;var c=this.c;n(c?function(){for(var d=0,g=c.length;d<g;d++)u(c[d],l)}:function(){f.handled||!o.suppressUncaughtRejectionError&&a.console&&o.warn("You upset Zousan. Please catch rejections: ",l,l?l.stack:null)})}},then:function(l,f){var c=new o,d={y:l,n:f,p:c};if(this.state===i)this.c?this.c.push(d):this.c=[d];else{var g=this.state,v=this.v;this.handled=!0,n(function(){g===t?h(d,v):u(d,v)})}return c},catch:function(l){return this.then(null,l)},finally:function(l){return this.then(l,l)},timeout:function(l,f){f=f||"Timeout";var c=this;return new o(function(d,g){setTimeout(function(){g(Error(f))},l),c.then(function(v){d(v)},function(v){g(v)})})}},o.resolve=function(l){var f=new o;return f.resolve(l),f},o.reject=function(l){var f=new o;return f.c=[],f.reject(l),f},o.all=function(l){var f=[],c=0,d=new o;function g(m,_){m&&typeof m.then=="function"||(m=o.resolve(m)),m.then(function(p){f[_]=p,++c==l.length&&d.resolve(f)},function(p){d.reject(p)})}for(var v=0;v<l.length;v++)g(l[v],v);return l.length||d.resolve(f),d},o.warn=console.warn,s.exports&&(s.exports=o),a.define&&a.define.amd&&a.define([],function(){return o}),(a.Zousan=o).soon=n})(typeof En<"u"?En:En)})(Sh);var zl=Sh.exports;const jl=Mh(zl);var bh={exports:{}};(function(s){(function(){function a(o,h){var u=o.x-h.x,l=o.y-h.y;return u*u+l*l}function i(o,h,u){var l=h.x,f=h.y,c=u.x-l,d=u.y-f;if(c!==0||d!==0){var g=((o.x-l)*c+(o.y-f)*d)/(c*c+d*d);g>1?(l=u.x,f=u.y):g>0&&(l+=c*g,f+=d*g)}return c=o.x-l,d=o.y-f,c*c+d*d}function r(o,h){for(var u=o[0],l=[u],f,c=1,d=o.length;c<d;c++)f=o[c],a(f,u)>h&&(l.push(f),u=f);return u!==f&&l.push(f),l}function t(o,h,u,l,f){for(var c=l,d,g=h+1;g<u;g++){var v=i(o[g],o[h],o[u]);v>c&&(d=g,c=v)}c>l&&(d-h>1&&t(o,h,d,l,f),f.push(o[d]),u-d>1&&t(o,d,u,l,f))}function e(o,h){var u=o.length-1,l=[o[0]];return t(o,0,u,h,l),l.push(o[u]),l}function n(o,h,u){if(o.length<=2)return o;var l=h!==void 0?h*h:1;return o=u?o:r(o,l),o=e(o,l),o}s.exports=n,s.exports.default=n})()})(bh);var Gl=bh.exports;const Fl=Mh(Gl);/*!
* Contains code from THREE.js
* MIT License
* https://github.com/mrdoob/three.js
*/var Re=[];for(var Rn=0;Rn<6;Rn++)Re[Rn]=[];var yr=[];function An(s,a,i){Hl(s);for(var r=0;r<6;r++)if(!(i&&i.charAt(r)==="0")){var t=Re[r];if(yr[0]=t[0]>0?a[1][0]:a[0][0],yr[1]=t[1]>0?a[1][1]:a[0][1],yr[2]=t[2]>0?a[1][2]:a[0][2],Nl(t,yr)<0)return!1}return!0}function Hl(s){var a=s,i=a[0],r=a[1],t=a[2],e=a[3],n=a[4],o=a[5],h=a[6],u=a[7],l=a[8],f=a[9],c=a[10],d=a[11],g=a[12],v=a[13],m=a[14],_=a[15];ti(Re[0],e-i,u-n,d-l,_-g),ti(Re[1],e+i,u+n,d+l,_+g),ti(Re[2],e+r,u+o,d+f,_+v),ti(Re[3],e-r,u-o,d-f,_-v),ti(Re[4],e-t,u-h,d-c,_-m),ti(Re[5],e+t,u+h,d+c,_+m)}var wr=1/6;function ti(s,a,i,r,t){return s[0]=a*wr,s[1]=i*wr,s[2]=r*wr,s[3]=t*wr,s}function Nl(s,a){return s[0]*a[0]+s[1]*a[1]+s[2]*a[2]+s[3]}/*!
 * maptalks v1.0.0-rc.33
 * LICENSE : BSD-3-Clause
 * (c) 2016-2024 maptalks.org
 */var Bl="1.0.0-rc.33",Qt={isTest:!1,idleLog:!1,idleTimeRemaining:8,idleForceTimeThreshold:100,idleTimeout:1e3,workerCount:window.MAPTALKS_WORKER_COUNT||0,taskCountPerWorkerMessage:5},or="_maptalks__internal_layer_",Eh=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],Rh=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(Eh),Ah=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],Zl=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],Wl={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},Vl=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],Oh=14;function at(){return Date.now()}function F(s){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var r in i)s[r]=i[r]}return s}function P(s){return s==null}function H(s){return typeof s=="number"&&!isNaN(s)}function Ne(s){return(s|0)===s}function ee(s){return typeof s=="object"&&!!s}function tt(s){return P(s)?!1:typeof s=="string"||s.constructor!==null&&s.constructor===String}function it(s){return P(s)?!1:typeof s=="function"||s.constructor!==null&&s.constructor===Function}var Ul=Object.prototype.hasOwnProperty;function wi(s,a){return Ul.call(s,a)}function Jl(s,a){return s.join?s.join(a||","):Array.prototype.join.call(s,a||",")}function Xl(s){var a;for(a in s)return!1;return!a}var Dh=Math.PI/180;function pt(s){return s*Dh}function Ha(s){return s/Dh}var bt=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"],Gi={};function Vs(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!bt){var $t=navigator.userAgent.toLowerCase(),On=document.documentElement||{style:{}},ei="ActiveXObject"in window,Dn=$t.indexOf("webkit")!==-1,kn=$t.indexOf("phantom")!==-1,Us=$t.search("android [23]")!==-1,Ln=$t.indexOf("chrome")!==-1,Js=$t.indexOf("gecko")!==-1&&!Dn&&!window.opera&&!ei,ql=/iphone/i.test($t)&&/micromessenger/i.test($t),Ti=typeof orientation<"u"||$t.indexOf("mobile")!==-1,Xs=!window.PointerEvent&&window.MSPointerEvent,qs=window.PointerEvent&&navigator.pointerEnabled||Xs,$s=ei&&"transition"in On.style,In="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Us,Ys="MozPerspective"in On.style,Qs="OTransition"in On.style,$l=($s||In||Ys)&&!Qs&&!kn,Yl=typeof window<"u"&&it(window.createImageBitmap),Ql=typeof window<"u"&&it(window.ResizeObserver),Kl=typeof window<"u"&&it(window.btoa),tf=typeof window<"u"&&it(window.Proxy),ef=typeof window<"u"&&it(window.requestIdleCallback),Ks=0;Ln&&(Ks=$t.match(/chrome\/([\d.]+)/)[1]);var rf=!kn&&(qs||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),nf=typeof window<"u"&&"WebGLRenderingContext"in window,to=Vs(),zn=!1;try{var af=new OffscreenCanvas(2,2);af.getContext("2d"),zn=!0}catch{zn=!1}var eo=!1;try{window.addEventListener("testPassive",function(){},{get passive(){eo=!0}})}catch{}Gi={isTest:!1,ie:ei,ielt9:ei&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:Dn,gecko:Js,android:$t.indexOf("android")!==-1,android23:Us,chrome:Ln,chromeVersion:Ks,safari:!Ln&&$t.indexOf("safari")!==-1,phantomjs:kn,ie3d:$s,webkit3d:In,gecko3d:Ys,opera12:Qs,any3d:$l,iosWeixin:ql,mobile:Ti,mobileWebkit:Ti&&Dn,mobileWebkit3d:Ti&&In,mobileOpera:Ti&&window.opera,mobileGecko:Ti&&Js,touch:!!rf,msPointer:!!Xs,pointer:!!qs,retina:to>1,devicePixelRatio:to,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:ei&&document.documentMode===9,ie10:ei&&document.documentMode===10,webgl:nf,imageBitMap:Yl,resizeObserver:Ql,btoa:Kl,decodeImageInWorker:zn,monitorDPRChange:!0,supportsPassive:eo,proxy:tf,requestIdleCallback:ef,checkDevicePixelRatio:function(){if(typeof window<"u"&&Gi.monitorDPRChange){var a=Vs(),i=a!==Gi.devicePixelRatio;return i&&(Gi.devicePixelRatio=a),i}return!1}}}var q=Gi;function io(s,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,lf(r.key),r)}}function sf(s,a,i){return a&&io(s.prototype,a),i&&io(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function ya(){return ya=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},ya.apply(this,arguments)}function z(s,a){s.prototype=Object.create(a.prototype),s.prototype.constructor=s,Ui(s,a)}function wa(s){return wa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},wa(s)}function Ui(s,a){return Ui=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,t){return r.__proto__=t,r},Ui(s,a)}function of(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function zr(s,a,i){return of()?zr=Reflect.construct.bind():zr=function(t,e,n){var o=[null];o.push.apply(o,e);var h=Function.bind.apply(t,o),u=new h;return n&&Ui(u,n.prototype),u},zr.apply(null,arguments)}function hf(s){return Function.toString.call(s).indexOf("[native code]")!==-1}function xa(s){var a=typeof Map=="function"?new Map:void 0;return xa=function(r){if(r===null||!hf(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(r))return a.get(r);a.set(r,t)}function t(){return zr(r,arguments,wa(this).constructor)}return t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Ui(t,r)},xa(s)}function mt(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function uf(s,a){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var r=i.call(s,a||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function lf(s){var a=uf(s,"string");return typeof a=="symbol"?a:String(a)}var kh=function(){function s(i,r,t){if(!P(i)&&!P(r)?(this.x=+i,this.y=+r,this.z=t):!P(i.x)&&!P(i.y)?(this.x=+i.x,this.y=+i.y,this.z=i.z):Array.isArray(i)&&(this.x=+i[0],this.y=+i[1],this.z=i[2]),this._isNaN())throw new Error("Position is NaN")}var a=s.prototype;return a.set=function(r,t,e){return this.x=r,this.y=t,this.z=e||0,this},a.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},a._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},a._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},a.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},a._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},a.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},a.distanceTo=function(r){var t=r.x-this.x,e=r.y-this.y;return Math.sqrt(t*t+e*e)},a.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},a.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},a.copy=function(){return new this.constructor(this.x,this.y,this.z)},a._add=function(r,t){return P(r.x)?P(r[0])?(this.x+=r,this.y+=t):(this.x+=r[0],this.y+=r[1]):(this.x+=r.x,this.y+=r.y),this},a.add=function(r,t){var e,n;return P(r.x)?P(r[0])?(e=this.x+r,n=this.y+t):(e=this.x+r[0],n=this.y+r[1]):(e=this.x+r.x,n=this.y+r.y),new this.constructor(e,n)},a._sub=function(r,t){return P(r.x)?P(r[0])?(this.x-=r,this.y-=t):(this.x-=r[0],this.y-=r[1]):(this.x-=r.x,this.y-=r.y),this},a._substract=function(){return this._sub.apply(this,arguments)},a.sub=function(r,t){var e,n;return P(r.x)?P(r[0])?(e=this.x-r,n=this.y-t):(e=this.x-r[0],n=this.y-r[1]):(e=this.x-r.x,n=this.y-r.y),new this.constructor(e,n)},a.substract=function(){return this.sub.apply(this,arguments)},a.multi=function(r){return new this.constructor(this.x*r,this.y*r)},a._multi=function(r){return this.x*=r,this.y*=r,this},a.div=function(r){return this.multi(1/r)},a._div=function(r){return this._multi(1/r)},a.equals=function(r){return r instanceof this.constructor?this.x===r.x&&this.y===r.y&&this.z===r.z:!1},a._isNaN=function(){return isNaN(this.x)||isNaN(this.y)||H(this.z)&&isNaN(this.z)},a.isZero=function(){return this.x===0&&this.y===0},a.toArray=function(){return H(this.z)?[this.x,this.y,this.z]:[this.x,this.y]},a.toFixed=function(r){return new this.constructor(this.x.toFixed(r),this.y.toFixed(r),H(this.z)?this.z.toFixed:void 0)},a.toJSON=function(){var r={x:this.x,y:this.y};return H(this.z)&&(r.z=this.z),r},s}(),E=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},i.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.unit=function(){return this.copy()._unit()},i._unit=function(){return this._div(this.mag()),this},i.perp=function(){return this.copy()._perp()},i._perp=function(){var t=this.y;return this.y=this.x,this.x=-t,this},i.angleWith=function(t){return this.angleWithSep(t.x,t.y)},i.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},i._rotate=function(t){var e=Math.cos(t),n=Math.sin(t),o=e*this.x-n*this.y,h=n*this.x+e*this.y;return this.x=o,this.y=h,this},i.rotate=function(t){return this.copy()._rotate(t)},a}(kh),ve,Ji;(function(){if(bt){ve=function(n){return setTimeout(n,16)},Ji=clearTimeout;return}var s,a,i=1e3/30;function r(e){return setTimeout(e,i)}function t(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}typeof window<"u"?(s=window.requestAnimationFrame||t("RequestAnimationFrame")||r,a=window.cancelAnimationFrame||t("CancelAnimationFrame")||t("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)}):(s=r,a=clearTimeout),ve=function(n){return s(n)},Ji=function(n){n&&a(n)}})();function Be(s){var a="data:image/svg+xml";return s.length>4&&s.slice(-4)===".svg"?1:s.slice(0,a.length)===a?2:0}function Xi(s,a){if(bt&&Xi.node){Xi.node(s,a);return}s.src=a[0]}var ff=0;function we(){return ff++}var Lh=we;function qi(s){return!s||!tt(s)?s:JSON.parse(s)}function ie(s){for(var a=1;a<arguments.length;a++){var i=arguments[a];if(i&&i.length)for(var r=0,t=i.length;r<t;r++)s.push(i[r])}return s.length}function Hr(s,a){var i=a.indexOf(s);i>-1&&a.splice(i,1)}function Ue(s,a,i){if(!Array.isArray(s))return i?a.call(i,s):a(s);for(var r=[],t,e,n=0,o=s.length;n<o;n++){if(t=s[n],P(t)){r.push(null);continue}Array.isArray(t)?r.push(Ue(t,a,i)):(e=i?a.call(i,t):a(t),r.push(e))}return r}function W(s,a){return s===void 0?a:s}function Ot(s){return Math.sign?Math.sign(s):(s=+s,s===0||isNaN(s)?Number(s):s>0?1:-1)}function cf(s){if(Math.log2)return Math.log2(s);var a=Math.log(s)*Math.LOG2E,i=Math.round(a);return Math.abs(i-a)<1e-14?i:a}function Nr(s,a,i){return s*(1-i)+a*i}function me(s,a,i){if(s===i||s===a)return s;var r=i-a,t=((s-a)%r+r)%r+a;return t}function Br(s,a,i){return Math.min(i,Math.max(a,s))}function st(s){return Array.isArray(s)&&s.length>0}var df=/^([a-z][a-z\d+\-.]*:)?\/\//i;function gf(s){return df.test(s)}var Ih=/^url\((['"])(.+)\1\)$/i,zh=/^url\(([^'"].*[^'"])\)$/i;function jh(s){return tt(s)?zh.test(s)?1:Ih.test(s)?2:3:0}function sn(s){var a=jh(s),i;return a===3?s:a===1?(i=zh.exec(s),i[1]):a===2?(i=Ih.exec(s),i[2]):s}var vf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Gh(s){if(q.btoa)return window.btoa(s);for(var a=String(s),i="",r,t,e=0,n=vf;a.charAt(e|0)||(n="=",e%1);i+=n.charAt(63&r>>8-e%1*8)){if(t=a.charCodeAt(e+=3/4),t>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");r=r<<8|t}return i}function Fh(s,a){for(var i=atob(s),r=new ArrayBuffer(i.length),t=new Uint8Array(r),e=0;e<i.length;e++)t[e]=i.charCodeAt(e)&255;var n=new Blob([r],{type:a});return n}function Zr(s,a,i,r){var t=i-s,e=r-a;return Math.atan2(e,t)}var Na="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function Wr(s,a){if(!s&&!a)return!0;if(!s||!a)return!1;for(var i in s)if(i==="center"){if(!a[i]||!ro(s[i][0],a[i][0])||!ro(s[i][1],a[i][1]))return!1}else if(s[i]!==a[i])return!1;return!0}function ro(s,a,i){return i==null&&(i=1e-6),s>=a-i&&s<=a+i}function Ba(s,a,i,r){s||(s=100),a||(a=4);var t=this,e=this.isVisible();a*=2,this._flashTimeout&&clearTimeout(this._flashTimeout);function n(){if(a===0){e?t.show():t.hide(),i&&(r?i.call(r):i());return}a%2===0?t.hide():t.show(),a--,t._flashTimeout=setTimeout(n,s)}return this._flashTimeout=setTimeout(n,s),this}function mf(s,a){for(var i=Object.getOwnPropertyNames(a),r=0;r<i.length;r++){var t=i[r],e=Object.getOwnPropertyDescriptor(a,t);e&&e.configurable&&s[t]===void 0&&Object.defineProperty(s,t,e)}return s}function $i(s,a){s===void 0&&(s=[]),a===void 0&&(a="_pt");for(var i=[],r=0,t=s.length;r<t;r++){var e=s[r];if(!e){i.push(null);continue}e[a]||(e[a]=new E(0,0));var n=e[a];n.x=0,n.y=0,i.push(n)}return i}function Za(s,a){a(s.data)}function on(s){if(s&&s.indexOf("http://")===0||s.indexOf("https://")===0)return s;var a=document.createElement("a");return a.href=s,s=a.href,a=null,s}var Mi={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function Wa(s,a){a===void 0&&(a=1);var i=s.width,r=s.height;return Mi.cssWidth=i+"px",Mi.cssHeight=r+"px",Mi.width=Math.round(i*a),Mi.height=Math.round(r*a),Mi}var ii,Ca={width:100,height:10};function _f(){if(!ii){var s=Ca.width,a=Ca.height;OffscreenCanvas?ii=new OffscreenCanvas(s,a):(ii=document.createElement("canvas"),ii.width=s,ii.height=a)}return ii}var no=function(){function s(i,r){if(r===void 0&&(r={}),!Array.isArray(i)){console.error("colors is not array");return}if(i.length<2){console.error("colors.length should >1");return}this.colors=i;for(var t=1/0,e=-1/0,n=0,o=i.length;n<o;n++){var h=i[n][0];t=Math.min(h,t),e=Math.max(h,e)}this.min=t,this.max=e,this.valueOffset=this.max-this.min,this.options=Object.assign({},Ca,r),this._initImgData()}var a=s.prototype;return a.getImageData=function(){return this.imgData},a._initImgData=function(){var r=_f(),t=this.options,e=t.width,n=t.height;r.width=e,r.height=n;var o=r.getContext("2d");o.clearRect(0,0,r.width,r.height);for(var h=o.createLinearGradient(0,0,r.width,0),u=this.colors,l=this.valueOffset,f=0,c=u.length;f<c;f++){var d=u[f],g=d[0],v=d[1],m=(g-this.min)/l;h.addColorStop(m,v)}o.fillStyle=h,o.fillRect(0,0,r.width,r.height),this.imgData=o.getImageData(0,0,r.width,r.height)},a.getColor=function(r){r=Math.max(this.min,r),r=Math.min(r,this.max);var t=(r-this.min)/this.valueOffset,e=Math.round(t*this.imgData.width);e=Math.min(e,this.imgData.width-1);var n=e*4,o=this.imgData.data[n],h=this.imgData.data[n+1],u=this.imgData.data[n+2],l=this.imgData.data[n+3];return[o,h,u,l]},s}(),pf=typeof Map=="function",Fi;pf&&(Fi=new Map);function Hh(s,a){var i,r,t;if(!lt(s))i=function(){return s},r=!0,t=!0;else{var e=s.stops&&typeof s.stops[0][0]=="object",n=e||s.property!==void 0,o=e||!n,h=s.type||a||"exponential",u;if(h==="exponential")u=ao;else if(h==="interval")u=xf;else if(h==="categorical")u=wf;else if(h==="identity")u=Pf;else if(h==="color-interpolate")u=Cf;else throw new Error('Unknown function type "'+h+'"');if(e){for(var l={},f=[],c=0;c<s.stops.length;c++){var d=s.stops[c];l[d[0].zoom]===void 0&&(l[d[0].zoom]={zoom:d[0].zoom,type:s.type,property:s.property,default:s.default,stops:[]}),l[d[0].zoom].stops.push([d[0].value,d[1]])}for(var g in l)f.push([l[g].zoom,Hh(l[g])]);i=function(m,_){var p=ao({stops:f,base:s.base},m)(m,_);return typeof p=="function"?p(m,_):p},r=!1,t=!1}else o?(i=function(m){var _=u(s,m);return typeof _=="function"?_(m):_},r=!0,t=!1):(i=function(m,_){var p=u(s,_?_[s.property]:null);return typeof p=="function"?p(m,_):p},r=!1,t=!0)}return i.isZoomConstant=t,i.isFeatureConstant=r,i}function yf(s,a,i){return s!==void 0?s:a!==void 0?a:i!==void 0?i:null}function wf(s,a){for(var i=0;i<s.stops.length;i++)if(a===s.stops[i][0])return s.stops[i][1];return s.default}function xf(s,a){for(var i=0;i<s.stops.length&&!(a<s.stops[i][0]);i++);return s.stops[Math.max(i-1,0)][1]}function ao(s,a){for(var i=s.base!==void 0?s.base:1,r=0;!(r>=s.stops.length);){if(a<=s.stops[r][0])break;r++}return r===0?s.stops[r][1]:r===s.stops.length?s.stops[r-1][1]:Nh(a,i,s.stops[r-1][0],s.stops[r][0],s.stops[r-1][1],s.stops[r][1])}var so={width:100,height:1};function Cf(s,a){var i=s.stops;if(i&&i.length>1){var r;if(Fi){var t=JSON.stringify(i);if(!Fi.has(t)){var e=new no(i,so);Fi.set(t,e)}r=Fi.get(t)}else r=new no(i,so);var n=r.getColor(a),o=n[0],h=n[1],u=n[2],l=n[3];return[o/255,h/255,u/255,l/255]}else if(i&&i.length===1)return i[0][1];return null}function Pf(s,a){return yf(a,s.default)}function Nh(s,a,i,r,t,e){return typeof t=="function"?function(){var n=t.apply(void 0,arguments),o=e.apply(void 0,arguments);return Nh(s,a,i,r,n,o)}:t.length?Tf(s,a,i,r,t,e):Bh(s,a,i,r,t,e)}function Bh(s,a,i,r,t,e){var n=r-i,o=s-i,h;return a===1?h=o/n:h=(Math.pow(a,o)-1)/(Math.pow(a,n)-1),t*(1-h)+e*h}function Tf(s,a,i,r,t,e){for(var n=[],o=0;o<t.length;o++)n[o]=Bh(s,a,i,r,t[o],e[o]);return n}function lt(s){return s&&typeof s=="object"&&(s.stops||s.property&&s.type==="identity")}function Va(s){for(var a in s)if(lt(s[a]))return!0;return!1}function Yi(s){return Ua(s,"exponential")}function Mf(s){return Ua(s,"interval")}function hn(s,a){if(!s)return null;var i=!1;if(Array.isArray(s)){for(var r=[],t,e=0;e<s.length;e++)t=hn(s[e],a),t?(r.push(t),i=!0):r.push(s[e]);return i?r:s}var n={__fn_types_loaded:!0},o=[],h;for(h in s)s.hasOwnProperty(h)&&o.push(h);for(var u=function(d){Object.defineProperty(n,d,{get:function(){return this["__fn_"+d]||(this["__fn_"+d]=Yi(this["_"+d])),this["__fn_"+d].apply(this,a())},set:function(v){this["_"+d]=v},configurable:!0,enumerable:!0})},l=0,f=o.length;l<f;l++)h=o[l],lt(s[h])?(i=!0,n["_"+h]=s[h],u(h)):n[h]=s[h];return i?n:s}function Pa(s){if(!s||!s.stops)return[];for(var a=[],i=0,r=s.stops.length;i<r;i++)a.push(s.stops[i][1]);return a}function Ua(s,a){if(!lt(s))return function(){return s};s=JSON.parse(JSON.stringify(s));var i=!0,r=!0,t=s.stops;if(t){for(var e=0;e<t.length;e++)if(lt(t[e][1])){var n=Ua(t[e][1],a);i=i&&n.isZoomConstant,r=r&&n.isFeatureConstant,t[e]=[t[e][0],n]}}var o=Hh(s,a);return o.isZoomConstant=i&&o.isZoomConstant,o.isFeatureConstant=r&&o.isFeatureConstant,o}var Ja=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Sf(s){return typeof s=="object"&&!!s}function un(s){return new Function("f","var p = (f && f.properties || {}); return "+Wh(s))}function Zh(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":case"!has":return s.length===2&&(typeof s[1]=="string"||s[1].property&&s[1].op);case"in":case"!in":return s.length>=2&&(typeof s[1]=="string"||s[1].property&&s[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return s.length===3&&(typeof s[1]=="string"||s[1].property&&s[1].op);case"none":case"any":case"all":for(var r=s.slice(1),a=Array.isArray(r),i=0,r=a?r:r[Symbol.iterator]();;){var t;if(a){if(i>=r.length)break;t=r[i++]}else{if(i=r.next(),i.done)break;t=i.value}var e=t;if(!Zh(e)&&typeof e!="boolean")return!1}return!0;case"contains":return!0;default:return!1}}function Wh(s){if(!s)return"true";var a=s[0];if(s.length<=1)return a==="any"?"false":"true";var i=a==="=="?jn(s[1],s[2],"===",!1):a==="!="?jn(s[1],s[2],"!==",!1):a==="<"||a===">"||a==="<="||a===">="?jn(s[1],s[2],a,!0):a==="any"?Gn(s.slice(1),"||"):a==="all"?Gn(s.slice(1),"&&"):a==="none"?Fn(Gn(s.slice(1),"||")):a==="in"?oo(s[1],s.slice(2)):a==="!in"?Fn(oo(s[1],s.slice(2))):a==="has"?ho(s[1]):a==="!has"?Fn(ho(s[1])):a==="contains"?Ef(s[1],s[2],s[3]):"true";return"("+i+")"}function bf(s,a,i,r){var t=s.property,e=s.op,n=ln(t);if(e==="length")n="(("+n+"+='').length)";else return console.error("not support "+e+" op"),"false";return Vh(n,t,a,i,r)}function Ef(s,a,i){var r=ln(s);return i!==void 0?"("+r+` + '').indexOf("`+a+'") === '+i:"("+r+` + '').indexOf("`+a+'") >= 0'}function ln(s){return s[0]==="$"?"f."+s.substring(1):"p["+JSON.stringify(s)+"]"}function jn(s,a,i,r){if(Sf(s)&&s.op)return bf(s,a,i,r);var t=ln(s);return Vh(t,s,a,i,r)}function Vh(s,a,i,r,t){var e=a==="$type"?Ja.indexOf(i):JSON.stringify(i);return(t?"typeof "+s+"=== typeof "+e+"&&":"")+s+r+e}function Gn(s,a){return s.map(Wh).join(a)}function oo(s,a){s==="$type"&&(a=a.map(function(t){return Ja.indexOf(t)}));var i=JSON.stringify(a.sort(Rf)),r=ln(s);return a.length<=200?i+".indexOf("+r+") !== -1":`function(v, a, i, j) {
        while (i <= j) { var m = (i + j) >> 1;
            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;
        }
    return false; }(`+r+", "+i+",0,"+(a.length-1)+")"}function ho(s){return s==="$id"?'"id" in f':JSON.stringify(s)+" in p"}function Fn(s){return"!("+s+")"}function Rf(s,a){return s<a?-1:s>a?1:0}function Vr(s){var a=s._toJSON(),i=a.feature;return i.type=Ja.indexOf(i.geometry.type),i.subType=a.subType,i}function Xa(s){if(!Array.isArray(s))return Xa([s]);for(var a=[],i=0;i<s.length;i++){var r=void 0;s[i].filter===!0?r=function(){return!0}:r=un(s[i].filter),a.push(Af({},s[i],{filter:r}))}return a}function Af(s){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var r in i)s[r]=i[r]}return s}var Of=[],Df={};function Qi(s,a){return hn(s,function(){var i=a.getMap();return kf(Of,i?i.getZoom():12,F({},a.getProperties(),Lf(Df,i&&i.getBearing()||0,i&&i.getPitch()||0,i?i.getZoom():10)))})}function kf(s,a,i){return s[0]=a,s[1]=i,s}function Lf(s,a,i,r){return s["{bearing}"]=a,s["{pitch}"]=i,s["{zoom}"]=r,s}var Lv=Object.freeze({loadGeoSymbol:Qi,createFilter:un,isFeatureFilter:Zh,getFilterFeature:Vr,compileStyle:Xa,isFunctionDefinition:lt,hasFunctionDefinition:Va,interpolated:Yi,piecewiseConstant:Mf,loadFunctionTypes:hn,getFunctionTypeResources:Pa});function Uh(s){var a={stroke:{stroke:s.markerLineColor,"stroke-width":s.markerLineWidth,"stroke-opacity":s.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:s.markerFill,"fill-opacity":s.markerFillOpacity}};return a.stroke["stroke-width"]===0&&(a.stroke["stroke-opacity"]=0),a}function Ki(s,a,i){if(!s.markerPath)return null;var r=1,t=Uh(s);H(s.markerOpacity)&&(r=s.markerOpacity),H(s.opacity)&&(r*=s.opacity);var e={};if(t){for(var n in t.stroke)t.stroke.hasOwnProperty(n)&&(P(t.stroke[n])||(e[n]=t.stroke[n]));for(var o in t.fill)t.fill.hasOwnProperty(o)&&(P(t.fill[o])||(e[o]=t.fill[o]))}for(var h=Array.isArray(s.markerPath)?s.markerPath:[s.markerPath],u,l=[],f=0;f<h.length;f++)u=tt(h[f])?{path:h[f]}:h[f],u=F({},u,e),u.d=u.path,delete u.path,l.push(u);var c=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];r<1&&c.push('opacity="'+r+'"'),s.markerPathWidth&&s.markerPathHeight&&c.push('viewBox="0 0 '+s.markerPathWidth+" "+s.markerPathHeight+'"'),c.push('preserveAspectRatio="none"'),a&&c.push('width="'+a+'"'),i&&c.push('height="'+i+'"'),c.push("><defs></defs>");for(var d=0;d<l.length;d++){var g="<path ";for(var v in l[d])l[d].hasOwnProperty(v)&&(g+=" "+v+'="'+l[d][v]+'"');g+="></path>",c.push(g)}c.push("</svg>");var m="data:image/svg+xml;base64,"+Gh(c.join(" "));return m}function hr(s,a){if(!s)return[];var i=s;Array.isArray(s)||(i=[s]);for(var r=[],t=Ah,e,n,o,h,u=i.length-1;u>=0;u--)if(s=i[u],!!s){a&&(s=Ur(s));for(var l=0;l<t.length;l++)if(e=s[t[l]],lt(e)&&(e=Pa(e)),!!e){Array.isArray(e)||(e=[e]);for(var f=0;f<e.length;f++)e[f].slice(0,4)==="url("&&(e[f]=sn(e[f])),n=Zl[l],r.push([e[f],s[n[0]],s[n[1]]])}if(s.markerType==="path"&&s.markerPath)if(o=lt(s.markerWidth)?200:s.markerWidth,h=lt(s.markerHeight)?200:s.markerHeight,lt(s.markerPath)){e=Pa(s.markerPath);for(var c=s.markerPath,d=0;d<e.length;d++)s.markerPath=e[d],r.push([Ki(s),o,h]);s.markerPath=c}else r.push([Ki(s),o,h])}return r}function Ur(s){if(!s)return null;var a=s;if(bt)return a;for(var i=Ah,r,t=0,e=i.length;t<e;t++)r=a[i[t]],r&&(a[i[t]]=Jh(r));return a}function Jh(s){if(lt(s)&&s.stops){for(var a=s.stops,i=0;i<a.length;i++)a[i][1]=Jh(a[i][1]);return s}return s.slice(0,4)==="url("&&(s=sn(s)),s}var xt=function(){function s(i,r){H(i)&&H(r)?(this.width=i,this.height=r):H(i.width)?(this.width=i.width,this.height=i.height):Array.isArray(i)&&(this.width=i[0],this.height=i[1])}var a=s.prototype;return a.copy=function(){return new s(this.width,this.height)},a.add=function(r,t){var e,n;return r instanceof s?(e=this.width+r.width,n=this.height+r.height):(e=this.width+r,n=this.height+t),new s(e,n)},a.equals=function(r){return this.width===r.width&&this.height===r.height},a.multi=function(r){return new s(this.width*r,this.height*r)},a._multi=function(r){return this.width*=r,this.height*=r,this},a._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},a.toPoint=function(){return new E(this.width,this.height)},a.toArray=function(){return[this.width,this.height]},a.toJSON=function(){return{width:this.width,height:this.height}},s}();function fn(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")}var If=/[\b\t\r\v\f]/igm;function ur(s){return tt(s)?s.replace(If,""):s}function qa(s){return fn(s).split(/\s+/)}var uo=typeof document<"u"?document.createElement("canvas").getContext("2d"):null;function ge(s,a){return ge.node?ge.node(s,a):(uo.font=a,uo.measureText(s).width)}function cn(s,a,i){var r=ge(s,a);return new xt(r,i||Oh)}function Jr(s,a,i,r){if(!s||s.length===0)return[{text:"",width:0}];var t=P(r)?ge(s,a):r,e=t/s.length,n=Math.floor(i/e/2);if(e>=i||n<=0)return[{text:"",width:i}];if(t<=i)return[{text:s,width:t}];for(var o=[],h=s.substring(0,n),u=e*n,l=n,f=s.length;l<f;l++){var c=s[l],d=ge(h+c);d>=i?(o.push({text:h,width:u}),h=s.substring(l,n+l),l+=n-1,u=e*n):(h+=c,u=d),l>=f-1&&(u=ge(h),o.push({text:h,width:u}))}return o}var $a=/\{([\w_]+)\}/g;function tr(s,a){return tt(s)?s.replace($a,function(i,r){if(!a)return"";var t=a[r];return P(t)?"":Array.isArray(t)?t.join():t}):s}function er(s,a){H(s)&&(s+=""),s=s||"";var i=a.textMaxHeight||0,r=gn(s,a);return i&&i<r.size.height&&(r.size.height=i),r}function he(s,a,i){var r=s.width,t=s.height,e,n;return a==="left"?e=-r:a==="right"?e=0:e=-r/2,i==="top"?n=-t:i==="bottom"?n=0:n=-t/2,new E(e,n)}var Ya="sans-serif",Qa=14;function dn(s){if(s.textFont)return s.textFont;var a=s.textSize;return P(a)&&(a=Qa),(s.textStyle&&s.textStyle!=="normal"?s.textStyle+" ":"")+(s.textWeight&&s.textWeight!=="normal"?s.textWeight+" ":"")+a+"px "+(s.textFaceName&&zf(s.textFaceName)||Ya)}function zf(s){for(var a=s.split(","),i=0;i<a.length;i++)a[i].trim&&(a[i]=a[i].trim()),a[i].indexOf(" ")>0&&a[i][0]!=='"'&&a[i][0]!=="'"&&(a[i]='"'+a[i]+'"');return a.join(",")}function gn(s,a){var i=dn(a),r=a.textLineSpacing||0,t=cn(s,i,a.textSize),e=t.width,n=t.height,o=a.textWrapCharacter||`
`,h=[],u=a.textWrapWidth;(!u||u>e)&&(u=e),tt(s)||(s+="");var l=0;if(o&&s.indexOf(o)>=0)for(var f=s.split(o),c=0,d=f.length;c<d;c++){var g=f[c],v=ge(g,i);if(v>u)for(var m=Jr(g,i,u,v),_=0,p=m.length;_<p;_++){var y=m[_].width;y>l&&(l=y),h.push({text:m[_].text,size:new xt(y,n)})}else v>l&&(l=v),h.push({text:g,size:new xt(v,n)})}else if(e>u)for(var w=Jr(s,i,u,e),C=0;C<w.length;C++){var x=w[C].width;x>l&&(l=x),h.push({text:w[C].text,size:new xt(x,n)})}else e>l&&(l=e),h.push({text:s,size:t});var M=h.length,S=new xt(l,n*M+r*(M-1));return{total:M,size:S,rows:h,rawSize:t}}function vn(s){var a=0,i=s&&s.length||0;if(!i)return a;for(var r,t=0;t<i;t++)r=s.charCodeAt(t),a=(a<<5)-a+r,a=a&a;return a}var Iv=Object.freeze({trim:fn,escapeSpecialChars:ur,splitWords:qa,stringWidth:ge,stringLength:cn,splitContent:Jr,CONTENT_EXPRE:$a,replaceVariable:tr,describeText:er,getAlignPoint:he,DEFAULT_FONT:Ya,DEFAULT_TEXTSIZE:Qa,getFont:dn,splitTextToRow:gn,hashCode:vn});function _e(s){return s&&s.colorStops}function Ta(s){var a=[s.type];if(s.places&&a.push(s.places.join()),s.colorStops){for(var i=[],r=s.colorStops.length-1;r>=0;r--)i.push(s.colorStops[r].join());a.push(i.join(","))}return a.join("_")}function jf(s,a){return lr(s,a)}function lr(s,a){if(!s)return 1;var i=[];if(Array.isArray(s)){for(var r=0;r<s.length;r++)i.push(lr(s[r],a));return i.sort().join(",")}var t=Object.keys(s).sort(),e=t.reduce(function(o,h){return(!a||h.indexOf(a)===0)&&(o[h]=s[h]),o},{}),n=vn(JSON.stringify(e));return n}function Xr(s,a){function i(n,o){var h=n.opacity;P(h)?n.opacity=o:n.opacity*=o}var r;if(Array.isArray(s)){r=[];for(var t=0;t<s.length;t++){var e=F({},s[t]);i(e,a),r.push(e)}}else r=F({},s),i(r,a);return r}function Kt(s){var a=Array.prototype.slice.call(arguments,1);if((!a||!a.length)&&(a=[{}]),Array.isArray(s)){for(var i,r,t=[],e=0,n=s.length;e<n;e++){i=s[e],r={};for(var o=0,h=a.length;o<h;o++)Array.isArray(a[o])?P(a[o][e])?F(r,i||{}):F(r,i,a[o][e]):F(r,i,a[o]?a[o]:{});t.push(r)}return t}else{var u=[{},s];return u.push.apply(u,a),F.apply(this,u)}}function Xh(s){if(s.symbol&&(s=[s]),Array.isArray(s))return s;var a=s.$root,i=s.$iconset;if(s=s.style,a||i){a&&a[a.length-1]==="/"&&(a=a.substring(0,a.length-1)),i&&i[i.length-1]==="/"&&(i=i.substring(0,i.length-1));var r=function(e){return e==="{$root}"?a:e==="{$iconset}"?i:null};qh(s,r)}return s}function qh(s,a){for(var i=0;i<s.length;i++){var r=s[i].symbol;r&&Ka(r,a)}}var Ma=/(\{\$root\}|\{\$iconset\})/g;function Ka(s,a){for(var i in s)s.hasOwnProperty(i)&&i!=="textName"&&(tt(s[i])&&s[i].length>2?s[i]=s[i].replace(Ma,a):lt(s[i])?s[i]=$h(s[i],a):ee(s[i])&&Ka(s[i],a))}function $h(s,a){var i=s.default;tt(i)&&(s.default=i.replace(Ma,a));var r=s.stops;if(!r)return s;for(var t=0;t<r.length;t++)Array.isArray(r[t])&&(tt(r[t][1])?r[t][1]=r[t][1].replace(Ma,a):lt(r[t][1])&&(r[t][1]=$h(r[t][1],a)));return s}function Yh(s){s===void 0&&(s=[]),Array.isArray(s)||(s=[s]);for(var a=s.length,i=0;i<a;i++){var r=s[i];if(r.style){var t=r.style,e=t.lineDasharray,n=t.lineWidth;if(n&&H(n)&&n>0&&e&&Array.isArray(e)&&e.length)return!0}}return!1}var zv=Object.freeze({now:at,extend:F,isNil:P,isNumber:H,isInteger:Ne,isObject:ee,isString:tt,isFunction:it,hasOwn:wi,join:Jl,isEmpty:Xl,toRadian:pt,toDegree:Ha,IS_NODE:bt,get requestAnimFrame(){return ve},get cancelAnimFrame(){return Ji},isSVG:Be,loadImage:Xi,UID:we,GUID:Lh,parseJSON:qi,pushIn:ie,removeFromArray:Hr,forEachCoord:Ue,getValueOrDefault:W,sign:Ot,log2:cf,interpolate:Nr,wrap:me,clamp:Br,isArrayHasData:st,isURL:gf,isCssUrl:jh,extractCssUrl:sn,btoa:Gh,b64toBlob:Fh,computeDegree:Zr,emptyImageUrl:Na,equalMapView:Wr,flash:Ba,_defaults:mf,getPointsResultPts:$i,getImageBitMap:Za,getAbsoluteURL:on,calCanvasSize:Wa,translateToSVGStyles:Uh,getMarkerPathBase64:Ki,getExternalResources:hr,convertResourceUrl:Ur,isGradient:_e,getGradientStamp:Ta,getSymbolStamp:jf,getSymbolHash:lr,lowerSymbolOpacity:Xr,extendSymbol:Kt,parseStyleRootPath:Xh,convertStylePath:qh,parseSymbolPath:Ka,isDashLine:Yh,trim:fn,escapeSpecialChars:ur,splitWords:qa,stringWidth:ge,stringLength:cn,splitContent:Jr,CONTENT_EXPRE:$a,replaceVariable:tr,describeText:er,getAlignPoint:he,DEFAULT_FONT:Ya,DEFAULT_TEXTSIZE:Qa,getFont:dn,splitTextToRow:gn,hashCode:vn}),Gf=function(a){return a[0]},mn=bt?Gf:function(s){for(var a=document.documentElement&&document.documentElement.style||{},i=0;i<s.length;i++)if(s[i]in a)return s[i];return!1},Yt=mn(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),Qh=mn(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),Hi=mn(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]),Ff=mn(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function V(s,a){var i=document.createElement(s);return a&&_n(i,a),i}function Sa(s,a,i){var r=V(s);return a&&cr(r,a),i&&i.appendChild(r),r}function Je(s){if(!s)return this;if(q.ielt9||q.ie9){var a=V("div");a.appendChild(s),a.innerHTML="",a=null}else s.parentNode&&s.parentNode.removeChild(s);return this}function Xt(s,a,i,r){if(!s||!s.addEventListener||!a||!i)return this;for(var t=function(l){l||(l=window.event),i.call(r||s,l)},e=a.split(" "),n=e.length-1;n>=0;n--){var o=e[n];if(o){s["Z__"+o]||(s["Z__"+o]=[]);var h=ts(s,o,i);h>=0&&(console.warn(s,"find '"+o+"' handler:",i," The old listener function will be removed"),De(s,o,i)),s["Z__"+o].push({callback:t,src:i}),s.addEventListener(o,t,q.supportsPassive?{capture:!1,passive:!1}:!1)}}return this}function De(s,a,i){function r(c,d){c==="mousewheel"&&q.gecko&&(c="DOMMouseScroll"),s.removeEventListener(c,d,!1)}if(!s||!s.removeEventListener||!a)return this;for(var t=a.split(" "),e=t.length-1;e>=0;e--){var n=t[e];if(n){if(!i&&s["Z__"+n]){for(var o=s["Z__"+n],h=0,u=o.length;h<u;h++)r(o[h].callback);return delete s["Z__"+n],this}var l=ts(s,n,i);if(l<0)return this;var f=s["Z__"+n][l];r(n,f.callback),s["Z__"+n].splice(l,1)}}return this}function ts(s,a,i){if(!s||!s["Z__"+a]||!i)return-1;for(var r=s["Z__"+a],t=0,e=r.length;t<e;t++)if(r[t].src===i)return t;return-1}function ue(s){return s.preventDefault?s.preventDefault():s.returnValue=!1,this}function jt(s){return s._cancelBubble=!0,s.stopPropagation?s.stopPropagation():s.cancelBubble=!0,this}function Kh(s){return s.onselectstart=function(){return!1},s.ondragstart=function(){return!1},s.setAttribute("unselectable","on"),this}function Ni(s,a){return s?(q.any3d?tu(s,a):(s.style.left=a.x+"px",s.style.top=a.y+"px"),a):null}function fr(s){var a=window.getComputedStyle(s),i=[parseInt(a["padding-left"]),parseInt(a["padding-top"])],r=s.getBoundingClientRect(),t=s.offsetWidth,e=s.offsetHeight,n=t?r.width/t:1,o=e?r.height/e:1;return s.__position=[r.left+i[0],r.top+i[1],n,o],s.__position}function Ht(s,a){s||(s=window.event);var i=a.__position;return i||(i=fr(a)),new E((s.clientX-i[0]-a.clientLeft)/i[2],(s.clientY-i[1]-a.clientTop)/i[3])}function Hf(s,a){var i=s.length-a.length;return i>=0&&s.indexOf(a,i)===i}function cr(s,a){var i=s.style.cssText;return Hf(i,";")||(i+=";"),s.style.cssText=i+a,this}function es(s,a){if(s.classList!==void 0)return s.classList.contains(a);var i=is(s);return i.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(i)}function Ze(s,a){if(s.classList!==void 0&&!es(s,a))for(var i=qa(a),r=0,t=i.length;r<t;r++)s.classList.add(i[r]);else{var e=is(s);_n(s,(e?e+" ":"")+a)}return this}function _n(s,a){return P(s.className.baseVal)?s.className=a:s.className.baseVal=a,this}function is(s){return P(s.className.baseVal)?s.className:s.className.baseVal}function Nf(s,a){return s.style.opacity=a,this}function tu(s,a){var i=a||new E(0,0);return s.style[Yt]=q.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)",this}function Bf(s,a){var i="matrix("+(tt(a)?a:a.join())+")";return s.style[Yt]!==i&&(s.style[Yt]=i),this}function Zf(s){return s.style[Yt]&&(s.style[Yt]=""),this}function eu(s){return/<[a-z\][\s\S]*>/i.test(s)}function iu(s,a){var i=ru(s);tt(a)?i.innerHTML=a:i.appendChild(a);var r=new xt(i.clientWidth,i.clientHeight);return Je(i),r}function ru(s){var a=document.createElement(s);return a.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(a),a}var gt=Xt,_t=De;function ir(s){return s&&(s==="mousemove"||s==="touchmove")}var rs=48;function ns(s,a){var i=at(),r=a||rs;return s._mousemoveTime&&i-s._mousemoveTime<r?!0:(s._mousemoveTime=i,!1)}var jv=Object.freeze({TRANSFORM:Yt,TRANSFORMORIGIN:Qh,TRANSITION:Hi,CSSFILTER:Ff,createEl:V,createElOn:Sa,removeDomNode:Je,addDomEvent:Xt,removeDomEvent:De,listensDomEvent:ts,preventDefault:ue,stopPropagation:jt,preventSelection:Kh,offsetDom:Ni,computeDomPosition:fr,getEventContainerPoint:Ht,setStyle:cr,hasClass:es,addClass:Ze,setClass:_n,getClass:is,setOpacity:Nf,setTransform:tu,setTransformMatrix:Bf,removeTransform:Zf,isHTML:eu,measureDom:iu,getDomRuler:ru,on:gt,off:_t,isMoveEvent:ir,MOUSEMOVE_THROTTLE_TIME:rs,isMousemoveEventBlocked:ns}),ba;typeof Promise<"u"?ba=Promise:ba=jl;var rr=ba,as="core-fetch-image",nu;function Wf(s){nu=s}function Vf(){return nu}var au=!1;function Uf(){au=!0}function Jf(){return au}var su=[];function ou(s){return su.indexOf(s)>-1}function hu(s){ou(s)||su.push(s)}var We={};function uu(s,a){We[s]=a}var Xf=`
    var adapters = {};
    // Dynamic Create Adapter
    function createAdapter(key,code){
        if(adapters[key]||!code){
            return;
        }
        var func=new Function('exports',code+'(exports)');
        var workerExports={};
        func(workerExports,self);
        adapters[key]=workerExports;
        workerExports.initialize && workerExports.initialize(self);
        
    }
    onmessage = function (msg) {
        msg = msg.data;
        //createAdapter
        if (msg.messageType === 'createAdapter') {
           var key=msg.key;
           var code=msg.code;
           createAdapter(key,code);
           postMessage({adapterName:key});
           return;
        }
        // postMessage when main thread idle
        if(msg.messageType==='idle'){
            var messageCount = msg.messageCount||5;
            handleMessageQueue(messageCount);
            return;
        }
        if (msg.messageType === 'batch') {
            const messages = msg.messages;
            if (messages) {
                for (let i = 0; i < messages.length; i++) {
                    dispatch(messages[i]);
                }
            }
        } else {
            dispatch(msg);
        }
    };

    function dispatch(msg) {
        var workerKey = msg.workerKey;
        var adapter = adapters[workerKey];
        if (!adapter) {
            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);
            return;
        }
        try {
            adapter.onmessage(msg, wrap(msg.callback));
        } catch (err) {
            post(msg.callback, workerKey + ':' + err.message);
            console.error(err);
            throw err;
        }
    }

    var messageResultQueue = [];
    
    function handleMessageQueue(messageCount){
       if(messageResultQueue.length===0){
          return;
       }
       var queues = messageResultQueue.slice(0,messageCount);
       queues.forEach(function(queue){
          post(queue.callback,queue.err,queue.data,queue.buffers);
       });
       messageResultQueue=messageResultQueue.slice(messageCount,Infinity);
    }

    function post(callback, err, data, buffers) {
        var msg = {
            callback : callback
        };
        if (err) {
            msg.error = err;
        } else {
            msg.data = data;
        }
        if (buffers && buffers.length > 0) {
            postMessage(msg, buffers);
        } else {
            postMessage(msg);
        }
    }

    function joinQueue(callback,err,data,buffers){
        messageResultQueue.push({
            callback:callback,
            err:err,
            data:data,
            buffers:buffers
        });
    }

    function wrap(callback) {
        return function (err, data, buffers) {
            joinQueue(callback, err, data, buffers);
        };
    }
    var workerExports;
`,qf=`
    workerExports = null;
`;function $f(){var s=Xf;for(var a in We){var i=We[a];hu(a),it(i)&&i.length===0&&(i=i()),s+=`
    workerExports = {};
    (`+i+`)(workerExports, self);
    adapters['`+a+"'] = workerExports",s+=`
    workerExports.initialize && workerExports.initialize(self);
        `}return s+=qf,s}var Hn;function Yf(){if(typeof window>"u")return null;if(!Hn){var s=$f();Hn=window.URL.createObjectURL(new Blob([s],{type:"text/javascript"})),We={}}return Hn}function Qf(s,a){if(!We[s]){console.error("not find "+s+" adapter");return}var i=We[s];it(i)&&i.length===0&&(i=i()),i="("+i+")";var r=Vf();if(r){var t=r.workers||[];t.length===0&&console.error("workerpool workers count is 0");var e=0,n=function o(h){h=h.data||{},h.adapterName===s&&(e++,e===t.length&&(t.forEach(function(u){u.removeEventListener("message",o)}),delete We[s],a()))};t.forEach(function(o){o.addEventListener("message",n),o.postMessage({key:s,code:i,messageType:"createAdapter"})})}}var Kf=typeof window<"u"?window.navigator.hardwareConcurrency||4:0,tc=Math.max(Math.floor(Kf/2),1),lo=function(){function s(i){i===void 0&&(i=50),this._limit=i,this._messages=[],this.buffers=[]}var a=s.prototype;return a.addMessage=function(r,t){if(this._messages.push(r),!!Array.isArray(t))for(var e=0;e<t.length;e++)this.buffers.indexOf(t[e])<0&&this.buffers.push(t[e])},a.isFull=function(){return this._messages.length>=this._limit},a.getMessage=function(){return{messageType:"batch",messages:this._messages}},s}(),ec=function(){function s(){this.active={},this.workerCount=typeof window<"u"?Qt.workerCount||tc:0,this._messages=[],this._messageBuffers=[]}var a=s.prototype;return a.acquire=function(r){if(!this.workers){this.workers=[];for(var t=Yf(),e=0;e<this.workerCount;e++){var n=new Worker(t);n.id=e,this.workers.push(n)}URL.revokeObjectURL(t),Uf()}return this.active[r]=!0,this.workers.slice()},a.release=function(r){delete this.active[r],Object.keys(this.active).length===0&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)},a.addMessage=function(r,t,e){var n=this._messages[r];(!n||!n.length)&&(n=this._messages[r]=[new lo]);var o=n[n.length-1];o.isFull()&&(o=new lo,this._messages[r].push(o)),o.addMessage(t,e)},a.commit=function(){if(this.workers&&this._messages.length){for(var r=0;r<this._messages.length;r++)if(!(!this._messages[r]||!this._messages[r].length)){var t=this._messages[r].shift();this.workers[r].postMessage(t.getMessage(),t.buffers)}}},a.getWorkers=function(){return this.workers||[]},a.broadcastIdleMessage=function(){var r=this.getWorkers();return r.forEach(function(t){t.postMessage({messageType:"idle",messageCount:Qt.taskCountPerWorkerMessage})}),this},s}(),xr;function Ea(){return xr||(xr=new ec,Wf(xr)),xr}var Bi=[];function lu(s){ss();var a=new rr(function(i,r){if(!s){r(new Error("task is null"));return}if(it(s)&&(s={count:1,run:s}),!s.run){r(new Error("task.run is null"));return}if(P(s.count)&&(s.count=1),s.count=Math.ceil(s.count),!H(s.count)){r(new Error("task.count is not number"));return}s.results=[],Bi.push(s),s.resolve=i});return a}function ic(){if(Bi.length!==0){for(var s=[],a=[],i=Bi.length,r=0;r<i;r++){var t=Bi[r];if(t.count--,t.count===-1)a.push(t);else{s.push(t);var e=t.run();t.results.push(e)}}Bi=s,i=a.length;for(var n=0;n<i;n++){var o=a[n];o.resolve&&o.resolve(o.results)}}}var Nn=!0;function Bn(){Nn?Ea().broadcastIdleMessage():Ea().commit(),ic(),Nn=!Nn}var Zn=at();function qr(s){var a=Qt.idleTimeRemaining,i=Qt.idleLog,r=Qt.idleTimeout,t=Qt.idleForceTimeThreshold;if(q.requestIdleCallback){if(s&&s.timeRemaining){var e=s.timeRemaining();if(e>a||s.didTimeout)s.didTimeout&&i&&console.error("idle timeout in",r),Bn(),Zn=at();else{var n=at();n-Zn>t&&(Bn(),Zn=at()),e<=a&&i&&console.warn("currrent page is busy,the timeRemaining is",e)}}requestIdleCallback(qr,{timeout:r})}else Bn(),ve(qr),i&&console.warn("current env not support requestIdleCallback. Fallback to requestAnimFrame")}var fo=!1;function ss(){if(!fo){fo=!0;var s=Qt.idleTimeout;q.requestIdleCallback?requestIdleCallback(qr,{timeout:s}):ve(qr)}}var Gv=Object.freeze({runTaskAsync:lu,startTasks:ss}),fu=typeof Map=="function",cu=function(){},rc=function(){function s(i,r){this.max=i,this.onRemove=r||cu,this.reset()}var a=s.prototype;return a.reset=function(){for(var r in this.data)this.onRemove(this.data[r]);return this.data={},this.order=[],this},a.clear=function(){this.reset(),delete this.onRemove},a.add=function(r,t){if(this.has(r))this.order.splice(this.order.indexOf(r),1),this.data[r]=t,this.order.push(r);else if(this.data[r]=t,this.order.push(r),this.order.length>this.max){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},a.has=function(r){return r in this.data},a.keys=function(){return this.order},a.getAndRemove=function(r){if(!this.has(r))return null;var t=this.data[r];return delete this.data[r],this.order.splice(this.order.indexOf(r),1),t},a.get=function(r){if(!this.has(r))return null;var t=this.data[r];return t},a.remove=function(r){if(!this.has(r))return this;var t=this.data[r];return delete this.data[r],this.onRemove(t),this.order.splice(this.order.indexOf(r),1),this},a.setMaxSize=function(r){for(this.max=r;this.order.length>this.max;){var t=this.getAndRemove(this.order[0]);t&&this.onRemove(t)}return this},s}(),du;fu&&(du=function(){function s(i,r){this.max=i,this.onRemove=r||cu,this.reset()}var a=s.prototype;return a.reset=function(){if(this.data)for(var r=this.data.values(),n=r,t=Array.isArray(n),e=0,n=t?n:n[Symbol.iterator]();;){var o;if(t){if(e>=n.length)break;o=n[e++]}else{if(e=n.next(),e.done)break;o=e.value}var h=o;this.onRemove(h)}return this.data=new Map,this},a.clear=function(){this.reset(),delete this.onRemove},a.add=function(r,t){return t?(this.has(r)?(this.data.delete(r),this.data.set(r,t)):this.data.set(r,t),this):this},a.keys=function(){for(var r=new Array(this.data.size),t=0,e=this.data.keys(),h=e,n=Array.isArray(h),o=0,h=n?h:h[Symbol.iterator]();;){var u;if(n){if(o>=h.length)break;u=h[o++]}else{if(o=h.next(),o.done)break;u=o.value}var l=u;r[t++]=l}return r},a.shrink=function(){for(var r=this.data.keys(),t=r.next();this.data.size>this.max;){var e=this.getAndRemove(t.value);e&&this.onRemove(e),t=r.next()}},a.has=function(r){return this.data.has(r)},a.getAndRemove=function(r){if(!this.has(r))return null;var t=this.data.get(r);return this.data.delete(r),t},a.get=function(r){if(!this.has(r))return null;var t=this.data.get(r);return t},a.remove=function(r){if(!this.has(r))return this;var t=this.data.get(r);return this.data.delete(r),this.onRemove(t),this},a.setMaxSize=function(r){return this.max=r,this.data.size>this.max&&this.shrink(),this},s}());var gu=fu?du:rc,Ft={jsonp:function(a,i){var r="_maptalks_jsonp_"+we();a.match(/\?/)?a+="&callback="+r:a+="?callback="+r;var t=document.createElement("script");return t.type="text/javascript",t.src=a,window[r]=function(e){i(null,e),document.getElementsByTagName("head")[0].removeChild(t),t=null,delete window[r]},document.getElementsByTagName("head")[0].appendChild(t),this},get:function(a,i,r){if(it(i)){var t=r;r=i,i=t}if(bt&&Ft.get.node)return Ft.get.node(a,r,i);var e=Ft._getClient(r);if(e.open("GET",a,!0),i){for(var n in i.headers)e.setRequestHeader(n,i.headers[n]);e.withCredentials=i.credentials==="include",i.responseType&&(e.responseType=i.responseType)}return e.send(null),e},post:function(a,i,r){var t;if(tt(a)){if(it(i)){var n=r;r=i,i=n}i=i||{},t=i.postData}else{var e=r;t=i,i=a,a=i.url,r=e}if(bt&&Ft.post.node)return i.url=a,Ft.post.node(i,t,r);var o=Ft._getClient(r);if(o.open("POST",i.url,!0),i.headers||(i.headers={}),i.headers["Content-Type"]||(i.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in o)for(var h in i.headers)i.headers.hasOwnProperty(h)&&o.setRequestHeader(h,i.headers[h]);return tt(t)||(t=JSON.stringify(t)),o.send(t),o},_wrapCallback:function(a,i){return function(){if(a.readyState===4)if(a.status===200)if(a.responseType==="arraybuffer"){var r=a.response;r.byteLength===0?i(new Error("http status 200 returned without content.")):i(null,{data:a.response,cacheControl:a.getResponseHeader("Cache-Control"),expires:a.getResponseHeader("Expires"),contentType:a.getResponseHeader("Content-Type")})}else i(null,a.responseText);else i(new Error(a.statusText+","+a.status))}},_getClient:function(a){var i;try{i=new XMLHttpRequest}catch{try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch{try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch{}}}return i.onreadystatechange=Ft._wrapCallback(i,a),i},getArrayBuffer:function(a,i,r){if(it(i)){var t=r;r=i,i=t}return i||(i={}),i.responseType="arraybuffer",Ft.get(a,i,r)},getImage:function(a,i,r){return Ft.getArrayBuffer(i,r,function(t,e){if(t)a.onerror&&a.onerror(t);else if(e){var n=window.URL||window.webkitURL,o=a.onload;a.onload=function(){o&&o(),n.revokeObjectURL(a.src)};var h=new Blob([new Uint8Array(e.data)],{type:e.contentType});a.cacheControl=e.cacheControl,a.expires=e.expires,a.src=e.data.byteLength?n.createObjectURL(h):Na}})}};Ft.getJSON=function(s,a,i){if(it(a)){var r=i;i=a,a=r}var t=function(n,o){var h=o?qi(o):null;i(n,h)};return a&&a.jsonp?Ft.jsonp(s,t):Ft.get(s,a,t)};var vu=1/0,mu=1/0,_u=-1/0,pu=-1/0;function qe(){return[vu,mu,_u,pu]}var di=qe();function nr(s){s[0]=vu,s[1]=mu,s[2]=_u,s[3]=pu}function pn(s,a){if(s)if(Array.isArray(s[0]))for(var i=0,r=s.length;i<r;i++)pn(s[i],a);else if(Array.isArray(s))for(var t=0,e=s.length;t<e;t++){var n=s[t],o=n.x,h=n.y;a[0]=Math.min(o,a[0]),a[1]=Math.min(h,a[1]),a[2]=Math.max(o,a[2]),a[3]=Math.max(h,a[3])}else{var o=s.x,h=s.y;a[0]=Math.min(o,a[0]),a[1]=Math.min(h,a[1]),a[2]=Math.max(o,a[2]),a[3]=Math.max(h,a[3])}}function yn(s,a,i,r,t){a!==0&&!a||(Array.isArray(a)&&(i=a[1],r=a[2],t=a[3],a=a[0]),s[0]=Math.min(a,s[0]),s[1]=Math.min(i,s[1]),s[2]=Math.max(r,s[2]),s[3]=Math.max(t,s[3]))}function $r(s){return s&&s[0]!==1/0&&s[0]!==void 0}function yu(s,a){a===void 0&&(a=0),s[0]-=a,s[1]-=a,s[2]+=a,s[3]+=a}var co="#000",nc="rgba(255,255,255,0)",ac="#000",Cr=!1,ri=null,ni=Math.PI/180,go=1,vo="top",I={getCanvas2DContext:function(a){return a.getContext("2d",{willReadFrequently:!0})},setHitTesting:function(a){Cr=a},createCanvas:function(a,i,r){var t;return bt?t=new r(a,i):(t=V("canvas"),t.width=a,t.height=i),t},prepareCanvasFont:function(a,i){a.textBaseline!==vo&&(a.textBaseline=vo);var r=dn(i);a.font!==r&&(a.font=r);var t=i.textFill;t||(t=ac);var e=I.getRgba(t,i.textOpacity);a.fillStyle!==e&&(a.fillStyle=e)},prepareCanvas:function(a,i,r,t){if(i){var e=i.lineWidth;!P(e)&&a.lineWidth!==e&&(a.lineWidth=e);var n=i.linePatternFile,o=i.lineColor||co;if(t)a.strokeStyle="#000";else if(n&&r){var h;(i.linePatternDx||i.linePatternDy)&&(h=[i.linePatternDx,i.linePatternDy]),I._setStrokePattern(a,n,e,h,r),i.lineDasharray=[]}else _e(o)?i.lineGradientExtent?a.strokeStyle=I._createGradient(a,o,i.lineGradientExtent):a.strokeStyle=co:(Array.isArray(o)&&(o=I.normalizeColorToRGBA(o)),a.strokeStyle=o);i.lineJoin&&(a.lineJoin=i.lineJoin),i.lineCap&&(a.lineCap=i.lineCap),a.setLineDash&&st(i.lineDasharray)&&a.setLineDash(i.lineDasharray);var u=i.polygonPatternFile,l=i.polygonFill||nc;if(t)a.fillStyle="#000";else if(u&&r){var f=_o(u),c=r.getImage([f,null,null]);if(c||(c=r.getImage([f+"-texture",null,e])),Be(f)&&c instanceof Image&&(q.edge||q.ie)){var d=c.width||20,g=c.height||20,v=I.createCanvas(d,g);I.image(v.getContext("2d"),c,0,0,d,g),c=v}c?(a.fillStyle=a.createPattern(c,"repeat"),(i.polygonPatternDx||i.polygonPatternDy)&&(a.fillStyle.polygonPatternOffset=[i.polygonPatternDx,i.polygonPatternDy])):typeof console<"u"&&console.warn("img not found for",f)}else _e(l)?i.polygonGradientExtent?a.fillStyle=I._createGradient(a,l,i.polygonGradientExtent):a.fillStyle="rgba(255,255,255,0)":(Array.isArray(l)&&(l=I.normalizeColorToRGBA(l)),a.fillStyle=l)}},_createGradient:function(a,i,r){var t=null,e=i.places,n=r.getMin(),o=r.getMax(),h=r.getWidth(),u=r.getHeight();if(!i.type||i.type==="linear"){if(!e)e=[n.x,n.y,o.x,n.y];else{if(e.length!==4)throw new Error("A linear gradient's places should have 4 numbers.");e=[n.x+e[0]*h,n.y+e[1]*u,n.x+e[2]*h,n.y+e[3]*u]}t=a.createLinearGradient.apply(a,e)}else if(i.type==="radial"){if(e){if(e.length!==6)throw new Error("A radial gradient's places should have 6 numbers.");e=[n.x+e[0]*h,n.y+e[1]*u,h*e[2],n.x+e[3]*h,n.y+e[4]*u,h*e[5]]}else{var l=r.getCenter()._round();e=[l.x,l.y,Math.abs(l.x-n.x),l.x,l.y,0]}t=a.createRadialGradient.apply(a,e)}return i.colorStops.forEach(function(f){t.addColorStop.apply(t,f)}),t},_setStrokePattern:function(a,i,r,t,e){var n=_o(i),o;if(bt)o=e.getImage([n,null,r]);else{var h=n+"-texture-"+r;if(o=e.getImage(h),!o){var u=e.getImage([n,null,null]);if(u){var l;!u.width||!u.height?l=r:l=Math.round(u.width*r/u.height);var f=I.createCanvas(l,r,a.canvas.constructor);I.image(f.getContext("2d"),u,0,0,l,r),e.addResource([h,null,r],f),o=f}}}o?(a.strokeStyle=a.createPattern(o,"repeat"),a.strokeStyle.linePatternOffset=t):typeof console<"u"&&console.warn("img not found for",n)},clearRect:function(a,i,r,t,e){a.canvas._drawn=!1,a.clearRect(i,r,t,e)},fillCanvas:function(a,i,r,t){if(Cr&&(i=1),a.canvas._drawn=!0,i!==0){var e=I._isPattern(a.fillStyle),n=a.fillStyle&&a.fillStyle.polygonPatternOffset,o=n?n[0]:0,h=n?n[1]:0;P(i)&&(i=1);var u;i<1&&(u=a.globalAlpha,a.globalAlpha*=i),e&&(r=r||0,t=t||0,a.translate(r+o,t+h)),a.fill(),e&&a.translate(-r-o,-t-h),i<1&&(a.globalAlpha=u)}},getRgba:function(a,i){if(P(i)&&(i=1),a[0]!=="#")return Array.isArray(a)&&(a=I.normalizeColorToRGBA(a,i)),a;var r,t,e;return a.length===7?(r=parseInt(a.substring(1,3),16),t=parseInt(a.substring(3,5),16),e=parseInt(a.substring(5,7),16)):(r=parseInt(a.substring(1,2),16)*17,t=parseInt(a.substring(2,3),16)*17,e=parseInt(a.substring(3,4),16)*17),"rgba("+r+","+t+","+e+","+i+")"},normalizeColorToRGBA:function(a,i){return i===void 0&&(i=1),"rgba("+a[0]*255+","+a[1]*255+","+a[2]*255+","+(a.length===4?a[3]:1)*i+")"},image:function(a,i,r,t,e,n){a.canvas._drawn=!0;try{H(e)&&H(n)?a.drawImage(i,r,t,e,n):a.drawImage(i,r,t)}catch(o){console&&(console.warn("error when drawing image on canvas:",o),console.warn(i))}},text:function(a,i,r,t,e){return I._textOnMultiRow(a,e.rows,t,r,e.size,e.rawSize)},_textOnMultiRow:function(a,i,r,t,e,n){var o=he(e,r.textHorizontalAlignment,r.textVerticalAlignment),h=n.height+r.textLineSpacing,u=t.add(0,o.y),l=r.textMaxHeight,f,c,d=0;nr(di);for(var g=0,v=i.length;g<v;g++){f=i[g].text,c=he(i[g].size,r.textHorizontalAlignment,r.textVerticalAlignment);var m=u.add(c.x,g*h);I._textOnLine(a,f,m,r.textHaloRadius,r.textHaloFill,r.textHaloOpacity);var _=i[g].size,p=m.x,y=m.y,w=p+_.width,C=y+_.height;if(yn(di,p,y,w,C),l>0&&(d+=h,d+_.height>=l))break}return di},_textOnLine:function(a,i,r,t,e,n){Cr&&(n=1);var o=n!==0&&t!==0;a.textBaseline="top";var h,u,l=a.shadowBlur,f=a.shadowOffsetX,c=a.shadowOffsetY;if(o){var d=a.globalAlpha;a.globalAlpha*=n,a.miterLimit=2,a.lineJoin="round",a.lineCap="round",a.lineWidth=t*2,Array.isArray(e)&&(e=I.normalizeColorToRGBA(e)),a.strokeStyle=e,a.strokeText(i,r.x,r.y+go),a.miterLimit=10,a.globalAlpha=d,h=a.globalCompositeOperation,a.globalCompositeOperation="destination-out",u=a.fillStyle,a.fillStyle="#000"}l&&o&&(a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0),I.fillText(a,i,r),h&&(a.globalCompositeOperation=h,I.fillText(a,i,r,u),l&&(a.shadowBlur=l,a.shadowOffsetX=f,a.shadowOffsetY=c))},fillText:function(a,i,r,t){a.canvas._drawn=!0,t&&(a.fillStyle=t),a.fillText(i,r.x,r.y+go)},_stroke:function(a,i,r,t){if(Cr&&(i=1),a.canvas._drawn=!0,i!==0){var e=a.strokeStyle&&a.strokeStyle.linePatternOffset,n=e?e[0]:0,o=e?e[1]:0,h=I._isPattern(a.strokeStyle)&&(!P(r)&&!P(t)||!P(n)&&!P(o));P(i)&&(i=1);var u;i<1&&(u=a.globalAlpha,a.globalAlpha*=i),h&&(r=r||0,t=t||0,a.translate(r+n,t+o)),a.stroke(),h&&a.translate(-r-n,-t-o),i<1&&(a.globalAlpha=u)}},_path:function(a,i,r,t,e){if(!st(i))return;function n(g,v){var m=Zr(g.x,g.y,v.x,v.y);a.save();var _=Math.cos(m);Math.abs(_)<1e-7?a.translate(g.x-a.lineWidth/2,g.y):a.translate(g.x,g.y-a.lineWidth/2/_),a.rotate(m),I._stroke(a,t),a.restore()}for(var o=st(r),h=e===!0?!1:I._isPattern(a.strokeStyle),u,l,f,c=0,d=i.length;c<d;c++)if(u=i[c],!o||a.setLineDash)a.lineTo(u.x,u.y),h&&c>0&&(l=i[c-1],n(l,u),a.beginPath(),a.moveTo(u.x,u.y));else if(o){if(c===d-1)break;f=i[c+1],sc(a,u,f,r)}},path:function(a,i,r,t,e){st(i)&&(a.beginPath(),a.moveTo(i[0].x,i[0].y),I._path(a,i,e,r),I._stroke(a,r))},_multiClip:function(a,i){if(!(!i||i.length===0)){i=i[0];for(var r=0,t=i.length;r<t;r++){var e=i[r],n=e.x,o=e.y;r===0?a.moveTo(n,o):a.lineTo(n,o),r===t-1&&(n=i[0].x,o=i[0].y,a.lineTo(n,o))}}},polygon:function(a,i,r,t,e,n){if(a.isMultiClip){I._multiClip(a,i);return}if(a.isClip){I._multiClip(a,Array.isArray(i[0])?i:[i]);return}if(st(i)){var o=I._isPattern(a.strokeStyle),h=st(e)&&!a.setLineDash||o&&!n;st(i[0])||(i=[i]);var u=a;i.length>1&&!bt&&(ri||(ri=I.createCanvas(1,1)),a.canvas._drawn=!1,ri.width=a.canvas.width,ri.height=a.canvas.height,a=ri.getContext("2d"),yo(a,[]),yo(a,e),po(a,u));var l,f,c;if(h){for(a.save(),f=0,c=i.length;f<c;f++)st(i[f])&&(I._ring(a,i[f],null,0,!0),l=t,f>0&&(a.globalCompositeOperation="destination-out",l=1),I.fillCanvas(a,l,i[f][0].x,i[f][0].y),f>0?a.globalCompositeOperation="source-over":c>1&&(a.fillStyle="#fff"),I._stroke(a,0));a.restore()}var d=a.fillStyle;for(f=0,c=i.length;f<c;f++)st(i[f])&&(n?(I.paintSmoothLine(a,i[f],r,n,!0),a.closePath()):I._ring(a,i[f],e,r),h||(l=t,f>0&&(a.globalCompositeOperation="destination-out",l=1),I.fillCanvas(a,l,i[f][0].x,i[f][0].y),f>0?a.globalCompositeOperation="source-over":c>1&&(a.fillStyle="#fff")),I._stroke(a,r));a.fillStyle!==d&&(a.fillStyle=d),i.length>1&&!bt&&(u.drawImage(ri,0,0),u.canvas._drawn=a.canvas._drawn,po(u,a))}},_ring:function(a,i,r,t,e){var n=I._isPattern(a.strokeStyle);!e&&n&&!i[0].equals(i[i.length-1])&&(i=i.concat([i[0]])),a.beginPath(),a.moveTo(i[0].x,i[0].y),I._path(a,i,r,t,e),n||a.closePath()},paintSmoothLine:function(a,i,r,t,e,n,o){if(!i)return;if(i.length<=2||!t){I.path(a,i,r);return}function h(S,T,b,D,R,k,O,A,j,G){var N=1-S,B=1-T,Z=b*N*N+R*2*S*N+O*S*S,U=b*B*B+R*2*T*B+O*T*T,J=R*N*N+O*2*S*N+j*S*S,ht=R*B*B+O*2*T*B+j*T*T,Y=D*N*N+k*2*S*N+A*S*S,X=D*B*B+k*2*T*B+A*T*T,et=k*N*N+A*2*S*N+G*S*S,ut=k*B*B+A*2*T*B+G*T*T,Pt=Z*B+J*T,K=U*N+ht*S,dt=U*B+ht*T,vt=Y*B+et*T,nt=X*N+ut*S,ct=X*B+ut*T;return[Pt,vt,K,nt,dt,ct]}function u(S,T,b,D,R,k,O,A,j,G){var N=(S+b)/2,B=(T+D)/2,Z=(b+R)/2,U=(D+k)/2,J=(R+O)/2,ht=(k+A)/2,Y=Math.sqrt((b-S)*(b-S)+(D-T)*(D-T)),X=Math.sqrt((R-b)*(R-b)+(k-D)*(k-D)),et=Math.sqrt((O-R)*(O-R)+(A-k)*(A-k)),ut=Y/(Y+X),Pt=X/(X+et),K=N+(Z-N)*ut,dt=B+(U-B)*ut,vt=Z+(J-Z)*Pt,nt=U+(ht-U)*Pt,ct=K+(Z-K)*j+b-K,Tt=dt+(U-dt)*j+D-dt,Dt=vt+(Z-vt)*j+R-vt,rt=nt+(U-nt)*j+k-nt,St=[ct,Tt,Dt,rt];return G<1?h(0,G,b,D,ct,Tt,Dt,rt,R,k):St}var l=i.length,f=e?l:l-1;a.beginPath(),a.moveTo(i[0].x,i[0].y),o!==void 0&&(f-=Math.max(f-n-1,0));for(var c,d=0;d<f;d++){var g=i[d].x,v=i[d].y,m=void 0,_=void 0,p=void 0,y=void 0,w=void 0,C=void 0;d-1<0?e?(m=i[f-1].x,_=i[f-1].y):(m=i[d+1].x,_=i[d+1].y):(m=i[d-1].x,_=i[d-1].y),d+1<l?(p=i[d+1].x,y=i[d+1].y):(p=i[d+1-l].x,y=i[d+1-l].y),d+2<l?(w=i[d+2].x,C=i[d+2].y):e?(w=i[d+2-l].x,C=i[d+2-l].y):(w=i[d].x,C=i[d].y);var x=u(m,_,g,v,p,y,w,C,t,d===f-1?o:1);if(d===f-1&&o>=0&&o<1){a.bezierCurveTo(x[0],x[1],x[2],x[3],x[4],x[5]),i.splice(f-1,l-(f-1)-1);var M=new E(x[4],x[5]);M.prevCtrlPoint=new E(x[2],x[3]),i.push(M),l=i.length}else a.bezierCurveTo(x[0],x[1],x[2],x[3],p,y);i[d].nextCtrlPoint=x.slice(0,2),i[d].prevCtrlPoint=c?c.slice(2):null,c=x}!e&&i[1].prevCtrlPoint&&(i[0].nextCtrlPoint=i[1].prevCtrlPoint,delete i[0].prevCtrlPoint),i[l-1].prevCtrlPoint||(i[l-1].prevCtrlPoint=i[l-2].nextCtrlPoint),I._stroke(a,r)},_arcBetween:function(a,i,r,t){var e=t,n=i.distanceTo(r),o=n/2/Math.sin(e/2),h=Math.asin((r.y-i.y)/n);i.x>r.x&&(h=Math.PI-h);var u=90*ni-e/2,l=h-u,f=Math.cos(l)*o,c=Math.sin(l)*o,d=i.x+f,g=i.y+c,v=Math.asin((r.y-g)/o);d>r.x&&(v=Math.PI-v);var m=v+e;return a.beginPath(),a.arc(d,g,o,v,m),[d,g]},_lineTo:function(a,i){a.lineTo(i.x,i.y)},bezierCurveAndFill:function(a,i,r,t){a.beginPath();var e=i[0];a.moveTo(e.x,e.y);var n=[a];n.push.apply(n,i.splice(1)),I._bezierCurveTo.apply(I,n),I.fillCanvas(a,t),I._stroke(a,r)},_bezierCurveTo:function(a,i,r,t){a.bezierCurveTo(i.x,i.y,r.x,r.y,t.x,t.y)},ellipse:function(a,i,r,t,e,n,o){function h(u,l,f,c,d){var g=.5522848,v=f*g,m=c*g,_=d*g;a.moveTo(u-f,l),a.bezierCurveTo(u-f,l-m,u-v,l-c,u,l-c),a.bezierCurveTo(u+v,l-c,u+f,l-m,u+f,l),a.bezierCurveTo(u+f,l+_,u+v,l+d,u,l+d),a.bezierCurveTo(u-v,l+d,u-f,l+_,u-f,l),a.closePath()}a.beginPath(),r===t&&r===e?a.arc(i.x,i.y,r,0,2*Math.PI):a.ellipse?t!==e?(a.ellipse(i.x,i.y,r,t,0,ni*180,ni*360,!1),a.ellipse(i.x,i.y,r,e,0,0,ni*180,!1)):a.ellipse(i.x,i.y,r,t,0,0,ni*360,!1):h(i.x,i.y,r,t,e),I.fillCanvas(a,o,i.x-r,i.y-t),I._stroke(a,n,i.x-r,i.y-t)},rectangle:function(a,i,r,t,e){var n=i.x,o=i.y;a.beginPath(),a.rect(n,o,r.width,r.height),I.fillCanvas(a,e,n,o),I._stroke(a,t,n,o)},sector:function(a,i,r,t,e,n){var o=ni,h=t[0],u=t[1];function l(f,c,d,g,v,m){var _=o*-m,p=o*-v;f.beginPath(),f.moveTo(c,d),f.arc(c,d,g,_,p),f.lineTo(c,d),I.fillCanvas(f,n,c-g,d-g),I._stroke(f,e,c-g,d-g)}l(a,i.x,i.y,r,h,u)},_isPattern:function(a){return!tt(a)&&!("addColorStop"in a)},drawCross:function(a,i,r,t,e){a.canvas._drawn=!0,a.strokeStyle=e,a.lineWidth=t,a.beginPath(),a.moveTo(i-5,r),a.lineTo(i+5,r),a.moveTo(i,r-5),a.lineTo(i,r+5),a.stroke()},copy:function(a,i){var r=i||V("canvas");return r.width=a.width,r.height=a.height,r.getContext("2d").drawImage(a,0,0),r},pixelRect:function(a,i,r,t){var e=a.lineWidth,n=a.globalAlpha,o=!1;if(e>0&&r>0)o=!0,r<1&&(a.globalAlpha*=r);else if(t>0)t<1&&(a.globalAlpha*=t);else return;a.canvas._drawn=!0,o?a.strokeRect(i[0],i[1],1,1):a.fillRect(i[0],i[1],1,1),a.globalAlpha!==n&&(a.globalAlpha=n)}};function sc(s,a,i,r){var t=a.x,e=a.y,n=i.x,o=i.y,h=r,u=function(x,M){return x<=M},l=function(x,M){return x>=M},f=function(x,M){return Math.min(x,M)},c=function(x,M){return Math.max(x,M)},d={thereYet:l,cap:f},g={thereYet:l,cap:f};e-o>0&&(g.thereYet=u,g.cap=c),t-n>0&&(d.thereYet=u,d.cap=c),s.moveTo(t,e);for(var v=t,m=e,_=0,p=!0,y,w;!(d.thereYet(v,n)&&g.thereYet(m,o));)y=Math.atan2(o-e,n-t),w=h[_],v=d.cap(n,v+Math.cos(y)*w),m=g.cap(o,m+Math.sin(y)*w),p?s.lineTo(v,m):s.moveTo(v,m),_=(_+1)%h.length,p=!p}var mo="data:image/";function _o(s){return s.substring(0,mo.length)===mo?s:sn(s)}function po(s,a){s.filter=a.filter,s.fillStyle=a.fillStyle,s.globalAlpha=a.globalAlpha,s.lineCap=a.lineCap,s.lineDashOffset=a.lineDashOffset,s.lineJoin=a.lineJoin,s.lineWidth=a.lineWidth,s.shadowBlur=a.shadowBlur,s.shadowColor=a.shadowColor,s.shadowOffsetX=a.shadowOffsetX,s.shadowOffsetY=a.shadowOffsetY,s.strokeStyle=a.strokeStyle}function yo(s,a){!a||!s.setLineDash||!Array.isArray(a)||s.setLineDash(a)}function Wn(s){return"Z__"+s}var le=function(a){return function(i){z(r,i);function r(){return i.apply(this,arguments)||this}var t=r.prototype;return t.on=function(n,o,h){if(!n)return this;if(!tt(n))return this._switch("on",n,o);if(!o)return this;this._eventMap||(this._eventMap={});var u=n.toLowerCase().split(" "),l;h||(h=this);var f=H(o._id);o._id=we();for(var c,d=0,g=u.length;d<g;d++){l=u[d];var v=Wn(l);if(o[v]&&(o[v]._id=o._id),c=this._eventMap[l],c||(c=[],this._eventMap[l]=c),!f){c.push({handler:o,context:h});continue}var m=c.length;if(m>0){for(var _=0;_<m;_++)if(o===c[_].handler&&c[_].context===h)return Qt.isTest||console.warn(this,"find '"+n+"' handler:",o," The old listener function will be removed"),this}c.push({handler:o,context:h})}return this},t.addEventListener=function(){return this.on.apply(this,arguments)},t.once=function(n,o,h){if(!tt(n)){var u={};for(var l in n)n.hasOwnProperty(l)&&(u[l]=this._wrapOnceHandler(l,n[l],h));return this._switch("on",u)}for(var f=n.split(" "),c=0,d=f.length;c<d;c++)this.on(f[c],this._wrapOnceHandler(f[c],o,h));return this},t.off=function(n,o,h){if(!this._eventMap||!n)return this;if(!tt(n))return this._switch("off",n,o);if(!o)return this;if(!H(o._id))return this;var u=n.split(" "),l,f,c;h||(h=this);for(var d=0,g=u.length;d<g;d++)if(l=u[d].toLowerCase(),c=Wn(l),f=this._eventMap[l],!!f){for(var v=f.length-1;v>=0;v--){var m=f[v];(o===m.handler||o===m.handler[c])&&m.context===h&&(delete m.handler[c],f.splice(v,1))}f.length||delete this._eventMap[l]}return this},t.removeEventListener=function(){return this.off.apply(this,arguments)},t.listens=function(n,o,h){if(!this._eventMap||!tt(n))return 0;var u=this._eventMap[n.toLowerCase()];if(!u||!u.length)return 0;if(!o)return u.length;for(var l=0,f=u.length;l<f;l++)if(o===u[l].handler&&(P(h)||u[l].context===h))return 1;return 0},t.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},t.copyEventListeners=function(n){var o=n._eventMap;if(!o)return this;var h;for(var u in o){h=o[u];for(var l=0,f=h.length;l<f;l++)this.on(u,h[l].handler,h[l].context)}return this},t.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},t._wrapOnceHandler=function(n,o,h){var u=Wn(n),l=!1,f=function c(){l||(delete f[u],l=!0,h?o.apply(h,arguments):o.apply(this,arguments),c._called=!0)};return f[u]=o,f},t._switch=function(n,o,h){for(var u in o)o.hasOwnProperty(u)&&this[n](u,o[u],h);return this},t._clearListeners=function(n){if(!(!this._eventMap||!tt(n))){var o=this._eventMap[n.toLowerCase()];o&&(this._eventMap[n]=null)}},t._clearAllListeners=function(){this._eventMap=null},t._setEventParent=function(n){return this._eventParent=n,this},t._setEventTarget=function(n){return this._eventTarget=n,this},t._fire=function(n,o){if(!this._eventMap)return this;n=n.toLowerCase();var h=this._eventMap[n];if(!h)return this;o||(o={}),o.type=n,o.target=this._eventTarget||this;for(var u=h.slice(0),l,f,c,d=0,g=u.length;d<g;d++)if(u[d]){var v=u[d].handler;v._called||(l=u[d].context,f=!0,c=F({},o),l?f=u[d].handler.call(l,c):f=u[d].handler(c),f===!1&&o.domEvent&&jt(o.domEvent))}var m=this._eventMap[n];if(m){for(var _=[],p=0,y=m.length;p<y;p++){var w=m[p].handler;w._called||_.push(m[p])}this._eventMap[n]=_}return this},r}(a)},oc=function(){function s(i){this.target=i}var a=s.prototype;return a.enable=function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},a.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},a.enabled=function(){return!!this._enabled},a.remove=function(){this.disable(),delete this.target,delete this.dom},s}(),ae=le(oc),Bt=function(){function s(i){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(i),this.callInitHooks(),this._isUpdatingOptions=!1}var a=s.prototype;return a.proxyOptions=function(){var r=this;return q.proxy?this.options.isExtensible?this:(this.options=new Proxy(this.options,{set:function(e,n,o){if(e[n]===o||(e[n]=o,r._isUpdatingOptions))return!0;var h={};return h[n]=o,r.config(h),!0}}),this):this},a.callInitHooks=function(){var r=Object.getPrototypeOf(this);return this._visitInitHooks(r),this},a.setOptions=function(r){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!r)return this;for(var t in r)this.options[t]=r[t];return this},a.config=function(r){if(this._isUpdatingOptions=!0,r){if(arguments.length===2){var n={};n[r]=arguments[1],r=n}for(var o in r)this.options[o]=r[o],this[o]&&this[o]instanceof ae&&(r[o]?this[o].enable():this[o].disable());this.onConfig(r),this._isUpdatingOptions=!1}else{var t={};for(var e in this.options)this.options.hasOwnProperty(e)&&(t[e]=this.options[e]);return this._isUpdatingOptions=!1,t}return this},a.onConfig=function(){},a._visitInitHooks=function(r){if(!this._initHooksCalled){var t=Object.getPrototypeOf(r);t._visitInitHooks&&t._visitInitHooks.call(this,t),this._initHooksCalled=!0;var e=r._initHooks;if(e&&e!==t._initHooks)for(var n=0;n<e.length;n++)e[n].call(this)}},s.addInitHook=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];var o=typeof r=="function"?r:function(){this[r].apply(this,e)},h=this.prototype,u=Object.getPrototypeOf(h);return(!h._initHooks||h._initHooks===u._initHooks)&&(h._initHooks=[]),h._initHooks.push(o),this},s.include=function(){for(var r=0;r<arguments.length;r++)F(this.prototype,r<0||arguments.length<=r?void 0:arguments[r]);return this},s.mergeOptions=function(r){var t=this.prototype,e=Object.getPrototypeOf(t);return(!t.options||t.options===e.options)&&(t.options=t.options?Object.create(t.options):{}),F(t.options,r),this},s}(),hc=function(){},uc=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}return a}(le(hc)),Vt=new uc,Ra="dprchange",Aa="docvisibilitychange",Oa="dragstart",Da="dragend";if(typeof window<"u"&&window.matchMedia)for(var Vn=1;Vn<500;Vn++){var lc=(Vn*.01).toFixed(2),Si=window.matchMedia("screen and (resolution: "+lc+"dppx)");Si&&(Si.addEventListener?Si.addEventListener("change",q.checkDevicePixelRatio):Si.addListener&&Si.addListener(q.checkDevicePixelRatio))}if(q.devicePixelRatio){var Un=q.devicePixelRatio;Object.defineProperty(q,"devicePixelRatio",{get:function(){return Un},set:function(a){a!==Un&&(Un=a,q.monitorDPRChange&&Vt.fire(Ra,{devicePixelRatio:a}))}})}q.webgl&&typeof document<"u"&&(Xt(document,"visibilitychange",function(){Vt.fire(Aa,{visibilityState:document.visibilityState})}),Xt(document,"dragstart",function(){Vt.fire(Oa)}),Xt(document,"dragend",function(){Vt.fire(Da)}));var bi={},wu=function(s){return function(a){z(i,a);function i(){return a.apply(this,arguments)||this}i.registerJSONType=function(e){return e?bi[e]?(console.error(e+" has register. please use Different name for:",this),this):(bi[e]=this,this):this},i.getJSONClass=function(e){return e?bi[e]:null};var r=i.prototype;return r.getJSONType=function(){if(this._jsonType===void 0){var e=Object.getPrototypeOf(this).constructor;for(var n in bi)if(bi[n]===e){this._jsonType=n;break}}if(!this._jsonType)throw new Error("Found an unregistered Layer/Geometry class!");return this._jsonType},i}(s)},Ei={},dr=function(){function s(){this._tree=Il(9,["[0]","[1]","[2]","[3]"])}var a=s.prototype;return a.collides=function(r){return Ei.minX=r[0],Ei.minY=r[1],Ei.maxX=r[2],Ei.maxY=r[3],this._tree.collides(Ei)},a.insertBox=function(r){var t=this._tree;return t.insert(r),this},a.bulkInsertBox=function(r){return this._tree.load(r),this},a.clear=function(){return this._tree.clear(),this},s}();function os(s){return function(a){z(i,a);function i(){return a.apply(this,arguments)||this}var r=i.prototype;return r.addHandler=function(e,n){if(!n)return this;if(this._handlers||(this._handlers=[]),this[e])return this[e].enable(),this;var o=this[e]=new n(this);return this._handlers.push(o),this.options[e]&&o.enable(),this},r.removeHandler=function(e){if(!e)return this;var n=this[e];if(n){var o=this._handlers.indexOf(n);o>=0&&this._handlers.splice(o,1),this[e].remove(),delete this[e]}return this},r._clearHandlers=function(){for(var e=0,n=this._handlers.length;e<n;e++)this._handlers[e].remove();this._handlers=[]},i}(s)}var wo="touchstart mousedown",Pr={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},Jn={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},gr=function(s){z(a,s);function a(r,t){var e;return t===void 0&&(t={}),e=s.call(this,null)||this,e.dom=r,e.options=t,e}var i=a.prototype;return i.enable=function(){return this.dom?(this._onMouseDown=function(t){return this.onMouseDown(t)},gt(this.dom,wo,this._onMouseDown,this),this):this},i.disable=function(){return this.dom?(this._offEvents(),_t(this.dom,wo,this._onMouseDown),delete this._onMouseDown,this):this},i.onMouseDown=function(t){if(!(!this.options.rightclick&&t.button===2)&&!(t.touches&&t.touches.length>1)&&!(this.options.cancelOn&&this.options.cancelOn(t)===!0)){var e=this.dom;e.setCapture?e.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),e.ondragstart=function(){return!1},delete this.moved;var n=t.touches?t.touches[0]:t;this.startPos=new E(n.clientX,n.clientY),_t(document,Pr[t.type],this.onMouseMove),_t(document,Jn[t.type],this.onMouseUp),gt(document,Pr[t.type],this.onMouseMove,this),gt(document,Jn[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||(_t(this.dom,"mouseleave",this.onMouseUp),gt(this.dom,"mouseleave",this.onMouseUp,this)),this.fire("mousedown",{domEvent:t,mousePos:new E(n.clientX,n.clientY)})}},i.onMouseMove=function(t){if(t.touches&&t.touches.length>1){this.moved&&(this.interupted=!0,this.onMouseUp(t));return}var e=t.touches?t.touches[0]:t,n=new E(e.clientX,e.clientY),o=n.sub(this.startPos);!o.x&&!o.y||(this.moved?this.fire("dragging",{domEvent:t,mousePos:new E(e.clientX,e.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))},i.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var n={domEvent:t};H(e.clientX)&&(n.mousePos=new E(parseInt(e.clientX,0),parseInt(e.clientY,0))),this.moved&&(n.interupted=this.interupted,this.fire("dragend",n),delete this.interupted,delete this.moved),this.fire("mouseup",n)},i._offEvents=function(){var t=this.dom;if(_t(t,"mouseleave",this.onMouseUp),!(typeof document>"u"||typeof window>"u")){for(var e in Pr)_t(document,Pr[e],this.onMouseMove),_t(document,Jn[e],this.onMouseUp);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},a}(ae),L=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}return a.toNumberArrays=function(r){return Array.isArray(r)?Ue(r,function(t){return[t.x,t.y]}):[r.x,r.y]},a.toCoordinates=function(r){if(H(r[0])&&H(r[1]))return new a(r);if(r instanceof a)return r;for(var t=[],e=0,n=r.length;e<n;e++){var o=r[e];Array.isArray(o)?H(o[0])?t.push(new a(o)):t.push(a.toCoordinates(o)):o instanceof a?t.push(o):t.push(new a(o))}return t},a}(kh),Lt=function(){function s(a,i){this.type=a,this.properties=i}return s.createProj4=function(i){return new s("proj4",{proj:i})},s.fromProjectionCode=function(i){return i?(i=i.toUpperCase().replace(":",""),s[i]||null):null},s}();Lt.WGS84=Lt.createProj4("+proj=longlat +datum=WGS84 +no_defs");Lt.EPSG4326=Lt.WGS84;Lt.EPSG3857=Lt.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs");Lt.IDENTITY=Lt.createProj4("+proj=identity +no_defs");Lt.CGCS2000=Lt.createProj4("+proj=longlat +datum=CGCS2000");Lt.EPSG4490=Lt.CGCS2000;Lt.BD09LL=Lt.createProj4("+proj=longlat +datum=BD09");Lt.GCJ02=Lt.createProj4("+proj=longlat +datum=GCJ02");var fc=new E(0,0),cc=new L(0,0),Xn=new L(0,0),qn=new L(0,0),$n=new L(0,0),Yn=new L(0,0),dc=new L(0,0),xo=new L(0,0),Co=new L(0,0),Qn=[],fi,Ri=[],ft=function(){function s(i,r,t,e){this._clazz=L;var n=arguments.length,o=n>0?arguments[n-1]:null;o&&o.unproject&&(this.projection=arguments[n-1]),this._dirty=!0,this._initialize(i,r,t,e)}var a=s.prototype;return a._initialize=function(r,t,e,n){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!P(r)){var o=this.projection;if(H(r)&&H(t)&&H(e)&&H(n)){o?this.set(r,t,e,n):this.set(Math.min(r,e),Math.min(t,n),Math.max(r,e),Math.max(t,n));return}else Array.isArray(r)?o?this.set(r[0],r[1],r[2],r[3]):this.set(Math.min(r[0],r[2]),Math.min(r[1],r[3]),Math.max(r[0],r[2]),Math.max(r[1],r[3])):H(r.x)&&H(t.x)&&H(r.y)&&H(t.y)?o?this.set(r.x,r.y,t.x,t.y):(r.x>t.x?(this.xmin=t.x,this.xmax=r.x):(this.xmin=r.x,this.xmax=t.x),r.y>t.y?(this.ymin=t.y,this.ymax=r.y):(this.ymin=r.y,this.ymax=t.y)):H(r.xmin)&&H(r.xmax)&&H(r.ymin)&&H(r.ymax)&&this.set(r.xmin,r.ymin,r.xmax,r.ymax)}},a._add=function(r){return this._dirty=!0,P(r.x)?P(r.xmin)?P(r[0])||(this.xmin+=r[0],this.ymin+=r[1],this.xmax+=r[0],this.ymax+=r[1]):(this.xmin+=r.xmin,this.ymin+=r.ymin,this.xmax+=r.xmax,this.ymax+=r.ymax):(this.xmin+=r.x,this.ymin+=r.y,this.xmax+=r.x,this.ymax+=r.y),this},a.add=function(){var r=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return r._add.apply(r,arguments)},a._scale=function(r){return this._dirty=!0,this.xmin*=r,this.ymin*=r,this.xmax*=r,this.ymax*=r,this},a._sub=function(r){return this._dirty=!0,P(r.x)?P(r.xmin)?P(r[0])||(this.xmin-=r[0],this.ymin-=r[1],this.xmax-=r[0],this.ymax-=r[1]):(this.xmin-=r.xmin,this.ymin-=r.ymin,this.xmax-=r.xmax,this.ymax-=r.ymax):(this.xmin-=r.x,this.ymin-=r.y,this.xmax-=r.x,this.ymax-=r.y),this},a._substract=function(){return this._sub.apply(this,arguments)},a.sub=function(){var r=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return r._sub.apply(r,arguments)},a.substract=function(){return this.sub.apply(this,arguments)},a.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},a._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},a.getMin=function(r){return r?(r.set(this.xmin,this.ymin),r):new this._clazz(this.xmin,this.ymin)},a.getMax=function(r){return r?(r.set(this.xmax,this.ymax),r):new this._clazz(this.xmax,this.ymax)},a.getCenter=function(r){var t=(this.xmin+this.xmax)/2,e=(this.ymin+this.ymax)/2;return r?(r.set(t,e),r):new this._clazz(t,e)},a.isValid=function(){return!P(this.xmin)&&!P(this.ymin)&&!P(this.xmax)&&!P(this.ymax)},a.equals=function(r){return this.xmin===r.xmin&&this.xmax===r.xmax&&this.ymin===r.ymin&&this.ymax===r.ymax},a.intersects=function(r){this._project(this),this._project(r);var t=Math.max(this.pxmin,r.pxmin),e=Math.max(this.pymin,r.pymin),n=Math.min(this.pxmax,r.pxmax),o=Math.min(this.pymax,r.pymax),h=!(t>n||e>o);return h},a.within=function(r){return this._project(this),this._project(r),this.pxmin>=r.pxmin&&this.pxmax<=r.pxmax&&this.pymin>=r.pymin&&this.pymax<=r.pymax},a.contains=function(r){if(!r)return!1;this._project(this);var t=this.projection;if(t)if(r.x!==void 0){var e=cc;Array.isArray(r)?(e.x=r[0],e.y=r[1]):(e.x=r.x,e.y=r.y),r=t.project(e,e)}else r.xmin!==void 0&&this._project(r);return(r.x||r.pxmin||0)>=this.pxmin&&(r.x||r.pxmax||0)<=this.pxmax&&(r.y||r.pymin||0)>=this.pymin&&(r.y||r.pymax||0)<=this.pymax},a.getWidth=function(){return Math.abs(this.xmax-this.xmin)},a.getHeight=function(){return Math.abs(this.ymax-this.ymin)},a.getSize=function(){return new xt(this.getWidth(),this.getHeight())},a.set=function(r,t,e,n){return this.xmin=r,this.ymin=t,this.xmax=e,this.ymax=n,this._dirty=!0,this},a.__combine=function(r){r.x!==void 0&&(fi.xmin=fi.xmax=r.x,fi.ymin=fi.ymax=r.y,r=fi),this._project(r),this._project(this);var t=H(this.pxmin),e,n,o,h;t?(e=Math.min(this.pxmin,r.pxmin),n=Math.min(this.pymin,r.pymin),o=Math.max(this.pxmax,r.pxmax),h=Math.max(this.pymax,r.pymax)):(e=r.pxmin,n=r.pymin,o=r.pxmax,h=r.pymax);var u=this.projection;if(u){Xn.set(e,n),qn.set(o,h);var l=u.unproject(Xn,Xn),f=u.unproject(qn,qn);e=l.x,n=l.y,o=f.x,h=f.y}return Ri[0]=e,Ri[1]=n,Ri[2]=o,Ri[3]=h,Ri},a._combine=function(r){if(!r||r.isValid&&!r.isValid())return this;var t=this.__combine(r);return this.set(t[0],t[1],t[2],t[3]),this._dirty=!0,this},a.combine=function(r){if(!r||r.isValid&&!r.isValid())return this;var t=this.__combine(r);return new this.constructor(t[0],t[1],t[2],t[3],this.projection)},a.intersection=function(r){if(!this.intersects(r))return null;$n.x=Math.max(this.pxmin,r.pxmin),$n.y=Math.max(this.pymin,r.pymin),Yn.x=Math.min(this.pxmax,r.pxmax),Yn.y=Math.min(this.pymax,r.pymax);var t=$n,e=Yn,n=this.projection;return n&&(t=n.unproject(t,t),e=n.unproject(e,e)),new this.constructor(t,e,n)},a.expand=function(r){var t,e;return H(r)?t=e=r:(t=r.width||r.x||r[0]||0,e=r.height||r.y||r[1]||0),new this.constructor(this.xmin-t,this.ymin-e,this.xmax+t,this.ymax+e,this.projection)},a._expand=function(r){var t,e;return H(r)?t=e=r:(t=r.width||r.x||r[0]||0,e=r.height||r.y||r[1]||0),this.xmin-=t,this.ymin-=e,this.xmax+=t,this.ymax+=e,this._dirty=!0,this},a.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},a.toArray=function(r){var t=this.xmin,e=this.ymin,n=this.xmax,o=this.ymax;return r?(r[0].x=t,r[0].y=o,r[1].x=n,r[1].y=o,r[2].x=n,r[2].y=e,r[3].x=t,r[3].y=e,r[4].x=t,r[4].y=o,r):[new this._clazz([t,o]),new this._clazz([n,o]),new this._clazz([n,e]),new this._clazz([t,e]),new this._clazz([t,o])]},a.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},a.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},a.convertTo=function(r,t){if(!this.isValid())return null;var e=t||new this.constructor;t&&e.set(null,null,null,null);var n;return this._clazz===L?n=dc:this._clazz===E&&(n=fc),n.x=this.xmin,n.y=this.ymax,e._combine(r(n)),n.x=this.xmax,e._combine(r(n)),n.y=this.ymin,e._combine(r(n)),n.x=this.xmin,e._combine(r(n)),e},a._project=function(r){if(!r||!r.isValid()){r&&(r.pxmin=r.pxmax=r.pymin=r.pymax=null);return}var t=this.projection;if(t){if(r._dirty){xo.set(r.xmax,r.ymin),Co.set(r.xmin,r.ymax),Qn[0]=xo,Qn[1]=Co;var e=t.projectCoords(Qn),n=e[0],o=e[1];r.pxmin=Math.min(n.x,o.x),r.pymin=Math.min(n.y,o.y),r.pxmax=Math.max(n.x,o.x),r.pymax=Math.max(n.y,o.y)}delete r._dirty}else r.pxmin=r.xmin,r.pxmax=r.xmax,r.pymin=r.ymin,r.pymax=r.ymax},s}();fi=new ft(0,0,0,0);var Q=function(s){z(a,s);function a(i,r,t,e){var n;return n=s.call(this,i,r,t,e)||this,n._clazz=E,n}return a}(ft),xu=function(){function s(i){this.matrix=i}var a=s.prototype;return a.transform=function(r,t,e){var n=this.matrix[0]*(r.x-this.matrix[2])/t,o=-this.matrix[1]*(r.y-this.matrix[3])/t;return e?(e.x=n,e.y=o,e):new E(n,o)},a.untransform=function(r,t,e){var n=r.x*t/this.matrix[0]+this.matrix[2],o=r.y*t/-this.matrix[1]+this.matrix[3];return e?(e.x=n,e.y=o,e):new L(n,o)},s}(),ke={is:function(a){if(this.code===a)return!0;if(!this.aliases)return!1;for(var i=0;i<this.aliases.length;i++)if(this.aliases[i]===a)return!0;return!1},project:function(){},unproject:function(){},projectCoords:function(a,i){var r=this;if(!a)return[];if(!Array.isArray(a))return this.project(a);if(a.length===0)return[];if(!this.isSphere())return Ue(a,this.project,this);if(Array.isArray(a[0]))return a.map(function(y){return r.projectCoords(y,i)});for(var t=i!==!1,e=this.getCircum(),n=this.getSphereExtent(),o=n.sx,h=n.sy,u,l,f=a[0],c,d,g,v,m=[this.project(f)],_=1,p=a.length;_<p;_++)c=a[_],d=c.x-f.x,g=c.y-f.y,v=this.project(c),Math.abs(d)>180&&t&&(u===void 0&&(u=c.x>f.x),u&&(v._add(-e.x*Ot(d)*o,0),c._add(-360*Ot(d),0))),Math.abs(g)>90&&t&&(l===void 0&&(l=c.y<f.y),l&&(v._add(0,-e.y*Ot(g)*h),c._add(0,-180*Ot(g)))),f=c,m.push(v);return m},unprojectCoords:function(a){return a?Array.isArray(a)?Ue(a,this.unproject,this):this.unproject(a):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(a){if(!this.isSphere())return!1;var i=this.getSphereExtent();return!i.contains(a)},wrapCoord:function(a){if(!this.isSphere())return a;var i=this.getSphereExtent(),r=new L(a);return i.contains(r)||(r.x=me(a.x,i.xmin,i.xmax),r.y=me(a.y,i.ymin,i.ymax)),r},getCircum:function(){if(!this.circum&&this.isSphere()){var a=this.getSphereExtent();this.circum={x:a.getWidth(),y:a.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var a=this.project(new L(180,90)),i=this.project(new L(-180,-90));this.extent=new ft(i,a,this),this.extent.sx=a.x>i.x?1:-1,this.extent.sy=a.y>i.y?1:-1}return this.extent}},hs={measureLength:function(a,i){if(!Array.isArray(a))return this.measureLenBetween(a,i);for(var r=0,t=0,e=a.length;t<e-1;t++)r+=this.measureLenBetween(a[t],a[t+1]);return r}},us=F({measure:"IDENTITY",measureLenBetween:function(a,i){if(!a||!i)return 0;try{return Math.sqrt(Math.pow(a.x-i.x,2)+Math.pow(a.y-i.y,2))}catch{return 0}},measureArea:function(a){if(!Array.isArray(a))return 0;for(var i=0,r=0,t=a.length;r<t;r++){var e=a[r],n=null;r===t-1?n=a[0]:n=a[r+1],i+=e.x*n.y-e.y*n.x}return Math.abs(i/2)},locate:function(a,i,r,t){return t=t||new L(0,0),t.set(a.x,a.y),this._locate(t,i,r)},_locate:function(a,i,r){return a?(i||(i=0),r||(r=0),!i&&!r||(a.x=a.x+i,a.y=a.y+r),a):null},rotate:function(a,i,r){return a=new L(a.x,a.y),this._rotate(a,i,r)},_rotate:function(){var s=new E(0,0);return function(a,i,r){return s.x=a.x-i.x,s.y=a.y-i.y,s._rotate(r*Math.PI/180),a.x=i.x+s.x,a.y=i.y+s.y,a}}()},hs),Cu=function(){function s(i){this.radius=i}var a=s.prototype;return a.measureLenBetween=function(r,t){if(!r||!t)return 0;var e=pt(r.y),n=pt(t.y),o=e-n,h=pt(r.x)-pt(t.x);return e=2*Math.asin(Math.sqrt(Math.pow(Math.sin(o/2),2)+Math.cos(e)*Math.cos(n)*Math.pow(Math.sin(h/2),2))),e*=this.radius,e},a.measureArea=function(r){var t=pt(this.radius),e=0,n=r,o=n.length;if(o<3)return 0;var h;for(h=0;h<o-1;h++){var u=n[h],l=n[h+1];e+=u.x*t*Math.cos(pt(u.y))*l.y*t-l.x*t*Math.cos(pt(l.y))*u.y*t}return o=n[h],n=n[0],e+=o.x*t*Math.cos(pt(o.y))*n.y*t-n.x*t*Math.cos(pt(n.y))*o.y*t,.5*Math.abs(e)},a.locate=function(r,t,e,n){return n=n||new L(0,0),n.set(r.x,r.y),this._locate(n,t,e)},a._locate=function(r,t,e){if(!r)return null;if(t||(t=0),e||(e=0),!t&&!e)return r;var n,o,h=pt(r.y);if(e!==0){var u=Math.abs(e),l=Math.sin(u/(2*this.radius))*2;h=h+l*(e>0?1:-1),o=me(h*180/Math.PI,-90,90)}else o=r.y;if(t!==0){var f=Math.abs(t),c=pt(r.x),d=2*Math.sqrt(Math.pow(Math.sin(f/(2*this.radius)),2)/Math.pow(Math.cos(h),2));c=c+d*(t>0?1:-1),n=me(c*180/Math.PI,-180,180)}else n=r.x;return r.x=n,r.y=o,r},a.rotate=function(r,t,e){return r=new L(r),this._rotate(r,t,e)},a._rotate=function(r,t,e){var n=gc(t,r),o=n-e,h=this.measureLenBetween(t,r);return r.x=t.x,r.y=t.y,vc(r,h,o,this.radius)},s}();function gc(s,a,i){i===void 0&&(i={});var r;i.final?r=Po(a,s):r=Po(s,a);var t=r>180?-(360-r):r;return t}function Po(s,a){var i=pt(s.y),r=pt(a.y),t=pt(a.x-s.x);t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI);var e=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),n=Math.atan2(t,e);return(Ha(n)+360)%360}function vc(s,a,i,r){var t=a/r,e=s.x*Math.PI/180,n=pt(s.y),o=pt(i),h=t*Math.cos(o),u=n+h;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);var l=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),f=Math.abs(l)>1e-11?h/l:Math.cos(n),c=t*Math.sin(o)/f,d=e+c;return s.x=(d*180/Math.PI+540)%360-180,s.y=u*180/Math.PI,s}var xi=F({measure:"EPSG:4326",sphere:new Cu(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},hs),ls=F({measure:"BAIDU",sphere:new Cu(637099681e-2),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},hs),Pu=xi,Zi={};function fs(s){Zi[s.measure]=s}fs(us);fs(xi);fs(ls);var jr={getInstance:function(a){if(!a)return Pu;for(var i in Zi)if(wi(Zi,i)){var r=Zi[i].measure;if(!r)continue;if(a.toLowerCase()===r.toLowerCase())return Zi[i]}return null}},Fv=Object.freeze({Identity:us,DEFAULT:Pu,Measurer:jr,WGS84Sphere:xi,BaiduSphere:ls}),To=1e-7,Tu=F({},ke,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(a,i){var r=this.rad,t=this.metersPerDegree,e=this.maxLatitude,n=a.x,o=Math.max(Math.min(e,a.y),-e),h;o===0?h=0:h=Math.log(Math.tan((90+o)*r/2))/r;var u=n*t,l=h*t;return i?(i.x=u,i.y=l,i):new L(u,l)},unproject:function(a,i){var r=this.rad,t=this.metersPerDegree,e=a.x/t,n=a.y,o;n===0?o=0:(o=n/t,o=(2*Math.atan(Math.exp(o*r))-Math.PI/2)/r),Math.abs(Math.abs(e)-180)<To&&(e=Ot(e)*180),Math.abs(Math.abs(o)-this.maxLatitude)<To&&(o=Ot(o)*this.maxLatitude);var h=me(e,-180,180),u=me(o,-this.maxLatitude,this.maxLatitude);return i?(i.x=h,i.y=u,i):new L(h,u)}},xi),mc=F({},ke,{code:"EPSG:4326",aliases:["EPSG:4490"],project:function(a,i){return i?(i.x=a.x,i.y=a.y,i):new L(a)},unproject:function(a,i){return i?(i.x=a.x,i.y=a.y,i):new L(a)}},xi),Kn=Math.abs,Ge=Math.sin,Fe=Math.cos,_c=Math.tan,pc=Math.atan,Tr=Math.atan2,yc=Math.sqrt,wc=Math.log,ta=Math.hypot,Mo=Math.sinh,xc=Math.cosh,So=1/0;function Cc(s){var a=[],i=[],r=[],t=[],e,n,o,h,u,l;s.es<=0,o=s.es/(1+yc(1-s.es)),u=h=o/(2-o),a[0]=h*(2+h*(-2/3+h*(-2+h*(116/45+h*(26/45+h*(-2854/675)))))),i[0]=h*(-2+h*(2/3+h*(4/3+h*(-82/45+h*(32/45+h*(4642/4725)))))),u*=h,a[1]=u*(7/3+h*(-8/5+h*(-227/45+h*(2704/315+h*(2323/945))))),i[1]=u*(5/3+h*(-16/15+h*(-13/9+h*(904/315+h*(-1522/945))))),u*=h,a[2]=u*(56/15+h*(-136/35+h*(-1262/105+h*(73814/2835)))),i[2]=u*(-26/15+h*(34/21+h*(8/5+h*(-12686/2835)))),u*=h,a[3]=u*(4279/630+h*(-332/35+h*(-399572/14175))),i[3]=u*(1237/630+h*(-12/5+h*(-24832/14175))),u*=h,a[4]=u*(4174/315+h*(-144838/6237)),i[4]=u*(-734/315+h*(109598/31185)),u*=h,a[5]=u*(601676/22275),i[5]=u*(444337/155925),u=h*h,e=s.k0/(1+h)*(1+u*(1/4+u*(1/64+u/256))),r[0]=h*(-.5+h*(2/3+h*(-37/96+h*(1/360+h*(81/512+h*(-96199/604800)))))),t[0]=h*(.5+h*(-2/3+h*(5/16+h*(41/180+h*(-127/288+h*(7891/37800)))))),r[1]=u*(-1/48+h*(-1/15+h*(437/1440+h*(-46/105+h*(1118711/3870720))))),t[1]=u*(13/48+h*(-3/5+h*(557/1440+h*(281/630+h*(-1983433/1935360))))),u*=h,r[2]=u*(-17/480+h*(37/840+h*(209/4480+h*(-5569/90720)))),t[2]=u*(61/240+h*(-103/140+h*(15061/26880+h*(167603/181440)))),u*=h,r[3]=u*(-4397/161280+h*(11/504+h*(830251/7257600))),t[3]=u*(49561/161280+h*(-179/168+h*(6601661/7257600))),u*=h,r[4]=u*(-4583/161280+h*(108847/3991680)),t[4]=u*(34729/80640+h*(-3418889/1995840)),u*=h,r[5]=u*(-20648693/638668800),t[5]=u*(212378941/319334400),l=v(i,s.phi0),n=-e*(l+m(t,2*l)),s.fwd=f,s.inv=c;function f(p,y){var w,C,x,M,S,T=p.phi,b=p.lam;T=v(i,T),w=Ge(T),C=Fe(T),M=Ge(b),x=Fe(b),T=Tr(w,x*C),b=Tr(M*C,ta(w,C*x)),b=g(_c(b)),S=_(t,2*T,2*b),T+=S[0],b+=S[1],Kn(b)<=2.623395162778?(y.y=e*T+n,y.x=e*b):y.x=y.y=So}function c(p,y){var w,C,x,M,S,T=p.y,b=p.x;T=(T-n)/e,b=b/e,Kn(b)<=2.623395162778?(S=_(r,2*T,2*b),T+=S[0],b+=S[1],b=pc(Mo(b)),w=Ge(T),C=Fe(T),M=Ge(b),x=Fe(b),b=Tr(M,x*C),T=Tr(w*x,ta(M,x*C)),y.phi=v(a,T),y.lam=b):y.phi=y.lam=So}function d(p){var y=1+p,w=y-1;return w===0?p:p*wc(y)/w}function g(p){var y=Kn(p);return y=d(y*(1+y/(ta(1,y)+1))),p<0?-y:y}function v(p,y){for(var w=2*Fe(2*y),C=p.length-1,x=p[C],M=0,S;--C>=0;)S=-M+w*x+p[C],M=x,x=S;return y+S*Ge(2*y)}function m(p,y){for(var w=2*Fe(y),C=p.length-1,x=p[C],M=0,S;--C>=0;)S=-M+w*x+p[C],M=x,x=S;return Ge(y)*S}function _(p,y,w){for(var C=Ge(y),x=Fe(y),M=Mo(w),S=xc(w),T=2*x*S,b=-2*C*M,D=p.length-1,R=p[D],k=0,O=0,A=0,j,G;--D>=0;)j=O,G=k,O=R,k=A,R=-j+T*O-b*k+p[D],A=-G+b*O+T*k;return T=C*S,b=x*M,[T*R-b*A,T*A+b*R]}}var bo=57.29577951308232,ai=.017453292519943295,Pc=6378137,Tc=.0066943799901413165,Eo=["Traverse_Mercator"],Yr=F({},ke,{code:"EPSG:9807",aliases:Eo,create:function(a){var i={a:Pc,es:Tc,x0:P(a.falseEasting)?5e5:a.falseEasting,y0:P(a.falseNorthing)?0:a.falseNorthing,k0:a.scaleFactor||.9996,lam0:(a.centralMeridian||0)*ai,phi0:(a.latitudeOfOrigin||0)*ai,originLam0:a.startLongtitude||0,originPhi0:a.startLatitude||0};Cc(i);var r={lam:0,phi:0},t={},e=0,n=0;return(i.originLam0||i.originPhi0)&&(r.lam=i.originLam0*ai-i.lam0,r.phi=i.originPhi0*ai,i.fwd(r,t),e=i.a*t.x+i.x0,n=i.a*t.y+i.y0),F({},ke,{code:"EPSG:9807",aliases:Eo,centralMeridian:a.centralMeridian,project:function(h,u){r.lam=h.x*ai-i.lam0,r.phi=h.y*ai,i.fwd(r,t);var l=i.a*t.x+i.x0-e,f=i.a*t.y+i.y0-n;return u?(u.x=l,u.y=f,u):new L(l,f)},unproject:function(h,u){t.x=(h.x-i.x0+e)/i.a,t.y=(h.y-i.y0+n)/i.a,i.inv(t,r);var l=(r.lam+i.lam0)*bo,f=r.phi*bo;return u?(u.x=l,u.y=f,u):new L(l,f)}},xi)}}),Mc=F({},Yr,{code:"utm",aliases:[],create:function(a){var i={},r=parseInt(a.zone);if(i.falseNorthing=a.south?1e7:0,i.falseEasting=5e5,r>0&&r<=60)r--;else throw new Error("zone must be > 0 and <= 60.");return i.centralMeridian=(r+.5)*6-180,i.scaleFactor=.9996,Yr.create(i)}}),Sc=F({},ke,{code:"BAIDU",project:function(a,i){return this.convertLL2MC(a,i)},unproject:function(a,i){return this.convertMC2LL(a,i)}},ls,{EARTHRADIUS:637099681e-2,MCBAND:[1289059486e-2,836237787e-2,5591021,348198983e-2,167804312e-2,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1410526172116255e-23,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,173379812e-1],[-7435856389565537e-24,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1026014486e-2],[-3030883460898826e-23,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,685681737e-2],[-1981981304930552e-23,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,448277706e-2],[309191371068437e-23,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,25551644e-1],[2890871144776878e-24,8983055095805407e-21,-3068298e-14,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,6477955746671607e-7,-4082003173641316e-6,1077490566351142e-5,-1517187553151559e-5,1205306533862167e-5,-5124939663577472e-6,9133119359512032e-7,67.5],[.00337398766765,111320.7020202162,4481351045890365e-9,-2339375119931662e-8,7968221547186455e-8,-1159649932797253e-7,9723671115602145e-8,-4366194633752821e-8,8477230501135234e-9,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837749470245e-9,992013.7397791013,-122195221711287e-8,1340652697009075e-9,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758690035394e-9,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(a,i){for(var r,t=0,e=this.MCBAND.length;t<e;t++)if(Math.abs(a.y)>=this.MCBAND[t]){r=this.MC2LL[t];break}var n=this.convertor(a,r,i);return n},convertLL2MC:function(a,i){var r,t,e;a.x=this.getLoop(a.x,-180,180),a.y=this.getRange(a.y,-74,74);var n=new L(a.x,a.y);for(t=0,e=this.LLBAND.length;t<e;t++)if(n.y>=this.LLBAND[t]){r=this.LL2MC[t];break}if(!r){for(t=this.LLBAND.length-1;t>=0;t--)if(n.y<=-this.LLBAND[t]){r=this.LL2MC[t];break}}var o=this.convertor(a,r,i);return o},convertor:function(a,i,r){if(!a||!i)return null;var t=i[0]+i[1]*Math.abs(a.x),e=Math.abs(a.y)/i[9],n=i[2]+i[3]*e+i[4]*e*e+i[5]*e*e*e+i[6]*e*e*e*e+i[7]*e*e*e*e*e+i[8]*e*e*e*e*e*e;return t*=a.x<0?-1:1,n*=a.y<0?-1:1,r?(r.x=t,r.y=n,r):new L(t,n)},toRadians:function(a){return Math.PI*a/180},toDegrees:function(a){return 180*a/Math.PI},getRange:function(a,i,r){return i!=null&&(a=Math.max(a,i)),r!=null&&(a=Math.min(a,r)),a},getLoop:function(a,i,r){if(a===1/0)return r;if(a===-1/0)return i;for(;a>r;)a-=r-i;for(;a<i;)a+=r-i;return a}}),bc=F({},ke,{code:"IDENTITY",project:function(a,i){return i?(i.x=a.x,i.y=a.y,i):a.copy()},unproject:function(a,i){return i?(i.x=a.x,i.y=a.y,i):a.copy()}},us),Mu=Tu,ce=Object.freeze({EPSG3857:Tu,DEFAULT:Mu,EPSG4326:mc,EPSG9807:Yr,UTM:Mc,BAIDU:Sc,IDENTITY:bc,Common:ke}),cs=function(s){return function(a){z(i,a);function i(){return a.apply(this,arguments)||this}return i.registerRenderer=function(t,e){var n=this.prototype,o=Object.getPrototypeOf(n);return(!n._rendererClasses||n._rendererClasses===o._rendererClasses)&&(n._rendererClasses=n._rendererClasses?Object.create(n._rendererClasses):{}),n._rendererClasses[t.toLowerCase()]=e,this},i.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},i}(s)},ea=0,Ro=[],wn=function(){function s(i){var r=this;ss(),this._delayMessages=[],this.initializing=!1;var t=ou(i);Jf()&&!t&&(this.initializing=!0,console.log("Injecting codes in worker with worker key: :"+i),Qf(i,function(){r.initializing=!1,r.created()})),this.workerKey=i,this.workerPool=Ea(),this.currentActor=0,this.actorId=we(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach(function(e){e.addEventListener("message",r.receiveFn,!1)}),hu(i)}var a=s.prototype;return a.created=function(){var r=this;this._delayMessages.forEach(function(t){var e=t.command,n=t.data,o=t.buffers,h=t.cb,u=t.workerId;r[e](n,o,h,u)}),this._delayMessages=[]},a.isActive=function(){return!!this.workers},a.broadcast=function(r,t,e){var n=this;return this.initializing?(this._delayMessages.push({command:"broadcast",data:r,buffers:t,cb:e}),this):(e=e||function(){},Ec(this.workers,function(o,h){n.send(r,t,h,o.id)},e),this)},a.send=function(r,t,e,n){if(this.initializing)return this._delayMessages.push({command:"send",data:r,buffers:t,cb:e,workerId:n}),this;var o=e?this.actorId+":"+this.callbackID++:null;return e&&(this.callbacks[o]=e),this.post({data:r,callback:String(o)},t,n),this},a.receive=function(r){var t=this,e=r.data,n=e.callback,o=this.callbacks[n];delete this.callbacks[n],e.type==="<request>"?this.actorId===e.actorId&&this[e.command](e.params,function(h,u,l){var f={type:"<response>",callback:e.callback};h?f.error=h.message:f.data=u,t.post(f,l||Ro,e.workerId)}):o&&e.error?o(e.error):o&&o(null,e.data)},a.remove=function(){var r=this;this.workers.forEach(function(t){t.removeEventListener("message",r.receiveFn,!1)}),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},a.post=function(r,t,e){return(typeof e!="number"||isNaN(e))&&(e=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),r.workerId=e,r.workerKey=this.workerKey,r.actorId=this.actorId,this.workerPool.addMessage(e,r,t||Ro),e},a.getDedicatedWorker=function(){return ea=(ea+1)%this.workerPool.workerCount,ea},s}();function Ec(s,a,i){s.length||i(null,[]);var r=s.length,t=new Array(s.length),e=null;s.forEach(function(n,o){a(n,function(h,u){h&&(e=h),t[o]=u,--r===0&&i(e,t)})})}var Rc=[],Ac=function(s){z(a,s);function a(){return s.call(this,as)||this}var i=a.prototype;return i.fetchImage=function(t,e){var n={url:t};this.send(n,Rc,e)},a}(wn),Ci=function(s){z(a,s);function a(r){var t;return t=s.call(this)||this,t.layer=r,t._painted=!1,t._drawTime=0,q.decodeImageInWorker&&!q.safari&&!q.iosWeixin&&(t._resWorkerConn=new Ac),t.setToRedraw(),t}var i=a.prototype;return i.render=function(t){this.prepareRender(),!(!this.getMap()||!this.layer.isVisible())&&(this.resources||(this.resources=new Xe),this.checkAndDraw(this._tryToDraw,t),this._frameTime=t)},i.getFrameTimestamp=function(){return this._frameTime||0},i.checkAndDraw=function(t){var e=this;this._toRedraw=!1;for(var n=arguments.length,o=new Array(n>1?n-1:0),h=1;h<n;h++)o[h-1]=arguments[h];if(this.checkResources){var u=this.checkResources();u.length>0?(this._loadingResource=!0,this.loadResources(u).then(function(){if(e._loadingResource=!1,e.layer){e.layer.fire("resourceload");var l=e.layer.getMap();e.setToRedraw(),l.getRenderer().callInNextFrame(function(){e.setToRedraw()})}})):t.call.apply(t,[this].concat(o))}else t.call.apply(t,[this].concat(o))},i.testIfNeedRedraw=function(){var t=this.getMap();return this._loadingResource?!1:this._toRedraw?!0:t.isInteracting()&&!this.drawOnInteracting?!1:!!this.needToRedraw()},i.needToRedraw=function(){var t=this.getMap();return t.isInteracting()||t.getRenderer().isViewChanged()?!(!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving):!1},i.onSkipDrawOnInteracting=function(){},i.isLoadingResource=function(){return this._loadingResource},i.isRenderComplete=function(){return!!this._renderComplete},i.mustRenderOnInteracting=function(){return!this._painted},i.setToRedraw=function(){return this._toRedraw=!0,this},i.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},i.isCanvasUpdated=function(){return!!this._canvasUpdated},i.remove=function(){this.onRemove(),delete this._loadingResource,delete this.middleWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,this._resWorkerConn&&(this._resWorkerConn.remove(),delete this._resWorkerConn),delete this.layer},i.onRemove=function(){},i.onAdd=function(){},i.getMap=function(){return this.layer?this.layer.getMap():null},i.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D||this.isBlank()||this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this.middleWest)._add(0,-t.height/2);return{image:this.canvas,layer:this.layer,point:e}},i.clear=function(){this.clearCanvas()},i.isBlank=function(){return!this._painted},i.show=function(){this.setToRedraw()},i.hide=function(){this.clear(),this.setToRedraw()},i.setZIndex=function(){this.setToRedraw()},i.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown||this.layer.isVisible&&!this.layer.isVisible())return!1;var e=this.getMap(),n=e.getDevicePixelRatio(),o=e.getSize();if(t.x<0||t.x>o.width*n||t.y<0||t.y>o.height*n)return!1;var h=this.getImageData&&this.getImageData();if(h){var u=Math.round(n*t.x),l=Math.round(n*t.y),f=l*h.width*4+u*4;return h.data[f+3]>0}try{var c=this.context.getImageData(n*t.x,n*t.y,1,1).data;if(c[3]>0)return!0}catch(d){return this._errorThrown||(console&&console.warn(`hit detect failed with tainted canvas, some geometries have external resources in another domain:
`,d),this._errorThrown=!0),!1}return!1},i.loadResources=function(t){this.resources||(this.resources=new Xe);var e=this.resources,n=[];if(st(t))for(var o={},h=t.length-1;h>=0;h--){var u=t[h];!u||!u.length||o[u.join("-")]||(o[u.join("-")]=1,e.isResourceLoaded(u,!0)||n.push(new rr(this._promiseResource(u))))}return rr.all(n)},i.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this.canvasExtent2D=this._extent2D=t._get2DExtent(),this.middleWest=t._containerPointToPoint(new E(0,t.height/2))},i.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),n=t.getDevicePixelRatio(),o=Math.round(n*e.width),h=Math.round(n*e.height);if(this.layer._canvas){var u=this.layer._canvas;u.width=o,u.height=h,u.style&&(u.style.width=e.width+"px",u.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=I.createCanvas(o,h,t.CanvasClass);this.onCanvasCreate()}},i.onCanvasCreate=function(){},i.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=I.getCanvas2DContext(this.canvas),!!this.context)){this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var t=this.getMap().getDevicePixelRatio();t!==1&&this.context.scale(t,t)}},i.resetCanvasTransform=function(){if(this.context){var t=this.getMap().getDevicePixelRatio();this.context.setTransform(t,0,0,t,0,0)}},i.resizeCanvas=function(t){var e=this.canvas;if(e){var n=t||this.getMap().getSize(),o=this.getMap().getDevicePixelRatio(),h=Wa(n,o),u=h.width,l=h.height,f=h.cssWidth,c=h.cssHeight;this.layer._canvas&&(e.style.width!==f||e.style.height!==c)&&(e.style.width=f,e.style.height=c),!(e.width===u&&e.height===l)&&(e.height=l,e.width=u,o!==1&&this.context&&this.context.scale(o,o))}},i.clearCanvas=function(){if(!(!this.context||!this.getMap())){var t=this.getMap().getDevicePixelRatio(),e=1/t,n=this.canvas.width*e,o=this.canvas.height*e;I.clearRect(this.context,0,0,Math.max(n,this.canvas.width),Math.max(o,this.canvas.height))}},i.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getMaskPainter().get2DExtent();return e.intersects(this._extent2D)?(this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e):(this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e)},i.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;var n=this.middleWest,o=this.getMap();this.middleWest=o._containerPointToPoint(new E(0,o.height/2)),t.save();var h=o.getDevicePixelRatio();if(h!==1&&(t.save(),t.scale(h,h)),e.getGeometries){t.isMultiClip=!0;var u=e.getGeometries()||[];t.beginPath(),u.forEach(function(f){var c=f._getMaskPainter();c.paint(null,t)}),t.stroke(),t.isMultiClip=!1}else{t.isClip=!0,t.beginPath();var l=e._getMaskPainter();l.paint(null,t),t.isClip=!1}return h!==1&&t.restore(),t.clip(),this.middleWest=n,!0},i.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,middleWest:this.middleWest}},i.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},i.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},i.onZoomStart=function(){},i.onZoomEnd=function(){this.setToRedraw()},i.onZooming=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){this.setToRedraw()},i.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},i.onDragRotateStart=function(){},i.onDragRotating=function(){},i.onDragRotateEnd=function(){this.setToRedraw()},i.onSpatialReferenceChange=function(){},i.getDrawTime=function(){return this._drawTime},i._tryToDraw=function(t){if(this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()){this._renderComplete=!0;return}this._drawAndRecord(t)},i._drawAndRecord=function(t){if(this.getMap()){var e=this._painted;this._painted=!0;var n=at();this.draw(t),n=at()-n,this._drawTime=e?n:n/2,e&&this.layer&&this.layer.options.logDrawTime&&console.log(this.layer.getId(),"frameTimeStamp:",t,"drawTime:",this._drawTime)}},i._promiseResource=function(t){var e=this.layer,n=this,o=this.resources,h=e.options.crossOrigin,u=e.options.renderer||"";return function(l){if(o.isResourceLoaded(t,!0)){l(t);return}var f=!Be(t[0])&&n._resWorkerConn&&(e.options.renderer!=="canvas"||e.options.decodeImageInWorker);if(f){var c=on(t[0]);n._resWorkerConn.fetchImage(c,function(g,v){if(g){g&&typeof console<"u"&&console.warn(g),l(t);return}Za(v,function(m){n._cacheResource(t,m),l(t)})})}else{var d=new Image;P(h)?u!=="canvas"&&(d.crossOrigin=""):d.crossOrigin=h,Be(t[0])&&!bt&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),d.onload=function(){n._cacheResource(t,d),l(t)},d.onabort=function(g){console&&console.warn("image loading aborted: "+t[0]),g&&console&&console.warn(g),l(t)},d.onerror=function(g){g&&typeof console<"u"&&console.warn(g),o.markErrorResource(t),l(t)},Xi(d,t)}}},i._cacheResource=function(t,e){if(!(!this.layer||!this.resources)){var n=t[1],o=t[2];if(this.layer.options.cacheSvgOnCanvas&&Be(t[0])===1&&(q.edge||q.ie)){P(n)&&(n=e.width||this.layer.options.defaultIconSize[0]),P(o)&&(o=e.height||this.layer.options.defaultIconSize[1]);var h=I.createCanvas(n,o);I.image(h.getContext("2d"),e,0,0,n,o),e=h}this.resources.addResource(t,e)}},a}(Bt),Xe=function(){function s(){this.resources={},this._errors={}}var a=s.prototype;return a.addResource=function(r,t){var e=this;if(this.resources[r[0]]={image:t,width:+r[1],height:+r[2],refCnt:0},t&&t.width&&t.height&&!t.close&&q.imageBitMap&&!q.safari&&!q.iosWeixin){if(t.src&&Be(t.src))return;createImageBitmap(t).then(function(n){e.resources[r[0]]&&(e.resources[r[0]].image=n)})}},a.isResourceLoaded=function(r,t){if(!r)return!1;var e=this._getImgUrl(r);if(this._errors[e])return!0;var n=this.resources[e];return!(!n||t&&Be(r[0])&&(+r[1]>n.width||+r[2]>n.height))},a.login=function(r){var t=this.resources[r];t&&t.refCnt++},a.logout=function(r){var t=this.resources[r];t&&t.refCnt--<=0&&(t.image&&t.image.close&&t.image.close(),delete this.resources[r])},a.getImage=function(r){var t=this._getImgUrl(r);return!this.isResourceLoaded(r)||this._errors[t]?null:this.resources[t].image},a.markErrorResource=function(r){this._errors[this._getImgUrl(r)]=1},a.merge=function(r){if(!r)return this;for(var t in r.resources){var e=r.resources[t];this.addResource([t,e.width,e.height],e.image)}return this},a.forEach=function(r){if(!this.resources)return this;for(var t in this.resources)wi(this.resources,t)&&r(t,this.resources[t]);return this},a._getImgUrl=function(r){return Array.isArray(r)?r[0]:r},a.remove=function(){for(var r in this.resources){var t=this.resources[r];t&&t.image&&t.image.close&&t.image.close()}this.resources={}},s}(),Oc=`
function (exports) {
    exports.onmessage = function (msg, postResponse) {
        var url = msg.data.url;
        var fetchOptions = msg.data.fetchOptions;
        requestImageOffscreen(url, function (err, data) {
            var buffers = [];
            if (data && data.data) {
                buffers.push(data.data);
            }
            postResponse(err, data, buffers);
        }, fetchOptions);
    };

    function requestImageOffscreen(url, cb, fetchOptions) {
        fetch(url, fetchOptions ? fetchOptions : {})
            .then(response => response.arrayBuffer())
            .then(arrayBuffer => {
                const blob=new Blob([arrayBuffer]);
                return createImageBitmap(blob);
            })
            .then(bitmap => {
                cb(null, {data:bitmap});
            }).catch(err => {
                console.warn('error when loading tile:', url);
                console.warn(err);
                cb(err);
            });
    }
}`;function Dc(){q.decodeImageInWorker&&uu(as,function(){return Oc})}Dc();var gi={markerWidth:10,markerHeight:10,markerLineWidth:1},ia=new E(0,0);function kc(s){if(!s)return 0;var a=s.x,i=s.y;if(a===0&&i===0)return 0;if(a===0||!a){if(i<0)return-Math.PI/2;if(i>0)return Math.PI/2}var r=i/a;return i<0&&a<0?Math.atan(r)-Math.PI:i>0&&a<0?Math.atan(r)+Math.PI:Math.atan(r)}function Lc(s,a,i){var r=Math.PI/2+i,t=Math.PI/4+i,e=i,n=a,o=Math.sqrt(s*s+a*a),h=s,u=0,l=0,f=Math.cos(r)*n,c=Math.sin(r)*n,d=Math.cos(t)*o,g=Math.sin(t)*o,v=Math.cos(e)*h,m=Math.sin(e)*h,_=Math.min(f,d,v,u),p=Math.min(c,g,m,l),y=Math.max(f,d,v,u),w=Math.max(c,g,m,l);return[_,p,y-_,w-p]}function ar(s,a,i,r,t,e){var n=t.x+e.x,o=t.y+e.y;ia.x=n,ia.y=o;var h=kc(ia),u=Math.sqrt(n*n+o*o),l=Math.cos(a+h)*u,f=Math.sin(a+h)*u,c=0,d=0;c+=l,d+=f;var g=Lc(i,r,a),v=g[0],m=g[1],_=g[2],p=g[3];c+=v,d+=m;var y=c+Math.max(i,_),w=d+Math.max(r,p);return s.set(c,d,y,w),s}function Su(){return .5}var Ic=new E(0,0);function ds(s,a,i,r,t,e,n){var o=Ic.set(a,i);if(r)return ar(s,r,e,n,o,t);var h=s.set(o.x,o.y,o.x+e,o.y+n);return h._add(t),r&&jc(h,r),h}var zc=[];function bu(s,a,i){if(i=i||ka(zc,a),i&&(i[0]===0||i[1]===0))return ms(s),s;var r=Au(a,i[0],i[1]);return ds(s,a.markerDx||0,a.markerDy||0,xn(a),r,i[0],i[1])}function Eu(s){return s==="rectangle"?"right":"middle"}function Ru(s){return s==="bar"||s==="pie"||s==="pin"?"top":s==="rectangle"?"bottom":"middle"}var vi=new xt(0,0);function Au(s,a,i){var r=Su(),t=2*(s.shadowBlur||0),e=t+r;vi.width=a,vi.height=i;var n=s.markerType,o=he(vi,s.markerHorizontalAlignment||Eu(n),s.markerVerticalAlignment||Ru(n));return o.x!==-a/2&&(o.x-=Ot(o.x+a/2)*e),o.y!==-i/2&&(o.y-=Ot(o.y+i/2)*e),o}function ka(s,a){var i=Su(),r=W(a.markerWidth,gi.markerWidth),t=W(a.markerHeight,gi.markerHeight);if(r===0||t===0)return s[0]=0,s[1]=0,s;var e=W(a.markerLineWidth,gi.markerLineWidth),n=2*((a.shadowBlur||0)+Math.max(Math.abs(a.shadowOffsetX||0)+Math.abs(a.shadowOffsetY||0))),o=Math.round(r+e+n+i*2),h=Math.round(t+e+n+i*2);return s[0]=o,s[1]=h,s}var Ao=new Q;function jc(s,a){var i=s.xmin,r=s.ymin,t=s.xmax,e=s.ymax;return Ao.set(i,r,t,e),Ao.convertTo(function(n){return n._rotate(a)},s)}function xn(s,a){a===void 0&&(a="markerRotation");var i=s[a];return H(i)?-i*Math.PI/180:0}function La(s,a,i){var r=a.markerFile,t=i?i.getImage(r):null,e=a.markerWidth||(t?t.width:0),n=a.markerHeight||(t?t.height:0);if(vi.width=e,vi.height=n,a.markerWidth===0||a.markerHeight===0)return ms(s),s;var o=he(vi,a.markerHorizontalAlignment||"middle",a.markerVerticalAlignment||"top");return ds(s,a.markerDx||0,a.markerDy||0,xn(a),o,e,n)}function Ou(s,a,i){var r=i.size;if(r&&(r.width===0||r.height===0))return ms(s),s;var t=he(r,a.textHorizontalAlignment,a.textVerticalAlignment),e=a.textHaloRadius||0,n=ds(s,a.textDx||0,a.textDy||0,xn(a,"textRotation"),t,r.width,r.height);return n.xmin-=e,n.xmax+=e,n.ymin-=e,n.ymax+=e,n}var Mr=new Q;function Ia(s,a,i,r){var t=s||new Q;if(Array.isArray(a)){for(var e=a,n=0;n<e.length;n++)Ia(t,e[n],i,r[n]);return t}return Qr(a)&&t._combine(Ou(Mr,a,r)),gs(a)&&t._combine(La(Mr,a,i)),Kr(a)&&t._combine(bu(Mr,a)),vs(a)&&t._combine(La(Mr,a)),t}function Qr(s){return s?!P(s.textName):!1}function gs(s){return s?!P(s.markerFile):!1}function Kr(s){return s?!!(P(s.markerFile)&&!P(s.markerType)&&s.markerType!=="path"):!1}function vs(s){return s?!!(P(s.markerFile)&&s.markerType==="path"):!1}var ra=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","markerRotation","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation","textWrapWidth"],na=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY","textWrapWidth"];function ms(s){s&&(s.xmin=1/0,s.ymin=1/0,s.xmax=-1/0,s.ymax=-1/0)}function Gr(s,a,i,r){for(var t=[],e=0,n,o=0,h=s.length;o<h-1;o++)n=Gc(s[o],s[o+1],a,o,i,r),n&&(t[e]=t[e]||[],t[e].push({point:n[0],index:o}),(n[1]!==s[o+1]||o===h-2)&&(t[e].push({point:n[1],index:o+1}),e++));return t}var Oo;function Gc(s,a,i,r,t,e){var n=r?Oo:mi(s,i),o=mi(a,i),h,u,l;for(Oo=o;;){if(!(n|o))return[s,a];if(n&o)return!1;if(e)return[s,a];h=n||o,u=za(s,a,h,i,t),l=mi(u,i),h===n?(s=u,n=l):(a=u,o=l)}}function Fr(s,a,i){var r=[1,4,2,8],t,e,n,o,h,u,l,f,c;for(e=0,l=s.length;e<l;e++)s[e]._code=mi(s[e],a);for(o=0;o<4;o++){for(f=r[o],t=[],e=0,l=s.length,n=l-1;e<l;n=e++)h=s[e],u=s[n],h._code&f?u._code&f||(c=za(u,h,f,a,i),c._code=mi(c,a),t.push(c)):(u._code&f&&(c=za(u,h,f,a,i),c._code=mi(c,a),t.push(c)),t.push(h));s=t}return s}function za(s,a,i,r,t){var e=a.x-s.x,n=a.y-s.y,o=r.getMin(),h=r.getMax(),u,l;i&8?(u=s.x+e*(h.y-s.y)/n,l=h.y):i&4?(u=s.x+e*(o.y-s.y)/n,l=o.y):i&2?(u=h.x,l=s.y+n*(h.x-s.x)/e):i&1&&(u=o.x,l=s.y+n*(o.x-s.x)/e);var f=new E(u,l);return t&&f._round(),f}function mi(s,a){var i=0;return s.x<a.getMin().x?i|=1:s.x>a.getMax().x&&(i|=2),s.y<a.getMin().y?i|=4:s.y>a.getMax().y&&(i|=8),i}function Du(s,a,i,r){s=new E(s);var t=Math.abs(i.x-a.x),e=Math.abs(i.y-a.y),n=Math.sqrt(Math.abs(t*t-e*e)),o=t>=e,h,u,l;return o?(h=new E(a.x-n,a.y),u=new E(a.x+n,a.y),l=t*2):(h=new E(a.x,a.y-n),u=new E(a.x,a.y+n),l=e*2),s.distanceTo(h)+s.distanceTo(u)<=l+2*r}var ku=function(){function s(){this.bbox=qe()}var a=s.prototype;return a._setBBOX=function(r,t,e,n,o){return r.isHitTesting||yn(this.bbox,t,e,n,o),this},a._bufferBBOX=function(r,t){return t===void 0&&(t=0),r.isHitTesting||yu(this.bbox,t),this},a.getMap=function(){return this.geometry.getMap()},a.getPainter=function(){return this.painter},a.isDynamicSize=function(){return!1},s.testColor=function(r){return!r||!tt(r)?!1:Vl.indexOf(r)>=0},s}(),_s=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i._prepareContext=function(t){if(lt(this.symbol.opacity)?this._opacityFn||(this._opacityFn=Yi(this.symbol.opacity)):delete this._opacityFn,H(this.symbol.opacity))t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var e=this.getMap();t.globalAlpha=this._opacityFn(e.getZoom())}else t.globalAlpha!==1&&(t.globalAlpha=1)},i.prepareCanvas=function(t,e,n){t.setLineDash&&st(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var o=this.getPainter().isHitTesting();I.prepareCanvas(t,e,n,o)},i.remove=function(){},i.setZIndex=function(){},i.show=function(){},i.hide=function(){},i._defineStyle=function(t){return Qi(t,this.geometry)},a}(ku);function Fc(s,a){var i=s&&s.getImage(a);return i||null}function Lu(s,a,i,r){var t=Iu(i),e=i,n=e.markerType.toLowerCase(),o=zu(n,e.markerWidth,e.markerHeight),h=t.lineOpacity,u=t.polygonOpacity,l=_e(t.polygonFill);if(l){var f;_e(t.polygonFill)&&(f||(f=Hc(a,e.markerWidth,e.markerHeight)),t.polygonGradientExtent=f)}I.prepareCanvas(s,t,r);var c=e.markerWidth,d=e.markerHeight,g=e.markerLineWidth/2;if(n==="ellipse")I.ellipse(s,a,c/2,d/2,d/2,h,u);else if(n==="cross"||n==="x"){for(var v=o.length-1;v>=0;v--)o[v]._add(a);I.path(s,o.slice(0,2),h),I.path(s,o.slice(2,4),h)}else if(n==="diamond"||n==="bar"||n==="square"||n==="rectangle"||n==="triangle"){n==="bar"?a=a.add(0,-g):n==="rectangle"&&(a=a.add(g,g));for(var m=o.length-1;m>=0;m--)o[m]._add(a);I.polygon(s,o,h,u)}else if(n==="pin"){a=a.add(0,-g);for(var _=o.length-1;_>=0;_--)o[_]._add(a);var p=s.lineCap;s.lineCap="round",I.bezierCurveAndFill(s,o,h,u),s.lineCap=p}else if(n==="pie"){a=a.add(0,-g);var y=Math.atan(c/2/d)*180/Math.PI,w=s.lineCap;s.lineCap="round",I.sector(s,a,d,[90-y,90+y],h,u),s.lineCap=w}else throw new Error("unsupported markerType: "+n);return s.canvas}function Hc(s,a,i){var r=new Q;return r._combine(s),r.xmin+=-a/2,r.ymin+=-i/2,r.xmax+=a/2,r.ymax+=i/2,r}function Iu(s){var a={lineColor:s.markerLineColor,linePatternFile:s.markerLinePatternFile,lineWidth:s.markerLineWidth,lineOpacity:s.markerLineOpacity,lineDasharray:s.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:s.markerFill,polygonPatternFile:s.markerFillPatternFile,polygonOpacity:s.markerFillOpacity};return a.lineWidth===0&&(a.lineOpacity=0),a}function zu(s,a,i){var r=i/2,t=a/2,e=0,n=0,o,h,u,l;if(s==="triangle")return o=new E(e,n-r),h=new E(e-t,n+r),u=new E(e+t,n+r),[o,h,u];if(s==="cross")return o=new E(e-t,n),h=new E(e+t,n),u=new E(e,n-r),l=new E(e,n+r),[o,h,u,l];if(s==="diamond")return o=new E(e-t,n),h=new E(e,n-r),u=new E(e+t,n),l=new E(e,n+r),[o,h,u,l];if(s==="square")return o=new E(e-t,n+r),h=new E(e+t,n+r),u=new E(e+t,n-r),l=new E(e-t,n-r),[o,h,u,l];if(s==="rectangle")return o=new E(e,n),h=o.add(a,0),u=o.add(a,i),l=o.add(0,i),[o,h,u,l];if(s==="x")return o=new E(e-t,n+r),h=new E(e+t,n-r),u=new E(e+t,n+r),l=new E(e-t,n-r),[o,h,u,l];if(s==="bar")return o=new E(e-t,n-i),h=new E(e+t,n-i),u=new E(e+t,n),l=new E(e-t,n),[o,h,u,l];if(s==="pin"||s==="pie"){var f=i*Math.atan(t/r);return o=new E(e,n),h=new E(e-f,n-i),u=new E(e+f,n-i),l=new E(e,n),[o,h,u,l]}return[]}var Nc=new E(0,0),Bc=new E(0,0),Zc=new E(0,0),Wc=new E(0,0),$e=function(s){z(a,s);function a(r,t,e){var n;return n=s.call(this)||this,n.symbol=r,n.geometry=t,n.painter=e,n}var i=a.prototype;return i.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLRes(),n=new Q,o=this._getRenderPoints()[0],h=o.length-1;h>=0;h--)o[h]&&n._combine(t._pointAtResToPoint(o[h],e));return n},i.isDynamicSize=function(){var t=this.symbol;return lt(t.markerWidth)||lt(t.markerHeight)||lt(t.textSize)},i._rotateExtent=function(t,e){return t.convertTo(function(n){return n._rotate(e)})},i._getRenderPoints=function(){var t=this.getPainter(),e=t.isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(e)},i._getRenderContainerPoints=function(t){var e=this.getPainter();if(e.isSpriting())return this._getRenderPoints()[0];var n=this.geometry,o=this.getDxDy(),h;if(n._cPoint&&!t){var u=t?Zc:Wc;u.set(n._cPoint.x,n._cPoint.y);var l=e.containerOffset;u._sub(l);var f=o.x,c=o.y;(f||c)&&u._add(f||0,c||0),h=[u]}else{var d=this._getRenderPoints()[0];h=this.painter._pointContainerPoints(d,o.x,o.y,t,!0,this.getPlacement())}if(!h||!Array.isArray(h[0]))return h;for(var g=[],v=0,m=h.length;v<m;v++)for(var _=0,p=h[v].length;_<p;_++)g.push(h[v][_]);return g},i.getPlacement=function(){return this.symbol.markerPlacement},i.getRotation=function(){return xn(this.style)},i.getDxDy=function(){var t=this.style,e=t.markerDx,n=t.markerDy;return new E(e,n)},i._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var n=this._getRenderPoints()[1];if(!n||!n[t])return e;var o=this.getMap(),h=n[t][0],u=n[t][1];if(o.isTransforming()){var l=o.getGLRes();return h=o._pointAtResToContainerPoint(n[t][0],l,0,Nc),u=o._pointAtResToContainerPoint(n[t][1],l,0,Bc),e+Zr(h.x,h.y,u.x,u.y)}else return e+-Zr(h.x,h.y,u.x,u.y)},i._rotate=function(t,e,n){if(n){var o=this.getDxDy(),h=e.sub(o);return t.save(),t.translate(h.x,h.y),t.rotate(n),o}return null},a}(_s),ju=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.getPlacement=function(){return"point"},i.getDxDy=function(){return new E(0,0)},i.symbolize=function(t){var e=this.geometry,n=e.getLayer();if(!(!e.options.debug&&n&&!n.options.debug)){var o=this.getMap();if(!(!o||o.isZooming())){var h=n.options.debugOutline,u=1;t.strokeStyle=h,t.fillStyle=h,t.lineWidth=1,t.font="18px  serif";var l=e.getContainerExtent().toArray();I.polygon(t,[l],u,0);for(var f=this._getRenderContainerPoints(),c=this.geometry.getId(),d=zu("cross",10,10),g=0;g<f.length;g++){var v=f[g];P(c)||I.fillText(t,c,v.add(8,-4),h);for(var m=[],_=0;_<d.length;_++)m.push(d[_].add(v));I.path(t,m.slice(0,2),u),I.path(t,m.slice(2,4),u)}}}},a}($e),aa=new xt(1,1),Vc=new Q,Cn=function(s){z(a,s),a.test=function(t){return gs(t)};function a(r,t,e){var n;return n=s.call(this,r,t,e)||this,n.style=n._defineStyle(n.translate()),n}var i=a.prototype;return i.symbolize=function(t,e){var n=this.style;if(!(!this.painter.isHitTesting()&&(n.markerWidth===0||n.markerHeight===0||n.markerOpacity===0))){var o=this._getRenderContainerPoints();if(st(o)){var h=this._getImage(e);if(!h){typeof console<"u"&&console.warn("no img found for "+(this.style.markerFile||this._url[0]));return}this._prepareContext(t);var u=n.markerWidth,l=n.markerHeight;if(!H(u)||!H(l)){u=h.width,l=h.height,n.markerWidth=u,n.markerHeight=l;var f=n.markerFile;e.isResourceLoaded(f)||e.addResource(f,h);var c=this.getPainter();c.isSpriting()||c.removeCache()}var d;this.symbol.markerType!=="path"&&H(n.markerOpacity)&&n.markerOpacity<1&&(d=t.globalAlpha,t.globalAlpha*=n.markerOpacity),aa.width=u,aa.height=l;for(var g=he(aa,n.markerHorizontalAlignment,n.markerVerticalAlignment),v=0,m=o.length;v<m;v++){var _=o[v],p=this.getRotation()?this._rotate(t,_,this._getRotationAt(v)):null,y=void 0;if(p){var w=_.sub(p);_=p;var C=this._getRotationAt(v);y=ar(Vc,C,u,l,_,g),y._add(w)}var x=_.x+g.x,M=_.y+g.y;I.image(t,h,x,M,u,l),p&&t.restore(),p?this._setBBOX(t,y.xmin,y.ymin,y.xmax,y.ymax):this._setBBOX(t,x,M,x+u,M+l)}d!==void 0&&(t.globalAlpha=d)}}},i._getImage=function(t){return Fc(t,this.style.markerFile)},i.getFixedExtent=function(t){return this._fixedExtent=this._fixedExtent||new Q,La(this._fixedExtent,this.style,t)},i.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:W(t.markerOpacity,1),markerWidth:W(t.markerWidth,null),markerHeight:W(t.markerHeight,null),markerRotation:W(t.markerRotation,0),markerDx:W(t.markerDx,0),markerDy:W(t.markerDy,0),markerHorizontalAlignment:W(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:W(t.markerVerticalAlignment,"top")}},a}($e),Uc=new L(0,0),Jc=new L(0,0),ps=function(s){z(a,s),a.test=function(t,e){if(!t||e&&e.isPoint)return!1;for(var n in t){var o=n.slice(0,4);if(o==="line"||o==="poly")return!0}return!1};function a(r,t,e){var n;return n=s.call(this)||this,n.symbol=r,n.geometry=t,n.painter=e,t.isPoint?mt(n):(n.style=n._defineStyle(n.translate()),n)}var i=a.prototype;return i.symbolize=function(t,e){var n=this.style;if(!(n.polygonOpacity===0&&n.lineOpacity===0&&!this.painter.isHitTesting())){var o=this._getPaintParams();if(o){this._prepareContext(t);var h=_e(n.lineColor),u=this.geometry.getJSONType()==="Polygon"||this.geometry.type==="LineString";h&&(n.lineColor.places||!u)&&(n.lineGradientExtent=this.geometry.getContainerExtent()._expand(n.lineWidth)),_e(n.polygonFill)&&(n.polygonGradientExtent=this.geometry.getContainerExtent());var l=this.geometry.getLayer().options.geometryEventTolerance||0,f=this.geometry._hitTestTolerance()+l,c=o[0],d=this.geometry.getJSONType()==="Polygon"&&c.length>0&&Array.isArray(c[0][0])||this.geometry.type==="LineString"&&c.length>0&&Array.isArray(c[0]);if(d)for(var g=0;g<c.length;g++){this.prepareCanvas(t,n,e),h&&u&&!n.lineColor.places&&this._createGradient(t,c[g],n.lineColor);var v=[t,c[g]];o.length>1&&v.push.apply(v,o.slice(1)),v.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray);var m=this.geometry._paintOn.apply(this.geometry,v);this._setBBOX(t,m),this._bufferBBOX(t,f)}else{this.prepareCanvas(t,n,e),h&&u&&!n.lineColor.places&&this._createGradient(t,c,n.lineColor);var _=[t];_.push.apply(_,o),_.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray);var p=this.geometry._paintOn.apply(this.geometry,_);this._setBBOX(t,p),this._bufferBBOX(t,f)}t.setLineDash&&Array.isArray(n.lineDasharray)&&t.setLineDash([])}}},i.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;(!this._extMin||!this._extMax)&&(this._extMin=new L(0,0),this._extMax=new L(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var n=t._prjToPoint(this._extMin,void 0,Uc),o=t._prjToPoint(this._extMax,void 0,Jc);return this._pxExtent?this._pxExtent.set(Math.min(n.x,o.x),Math.min(n.y,o.y),Math.max(n.x,o.x),Math.max(n.y,o.y)):this._pxExtent=new Q(n,o),this._pxExtent},i.getFixedExtent=function(){var t=this.style.lineWidth/2;return new Q(-t,-t,t,t)},i._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},i.translate=function(){var t=this.symbol,e={lineColor:W(t.lineColor,"#000"),lineWidth:W(t.lineWidth,2),lineOpacity:W(t.lineOpacity,1),lineDasharray:W(t.lineDasharray,[]),lineCap:W(t.lineCap,"butt"),lineJoin:W(t.lineJoin,"miter"),linePatternFile:W(t.linePatternFile,null),lineDx:W(t.lineDx,0),lineDy:W(t.lineDy,0),polygonFill:W(t.polygonFill,null),polygonOpacity:W(t.polygonOpacity,1),polygonPatternFile:W(t.polygonPatternFile,null),polygonPatternDx:W(t.polygonPatternDx,0),polygonPatternDy:W(t.polygonPatternDy,0),linePatternDx:W(t.linePatternDx,0),linePatternDy:W(t.linePatternDy,0)};return e.lineWidth===0&&(e.lineOpacity=0),this.geometry.type==="LineString"&&!e.polygonFill&&(e.polygonFill=e.lineColor),e},i._createGradient=function(t,e,n){if(!(!Array.isArray(e)||!e.length)){var o=Xc(e),h=o[0],u=o[1];if(!h||!u){console.error("unable create canvas LinearGradient,error data:",e);return}var l=t.createLinearGradient(h.x,h.y,u.x,u.y);n.colorStops.forEach(function(f){l.addColorStop.apply(l,f)}),t.strokeStyle=l}},a}(_s);function Xc(s){var a,i=!0;Array.isArray(s[0])?(a=s[0],i=!1):a=s;var r=a.length;if(i)return[a[0],a[r-1]];for(var t=a[0],e=0,n,o=1;o<r;o++){var h=a[o],u=t.distanceTo(h);u>e&&(e=u,n=h)}return[t,n]}var qc=new Q,Gu=function(s){z(a,s),a.test=function(t){return Qr(t)};function a(r,t,e){var n;n=s.call(this,r,t,e)||this;var o=n.translate();return n._dynamic=Va(o),n.style=n._defineStyle(o),n.style.textWrapWidth===0?mt(n):(n.strokeAndFill=n._defineStyle(n.translateLineAndFill(n.style)),n)}var i=a.prototype;return i.symbolize=function(t,e){if(!(!this.painter.isHitTesting()&&(this.style.textSize===0||!this.style.textOpacity&&(!this.style.textHaloRadius||!this.style.textHaloOpacity)||this.style.textWrapWidth===0))){var n=this._getRenderContainerPoints();if(st(n)){var o=this.style,h=this.strokeAndFill,u=tr(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var l=this._textDesc=this._textDesc||er(u,this.style);this._prepareContext(t),this.prepareCanvas(t,h,e),I.prepareCanvasFont(t,o);for(var f=o.textHaloRadius||0,c=0,d=n.length;c<d;c++){var g=n[c],v=this.getRotation()?this._rotate(t,g,this._getRotationAt(c)):null,m=void 0;if(v){var _=g.sub(v);g=v;var p=this._getRotationAt(c),y=l.size||{width:0,height:0},w=y.width,C=y.height,x=he(l.size,o.textHorizontalAlignment,o.textVerticalAlignment);m=ar(qc,p,w,C,g,x),m._add(_)}var M=I.text(t,u,g,o,l);v?(this._setBBOX(t,m.xmin,m.ymin,m.xmax,m.ymax),t.restore()):this._setBBOX(t,M),this._bufferBBOX(t,f)}}}},i.getPlacement=function(){return this.symbol.textPlacement},i.getRotation=function(){var t=this.style.textRotation;return H(t)?-t*Math.PI/180:null},i.getDxDy=function(){var t=this.style;return new E(t.textDx,t.textDy)},i.getFixedExtent=function(){var t=this.geometry.getTextDesc();return Array.isArray(t)&&(t=t[this._index]),this._fixedExtent=this._fixedExtent||new Q,t?Ou(this._fixedExtent,this.style,t):this._fixedExtent},i.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:W(t.textFaceName,"monospace"),textWeight:W(t.textWeight,"normal"),textStyle:W(t.textStyle,"normal"),textSize:W(t.textSize,Oh),textFont:W(t.textFont,null),textFill:W(t.textFill,"#000"),textOpacity:W(t.textOpacity,1),textHaloFill:W(t.textHaloFill,"#ffffff"),textHaloRadius:W(t.textHaloRadius,0),textHaloOpacity:W(t.textHaloOpacity,1),textWrapWidth:W(t.textWrapWidth,null),textWrapCharacter:W(t.textWrapCharacter,`
`),textLineSpacing:W(t.textLineSpacing,0),textDx:W(t.textDx,0),textDy:W(t.textDy,0),textHorizontalAlignment:W(t.textHorizontalAlignment,"middle"),textVerticalAlignment:W(t.textVerticalAlignment,"middle"),textAlign:W(t.textAlign,"center"),textRotation:W(t.textRotation,0),textMaxWidth:W(t.textMaxWidth,0),textMaxHeight:W(t.textMaxHeight,0)};return e.textMaxWidth>0&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},i.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},a}($e),Do=[],ko=new Q,$c=new E(0,0),ys=function(s){z(a,s),a.test=function(t){return Kr(t)};function a(r,t,e){var n;n=s.call(this,r,t,e)||this;var o=n.translate();return n._dynamic=Va(o),n.style=n._defineStyle(o),n.strokeAndFill=n._defineStyle(Iu(n.style)),n.padding=0,n}var i=a.prototype;return i.symbolize=function(t,e){var n=this.style;if(!(!this.painter.isHitTesting()&&(n.markerWidth===0||n.markerHeight===0||n.polygonOpacity===0&&n.lineOpacity===0))){var o=this._getRenderContainerPoints();st(o)&&(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||this.geometry.getLayer().options.cacheVectorOnCanvas===!1?this._drawMarkers(t,o,e):this._drawMarkersWithCache(t,o,e))}},i._drawMarkers=function(t,e,n){for(var o=e.length-1;o>=0;o--){var h=e[o],u=ka(Do,this.style),l=u[0],f=u[1],c=void 0,d=this.getRotation()?this._rotate(t,h,this._getRotationAt(o)):null;if(d){var g=h.sub(d);h=d;var v=this._getRotationAt(o);c=ar(ko,v,l,f,h,$c),c._add(g)}if(this._drawVectorMarker(t,h,n),d)t.restore(),this._setBBOX(t,c.xmin,c.ymin,c.xmax,c.ymax);else{var m=h,_=m.x,p=m.y;this._setBBOX(t,_,p,_+l,p+f)}}},i._drawMarkersWithCache=function(t,e,n){var o=this._stampSymbol(),h=n.getImage(o);h||(h=this._createMarkerImage(t,n),n.addResource([o,h.width,h.height],h));for(var u=Au(this.style,h.width,h.height),l=e.length-1;l>=0;l--){var f=e[l],c=this.getRotation()?this._rotate(t,f,this._getRotationAt(l)):null,d=void 0;if(c){var g=f.sub(c);f=c;var v=this._getRotationAt(l);d=ar(ko,v,h.width,h.height,f,u),d._add(g)}var m=f.x+u.x,_=f.y+u.y;I.image(t,h,m,_),c?(t.restore(),this._setBBOX(t,d.xmin,d.ymin,d.xmax,d.ymax)):this._setBBOX(t,m,_,m+h.width,_+h.height)}},i._createMarkerImage=function(t,e){var n=t.canvas.constructor,o=ka(Do,this.style),h=I.createCanvas(o[0],o[1],n),u=this._getCacheImageAnchor(o[0],o[1]),l=h.getContext("2d");return this._drawVectorMarker(l,u,e),h},i._stampSymbol=function(){return this._stamp||(this._stamp=vn([this.style.markerType,_e(this.style.markerFill)?Ta(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,_e(this.style.markerLineColor)?Ta(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},i._getCacheImageAnchor=function(t,e){var n=2*(this.symbol.shadowBlur||0),o=n+this.padding,h=this.style.markerType;return h==="bar"||h==="pie"||h==="pin"?new E(t/2,e-o):h==="rectangle"?new E(o,o):new E(t/2,e/2)},i._getGraidentExtent=function(t){var e=new Q,n=this.getDxDy(),o=this.getFixedExtent();if(Array.isArray(t))for(var h=t.length-1;h>=0;h--)e._combine(t[h]);else e._combine(t);return e.xmin+=o.xmin-n.x,e.ymin+=o.ymin-n.y,e.xmax+=o.xmax-n.x,e.ymax+=o.ymax-n.y,e},i._drawVectorMarker=function(t,e,n){Lu(t,e,this.style,n)},i.getFixedExtent=function(){var t=this.isDynamicSize(),e=this.style.markerWidth,n=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new Q,bu(this._fixedExtent,this.style,t?[128,128*(e===0?1:n/e)]:null)},i.translate=function(){var t=this.symbol,e={markerType:W(t.markerType,"ellipse"),markerFill:W(t.markerFill,"#00f"),markerFillOpacity:W(t.markerFillOpacity,1),markerFillPatternFile:W(t.markerFillPatternFile,null),markerLineColor:W(t.markerLineColor,"#000"),markerLineWidth:W(t.markerLineWidth,gi.markerLineWidth),markerLineOpacity:W(t.markerLineOpacity,1),markerLineDasharray:W(t.markerLineDasharray,[]),markerLinePatternFile:W(t.markerLinePatternFile,null),markerDx:W(t.markerDx,0),markerDy:W(t.markerDy,0),markerWidth:W(t.markerWidth,gi.markerWidth),markerHeight:W(t.markerHeight,gi.markerHeight),markerRotation:W(t.markerRotation,0),shadowBlur:W(t.shadowBlur,0),shadowOffsetX:W(t.shadowOffsetX,0),shadowOffsetY:W(t.shadowOffsetY,0)},n=e.markerType,o=Eu(n),h=Ru(n);return e.markerHorizontalAlignment=W(t.markerHorizontalAlignment,o),e.markerVerticalAlignment=W(t.markerVerticalAlignment,h),H(t.markerOpacity)&&(H(t.markerFillOpacity)&&(e.markerFillOpacity*=t.markerOpacity),H(t.markerLineOpacity)&&(e.markerLineOpacity*=t.markerOpacity)),e},a}($e),ws=function(s){z(a,s),a.test=function(t){return vs(t)};function a(r,t,e){var n;P(r.markerWidth)&&(r.markerWidth=80),P(r.markerHeight)&&(r.markerHeight=80),n=s.call(this,r,t,e)||this,r=F(r,n.translate());var o=n.style=n._defineStyle(r);return q.gecko?n._url=[Ki(o,o.markerWidth,o.markerHeight),o.markerWidth,o.markerHeight]:n._url=[Ki(o),o.markerWidth,o.markerHeight],n}var i=a.prototype;return i._prepareContext=function(){},i._getImage=function(t){var e=this;if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var n=this.painter,o=new Image;return o.onload=function(){var h=n.getLayer()&&n.getLayer().getRenderer();h&&h.setToRedraw()},o.onerror=function(h){h&&typeof console<"u"&&console.warn(h),t.markErrorResource(e._url)},o.src=this._url[0],t&&t.addResource(this._url,o),o},a}(Cn),Yc={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},Fu=function(s){z(a,s),a.test=function(t,e){var n=e.getLayer();if(!n)return!1;var o=e.getJSONType();return o==="Marker"||o==="LineString"};function a(r,t,e){var n;return n=s.call(this,r,t,e)||this,n.style=t.getLayer().options.drawAltitude,(!n.style||!ee(n.style))&&(n.style={lineWidth:2}),n.style.lineWidth||(n.style.lineWidth=0),n.dxdy=n._defineStyle({dx:r.textDx||r.markerDx,dy:r.textDy||r.markerDy}),n}var i=a.prototype;return i.symbolize=function(t){var e=this.geometry.getLayer();if(e.options.drawAltitude&&this.geometry.hasAltitude()){var n=this._getStyle();if(this._prepareContext(t),this.geometry.type==="LineString"){var o=this._getPaintParams(n.lineDx,n.lineDy,!1,!0);if(!o)return;var h=this.getPainter().getPaintParams(n.lineDx,n.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(t,o[0],h)}else{var u=this._getRenderContainerPoints(),l=this._getRenderContainerPoints(!0);if(!u||u.length===0)return;this._drawMarkerAltitude(t,u[0],l[0])}}},i.getDxDy=function(){var t=this.dxdy;return new E(t.dx||0,t.dy||0)},i.get2DExtent=function(){return this.geometry.type==="LineString"?ps.prototype.get2DExtent.apply(this):s.prototype.get2DExtent.call(this)},i.getPlacement=function(){return"point"},i._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0,null,!0,"_altpt")},i._drawMarkerAltitude=function(t,e,n){var o=this._getStyle();this.prepareCanvas(t,o),I.path(t,[e,n],o.lineOpacity,null,o.lineDasharray)},i._drawLineAltitude=function(t,e,n){var o=this._getStyle(),h=e.length>0&&Array.isArray(e[0]);if(h)for(var u=0;u<e.length;u++)this._drawLine(t,e[u],n[u]);else this._drawLine(t,e,n);t.setLineDash&&Array.isArray(o.lineDasharray)&&t.setLineDash([])},i._drawLine=function(t,e,n){var o=this._getStyle();this.prepareCanvas(t,o);for(var h=0,u=e.length-1;h<u;h++)I.polygon(t,[e[h],e[h+1],n[h+1],n[h]],o.lineOpacity,o.polygonOpacity,o.lineDasharray)},i._getStyle=function(){var t=this.geometry.getLayer().options.drawAltitude;return ee(t)||(t=Yc),t.lineWidth||(t.lineWidth=0,t.lineOpacity=0),t},a}($e),Hv=Object.freeze({Symbolizer:ku,CanvasSymbolizer:_s,DebugSymbolizer:ju,ImageMarkerSymbolizer:Cn,PointSymbolizer:$e,StrokeAndFillSymbolizer:ps,TextMarkerSymbolizer:Gu,VectorMarkerSymbolizer:ys,VectorPathMarkerSymbolizer:ws,DrawAltitudeSymbolizer:Fu}),Qc=[Fu,ps,Cn,ws,ys,Gu],He,Lo=new E(0,0),Kc=new Q,Sr=new Q,Zt=new Q,td=new Q,Me=new Q,ed={},Ai={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},xs=function(s){z(a,s);function a(r){var t;return t=s.call(this)||this,t.geometry=r,t.symbolizers=t._createSymbolizers(),t._altAtGL=t._getGeometryAltitude(),t.bbox=qe(),t._drawTime=0,t}var i=a.prototype;return i._setDrawTime=function(t){return this._drawTime=t,this},i.getRenderBBOX=function(){var t=this.getLayer();if(t&&t._drawTime!==this._drawTime)return null;nr(this.bbox);for(var e=this.symbolizers.length-1;e>=0;e--){var n=this.symbolizers[e],o=n.bbox;$r(o)&&yn(this.bbox,o)}return $r(this.bbox)?this.bbox:null},i.getMap=function(){return this.geometry.getMap()},i.getLayer=function(){return this.geometry&&this.geometry.getLayer()},i._createSymbolizers=function(){var t=this.getSymbol(),e=[],n=Qc,o=t;Array.isArray(t)||(o=[t]);for(var h=o.length-1;h>=0;h--)for(var u=o[h],l=n.length-1;l>=0;l--)if(n[l].test(u,this.geometry)){var f=new n[l](u,this.geometry,this);f._index=h,e.push(f),f instanceof $e&&(this._hasPoint=!0)}if(!e.length&&console){var c=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(c?":"+c:""):"")+") to draw : "+JSON.stringify(t))}return this._debugSymbolizer=new ju(t,this.geometry,this),e},i.hasPoint=function(){return!!this._hasPoint},i.getRenderPoints=function(t){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},i.getPaintParams=function(t,e,n,o,h){h===void 0&&(h="_pt");var u=this.getLayer()._getRenderer(),l=u.mapStateCache,f,c,d,g,v,m=this.getMap();l&&!this._hitPoint?(f=l.resolution,c=l.pitch,d=l.bearing,g=l.glScale,v=l.containerExtent):(f=m.getResolution(),c=m.getPitch(),d=m.getBearing(),g=m.getGLScale(),v=m.getContainerExtent());var _=this.geometry,p=f,y=c!==0,w=d!==0,C=this._cachedParams,x=_._paintAsPath&&_._paintAsPath();if(x&&this._unsimpledParams&&p<=this._unsimpledParams._res)C=this._unsimpledParams;else if(!C||C._res!==f||this._pitched!==y&&_._redrawWhenPitch()||this._rotated!==w&&_._redrawWhenRotate()){if(C=_._getPaintParams(),!C)return null;C._res=p,!_._simplified&&x&&(this._unsimpledParams||(this._unsimpledParams=C),p>this._unsimpledParams._res&&(this._unsimpledParams._res=p)),this._cachedParams=C}if(!C)return null;this._pitched=y,this._rotated=w;var M=g,S=[],T=C[0],b=v,D=this._pointContainerPoints(T,t,e,n,o||this._hitPoint&&!b.contains(this._hitPoint),null,h);if(!D)return null;S.push(D);for(var R=1,k=C.length;R<k;R++)H(C[R])||C[R]instanceof xt?H(C[R])?S.push(C[R]/M):S.push(C[R].multi(1/M)):S.push(C[R]);return S},i._pointContainerPoints=function(t,e,n,o,h,u,l){if(l===void 0&&(l="_pt"),this._aboveCamera())return null;var f=this.getLayer()._getRenderer(),c=f.mapStateCache,d=this.getMap(),g=this.geometry,v=this.containerOffset,m,_;c?(m=c.glRes,_=c.containerExtent):(m=d.getGLRes(),_=d.getContainerExtent());var p,y=this.getLayer().options.roundPoint,w=1/0,C=1/0,x=-1/0,M=-1/0,S=!h,T=f.layer.options.clipBBoxBufferSize||3,b=this.symbolizers;function D(ut,Pt){ut===void 0&&(ut=[]),Pt===void 0&&(Pt=[]);var K=$i(ut,l);K=d._pointsAtResToContainerPoints(ut,m,Pt,K);for(var dt=0,vt=K.length;dt<vt;dt++){var nt=K[dt];nt._sub(v),(e||n)&&nt._add(e||0,n||0),y&&(nt.x=Math.ceil(nt.x),nt.y=Math.ceil(nt.y)),w=Math.min(nt.x,w),C=Math.min(nt.y,C),x=Math.max(nt.x,x),M=Math.max(nt.y,M)}if(S&&Yh(b)){if(Me.ymin=_.ymin,Me.ymin<T&&(Me.ymin=_.ymin-T),Me.xmin=_.xmin-T,Me.xmax=_.xmax+T,Me.ymax=_.ymax+T,g.getShell&&g.getHoles)return Fr(K,Me);var ct=Gr(K,Me,!1);if(ct.length){var Tt=[];return ct.forEach(function(Dt){for(var rt=0,St=Dt.length;rt<St;rt++)Tt.push(Dt[rt].point)}),Tt}}return K}var R=this.getAltitude();if(Array.isArray(t)){var k=this.geometry,O;!h&&k.options.enableClip?(O=this._clip(t,R),O.inView&&(S=!1)):O={points:t,altitude:R};var A=O.points;R=O.altitude,o&&(R=0);var j=R;p=[];for(var G=[],N=H(R),B=0,Z=A.length;B<Z;B++){var U=A[B];if(Array.isArray(U)){if(N){var J=D(U,R);p.push(J);continue}for(var ht=[],Y=0,X=U.length;Y<X;Y++)Array.isArray(R)&&(R[B]?j=R[B][Y]:j=0),ht.push(j);var et=D(U,ht);p.push(et)}else Array.isArray(R)&&(u==="vertex-last"?j=R[R.length-1-B]:u==="line"?j=(R[B]+R[B+1])/2:j=R[B]),G.push(j)}G.length&&(p=D(A,G))}else t instanceof E&&(o&&(R=0),p=d._pointAtResToContainerPoint(t,m,R)._sub(v),(e||n)&&p._add(e,n));return Ai.minx=w,Ai.miny=C,Ai.maxx=x,Ai.maxy=M,this._containerBbox=Ai,p},i._clip=function(t,e){if(H(e)&&e!==0)return{points:t,altitude:e};if(Array.isArray(e)){for(var n=!1,o=0,h=e.length;o<h;o++)if(e[o]!==0){n=!0;break}if(n)return{points:t,altitude:e}}var u=this.getMap(),l=this.geometry,f=this.getSymbol().lineWidth;H(f)||(f=4);var c=this.getLayer()._getRenderer(),d=c.mapStateCache,g,v,m;d?(g=d._2DExtent,v=d.glExtent,m=d.pitch):(g=u._get2DExtent(),v=u._get2DExtentAtRes(u.getGLRes()),m=u.getPitch());var _=g._expand(f);if(m>0&&e){var p=u.cameraLookAt,y=u.cameraPosition;Lo.set(y.x,y.y),_=_._combine(Lo._add(Ot(p[0]-y[0]),Ot(p[1]-y[1])))}var w=this.get2DExtent(null,td),C=t;if(w.within(_))return{points:C,altitude:e,inView:!0};var x=v._expand(f*u._glScale);Zt.xmin=x.xmin,Zt.xmax=x.xmax,Zt.ymin=x.ymin,Zt.ymax=x.ymax;var M=l.options.smoothness;if(l.getShell&&this.geometry.getHoles&&!M){var S=x.xmin,T=x.ymin,b=x.xmax,D=x.ymax,R=Math.abs(b-S),k=Math.abs(D-T),O=Math.sqrt(R*R+k*k),A=(O-R)/2,j=(O-k)/2;if(Zt.xmin=x.xmin-A,Zt.xmax=x.xmax+A,Zt.ymin=x.ymin-j,Zt.ymax=x.ymax+j,!Array.isArray(t[0]))C=Fr(t,Zt);else{C=[];for(var G=0;G<t.length;G++){var N=Fr(t[G],Zt);N.length&&C.push(N)}}}else if(l.getJSONType()==="LineString"&&!M){if(!Array.isArray(t[0]))C=Gr(t,Zt,!1,!!M);else{C=[];for(var B=0;B<t.length;B++)ie(C,Gr(t[B],Zt,!1,!!M))}return this._interpolateSegAlt(C,t,e)}return{points:C,altitude:e}},i._interpolateSegAlt=function(t,e,n){if(!Array.isArray(n)){var o=function(f){return f.point};return{points:t.map(function(l){return Array.isArray(l)?l.map(o):l.point}),altitude:n}}var h=Hu(t,e,n);n=[];var u=h.map(function(l){if(Array.isArray(l)){var f=[],c=l.map(function(d){return f.push(d.altitude),d.point});return n.push(f),c}return n.push(l.altitude),l.point});return{points:u,altitude:n}},i.getSymbol=function(){return this.geometry._getInternalSymbol()},i._resetSymbolizersBBOX=function(){for(var t=this.symbolizers.length-1;t>=0;t--){var e=this.symbolizers[t],n=e.bbox;nr(n)}return this},i.paint=function(t,e,n){if(this.symbolizers){var o=this.getLayer(),h=o._getRenderer();if(!(!h||!h.context&&!e)){var u=h.mapStateCache||{};if(!(!this.geometry._isCheck&&t&&!t.intersects(this.get2DExtent(h.resources,Kc)))){var l=this.getMap();if(!this._aboveCamera()){this.containerOffset=n||u.offset||l._pointToContainerPoint(h.middleWest)._add(0,-l.height/2),this._beforePaint();var f=e||h.context;f.isHitTesting||this._resetSymbolizersBBOX();for(var c=[f,h.resources],d=this.symbolizers.length-1;d>=0;d--)(f.shadowBlur||this.symbolizers[d].symbol.shadowBlur)&&this._prepareShadow(f,this.symbolizers[d].symbol),this.symbolizers[d].symbolize.apply(this.symbolizers[d],c);this._afterPaint(),this._painted=!0,(this.geometry.options.debug||o.options.debug)&&this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,c)}}}}},i.getSprite=function(t,e){if(!this.geometry.isPoint)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var n=new Q;this.symbolizers.forEach(function(v){var m=v.getFixedExtent(t);n._combine(m)});var o=n.getMin().multi(-1),h=e||(this.getMap()?this.getMap().CanvasClass:null),u=I.createCanvas(n.getWidth(),n.getHeight(),h),l;this._renderPoints&&(l=this._renderPoints);for(var f=u.getContext("2d"),c=[f,t],d=this.symbolizers.length-1;d>=0;d--){var g=this.symbolizers[d].getDxDy();this._renderPoints={center:[[o.add(g)]]},this._prepareShadow(f,this.symbolizers[d].symbol),this.symbolizers[d].symbolize.apply(this.symbolizers[d],c)}l&&(this._renderPoints=l),this._sprite={canvas:u,offset:n.getCenter()}}return this._spriting=!1,this._sprite},i.isSpriting=function(){return!!this._spriting},i.hitTest=function(t,e){if((!e||e<.5)&&(e=.5),this._hitPoint=t.sub(e,e),!He){var n=this.getMap()?this.getMap().CanvasClass:null;He=I.createCanvas(1,1,n)}I.setHitTesting(!0),He.width=He.height=2*e;var o=I.getCanvas2DContext(He);o.isHitTesting=!0;try{this.paint(null,o,this._hitPoint)}catch(f){throw f}finally{I.setHitTesting(!1)}delete this._hitPoint;for(var h=o.getImageData(0,0,He.width,He.height).data,u=3,l=h.length;u<l;u+=4)if(h[u]>0)return!0;return!1},i.isHitTesting=function(){return!!this._hitPoint},i._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=this.isHitTesting()?0:e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},i._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var n=this.symbolizers.length-1;n>=0;n--)t.apply(e,[this.symbolizers[n]])}},i.get2DExtent=function(t,e){this._verifyProjection();var n=this.getMap();t=t||this.getLayer()._getRenderer().resources;var o=n.getZoom(),h=this._isDynamicSize();if((!this._extent2D||this._extent2D._zoom!==o||!this._fixedExtent)&&(this._extent2D&&this._extent2D._zoom!==o&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new Q),this._extent2D._zoom=o),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(t,new Q)))),!this._extent2D)return h&&delete this._fixedExtent,null;var u=this._fixedExtent,l=u.xmin,f=u.ymin,c=u.xmax,d=u.ymax;return h&&delete this._fixedExtent,Sr.set(l,-d,c,-f),e?(e.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),e._add(Sr),e):this._extent2D.add(Sr)},i._computeExtent2D=function(t){for(var e=this.symbolizers.length-1;e>=0;e--){var n=this.symbolizers[e];t._combine(n.get2DExtent())}return t},i._computeFixedExtent=function(t,e){for(var n=this.symbolizers.length-1;n>=0;n--){var o=this.symbolizers[n];o.getFixedExtent&&e._combine(o.getFixedExtent(t))}return e},i._isDynamicSize=function(){for(var t=this.symbolizers.length-1;t>=0;t--){var e=this.symbolizers[t];if(e.isDynamicSize())return!0}return!1},i._aboveCamera=function(){var t=this.getMinAltitude(),e=this.getMap(),n=e.getGLRes();t=e.altitudeToPoint(t,n)*Ot(t);var o=e.getFrustumAltitude();return t&&o&&o<t},i.getFixedExtent=function(){var t=this.getMap(),e=t.getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new Q):((!this._extent2D||this._extent2D._zoom!==e)&&this.get2DExtent(null,Sr),this._fixedExtent)},i.setZIndex=function(t){this._eachSymbolizer(function(e){e.setZIndex(t)})},i.show=function(){if(this._painted)this.removeCache(),this._eachSymbolizer(function(e){e.show()});else{var t=this.getLayer();t.isCanvasRender()||this.paint()}},i.hide=function(){this._eachSymbolizer(function(t){t.hide()})},i.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(t){var e=t.getRenderer();!e||!e.setToRedraw()||e.setToRedraw()}},i.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},i.remove=function(){this.removeCache(),this._removeSymbolizers()},i._removeSymbolizers=function(){this._eachSymbolizer(function(t){delete t.painter,t.remove()}),delete this.symbolizers},i.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},i.getAltitude=function(){var t=this.geometry._getAltitude();return t!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},i.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},i.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},i._getGeometryAltitude=function(){var t=this,e=this.getMap();if(!e)return 0;var n=this.geometry._getAltitude();if(this._propAlt=n,!n)return this.minAltitude=this.maxAltitude=0,0;var o=this.geometry.getCenter();return o?Array.isArray(n)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,n.map(function(h){var u=Array.isArray(h);u||(h=[h]);var l=h.map(function(f){var c=f;return c<t.minAltitude&&(t.minAltitude=c),c>t.maxAltitude&&(t.maxAltitude=c),c});return u?l:l[0]})):(this.minAltitude=this.maxAltitude=n,this.minAltitude):0},i._verifyProjection=function(){var t=this.geometry._getProjection()||ed;this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},i._beforePaint=function(){},i._afterPaint=function(){},a}(Bt);function Hu(s,a,i){if(!Array.isArray(i))return s;for(var r=[],t=0,e=s.length;t<e;t++)if(Array.isArray(s[t]))r.push(Hu(s[t],a,i));else{var n=s[t];if(n.point.equals(a[n.index]))n.altitude=i[n.index],r.push(n);else{var o=void 0,h=void 0;n.index===0?(o=n.index,h=n.index+1):(o=n.index-1,h=n.index);var u=n.point.distanceTo(a[h]),l=u/(u+a[o].distanceTo(n.point)),f=Nr(i[o],i[h],1-l);n.altitude=f,r.push(n)}}return r}var id=new Q,Nu=function(s){z(a,s);function a(r,t){var e;return e=s.call(this)||this,e.geometry=r,e.isMask=t,e.bbox=qe(),e._drawTime=0,e}var i=a.prototype;return i._setDrawTime=function(t){return this._drawTime=t,this._eachPainter(function(e){e._setDrawTime(t)}),this},i.getRenderBBOX=function(){var t=this,e=this.getLayer();return e&&e._drawTime!==this._drawTime?null:(nr(this.bbox),this._eachPainter(function(n){var o=n.getRenderBBOX();$r(o)&&yn(t.bbox,o)}),$r(this.bbox)?this.bbox:null)},i._eachPainter=function(t){for(var e=this.geometry.getGeometries(),n,o=0,h=e.length;o<h&&(n=this.isMask?e[o]._getMaskPainter():e[o]._getPainter(),!(!!n&&n&&t.call(this,n)===!1));o++);},i.getLayer=function(){return this.geometry&&this.geometry.getLayer()},i.paint=function(t){this.geometry&&this._eachPainter(function(e){e.paint(t)})},i.get2DExtent=function(t,e){e&&e.set(null,null,null,null);var n=e||new Q;return this._eachPainter(function(o){n=n._combine(o.get2DExtent(t,id))}),n},i.remove=function(){var t=arguments;this._eachPainter(function(e){e.remove.apply(e,t)})},i.setZIndex=function(){var t=arguments;this._eachPainter(function(e){e.setZIndex.apply(e,t)})},i.show=function(){var t=arguments;this._eachPainter(function(e){e.show.apply(e,t)})},i.hide=function(){var t=arguments;this._eachPainter(function(e){e.hide.apply(e,t)})},i.repaint=function(){var t=arguments;this._eachPainter(function(e){e.repaint.apply(e,t)})},i.refreshSymbol=function(){var t=arguments;this._eachPainter(function(e){e.refreshSymbol.apply(e,t)})},i.hasPoint=function(){var t=!1;return this._eachPainter(function(e){return e.hasPoint()?(t=!0,!1):!0}),t},i.getMinAltitude=function(){var t=!0,e=0;return this._eachPainter(function(n){var o=n.getMinAltitude();(t||o<e)&&(t=!1,e=o)}),e},i.getMaxAltitude=function(){var t=0;return this._eachPainter(function(e){var n=e.getMaxAltitude();n>t&&(t=n)}),t},a}(Bt),si=23,Jt={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var s=[],a=12756274*Math.PI,i=0;i<si;i++)s[i]=a/(256*Math.pow(2,i));return s}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var s=[],a=0;a<si;a++)s[a]=180/(Math.pow(2,a)*128);return s}()},BAIDU:{projection:"baidu",resolutions:function(){for(var s=Math.pow(2,18),a=[],i=0;i<si;i++)a[i]=s,s*=.5;return a}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var s=Math.pow(2,8),a=[],i=0;i<si;i++)a[i]=s,s*=.5;return a}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var s=[],a=6378137*Math.PI,i=0;i<si;i++)s[i]=a/(256*Math.pow(2,i));return s}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"PRESET-VT-4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var s=[],a=0;a<si;a++)s[a]=180/4/(Math.pow(2,a)*128);return s}()}};Jt["EPSG:4490"]=Jt["EPSG:4326"];Jt["PRESET-3857-512"]=Jt["PRESET-VT-3857"];Jt["PRESET-4326-512"]=Jt["PRESET-VT-4326"];var oe=function(){function s(i){i===void 0&&(i={}),this.options=i,this._initSpatialRef()}s.registerPreset=function(r,t){r=r&&r.toUpperCase(),Jt[r]&&console.warn("Spatial reference "+r+" already registered."),Jt[r]=t},s.getPreset=function(r){return Jt[r.toUpperCase()]},s.getAllPresets=function(){return Object.keys(Jt)},s.getProjectionInstance=function(r){if(!r)return null;if(tt(r)&&(r={code:r}),r.project)return r.locate||(r=F({},r),r.measure==="identity"?F(r,jr.getInstance("IDENTITY")):F(r,jr.getInstance("EPSG:4326"))),r;var t=(r.code+"").toLowerCase();for(var e in ce)if(wi(ce,e)){var n=ce[e].aliases||[],o=ce[e].code;n.push(o);for(var h=0;h<n.length;h++)if(n[h].toLowerCase()===t)if(ce[e].create){var u=ce[e].create(r);return u.code=n[h],u}else{if(ce[e].code===n[h])return ce[e];var l=F({},ce[e]);return l.code=n[h],l}}return null},s.equals=function(r,t){if(tt(r)||tt(t))return r===t;if(!r&&!t)return!0;if(!r||!t||r.projection!==t.projection)return!1;var e=r.fullExtent,n=t.fullExtent;if(e&&!n||!e&&n||e&&n&&(e.top!==n.top||e.bottom!==n.bottom||e.left!==n.left||e.right!==n.right))return!1;var o=r.resolutions,h=t.resolutions;if(o&&h){if(o.length!==h.length)return!1;for(var u=0;u<o.length;u++)if(o[u]!==h[u])return!1}else if(o||h)return!1;return!0};var a=s.prototype;return a._initSpatialRef=function(){var r=this.options.projection;if(r?r=s.getProjectionInstance(r):r=Mu,!r)throw new Error("must provide a valid projection in map's spatial reference.");r=F({},ke,r),r.measureLength||F(r,jr.DEFAULT),this._projection=r;var t,e=this.options.resolutions;if(!e&&(r.code&&(t=Jt[r.code.toUpperCase()],t&&(e=t.resolutions,this.isEPSG=r.code!=="IDENTITY")),!e))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=e,this._pyramid=!0,this._pyramid){for(var n=0;n<e.length;n++)if(e[n]&&e[n-1]&&e[n-1]/e[n]!==2){this._pyramid=!1;break}}var o=this.options.fullExtent;if(!o&&(r.code&&(t=Jt[r.code.toUpperCase()],t&&(o=t.fullExtent)),!o))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(P(o.left)?(this._fullExtent=new ft(o),o.left=o.xmin,o.right=o.xmax,o.top=o.ymax,o.bottom=o.ymin):this._fullExtent=new ft(new L(o.left,o.top),new L(o.right,o.bottom)),P(o.top)||P(o.bottom)||P(o.left)||P(o.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");F(this._fullExtent,o),this._projection.fullExtent=o;var h=o.right>=o.left?1:-1,u=o.top>=o.bottom?-1:1;this._transformation=new xu([h,u,0,0])},a.getResolutions=function(){return this._resolutions||[]},a.getResolution=function(r){var t=r|0;t<0?t=0:t>this._resolutions.length-1&&(t=this._resolutions.length-1);var e=this._resolutions[t];if(t!==r&&r>0&&t<this._resolutions.length-1){var n=this._resolutions[t+1];return e+(n-e)*(r-t)}return e},a.getProjection=function(){return this._projection},a.getFullExtent=function(){return this._fullExtent},a.getTransformation=function(){return this._transformation},a.getMinZoom=function(){for(var r=0;r<this._resolutions.length;r++)if(!P(this._resolutions[r]))return r;return 0},a.getMaxZoom=function(){for(var r=this._resolutions.length-1;r>=0;r--)if(!P(this._resolutions[r]))return r;return this._resolutions.length-1},a.getZoomDirection=function(){return Ot(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},a.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},a.isPyramid=function(){return this._pyramid},s}(),sa=new E(0,0),Io=new Q,oa={};function rd(s){if(!s)return!1;var a=s.xmin,i=s.ymin,r=s.xmax,t=s.ymax;return r-a>0&&t-i>0}var nd={id:null,visible:!0,interactive:!0,editable:!0,cursor:null,antiMeridian:!1,defaultProjection:"EPSG:4326"},ot=function(s){z(a,s);function a(r){var t,e=F({},r),n=e.symbol,o=e.properties,h=e.id;return delete e.symbol,delete e.id,delete e.properties,t=s.call(this,e)||this,n?t.setSymbol(n):t._genSizeSymbol(),o&&t.setProperties(o),P(h)||t.setId(h),t}var i=a.prototype;return i.getFirstCoordinate=function(){if(this.type==="GeometryCollection"){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do e=e[0];while(Array.isArray(e)&&e.length>0);return e},i.getLastCoordinate=function(){if(this.type==="GeometryCollection"){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do e=e[e.length-1];while(Array.isArray(e)&&e.length>0);return e},i.addTo=function(t,e){return t.addGeometry(this,e),this},i.getLayer=function(){return this._layer?this._layer:null},i.getMap=function(){return this._layer?this._layer.getMap():null},i.getId=function(){return this._id},i.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},i.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},i.setProperties=function(t){var e=this.properties;return this.properties=ee(t)?F({},t):t,this._clearAltitudeCache(),this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},i.getType=function(){return this.type},i.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?Kt(t):F({},t):null},i.setSymbol=function(t){return this._symbolUpdated=t,this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},i.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=lr(this._symbolUpdated)),this._symbolHash},i.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Parameter of updateSymbol is not an array.");for(var n=0;n<t.length;n++)Qr(t[n])&&delete this._textDesc,e[n]&&t[n]&&(e[n]=Kt(e[n],t[n]))}else{if(Array.isArray(t))throw new Error("Geometry's symbol is not an array to update.");Qr(e)&&delete this._textDesc,e?e=Kt(e,t):e=Kt(this._getInternalSymbol(),t)}return this._eventSymbolProperties=t,delete this._compiledSymbol,this.setSymbol(e)},i.getTextContent=function(){var t=this._getInternalSymbol();if(Array.isArray(t)){for(var e=[],n=!1,o=0;o<t.length;o++)e[o]=tr(t[o]&&t[o].textName,this.getProperties()),P(e[o])||(n=!0);return n?e:null}return tr(t&&t.textName,this.getProperties())},i.getTextDesc=function(){if(!this._textDesc){var t=this.getTextContent(),e=this._sizeSymbol,n=Array.isArray(t);Array.isArray(e)?this._textDesc=e.map(function(o,h){return er(n?t[h]:"",o)}):this._textDesc=er(t,e)}return this._textDesc},i.getCenter=function(){return this._computeCenter(this._getMeasurer())},i.getExtent=function(){var t=this._getPrjExtent(),e=this._getProjection();if(t&&e){var n=e.unproject(new L(t.xmin,t.ymin)),o=e.unproject(new L(t.xmax,t.ymax));return new ft(n,o,e)}else return this._computeExtent(this._getMeasurer())},i.getContainerExtent=function(t){var e=this.get2DExtent();if(!e||!e.isValid())return null;var n=this.getMap(),o=n.getGLRes(),h=this.getMinAltitude(),u=e.convertTo(function(m){return n._pointAtResToContainerPoint(m,o,h,sa)},t),l=this.getMaxAltitude();if(l!==h){var f=e.convertTo(function(m){return n._pointAtResToContainerPoint(m,o,l,sa)},Io);u._combine(f)}var c=this.getLayer();if(c&&this.type==="LineString"&&l&&c.options.drawAltitude){var d=e.convertTo(function(m){return n._pointAtResToContainerPoint(m,o,0,sa)},Io);u._combine(d)}if(u){var g=this._getFixedExtent();rd(g)&&u._add(g)}var v=this.options.smoothness;return v&&u._expand(u.getWidth()*.15),u},i._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new Q);var t=this._sizeSymbol,e=(t&&t.lineWidth||1)/2;this._fixedExtent.set(-e,-e,e,e);var n=t&&t.lineDx||0;this._fixedExtent._add([n,0]);var o=t&&t.lineDy||0;return this._fixedExtent._add([0,o]),this._fixedExtent},i.get2DExtent=function(){var t=this.getMap();if(!t)return null;if(this._extent2d)return this._extent2d;var e=this._getPrjExtent();if(!e||!e.isValid())return null;var n=e.getMin(),o=e.getMax(),h=t.getGLRes();return t._prjToPointAtRes(n,h,n),t._prjToPointAtRes(o,h,o),this._extent2d=new Q(n,o),this._extent2d.z=t.getZoom(),this._extent2d},i.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},i.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof L&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},i._containsPoint=function(t,e){var n=this._getPainter();return n?(e=e||0,this._hitTestTolerance&&(e+=this._hitTestTolerance()),n.hitTest(t,e)):!1},i.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},i.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},i.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,n=t.length;e<n;e++)if(P(t[e].opacity)||t[e].opacity>0)return!0;return!1}else return P(t.opacity)||ee(t.opacity)||H(t.opacity)&&t.opacity>0},i.getZIndex=function(){return this.options.zIndex||0},i.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},i.setZIndexSilently=function(t){return this.options.zIndex=t,this},i.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},i.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},i.translate=function(t,e){if(P(t))return this;var n=new L(t,e);if(n.x===0&&n.y===0)return this;var o=this.getCoordinates();if(this._silence=!0,o)if(Array.isArray(o)){var h=Ue(o,function(u){return u.add(n)});this.setCoordinates(h)}else this.setCoordinates(o.add(n));return this._silence=!1,this._fireEvent("positionchange"),this},i.flash=function(t,e,n,o){return Ba.call(this,t,e,n,o)},i.copy=function(){var t=this.toJSON(),e=a.fromJSON(t);return e.options.visible=!0,e},i.remove=function(){var t=this.getLayer();return t?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},i.toGeoJSONGeometry=function(){var t=this._exportGeoJSONGeometry();return t},i.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(P(t.geometry)||t.geometry){var n=this._exportGeoJSONGeometry();e.geometry=n}var o=this.getId();P(o)||(e.id=o);var h;return(P(t.properties)||t.properties)&&(h=this._exportProperties()),e.properties=h,e},i.toJSON=function(t){t||(t={});var e=this._toJSON(t),n=this._exportGraphicOptions(t);return F(e,n),e},i.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},i.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},i.rotate=function(t,e){if(!H(t))return console.error("angle:"+t+" is not number"),this;if(this.type==="GeometryCollection"){var n=this.getGeometries();return n.forEach(function(l){return l.rotate(t,e)}),this}e?e=new L(e):e=this.getCenter(),this._angle=t,this._pivot=e;var o=this._getMeasurer(),h=this.getCoordinates();if(!Array.isArray(h)){if((e.x!==h.x||e.y!==h.y)&&!this.getShell){var u=o._rotate(h,e,t);this.setCoordinates(u)}else this.onPositionChanged();return this}return Ue(h,function(l){return o._rotate(l,e,t)}),this.setCoordinates(h),this},i._rotatePrjCoordinates=function(t){if(!t||this._angle===0||!this._pivot)return t;var e=this._getProjection();if(!e)return t;var n=0,o=Array.isArray(t),h=o?t:[t],u=[],l,f;if(this.getRotateOffsetAngle){n=this.getRotateOffsetAngle();var c=h[h.length-1];l=c.x,f=c.y}else{var d=qe();pn(h,d);var g=d[0],v=d[1],m=d[2],_=d[3];l=(g+m)/2,f=(v+_)/2}for(var p=0,y=h.length;p<y;p++){var w=h[p],C=w.x,x=w.y,M=C-l,S=x-f,T=Math.sqrt(M*M+S*S),b=ad(l,f,C,x),D=(b-this._angle+n)/180*Math.PI,R=Math.cos(D)*T,k=Math.sin(D)*T,O=new L(l+R,f+k);u.push(O)}for(var A=e.project(this._pivot),j=A.x,G=A.y,N=l-j,B=f-G,Z=0,U=u.length;Z<U;Z++){var J=u[Z];J.x-=N,J.y-=B}return o?u:u[0]},i.isRotated=function(){return H(this._angle)&&this._pivot},i._getConnectPoints=function(){return[this.getCenter()]},i._initOptions=function(t){var e=F({},t),n=e.symbol,o=e.properties,h=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),n&&this.setSymbol(n),o&&this.setProperties(o),P(h)||this.setId(h)},i._bindLayer=function(t){if(t!==this.getLayer()){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache(),this._bindInfoWindow(),this._bindMenu()}},i._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(Ur(this._checkAndCopySymbol(t[n])));return e}else if(t)return t=this._checkAndCopySymbol(t),Ur(t);return null},i._checkAndCopySymbol=function(t){var e={};for(var n in t)Wl[n]&&tt(t[n])?e[n]=+t[n]:e[n]=t[n];return e},i._getSymbol=function(){return this._symbol},i._setExternSymbol=function(t){return this._eventSymbolProperties=t,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},i._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},i._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},i._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},i._getInternalId=function(){return this._internalId},i._setInternalId=function(t){this._internalId=t},i._getMeasurer=function(){return this._getProjection()?this._getProjection():oe.getProjectionInstance(this.options.defaultProjection)},i._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},i._verifyProjection=function(){var t=this._getProjection();this._projCode&&t&&this._projCode!==t.code&&this._clearProjection(),this._projCode=t?t.code:this._projCode},i._getExternalResources=function(){var t=this._getInternalSymbol();return hr(t)},i._getPainter=function(){if(this._painter)return this._painter;var t=this.getLayer();if(!this._painter&&t){if(Eh.indexOf(this.type)!==-1){if(t.constructor.getCollectionPainterClass){var e=t.constructor.getCollectionPainterClass();e&&(this._painter=new e(this))}}else if(t.constructor.getPainterClass){var n=t.constructor.getPainterClass();n&&(this._painter=new n(this))}}return this._painter},i._getMaskPainter=function(){return this._maskPainter?this._maskPainter:(this._maskPainter=this.getGeometries&&this.getGeometries()?new Nu(this,!0):new xs(this),this._maskPainter)},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},i._paint=function(t){if(this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var e=this._getProjection();e&&(this._pcenter=e.project(this._coordinates),this._clearCache())}this._painter.paint(t)}},i._clearCache=function(){delete this._extent,delete this._extent2d,this._clearAltitudeCache()},i._clearProjection=function(){delete this._extent,delete this._extent2d},i._repaint=function(){this._painter&&this._painter.repaint()},i.onHide=function(){this.closeMenu(),this.closeInfoWindow()},i.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},i.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},i.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var t={};this._eventSymbolProperties?(t.properties=JSON.parse(JSON.stringify(this._eventSymbolProperties)),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",t)},i._genSizeSymbol=function(){var t=this._getInternalSymbol();if(!t){delete this._sizeSymbol;return}if(Array.isArray(t)){this._sizeSymbol=[];for(var e=!1,n=0;n<t.length;n++){var o=this._sizeSymbol[n]=this._getSizeSymbol(t[n]);!e&&o&&o._dynamic&&(e=!0)}this._sizeSymbol._dynamic=e}else this._sizeSymbol=this._getSizeSymbol(t)},i._getSizeSymbol=function(t){var e=Qi({lineWidth:t.lineWidth,lineDx:t.lineDx,lineDy:t.lineDy},this);return(lt(t.lineWidth)||lt(t.lineDx)||lt(t.lineDy))&&(e._dynamic=!0),e},i._getCompiledSymbol=function(){return this._compiledSymbol?this._compiledSymbol:(this._compiledSymbol=Qi(this._getInternalSymbol(),this),this._compiledSymbol)},i.onConfig=function(t){var e;t.properties&&(e=t.properties,delete t.properties);var n=!1;for(var o in t)if(t.hasOwnProperty(o)){var h=o.slice(0,5);if(h==="arrow"||h==="smoot"){n=!0;break}}e?(this.setProperties(e),this._repaint()):n&&this._repaint()},i._setParent=function(t){t&&(this._parent=t)},i._getParent=function(){return this._parent},i._fireEvent=function(t,e){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e))},i._toJSON=function(t){return{feature:this.toGeoJSON(t)}},i._exportGraphicOptions=function(t){var e={};return(P(t.options)||t.options)&&(e.options=this.config()),(P(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(P(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},i._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=L.toNumberArrays(t);return{type:this.getType(),coordinates:e}},i._exportProperties=function(){var t=null,e=this.getProperties();return P(e)||(ee(e)?t=F({},e):t=e),t},i._hitTestTolerance=function(){return 0},i._getAltitude=function(){var t=this.getLayer();if(!t)return 0;var e=t.options,n=t.getAltitude?t.getAltitude():0,o=e.enableAltitude;if(!o)return n;var h=ha(t),u=this.properties||oa,l=u[h];if(P(l)){var f=zo(this,n,o);return P(f)?n:f}return Array.isArray(l)?l.map(function(c){return c+n}):l+n},i.getAltitude=function(){var t=this.getLayer(),e=ha(t),n=this.properties||oa,o=n[e];if(!P(o))return o;var h=zo(this,0,!1);return P(h)?0:h},i.hasAltitude=function(){var t=this._getAltitude();return!!t},i.setAltitude=function(t){if(!H(t))return this;var e=this.getLayer(),n=ha(e),o=this.properties||oa,h=o[n];if(!P(h))if(Array.isArray(h))for(var u=0,l=h.length;u<l;u++)h[u]=t;else o[n]=t;var f=this.getCoordinates?this.getCoordinates():null;if(!f)return this;if(Bu(f,t),e){var c=e.getRenderer();c&&c.gl?this.setCoordinates(f):c&&this._repaint()}return this._clearAltitudeCache(),this},i._genMinMaxAlt=function(){var t=this,e=this._getAltitude();Array.isArray(e)?(this._minAlt=Number.MAX_VALUE,this._maxAlt=Number.MIN_VALUE,e.forEach(function(n){var o=n;o<t._minAlt&&(t._minAlt=o),o>t._maxAlt&&(t._maxAlt=o)})):this._minAlt=this._maxAlt=e},i.getMinAltitude=function(){return this._minAlt===void 0&&this._genMinMaxAlt(),this._minAlt?this._minAlt:0},i.getMaxAltitude=function(){return this._maxAlt===void 0&&this._genMinMaxAlt(),this._maxAlt?this._maxAlt:0},i._clearAltitudeCache=function(){return this._minAlt=void 0,this._maxAlt=void 0,this},a}(wu(le(os(Bt))));ot.mergeOptions(nd);function ha(s){var a="altitude";if(s){var i=s.options;a=i.altitudeProperty}return a}function zo(s,a,i){var r=s.getCoordinates?s.getCoordinates():null;if(r){var t=[];if(Zu(r,t),t.length){var e=Wu(r,a,i);return e}}return null}function Bu(s,a){if(Array.isArray(s))for(var i=0,r=s.length;i<r;i++)Bu(s[i],a);else s.z=a}function Zu(s,a){if(!a.length)if(Array.isArray(s))for(var i=0,r=s.length;i<r;i++)Zu(s[i],a);else H(s.z)&&a.push(s.z)}function Wu(s,a,i){if(Array.isArray(s)){for(var r=[],t=0,e=s.length;t<e;t++)r.push(Wu(s[t],a,i));return r}return H(s.z)?i?a+s.z:s.z:i?a:0}function ad(s,a,i,r){if(s===i)return r>a?-90:90;i-=s,r-=a,r=-r;var t=Math.atan2(r,i);return t/Math.PI*180}var sd={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:function(){return!q.mobile}()},It=function(s){z(a,s);function a(r,t){var e,n;return t&&(n=t.canvas,delete t.canvas),e=s.call(this,t)||this,e._canvas=n,e.setId(r),t&&(e.setZIndex(t.zIndex),t.mask&&e.setMask(ot.fromJSON(t.mask))),e.proxyOptions(),e}var i=a.prototype;return i.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();P(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},i.getId=function(){return this._id},i.setId=function(t){var e=this._id;return P(t)||(t=t+""),this._id=t,this.fire("idchange",{old:e,new:t}),this},i.addTo=function(t){return t.addLayer(this),this},i.setZIndex=function(t){return this._zIndex=t,P(t)?delete this.options.zIndex:this.options.zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this.fire("setzindex",{zIndex:t}),this},i.getZIndex=function(){return this._zIndex||0},i.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},i.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),P(e)?1/0:e):e},i.getOpacity=function(){return this.options.opacity},i.setOpacity=function(t){return this.config("opacity",t),this.fire("setopacity",{opacity:t}),this},i.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof Ci},i.getMap=function(){return this.map?this.map:null},i.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},i.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(t.length===1||e===this)return this;var n=e.getZIndex();return this.setZIndex(n+1),this},i.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(t.length===1||e===this)return this;var n=e.getZIndex();return this.setZIndex(n-1),this},i.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var n=this.getMap();e&&n?n.once("renderend",function(){t.fire("show")}):this.fire("show")}return this},i.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var n=this.getMap();e&&n?n.once("renderend",function(){t.fire("hide")}):this.fire("hide")}return this},i.isVisible=function(){if(H(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!P(this.options.maxZoom)&&this.options.maxZoom<e||!P(this.options.minZoom)&&this.options.minZoom>e)return!1}return P(this.options.visible)&&(this.options.visible=!0),this.options.visible},i.remove=function(){if(this.map){var t=this.map.getRenderer();this.map.removeLayer(this),t&&t.setToRedraw()}else this.fire("remove");return this},i.getMask=function(){return this._mask},i.setMask=function(t){if(!(t.type==="Point"&&t._isVectorMarker()||t.type==="Polygon"||t.type==="MultiPolygon"))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(t._bindLayer(this),t.type==="Point"?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=t,this.options.mask=t.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},i.removeMask=function(){if(delete this._mask,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},i.onLoad=function(){return!0},i.onLoadEnd=function(){},i.isLoaded=function(){return!!this._loaded},i.getCollisionIndex=function(){if(this.options.collisionScope==="layer")return this._collisionIndex||(this._collisionIndex=new dr),this._collisionIndex;var t=this.getMap();return t?t.getCollisionIndex():null},i.clearCollisionIndex=function(){return this.options.collisionScope==="layer"&&this._collisionIndex&&this._collisionIndex.clear(),this},i.getRenderer=function(){return this._getRenderer()},i.onConfig=function(t){var e=t&&Object.keys&&Object.keys(t).length>0;if(e&&P(t.animation)){if(this._optionsHook&&it(this._optionsHook)&&this._optionsHook(t),this._silentConfig)return;var n=this.getRenderer();n&&n.setToRedraw&&n.setToRedraw()}},i.onAdd=function(){},i.onRendererCreate=function(){},i.onCanvasCreate=function(){},i.onRemove=function(){},i._bindMap=function(t,e){t&&(this.map=t,P(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},i._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{renderer:this._renderer})}},i._doRemove=function(){this._loaded=!1,this._switchEvents("off",this),this.onRemove(),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},i._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()&&this.getMap()[t](e.getEvents(),e)},i._getRenderer=function(){return this._renderer},i._getLayerList=function(){return this.map?this.map._layers:[]},i._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getMaskPainter();return t?t.get2DExtent():null},a}(wu(le(cs(Bt))));It.mergeOptions(sd);var od=It.prototype.fire;It.prototype.fire=function(s,a){return s==="layerload"&&(this._loaded=!0),this.map&&(a||(a={}),a.type=s,a.target=this,this.map._onLayerEvent(a)),od.apply(this,arguments),["show","hide"].indexOf(s)>-1&&this.fire("visiblechange",Object.assign({},a,{visible:this.options.visible})),this};var Vu=new L(0,0),jo=new E(0,0),Go=["centerCross","fog","fogColor","debugSky"],hd={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:function(){return!bt}(),zoomAnimationDuration:330,panAnimation:function(){return!bt}(),panAnimationDuration:600,rotateAnimation:function(){return!bt}(),zoomable:!0,enableInfoWindow:!0,hitDetect:function(){return!q.mobile}(),hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0,clickTimeThreshold:280,stopRenderOnOffscreen:!0,preventWheelScroll:!0,preventTouch:!0,supportPluginEvent:!0,switchDragButton:!1,mousemoveThrottleTime:rs},$=function(s){z(a,s);function a(r,t){var e;if(!t)throw new Error("Invalid options when creating map.");if(!t.center)throw new Error("Invalid center when creating map.");var n=F({},t),o=n.zoom;delete n.zoom;var h=new L(n.center);delete n.center;var u=n.baseLayer;delete n.baseLayer;var l=n.layers;return delete n.layers,e=s.call(this,n)||this,e.VERSION=a.VERSION,Object.defineProperty(mt(mt(e)),"id",{value:we(),writable:!1}),e._loaded=!1,e._initContainer(r),e._panels={},e._baseLayer=null,e._layers=[],e._zoomLevel=o,e._center=h,e._centerZ=h.z,e.setSpatialReference(n.spatialReference||n.view),e._mapViewPoint=new E(0,0),e._initRenderer(),e._updateMapSize(e._getContainerDomSize()),u&&e.setBaseLayer(u),l&&e.addLayer(l),e.setMaxExtent(n.maxExtent),e._Load(),e.proxyOptions(),e.isMap=!0,e}a.addOnLoadHook=function(t){var e=Array.prototype.slice.call(arguments,1),n=typeof t=="function"?t:function(){this[t].apply(this,e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(n),this};var i=a.prototype;return i.isLoaded=function(){return!!this._loaded},i.getContainer=function(){return this._containerDOM},i.getSpatialReference=function(){return this._spatialReference},i.setSpatialReference=function(t){var e=this.options.spatialReference;return this._loaded&&oe.equals(e,t)?this:(this._updateSpatialReference(t,e),this)},i._updateSpatialReference=function(t,e){tt(t)&&(t=oe.getPreset(t)),t=F({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new oe(t);var n=this._spatialReference.getProjection();return this.options.spatialReference&&it(this.options.spatialReference.projection)&&(this.options.spatialReference.projection=n.code),this._resetMapStatus(),Yr.is(n.code)&&(this._originLng=n.centralMeridian,this._altitudeOriginDirty=!0),this._fireEvent("spatialreferencechange",{old:e,new:F({},this.options.spatialReference)}),this},i.onConfig=function(t){var e=t.spatialReference||t.view;P(e)||this._updateSpatialReference(e,null);for(var n=!1,o=0,h=Go.length;o<h;o++){var u=Go[o];if(!P(t[u])){n=!0;break}}if(!n)return this;var l=this.getRenderer();return l&&l.setToRedraw(),this},i.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},i.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},i.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},i.resetCursor=function(){return this.setCursor(null)},i.getCenter=function(){if(!this._loaded||!this._prjCenter)return this._center;var t=this.getProjection(),e=t.unproject(this._prjCenter);return e.x=Math.round(e.x*1e8)/1e8,e.y=Math.round(e.y*1e8)/1e8,e.z=this._centerZ,this.centerAltitude&&(e.z=this.centerAltitude),e},i.setCenter=function(t,e){if(!t)return this;t=new L(t),e&&(t=this._getCenterByPadding(t,this.getZoom(),e));var n=this.getProjection(),o=n.project(t);return this._verifyExtent(o)?this._loaded?(this._centerZ=t.z||0,this.onMoveStart(),this._setPrjCenter(o),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=t,this):this},i.getSize=function(){return P(this.width)||P(this.height)?this._getContainerDomSize():new xt(this.width,this.height)},i.getContainerExtent=function(){var t=this.height,e=this.getPitch(),n=this.options.maxVisualPitch;return n&&e>n&&(t=this._getVisualHeight(n)),new Q(0,this.height-t,this.width,this.height)},i._getVisualHeight=function(t){t=t||.01;var e=(90-this.getPitch())*Math.PI/180,n=this.getFov()*Math.PI/180;t*=Math.PI/180;var o=this.cameraCenterDistance/this.getGLScale(),h=Math.tan(n/2),u=Math.tan(t),l=o*h/(1/u-h)/Math.sin(t),f=o*(Math.sin(e)*l/(o+Math.cos(e)*l));return this.height/2+f},i.getExtent=function(){return this._pointToExtent(this._get2DExtent())},i.getProjExtent=function(){var t=this._get2DExtent();return new ft(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},i.getPrjExtent=function(){return this.getProjExtent()},i.getMaxExtent=function(){return this.options.maxExtent?new ft(this.options.maxExtent,this.getProjection()):null},i.setMaxExtent=function(t){if(t){var e=new ft(t,this.getProjection());this.options.maxExtent=e;var n=this.getProjection();this._prjMaxExtent=e.convertTo(function(o){return n.project(o)}),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=n.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},i.getZoom=function(){return this._zoomLevel},i.getZoomForScale=function(t,e,n){var o=this.getZoom();if(P(e)&&(e=o),t===1&&e===o)return o;var h=this._getResolution(e),u=h/t,l=this.getZoomFromRes(u);if(n)return l;var f=1e-6;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(l-f):Math.floor(l+f)},i.getZoomFromRes=function(t){var e=this._getResolutions(),n=this._getResolution(this.getMinZoom()),o=this._getResolution(this.getMaxZoom());if(n<=o){if(t<=n)return this.getMinZoom();if(t>=o)return this.getMaxZoom()}else{if(t>=n)return this.getMinZoom();if(t<=o)return this.getMaxZoom()}for(var h=e.length,u=0;u<h-1;u++)if(e[u]){var l=e[u+1]-e[u],f=t-e[u];if(Ot(l)===Ot(f)&&Math.abs(l)>=Math.abs(f))return u+f/l}return h-1},i.setZoom=function(t,e){return e===void 0&&(e={animation:!0}),isNaN(t)||P(t)?this:(t=+t,this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t),this)},i.getMaxZoom=function(){return P(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},i.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return t>e&&(t=e),t!==null&&t<this._zoomLevel&&(this.setZoom(t),t=+t),this.options.maxZoom=t,this},i.getMinZoom=function(){return P(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},i.setMinZoom=function(t){if(t!==null){t=+t;var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},i.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},i.getGLRes=function(){if(this._glRes)return this._glRes;var t=this.getSpatialReference().getFullExtent();return this._glRes=(t.right-t.left)/Math.pow(2,19),this._glRes},i.getGLScale=function(t){return P(t)&&(t=this.getZoom()),this._getResolution(t)/this.getGLRes()},i.zoomIn=function(){return this.setZoom(this.getZoom()+1)},i.zoomOut=function(){return this.setZoom(this.getZoom()-1)},i.isZooming=function(){return!!this._zooming},i.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},i.setCenterAndZoom=function(t,e){return!P(e)&&this._zoomLevel!==e?(this.setCenter(t),this.setZoom(e,{animation:!1})):this.setCenter(t),this},i._getPaddingSize=function(t){return t===void 0&&(t={}),t.paddingLeft||t.paddingTop||t.paddingRight||t.paddingBottom?{width:(t.paddingLeft||0)+(t.paddingRight||0),height:(t.paddingTop||0)+(t.paddingBottom||0)}:null},i.getFitZoom=function(t,e,n){var o=this;if(!t||!(t instanceof ft))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var h=this.getSize(),u=this._getPaddingSize(n);u&&(h={width:h.width-(u.width||0),height:h.height-(u.height||0)});var l=t.convertTo(function(_){return o.coordToPoint(_)}),f=l.getWidth(),c=l.getHeight(),d=h.width/f,g=h.height/c,v=this.getSpatialReference().getZoomDirection()<0?Math.max(d,g):Math.min(d,g),m=this.getZoomForScale(v,null,e);return m},i.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},i.setView=function(t){return t?(t.center&&this.setCenter(t.center),t.zoom!==null&&!isNaN(+t.zoom)&&this.setZoom(+t.zoom,{animation:!1}),t.pitch!==null&&!isNaN(+t.pitch)&&this.setPitch(+t.pitch),t.pitch!==null&&!isNaN(+t.bearing)&&this.setBearing(+t.bearing),this):this},i.getResolution=function(t){return this._getResolution(t)},i.getScale=function(t){var e=P(t)?this.getZoom():t,n=this._getResolution(this.getMaxNativeZoom()),o=this._getResolution(e);return o/n},i._getCenterByPadding=function(t,e,n){n===void 0&&(n={});var o=this.coordinateToPoint(t,e),h=n,u=h.paddingLeft,l=u===void 0?0:u,f=h.paddingRight,c=f===void 0?0:f,d=h.paddingTop,g=d===void 0?0:d,v=h.paddingBottom,m=v===void 0?0:v,_=0,p=0;(l||c)&&(_=(c-l)/2),(g||m)&&(p=(g-m)/2);var y=new E({x:o.x+_,y:o.y+p});return this.pointToCoordinate(y,e)},i.fitExtent=function(t,e,n,o){if(n===void 0&&(n={}),!t)return this;t=new ft(t,this.getProjection());var h=this.getFitZoom(t,n.isFraction||!1,n)+(e||0),u=t.getCenter();return this._getPaddingSize(n)&&(u=this._getCenterByPadding(u,h,n)),typeof n.animation>"u"||n.animation?this._animateTo({center:u,zoom:h},{duration:n.duration||this.options.zoomAnimationDuration,easing:n.easing||"out"},o):this.setCenterAndZoom(u,h)},i.getBaseLayer=function(){return this._baseLayer},i.setBaseLayer=function(t){var e=!1;if(this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!t)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;this._baseLayer=t,t._bindMap(this,-1);function n(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))}return this._baseLayer.on("layerload",n,this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},i.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},i.getLayers=function(t){return this._getLayers(function(e){return e===this._baseLayer||e.getId().indexOf(or)>=0?!1:t?t(e):!0})},i.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var n=this.getBaseLayer();return n&&n.getId()===t?n:null},i.addLayer=function(t){if(!t)return this;if(!Array.isArray(t))return t=Array.prototype.slice.call(arguments,0),this.addLayer(t);this._layerCache||(this._layerCache={});for(var e=this._layers,n=0,o=t.length;n<o;n++){var h=t[n],u=h.getId();if(P(u))throw new Error("Invalid id for the layer: "+u);if(h.getMap()!==this){if(this._layerCache[u])throw new Error("Duplicate layer id in the map: "+u);this._layerCache[u]=h,h._bindMap(this),e.push(h),this._loaded&&h.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},i.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],n=0,o=t.length;n<o;n++){var h=t[n];if(h instanceof It||(h=this.getLayer(h)),!!h){var u=h.getMap();if(!(!u||u!==this)){e.push(h),this._removeLayer(h,this._layers),this._loaded&&h._doRemove();var l=h.getId();this._layerCache&&delete this._layerCache[l]}}}if(e.length>0){var f=this.getRenderer();f&&f.setLayerCanvasUpdated(),this.once("frameend",function(){e.forEach(function(c){c.fire("remove")})})}return this._fireEvent("removelayer",{layers:t}),this},i.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],n=Number.MAX_VALUE,o=0,h=t.length;o<h;o++){var u=t[o];if(tt(t[o])&&(u=this.getLayer(u)),!(u instanceof It)||!u.getMap()||u.getMap()!==this)throw new Error("It must be a layer added to this map to order.");u.getZIndex()<n&&(n=u.getZIndex()),e.push(u)}for(var l=0,f=e.length;l<f;l++)e[l].setZIndex(n+l);return this},i.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var n=t.save,o=this._getRenderer();if(o&&o.toDataURL){var h=t.fileName;h||(h="export");var u=o.toDataURL(e,t.quality||.92);if(n&&u){var l;if(typeof Blob<"u"&&typeof atob<"u"){var f=Fh(u.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),e);l=URL.createObjectURL(f)}else l=u;var c=document.createElement("a");c.download=h,c.href=l,document.body.appendChild(c),c.click(),document.body.removeChild(c)}return u}return null},i.coordToPoint=function(t,e,n){return this.coordinateToPoint(t,e,n)},i.coordToPointAtRes=function(t,e,n){return this.coordinateToPointAtRes(t,e,n)},i.pointToCoord=function(t,e,n){return this.pointToCoordinate(t,e,n)},i.pointAtResToCoord=function(t,e,n){return this.pointAtResToCoordinate(t,e,n)},i.coordToViewPoint=function(t,e,n){return this.coordinateToViewPoint(t,e,n)},i.viewPointToCoord=function(t,e){return this.viewPointToCoordinate(t,e)},i.coordToContainerPoint=function(t,e,n){return this.coordinateToContainerPoint(t,e,n)},i.containerPointToCoord=function(t,e){return this.containerPointToCoordinate(t,e)},i.containerPointToViewPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._sub(this.getViewPoint())},i.viewPointToContainerPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._add(this.getViewPoint())},i.checkSize=function(t){var e=at()-this._initTime<1500&&this.width===0||this.height===0,n=this._getContainerDomSize(),o=this.height,h=this.width;if(!t&&n.width===h&&n.height===o)return this;fr(this._containerDOM);var u=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(n);else{var l=this._getVisualHeight(this.getPitch()),f=new E(0,this.height-l),c=this._containerPointToPrj(f);this._updateMapSize(n);var d=this._getVisualHeight(this.getPitch()),g=new E(0,this.height-d);this._setPrjCoordAtContainerPoint(c,g),this._mapViewCoord=this._getPrjCenter()}var v=n.width===0||n.height===0||h===0||o===0;return(e||v)&&(this._eventSilence=!0,this.setCenter(u),delete this._eventSilence),this._fireEvent("resize"),this},i.locate=function(t,e,n){return this.getProjection()._locate(new L(t),e,n)},i.getMainPanel=function(){return this._getRenderer().getMainPanel()},i.getPanels=function(){return this._panels},i.remove=function(){var t=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var e=this.getLayers(),n=0;n<e.length;n++)e[n].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter(function(o){return o.className==="maptalks-wrapper"}).forEach(function(o){return t._containerDOM.removeChild(o)}),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),this},i.isRemoved=function(){return!this._containerDOM},i.isMoving=function(){return!!this._moving},i.onMoveStart=function(t){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var e=this._getPrjCenter();(!this._originCenter||this._verifyExtent(e))&&(this._originCenter=e),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},i.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving"))},i.onMoveEnd=function(t){if(this._moving=!1,this._suppressRecenter||this._recenterOnTerrain(),this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),!this._verifyExtent(this._getPrjCenter())&&this._originCenter){var e=this._originCenter;this._panTo(e)}},i.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},i.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},i.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},i.isDragRotating=function(){return!!this._dragRotating},i.isOffscreen=function(t,e){e===void 0&&(e=0);var n=this.width,o=this.height,h=n+e,u=o+e,l=t.xmin,f=t.ymin,c=t.xmax,d=t.ymax;return Array.isArray(t)&&(l=t[0],f=t[1],c=t[2],d=t[3]),c<e||l>=h||d<e||f>u},i.getRenderer=function(){return this._getRenderer()},i.getDevicePixelRatio=function(){return this.options.devicePixelRatio||q.devicePixelRatio||1},i.setDevicePixelRatio=function(t){return H(t)&&t>0&&t!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=t,this.checkSize(!0)),this},i._initContainer=function(t){if(tt(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,bt&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&this._containerDOM.childNodes[0].className==="maptalks-wrapper")throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},i._trySetCursor=function(t){return!this._cursor&&!this._priorityCursor&&(t||(t="default"),this._setCursorToPanel(t)),this},i._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},i._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},i._removeLayer=function(t,e){if(!(!t||!e)){var n=e.indexOf(t);n>-1&&e.splice(n,1)}},i._sortLayersByZIndex=function(){if(this._layers){for(var t=0,e=this._layers.length;t<e;t++)this._layers[t]._order=t,this._layers[t].sortLayersByZIndex&&this._layers[t].sortLayersByZIndex();this._layers.sort(function(n,o){var h=n.getZIndex()-o.getZIndex();return h===0?n._order-o._order:h})}},i._fireEvent=function(t,e){if(!this._eventSilence){var n="_";t[0]!==n&&this.fire(n+t,e),this.fire(t,e)}},i._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=at()},i._initRenderer=function(){var t=this.options.renderer,e=a.getRendererClass(t);this._renderer=new e(this),this._renderer.load()},i._getRenderer=function(){return this._renderer},i._loadAllLayers=function(){function t(e){e&&e.load()}this._baseLayer&&this._baseLayer.load(),this._eachLayer(t,this.getLayers())},i._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,n=[],o=0;o<e.length;o++)(!t||t.call(this,e[o]))&&n.push(e[o]);return n},i._eachLayer=function(t){if(!(arguments.length<2)){var e=Array.prototype.slice.call(arguments,1);e&&!Array.isArray(e)&&(e=[e]);for(var n=[],o=0,h=e.length;o<h;o++)n=n.concat(e[o]);for(var u=0,l=n.length;u<l;u++)t.call(t,n[u])}},i._onLayerEvent=function(t){t&&t.type==="idchange"&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},i._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),n=this._spatialReference.getMaxZoom(),o=this._spatialReference.getMinZoom();(P(t)||t===-1||t>n)&&this.setMaxZoom(n),(P(e)||e===-1||e<o)&&this.setMinZoom(o),t=this.getMaxZoom(),e=this.getMinZoom(),t<e&&this.setMaxZoom(e),(P(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter,delete this._glRes;var h=this.getProjection();this._prjCenter=h.project(this._center),this._prjCenter.z=this._center.z,this._calcMatrices();var u=this._getRenderer();u&&u.resetContainer()},i._getContainerDomSize=function(){if(!this._containerDOM)return null;var t=this._containerDOM,e,n;if(this._containerDomContentRect)return e=this._containerDomContentRect.width,n=this._containerDomContentRect.height,new xt(e,n);if(!P(t.width)&&!P(t.height)){e=t.width,n=t.height;var o=this.getDevicePixelRatio();o!==1&&t.layer&&(e/=o,n/=o)}else if(!P(t.clientWidth)&&!P(t.clientHeight))e=parseInt(t.clientWidth,0),n=parseInt(t.clientHeight,0);else throw new Error("can not get size of container");return new xt(e,n)},i._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},i._getPrjCenter=function(){return this._prjCenter},i._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},i._setPrjCoordAtContainerPoint=function(t,e){if(!this.centerAltitude&&e.x===this.width/2&&e.y===this.height/2)return this;var n=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),o=this._pointToPrj(this._prjToPoint(t).sub(n));return this._setPrjCenter(o),this},i._setPrjCoordAtOffsetToCenter=function(t,e){var n=this._pointToPrj(this._prjToPoint(t).sub(e));return this._setPrjCenter(n),this},i._verifyExtent=function(t){if(!t)return!1;var e=this._prjMaxExtent;return e?e.contains(t):!0},i._offsetCenterByPixel=function(t){var e=jo.set(this.width/2-t.x,this.height/2-t.y),n=this._containerPointToPrj(e,Vu),o=jo.set(this.width/2,this.height/2);this._setPrjCoordAtContainerPoint(n,o)},i.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this):this._mapViewPoint},i.getViewPoint=function(){var t=this._getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},i._resetMapViewPoint=function(){this._mapViewPoint=new E(0,0),this._mapViewCoord=this._getPrjCenter()},i._getResolution=function(t){return(t===void 0||t===this._zoomLevel)&&this._mapRes!==void 0?this._mapRes:(P(t)&&(t=this._zoomLevel),this._spatialReference.getResolution(t))},i._getResolutions=function(){return this._spatialReference.getResolutions()},i._prjToPoint=function(t,e,n){e=P(e)?this.getZoom():e;var o=this._getResolution(e);return this._prjToPointAtRes(t,o,n)},i._prjToPointAtRes=function(t,e,n){return this._spatialReference.getTransformation().transform(t,e,n)},i._prjsToPointsAtRes=function(t,e,n){n===void 0&&(n=[]);for(var o=this._spatialReference.getTransformation(),h=[],u=0,l=t.length;u<l;u++){var f=o.transform(t[u],e,n[u]);h.push(f)}return h},i._pointToPrj=function(t,e,n){e=P(e)?this.getZoom():e;var o=this._getResolution(e);return this._pointToPrjAtRes(t,o,n)},i._pointToPrjAtRes=function(t,e,n){return this._spatialReference.getTransformation().untransform(t,e,n)},i._pointToPoint=function(t,e,n){return P(e)?(n?(n.x=t.x,n.y=t.y):n=t.copy(),n):this._pointAtResToPoint(t,this._getResolution(e),n)},i._pointAtResToPoint=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(e/this._getResolution())},i._pointToPointAtRes=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(this._getResolution()/e)},i._containerPointToPrj=function(t,e){return this._pointToPrj(this._containerPointToPoint(t,void 0,e),void 0,e)},i._callOnLoadHooks=function(){var t=a.prototype;if(t._onLoadHooks)for(var e=0,n=t._onLoadHooks.length;e<n;e++)t._onLoadHooks[e].call(this)},i._fixPrjOnWorldWide=function(t){var e=this.getProjection();if(e&&e.fullExtent&&t){var n=e.fullExtent||{},o=n.left,h=n.bottom,u=n.top,l=n.right;H(o)&&(t.x=Math.max(o,t.x)),H(l)&&(t.x=Math.min(l,t.x)),H(h)&&(t.y=Math.max(h,t.y)),H(u)&&(t.y=Math.min(u,t.y))}return this},a}(os(le(cs(Bt))));$.include({coordinateToPoint:function(a,i,r){var t=this._getResolution(i);return this.coordinateToPointAtRes(a,t,r)},coordinateToPointAtRes:function(){var s=new L(0,0);return function(a,i,r){var t=this.getProjection().project(a,s);return this._prjToPointAtRes(t,i,r)}}(),pointToCoordinate:function(){var s=new L(0,0);return function(a,i,r){var t=this._pointToPrj(a,i,s);return this.getProjection().unproject(t,r)}}(),pointAtResToCoordinate:function(){var s=new L(0,0);return function(a,i,r){var t=this._pointToPrjAtRes(a,i,s);return this.getProjection().unproject(t,r)}}(),coordinateToViewPoint:function(){var s=new L(0,0);return function(a,i,r){return this._prjToViewPoint(this.getProjection().project(a,s),i,r)}}(),viewPointToCoordinate:function(){var s=new L(0,0);return function(a,i){return this.getProjection().unproject(this._viewPointToPrj(a,s),i)}}(),coordinateToContainerPoint:function(a,i,r){var t=this._getResolution(i);return this.coordinateToContainerPointAtRes(a,t,r)},coordinateToContainerPointAtRes:function(){var s=new L(0,0);return function(a,i,r){var t=this.getProjection().project(a,s);return this._prjToContainerPointAtRes(t,i,r)}}(),coordinatesToContainerPoints:function(a,i){var r=this._getResolution(i);return this.coordinatesToContainerPointsAtRes(a,r)},coordinatesToContainerPointsAtRes:function(){return function(s,a){for(var i=[],r=this._spatialReference.getTransformation(),t=a/this._getResolution(),e=this.getProjection(),n=new L(0,0),o=this.isTransforming(),h=this._prjToPoint(this._getPrjCenter(),void 0,Vu),u=0,l=s.length;u<l;u++){var f=e.project(s[u],n),c=r.transform(f,a);c=c._multi(t),this._toContainerPoint(c,o,s[u].z,h),i.push(c)}return i}}(),containerPointToCoordinate:function(){var s=new L(0,0);return function(a,i){var r=this._containerPointToPrj(a,s);return this.getProjection().unproject(r,i)}}(),containerToExtent:function(){var s=new E(0,0),a=new E(0,0);return function(i){var r=new Q(this._containerPointToPoint(i.getMin(s),void 0,s),this._containerPointToPoint(i.getMax(a),void 0,a));return this._pointToExtent(r)}}(),distanceToPixel:function(){var s=new E(0,0),a=new E(0,0);return function(i,r,t){var e=this.getProjection();if(!e)return null;var n=this.getScale()/this.getScale(t),o=this.getCenter(),h=e.locate(o,i,r),u=this.coordToContainerPoint(o,void 0,s),l=this.coordToContainerPoint(h,void 0,a);return l._sub(u)._multi(n)._abs(),new xt(l.x,l.y)}}(),distanceToPoint:function(a,i,r,t){var e=this._getResolution(r);return this.distanceToPointAtRes(a,i,e,t)},distanceToPointAtRes:function(){var s=new E(0,0),a=new L(0,0);return function(i,r,t,e,n){var o=this.getProjection();if(!o)return null;var h=e||this.getCenter(),u=o.locate(h,i,r,a),l=this.coordToPointAtRes(h,t,s),f=this.coordToPointAtRes(u,t,n);return f._sub(l)._abs(),f}}(),altitudeToPoint:function(){var s=new L(0,40),a=new E(0,0);return function(i,r,t){i===void 0&&(i=0),this._altitudeOriginDirty&&(s.x=this._originLng,this._altitudeOriginDirty=!1);var e=this.distanceToPointAtRes(i,i,r,t||s,a);i<0&&e.x>0&&(e.x=-e.x);var n=this.options.heightFactor;return n&&n!==1&&(e.x*=n,e.y*=n),e.x}}(),pointAtResToAltitude:function(){var s=new L(0,40);return function(a,i,r){a===void 0&&(a=0);var t=this.pointAtResToDistance(a,0,i,r||s);return t}}(),pixelToDistance:function(){var s=new L(0,0),a=new L(0,0),i=new L(0,0),r=new L(0,0);return function(t,e){var n=this.getProjection();if(!n)return null;var o=this.getFullExtent(),h=o.top>o.bottom?-1:1,u=s.set(this.width/2,this.height/2),l=a.set(this.width/2+t,this.height/2+h*e),f=this.containerPointToCoord(u,i),c=this.containerPointToCoord(l,r);return n.measureLength(f,c)}}(),pointToDistance:function(a,i,r){var t=this.getResolution(r);return this.pointAtResToDistance(a,i,t)},pointAtResToDistance:function(){var s=new E(0,0),a=new L(0,0),i=new L(0,0),r=new L(0,0);return function(t,e,n,o){var h=this.getProjection();if(!h)return null;var u=o?h.project(o,a):this._getPrjCenter(),l=this._prjToPointAtRes(u,n,s);l._add(t,e);var f=this.pointAtResToCoord(l,n,i),c=o||h.unproject(u,r);return h.measureLength(c,f)}}(),locateByPoint:function(){var s=new E(0,0);return function(a,i,r){var t=this.coordToContainerPoint(a,void 0,s);return this.containerPointToCoord(t._add(i,r))}}(),_get2DExtent:function(a,i){var r;if((a===void 0||a===this._zoomLevel)&&this._mapExtent2D&&(r=this._mapExtent2D),r)return i?(i.set(r.xmin,r.ymin,r.xmax,r.ymax),i):r.copy();var t=this._getResolution(a);return this._get2DExtentAtRes(t,i)},_get2DExtentAtRes:function(){var s=new E(0,0);return function(a,i){var r=this;if(a===this._mapGlRes&&this._mapGlExtent2D)return this._mapGlExtent2D;var t=this.getContainerExtent();return t.convertTo(function(e){return r._containerPointToPointAtRes(e,a,s)},i)}}(),_pointToExtent:function(){var s=new L(0,0),a=new L(0,0);return function(i){var r=i.getMin(),t=i.getMax(),e=this.getFullExtent(),n=!e||e.left<=e.right?[r.x,t.x]:[t.x,r.x],o=n[0],h=n[1],u=!e||e.top>e.bottom?[t.y,r.y]:[r.y,t.y],l=u[0],f=u[1],c=r.set(o,f),d=t.set(h,l);return new ft(this.pointToCoord(c,void 0,s),this.pointToCoord(d,void 0,a),this.getProjection())}}(),_getViewPointFrameOffset:function(){var s=new E(0,0);return function(){if(this.isZooming())return null;var a=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(a)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(a,void 0,s)):null}}(),_viewPointToPrj:function(){var s=new E(0,0);return function(a,i){return this._containerPointToPrj(this.viewPointToContainerPoint(a,s),i)}}(),_prjToContainerPoint:function(a,i,r,t){var e=this._getResolution(i);return this._prjToContainerPointAtRes(a,e,r,t)},_prjToContainerPointAtRes:function(){var s=new E(0,0);return function(a,i,r,t){return this._pointAtResToContainerPoint(this._prjToPointAtRes(a,i,s),i,t||0,r)}}(),_prjToViewPoint:function(){var s=new E(0,0);return function(a,i,r){var t=this._prjToContainerPoint(a,void 0,s,r);return this.containerPointToViewPoint(t,i)}}(),_viewPointToPoint:function(){var s=new E(0,0);return function(a,i,r){return this._containerPointToPoint(this.viewPointToContainerPoint(a,s),i,r)}}(),_pointToViewPoint:function(){var s=new L(0,0);return function(a,i,r){return this._prjToViewPoint(this._pointToPrj(a,i,s),r)}}()});$.mergeOptions(hd);var ud=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},i.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},i._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var n=e.getZoom(),o=t.domEvent.shiftKey?Math.ceil(n)-1:Math.floor(n)+1;e._zoomAnimation(o,t.containerPoint)}},a}(ae);$.mergeOptions({doubleClickZoom:!0});$.addOnLoadHook("addHandler","doubleClickZoom",ud);var ld=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){var t=this.target;if(t){var e=t._panels.mapWrapper||t._containerDOM;this._dragHandler=new gr(e,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},i.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},i._cancelOn=function(t){return!!(this.target.isZooming()||this._ignore(t))},i._ignore=function(t){return t?(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t)||this.target._isEventOutMap(t)):!1},i._onMouseDown=function(t){delete this.startDragTime,delete this._mode;var e=this.target.options.switchDragButton,n=e?0:2,o=t.domEvent.type==="touchstart",h=e&&o||t.domEvent.button===n||t.domEvent.ctrlKey;h?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),ue(t.domEvent)},i._onDragStart=function(t){this.startDragTime=at(),this._mode==="move"?this._moveStart(t):this._mode==="rotatePitch"&&this._rotateStart(t)},i._onDragging=function(t){var e=this.target;e._isEventOutMap(t.domEvent)||(this._mode==="move"?this._moving(t):this._mode==="rotatePitch"&&this._rotating(t))},i._onDragEnd=function(t){this._mode==="move"?this._moveEnd(t):this._mode==="rotatePitch"&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},i._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},i._moveStart=function(t){this._start(t);var e=this.target;e.onMoveStart(t);var n=Ht(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=this._containerPointToPrj(n)},i._moving=function(t){if(this.startDragTime){var e=this.target,n=Ht(e._getActualEvent(t.domEvent),e.getContainer()),o=e._prjToPoint(this._containerPointToPrj(n)),h=o._sub(e._prjToPoint(e._getPrjCenter()));e._setPrjCoordAtOffsetToCenter(this.startPrjCoord,h),e.onMoving(t)}},i._containerPointToPrj=function(t){var e=this.target,n=e._queryTerrainInfo(t);if(n){var o=e.getProjection().project(n.coordinate);return o.z=n.altitude,o}return e._containerPointToPrj(t)},i._moveEnd=function(t){if(this.startDragTime){var e=t.domEvent.type==="touchend",n=this.target,o=at()-this.startDragTime,h=t.mousePos.x,u=t.mousePos.y,l=h-this.startX,f=u-this.startY,c=n._getPrjCenter(),d=c.sub(this._startPrjCenter);if(this._clear(),n.options.panAnimation&&!t.interupted&&n._verifyExtent(n._getPrjCenter())&&o<280&&Math.abs(f)+Math.abs(l)>5){o=5*o;var g=e?5:2.8,v=c.add(d._multi(g));n._panTo(v,{duration:e?o*3:o*2,easing:"outExpo"})}else n.onMoveEnd(t)}},i._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},i._rotating=function(t){var e=this.target,n=t.mousePos.x,o=t.mousePos.y,h=e.getPitch(),u=e.getBearing(),l=Math.abs(n-this.preX),f=Math.abs(o-this.preY);if(this._rotateMode||(e.options.dragRotatePitch?this._rotateMode="rotate_pitch":l>f?this._rotateMode="rotate":l<f?this._rotateMode="pitch":this._rotateMode="rotate"),!(this._rotateMode==="pitch"&&h===0&&f<10)){if(this._rotateMode.indexOf("rotate")>=0&&e.options.dragRotate){var c=.15,d=0;e.options.dragPitch||l>f?d=-c*(this.preX-n):n>e.width/2?d=c*(this.preY-o):d=-c*(this.preY-o);var g=e.getBearing()+d;this._db=this._db||0,this._db+=d,e._setBearing(g)}this._rotateMode.indexOf("pitch")>=0&&e.options.dragPitch&&e._setPitch(e.getPitch()+(this.preY-o)*.15),this.preX=n,this.preY=o,(e.getBearing()!==u||e.getPitch()!==h)&&e.onDragRotating(t)}},i._rotateEnd=function(t){var e=this.target,n=e.getBearing();this._clear();var o=at()-this.startDragTime;if(e.onDragRotateEnd(t),e.options.rotateAnimation&&Math.abs(n-this.startBearing)>20&&(this._rotateMode==="rotate"||this._rotateMode==="rotate_pitch")&&!t.interupted&&o<400){var h=e.getBearing();e._animateTo({bearing:h+this._db/1.5},{easing:"outQuint",duration:1600})}},i._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},a}(ae);$.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0});$.addOnLoadHook("addHandler","draggable",ld);var Fo="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend mouseout",fd={mousemove:["mousemove","mouseover","mouseout","mouseenter"],touchend:["touchend","click"]},br=function(a){return a&&a.getLayer&&a.on&&a.fire},Ho=function(a){return a._getInternalId?a._getInternalId():a.getId?a.getId():null},oi=function(a,i,r){if(a._onEvent)return a._onEvent(i,r);var t=a.getLayer();return t&&t.fireGeoEvent?t.fireGeoEvent(a,i,r):null},cd=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;gt(e,Fo,this._identifyGeometryEvents,this)},i.removeHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;_t(e,Fo,this._identifyGeometryEvents)},i._identifyGeometryEvents=function(t,e){var n=this.target;if(n.isInteracting()||n._ignoreEvent(t))return;var o=null,h=e||t.type;if(ir(h)&&!Qt.isTest&&ns(this,n.options.mousemoveThrottleTime)){jt(t);return}var u=h==="mousedown"||h==="touchstart"&&t.touches&&t.touches.length===1;if(u)this._mouseDownTime=at();else if((h==="click"||h==="touchend")&&this._mouseDownTime){var l=this._mouseDownTime;delete this._mouseDownTime;var f=at();if(f-l>300){if(h==="click")return}else h==="touchend"&&(o="click")}var c=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(!c)return;var d=Ht(c,n._containerDOM);h==="touchstart"&&n.options.preventTouch&&ue(t);for(var g=null,v=this.target.getRenderer().getTopElements(),m=u&&t.button!==2,_=0;_<v.length;_++)if(v[_].hitTest(d)){var p=v[_].options.cursor;if(p&&(g=p),m||v[_].events&&v[_].events.indexOf(h)>=0){var y={target:n,type:h,domEvent:t,containerPoint:d};if(m){n._setPriorityCursor(g),v[_].mousedown(y);return}else v[_].onEvent(y)}}var w=n._getLayers(function(T){return!!(T.identify&&T.options.geometryEvents)});if(!w.length)return;var C=fd[h]||[h],x={includeInternals:!0,filter:function(b){if(b instanceof ot){var D=b._getEventTypeToFire(t);return h==="mousemove"?(!g&&b.options.cursor&&(g=b.options.cursor),!0):!(!b.listens(D)&&!b.listens(o))}else if(br(b))return!0;return!1},count:1,onlyVisible:n.options.onlyVisibleGeometryEvents,containerPoint:d,layers:w,eventTypes:C,domEvent:t},M=S.bind(this);ir(h)?this._queryIdentifyTimeout=n.getRenderer().callInNextFrame(function(){n.isInteracting()||n.identifyAtPoint(x,M)}):n.identifyAtPoint(x,M);function S(T){var b=this,D=!0,R=function(){var J=b._prevOverGeos&&b._prevOverGeos.geos;return J||[]},k=function(J,ht){if(J===void 0&&(J=[]),ht===void 0&&(ht={}),J&&J.length>0)for(var Y=J.length-1;Y>=0;Y--){var X=J[Y];if(br(X)){var et=Ho(J[Y]);ht[et]||(D=oi(X,t,"mouseout"))}}};if(h==="mouseout"){var O=R();this._prevOverGeos={geos:[],geomap:{}},k(O,{})}else if(h==="mousemove"){var A={};if(T.length>0)for(var j=T.length-1;j>=0;j--){var G=T[j];if(br(G)){var N=Ho(G);A[N]=G,oi(G,t),(!this._prevOverGeos||!this._prevOverGeos.geomap[N])&&oi(G,t,"mouseenter"),D=oi(G,t,"mouseover")}}n._setPriorityCursor(g);var B=R();this._prevOverGeos={geos:T,geomap:A},k(B,A)}else{if(!T||!T.length)return;for(var Z=T.length-1;Z>=0;Z--)if(br(T[Z])){D=oi(T[Z],t),o&&oi(T[Z],t,o);break}}D===!1&&jt(t)}},a}(ae);$.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0});$.addOnLoadHook("addHandler","geometryEvents",cd);var No=4.000244140625,dd=1/100,gd=1/450,vd=2,md=function(s){z(a,s);function a(r){var t;return t=s.call(this,r)||this,t._thisScrollZoom=t._scrollZoom.bind(mt(mt(t))),t._wheelZoomRate=gd,t._defaultZoomRate=dd,t._delta=0,t}var i=a.prototype;return i.addHooks=function(){Xt(this.target._containerDOM,"wheel",this._onWheelScroll,this)},i.removeHooks=function(){De(this.target._containerDOM,"wheel",this._onWheelScroll)},i._onWheelScroll=function(t){var e=this.target;if(e.options.preventWheelScroll&&(ue(t),jt(t)),e._ignoreEvent(t)||e._isEventOutMap(t)||!e.options.zoomable)return!1;var n=e._containerDOM,o=e._checkZoomOrigin(Ht(t,n));return e.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(t,o)):this._interval(t,o)},i._seamless=function(t,e){var n=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?t.deltaY*60:t.deltaY;if(n%No!==0&&(this._ensureTrackpad||(Math.abs(n)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(n*=14)),t.shiftKey&&n&&(n=n/4),this._lastWheelEvent=t,this._delta-=n,!this._zooming&&this._delta){var o=this.target;this._zoomOrigin=e,o.onZoomStart(null,e)}this._start()},i._start=function(){if(this._delta){this._zooming=!0;var t=this.target;this._active||(t.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0)}},i._scrollZoom=function(){var t=this;if(this._active=!1,!!this._delta){var e=Math.abs(this._delta)>No?this._wheelZoomRate:this._defaultZoomRate,n=vd/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&n!==0&&(n=1/n);var o=this.target,h=o.getZoom(),u=o.getZoomForScale(n,h,!0);this._delta=0,o.onZooming(u,this._zoomOrigin),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){t._zooming=!1,delete t._timeout,o.onZoomEnd(o.getZoom(),t._zoomOrigin)},210)}},i._interval=function(t,e){var n=this,o=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var h=(t.deltaY?t.deltaY*-1:t.wheelDelta?t.wheelDelta:t.detail)>0?1:-1;t.detail&&(h*=-1);var u=o.getZoom(),l=u+h;if(l=o._checkZoom(h>0?Math.ceil(l):Math.floor(l)),l===u)return!1;this._zooming=!0,this._delta||(o.onZoomStart(null,e),this._origin=e,this._delta=h,this._startZoom=o.getZoom());var f=90;return o._animateTo({zoom:l-this._delta*1/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:f,wheelZoom:!0},function(c){if(c.state.playState!=="finished"){c.state.playState!=="running"&&(delete n._zooming,delete n._requesting);return}n._requesting<1||Math.abs(l-n._startZoom)>2||l===o.getMaxZoom()||l===o.getMinZoom()?(o._animateTo({zoom:l,around:n._origin},{continueOnViewChanged:!0,duration:100},function(d){d.state.playState!=="running"&&(delete n._zooming,delete n._requesting)}),delete n._startZoom,delete n._origin,delete n._delta,n._requesting=0):P(n._requesting)||(delete n._zooming,n._onWheelScroll(t))}),!1},a}(ae);$.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0});$.addOnLoadHook("addHandler","scrollWheelZoom",md);var _d=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){Xt(this.target.getContainer(),"touchstart",this._onTouchStart,this)},i.removeHooks=function(){De(this.target.getContainer(),"touchstart",this._onTouchStart)},i._onTouchStart=function(t){var e=this.target;if(!(!t.touches||t.touches.length<2)){var n=e.getContainer(),o=Ht(t.touches[0],n),h=Ht(t.touches[1],n);this.preY=o.y,this._startP1=o,this._startP2=h,this._startDist=o.distanceTo(h),this._startVector=o.sub(h),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),_t(document,"touchmove",this._onTouchMove),_t(document,"touchend",this._onTouchEnd),Xt(document,"touchmove",this._onTouchMove,this),Xt(document,"touchend",this._onTouchEnd,this),e.options.preventTouch&&ue(t),e._fireEvent("touchactstart")}},i._onTouchMove=function(t){var e=this.target;if(!(!t.touches||t.touches.length<2)){var n=e.getContainer(),o=Ht(t.touches[0],n),h=Ht(t.touches[1],n),u=o.sub(this._startP1),l=h.sub(this._startP2),f=o.sub(h),c=o.distanceTo(h)/this._startDist,d=f.angleWith(this._startVector)*180/Math.PI,g=this.preY||o.y,v=(g-o.y)*.4;this.preY=o.y;var m={domEvent:t,mousePos:[o,h]};if(this.mode||(e.options.touchRotate&&Math.abs(d)>8?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&u.y*l.y>0&&Math.abs(u.y)>10&&Math.abs(l.y)>10?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&Math.abs(1-c)>.15&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(m)),this.mode==="zoom"||this.mode==="rotate_zoom"){this._scale=c;var _=e._getResolution(this._startZoom)/c,p=e.getZoomFromRes(_);e.onZooming(p,this._Origin)}this.mode==="rotate"||this.mode==="rotate_zoom"?(e._setBearing(this._startBearing+d),e.onDragRotating(m)):this.mode==="pitch"&&(e._setPitch(e.getPitch()+v),e.onDragRotating(m)),e._fireEvent("touchactinging")}},i._startTouching=function(t){var e=this.target;if(this.mode==="zoom"||this.mode==="rotate_zoom"){var n=e.getSize();this._Origin=new E(n.width/2,n.height/2),e.onZoomStart(null,this._Origin)}(this.mode==="rotate"||this.mode==="pitch"||this.mode==="rotate_zoom")&&e.onDragRotateStart(t)},i._onTouchEnd=function(t){delete this.preY;var e=this.target;if(_t(document,"touchmove",this._onTouchMove),_t(document,"touchend",this._onTouchEnd),this.mode==="zoom"||this.mode==="rotate_zoom"){var n=this._scale,o=e._getResolution(this._startZoom)/n,h=e.getZoomFromRes(o);e.onZoomEnd(h,this._Origin)}(this.mode==="pitch"||this.mode==="rotate"||this.mode==="rotate_zoom")&&e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},a}(ae);$.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1});$.addOnLoadHook("addHandler","touchGesture",_d);var Er="__anim_player",Ve={outExpo:function(a){return a===1?1:1-Math.pow(2,-10*a)},outQuint:function(a){return 1-Math.pow(1-a,5)},in:function(a){return Math.pow(a,2)},out:function(a){return 1-Ve.in(1-a)},inAndOut:function(a){return 3*a*a-2*a*a*a},linear:function(a){return a},upAndDown:function(a){return a<.5?Ve.inAndOut(2*a):1-Ve.inAndOut(2*(a-.5))}},Uu=function(){function s(a,i){this.state=a,this.styles=i}return sf(s,[{key:"playState",get:function(){return this.state.playState}},{key:"symbol",get:function(){return this.styles.symbol}}]),s}(),Cs=function(a,i,r,t){this._animation=a,this.options=i,this._onFrame=r,this.playState="idle",this.ready=!0,this.finished=!1,this.target=t},Et={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(a){if(!a)return null;function i(f){if(!Array.isArray(f))return Et._resolveStyles(f);for(var c=[],d=[],g=[],v=0;v<f.length;v++){var m=Et._resolveStyles(f[v]);m&&(c.push(m[0]),d.push(m[1]),g.push(m[2]))}return c.length?[c,d,g]:null}function r(f){var c=f,d;Array.isArray(f)||(H(f)?c=[0,f]:f instanceof E||f instanceof L?(d=f.constructor,c=[new d(0,0),f]):c=[f,f]);var g=c[0],v=c[1];return H(g)&&H(v)?g===v?null:[g,v-g,v]:Array.isArray(g)&&H(g[0])||g instanceof L||g instanceof E?(Array.isArray(g)?(g=new L(g),v=new L(v)):(d=g.constructor,g=new d(g),v=new d(v)),g.equals(v)?null:[g,v.sub(g),v]):[g,v,v]}function t(f){return!Array.isArray(f)&&f.constructor===Object?!0:!!(Array.isArray(f)&&f[0].constructor===Object)}var e={},n={},o={};for(var h in a)if(a.hasOwnProperty(h)){var u=a[h];if(u){if(Array.isArray(u)&&(P(u[0])||P(u[1])))continue}else continue;var l=void 0;t(u)?l=i(u):l=r(u),l&&(n[h]=l[0],e[h]=l[1],o[h]=l[2])}return[n,e,o]},framing:function(a,i){i||(i={});var r=i.easing?Ve[i.easing]:Ve.linear;r||(r=Ve.linear);var t,e,n;a=Et._resolveStyles(a),a&&(e=a[0],t=a[1],n=a[2]);var o=function h(u,l,f){if(!l||!f)return null;var c={};for(var d in f)if(f.hasOwnProperty(d)){if(l[d]===n[d]){c[d]=l[d];continue}var g=l[d],v=f[d];if(H(v))c[d]=g+u*v;else if(Array.isArray(v)){for(var m=[],_=0;_<v.length;_++)m.push(h(u,g[_],v[_]));c[d]=m}else{var p=v.constructor;p===Object?c[d]=h(u,g,v):g instanceof E||g instanceof L?c[d]=g.add(v.multi(u)):c[d]=v}}return c};return function(h,u){var l,f;if(h<0)l={playState:"idle",delta:0},f=e;else if(h<u){var c=r(h/u);l={playState:"running",delta:c},f=o(c,e,t)}else l={playState:"finished",delta:1},f=n;return l.startStyles=e,l.destStyles=n,l.progress=h,l.remainingMs=u-h,new Uu(l,f)}},_requestAnimFrame:function(a){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(a),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=ve(Et._frameFn))},_run:function(){if(this._frameQueue.length){var a=this._frameQueue;this._frameQueue=[];for(var i=0,r=a.length;i<r;i++)a[i]();this._frameQueue.length?this._animationFrameId=ve(Et._frameFn):delete this._animationFrameId}},animate:function(a,i,r,t){i||(i={});var e=Et.framing(a,i),n=new Cs(e,i,r,t);return n}};Et._frameFn=Et._run.bind(Et);F(Cs.prototype,{_prepare:function(){var a=this.options,i=a.speed||a.duration;tt(i)&&(i=Et.speed[i],i||(i=+i)),i||(i=Et.speed.normal),this.duration=i,this._framer=a.framer||Et._requestAnimFrame.bind(Et)},play:function(){if(this.playState!=="idle"&&this.playState!=="paused"||this.target&&this.target[Er])return this;this.target&&(this.target[Er]=1),this.playState==="idle"&&(this.currentTime=0,this._prepare());var a=at();if(!this.startTime){var i=this.options;this.startTime=i.startTime?i.startTime:a}return this._playStartTime=Math.max(a,this.startTime),this.playState==="paused"&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return this.playState==="paused"?this:(this.playState="paused",this._run(),this)},cancel:function(){return this.playState==="idle"?this:(this.playState="idle",this.finished=!1,this._run(),this)},finish:function(){return this.playState==="finished"?this:(this.playState="finished",this.finished=!0,this._run(),this)},reverse:function(){},_run:function(){var a=this,i=this._onFrame,r=at(),t=r-this._playStartTime;if(this.options.repeat&&t>=this.duration&&(this._playStartTime=r,t=0),this.playState!=="running"){if(this.target&&delete this.target[Er],i){this.playState==="finished"?t=this.duration:this.playState==="idle"&&(t=0);var e=this._animation(t,this.duration);e.state.playState=this.playState,i(e)}return}var n=this._animation(t,this.duration);this.playState=n.state.playState,this.playState!=="running"&&this.target&&delete this.target[Er],this.playState==="idle"?this.startTime>r&&setTimeout(this._run.bind(this),this.startTime-r):this.playState==="running"?this._framer(function(){a.playState==="running"&&(a.currentTime=t,i&&i(n),a._run())}):this.playState==="finished"&&(this.finished=!0,i&&i(n))}});var pd=Et.animate,Nv=Object.freeze({Animation:Et,Easing:Ve,Player:Cs,Frame:Uu,animate:pd}),yd={smoothness:0,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}},Pn=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.animateShow=function(t,e){var n=this;t===void 0&&(t={}),this._showPlayer&&this._showPlayer.finish(),it(t)&&(t={},e=t);var o=this.getCoordinates();if(o.length===0)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var h=!!this.getShell,u=h?this.getShell().concat(this.getShell()[0]):o,l=this._getProjection(),f=l.projectCoords(u,this.options.antiMeridian);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=l.unproject(this._prjAniShowCenter);var c=t.duration||1e3,d=t.easing||"out";this.setCoordinates([]);var g=0;f.length&&(f[0]._distance=0);for(var v=1;v<f.length;v++){var m=f[v].distanceTo(f[v-1]);f[v]._distance=m,g+=m}this._tempCoord=new L(0,0),this._tempPrjCoord=new E(0,0);var _=this._showPlayer=Et.animate({t:c},{duration:c,easing:d},function(p){if(!n.getMap()){if(_.playState!=="finished"&&(_.finish(),e)){var y=n.getCoordinates();e(p,y[y.length-1])}return}var w=n._drawAnimShowFrame(p.styles.t,c,g,u,f);p.state.playState==="finished"&&(delete n._showPlayer,delete n._aniShowCenter,delete n._prjAniShowCenter,delete n._animIdx,delete n._animLenSoFar,delete n._animTailRatio,delete n._tempCoord,delete n._tempPrjCoord,n.setCoordinates(o)),e&&e(p,w)},this);return _.play(),_},i._drawAnimShowFrame=function(t,e,n,o,h){if(t===0)return o[0];var u=t/e*n,l=0,f,c;for(f=this._animIdx+1,c=h.length;f<c&&(l=h[f]._distance,!(this._animLenSoFar+l>u));f++)this._animLenSoFar+=l;if(this._animIdx=f-1,this._animIdx>=c-1)return this.setCoordinates(o),o[o.length-1];var d=this._animIdx,g=h[d],v=h[d+1],m=u-this._animLenSoFar,_=m/l;this._animTailRatio=_;var p=g.x+(v.x-g.x)*_,y=g.y+(v.y-g.y)*_;this._tempPrjCoord.x=p,this._tempPrjCoord.y=y;var w=this._tempPrjCoord,C=o[d],x=o[d+1],M=C.x+(x.x-C.x)*_,S=C.y+(x.y-C.y)*_;this._tempCoord.x=M,this._tempCoord.y=S;var T=this._tempCoord,b=!!this.getShell;if(!b&&this.options.smoothness>0){for(var D=[],R=[],k=0;k<=this._animIdx;k++)D.push(o[k]),R.push(h[k]);D.push(T,T),R.push(w,w),this.setCoordinates(D),this._setPrjCoordinates(R)}else{var O=o.slice(0,this._animIdx+1);O.push(T);var A=h.slice(0,this._animIdx+1);A.push(w),b?(this.setCoordinates([this._aniShowCenter].concat(O)),this._setPrjCoordinates([this._prjAniShowCenter].concat(A))):(this.setCoordinates(O),this._setPrjCoordinates(A))}return T},i._getCenterInExtent=function(t,e,n){var o=this.getExtent();if(!t.intersects(o))return null;var h=n(e,t);if(h.length===0)return null;var u=0,l=0,f=0;h.forEach(function(d){Array.isArray(d)?d.forEach(function(g){g.point&&(g=g.point),u+=g.x,l+=g.y,f++}):(d.point&&(d=d.point),u+=d.x,l+=d.y,f++)});var c=new L(u,l)._multi(1/f);return c.count=f,c},i._getPath2DPoints=function(t,e,n){if(!st(t))return[];var o=this.getMap(),h=!e&&this._shouldSimplify(),u=this.options.simplifyTolerance*o._getResolution(),l=Array.isArray(t[0]);if(delete this._simplified,h&&!l){var f=t.length;t=Fl(t,u,!1),this._simplified=t.length<f}if(n||(n=o._getResolution()),Array.isArray(t)){var c=[],d="_glPt";if(!Array.isArray(t[0]))return c=$i(t,d),o._prjsToPointsAtRes(t,n,c);for(var g=[],v=0,m=t.length;v<m;v++){var _=t[v];c=$i(_,d);var p=o._prjsToPointsAtRes(_,n,c);g.push(p)}return g}else return o._prjToPointAtRes(t,n)},i._shouldSimplify=function(){var t=this.getLayer(),e=t.options.enableAltitude;return t&&t.options.enableSimplify&&!e&&this.options.enableSimplify&&!this._showPlayer},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},i._updateCache=function(){this._clearCache();var t=this._getProjection();t&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},i._clearProjection=function(){this._prjCoords=null,s.prototype._clearProjection.call(this)},i._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t,this.options.antiMeridian):[]},i._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},i._computeCenter=function(){var t=this._coordinates;if(!st(t))return null;for(var e=0,n=0,o=0,h=t.length,u=0;u<h;u++)t[u]&&H(t[u].x)&&H(t[u].y)&&(e+=t[u].x,n+=t[u].y,o++);return new L(e/o,n/o)},i._computeExtent=function(){var t=this._coordinates;if(!st(t))return null;var e=[t];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this.getHoles()),this._coords2Extent(e,this._getProjection())},i._computePrjExtent=function(){var t=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&t.push.apply(t,this._getPrjHoles()),this._coords2Extent(t)},i._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,n=1,o=t.length;n<o;n++)e+=t[n].distanceTo(t[n-1]);return e},i._hitTestTolerance=function(){var t=this._getInternalSymbol(),e;if(Array.isArray(t)){e=0;for(var n=0;n<t.length;n++)H(t[n].lineWidth)&&t[n].lineWidth>e&&(e=t[n].lineWidth)}else e=t.lineWidth;return s.prototype._hitTestTolerance.call(this)+(H(e)?e/2:1.5)},i._coords2Extent=function(t,e){if(!t||t.length===0||Array.isArray(t[0])&&t[0].length===0)return null;for(var n=new ft(e),o=0,h=t.length;o<h;o++)for(var u=0,l=t[o].length;u<l;u++)n._combine(t[o][u]);return n},a}(ot);Pn.mergeOptions(yd);var Ju="Polygon",Ct=function(s){z(a,s);function a(r,t){var e;return e=s.call(this,t)||this,e.type="Polygon",r&&e.setCoordinates(r),e}var i=a.prototype;return i.getOutline=function(){var t=this._getPainter();if(!t)return null;var e=this.getExtent();return new a(e.toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}})},i.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=L.toCoordinates(t),n=e.length;if(!Array.isArray(e[0]))this._coordinates=this._trimRing(e);else if(this._coordinates=this._trimRing(e[0]),n>1){for(var o=[],h=1;h<n;h++)e[h]&&o.push(this._trimRing(e[h]));this._holes=o}else this._holes=null;return this._projectRings(),this},i.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],n=0,o=t.length;n<o;n++)e.push(this._copyAndCloseRing(t[n]));return e},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),Fr)},i.getShell=function(){return this._coordinates||[]},i.getHoles=function(){return this._holes||[]},i.hasHoles=function(){return this.getHoles().length>0},i._projectRings=function(){if(!this.getMap()){this.onShapeChanged();return}this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},i._checkRing=function(t){if(this._cleanRing(t),!t||!st(t))return!1;var e=t[t.length-1],n=!0;return(t[0].x!==e.x||t[0].y!==e.y)&&(n=!1),n},i._trimRing=function(t){var e=this._checkRing(t);return st(t)&&e&&t.splice(t.length-1,1),t},i._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return st(t)&&!e&&t.push(t[0].copy()),t},i._getPrjShell=function(){return this.getJSONType()===Ju?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this._getShell?this._getShell():this.getShell())),this._prjShell)},i._getPrjHoles=function(){var t=this._getProjection();return this._verifyProjection(),t&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},i._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!st(e))return 0;for(var n=0,o=0,h=e.length;o<h;o++)n+=t.measureLength(e[o]);return n},i._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!st(e))return 0;for(var n=t.measureArea(e[0]),o=1,h=e.length;o<h;o++)n-=t.measureArea(e[o]);return n},i._updateCache=function(){s.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},i._clearCache=function(){return delete this._prjShell,s.prototype._clearCache.call(this)},i._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),s.prototype._clearProjection.call(this)},a}(Pn);Ct.registerJSONType(Ju);function Ps(s){return function(a){z(i,a);function i(){return a.apply(this,arguments)||this}var r=i.prototype;return r.getCoordinates=function(){return this._coordinates},r.setCoordinates=function(e){var n=e instanceof L?e:new L(e);if(this._coordinates=n,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var o=this._getProjection();return this._setPrjCoordinates(o.project(this._coordinates)),this},r._getCenter2DPoint=function(e){var n=this.getMap();if(!n)return null;var o=this._getPrjCoordinates();return o?(e||(e=n._getResolution()),n._prjToPointAtRes(o,e)):null},r._getPrjCoordinates=function(){var e=this._getProjection();return this._verifyProjection(),!this._pcenter&&e&&this._coordinates&&(this._pcenter=e.project(this._coordinates)),this._pcenter},r._setPrjCoordinates=function(e){this._pcenter=e,this.onPositionChanged()},r._updateCache=function(){this._clearCache();var e=this._getProjection();this._pcenter&&e&&(this._coordinates=e.unproject(this._pcenter))},r._clearProjection=function(){this._pcenter=null,a.prototype._clearProjection.call(this)},r._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},i}(s)}var Bo=new Q,wd={symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1,collision:!0},wt=function(s){z(a,s);function a(r,t){var e;return e=s.call(this,t)||this,e.type="Point",e.isPoint=!0,r&&e.setCoordinates(r),e}var i=a.prototype;return i.getOutline=function(){var t=this.getCoordinates(),e=this.getContainerExtent(),n=this.getMap().coordToContainerPoint(t);return new a(t,{symbol:{markerType:"square",markerWidth:e.getWidth(),markerHeight:e.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:e.xmin-(n.x-e.getWidth()/2),markerDy:e.ymin-(n.y-e.getHeight()/2)}})},i.setSymbol=function(){var t;delete this._fixedExtent;for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=s.prototype.setSymbol).call.apply(t,[this].concat(n))},i._getSizeSymbol=function(t){for(var e={},n=!1,o=!1,h=0;h<ra.length;h++){var u=t[ra[h]];P(u)||(!n&&lt(u)&&(n=!0,o=!0),e[ra[h]]=u)}for(var l=0;l<na.length;l++){var f=t[na[l]];P(f)||(!n&&lt(f)&&(n=!0),e[na[l]]=f)}var c;return n?(c=Qi(e,this),o&&(c._dynamic=!0)):c=e,c},i._setExternSymbol=function(t){return this._symbol||delete this._fixedExtent,s.prototype._setExternSymbol.call(this,t)},i._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},i._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new Q,this._fixedExtent.set(null,null,null,null);var t=this._sizeSymbol;if(!t)return this._fixedExtent;var e=this.getLayer()&&this.getLayer().getRenderer(),n=e&&e.resources,o=this.getTextDesc();if(Array.isArray(t)){Bo.set(1/0,1/0,-1/0,-1/0);for(var h=0;h<t.length;h++)t[h]&&this._fixedExtent._combine(Ia(Bo,t[h],n,o&&o[h]))}else this._fixedExtent=Ia(this._fixedExtent,t,n,o);return this._fixedExtent},i._isVectorMarker=function(){var t=this._getInternalSymbol();return Array.isArray(t)?!1:Kr(t)},i._canEdit=function(){var t=this._getInternalSymbol();return Array.isArray(t)?!1:Kr(t)||vs(t)||gs(t)},i._containsPoint=function(t,e){var n=this.getContainerExtent();return e&&(n=n.expand(e)),n.contains(t)?this.options.hitTestForEvent?s.prototype._containsPoint.call(this,t,e):!0:!1},i._computeExtent=function(){return Zo.call(this,"getCenter")},i._computePrjExtent=function(){return Zo.call(this,"_getPrjCoordinates")},i._computeGeodesicLength=function(){return 0},i._computeGeodesicArea=function(){return 0},i._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new xs(this).getSprite(t,e)},a}(Ps(ot));wt.mergeOptions(wd);wt.registerJSONType("Marker");function Zo(s){var a=this[s]();return a?new ft(a,a,this._getProjection()):null}var xd={arrowStyle:null,arrowPlacement:"vertex-last"},yt=function(s){z(a,s);function a(r,t){var e;return e=s.call(this,t)||this,e.type="LineString",r&&e.setCoordinates(r),e}var i=a.prototype;return i.getOutline=function(){return Ct.prototype.getOutline.call(this)},i.setCoordinates=function(t){return t?(this._coordinates=L.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},i.getCoordinates=function(){return this._coordinates||[]},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),Gr)},i._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},i._computeGeodesicArea=function(){return 0},a}(Pn);yt.mergeOptions(xd);yt.registerJSONType("LineString");var Cd=new Q,sr=function(s){z(a,s);function a(r,t){var e;return e=s.call(this,t)||this,e.type="GeometryCollection",e.setGeometries(r),e}var i=a.prototype;return i.getContainerExtent=function(t){var e=t||new Q;return this.forEach(function(n){e._combine(n.getContainerExtent(Cd))}),e},i.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),n=this._getSymbol(),o=this.config(),h=this.getProperties(),u=e.length-1;u>=0;u--)e[u]._initOptions(o),e[u]._setParent(this),e[u]._setEventParent(this),n&&e[u].setSymbol(n),h&&e[u].setProperties(h);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},i.getGeometries=function(){return this._geometries||[]},i.forEach=function(t,e){for(var n=this.getGeometries(),o=0,h=n.length;o<h;o++)n[o]&&(e?t.call(e,n[o],o):t(n[o],o));return this},i.filter=function(t,e){if(!t)return new a;var n=[],o=it(t),h=o?t:un(t);return this.forEach(function(u){var l=o?u:Vr(u);(e?h.call(e,l):h(l))&&n.push(u)},this),new a(n)},i.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach(function(n){n&&n.translate&&n.translate.apply(n,e)}),this},i.isEmpty=function(){return!st(this.getGeometries())},i.remove=function(){return this.forEach(function(t){t._unbind()}),ot.prototype.remove.apply(this,arguments)},i.show=function(){return this.options.visible=!0,this.forEach(function(t){t.show()}),this},i.hide=function(){return this.options.visible=!1,this.forEach(function(t){t.hide()}),this},i.onConfig=function(t){this.forEach(function(e){e.config(t)})},i.getSymbol=function(){var t=s.prototype.getSymbol.call(this);if(!t){var e=[],n=!1;this.forEach(function(o){var h=o.getSymbol();h&&!n&&(n=!0),e.push(o.getSymbol())}),n&&(t={children:e})}return t},i.setSymbol=function(t){var e=this;if(t&&t.children)this._symbol=null,this.forEach(function(o,h){o._eventSymbolProperties=e._eventSymbolProperties,o.setSymbol(t.children[h])});else{var n=this._prepareSymbol(t);this._symbol=n,this.forEach(function(o){o._eventSymbolProperties=e._eventSymbolProperties,o.setSymbol(n)})}return this.onSymbolChanged(),this},i._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach(function(e){e._setExternSymbol(t)}),this.onSymbolChanged(),this},i._bindLayer=function(){s.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},i._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach(function(e){e._bindLayer(t)})},i._checkGeometries=function(t){var e="The geometry added to collection is invalid.";t=Array.isArray(t)?t:[t];for(var n=[],o=0,h=t.length;o<h;o++){var u=t[o];if(u){if(!this._checkGeo(u)){console.error(e+" Index: "+o);continue}if(Pd(u)){Qt.isTest||console.error(u," is GeometryCollection sub class,it Cannot be placed in GeometryCollection");continue}n.push(u)}}return n},i._checkGeo=function(t){return t instanceof ot},i._updateCache=function(){this._clearCache(),!this.isEmpty()&&this.forEach(function(t){t&&t._updateCache&&t._updateCache()})},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach(function(t){t._removePainter()})},i._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,n=0,o=0,h=this.getGeometries(),u=0,l=h.length;u<l;u++)if(h[u]){var f=h[u]._computeCenter(t);f&&(e+=f.x,n+=f.y,o++)}return o===0?null:new L(e/o,n/o)},i._containsPoint=function(t,e){if(this.isEmpty())return!1;delete this._pickGeometryIndex;for(var n=this.getGeometries(),o=0,h=n.length;o<h;o++)if(n[o]._containsPoint(t,e))return this._pickGeometryIndex=o,!0;return!1},i._hitTestTolerance=function(){for(var t=this.getGeometries(),e=0,n=0,o=t.length;n<o;n++){var h=t[n]._hitTestTolerance();e=Math.max(e,h)}return e},i._computeExtent=function(t){return Wo.call(this,t,"_computeExtent")},i._computePrjExtent=function(t){return Wo.call(this,t,"_computePrjExtent")},i._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,o=0,h=e.length;o<h;o++)e[o]&&(n+=e[o]._computeGeodesicLength(t));return n},i._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,o=0,h=e.length;o<h;o++)e[o]&&(n+=e[o]._computeGeodesicArea(t));return n},i._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),n=0,o=e.length;n<o;n++)e[n]&&t.push(e[n]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},i._toJSON=function(t){t=F({},t);var e={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.getGeometries().filter(function(h){return h&&h._toJSON}).map(function(h){var u=h._toJSON();return u.subType?u:h._exportGeoJSONGeometry()})}},n=this.getId();P(n)||(e.id=n);var o;return(P(t.properties)||t.properties)&&(o=this._exportProperties()),e.properties=o,t.feature=e,t},i._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e]&&t[e]._clearProjection()},i._getConnectPoints=function(){var t=this.getExtent(),e=[new L(t.xmin,t.ymax),new L(t.xmax,t.ymin),new L(t.xmin,t.ymin),new L(t.xmax,t.ymax)];return e},i._getExternalResources=function(){if(this.isEmpty())return[];for(var t=this.getGeometries(),e=[],n={},o,h,u,l=0,f=t.length;l<f;l++)if(t[l]){o=t[l]._getInternalSymbol(),h=hr(o);for(var c=0,d=h.length;c<d;c++)u=h[c].join(),n[u]||(e.push(h[c]),n[u]=1)}return e},i.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var n=this.getGeometries(),o=0,h=n.length;o<h;o++)n[o].startEdit(t);this._editing=!0;var u=this.getLayer(),l=u&&u.options.renderer==="canvas";return l&&this.hide(),setTimeout(function(){e.fire("editstart")},1),this},i.endEdit=function(){if(this.isEmpty())return this;for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},i.isEditing=function(){return!!this._editing},a}(ot);sr.registerJSONType("GeometryCollection");function Wo(s,a){if(this.isEmpty())return null;for(var i=new ft,r=this.getGeometries(),t=0,e=r.length;t<e;t++)if(r[t]){var n=r[t][a](s);n&&i._combine(n)}return i}function Pd(s){return s instanceof sr}var Xu=function(s){z(a,s);function a(r,t,e,n){var o;return o=s.call(this,null,n)||this,o.GeometryType=r,o.type=t,o._initData(e),o}var i=a.prototype;return i.getCoordinates=function(){for(var t=[],e=this.getGeometries(),n=0,o=e.length;n<o;n++){var h=e[n];t.push(h.getShell&&h.getJSONType()!=="Polygon"?[h.getShell()]:h.getCoordinates())}return t},i.setCoordinates=function(t){t=t||[];for(var e=[],n=0,o=t.length;n<o;n++){var h=new this.GeometryType(t[n],this.config());e.push(h)}return this.setGeometries(e),this},i._initData=function(t){t=t||[],t.length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},i._checkGeo=function(t){return t instanceof this.GeometryType},i._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=L.toNumberArrays(t);return{type:this.getType(),coordinates:e}},i._toJSON=function(t){return{feature:this.toGeoJSON(t)}},a}(sr),tn=function(s){z(a,s);function a(r,t){return s.call(this,wt,"MultiPoint",r,t)||this}var i=a.prototype;return i.findClosest=function(t){if(!t)return null;var e=this.getCoordinates(),n=null,o=1/0;return e.forEach(function(h){var u=Td(h,t);u<o&&(n=h,o=u)}),n},a}(Xu);tn.registerJSONType("MultiPoint");function Td(s,a){var i=a.x-s.x,r=a.y-s.y;return Math.sqrt(i*i+r*r)}var qu=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.getCenterInExtent=function(t){var e=this.getGeometries(),n=0,o=0,h=0;return e.forEach(function(u){var l=u.getCenterInExtent(t);l&&(n+=l.x*l.count,o+=l.y*l.count,h+=l.count)}),h===0?null:new L(n,o)._multi(1/h)},a}(Xu),en=function(s){z(a,s);function a(i,r){return s.call(this,yt,"MultiLineString",i,r)||this}return a}(qu);en.registerJSONType("MultiLineString");var $u=function(s){z(a,s);function a(i,r){return s.call(this,Ct,"MultiPolygon",i,r)||this}return a}(qu);$u.registerJSONType("MultiPolygon");var Md={Marker:wt,LineString:yt,Polygon:Ct,MultiPoint:tn,MultiLineString:en,MultiPolygon:$u},Yu="geojson-fetch-worker-page-async",Sd=`
function (exports) {
    const resultMap = {};

    function handleResult(msg, postResponse) {
        const data = msg.data || {};
        const { taskId } = data;
        const features = resultMap[taskId];
        if (!features) {
            postResponse('not find geojson dataset the taskId:' + taskId);
            return;
        }
        if (features.length === 0) {
            delete resultMap[taskId];
            postResponse(null, []);
            return;
        }
        const pageSize = data.pageSize || 2000;
        const pageFeatures = features.slice(0, pageSize);
        resultMap[taskId] = features.slice(pageSize, Infinity);
        postResponse(null, pageFeatures);
    }
    //worker init
    exports.initialize = function () {
        // console.log("geojson fetch init");
    };
    //recive message
    exports.onmessage = function (msg, postResponse) {
        const { taskId, type, url } = msg.data || {};
        if (!taskId) {
            postResponse('not find task id for get geojson dataset,taskId=' + taskId);
            return;
        }
        if (type === 'fetchdata') {
            if (!url) {
                postResponse('url is null,url=' + url);
                return;
            }
            fetch(url).then(res => res.json()).then(geojson => {
                let features;
                if (Array.isArray(geojson)) {
                    features = geojson;
                } else if (geojson.features) {
                    features = geojson.features;
                } else {
                    features = [geojson];
                }
                resultMap[taskId] = features;
                handleResult(msg, postResponse);
            }).catch(errror => {
                postResponse(errror.message);
            });
        } else if (type === 'pagefeatures') {
            handleResult(msg, postResponse);
        } else {
            postResponse('not support task type:' + type);
        }
    };
}`,bd=function(s){z(a,s);function a(){return s.call(this,Yu)||this}var i=a.prototype;return i._sendMsg=function(t,e,n){var o=this;this.send(t,[],function(h,u){h?n(h):o._pageFeatures(t,u,e,n)},t.workerId)},i._fetchGeoJSON=function(t,e,n,o){n===void 0&&(n=[]);var h=F({},e);h.type="fetchdata",h.url=t,this._sendMsg(h,n,o)},i._pageFeatures=function(t,e,n,o){if(n.push(e),e.length===0){o(null,n);return}var h=F({},t);h.type="pagefeatures",this._sendMsg(h,n,o)},a}(wn);uu(Yu,function(){return Sd});var Rr,Ut={toGeometry:function(a,i){if(tt(a)&&(a=qi(a)),Array.isArray(a)){for(var r=[],t=0,e=a.length;t<e;t++){var n=Ut._convert(a[t],i);Array.isArray(n)?ie(r,n):r.push(n)}return r}else{var o=Ut._convert(a,i);return o}},toGeometryAsync:function(a,i,r){return r===void 0&&(r=2e3),tt(a)&&(a=qi(a)),new rr(function(t){var e=[];if(a&&(Array.isArray(a)||Array.isArray(a.features))){var n=H(r)?Math.round(r):2e3,o=a.features||a,h=Math.ceil(o.length/n),u=1,l=function(){var d=(u-1)*n,g=u*n,v=o.slice(d,g),m=Ut.toGeometry(v,i);return u++,m};lu({count:h,run:l}).then(function(c){for(var d=0,g=c.length;d<g;d++){var v=c[d];v&&(Array.isArray(v)?ie(e,v):e.push(v))}t(e)})}else{var f=Ut.toGeometry(a,i);t(f)}})},_convert:function(a,i){if(!a||P(a.type))return null;var r=a.type;if(r==="Feature"){var t=a.geometry,e=Ut._convert(t);return e?(e.setId(a.id),e.setProperties(a.properties),i&&i(e),e):null}else if(r==="FeatureCollection"){var n=a.features;return n?Ut.toGeometry(n,i):null}else if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(r)>=0){var o=r==="Point"?"Marker":r,h=new Md[o](a.coordinates);return i&&i(h),h}else if(r==="GeometryCollection"){var u=a.geometries;if(!st(u)){var l=new sr;return i&&i(l),l}for(var f=[],c=u.length,d=0;d<c;d++)u[d].subType?f.push(ot.getJSONClass(u[d].subType).fromJSON(u[d])):f.push(Ut._convert(u[d]));var g=new sr(f);return i&&i(g),g}return null},_isGeoJSON:function(a){if(!a)return!1;if(a=a||{},Array.isArray(a)&&a.length)return Ut.isGeoJSON(a[0]);var i=a.type;if(!i||Rh.indexOf(i)===-1)return!1;var r=a,t=r.features,e=r.geometries,n=r.geometry,o=r.coordinates;if(o&&Array.isArray(o)||Array.isArray(e)||Array.isArray(t))return!0;if(n){var h=n.coordinates;if(h&&Array.isArray(h))return!0}return!1},fetch:function(a,i){return i===void 0&&(i=2e3),new rr(function(r,t){if(!a||!tt(a)){t("url is error,It should be string");return}var e=F({pageSize:2e3},{pageSize:i});a=on(a),Rr||(Rr=new bd);var n=Rr.workers.length,o=Math.floor(Math.random()*n);o=Math.min(n-1,o),e.workerId=o,e.taskId=Lh(),Rr._fetchGeoJSON(a,e,[],function(h,u){if(h){t(h);return}var l=[];u.forEach(function(f){for(var c=0,d=f.length;c<d;c++)l.push(f[c])}),r({type:"FeatureCollection",features:l})})})}},Ed={numberOfShellPoints:60},re=function(s){z(a,s),a.fromJSON=function(t){var e=t.feature,n=new a(t.coordinates,t.radius,t.options);return n.setProperties(e.properties),n};function a(r,t,e){var n;return n=s.call(this,null,e)||this,r&&n.setCoordinates(r),n._radius=t,n}var i=a.prototype;return i.getRadius=function(){return this._radius},i.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},i.getShell=function(){for(var t=this._getMeasurer(),e=this.getCoordinates(),n=this.options.numberOfShellPoints,o=this.getRadius(),h=[],u,l,f,c=0,d=n-1;c<d;c++){u=360*c/d*Math.PI/180,l=o*Math.cos(u),f=o*Math.sin(u);var g=t.locate(e,l,f);g.z=e.z,h.push(g)}return h.push(h[0]),h},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(t,e){var n=this.getMap();if(n.getPitch())return s.prototype._containsPoint.call(this,t,e);var o=n._pointToContainerPoint(this._getCenter2DPoint()),h=this.getSize(),u=this._hitTestTolerance()+(e||0),l=o.add(h.width/2,h.height/2);return Du(t,o,l,u)},i._computePrjExtent=function(t){var e=this._getMinMax(t);if(!e)return null;var n=this._getPrjCoordinates(),o=e.map(function(c){return t.project(c)}),h=o[0].x-n.x,u=o[1].x-n.x,l=o[2].y-n.y,f=o[3].y-n.y;return new ft(n.add(h,l),n.add(u,f))},i._computeExtent=function(t){var e=this._getMinMax(t);return e?new ft(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},i._getMinMax=function(t){if(!t||!this._coordinates||P(this._radius))return null;var e=this._radius,n=t.locate(this._coordinates,-e,0),o=t.locate(this._coordinates,e,0),h=t.locate(this._coordinates,0,e),u=t.locate(this._coordinates,0,-e);return[n,o,h,u]},i._computeGeodesicLength=function(){return P(this._radius)?0:Math.PI*2*this._radius},i._computeGeodesicArea=function(){return P(this._radius)?0:Math.PI*Math.pow(this._radius,2)},i._exportGeoJSONGeometry=function(){var t=L.toNumberArrays([this.getShell()]);return{type:"Polygon",coordinates:t}},i._toJSON=function(t){var e=this.getCenter(),n=F({},t);n.geometry=!1;var o=this.toGeoJSON(n);return o.geometry={type:"Polygon"},{feature:o,subType:"Circle",coordinates:[e.x,e.y],radius:this.getRadius()}},a}(Ps(Ct));re.mergeOptions(Ed);re.registerJSONType("Circle");var Rd={numberOfShellPoints:81},pe=function(s){z(a,s),a.fromJSON=function(t){var e=t.feature,n=new a(t.coordinates,t.width,t.height,t.options);return n.setProperties(e.properties),n};function a(r,t,e,n){var o;return o=s.call(this,null,n)||this,r&&o.setCoordinates(r),o.width=t,o.height=e,o}var i=a.prototype;return i.getWidth=function(){return this.width},i.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},i.getHeight=function(){return this.height},i.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},i.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},i._getShell=function(){for(var t=this._getMeasurer(),e=this.getCoordinates(),n=this.options.numberOfShellPoints-1,o=this.getWidth(),h=this.getHeight(),u=[],l=Math.pow(o/2,2)*Math.pow(h/2,2),f=Math.pow(o/2,2),c=Math.pow(h/2,2),d,g,v,m,_=0;_<n;_++){d=360*_/n,g=d*Math.PI/180,v=Math.sqrt(l/(f*Math.pow(Math.tan(g),2)+c)),m=Math.sqrt(l/(c*Math.pow(1/Math.tan(g),2)+f)),d>90&&d<270&&(v*=-1),d>180&&d<360&&(m*=-1);var p=t.locate(e,v,m);p.z=e.z,u.push(p)}return u.push(u[0].copy()),u},i._getPrjShell=function(){var t=s.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(t)},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(t,e){var n=this.getMap();if(n.isTransforming())return s.prototype._containsPoint.call(this,t,e);var o=n.getProjection(),h=this._hitTestTolerance()+(e||0),u=o.projectCoords([this._coordinates,n.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)],this.options.antiMeridian),l=n._prjToContainerPoint(u[0]),f=n._prjToContainerPoint(u[1]);return Du(t,l,f,h)},i._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():re.prototype._computePrjExtent.apply(this,arguments)},i._computeExtent=function(){return re.prototype._computeExtent.apply(this,arguments)},i._getMinMax=function(t){if(!t||!this._coordinates||P(this.width)||P(this.height))return null;var e=this.getWidth(),n=this.getHeight(),o=t.locate(this._coordinates,-e/2,0),h=t.locate(this._coordinates,e/2,0),u=t.locate(this._coordinates,0,-n/2),l=t.locate(this._coordinates,0,n/2);return[o,h,u,l]},i._computeGeodesicLength=function(){if(P(this.width)||P(this.height))return 0;var t=this.width>this.height?this.width:this.height;return 2*Math.PI*t/2-4*Math.abs(this.width-this.height)},i._computeGeodesicArea=function(){return P(this.width)||P(this.height)?0:Math.PI*this.width*this.height/4},i._exportGeoJSONGeometry=function(){var t=L.toNumberArrays([this.getShell()]);return{type:"Polygon",coordinates:t}},i._toJSON=function(t){var e=F({},t),n=this.getCenter();e.geometry=!1;var o=this.toGeoJSON(e);return o.geometry={type:"Polygon"},{feature:o,subType:"Ellipse",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},a}(Ps(Ct));pe.mergeOptions(Rd);pe.registerJSONType("Ellipse");var _i=function(s){z(a,s),a.fromJSON=function(t){var e=t.feature,n=new a(t.coordinates,t.width,t.height,t.options);return n.setProperties(e.properties),n};function a(r,t,e,n){var o;return o=s.call(this,null,n)||this,r&&o.setCoordinates(r),o._width=t,o._height=e,o}var i=a.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(t){if(this._coordinates=t instanceof L?t:new L(t),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var e=this._getProjection();return this._setPrjCoordinates(e.project(this._coordinates)),this},i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},i.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},i._getShell=function(){var t=this._getMeasurer(),e=this._coordinates,n=this.getMap(),o=1,h=-1;if(n){var u=n.getFullExtent();u.left>u.right&&(o=-1),u.bottom>u.top&&(h=1)}var l=[];l.push(e);var f=t.locate(e,o*this._width,0);f.z=e.z,l.push(f);var c=t.locate(e,o*this._width,h*this._height);c.z=e.z,l.push(c);var d=t.locate(e,0,h*this._height);return l.push(d),d.z=e.z,l.push(e),l},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pnw&&t&&this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw},i._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},i._getPrjShell=function(){var t=s.prototype._getPrjShell.call(this),e=this._getProjection();if(!e.isSphere())return this._rotatePrjCoordinates(t);for(var n=e.getSphereExtent(),o=n.sx,h=n.sy,u=this._getProjection().getCircum(),l=t[0],f=1,c=t.length;f<c;f++){var d=t[f],g=0,v=0;o*(l.x-d.x)>0&&(g=u.x*o),h*(l.y-d.y)<0&&(v=u.y*h),t[f]._add(g,v)}return this._rotatePrjCoordinates(t)},i._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},i._clearProjection=function(){this._pnw=null,s.prototype._clearProjection.call(this)},i._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},i._containsPoint=function(t,e){var n=this.getMap();if(n.isTransforming())return s.prototype._containsPoint.call(this,t,e);var o=P(e)?this._hitTestTolerance():e,h=n._getResolution()*o,u=this._getPrjExtent().expand(h),l=n._containerPointToPrj(t);return u.contains(l)},i._computePrjExtent=function(t){if(this.isRotated())return this._computeRotatedPrjExtent();var e=this._getSouthEast(t);if(!e)return null;var n=t.projectCoords([new L(this._coordinates.x,e.y),new L(e.x,this._coordinates.y)],this.options.antiMeridian);return new ft(n[0],n[1])},i._computeExtent=function(t){var e=this._getSouthEast(t);return e?new ft(this._coordinates,e,this._getProjection()):null},i._getSouthEast=function(t){if(!t||!this._coordinates||P(this._width)||P(this._height))return null;var e=this.getWidth(),n=this.getHeight(),o=e,h=-n;if(t.fullExtent){var u=t.fullExtent,l=u.right>u.left?1:-1,f=u.top>u.bottom?1:-1;o*=l,h*=f}var c=t.locate(this._coordinates,o,0),d=t.locate(this._coordinates,0,h);return c.y=d.y,c},i._computeGeodesicLength=function(){return P(this._width)||P(this._height)?0:2*(this._width+this._height)},i._computeGeodesicArea=function(){return P(this._width)||P(this._height)?0:this._width*this._height},i._exportGeoJSONGeometry=function(){var t=L.toNumberArrays([this.getShell()]);return{type:"Polygon",coordinates:t}},i._toJSON=function(t){var e=F({},t),n=this.getCoordinates();e.geometry=!1;var o=this.toGeoJSON(e);return o.geometry={type:"Polygon"},{feature:o,subType:"Rectangle",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},a}(Ct);_i.registerJSONType("Rectangle");var Ad={numberOfShellPoints:60},Pi=function(s){z(a,s),a.fromJSON=function(t){var e=t.feature,n=new a(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return n.setProperties(e.properties),n};function a(r,t,e,n,o){var h;return h=s.call(this,r,t,o)||this,h.startAngle=e,h.endAngle=n,h}var i=a.prototype;return i.getStartAngle=function(){return this.startAngle},i.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},i.getEndAngle=function(){return this.endAngle},i.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},i.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},i._getShell=function(){for(var t=this._getMeasurer(),e=this.getCoordinates(),n=this.options.numberOfShellPoints-2,o=this.getRadius(),h=[e.copy()],u=this.getStartAngle(),l=this.getEndAngle()-u,f,c,d,g=0;g<n;g++){f=(l*g/(n-1)+u)*Math.PI/180,c=o*Math.cos(f),d=o*Math.sin(f);var v=t.locate(e,c,d);v.z=e.z,h.push(v)}return h.push(e.copy()),h},i.getRotateOffsetAngle=function(){return 90},i._getPrjShell=function(){var t=s.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(t)},i._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():re.prototype._computePrjExtent.apply(this,arguments)},i._containsPoint=function(t,e){var n=this.getMap();if(n.isTransforming())return s.prototype._containsPoint.call(this,t,e);var o=n._pointToContainerPoint(this._getCenter2DPoint()),h=this._hitTestTolerance()+(e||0),u=this.getSize(),l=o,f=t,c=f.x-l.x,d=l.y-f.y,g=Math.atan2(d,c),v=g<0?(g+2*Math.PI)*360/(2*Math.PI):g*360/(2*Math.PI),m=this.startAngle%360,_=this.endAngle%360,p=!1;return m>_?p=!(v>_&&v<m):p=v>=m&&v<=_,f.distanceTo(l)<=u.width/2+h&&p},i._computeGeodesicLength=function(){return P(this._radius)?0:Math.PI*2*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},i._computeGeodesicArea=function(){return P(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},i._toJSON=function(t){var e=F({},t),n=this.getCenter();e.geometry=!1;var o=this.toGeoJSON(e);return o.geometry={type:"Polygon"},{feature:o,subType:"Sector",coordinates:[n.x,n.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},a}(re);Pi.mergeOptions(Ad);Pi.registerJSONType("Sector");var Od={enableSimplify:!1,enableClip:!1},vr=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i._arc=function(t,e,n){for(var o=this.options.arcDegree*Math.PI/180,h=1,u=e.length;h<u;h++){var l=I._arcBetween(t,e[h-1],e[h],o),f=[e[h-1].x+e[h].x-l[0],e[h-1].y+e[h].y-l[1]];e[h-1].nextCtrlPoint=f,e[h].prevCtrlPoint=f,I._stroke(t,n)}},i._quadraticCurve=function(t,e){if(e.length<=2){I._path(t,e);return}var n,o;for(n=2,o=e.length;n<o;n+=2)t.quadraticCurveTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y);if(n-=1,n<o)for(;n<o;n++)t.lineTo(e[n].x,e[n].y)},i._bezierCurve=function(t,e){if(e.length<=3){I._path(t,e);return}var n,o;for(n=1,o=e.length;n+2<o;n+=3)t.bezierCurveTo(e[n].x,e[n].y,e[n+1].x,e[n+1].y,e[n+2].x,e[n+2].y);if(n<o)for(;n<o;n++)t.lineTo(e[n].x,e[n].y)},i._getCurveArrowPoints=function(t,e,n,o,h,u){var l=e.length,f;for(f=u;f<l;f+=u){var c=this._getArrowShape(e[f-1],e[f],n,o,h);c&&t.push(c)}if(f-=u,f<l-1)for(f+=1;f<l;f++){var d=this._getArrowShape(e[f-1],e[f],n,o,h);d&&t.push(d)}},a}(yt);vr.mergeOptions(Od);var Dd={arcDegree:90},Tn=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},i._paintOn=function(t,e,n){t.beginPath(),this._arc(t,e,n),I._stroke(t,n),this._paintArrow(t,e,n)},a.fromJSON=function(t){var e=t.feature,n=new a(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n},a}(vr);Tn.registerJSONType("ArcCurve");Tn.mergeOptions(Dd);var Qu=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}a.fromJSON=function(t){var e=t.feature,n=new a(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n};var i=a.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},i._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),I._stroke(t,n),this._paintArrow(t,e,n)},i._getArrowPoints=function(t,e,n,o,h){return this._getCurveArrowPoints(t,e,n,o,h,3)},a}(vr);Qu.registerJSONType("CubicBezierCurve");var Ku=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}a.fromJSON=function(t){var e=t.feature,n=new a(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n};var i=a.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},i._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,n),I._stroke(t,n),this._paintArrow(t,e,n)},i._getArrowPoints=function(t,e,n,o,h){return this._getCurveArrowPoints(t,e,n,o,h,2)},a}(vr);Ku.registerJSONType("QuadBezierCurve");var kd={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:`
`,textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},Ld={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},Ts=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.getContent=function(){return this._content},i.setContent=function(t){var e=this._content;return this._content=ur(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},i.onAdd=function(){this._refresh()},i.toJSON=function(){var t=s.prototype.toJSON.call(this);return delete t.symbol,t},i.setSymbol=function(t){if(this._refreshing||!t)return s.prototype.setSymbol.call(this,t);var e=this._parseSymbol(t);if(this.setTextStyle){var n=this.getTextStyle()||{};n.symbol=e[0],this.setTextStyle(n)}else this.setTextSymbol&&this.setTextSymbol(e[0]);if(this.setBoxStyle){var o=this.getBoxStyle()||{};o.symbol=e[1],this.setBoxStyle(o)}else this.setBoxSymbol&&this.setBoxSymbol(e[1]);return this},i._parseSymbol=function(t){var e={},n={};for(var o in t)wi(t,o)&&(o.indexOf("text")===0?e[o]=t[o]:n[o]=t[o]);return[e,n]},i._getTextSize=function(t){return gn(this._content,t).size},i._getInternalSymbol=function(){return this._symbol},i._getDefaultTextSymbol=function(){return F({},kd)},i._getDefaultBoxSymbol=function(){return F({},Ld)},i._getDefaultPadding=function(){return[12,8]},a}(wt),Id={textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null},rn=function(s){z(a,s);function a(r,t,e,n,o){var h;return o===void 0&&(o={}),h=s.call(this,t,o)||this,h._content=ur(r),h._width=P(e)?100:e,h._height=P(n)?40:n,o.boxSymbol&&h.setBoxSymbol(o.boxSymbol),o.textStyle&&h.setTextStyle(o.textStyle),h._refresh(),h}var i=a.prototype;return i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this._refresh(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this._refresh(),this},i.getBoxSymbol=function(){return F({},this.options.boxSymbol)},i.setBoxSymbol=function(t){return this.options.boxSymbol=t&&F({},t),this.getSymbol()&&this._refresh(),this},i.getTextStyle=function(){return this.options.textStyle?F({},this.options.textStyle):null},i.setTextStyle=function(t){return this.options.textStyle=t&&F({},t),this.getSymbol()&&this._refresh(),this},a.fromJSON=function(t){var e=t.feature,n=new a(t.content,e.geometry.coordinates,t.width,t.height,t.options);return n.setProperties(e.properties),n.setId(e.id),t.symbol&&n.setSymbol(t.symbol),n},i._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},i._refresh=function(){var t=this.getTextStyle()||{},e=t.padding||[12,8],n,o;if(lt(this._width)){n=JSON.parse(JSON.stringify(this._width));var h=n.stops;if(h)for(var u=0;u<h.length;u++)h[u][1]=h[u][1]-2*e[0]}else n=this._width-2*e[0];if(lt(this._height)){o=JSON.parse(JSON.stringify(this._height));var l=o.stops;if(l)for(var f=0;f<l.length;f++)l[f][1]=l[f][1]-2*e[1]}else o=this._height-2*e[1];var c=F({},t.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:n,textMaxHeight:o});t.wrap&&!c.textWrapWidth&&(c.textWrapWidth=n);var d=t.horizontalAlignment;c.textDx=c.markerDx||0;var g;if(lt(this._width)){g=JSON.parse(JSON.stringify(this._width));var v=g.stops;if(v)for(var m=0;m<v.length;m++)v[m][1]=v[m][1]/2-e[0],d==="left"&&(v[m][1]*=-1)}else g=c.markerWidth/2-e[0],d==="left"&&(g*=-1);d==="left"?(c.textHorizontalAlignment="right",c.textDx=g):d==="right"&&(c.textHorizontalAlignment="left",c.textDx=g);var _=t.verticalAlignment;c.textDy=c.markerDy||0;var p;if(lt(this._height)){p=JSON.parse(JSON.stringify(this._height));var y=p.stops;if(y)for(var w=0;w<y.length;w++)y[w][1]=y[w][1]/2-e[1],_==="top"&&(y[w][1]*=-1)}else p=c.markerHeight/2-e[1],_==="top"&&(p*=-1);_==="top"?(c.textVerticalAlignment="bottom",c.textDy=p):_==="bottom"&&(c.textVerticalAlignment="top",c.textDy=p),this._refreshing=!0,this.updateSymbol(c),delete this._refreshing},i.startEdit=function(t){var e=this._getCompiledSymbol();if(lt(this._width)){var n=e.markerWidth;this._oldWidth=this._width,this.setWidth(n)}if(lt(this._height)){var o=e.markerHeight;this._oldHeight=this._height,this.setHeight(o)}s.prototype.startEdit.call(this,t)},i.endEdit=function(){var t=this.getMap(),e=t&&t.getZoom();if(this._oldWidth){for(var n=this._width,o=Yi(this._oldWidth),h=o(e),u=n/h,l=this._oldWidth.stops,f=0;f<l.length;f++)l[f][1]*=u;this.setWidth(this._oldWidth),delete this._oldWidth}if(this._oldHeight){for(var c=this._height,d=Yi(this._oldHeight),g=d(e),v=c/g,m=this._oldHeight.stops,_=0;_<m.length;_++)m[_][1]*=v;this.setHeight(this._oldHeight),delete this._oldHeight}s.prototype.endEdit.call(this)},a}(Ts);rn.mergeOptions(Id);rn.registerJSONType("TextBox");var zd={boxStyle:null,textSymbol:null},pi=function(s){z(a,s);function a(r,t,e){var n;return e===void 0&&(e={}),n=s.call(this,t,e)||this,e.textSymbol&&n.setTextSymbol(e.textSymbol),e.boxStyle&&n.setBoxStyle(e.boxStyle),n._content=ur(r),n._refresh(),n}var i=a.prototype;return i.getBoxStyle=function(){return this.options.boxStyle?F({},this.options.boxStyle):null},i.setBoxStyle=function(t){return this.options.boxStyle=t&&F({},t),this._refresh(),this},i.getTextSymbol=function(){return F({},this._getDefaultTextSymbol(),this.options.textSymbol)},i.setTextSymbol=function(t){return this.options.textSymbol=t&&F({},t),this._refresh(),this},a.fromJSON=function(t){var e=t.feature,n=new a(t.content,e.geometry.coordinates,t.options);return n.setProperties(e.properties),n.setId(e.id),t.symbol&&n.setSymbol(t.symbol),n},i._canEdit=function(){return!1},i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},i._refresh=function(){var t=F({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){F(t,e.symbol);var n=this._getBoxSize(t),o=n[1],h=e.padding||this._getDefaultPadding(),u=n[0];t.markerWidth=u.width,t.markerHeight=u.height;var l=t.textDx||0,f=t.textDy||0,c=he(o,t.textHorizontalAlignment,t.textVerticalAlignment)._add(l,f),d=e.horizontalAlignment||"middle";t.markerDx=c.x,d==="left"?t.markerDx+=t.markerWidth/2-h[0]:d==="right"?t.markerDx-=t.markerWidth/2-o.width-h[0]:t.markerDx+=o.width/2;var g=e.verticalAlignment||"middle";t.markerDy=c.y,g==="top"?t.markerDy+=t.markerHeight/2-h[1]:g==="bottom"?t.markerDy-=t.markerHeight/2-o.height-h[1]:t.markerDy+=o.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},i._getBoxSize=function(t){t.markerType||(t.markerType="square");var e=this.getBoxStyle(),n=this._getTextSize(t),o,h,u=e.padding||this._getDefaultPadding();return o=n.width+u[0]*2,h=n.height+u[1]*2,e.minWidth&&(!o||o<e.minWidth)&&(o=e.minWidth),e.minHeight&&(!h||h<e.minHeight)&&(h=e.minHeight),[new xt(o,h),n]},a}(Ts);pi.mergeOptions(zd);pi.registerJSONType("Label");var tl=function(a){return function(i){z(r,i);function r(){return i.apply(this,arguments)||this}r._hasConnectors=function(n){return!P(n.__connectors)&&n.__connectors.length>0},r._getConnectors=function(n){return n.__connectors};var t=r.prototype;return t.getConnectSource=function(){return this._connSource},t.setConnectSource=function(n){var o=this._connTarget;return this.onRemove(),this._connSource=n,this._connTarget=o,this.onAdd(),this},t.getConnectTarget=function(){return this._connTarget},t.setConnectTarget=function(n){var o=this._connSource;return this.onRemove(),this._connSource=o,this._connTarget=n,this._updateCoordinates(),this._registerEvents(),this},t._updateCoordinates=function(){var n=this.getMap();if(!n&&this._connSource&&(n=this._connSource.getMap()),!n&&this._connTarget&&(n=this._connTarget.getMap()),!!n&&!(!this._connSource||!this._connTarget)){for(var o=this._connSource._getConnectPoints(),h=this._connTarget._getConnectPoints(),u=0,l=this.getCoordinates(),f,c,d=0,g=o.length;d<g;d++)for(var v=o[d],m=0,_=h.length;m<_;m++){var p=h[m],y=n.computeLength(v,p);d===0&&m===0?(f=v,c=p,u=y):y<u&&(f=v,c=p)}(!st(l)||!l[0].equals(f)||!l[1].equals(c))&&this.setCoordinates([f,c])}},t.onAdd=function(){this._registerEvents(),this._updateCoordinates()},t.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&Hr(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(Hr(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof ot)||!(this._connTarget instanceof ot)){var n=this.getMap();n&&n.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},t._showConnect=function(){!this._connSource||!this._connTarget||this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},t._registerEvents=function(){if(!(!this._connSource||!this._connTarget)){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var n=this.options.showOn;if(this.hide(),n==="moving"?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):n==="click"?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):n==="mouseover"?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof ot)||!(this._connTarget instanceof ot)){var o=this.getMap();o&&o.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},r}(a)},el={showOn:"always"},nn=function(s){z(a,s);function a(i,r,t){var e;return e=s.call(this,null,t)||this,arguments.length===1&&(t=i,i=null,r=null),e._connSource=i,e._connTarget=r,e}return a}(tl(yt));nn.mergeOptions(el);nn.registerJSONType("ConnectorLine");var il=function(s){z(a,s);function a(i,r,t){var e;return e=s.call(this,null,t)||this,arguments.length===1&&(t=i,i=null,r=null),e._connSource=i,e._connTarget=r,e}return a}(tl(Tn));il.mergeOptions(el);il.registerJSONType("ArcConnectorLine");function Ar(s){return s&&s instanceof ot}var jd={drawImmediate:!1,geometryEvents:!0,geometryEventTolerance:1},Vo=[],rl=function(s){z(a,s);function a(r,t,e){var n;t&&!Ar(t)&&!Array.isArray(t)&&Rh.indexOf(t.type)<0&&(e=t,t=null),n=s.call(this,r,e)||this,n._maxZIndex=0,n._minZIndex=0,n._initCache(),t&&n.addGeometry(t);var o=n.options.style;return o&&n.setStyle(o),n}var i=a.prototype;return i.getGeometryById=function(t){return P(t)||t===""||!this._geoMap[t]?null:this._geoMap[t]},i.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var n=[],o,h,u=0,l=this._geoList.length;u<l;u++)o=this._geoList[u],e?h=t.call(e,o):h=t(o),h&&n.push(o);return n},i.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},i.getLastGeometry=function(){var t=this._geoList.length;return t===0?null:this._geoList[t-1]},i.getCount=function(){return this._geoList.length},i.getExtent=function(){if(this.getCount()===0)return null;var t=new ft(this.getProjection());return this.forEach(function(e){t._combine(e.getExtent())}),t},i.forEach=function(t,e){for(var n=this._geoList.slice(0),o=0,h=n.length;o<h;o++)e?t.call(e,n[o],o):t(n[o],o);return this},i.filter=function(t,e){var n=[],o=it(t),h=o?t:un(t);return this.forEach(function(u){var l=o?u:Vr(u);(e?h.call(e,l):h(l))&&n.push(u)},this),n},i.isEmpty=function(){return!this._geoList.length},i.addGeometry=function(t,e){if(!t)return this;if(t.type==="FeatureCollection")return this.addGeometry(Ut.toGeometry(t),e);if(Array.isArray(t)){if(t.length===0)return this}else{var n=arguments.length,o=arguments[n-1];return t=Array.prototype.slice.call(arguments,0,n-1),e=o,o&&ee(o)&&("type"in o||Ar(o))&&(t.push(o),e=!1),this.addGeometry(t,e)}this._initCache();var h;e&&(h=new ft),this._toSort=this._maxZIndex>0;for(var u=[],l=0,f=t.length;l<f;l++){var c=t[l];if(!(c&&(Ut._isGeoJSON(c)||Ar(c))))throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+l);if(!(c.getLayer&&c.getLayer()===this)){if(!Ar(c)&&(c=ot.fromJSON(c),Array.isArray(c)))for(var d=0,g=c.length;d<g;d++)this._add(c[d],h,l),u.push(c[d]);if(!c)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+l);Array.isArray(c)||(this._add(c,h,l),u.push(c))}}var v=this.getMap();if(v&&(this._getRenderer().onGeometryAdd(u),h&&!P(h.xmin))){var m=h.getCenter(),_=v.getFitZoom(h);if(ee(e)){var p=it(e.step)?e.step:function(){};v.animateTo({center:m,zoom:_},F({duration:v.options.zoomAnimationDuration,easing:"out"},e),p)}else e===!0&&v.setCenterAndZoom(m,_)}return this.fire("addgeo",{geometries:t}),this},i.getGeoMinZIndex=function(){return this._minZIndex},i.getGeoMaxZIndex=function(){return this._maxZIndex},i._add=function(t,e,n){this._toSort||(this._toSort=t.getZIndex()!==0),this._updateZIndex(t.getZIndex());var o=t.getId();if(!P(o)){if(!P(this._geoMap[o]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+o+", at index:"+n);this._geoMap[o]=t}var h=we();t._setInternalId(h),this._geoList.push(t),this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(t)},i.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof ot||(t[e]=this.getGeometryById(t[e])),!(!t[e]||this!==t[e].getLayer())&&t[e].remove();return this.fire("removegeo",{geometries:t}),this},i.clear=function(){this._clearing=!0,this.forEach(function(n){n.remove()}),this._geoMap={};var t=this._geoList;this._geoList=[];var e=this._getRenderer();return e&&(e.onGeometryRemove(t),e.clearImageData&&(e.clearImageData(),delete e._lastGeosToDraw)),this._clearing=!1,this.fire("clear"),this},i.onRemoveGeometry=function(t){if(!(!t||this._clearing)&&this===t.getLayer()){var e=t._getInternalId();if(!P(e)){var n=t.getId();P(n)||delete this._geoMap[n];var o=this._findInList(t);o>=0&&this._geoList.splice(o,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}}},i.getStyle=function(){return this.options.style?this.options.style:null},i.setStyle=function(t){return this.options.style=t,t=Xh(t),this._cookedStyles=Xa(t),this.forEach(function(e){this._styleGeometry(e)},this),this.fire("setstyle",{style:t}),this},i._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=Vr(t),n=0,o=this._cookedStyles.length;n<o;n++)if(this._cookedStyles[n].filter(e)===!0)return t._setExternSymbol(this._cookedStyles[n].symbol),!0;return!1},i.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach(function(t){t._setExternSymbol(null)},this),this.fire("removestyle"),this):this},i.onAddGeometry=function(t){var e=this.getStyle();e&&this._styleGeometry(t)},i.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return It.prototype.hide.call(this)},i._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},i._updateZIndex=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,e)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,e))},i._sortGeometries=function(){var t=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort(function(e,n){return t._updateZIndex(e.getZIndex(),n.getZIndex()),t._compare(e,n)}),this._toSort=!1)},i._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},i._findInList=function(t){var e=this._geoList.length;if(e===0)return-1;this._sortGeometries();for(var n=0,o=e-1,h;n<=o;){if(h=Math.floor((n+o)/2),this._geoList[h]===t)return h;this._compare(this._geoList[h],t)>0?o=h-1:n=h+1}return-1},i._onGeometryEvent=function(t){if(!(!t||!t.target)){var e=t.type;e==="idchange"?this._onGeometryIdChange(t):e==="zindexchange"?this._onGeometryZIndexChange(t):e==="positionchange"?this._onGeometryPositionChange(t):e==="shapechange"?this._onGeometryShapeChange(t):e==="symbolchange"?this._onGeometrySymbolChange(t):e==="show"?this._onGeometryShow(t):e==="hide"?this._onGeometryHide(t):e==="propertieschange"&&this._onGeometryPropertiesChange(t)}},i._onGeometryIdChange=function(t){if(!(t.new===t.old&&this._geoMap[t.old]&&this._geoMap[t.old]===t.target)){if(!P(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}!P(t.old)&&t.new!==t.old&&delete this._geoMap[t.old]}},i._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},i._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},i._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},i._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},i._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},i._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},i._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},i._hasGeoListeners=function(t){if(!t)return!1;Array.isArray(t)||(Vo[0]=t,t=Vo);for(var e=this.getGeometries()||[],n=0,o=e.length;n<o;n++){var h=e[n];if(h){if(h.options.cursor)return!0;for(var u=0,l=t.length;u<l;u++){var f=t[u],c=h.listens(f);if(c>0)return!0}}}return!1},a}(It);rl.mergeOptions(jd);var Gd=new Q,Fd={debug:!1,enableSimplify:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:q.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3,collision:!1,collisionBufferSize:2,collisionDelay:250,collisionScope:"layer",progressiveRender:!1,progressiveRenderCount:1e3,progressiveRenderDebug:!1},ye=function(s){z(a,s);function a(r,t,e){return s.call(this,r,t,e)||this}var i=a.prototype;return i.onConfig=function(t){if(s.prototype.onConfig.call(this,t),t.enableAltitude||t.drawAltitude||t.altitudeProperty){var e=this.getRenderer();e&&e.setToRedraw&&e.setToRedraw()}},i.identify=function(t,e){e===void 0&&(e={});var n=this.getRenderer();t instanceof L||(t=new L(t));var o=this.getMap().coordToContainerPoint(t);return e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(o,e):this._hitGeos(this._geoList,o,e)},i.identifyAtPoint=function(t,e){e===void 0&&(e={});var n=this.getRenderer();return t instanceof E||(t=new E(t)),e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(t,e):this._hitGeos(this._geoList,t,e)},i._hitGeos=function(t,e,n){if(n===void 0&&(n={}),!t||!t.length)return[];var o=n.filter,h=[],u=n.tolerance,l=this.getMap(),f=this.getRenderer(),c=f&&f.getImageData&&f.getImageData();if(c){var d=0,g=f.maxTolerance;if(H(g))d=g;else for(var v=t.length-1;v>=0;v--){var m=t[v]._hitTestTolerance()+(u||0);m>d&&(d=m)}var _=l.getDevicePixelRatio();c.r=_;for(var p=!1,y=e.x-d,w=e.y-d,C=-d;C<=d;C++){for(var x=-d;x<=d;x++){var M=Math.round((y+C)*_),S=Math.round((w+x)*_),T=S*c.width*4+M*4;if(c.data[T+3]>0){p=!0;break}}if(p)break}if(!p)return h}for(var b=n.onlyVisible,D=t.length-1;D>=0;D--){var R=t[D];if(!(!R||!R.options.interactive)&&!(!b&&!R.isVisible())){var k=R._getPainter();if(k){var O=k.getRenderBBOX&&k.getRenderBBOX();if(O){var A=e.x,j=e.y;if(A<O[0]||j<O[1]||A>O[2]||j>O[3])continue}if(!(R instanceof yt)||!R._getArrowStyle()&&!(R instanceof vr)){var G=R.getContainerExtent(Gd);if(u&&(G=G._expand(u)),!G||!G.contains(e))continue}if(R._containsPoint(e,u)&&(!o||o(R))&&(h.push(R),n.count&&h.length>=n.count))break}}}return h},i.getAltitude=function(){return this.options.altitude||0},i.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if(P(t.geometries)||t.geometries){var n;if(t.clipExtent){var o=this.getMap(),h=o?o.getProjection():null;n=new ft(t.clipExtent,h)}for(var u=[],l=this.getGeometries(),f=0,c=l.length;f<c;f++){var d=l[f],g=d.getExtent();if(!(!g||n&&!n.intersects(g))){var v=d.toJSON(t.geometries);u.push(v)}}e.geometries=u}return e},a.fromJSON=function(t){if(!t||t.type!=="VectorLayer")return null;for(var e=new a(t.id,t.options),n=t.geometries,o=[],h=0;h<n.length;h++){var u=ot.fromJSON(n[h]);u&&o.push(u)}return e.addGeometry(o),e},a.getPainterClass=function(){return xs},a.getCollectionPainterClass=function(){return Nu},a}(rl);ye.mergeOptions(Fd);ye.registerJSONType("VectorLayer");var Or="_map_tool",Uo=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.addTo=function(t){return t?(this._map=t,t[Or]&&t[Or].disable(),this.onAdd&&this.onAdd(),this.enable(),t[Or]=this,this._fireEvent("add"),this):this},i.getMap=function(){return this._map},i.enable=function(){var t=this._map;return!t||this._enabled?this:(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable"),this)},i.disable=function(){return!this._enabled||!this._map?this:(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this)},i.isEnabled=function(){return!!this._enabled},i.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[Or],delete this._map),this._fireEvent("remove"),this):this},i._registerEvents=function(){this._switchEvents("on")},i._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},i._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},a}(le(Bt)),Hd={symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1,zIndex:Number.MAX_VALUE,enableAltitude:!0},Jo={},Rt=function(s){z(a,s),a.registerMode=function(t,e){Jo[t.toLowerCase()]=e},a.getRegisterMode=function(t){return Jo[t.toLowerCase()]};function a(r){var t;return t=s.call(this,r)||this,t._checkMode(),t._events={click:t._clickHandler,"mousemove touchmove":t._mouseMoveHandler,dblclick:t._doubleClickHandler,"mousedown touchstart":t._mouseDownHandler,"mouseup touchend":t._mouseUpHandler,mousemove:t._mouseMoveHandler,mousedown:t._mouseDownHandler,mouseup:t._mouseUpHandler},t}var i=a.prototype;return i.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},i.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},i.getSymbol=function(){var t=this.options.symbol;return Kt(t||this.options.symbol)},i.setSymbol=function(t){return t?(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t),this):this},i.getCurrentGeometry=function(){return this._geometry},i.onAdd=function(){this._checkMode()},i.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var t=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=t.options.autoPanAtEdge,this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!0})),this._geometryEvents=t.options.geometryEvents,this.options.blockGeometryEvents&&t.config("geometryEvents",!1),this},i.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw({ignoreEndEvent:!0}),this._map&&(t.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&t.config("geometryEvents",this._geometryEvents),this},i.undo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||!this._historyPointer)return this;var n=this._clickCoords.slice(0,--this._historyPointer);return t.update(this.getMap().getProjection(),n,this._geometry),this},i.redo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||P(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var n=this._clickCoords.slice(0,++this._historyPointer);return t.update(this.getMap().getProjection(),n,this._geometry),this},i._shouldRecordHistory=function(t){return Array.isArray(t)&&t[0]==="click"&&t[1]==="mousemove"&&t[2]==="dblclick"},i._checkMode=function(){this._getRegisterMode()},i._saveMapCfg=function(){var t=this.getMap();this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom});for(var e=this._getRegisterMode().action,n=!1,o=0;o<e.length;o++)if(e[o].indexOf("mousedown")>=0||e[o].indexOf("touchstart")>=0){n=!0;break}if(n){var h=this.getMap();this._mapDraggable=h.options.draggable,h.config({draggable:!1})}},i._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),P(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},i._loadResources=function(){var t=this.getSymbol(),e=hr(t);e.length>0&&this._drawToolLayer._getRenderer().loadResources(e)},i._getProjection=function(){return this._map.getProjection()},i._getRegisterMode=function(){var t=this.getMode(),e=a.getRegisterMode(t);if(!e)throw new Error(t+" is not a valid mode of DrawTool.");return e},i.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var n=0;n<t.length;n++)e[t[n]]=this._events[t[n]];return e}return null},i._mouseDownHandler=function(t){this._createGeometry(t)},i._mouseUpHandler=function(t){this.endDraw(t)},i._clickHandler=function(t){t.enableAltitude=this.options.enableAltitude;var e=this.getMap(),n=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var o=this._clickCoords.length,h=e._pointToPrj(t.point2d);if(this._clickCoords[o-1].equals(h))return}if(!this._geometry)this._createGeometry(t);else{var u=e._pointToPrj(t.point2d);P(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer));var l=this._geometry.snapTo;if(l&&it(l)){var f=this._getSnapResult(l,t.containerPoint);if(u=f.prjCoord,this._clickCoords=this._clickCoords.concat(f.effectedVertex),this._clickCoords[this._clickCoords.length-1].equals(u))return}if(this._clickCoords.push(u),this._historyPointer=this._clickCoords.length,t.drawTool=this,n.update(e.getProjection(),this._clickCoords,this._geometry,t),this.getMode()==="point"){this.endDraw(t);return}this._clickCoords.length<=1?this._fireEvent("drawstart",t):this._fireEvent("drawvertex",t),n.clickLimit&&n.clickLimit===this._historyPointer&&this.endDraw(t)}},i._createGeometry=function(t){var e=this.getMode(),n=this._getRegisterMode(),o=this.getMap()._pointToPrj(t.point2d),h=this.getSymbol();if(!this._geometry){this._fireEvent("drawprepare",t),this._clickCoords=[o],t.drawTool=this,this._geometry=n.create(this.getMap().getProjection(),this._clickCoords,t),h&&e!=="point"?this._geometry.setSymbol(h):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t);var u=this._geometry.snapTo;if(u&&it(u)){var l=this._getSnapResult(u,t.containerPoint),f=this.getMap();if(f&&l){var c=l.prjCoord;this._clickCoords=[c],n.update(f.getProjection(),this._clickCoords,this._geometry,t)}}}e==="point"&&t.type!=="mousemove"&&this.endDraw(t)},i._mouseMoveHandler=function(t){t.enableAltitude=this.options.enableAltitude;var e=this.getMap();if(!(!e||e.isInteracting())){if(this.getMode()==="point"&&!this._geometry){this._createGeometry(t);return}if(this._geometry){var n=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(n)){var o=e._pointToPrj(t.point2d),h=[],u=this._geometry.snapTo;if(u&&it(u)){var l=this._getSnapResult(u,n);o=l.prjCoord,h=l.effectedVertex}var f=e.getProjection();t.drawTool=this;var c=this._getRegisterMode();if(this._shouldRecordHistory(c.action)){var d=this._clickCoords.slice(0,this._historyPointer);if(d&&d.length>0&&o.equals(d[d.length-1]))return;c.update(f,d.concat(h,[o]),this._geometry,t)}else c.update(f,o,this._geometry,t);this._fireEvent("mousemove",t)}}}},i._doubleClickHandler=function(t){if(t.enableAltitude=this.options.enableAltitude,!!this._geometry){var e=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(e)){var n=this._getRegisterMode(),o=this._clickCoords;if(!(!o||o.length<2)){var h=this.getMode();if(!(h&&h.indexOf("polygon")>-1&&o.length<3)){for(var u=this.getMap().getProjection(),l=[o[0]],f=1,c=o.length;f<c;f++)(o[f].x!==o[f-1].x||o[f].y!==o[f-1].y)&&l.push(o[f]);l.length<2||this._geometry&&this._geometry instanceof Ct&&l.length<3||(t.drawTool=this,n.update(u,l,this._geometry,t),this.endDraw(t))}}}}},i._addGeometryToStage=function(t){var e=this._getDrawLayer();e.addGeometry(t)},i.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,t.ignoreEndEvent||this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this._vertexes&&(this._vertexes=[]),this},i._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},i._getMouseContainerPoint=function(t){var e=this._getRegisterMode().action;return(e[0].indexOf("mousedown")>=0||e[0].indexOf("touchstart")>=0)&&jt(t.domEvent),t.containerPoint},i._isValidContainerPoint=function(t){var e=this._map.getSize(),n=e.width,o=e.height;return t.x<0||t.y<0?!1:!(t.x>n||t.y>o)},i._getSnapResult=function(t,e){var n=this.getMap(),o=[];if(this.options.edgeAutoComplete){var h=this._clickCoords[(this._historyPointer||1)-1];o.push(n._prjToContainerPoint(h));var u=this._clickCoords[(this._historyPointer||1)-2];u&&o.push(n._prjToContainerPoint(u))}var l=t(e,o);e=(l.effectedVertex?l.point:l)||e;var f=n._containerPointToPrj(e);return l.effectedVertex&&(l.effectedVertex=l.effectedVertex.map(function(c){return n._containerPointToPrj(c)})),{prjCoord:f,effectedVertex:l.effectedVertex||[]}},i._getDrawLayer=function(){var t=or+"drawtool",e=this._map.getLayer(t);return e||(e=new ye(t,{enableSimplify:!1,enableAltitude:this.options.enableAltitude,zIndex:this.options.zIndex}),this._map.addLayer(e)),this._pushLayers(e),e},i._fireEvent=function(t,e){e||(e={}),e=F({},e),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}),e.tempGeometry=this._geometry),Uo.prototype._fireEvent.call(this,t,e)},i._pushLayers=function(t){var e=this;return t?(Array.isArray(t)||(t=[t]),this._layers=this._layers||[],t.forEach(function(n){e._layers.indexOf(n)===-1&&e._layers.push(n)}),this):this},i._outLayers=function(t){var e=this;return t?(Array.isArray(t)||(t=[t]),this._layers=this._layers||[],t.forEach(function(n){for(var o=0,h=e._layers.length;o<h;o++)if(n===e._layers[o]){e._layers.splice(o,1);break}}),this):this},i.setLayerZIndex=function(t){return H(t)?(this.options.zIndex=t,this._layers=this._layers||[],this._layers.forEach(function(e){e&&e.setZIndex&&e.setZIndex(t)}),this):this},a}(Uo);Rt.mergeOptions(Hd);var Nd=function(s){z(a,s);function a(r){var t;return t=s.call(this,r)||this,t.drawTool=new Rt({mode:"boxZoom",ignoreMouseleave:!1}),t}var i=a.prototype;return i.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},i.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},i._onMouseDown=function(t){this.target.options.boxZoom&&t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},i._boxZoom=function(t){var e=this.target;this.drawTool.remove();var n=t.geometry,o=n.getCenter(),h=n.getSymbol(),u=h.markerWidth,l=h.markerHeight,f=new ft(o,e.locateByPoint(o,u,l),e.getProjection()),c=e.getFitZoom(f);e._animateTo({center:f.getCenter(),zoom:c})},a}(ae);$.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}});$.addOnLoadHook("addHandler","boxZoom",Nd);var Se=30,Bd=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},i.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},i._onMouseMove=function(t){var e=this.target;if(e.options.autoPanAtEdge){var n=t.containerPoint,o=e.getContainerExtent();if(o){var h=n.x,u=n.y,l=o.xmax,f=o.ymax,c;h<Se&&(c=[Math.abs(h-Se),0]),u<Se&&(c=[0,Math.abs(u-Se)]),h+Se>l&&(c=[-Math.abs(h+Se-l),0]),u+Se>f&&(c=[0,-Math.abs(u+Se-f)]),c&&e.panBy(c,{duration:1})}}},a}(ae);$.mergeOptions({autoPanAtEdge:!1});$.addOnLoadHook("addHandler","autoPanAtEdge",Bd);$.include({animateTo:function(a,i,r){var t=this;i===void 0&&(i={}),a=F({},this.getView(),a),it(i)&&(r=i,i={});var e=this.getProjection(),n=this.getView(),o={},h=!0;for(var u in a)if(wi(a,u)&&!P(a[u])&&(u==="prjCenter"||!P(n[u])))if(h=!1,u==="center"){var l=new L(n[u]),f=new L(a[u]);l.equals(f)||(o.center=[l,f])}else if(u==="prjCenter"){var c=new L(this._getPrjCenter()),d=new L(a[u]);c.equals(d)||(o.prjCenter=[c,d])}else n[u]!==a[u]&&u!=="around"&&(o[u]=[n[u],a[u]]);if(h)return null;this._animPlayer&&(this._isInternalAnimation?this._animPlayer.playState==="running"&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var g=a.around||new E(this.width/2,this.height/2),v=this._getRenderer(),m=function(y){v.callInNextFrame(y)},_=this._animPlayer=Et.animate(o,{easing:i.easing||"out",duration:i.duration||this.options.zoomAnimationDuration,framer:m,repeat:i.repeat},function(p){if(t.isRemoved()){_.finish();return}if(_.playState==="running"){if(p.styles.center){var y=p.styles.center;t._setPrjCenter(e.project(y)),t.onMoving(t._parseEventFromCoord(t.getCenter()))}else if(p.styles.prjCenter){var w=p.styles.prjCenter;t._setPrjCenter(w),t.onMoving(t._parseEventFromCoord(t.getCenter()))}P(p.styles.zoom)||t.onZooming(p.styles.zoom,g),P(p.styles.pitch)||t._setPitch(p.styles.pitch),P(p.styles.bearing)||t._setBearing(p.styles.bearing),t._fireEvent("animating")}else(_.playState!=="paused"||_===t._mapAnimPlayer)&&(_._interupted||(o.center?t._setPrjCenter(e.project(o.center[1])):o.prjCenter&&t._setPrjCenter(o.prjCenter[1]),P(o.pitch)||t._setPitch(o.pitch[1]),P(o.bearing)||t._setBearing(o.bearing[1])),t._endAnim(_,o,g,i));r&&r(p)},this);return this._startAnim(o,g),_},_animateTo:function(a,i,r){return i===void 0&&(i={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(a,i,r),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(a,i,r){var t=this;i===void 0&&(i={}),a=F({},this.getView(),a),this._animPlayer&&(this._isInternalAnimation?this._animPlayer.playState==="running"&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),it(i)&&(r=i,i={}),i=F({curve:1.42},i);var e=this;function n(X,et){return e.getResolution(et)/e.getResolution(X)}var o=a.around||new E(this.width/2,this.height/2),h=this.getMinZoom(),u=this.getMaxZoom(),l=this.getProjection(),f=this.getView(),c=f.zoom,d=f.bearing,g=f.pitch,v="zoom"in a?Br(+a.zoom,h,u):c,m="bearing"in a?+a.bearing:d,_="pitch"in a?+a.pitch:g,p=l.project(a.center&&new L(a.center)||this.getCenter()),y=n(v,c),w=l.project(this.getCenter()),C=p.sub(w),x=i.curve,M=Math.max(this.width,this.height),S=M/y,T=C.mag();if("minZoom"in i){var b=Br(Math.min(i.minZoom,c,v),h,u),D=M/n(b,c);x=Math.sqrt(D/T*2)}var R=x*x;function k(X){var et=(S*S-M*M+(X?-1:1)*R*R*T*T)/(2*(X?S:M)*R*T);return Math.log(Math.sqrt(et*et+1)-et)}function O(X){return(Math.exp(X)-Math.exp(-X))/2}function A(X){return(Math.exp(X)+Math.exp(-X))/2}function j(X){return O(X)/A(X)}var G=k(0),N=function(et){return A(G)/A(G+x*et)},B=function(et){return M*((A(G)*j(G+x*et)-O(G))/R)/T},Z=(k(1)-G)/x;if(Math.abs(T)<1e-6||!isFinite(Z)){if(Math.abs(M-S)<1e-6)return this.animateTo(a,i,r);var U=S<M?-1:1;Z=Math.abs(Math.log(S/M))/x,B=function(){return 0},N=function(et){return Math.exp(U*x*et)}}var J=this._getRenderer(),ht=function(et){J.callInNextFrame(et)},Y=this._animPlayer=Et.animate({k:[0,1]},{easing:i.easing||"out",duration:i.duration||8,framer:ht},function(X){if(t.isRemoved()){Y.finish();return}var et=X.styles.k,ut=et*Z,Pt=1/N(ut),K={};if(a.center){var dt=et===1?p:w.add(C.multi(B(ut)));K.prjCenter=[p,dt]}if(c!==v){var vt=et===1?v:t.getZoomForScale(Pt,c,!0);K.zoom=[c,vt]}if(g!==_){var nt=Xo(g,_,et);K.pitch=[_,nt]}if(d!==m){var ct=Xo(d,m,et);K.bearing=[m,ct]}if(Y.playState==="running"){if(K.prjCenter){var Tt=K.prjCenter;t._setPrjCenter(Tt[1]),t.onMoving(t._parseEventFromCoord(t.getCenter()))}K.zoom&&t.onZooming(K.zoom[1],o),K.pitch&&t._setPitch(K.pitch[1]),K.bearing&&t._setBearing(K.bearing[1]),t._fireEvent("animating")}else(Y.playState!=="paused"||Y===t._mapAnimPlayer)&&(Y._interupted||(K.prjCenter&&t._setPrjCenter(K.prjCenter[1]),K.pitch&&t._setPitch(K.pitch[1]),K.bearing&&t._setBearing(K.bearing[1])),t._endAnim(Y,K,o,i));r&&r(X)});return this._startAnim({center:a.center,zoom:a.zoom!==c,pitch:_!==g,bearing:m!==d},o),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(a,i,r,t){delete this._animRotating;var e=a._interupted?"animateinterrupted":"animateend";if(a===this._animPlayer&&delete this._animPlayer,a===this._mapAnimPlayer&&delete this._mapAnimPlayer,i.center){var n;a._interupted?n=this.getCenter():n=i.center[1],this.onMoveEnd(this._parseEventFromCoord(n))}else if(i.prjCenter){var o;a._interupted?o=this._getPrjCenter():o=i.prjCenter[1];var h=this._parseEventFromCoord(this.getProjection().unproject(o));h.point2d=this._prjToPoint(o),this.onMoveEnd(h)}P(i.zoom)||(a._interupted?this.onZoomEnd(this.getZoom()):t.wheelZoom?this.onZooming(i.zoom[1],r):this.onZoomEnd(i.zoom[1])),e&&this._fireEvent(e),!P(i.pitch)&&!this.getPitch()&&this.getRenderer().setToRedraw(),t.wheelZoom||this._resumePrev(a)},_startAnim:function(a,i){this._animPlayer&&((a.center||a.prjCenter)&&this.onMoveStart(),a.zoom&&!this.isZooming()&&this.onZoomStart(a.zoom[1],i),(a.pitch||a.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(a){a&&(delete this._animRotating,a.playState!=="finished"&&(a._interupted=!0,a.cancel()),a===this._animPlayer&&delete this._animPlayer,a===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(a){if(this._prevAnimPlayer){var i=this._prevAnimPlayer;i.playState!=="paused"&&delete this._prevAnimPlayer,a!==i&&(this._animPlayer=i,i.play())}}});function Xo(s,a,i){return s*(1-i)+a*i}function qo(s){s.stopPropagation(),s.preventDefault()}var $o=["dragstart","dragenter","dragend","dragleave","dragover"].join(" ").toString(),Yo="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend drop ";$.include({_registerDomEvents:function(){var a=this._panels.mapWrapper||this._containerDOM;Xt(a,Yo,this._handleDOMEvent,this),Xt(a,$o,qo,this)},_removeDomEvents:function(){var a=this._panels.mapWrapper||this._containerDOM;De(a,Yo,this._handleDOMEvent),De(a,$o,qo)},_handleDOMEvent:function(a){if(a&&a.type==="drop"){a.stopPropagation(),a.preventDefault();var i=this._parseEvent(a,a.type);i=F({},i,{dataTransfer:a.dataTransfer}),this._fireEvent(a.type,i);return}var r=this.options.clickTimeThreshold,t=a.type;if(!(ir(t)&&!Qt.isTest&&ns(this,this.options.mousemoveThrottleTime))){var e=t==="mousedown"||t==="touchstart"&&(!a.touches||a.touches.length===1);e&&(this._domMouseDownTime=at(),this._domMouseDownView=this.getView());var n=t==="contextmenu"&&Zd(this);if(t==="contextmenu"){ue(a);var o=this._domMouseDownTime,h=at();h-o<=r&&!n&&this._fireDOMEvent(this,a,"dom:"+a.type)}else this._fireDOMEvent(this,a,"dom:"+a.type);if(!(this._ignoreEvent(a)||this._isEventOutMap(a))){var u=!1;if(e)this._mouseDownTime=at();else if(t==="click"||t==="touchend"||t==="contextmenu")if(this._mouseDownTime){var l=this._mouseDownTime;delete this._mouseDownTime;var f=at();if(f-l>r){if(t==="click"||t==="contextmenu")return}else if(t==="contextmenu"){if(n)return}else t==="touchend"&&(u=!0)}else return;var c;u&&(this._clickTime&&at()-this._clickTime<=r?(delete this._clickTime,c="dblclick",this._fireDOMEvent(this,a,"dom:dblclick")):(this._clickTime=at(),c="click",this._fireDOMEvent(this,a,"dom:click"))),!(this._ignoreEvent(a)||this._isEventOutMap(a))&&(this._fireDOMEvent(this,a,t),c&&this._fireDOMEvent(this,a,c))}}},_ignoreEvent:function(a){if(!a||!this._panels.control)return!1;var i=a.srcElement||a.target,r;if(i)for(;i&&i!==this._containerDOM;){if(i.className&&i.className.indexOf&&(i.className.indexOf("maptalks-control")>=0||i.className.indexOf("maptalks-ui")>=0&&r&&!r.eventsPropagation))return!0;r=i,i=i.parentNode}return!1},_isEventOutMap:function(a){if(this.getPitch()>this.options.maxVisualPitch){var i=this._getActualEvent(a),r=Ht(i,this._containerDOM);if(!this.getContainerExtent().contains(r))return!0}return!1},_wrapTerrainData:function(a){a.containerPoint&&!a.terrain&&(a.terrain=this._queryTerrainInfo(a.containerPoint))},_parseEvent:function(a,i){if(!a)return null;var r={domEvent:a};if(i!=="keypress"){var t=this._getActualEvent(a);if(t&&t.clientX!==void 0){var e=Ht(t,this._containerDOM);r=F(r,{containerPoint:e,viewPoint:this.containerPointToViewPoint(e)});var n=this.options.maxVisualPitch;(this.getPitch()<=n||e.y>=this.height-this._getVisualHeight(n))&&(r=F(r,{coordinate:this.containerPointToCoord(e),point2d:this._containerPointToPoint(e)}))}}return this._wrapTerrainData(r),r},_parseEventFromCoord:function(a){var i=this.coordToContainerPoint(a),r=this.containerPointToViewPoint(i),t={coordinate:a,containerPoint:i,viewPoint:r,point2d:this.coordToPoint(a)};return t},_getActualEvent:function(a){return a.touches&&a.touches.length>0?a.touches[0]:a.changedTouches&&a.changedTouches.length>0?a.changedTouches[0]:a},_fireDOMEvent:function(a,i,r){var t=this;if(!this.isRemoved()){var e=this._parseEvent(i,r);this._wrapTerrainData(e),ir(r)?this.getRenderer().callInNextFrame(function(){if(e.domEvent&&e.domEvent._cancelBubble){t._fireEvent("_"+r,e);return}t._fireEvent(r,e)}):this._fireEvent(r,e)}},_getEventParams:function(a){var i=this,r={domEvent:a},t=a.touches&&a.touches.length>0?a.touches[0]:a.changedTouches&&a.changedTouches.length>0?a.changedTouches[0]:a;if(t){var e=Ht(t,i._containerDOM);r.coordinate=i.containerPointToCoordinate(e),r.containerPoint=e,r.viewPoint=i.containerPointToViewPoint(e),r.pont2d=i._containerPointToPoint(e)}return this._wrapTerrainData(r),r}});$.addOnLoadHook("_registerDomEvents");function Zd(s){if(!s._domMouseDownView)return!0;var a=s.getView(),i=s._domMouseDownView;return a.bearing!==i.bearing||a.pitch!==i.pitch}$.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(a){return this._fireEvent("fullscreenstart"),this._requestFullScreen(a||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(a){if(a.requestFullscreen)a.requestFullscreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else if(a.webkitRequestFullScreen)a.webkitRequestFullScreen();else if(a.msRequestFullScreen)a.msRequestFullScreen();else{var i="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45),r=window.open(location.href,"_blank",i);r!==null&&(window.opener=null,window.close())}},_cancelFullScreen:function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else{var a="fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes",i=window.open(location.href,"_blank",a);i!==null&&(window.opener=null,window.close())}}});$.include({panTo:function(a,i,r){if(i===void 0&&(i={}),!a)return this;if(it(i)&&(r=i,i={}),a=new L(a),typeof i.animation>"u"||i.animation){var t=this.getProjection().project(a);return this._panAnimation(t,i.duration,r)}else this.setCenter(a);return this},_panTo:function(a,i){return i===void 0&&(i={}),typeof i.animation>"u"||i.animation?this._panAnimation(a,i.duration):(this.onMoveStart(),this._setPrjCenter(a),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(a,i,r){if(i===void 0&&(i={}),!a)return this;it(i)&&(r=i,i={}),a=new E(a);var t=this.getContainerExtent(),e=t.ymin;if(e>0&&a.y>30){var n=a.y;a.y=30,a.x=a.x*30/n,console.warn("offset is limited to panBy when pitch is above maxPitch")}if(typeof i.animation>"u"||i.animation){a=a.multi(-1);var o=this._containerPointToPrj(new E(this.width/2+a.x,this.height/2+a.y));this._panAnimation(o,i.duration,r)}else{this.onMoveStart(),this._offsetCenterByPixel(a);var h=this.containerPointToCoord(new E(this.width/2,this.height/2));this.onMoveEnd(this._parseEventFromCoord(h))}return this},_panAnimation:function(a,i,r){return this._animateTo({prjCenter:a},{duration:i||this.options.panAnimationDuration},r)}});ot.fromJSON=function(s){if(Array.isArray(s)){for(var a=[],i=0,r=s.length;i<r;i++){var t=ot.fromJSON(s[i]);Array.isArray(s)?a=a.concat(t):a.push(t)}return a}if(s&&!s.feature)return Ut.toGeometry(s);var e;return s.subType?(e=ot.getJSONClass(s.subType).fromJSON(s),P(s.feature.id)||e.setId(s.feature.id)):(e=Ut.toGeometry(s.feature),s.options&&e.config(s.options)),s.symbol&&e.setSymbol(s.symbol),s.infoWindow&&e.setInfoWindow(s.infoWindow),e};It.fromJSON=function(s){if(!s)return null;var a=s.type,i=It.getJSONClass(a);if(!i||!i.fromJSON)throw new Error("unsupported layer type:"+a);return i.fromJSON(s)};$.include({JSON_VERSION:"1.0",toJSON:function(a){a||(a={});var i={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};i.options=this.config(),i.options.center=this.getCenter(),i.options.zoom=this.getZoom(),i.options.bearing=this.getBearing(),i.options.pitch=this.getPitch();var r=this.getBaseLayer();(P(a.baseLayer)||a.baseLayer)&&r&&(i.baseLayer=r.toJSON(a.baseLayer));var t={};a.clipExtent&&(a.clipExtent===!0?t.clipExtent=this.getExtent():t.clipExtent=a.clipExtent);var e=[];if(P(a.layers)||a.layers&&!Array.isArray(a.layers)){for(var n=this.getLayers(),o=0,h=n.length;o<h;o++)if(n[o].toJSON){var u=F({},ee(a.layers)?a.layers:{},t);e.push(n[o].toJSON(u))}i.layers=e}else if(st(a.layers)){for(var l=a.layers,f=0;f<l.length;f++){var c=l[f],d=this.getLayer(c.id);if(d.toJSON){var g=F({},c.options,t);e.push(d.toJSON(g))}}i.layers=e}else i.layers=[];return i}});$.fromJSON=function(s,a,i){if(!s||!a)return null;i||(i={});var r=new $(s,a.options);if(P(i.baseLayer)||i.baseLayer){var t=It.fromJSON(a.baseLayer);t&&r.setBaseLayer(t)}if(P(i.layers)||i.layers){for(var e=[],n=a.layers,o=0;o<n.length;o++){var h=It.fromJSON(n[o]);e.push(h)}r.addLayer(e)}return r};$.include({computeLength:function(a,i){if(!this.getProjection())return null;var r=new L(a),t=new L(i);return r.equals(t)?0:this.getProjection().measureLength(r,t)},computeGeometryLength:function(a){return a._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(a){return a._computeGeodesicArea(this.getProjection())},identify:function(a,i){a=a||{};var r=new L(a.coordinate);return this._identify(a,i,function(t){return t.identify(r,a)})},identifyAtPoint:function(a,i){var r=a.includeInternals,t=a.tolerance;a=a||{};var e=new E(a.containerPoint),n=this.containerPointToCoord(e);return this._identify(a,i,function(o){var h,u=a.containerPoint;if(r&&!P(o.options.geometryEventTolerance)&&(a.tolerance=a.tolerance||0,a.tolerance+=o.options.geometryEventTolerance),o._hasGeoListeners&&r&&a.eventTypes.indexOf("mousemove")>=0&&!o._hasGeoListeners(a.eventTypes))return[];if(o.identifyAtPoint?h=o.identifyAtPoint(u,a):n&&o.identify?h=o.identify(n,a):h=[],r&&(P(t)?delete a.tolerance:a.tolerance=t),(!h||!h.length)&&(o.fire("identifyempty",a),o.getLayers&&it(o.getLayers))){var l=(o.getLayers()||[]).filter(function(f){return f});l.forEach(function(f){f.fire("identifyempty",a)})}return h})},_identify:function(a,i,r){var t=a.layers;if(!st(t))return this;for(var e=a.eventTypes,n=[],o=0,h=t.length;o<h;o++)tt(t[o])?n.push(this.getLayer(t[o])):n.push(t[o]);e&&(n=n.filter(function(v){return v._hasGeoListeners?v._hasGeoListeners(e):!0}));for(var u=[],l=n.length-1;l>=0&&!(a.count&&u.length>=a.count);l--){var f=n[l];if(!(!f||!f.getMap()||!a.includeInvisible&&!f.isVisible()||!a.includeInternals&&f.getId().indexOf(or)>=0)){var c=r(f),d=f.getId();if(c)if(Array.isArray(c)){for(var g=0;g<c.length;g++)c[g]&&!c[g].getLayer&&P(c[g].layer)&&(c[g].layer=d);ie(u,c)}else!c.getLayer&&P(c.layer)&&(c.layer=d),u.push(c)}}return i.call(this,u),this}});$.include({_zoom:function(a,i){!this.options.zoomable||this.isZooming()||(i=this._checkZoomOrigin(i),a=this._checkZoom(a),this.onZoomStart(a,i),this._frameZoom=this.getZoom(),this.onZoomEnd(a,i))},_zoomAnimation:function(a,i,r){!this.options.zoomable||this.isZooming()||(a=this._checkZoom(a),this.getZoom()!==a&&(i=this._checkZoomOrigin(i),this._startZoomAnim(a,i,r)))},_checkZoomOrigin:function(a){return(!a||this.options.zoomInCenter)&&(a=new E(this.width/2,this.height/2)),this.options.zoomOrigin&&(a=new E(this.options.zoomOrigin)),a},_startZoomAnim:function(a,i,r){P(r)&&(r=1);var t=this._getResolution(this._startZoomVal)/this._getResolution(a),e=this.options.zoomAnimationDuration*Math.abs(t-r)/Math.abs(t-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:a,around:i},{continueOnViewChanged:!0,duration:e})},onZoomStart:function(a,i){!this.options.zoomable||this.isZooming()||(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),delete this.cameraZenithDistance,this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(i),this._fireEvent("zoomstart",{from:this._startZoomVal,to:a}))},onZooming:function(a,i,r){if(this.options.zoomable){var t=this._frameZoom;if(t!==a){P(r)&&(r=1),this._zoomTo(a,i);var e=this.getResolution(a),n=this.getResolution(this._startZoomVal),o=n/e/r,h=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),u=this.getViewPoint();if(!this.isRotating()&&!h.equals(i)&&o!==1){var l=this.getPitch(),f=h._sub(i)._multi(1/(1-o));l&&(f.y/=Math.cos(l*Math.PI/180)),i=i.add(f)}var c={view:[o,0,0,o,(i.x-u.x)*(1-o),(i.y-u.y)*(1-o)]},d=this.getDevicePixelRatio();d!==1&&(i=i.multi(d)),c.container=[o,0,0,o,i.x*(1-o),i.y*(1-o)],this._fireEvent("zooming",{from:this._startZoomVal,to:a,origin:i,matrix:c}),this._frameZoom=a}}},onZoomEnd:function(a,i){if(this.options.zoomable){var r=this._startZoomVal;this._zoomTo(a,i),this._zooming=!1,this._getRenderer().onZoomEnd(),this._suppressRecenter||this._recenterOnTerrain(),this._fireEvent("zoomend",{from:r,to:a}),this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(a,i){if(this._zoomLevel=a,this._calcMatrices(),i){var r=this._containerPointToPoint(i),t=r._sub(this._prjToPoint(this._getPrjCenter()));this._setPrjCoordAtOffsetToCenter(this._startZoomCoord,t)}},_checkZoom:function(a){var i=this.getMaxZoom(),r=this.getMinZoom();return a<r&&(a=r),a>i&&(a=i),a}});function Qo(s,a,i,r,t){var e=1/Math.tan(a/2),n=1/(r-t);return s[0]=e/i,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=(t+r)*n,s[11]=-1,s[12]=0,s[13]=0,s[14]=2*t*r*n,s[15]=0,s}function nl(s,a,i){var r=i[0],t=i[1],e=i[2],n,o,h,u,l,f,c,d,g,v,m,_;return a===s?(s[12]=a[0]*r+a[4]*t+a[8]*e+a[12],s[13]=a[1]*r+a[5]*t+a[9]*e+a[13],s[14]=a[2]*r+a[6]*t+a[10]*e+a[14],s[15]=a[3]*r+a[7]*t+a[11]*e+a[15]):(n=a[0],o=a[1],h=a[2],u=a[3],l=a[4],f=a[5],c=a[6],d=a[7],g=a[8],v=a[9],m=a[10],_=a[11],s[0]=n,s[1]=o,s[2]=h,s[3]=u,s[4]=l,s[5]=f,s[6]=c,s[7]=d,s[8]=g,s[9]=v,s[10]=m,s[11]=_,s[12]=n*r+l*t+g*e+a[12],s[13]=o*r+f*t+v*e+a[13],s[14]=h*r+c*t+m*e+a[14],s[15]=u*r+d*t+_*e+a[15]),s}function ja(s,a,i){var r=i[0],t=i[1],e=i[2];return s[0]=a[0]*r,s[1]=a[1]*r,s[2]=a[2]*r,s[3]=a[3]*r,s[4]=a[4]*t,s[5]=a[5]*t,s[6]=a[6]*t,s[7]=a[7]*t,s[8]=a[8]*e,s[9]=a[9]*e,s[10]=a[10]*e,s[11]=a[11]*e,s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s}function Wd(s,a,i){var r=Math.sin(i),t=Math.cos(i),e=a[4],n=a[5],o=a[6],h=a[7],u=a[8],l=a[9],f=a[10],c=a[11];return a!==s&&(s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15]),s[4]=e*t+u*r,s[5]=n*t+l*r,s[6]=o*t+f*r,s[7]=h*t+c*r,s[8]=u*t-e*r,s[9]=l*t-n*r,s[10]=f*t-o*r,s[11]=c*t-h*r,s}function Vd(s,a,i){var r=Math.sin(i),t=Math.cos(i),e=a[0],n=a[1],o=a[2],h=a[3],u=a[4],l=a[5],f=a[6],c=a[7];return a!==s&&(s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15]),s[0]=e*t+u*r,s[1]=n*t+l*r,s[2]=o*t+f*r,s[3]=h*t+c*r,s[4]=u*t-e*r,s[5]=l*t-n*r,s[6]=f*t-o*r,s[7]=c*t-h*r,s}function Wi(s,a,i){var r=a[0],t=a[1],e=a[2],n=a[3],o=a[4],h=a[5],u=a[6],l=a[7],f=a[8],c=a[9],d=a[10],g=a[11],v=a[12],m=a[13],_=a[14],p=a[15],y=i[0],w=i[1],C=i[2],x=i[3];return s[0]=y*r+w*o+C*f+x*v,s[1]=y*t+w*h+C*c+x*m,s[2]=y*e+w*u+C*d+x*_,s[3]=y*n+w*l+C*g+x*p,y=i[4],w=i[5],C=i[6],x=i[7],s[4]=y*r+w*o+C*f+x*v,s[5]=y*t+w*h+C*c+x*m,s[6]=y*e+w*u+C*d+x*_,s[7]=y*n+w*l+C*g+x*p,y=i[8],w=i[9],C=i[10],x=i[11],s[8]=y*r+w*o+C*f+x*v,s[9]=y*t+w*h+C*c+x*m,s[10]=y*e+w*u+C*d+x*_,s[11]=y*n+w*l+C*g+x*p,y=i[12],w=i[13],C=i[14],x=i[15],s[12]=y*r+w*o+C*f+x*v,s[13]=y*t+w*h+C*c+x*m,s[14]=y*e+w*u+C*d+x*_,s[15]=y*n+w*l+C*g+x*p,s}function Ko(s,a){var i=a[0],r=a[1],t=a[2],e=a[3],n=a[4],o=a[5],h=a[6],u=a[7],l=a[8],f=a[9],c=a[10],d=a[11],g=a[12],v=a[13],m=a[14],_=a[15],p=i*o-r*n,y=i*h-t*n,w=i*u-e*n,C=r*h-t*o,x=r*u-e*o,M=t*u-e*h,S=l*v-f*g,T=l*m-c*g,b=l*_-d*g,D=f*m-c*v,R=f*_-d*v,k=c*_-d*m,O=p*k-y*R+w*D+C*b-x*T+M*S;return O?(O=1/O,s[0]=(o*k-h*R+u*D)*O,s[1]=(t*R-r*k-e*D)*O,s[2]=(v*M-m*x+_*C)*O,s[3]=(c*x-f*M-d*C)*O,s[4]=(h*b-n*k-u*T)*O,s[5]=(i*k-t*b+e*T)*O,s[6]=(m*w-g*M-_*y)*O,s[7]=(l*M-c*w+d*y)*O,s[8]=(n*R-o*b+u*S)*O,s[9]=(r*b-i*R-e*S)*O,s[10]=(g*x-v*w+_*p)*O,s[11]=(f*w-l*x-d*p)*O,s[12]=(o*T-n*D-h*S)*O,s[13]=(i*D-r*T+t*S)*O,s[14]=(v*y-g*C-m*p)*O,s[15]=(l*C-f*y+c*p)*O,s):null}function Ms(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function th(s,a){return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s}function zt(s,a,i,r){return s[0]=a,s[1]=i,s[2]=r,s}function Ud(s,a,i){return s[0]=a[0]+i[0],s[1]=a[1]+i[1],s[2]=a[2]+i[2],s}function Vi(s,a,i){return s[0]=a[0]-i[0],s[1]=a[1]-i[1],s[2]=a[2]-i[2],s}function eh(s){var a=s[0],i=s[1],r=s[2];return Math.sqrt(a*a+i*i+r*r)}function yi(s,a){var i=a[0],r=a[1],t=a[2],e=i*i+r*r+t*t;return e>0&&(e=1/Math.sqrt(e),s[0]=a[0]*e,s[1]=a[1]*e,s[2]=a[2]*e),s}function al(s,a){return s[0]*a[0]+s[1]*a[1]+s[2]*a[2]}function Jd(s,a,i){return s[0]=a[0]*i,s[1]=a[1]*i,s[2]=a[2]*i,s}function ua(s,a,i){var r=a[0],t=a[1],e=a[2],n=i[0],o=i[1],h=i[2];return s[0]=t*h-e*o,s[1]=e*n-r*h,s[2]=r*o-t*n,s}function Ga(s,a){var i=a[0]-s[0],r=a[1]-s[1],t=a[2]-s[2];return Math.hypot?Math.hypot(i,r,t):qd(i,r,t)}function Xd(s,a,i){var r=a[0],t=a[1],e=a[2],n=i[3]*r+i[7]*t+i[11]*e+i[15];return n=n||1,s[0]=(i[0]*r+i[4]*t+i[8]*e+i[12])/n,s[1]=(i[1]*r+i[5]*t+i[9]*e+i[13])/n,s[2]=(i[2]*r+i[6]*t+i[10]*e+i[14])/n,s}function qd(){for(var s=0,a=arguments.length;a--;)s+=arguments[a]*arguments[a];return Math.sqrt(s)}function ih(s,a){yi(s,s),yi(a,a);var i=al(s,a);return i>1?0:i<-1?Math.PI:Math.acos(i)}function la(s,a,i){var r=a[0],t=a[1],e=a[2],n=1/(i[3]*r+i[7]*t+i[11]*e+i[15]);return s[0]=(i[0]*r+i[4]*t+i[8]*e+i[12])*n,s[1]=(i[1]*r+i[5]*t+i[9]*e+i[13])*n,s[2]=(i[2]*r+i[6]*t+i[10]*e+i[14])*n,s}function $d(s,a){var i=a[0],r=a[4],t=a[8],e=a[1],n=a[5],o=a[9],h=a[2],u=a[6],l=a[10],f=i+n+l,c;return f>0?(c=.5/Math.sqrt(f+1),s.w=.25/c,s.x=(u-o)*c,s.y=(t-h)*c,s.z=(e-r)*c):i>n&&i>l?(c=2*Math.sqrt(1+i-n-l),s.w=(u-o)/c,s.x=.25*c,s.y=(r+e)/c,s.z=(t+h)/c):n>l?(c=2*Math.sqrt(1+n-i-l),s.w=(t-h)/c,s.x=(r+e)/c,s.y=.25*c,s.z=(o+u)/c):(c=2*Math.sqrt(1+l-i-n),s.w=(e-r)/c,s.x=(t+h)/c,s.y=(o+u)/c,s.z=.25*c),this}function Yd(s,a){var i=s,r=a.x,t=a.y,e=a.z,n=a.w,o=r+r,h=t+t,u=e+e,l=r*o,f=r*h,c=r*u,d=t*h,g=t*u,v=e*u,m=n*o,_=n*h,p=n*u;return i[0]=1-(d+v),i[4]=f-p,i[8]=c+_,i[1]=f+p,i[5]=1-(l+v),i[9]=g-m,i[2]=c-_,i[6]=g+m,i[10]=1-(l+d),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Qd(s,a){var i=s;return i[12]=a[0],i[13]=a[1],i[14]=a[2],s}function Kd(s,a,i,r){var t=[0,0,0],e=[0,0,0],n=[0,0,0];return Vi(n,a,i),eh(n)===0&&(n[2]=1),yi(n,n),ua(t,r,n),eh(n)===0&&(Math.abs(r[2])===1?n[0]+=1e-4:n[2]+=1e-4,yi(n,n),ua(t,r,n)),yi(t,t),ua(e,n,t),s[0]=t[0],s[4]=e[0],s[8]=n[0],s[1]=t[1],s[5]=e[1],s[9]=n[1],s[2]=t[2],s[6]=e[2],s[10]=n[2],s}var Nt=Math.PI/180,tg=.6435011087932844,fa=new L(0,0),rh=new E(0,0),eg=[0,-1,0],nh=[],ig=function(a){if(H(a))return a!==0;if(Array.isArray(a)&&a.length>0){for(var i=0,r=a.length;i<r;i++)if(H(a[i])&&a[i]!==0)return!0}return!1};$.include({getFov:function(){return this._fov||(this._fov=tg),this._fov/Nt},setFov:function(a){if(this.isZooming())return this;if(a=Math.max(.01,Math.min(60,a)),this._fov===a)return this;var i=this.getFov();return this._fov=a*Nt,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:i,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/Nt:0},setBearing:function(a){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(a)},_setBearing:function(a){if(q.ie9)throw new Error("map can't rotate in IE9.");var i=-me(a,-180,180)*Nt;if(this._angle===i)return this;var r=this.getBearing();return this._fireEvent("rotatestart",{from:r,to:i}),this._angle=i,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:r,to:i}),this._fireEvent("rotateend",{from:r,to:i}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(a){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(a)},_setPitch:function(a){if(q.ie9)throw new Error("map can't tilt in IE9.");var i=Br(a,0,this.options.maxPitch)*Nt;if(this._pitch===i)return this;var r=this.getPitch();return this._fireEvent("pitchstart",{from:r,to:i}),this._pitch=i,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:r,to:i}),this._fireEvent("pitchend",{from:r,to:i}),this},setCameraMovements:function(a,i){var r=this;if(!Array.isArray(a)||!a.length)return this;if(this.setView({center:a[0].center,zoom:a[0].zoom,pitch:a[0].pitch,bearing:a[0].bearing}),a.length===1)return this;var t=1,e=function(d){if(d.state.playState==="finished"){t++,t===a.length-1&&(e=null);var g=a[t];g.duration=g.timestamp-a[t-1].timestamp,i&&i.autoRotate&&(g.bearing=rg(a[t-1].center,g.center)),r._setCameraMovement(g,e)}};a.length===2&&(e=null);var n=this.getBearing();this._setCameraMovement(ya({bearing:n},a[t],{duration:a[t].timestamp-a[t-1].timestamp}),e);var o=function(){r._animPlayer.play()},h=function(){r._animPlayer.pause()},u=function(){r._animPlayer.cancel()},l=function(){r._animPlayer.finish()},f=function(){r._animPlayer.reverse()};return{play:o,pause:h,cancel:u,finish:l,reverse:f}},_setCameraMovement:function(a,i){this.animateTo({zoom:a.zoom,center:a.center,pitch:a.pitch,bearing:a.bearing},{duration:a.duration,easing:"out"},i)},setCameraOrientation:function(a){var i=a.position,r=a.pitch,t=a.bearing,e=this.getFitZoomForCamera(i,r),n=e.zoom,o=e.cameraToGroundDistance,h=Math.sin(r*Nt)*o,u=me(t,-180,180),l=u*Nt,f=this.getGLRes(),c=new L(i[0],i[1]),d=this.coordToPointAtRes(c,f),g=new E(0,0);g.x=d.x+h*Math.sin(l),g.y=d.y+h*Math.cos(l);var v=this._pointToPrjAtRes(g,this.getGLRes());return this._setPrjCenter(v),this.setView({bearing:t,pitch:r,zoom:n}),this},setCameraPosition:function(a){var i=this.getGLRes(),r=this.coordToPointAtRes(a,i);r.z=this.altitudeToPoint(a.z||0,i);var t=this.getCenter(),e=this.coordToPointAtRes(t,i);e.z=this.altitudeToPoint(t.z,i);var n=Vi([],r.toArray(),e.toArray());zt(this.cameraUp||[0,0,0],0,0,1),this._pitch=ih(n,this.cameraUp),zt(nh,n[0],n[1],0),this._angle=-ih(nh,eg),this._zoomLevel=this.getFitZoomForCamera(a,this._pitch).zoom,this._calcMatrices()},getFitZoomForCamera:function(a,i){var r=Array.isArray(a)?a[2]:a.z,t=r*this._meterToGLPoint,e=this.centerAltitude||0,n=e*this._meterToGLPoint,o=t-n,h=i*Nt,u=o/Math.cos(h),l=u+n,f=this._getFitZoomForDistance(l);return{zoom:f,cameraToGroundDistance:u}},_getFitZoomForDistance:function(a){var i=this._getFovRatio(),r=a*i*2/(this.height||1)*this.getGLRes(),t=this._getResolutions(),e=0;for(e;e<t.length-1;e++){if(t[e]===r)return e;if(t[e+1]===r)return e+1;if(r<t[e]&&r>t[e+1])return e=(r-t[e])/(t[e+1]-t[e])+e,e-1}return e},isTransforming:function(){return!!(this._pitch||this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var a=90-this.getPitch(),i=this.getFov()/2,r=this.cameraPosition?this.cameraPosition[2]:0;if(i<=a)return r;i=Math.PI*i/180;var t=new E(this.cameraPosition).distanceTo(new E(this.cameraLookAt)),e=r*Math.tan(i*2),n=Math.tan(i)*(t+e);return r+n},_pointToContainerPoint:function(a,i,r,t){r===void 0&&(r=0);var e=this._getResolution(i);return this._pointAtResToContainerPoint(a,e,r,t)},_pointAtResToContainerPoint:function(a,i,r,t){r===void 0&&(r=0),t||(t=new E(0,0)),a=this._pointAtResToPoint(a,i,t);var e=this.isTransforming(),n;return!e&&!r&&(n=this._prjToPoint(this._getPrjCenter(),void 0,fa)),this._toContainerPoint(t,e,r,n),t},_pointsAtResToContainerPoints:function(a,i,r,t){r===void 0&&(r=[]),t===void 0&&(t=[]);var e=this.getPitch(),n=this.getBearing(),o=i/this._getResolution();if(e===0&&n===0&&!ig(r)){var h=this._get2DExtent(),u=h.xmin,l=h.ymin,f=h.xmax,c=h.ymax;if(f>u&&c>l){for(var d=this.getSize(),g=d.width,v=d.height,m=(f-u)/g,_=(c-l)/v,p=0,y=a.length;p<y;p++){if(!a[p]){t[p]=null;continue}var w=t[p];w.x=a[p].x,w.y=a[p].y,w._multi(o),w.x=(w.x-u)*m,w.y=v-(w.y-l)*_}return t}}for(var C=Array.isArray(r),x=this.isTransforming(),M=this._prjToPoint(this._getPrjCenter(),void 0,fa),S=0,T=a.length;S<T;S++){if(!a[S]){t[S]=null;continue}var b=t[S];b.x=a[S].x,b.y=a[S].y,b._multi(o);var D=C?r[S]||0:r;this._toContainerPoint(b,x,D,M)}return t},_toContainerPoint:function(){var s=[0,0,0];return function(a,i,r,t){var e=this.width/2,n=this.height/2;if(i||r){this._altitudeScale||(this._altitudeScale=this.altitudeToPoint(100,this.getGLRes())/100);var o=this._glScale;zt(s,a.x*o,a.y*o,r*this._altitudeScale);var h=this._projIfBehindCamera(s,this.cameraPosition,this.cameraForward);la(h,h,this.projViewMatrix),a.x=h[0]*e+e,a.y=-(h[1]*n)+n}else a._sub(t.x,t.y),a.set(a.x,-a.y),a._add(e,n)}}(),_projIfBehindCamera:function(){var s=new Array(3),a=new Array(3),i=new Array(3);return function(r,t,e){Vi(s,r,t);var n=al(e,s);return n<=0&&(Jd(a,e,n*1.01),Ud(r,t,Vi(i,s,a))),r}}(),_containerPointToPoint:function(a,i,r){var t=this._getResolution(i);return this._containerPointToPointAtRes(a,t,r)},_containerPointToPointAtRes:function(){var s=[0,0,0],a=[0,0,0,1],i=[0,0,0,1];return function(r,t,e){if(this.isTransforming()){var n=this.width/2||1,o=this.height/2||1;zt(s,(r.x-n)/n,(o-r.y)/o,0),zt(a,s[0],s[1],0),zt(i,s[0],s[1],1),a[3]=i[3]=1,la(a,a,this.projViewMatrixInverse),la(i,i,this.projViewMatrixInverse);var h=a[0],u=i[0],l=a[1],f=i[1],c=a[2],d=i[2],g=c===d?0:(0-c)/(d-c),v=Nr(h,u,g),m=Nr(l,f,g);return e?(e.x=v,e.y=m):e=new E(v,m),e._multi(1/this._glScale),this._getResolution()===t?e:this._pointToPointAtRes(e,t,e)}var _=this._prjToPointAtRes(this._getPrjCenter(),t,e),p=this._getResolution()/t,y=p*(r.x-this.width/2),w=p*(r.y-this.height/2);return _._add(y,-w)}}(),_calcMatrices:function(){var s=Wt();return function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var a=this.getSize(),i=a.width||1,r=a.height||1;this._glScale=this.getGLScale();var t=this._getCameraWorldMatrix(),e=this.getFov()*Math.PI/180,n=this._getCameraFar(e,this.getPitch());this.cameraFar=n,this.cameraNear=this.cameraCenterDistance/20;var o=this.projMatrix||Wt();Qo(o,e,i/r,this.cameraNear,n),this.projMatrix=o,this.viewMatrix=Ko(this.viewMatrix||Wt(),t),this.projViewMatrix=Wi(this.projViewMatrix||Wt(),o,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=Wi(this.projViewMatrixInverse||Wt(),t,Ko(s,o)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this._get2DExtent(),this._mapGlExtent2D=this._get2DExtentAtRes(this._mapGlRes)}}(),_getCameraFar:function(a,i){var r=this.cameraCenterDistance=Ga(this.cameraPosition,this.cameraLookAt),t=r,e=(this.options.cameraInfiniteFar?10:4)*r;if(i>0&&(i=i*Math.PI/180,2/Math.PI-i>a/2)){var n=Math.tan(a/2),o=Math.tan(i);e=Math.max(r*n/(1/o-n),e)}return t+=e,t+1},_calcCascadeMatrixes:function(){var s=Wt();function a(i,r,t){var e=this.width,n=this.height,o=this.getFov()*Math.PI/180,h=this._getCameraFar(o,r),u=this.cameraCenterDistance;h=u+(h-u)/Math.cos((90-r)*Math.PI/180)*Math.cos((90-i)*Math.PI/180),Qo(s,o,e/n,.1,h);var l=this.viewMatrix;return Wi(t,s,l)}return function(){var i=this.getPitch(),r=this.options.cascadePitches[0],t=this.options.cascadePitches[1],e=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||Wt(),n=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||Wt();i>r?a.call(this,i,r,e):th(this.cascadeFrustumMatrix0,this.projViewMatrix),i>t?a.call(this,i,t,n):th(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var s=Wt(),a=Wt(),i=[1,-1,1],r=[0,0,0];return function(){var t=this.width||1,e=this.height||1,n=.5/Math.tan(this._fov/2)*e;return ja(s,this.projMatrix,i),nl(s,s,zt(r,0,0,-n)),this._pitch&&Wd(s,s,this._pitch),this._angle&&Vd(s,s,this._angle),Ms(a),ja(a,a,zt(r,t/2,-e/2,1)),Wi(this.domCssMatrix||Wt(),a,s)}}(),_getFovZ:function(a){var i=this.getGLScale(a),r=this._getFovRatio();return i*(this.height||1)/2/r},_getCameraWorldMatrix:function(){var s={};return function(){var a=this.getGLRes();this._meterToGLPoint||(this._meterToGLPoint=this.distanceToPointAtRes(100,0,a).x/100);var i=this._prjToPointAtRes(this._prjCenter,a,rh),r=this.getCenter().z,t=r!==void 0?r:this.centerAltitude||0,e=t*this._meterToGLPoint;this.cameraLookAt=zt(this.cameraLookAt||[0,0,0],i.x,i.y,e);var n=this.getPitch()*Nt,o=this.getBearing()*Nt,h=this._getFovZ(),u=this.cameraZenithDistance===void 0?h:this.cameraZenithDistance,l=u-e,f=l*Math.cos(n),c=Math.sin(n)*l,d=i.x-c*Math.sin(o),g=i.y-c*Math.cos(o);this.cameraPosition=zt(this.cameraPosition||[0,0,0],d,g,f+e),this.cameraToCenterDistance=h;var v=c||1,m=this.cameraUp=this.getPitch()>0?zt(this.cameraUp||[0,0,0],0,0,1):zt(this.cameraUp||[0,0,0],Math.sin(o)*v,Math.cos(o)*v,0),_=this.cameraWorldMatrix=this.cameraWorldMatrix||Wt();Kd(_,this.cameraPosition,this.cameraLookAt,m);var p=this.cameraForward||[0,0,0];return Vi(p,this.cameraLookAt,this.cameraPosition),this.cameraForward=yi(p,p),$d(s,_),Yd(_,s),Qd(_,this.cameraPosition),_}}(),updateCenterAltitude:function(){this.getRenderer().setToRedraw(),!this.centerAltitude&&this._hasAltitudeLayer()&&(this.centerAltitude=0),this._recenterOnTerrain()},_recenterOnTerrain:function(){if(!(this.centerAltitude===void 0||this._centerZ!==void 0)){var a=this._queryTerrainByProjCoord(this._prjCenter);P(a)&&this._hasAltitudeLayer()&&(a=this.centerAltitude);var i=a||0,r=this.getPitch()*Nt,t=this.getBearing()*Nt,e=(i-this.centerAltitude)*this._meterToGLPoint,n=this._getFovZ(),o=this.cameraZenithDistance===void 0?n:this.cameraZenithDistance,h=o-this.centerAltitude*this._meterToGLPoint,u=h-e/Math.cos(r),l=this.cameraPosition,f=Math.sin(r)*u,c=rh;c.x=l[0]+f*Math.sin(t),c.y=l[1]+f*Math.cos(t);var d=i*this._meterToGLPoint;this.cameraZenithDistance=(l[2]-d)/Math.cos(r)+d,this.centerAltitude=i;var g=this.pointAtResToCoordinate(c,this.getGLRes(),fa);this._eventSilence=!0,this._suppressRecenter=!0,this.setCenter(g),delete this._suppressRecenter,delete this._eventSilence,P(a)&&delete this.centerAltitude}},_queryTerrainByProjCoord:function(a){for(var i=this._getLayers(),r=0;r<i.length;r++)if(i[r].queryTerrainByProjCoord)return i[r].queryTerrainByProjCoord(a)[0];return 0},_hasAltitudeLayer:function(){for(var a=this._getLayers(),i=0;i<a.length;i++)if(a[i].getTerrainLayer&&a[i].getTerrainLayer())return!0;return!1},_queryTerrainInfo:function(a){for(var i=this._getLayers()||[],r=0;r<i.length;r++){var t=i[r];if(a&&t&&t.queryTerrainAtPoint&&t.getTerrainLayer&&t.getTerrainLayer()){var e=t.queryTerrainAtPoint(a);if(e)return{coordinate:e,altitude:e.z};break}}return null},_getFovRatio:function(){var a=this.getFov();return Math.tan(a/2*Nt)},_renderLayers:function(){if(!this.isInteracting()){var a=this._getLayers();a.forEach(function(i){if(i){var r=i._getRenderer();r&&r.setToRedraw&&r.setToRedraw()}})}}});function Wt(){return Ms(new Array(16))}function rg(s,a){var i=pt(s[0]),r=pt(a[0]),t=pt(s[1]),e=pt(a[1]),n=Math.sin(r-i)*Math.cos(e),o=Math.cos(t)*Math.sin(e)-Math.sin(t)*Math.cos(e)*Math.cos(r-i);return Ha(Math.atan2(n,o))}$.include({_onViewChange:function(a){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var i=this._getCurrentView(),r=this._viewHistory.length-1;r>=0;r--)if(Wr(a,this._viewHistory[r])){this._viewHistoryPointer=r,this._fireViewChange(i,a);return}this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(a);var t=this.options.viewHistoryCount;t>0&&this._viewHistory.length>t&&this._viewHistory.splice(0,this._viewHistory.length-t),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(i,a)},zoomToPreviousView:function(a){if(a===void 0&&(a={}),!this.hasPreviousView())return null;var i=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(i,a),i},hasPreviousView:function(){return!(!this._viewHistory||this._viewHistoryPointer===0)},zoomToNextView:function(a){if(a===void 0&&(a={}),!this.hasNextView())return null;var i=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(i,a),i},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(a,i){var r=this,t=this.getView();i.animation?this._animateTo(a,{duration:i.duration},function(e){e.state.playState==="finished"&&r._fireViewChange(t,a)}):(this.setView(a),this._fireViewChange(t,a))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(a,i){this._fireEvent("viewchange",{old:a,new:i}),this._insertUICollidesQueue()},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}});$.mergeOptions({viewHistory:!0,viewHistoryCount:10});var ng=new dr;$.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new dr,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this},_insertUICollidesQueue:function(){return this._uiCollidesQueue||(this._uiCollidesQueue=[]),this._uiCollidesQueue.push(1),this},uiCollides:function(){if(!this.uiList||this.uiList.length===0||!this._uiCollidesQueue||this._uiCollidesQueue.length===0)return this;var a=ng;a.clear();for(var i=this.uiList,r=0,t=i.length;r<t;r++){var e=i[r],n=e.options,o=n.collisionBufferSize,h=n.collision;if(h){var u=e.getDOM();if(!(!e.isVisible()||!u)&&u.getBoundingClientRect){e.bbox||(e.bbox=[0,0,0,0]);var l=u.getBoundingClientRect(),f=l.x,c=l.y,d=l.width,g=l.height;if(d===0||g===0){var v=e.getSize();v&&(d=v.width,g=v.height)}var m=f-o,_=f+d+o,p=c-o,y=c+g+o;if(e.bbox[0]=m,e.bbox[1]=p,e.bbox[2]=_,e.bbox[3]=y,a.collides(e.bbox)){e._collidesEffect(!1);continue}a.insertBox(e.bbox),e._collidesEffect(!0)}}}return this._uiCollidesQueue=[],this},_addUI:function(a){this.uiList||(this.uiList=[]);var i=this.uiList.indexOf(a);return i>-1?this:(this.uiList.push(a),this.uiList=this.uiList.sort(function(r,t){return t.options.collisionWeight-r.options.collisionWeight}),this)},_removeUI:function(a){if(!this.uiList)return-1;var i=this.uiList.indexOf(a);return i<0||this.uiList.splice(i,1),i}});var ag={start:"起点",units:{mile:" 英里",feet:" 英尺",kilometer:" 公里",meter:" 米"}},sg={units:{mile:" 平方英里",feet:" 平方英尺",kilometer:" 平方公里",meter:" 平方米"}},og={distancetool:ag,areatool:sg},hg={start:"Inicio",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},ug={units:{mile:" mi²",feet:" ft²",kilometer:" km²",meter:" m²"}},lg={distancetool:hg,areatool:ug},fg={start:"Start",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},cg={units:{mile:" mi²",feet:" ft²",kilometer:" km²",meter:" m²"}},dg={distancetool:fg,areatool:cg},hi=function(s){z(a,s);function a(i){var r;return r=s.call(this,"Translator: "+i)||this,r.name="TranslatorError",r}return a}(xa(Error)),sl=function(s){z(a,s);function a(r){var t;return t=s.call(this)||this,t.languages={"zh-CN":og,"es-MX":lg,"en-US":dg},t.nodes={},t.setLang(r||"zh-CN"),t}var i=a.prototype;return i.setLang=function(t){var e=this.languages[t];if(!e)throw new hi("Setted Lang does not exist");this.nodes=e},i._validateNestedProps=function(t){t.forEach(function(e){if(e==="")throw new hi('Any of sides of a dot "." cannot be empty')})},i.translate=function(t){if(t===void 0&&(t=null),t==null)throw new hi("Missing parameter textNode");if(typeof t=="string"){var e=null;if(t.includes(".")){var n=t.split(".");if(n.length>3)throw new hi("Translate function can only access through 3 nested properties, trying to access -> "+n.length);this._validateNestedProps(n);try{var o=null;switch(n.length){case 2:o=this.nodes[n[0]][n[1]];break;case 3:o=this.nodes[n[0]][n[1]][n[2]];break}return o}catch(h){throw new hi("Unable to find the text translated in lang json"+h.message)}}else return e=this.nodes[t],e}else throw new hi("Param passed has to be a String")},a}(Bt),gg={formatLabelContent:null,decimalPlaces:2,mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]},ol=function(s){z(a,s);function a(r){var t;return t=s.call(this,r)||this,t.on("enable",t._afterEnable,mt(mt(t))).on("disable",t._afterDisable,mt(mt(t))),t._measureLayers=[],t.translator=new sl(t.options.language),t}var i=a.prototype;return i.clear=function(){if(st(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._outLayers(this._measureLayers),this._measureLayers=[],this},i.getMeasureLayers=function(){return this._measureLayers},i.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},i.undo=function(){s.prototype.undo.call(this);var t=this._historyPointer;if(t!==this._vertexes.length)for(var e=t;e<this._vertexes.length;e++)this._vertexes[e].label&&this._vertexes[e].label.remove(),this._vertexes[e].marker.remove();return this},i.redo=function(){s.prototype.redo.call(this);var t=this._historyPointer-1;return this._vertexes[t]&&(this._vertexes[t].marker.getLayer()||(this._vertexes[t].label&&this._vertexes[t].label.addTo(this._measureMarkerLayer),this._vertexes[t].marker.addTo(this._measureMarkerLayer))),this},i._formatLabelContent=function(t){var e=this.options.formatLabelContent;return e&&it(e)?e.call(this,t)+"":null},i._measure=function(t){var e=this.getMap(),n;t instanceof ot?n=e.computeGeometryLength(t):Array.isArray(t)&&(n=e.getProjection().measureLength(t)),this._lastMeasure=n;var o=this._formatLabelContent(n);if(o)return o;var h=[this.translator.translate("distancetool.units.meter"),this.translator.translate("distancetool.units.kilometer"),this.translator.translate("distancetool.units.feet"),this.translator.translate("distancetool.units.mile")],u="",l=this.options.decimalPlaces;return this.options.metric&&(u+=n<1e3?n.toFixed(l)+h[0]:(n/1e3).toFixed(l)+h[1]),this.options.imperial&&(n*=3.2808399,u.length>0&&(u+=`
`),u+=n<5280?n.toFixed(l)+h[2]:(n/5280).toFixed(l)+h[3]),u},i._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},i._afterEnable=function(){this._registerMeasureEvents()},i._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},i._msOnDrawStart=function(t){var e=this.getMap(),n=we(),o="distancetool_"+n,h="distancetool_markers_"+n,u=this.options.zIndex,l=this.options.enableAltitude;e.getLayer(o)?(this._measureLineLayer=e.getLayer(o),this._measureMarkerLayer=e.getLayer(h)):(this._measureLineLayer=new ye(o,{zIndex:u,enableAltitude:l}).addTo(e),this._measureMarkerLayer=new ye(h,{zIndex:u,enableAltitude:l}).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer),this._pushLayers([this._measureLineLayer,this._measureMarkerLayer]);var f=this._getFirstCoordinate()||t.coordinate,c=new wt(f.copy(),{symbol:this.options.vertexSymbol}),d=this.translator.translate("distancetool.start"),g=new pi(d,f.copy(),this.options.labelOptions);this._lastVertex=g,this._addVertexMarker(c,g)},i._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var n=Kt(this.options.vertexSymbol);n.markerWidth/=2,n.markerHeight/=2,this._tailMarker=new wt(t.coordinate,{symbol:n}).addTo(this._measureMarkerLayer),this._tailLabel=new pi(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var o=this._getLasttCoordinate()||t.coordinate;this._tailMarker.setCoordinates(o.copy()),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(o.copy())},i._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this._getLasttCoordinate()||t.coordinate,n=t.geometry,o=new wt(e.copy(),{symbol:this.options.vertexSymbol}),h=this._measure(n),u=new pi(h,e.copy(),this.options.labelOptions);this._addVertexMarker(o,u),this._lastVertex=u},i._addVertexMarker=function(t,e){this._vertexes||(this._vertexes=[]),this._historyPointer!==void 0&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:e,marker:t}),this._measureMarkerLayer.addGeometry(t),e&&this._measureMarkerLayer.addGeometry(e)},i._msOnDrawEnd=function(t){if(this._clearTailMarker(),t.geometry.getCoordinates().length<2){this._lastMeasure=0,this._clearMeasureLayers();return}var e=this._lastVertex.getSize();e||(e=new xt(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),e.width);var n=t.geometry.copy();n.setCoordinates(t.geometry.getCoordinates()),n.addTo(this._measureLineLayer),this._lastMeasure=n.getLength()},i._addClearMarker=function(t,e,n){var o=this.options.clearButtonSymbol,h={markerDx:(o.markerDx||0)+n,textDx:(o.textDx||0)+n};Array.isArray(o)&&(h=o.map(function(c){return c?{markerDx:(c.markerDx||0)+n,textDx:(c.textDx||0)+n}:null})),o=Kt(o,h);var u=new wt(t,{symbol:o}),l=this._measureLineLayer,f=this._measureMarkerLayer;u.on("click",function(){return l.remove(),f.remove(),!1},this),u.addTo(this._measureMarkerLayer)},i._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},i._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},i._getFirstCoordinate=function(){if(!this._geometry)return null;var t=this._geometry.getCoordinates()||[];return t[0]},i._getLasttCoordinate=function(){if(!this._geometry)return null;var t=this._geometry.getCoordinates()||[];return t[t.length-1]},a}(Rt);ol.mergeOptions(gg);var vg={mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5},language:"zh-CN"},mg=function(s){z(a,s);function a(r){var t;return t=s.call(this,r)||this,t.translator=new sl(t.options.language),t._measureLayers=[],t}var i=a.prototype;return i._measure=function(t){var e=this.getMap(),n;t instanceof ot?n=e.computeGeometryArea(t):Array.isArray(t)&&(n=e.getProjection().measureArea(t)),this._lastMeasure=n;var o=this._formatLabelContent(n);if(o)return o;var h=[this.translator.translate("areatool.units.meter"),this.translator.translate("areatool.units.kilometer"),this.translator.translate("areatool.units.feet"),this.translator.translate("areatool.units.mile")],u="",l=this.options.decimalPlaces;if(this.options.metric&&(u+=n<1e6?n.toFixed(l)+h[0]:(n/1e6).toFixed(l)+h[1]),this.options.imperial){n*=Math.pow(3.2808399,2),u.length>0&&(u+=`
`);var f=5280*5280;u+=n<f?n.toFixed(l)+h[2]:(n/f).toFixed(l)+h[3]}return u},i._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this._getLasttCoordinate()||t.coordinate,n=new wt(e.copy(),{symbol:this.options.vertexSymbol});this._measure(t.geometry),this._lastVertex=n,this._addVertexMarker(n)},i._msOnDrawEnd=function(t){this._clearTailMarker();var e;if(t.point2d)e=this.getMap()._pointToPrj(t.point2d);else{var n=t.geometry._getPrjCoordinates()||[];n=n.slice(0,n.length-1),e=n[n.length-1]}if(t.geometry.getShell().length<3){this._lastMeasure=0,this._clearMeasureLayers();return}var o=this._measure(t.geometry),h=this._getLasttCoordinate(),u=new pi(o,h.copy(),this.options.labelOptions).addTo(this._measureMarkerLayer),l=u.getSize();l||(l=new xt(10,10)),this._addClearMarker(h.copy(),e,l.width);var f=t.geometry.copy();f.setCoordinates(t.geometry.getCoordinates()),f.addTo(this._measureLineLayer),this._lastMeasure=f.getArea()},a}(ol);mg.mergeOptions(vg);function ne(s,a,i){var r=Array.isArray(a);r||(a=[a]);var t;if(!i||!i.target||!i.target._queryTerrainInfo)return t=a.map(function(o){return s.unproject(o)}),r?t:t[0];var e=i.target,n=i.enableAltitude;return t=a.map(function(o){if(n){var h=e._prjToContainerPoint(o),u=e._queryTerrainInfo(h);if(u&&u.coordinate)return u.coordinate}return s.unproject(o)}),r?t:t[0]}var hl={create:function(a,i,r){var t=ne(a,i[0],r),e=new re(t,0);return e},update:function(a,i,r,t){var e=r.getMap(),n=Array.isArray(i)?i[i.length-1]:i,o=ne(a,n,t),h=e.computeLength(r.getCenter(),o);r.setRadius(h)},generate:function(a){return a}};Rt.registerMode("circle",F({clickLimit:2,action:["click","mousemove","click"]},hl));Rt.registerMode("freeHandCircle",F({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},hl));var ul={create:function(a,i,r){var t=ne(a,i[0],r),e=new pe(t,0,0);return e},update:function(a,i,r,t){var e=r.getMap(),n=r.getCenter(),o=Array.isArray(i)?i[i.length-1]:i,h=ne(a,o,t),u=e.computeLength(n,new L({x:h.x,y:n.y})),l=e.computeLength(n,new L({x:n.x,y:h.y}));r.setWidth(u*2),r.setHeight(l*2)},generate:function(a){return a}};Rt.registerMode("ellipse",F({clickLimit:2,action:["click","mousemove","click"]},ul));Rt.registerMode("freeHandEllipse",F({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},ul));var ll={create:function(a,i){var r=new Ct([]);return r._firstClick=i[0],r},update:function(a,i,r,t){var e=r.getMap(),n=t.containerPoint,o=e._prjToContainerPoint(r._firstClick),h=[[o.x,o.y],[n.x,o.y],[n.x,n.y],[o.x,n.y]],u=h.map(function(f){return e._containerPointToPrj(new E(f))}),l=ne(a,u,t);r.setCoordinates(l)},generate:function(a){return a}};Rt.registerMode("rectangle",F({clickLimit:2,action:["click","mousemove","click"]},ll));Rt.registerMode("freeHandRectangle",F({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},ll));Rt.registerMode("point",{clickLimit:1,action:["click","mousemove"],create:function(a,i,r){var t=ne(a,i[0],r),e=new wt(t);return e},generate:function(a){return a},update:function(a,i,r,t){if(Array.isArray(i)&&(i=i[i.length-1]),!i)return r;var e=ne(a,i,t);return r.setCoordinates(e),r}});var fl={create:function(a,i,r){var t=ne(a,i,r),e=new yt(t);return e.setCoordinates(t),e},update:function(a,i,r,t){var e=r.getSymbol(),n;Array.isArray(i)?n=i:(n=r._drawPrjs||[],n.push(i)),r._drawPrjs=n;var o=ne(a,n,t);r.setCoordinates(o);var h=r.getLayer();if(h){var u=h.getGeometryById("polygon");if(!u&&n.length>=3){if(u=new Ct([o],{id:"polygon"}),e){var l=Kt(e,{lineOpacity:0});u.setSymbol(l)}u.addTo(h)}u&&u.setCoordinates([o])}},generate:function(a){var i=new Ct(a.getCoordinates(),{symbol:a.getSymbol()});return i._projCode=a._projCode,i}};Rt.registerMode("polygon",F({action:["click","mousemove","dblclick"]},fl));Rt.registerMode("freeHandPolygon",F({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},fl));var mr={create:function(a,i,r){var t=ne(a,i,r),e=new yt(t);return e.setCoordinates(t),e},update:function(a,i,r,t){var e;Array.isArray(i)?e=i:(e=r._drawPrjs||[],e.push(i)),r._drawPrjs=e;var n=ne(a,e,t);r.setCoordinates(n)},generate:function(a){return a}};Rt.registerMode("linestring",F({action:["click","mousemove","dblclick"]},mr));Rt.registerMode("freeHandLinestring",F({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},mr));Rt.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(a,i){var r=i.map(function(e){return a.unproject(e)}),t=new Tn(r);return t._setPrjCoordinates(i),t},update:mr.update,generate:function(a){return a}});Rt.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(a,i){var r=i.map(function(e){return a.unproject(e)}),t=new Ku(r);return t._setPrjCoordinates(i),t},update:mr.update,generate:function(a){return a}});Rt.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(a,i){var r=i.map(function(e){return a.unproject(e)}),t=new Qu(r);return t._setPrjCoordinates(i),t},update:mr.update,generate:function(a){return a}});Rt.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(a,i){i=i[0];var r=a.unproject(i),t=new wt(r);return t._firstClick=i,t},update:function(a,i,r,t){var e=r.getMap(),n=e._prjToContainerPoint(r._firstClick),o=t.containerPoint;i=e._containerPointToPrj(new L(Math.min(n.x,o.x),Math.min(n.y,o.y)));var h=a.unproject(i);r.setCoordinates(h)._setPrjCoordinates(i),r.updateSymbol({markerWidth:Math.abs(n.x-o.x),markerHeight:Math.abs(n.y-o.y)})},generate:function(a){return a}});function ah(s){for(var a=s.tileInfo,i=[a.cols,a.rows],r=[],t=a.lods,e=0,n=t.length;e<n;e++)r.push(t[e].resolution);var o=s.fullExtent,h=a.origin,u=[1,-1,h.x,h.y];return delete o.spatialReference,{spatialReference:{resolutions:r,fullExtent:o},tileSystem:u,tileSize:i}}oe.loadArcgis=function(s,a,i){if(i===void 0&&(i={jsonp:!0}),tt(s)&&s.substring(0,1)!=="{")Ft.getJSON(s,function(t,e){if(t){a(t);return}var n=ah(e);a(null,n)},i);else{tt(s)&&(s=qi(s));var r=ah(s);a(null,r)}return this};function _g(s){for(var a="",i=s.split(""),r=i.length,t=r-1;t>=0&&!isNaN(i[t]);t--)a=i[t]+a;return a}function pg(s){var a=s.indexOf("EPSG")>-1?s:"EPSG:"+s;return a=cl(a,[["4490","4326"],["102100","3857"],["900913","3857"]]),a}function cl(s,a){return a===void 0&&(a=[]),a.forEach(function(i){var r=i[0],t=i[1];s=s.replace(r,t)}),s}function yg(s){var a=s.projection,i=s.isArcgis,r=s.isGeoServer,t=s.isSuperMap,e=.0002645833333333333;return(i||r||t)&&(e=28e-5),a&&a.indexOf("4326")>-1&&(e=23767925226029154e-25,(i||t)&&(e=2518101729011901e-24),r&&(e=251528279553466e-23)),e}var wg="wmts";function Ae(s,a){var i=s.getElementsByTagName(a);if(i&&i.length)return i;var r=wg+":"+a;return s.getElementsByTagName(r)}function xg(s,a){for(var i=0;i<s.length;i++){var r=s[i];if(r=r.getElementsByTagName("ows:Identifier")[0],r&&r.textContent===a)return s[i]}return null}function Cg(s,a,i){i.isArcgis==null&&(i.isArcgis=s.indexOf("arcgis")>-1),i.isSuperMap==null&&(i.isSuperMap=s.indexOf("supermap")>-1);var r=new DOMParser,t=r.parseFromString(s,"text/xml"),e=t.querySelectorAll("Contents")[0];if(!e)return[];var n=Ae(e,"Layer");if(!n.length)return[];for(var o=[],h=0,u=e.childNodes.length;h<u;h++)e.childNodes[h].localName==="TileMatrixSet"&&o.push(e.childNodes[h]);if(!o.length)return[];for(var l=[],f=0,c=n.length;f<c;f++){var d=n[f],g=d.querySelectorAll("Style")[0];g&&(g=g.getElementsByTagName("ows:Identifier")[0],g&&(g=g.textContent));var v=d.getElementsByTagName("ows:Identifier")[0];v&&(v=v.textContent);var m=Ae(d,"TileMatrixSetLink");if(m.length!==0)for(var _=0,p=m.length;_<p;_++){var y=m[_];y=Ae(y,"TileMatrixSet")[0],y&&(y=y.textContent);var w=xg(o,y);if(w){var C=d.querySelectorAll("ResourceURL")[0],x="";C&&(x=C.attributes.template.value);var M=Pg(w,i),S=M.resolutions,T=M.tileSize,b=M.tileSystem,D=M.projection,R=M.TileMatrixSet,k=M.isGeoServer,O=M.levelStr;x.length||(x=a.substr(0,a.lastIndexOf("?")),x+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var A=cl(x,[["{LAYER}",v],["{Layer}",v],["{layer}",v],["{STYLE}",g],["{Style}",g],["{style}",g],["{TileMatrixSet}",R],["{TileMatrix}",k?O+":{z}":"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",k?"image/png":"tiles"]]);l.push({tileSize:T,tileSystem:b,spatialReference:{resolutions:S,projection:D},urlTemplate:A,info:{layerName:v,TileMatrixSet:R,style:g,tileSize:T,tileSystem:b,resolutions:S,projection:D,urlTemplate:A}})}}}return l}function Pg(s,a){a===void 0&&(a={});var i=Ae(s,"TileMatrix"),r=[],t=[],e=[],n,o,h=!1,u;if(!n){var l=s.getElementsByTagName("ows:SupportedCRS")[0];l&&(n=l.textContent,n=n.split("EPSG")[1],n=_g(n),n=pg(n))}o||(o=s.getElementsByTagName("ows:Identifier")[0],o&&(o=o.textContent)),a.projection=n;for(var f=1/0,c=0;c<i.length;c++){var d=i[c],g=d.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(g))?(u=g.substr(0,g.lastIndexOf(":")),g=g.split(":"),g=g[g.length-1],g=parseInt(g),h=!0,a.isGeoServer=!0):g=parseInt(g),f=Math.min(f,g);var v=Ae(d,"ScaleDenominator")[0].textContent,m=Ae(d,"TopLeftCorner")[0].textContent,_=Ae(d,"TileWidth")[0].textContent,p=Ae(d,"TileHeight")[0].textContent;if(e.length===0&&e.push(parseInt(_),parseInt(p)),t.length===0){var y=m.split(" ").filter(function(b){return b!==""}).map(function(b){return parseFloat(b)}),w=y[0],C=y[1];w>0?t.push(1,-1,C,w):t.push(1,-1,w,C)}var x=yg(a),M=parseFloat(v)*x;r.push(M)}if(f>0)for(var S=r[0],T=f-1;T>=0;T--)S=S*2,r.splice(0,0,S);return{resolutions:r,tileSize:e,tileSystem:t,projection:n,TileMatrixSet:o,isGeoServer:h,levelStr:u}}oe.loadWMTS=function(s,a,i){return i===void 0&&(i={jsonp:!0}),tt(s)&&Ft.get(s,function(r,t){if(r){a(r);return}var e=Cg(t,s,i);a(null,e)},i),this};var Tg={eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1,collision:!1,collisionBufferSize:2,collisionWeight:0,collisionFadeIn:!1,zIndex:0},Le=function(s){z(a,s);function a(r){var t;return t=s.call(this,r)||this,t.proxyOptions(),t}var i=a.prototype;return i.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},i.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},i._collides=function(){var t=this.getMap();return t?(t._addUI(this),t._insertUICollidesQueue(),this):this},i._collidesEffect=function(t){var e=this.getDOM();if(!e)return this;var n=t?"visible":"hidden";if(e.style.visibility=n,!e.classList||!e.classList.add)return this;if(!this.options.collisionFadeIn)return this;var o=e.classList,h="mtk-ui-fadein",u=o.contains(h);return t&&!u?e.classList.add(h):!t&&u&&e.classList.remove(h),this},i.show=function(t){var e=this,n=this.getMap();if(!n)return this;this.options.visible=!0,t=t||this._coordinate||this._owner.getCenter(),t instanceof L||(t=new L(t));var o=this.isVisible();this._showBySymbolChange||this.fire("showstart");var h=this._getUIContainer();this._coordinate=t,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var u=this.__uiDOM=this.buildOn(n);u.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(u);var l=this.options.zIndex;if(!u)return this._showBySymbolChange||this.fire("showend"),this._collides(),this.setZIndex(l),this;this._measureSize(u),this._singleton()&&(u._uiComponent=this,n[this._uiDomKey()]=u),this._setPosition(),u.style[Hi]=null,h.appendChild(u);var f=this._getAnimation();if(o&&(f.ok=!1),f.ok&&(f.fade&&(u.style.opacity=0),f.scale)){if(this.getTransformOrigin){var c=this.getTransformOrigin();u.style[Qh]=c}u.style[Yt]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(u.style.display=""),this.options.eventsToStop&&gt(u,this.options.eventsToStop,jt);var d=f.transition;return f.ok&&d&&(u.offsetHeight,d&&(u.style[Hi]=d),f.fade&&(u.style.opacity=1),f.scale&&(u.style[Yt]=this._toCSSTranslate(this._pos)+" scale(1)")),this._showBySymbolChange||this.fire("showend"),this._collides(),clearTimeout(this._autoPanId),this.options.autoPan&&(this._autoPanId=setTimeout(function(){e._autoPan()},32)),this.setZIndex(l),this},i.hide=function(){var t=this;if(!this.getDOM())return this;this._onDomMouseout&&this._onDomMouseout(),this.options.visible=!1;var e=this._getAnimation(),n=this.getDOM();return this.options.animationOnHide||(e.ok=!1),e.ok?(n.offsetHeight,n.style[Hi]=e.transition,setTimeout(function(){n.style.display="none",t.fire("hide")},this.options.animationDuration)):(n.style.display="none",this.fire("hide")),e.fade&&(n.style.opacity=0),e.scale&&(n.style[Yt]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this._collides(),this},i.isVisible=function(){if(!this.options.visible)return!1;var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&t.style.display!=="none"},i.remove=function(){if(delete this._mapEventsOn,!this._owner)return this;var t=this.getMap();return t&&t._removeUI(this),this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this._collides(),this},i.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},i.getOwner=function(){return this._owner},i.getDOM=function(){return this.__uiDOM},i.setZIndex=function(t){if(!H(t))return this;var e=this.getDOM();return e?(e.style.zIndex=t,t!==this.options.zIndex&&(this.options.zIndex=t),this):this},i._roundPoint=function(t){return this.options.roundPoint&&(t=t._round()),t},i.getPosition=function(){if(!this.getMap())return null;var t=this._roundPoint(this._getViewPoint());if(this.getOffset){var e=this._roundPoint(this.getOffset());e&&t._add(e)}return t},i._getAnimation=function(){for(var t={fade:!1,scale:!1},e=this.options.animation?this.options.animation.split(","):[],n=0;n<e.length;n++){var o=fn(e[n]);o==="fade"?t.fade=!0:o==="scale"&&(t.scale=!0)}var h=null;return t.fade&&(h="opacity "+this.options.animationDuration+"ms"),t.scale&&(h=h?h+",":"",h+=Yt+" "+this.options.animationDuration+"ms"),t.transition=h,t.ok=h!==null,t},i._getViewPoint=function(){var t=0,e=this._coordinate||{};H(e.z)?t=e.z:this._owner&&this._owner.getAltitude&&(t=this._owner.getAltitude()||0,H(t)||(t=0));var n=this._meterToPoint(this._coordinate,t);return this.getMap().coordToViewPoint(this._coordinate,void 0,n)._add(this.options.dx,this.options.dy)},i._meterToPoint=function(t,e){return e},i._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(!(!e||!t||t.isMoving())){var n=this._getViewPoint()._round(),o=t.width,h=t.height,u=t.getContainer();if(e&&u&&e.getBoundingClientRect){var l=u.getBoundingClientRect(),f=l.left,c=l.top,d=50,g=e.getBoundingClientRect(),v=0,m=0,_=g.left,p=g.right,y=g.top,w=g.bottom,C=g.width,x=g.height;if(_-=f,p-=f,y-=c,w-=c,C>0&&x>0){if(_<d&&(v=d-_),v===0&&p+d>o&&(v=-(p+d-o)),y<d&&(m=d-y),m===0&&w+d>h&&(m=-(w+d-h)),v!==0||m!==0){var M=t.getPitch();M>40&&m!==0&&this._coordinate?t.animateTo({center:this._coordinate},{duration:t.options.panAnimationDuration}):t.panBy([Math.ceil(v),Math.ceil(m)])}return}}var S=t.viewPointToContainerPoint(n),T=this.getOffset(),b=S.add(T),D=t._viewPointToPrj(n),R=parseInt(e.clientWidth),k=parseInt(e.clientHeight),O=50,A=0,j=0;if(b.x<0?A=-b.x+O:b.x+R>o&&(A=-(b.x+R-o)-O),b.y-k<0?j=Math.abs(b.y-k)+O:b.y+k>h&&(j=h-(b.y+k)-O),R>=o&&(A=o/2-S.x),j!==0||A!==0){var G=S.add(A,j),N=t._containerPointToPoint(G)._sub(t._prjToPoint(t._getPrjCenter())),B=t._pointToPrj(t._prjToPoint(D).sub(N));t._panAnimation(B)}}},i._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute";var n=t.style.bottom?"bottom":"top";if(t.style.display="",e.appendChild(t),t.getBoundingClientRect){var o=t.getBoundingClientRect();this._size=new xt(o.width,o.height)}else this._size=new xt(t.clientWidth,t.clientHeight);return t.style.display="none",t.style.left="0px",t.style[n]="0px",this._size},i._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),n=this._uiDomKey();if(e[n]){t&&_t(e[n],t,jt);var o=e[n]._uiComponent;o&&o!==this&&o.isVisible()&&o.fire("hide"),Je(e[n]),o&&!this.hideDom&&o._switchMapEvents("off"),delete e[n]}delete this.__uiDOM}else this.__uiDOM&&(t&&_t(this.__uiDOM,t,jt),Je(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},i._uiDomKey=function(){return"__ui_"+this._getClassName()},i._singleton=function(){return this.options.single},i._getUIContainer=function(){return this.getMap()._panels.ui},i._getClassName=function(){return"UIComponent"},i._switchMapEvents=function(t){var e=this.getMap();if(e){this._mapEventsOn=t==="on";var n=this._getDefaultEvents();if(this.getEvents&&F(n,this.getEvents()),n)for(var o in n)n.hasOwnProperty(o)&&e[t](o,n[o],this)}},i._switchEvents=function(t){var e=this._getOwnerEvents();if(this._owner)for(var n in e)e.hasOwnProperty(n)&&this._owner[t](n,e[n],this)},i._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,moveend:this.onMoving,resize:this.onResize}},i._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof ot&&(t.positionchange=this.onGeometryPositionChange,t.symbolchange=this._updatePosition),this.getOwnerEvents&&F(t,this.getOwnerEvents()),t},i.onGeometryPositionChange=function(t){this._owner&&this.isVisible()&&(this._showBySymbolChange=!0,this.show(t.target.getCenter()),delete this._showBySymbolChange)},i.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},i.onEvent=function(){this.isVisible()&&this._updatePosition()},i.onZoomEnd=function(){this.isVisible()&&this._setPosition()},i.onResize=function(){this.isVisible()&&this._setPosition()},i.onDomSizeChange=function(){this.isVisible()&&(this._setPosition(),this._collides())},i._updatePosition=function(){if(!this.getMap())return this;var t=this.getMap()._getRenderer();return t.callInNextFrame(this._setPosition.bind(this)),this},i._setPosition=function(){var t=this.getDOM();if(t){t.style[Hi]=null;var e=this.getPosition();this._pos=e,t.style[Yt]=this._toCSSTranslate(e)+" scale(1)"}},i._toCSSTranslate=function(t){if(!t)return"";if(q.any3d){var e=this.getMap(),n=e?e.getBearing():0,o=e?e.getPitch():0,h="";return this.options.pitchWithMap&&o&&(h+=" rotateX("+Math.round(o)+"deg)"),this.options.rotateWithMap&&n&&(h+=" rotateZ("+Math.round(-n)+"deg)"),"translate3d("+Math.fround(t.x)+"px,"+Math.fround(t.y)+"px, 0px)"+h}else return"translate("+t.x+"px,"+t.y+"px)"},i._observerDomSize=function(t){var e=this;return!t||!q.resizeObserver||this._resizeObserver?this:(this._resizeObserver=new ResizeObserver(function(n){if(n.length){var o=n[0].borderBoxSize;o&&o.length?e._domContentRect={width:o[0].inlineSize,height:o[0].blockSize}:e._domContentRect=n[0].contentRect}else delete e._domContentRect;e.onDomSizeChange&&e.onDomSizeChange()}),this._resizeObserver.observe(t),this)},i.isSupportZoomFilter=function(){return!1},i.onConfig=function(){return this._updatePosition(),this},a.isSupport=function(t){return!!(t&&it(t.on)&&it(t.off)&&it(t.getCenter))},i._bindDomEvents=function(t,e){if(t){var n=this._getDomEvents()||{},o=e==="on"?gt:_t;for(var h in n)o(t,h,n[h],this)}},i._getDomEvents=function(){return{mouseover:this._onDomMouseover,mouseout:this._onDomMouseout}},i._configMapPreventWheelScroll=function(t){var e=this.getMap();e&&(this.options.eventsPropagation||(e.options.preventWheelScroll=t))},i._onDomMouseover=function(t){this._configMapPreventWheelScroll(!1)},i._onDomMouseout=function(t){this._configMapPreventWheelScroll(!0)},a}(le(Bt));Le.mergeOptions(Tg);var Mg={containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null,horizontalAlignment:"middle",verticalAlignment:"middle"},sh="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",Mn=function(s){z(a,s);function a(r,t){var e;return e=s.call(this,t)||this,e._markerCoord=new L(r),e}var i=a.prototype;return i._getClassName=function(){return"UIMarker"},i.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition(),this._collides()),this},i.getCoordinates=function(){return this._markerCoord},i.getCenter=function(){return this.getCoordinates()},i.getAltitude=function(){var t=this.getCoordinates()||{};return H(t.z)?t.z:this.options.altitude||0},i.setAltitude=function(t){return H(t)&&this._markerCoord&&(this._markerCoord.z=t,this._updatePosition&&(this._updatePosition(),this._collides())),this},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},i.getContent=function(){return this.options.content},i.onAdd=function(){if(this._owner&&!this._owner.isMap)throw new Error("UIMarker Can only be added to the map, but owner is:",this._owner.getJSONType&&this._owner.getJSONType());return this.show(),this},i.show=function(){return s.prototype.show.call(this,this._markerCoord)},i.flash=function(t,e,n,o){return Ba.call(this,t,e,n,o)},i.buildOn=function(){var t=this.getDOM();this._bindDomEvents(t,"off");var e,n=this.options.content,o=tt(n);return o||it(n)?(e=V("div"),o?e.innerHTML=this.options.content:n.bind(this)(e)):e=this.options.content,this.options.containerClass&&(e.className=this.options.containerClass),this._registerDOMEvents(e),this._bindDomEvents(e,"on"),e},i.getOffset=function(){var t=this.getSize(),e=-t.width/2,n=-t.height/2,o=this.options,h=o.horizontalAlignment,u=o.verticalAlignment;return h==="left"?e=-t.width:h==="right"&&(e=0),u==="top"?n=-t.height:u==="bottom"&&(n=0),new E(e,n)},i.getTransformOrigin=function(){return"center center"},i.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},i.isDragging=function(){return this.draggable?this.draggable.isDragging():!1},i._registerDOMEvents=function(t){gt(t,sh,this._onDomEvents,this)},i._onDomEvents=function(t){var e=this.getMap()._parseEvent(t,t.type),n=t.type;if(n==="mousedown"&&(this._mousedownEvent=t),n==="mouseup"&&(this._mouseupEvent=t),!(n==="click"&&this._mouseClickPositionIsChange())&&(n==="touchstart"&&(this._touchstartTime=at()),this.fire(t.type,e),n==="touchend"&&q.touch)){var o=this.getMap().options.clickTimeThreshold||280;at()-this._touchstartTime<o&&this._onDomEvents(F({},t,{type:"click"}))}},i._removeDOMEvents=function(t){_t(t,sh,this._onDomEvents)},i._mouseClickPositionIsChange=function(){var t=this._mousedownEvent||{},e=t.x,n=t.y,o=this._mouseupEvent||{},h=o.x,u=o.y;return e!==h||n!==u},i._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),n=this.getSize(),o=n.width,h=n.height,u=[t.containerPointToCoordinate(e.add(-o/2,0)),t.containerPointToCoordinate(e.add(o/2,0)),t.containerPointToCoordinate(e.add(0,h/2)),t.containerPointToCoordinate(e.add(0,-h/2))];return u},i._getViewPoint=function(){var t=0;if(this._owner){var e=this.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},i._getDefaultEvents=function(){return F({},s.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},i._setPosition=function(){this.onZoomFilter(),s.prototype._setPosition.call(this)},i.onZoomFilter=function(){var t=this.getDOM();t&&(!this.isVisible()&&t.style.display!=="none"?t.style.display="none":this.isVisible()&&t.style.display==="none"&&(t.style.display=""))},i.isVisible=function(){var t=this.getMap();if(!t||!this.options.visible)return!1;var e=t.getZoom(),n=this.options,o=n.minZoom,h=n.maxZoom;if(!P(o)&&e<o||!P(h)&&e>h)return!1;var u=this.getDOM();return u&&!0},i.isSupportZoomFilter=function(){return!0},a}(os(Le));Mn.mergeOptions(Mg);var oh=q.touch?"touchstart mousedown":"mousedown",Sg=function(s){z(a,s);function a(r){return s.call(this,r)||this}var i=a.prototype;return i.addHooks=function(){this.target.on(oh,this._startDrag,this)},i.removeHooks=function(){this.target.off(oh,this._startDrag,this)},i._startDrag=function(t){var e=t.domEvent;e.touches&&e.touches.length>1||e.button===2||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},i._prepareDragHandler=function(){this._dragHandler=new gr(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},i._cancelOn=function(t){var e=t.srcElement||t.target,n=e.tagName.toLowerCase();return n==="button"||n==="input"||n==="select"||n==="option"||n==="textarea"},i._onMouseDown=function(t){jt(t.domEvent)},i._dragging=function(t){var e=this.target,n=e.getMap(),o=n._parseEvent(t.domEvent),h=o.domEvent;if(!(h.touches&&h.touches.length>1)){if(!this._isDragging){this._isDragging=!0;return}var u=o.coordinate,l=o.containerPoint;this._lastCoord||(this._lastCoord=u),this._lastPoint||(this._lastPoint=l);var f=u.sub(this._lastCoord),c=l.sub(this._lastPoint);this._lastCoord=u,this._lastPoint=l,this.target.setCoordinates(this.target.getCoordinates().add(f)),o.coordOffset=f,o.pointOffset=c,e.fire("dragging",o)}},i._endDrag=function(t){var e=this.target,n=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,!!n){var o=n._parseEvent(t.domEvent);e&&e._mouseClickPositionIsChange&&e._mouseClickPositionIsChange()&&e.fire("dragend",o)}},i.isDragging=function(){return!!this._isDragging},a}(ae);Mn.addInitHook("addHandler","draggable",Sg);var bg=/\{ *([\w_]+) *\}/g,dl={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},Eg=new xt(0,0),an=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i._getClassName=function(){return"InfoWindow"},i.addTo=function(t){return t instanceof ot&&(t.getInfoWindow()&&t.getInfoWindow()!==this&&t.removeInfoWindow(),t._infoWindow=this),s.prototype.addTo.call(this,t)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getContent=function(){return this.options.content},i.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getTitle=function(){return this.options.title},i.buildOn=function(){var t=it(this.options.content),e=tt(this.options.content);if(this.options.custom){var n=this.getDOM(),o;if(this._bindDomEvents(n,"off"),e||t){var h=V("div");e?(h.innerHTML=this.options.content,this._replaceTemplate(h)):this.options.content.bind(this)(h),o=h}else this._replaceTemplate(this.options.content),o=this.options.content;return this._bindDomEvents(o,"on"),o}this._bindDomEvents(this.getDOM(),"off");var u=V("div");this.options.containerClass&&(u.className=this.options.containerClass);var l=this._getWindowWidth();u.style.width=H(l)?l+"px":"auto",u.style.bottom="0px";var f='<em class="maptalks-ico"></em>';this.options.title&&(f+="<h2>"+this.options.title+"</h2>"),f+='<a href="javascript:void(0);" class="maptalks-close">×</a><div class="maptalks-msgContent"></div>',u.innerHTML=f,this._replaceTemplate(u);var c=u.querySelector(".maptalks-msgContent");e||t?e?c.innerHTML=this.options.content:this.options.content.bind(this)(c):c.appendChild(this.options.content),this._onCloseBtnClick=this.hide.bind(this);var d=u.querySelector(".maptalks-close");return Xt(d,"click touchend",this._onCloseBtnClick),t||this._replaceTemplate(c),this._bindDomEvents(u,"on"),u},i._replaceTemplate=function(t){if(this.options.enableTemplate&&this._owner&&this._owner.getProperties&&t&&t.innerHTML){var e=this._owner.getProperties()||{};if(ee(e)){var n=t.innerHTML;t.innerHTML=n.replace(bg,function(o,h){return e[h]})}}return this},i.getTransformOrigin=function(){var t=this.getSize();return t.width/2+"px bottom"},i.getOffset=function(){var t=this.getSize(),e=new E(-t.width/2,0);this.options.custom?e._sub(0,t.height):e._sub(4,12);var n=this.getOwner();if(n instanceof wt||n instanceof tn){var o,h;if(n instanceof wt)o=n._getPainter(),h=n.getSize();else{var u=n.getGeometries();if(!u||!u.length)return e;o=u[0]._getPainter(),h=u[0].getSize()}if(h||(h=Eg),o){var l=o.getFixedExtent();e._add(l.xmax-h.width/2,l.ymin)}else e._add(0,-h.height)}return e},i.show=function(t){return this.getMap()?this.getMap().options.enableInfoWindow?s.prototype.show.call(this,t):this:this},i.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},i.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},i.onRemove=function(){this._onDomMouseout(),this.onDomRemove()},i.onDomRemove=function(){if(this._onCloseBtnClick){var t=this.getDOM(),e=t.childNodes[2];De(e,"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick}},i._onAutoOpen=function(t){var e=this,n=this.getOwner();setTimeout(function(){n instanceof wt||n instanceof Le?e.show(n.getCoordinates()):n instanceof tn?e.show(n.findClosest(t.coordinate)):((n instanceof yt||n instanceof en)&&e.getMap().getScale()>=8&&(t.coordinate=e._rectifyMouseCoordinte(n,t.coordinate)),e.show(t.coordinate))},1)},i._rectifyMouseCoordinte=function(t,e){var n=this;return t instanceof yt?this._rectifyLineStringMouseCoordinate(t,e).coordinate:t instanceof en?t.getGeometries().map(function(o){return n._rectifyLineStringMouseCoordinate(o,e)}).sort(function(o,h){return o.dis-h.dis})[0].coordinate:e},i._rectifyLineStringMouseCoordinate=function(t,e){for(var n=this.getMap(),o=t.getCoordinates()||[],h=n.getGLRes(),u=o.map(function(Gt){var Te=n.coordToPointAtRes(Gt,h),_r=Gt.z||0;return n._pointAtResToContainerPoint(Te,h,_r)}),l=n.coordToContainerPoint(e),f=1/0,c=-1,d=0,g=u.length;d<g;d++){var v=u[d],m=l.distanceTo(v);m<f&&(f=m,c=d)}for(var _=[c-1,c,c+1].filter(function(Gt){return Gt>=0&&Gt<=u.length-1}),p=_.map(function(Gt){return u[Gt]}),y=[],w=n.getSize(),C=w.width,x=w.height,M=0,S=p.length-1;M<S;M++){var T=M,b=p[M],D=p[M+1];if(b.x===D.x)for(var R=Math.max(0,Math.min(b.y,D.y)),k=Math.min(x,Math.max(b.y,D.y)),O=R;O<=k;O++)y.push({point:new E(b.x,O),coordinateIndex:T});else for(var A=(D.y-b.y)/(D.x-b.x),j=Math.max(0,Math.min(b.x,D.x)),G=Math.min(C,Math.max(b.x,D.x)),N=j;N<=G;N++){var B=A*(N-b.x)+b.y;y.push({point:new E(N,B),coordinateIndex:T})}}for(var Z=1/0,U=-1,J=-1,ht,Y=0,X=y.length;Y<X;Y++){var et=y[Y],ut=et.point,Pt=et.coordinateIndex,K=l.distanceTo(ut);K<Z&&(Z=K,U=Y,J=Pt,ht=ut)}if(U<0)return{dis:Z,coordinate:e};var dt=p[J],vt=p[J+1],nt=dt.distanceTo(vt),ct=ht.distanceTo(dt),Tt=ct/nt,Dt=_.map(function(Gt){return o[Gt]}),rt=Dt[J],St=Dt[J+1],Mt=rt.x,kt=rt.y,Ye=rt.z||0,xe=St.x,Ie=St.y,se=St.z||0,Ce=xe-Mt,Pe=Ie-kt,Qe=se-Ye,ze=Mt+Ce*Tt,je=kt+Pe*Tt,fe=Ye+Qe*Tt;return{dis:Z,coordinate:new L(ze,je,fe)}},i._getWindowWidth=function(){var t=dl.width,e=this.options.width;return e||(e=t),e},a}(Le);an.mergeOptions(dl);var hh="remove hide shapechange positionchange dragend animatestart",Rg={width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400},gl=function(s){z(i,s);var a=i.prototype;a._getClassName=function(){return"ToolTip"};function i(r,t){var e;return t===void 0&&(t={}),e=s.call(this,t)||this,e._content=r,e}return a.addTo=function(t){if(i.isSupport(t))return t.on("mousemove",this.onMouseMove,this),t.on("mouseout",this.onMouseOut,this),t.on(hh,this.hideDom,this),s.prototype.addTo.call(this,t);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},a.setStyle=function(t){return this.options.containerClass=t,this},a.getStyle=function(){return this.options.containerClass},a.getContent=function(){return this._content},a.buildOn=function(){var t=V("div"),e=this.options||{};e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px");var n=e.containerClass||e.cssName;return!n&&e.height&&(t.style.lineHeight=e.height+"px"),it(this._content)?this._content.bind(this)(t):t.innerHTML='<div class="'+n+'">'+this._content+"</div>",t},a.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},a.onMouseMove=function(t){var e=this;clearTimeout(this._timeout);var n=this.getMap();if(n){var o=n.locateByPoint(t.coordinate,-5,25);this.options.showTimeout===0?this.show(o):this._timeout=setTimeout(function(){n&&e.show(o)},this.options.showTimeout)}},a.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(hh,this.hideDom,this))},a.hideDom=function(){return this.hide()},a.onEvent=function(){return s.prototype.onEvent.call(this),this.hideDom(),this},a._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},i}(Le);gl.mergeOptions(Rg);var Ag={containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]},Ss=function(s){z(a,s);function a(r){return s.call(this,r)||this}var i=a.prototype;return i._getClassName=function(){return"Menu"},i.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,this._owner=t,Le.prototype.addTo.apply(this,arguments)},i.setItems=function(t){return this.options.items=t,this},i.getItems=function(){return this.options.items||[]},i.buildOn=function(){if(this.options.custom)if(tt(this.options.items)){var t=V("div");return t.innerHTML=this.options.items,t}else return this.options.items;else{var e=V("div");this.options.containerClass&&Ze(e,this.options.containerClass),e.style.width=this._getMenuWidth()+"px";var n=this._createMenuItemDom();return e.appendChild(n),gt(e,"contextmenu",ue),e}},i.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),n=this.getSize(),o=0,h=0;return e.x+n.width>t.width&&(o=-n.width),e.y+n.height>t.height&&(h=-n.height),new E(o,h)},i.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},i.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},i._createMenuItemDom=function(){var t=this,e=this.getMap(),n=V("ul");Ze(n,"maptalks-menu-items");var o=this.getItems();function h(v){return function(m){var _=e._parseEvent(m,"click");_.target=t,_.owner=t._owner,_.index=v;var p=this._callback(_);p!==!1&&(t.hide(),t._owner&&t._owner.fire("closemenu"))}}for(var u,l,f=0,c=o.length;f<c;f++){if(u=o[f],u==="-"||u==="_")l=V("li"),Ze(l,"maptalks-menu-splitter");else{l=V("li");var d=u.item;it(d)&&(d=d({owner:this._owner,index:f})),l.innerHTML=d,l._callback=u.click,gt(l,"click",h(f))}n.appendChild(l)}var g=this.options.maxHeight||0;return g>0&&cr(n,"max-height: "+g+"px; overflow-y: auto;"),n},i._getMenuWidth=function(){var t=160,e=this.options.width||t;return e},a}(Le);Ss.mergeOptions(Ag);var bs={setMenu:function(a){return this._menuOptions=a,this._menu?this._menu.setOptions(a):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(a){var i=this instanceof $?this:this.getMap();return a||(a=this.getCenter()),this._menu?this._menu.show(a):this._menuOptions&&i&&(this._bindMenu(),this._menu.show(a)),this.fire("openmenu",{coordinate:a}),this},setMenuItems:function(a){return this._menuOptions||(this._menuOptions={}),Array.isArray(a)&&(this._menuOptions.custom=!1),this._menuOptions.items=a,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions?this._menuOptions.items||[]:[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new Ss(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(a){return this.openMenu(a.coordinate),!1}};$.include(bs);ot.include(bs);var Bv=Object.freeze({UIComponent:Le,UIMarker:Mn,InfoWindow:an,ToolTip:gl,Menuable:bs,Menu:Ss}),qt=function(s){z(a,s);function a(r){return r&&r.position&&!tt(r.position)&&(r.position=F({},r.position)),s.call(this,r)||this}var i=a.prototype;return i.addTo=function(t){if(this.remove(),!t.options.control)return this;this._map=t;var e=t._panels.control;return this.__ctrlContainer=V("div"),cr(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},i.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},i.getMap=function(){return this._map},i.getPosition=function(){return F({},this._parse(this.options.position))},i.setPosition=function(t){return tt(t)?this.options.position=t:this.options.position=F({},t),this._updatePosition(),this},i.getContainerPoint=function(){var t=this.getPosition(),e=this.getMap().getSize(),n,o;return P(t.left)?P(t.right)||(n=e.width-parseInt(t.right)):n=parseInt(t.left),P(t.top)?P(t.bottom)||(o=e.height-parseInt(t.bottom)):o=parseInt(t.top),new E(n,o)},i.getContainer=function(){return this.__ctrlContainer},i.getDOM=function(){return this._controlDom},i.show=function(){return this.__ctrlContainer.style.display="",this},i.hide=function(){return this.__ctrlContainer.style.display="none",this},i.isVisible=function(){return this.__ctrlContainer&&this.__ctrlContainer.style.display===""},i.remove=function(){return this._map?(Je(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},i._parse=function(t){var e=t;return tt(t)&&(e=a.positions[e]),e},i._updatePosition=function(){var t=this.getPosition();t||(t={top:20,left:20});for(var e in t)if(t.hasOwnProperty(e)){var n=t[e]||0;H(n)&&(n+="px"),this.__ctrlContainer.style[e]=n}this.fire("positionchange",{position:F({},t)})},a}(le(Bt));qt.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}};$.mergeOptions({control:!0});$.include({addControl:function(a){return this._containerDOM.getContext?this:(a.addTo(this),this)},removeControl:function(a){return!a||a.getMap()!==this?this:(a.remove(),this)}});var Og={position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'},uh="addlayer removelayer setbaselayer baselayerremove",Es=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(){return this._attributionContainer=V("div"),this._attributionContainer.className="maptalks-attribution",this._update(),this._attributionContainer},i.onAdd=function(){this.getMap().on(uh,this._update,this)},i.onRemove=function(){this.getMap().off(uh,this._update,this)},i._update=function(){var t=this.getMap();if(t){var e=t._getLayers(function(o){return o.options.attribution}).reverse().map(function(o){return o.options.attribution}),n=this.options.content+(e.length>0?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+n+"</span>"}},a}(qt);Es.mergeOptions(Og);$.mergeOptions({attribution:!0});$.addOnLoadHook(function(){var s=this.options.attribution||this.options.attributionControl;s&&(this.attributionControl=new Es(s),this.addControl(this.attributionControl))});var Dg={position:{top:120,left:20}},Rs=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(t){var e=this._getCompass();return this._compass=e,this._registerDomEvents(),t.on("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),e},i.onAdd=function(){this._rotateCompass()},i._getCompass=function(){var t=V("div","maptalks-compass");return t},i._registerDomEvents=function(){gt(this._compass,"click",this._resetView,this)},i._rotateCompass=function(){var t=this.getMap().getBearing().toFixed(1);t<=180&&(t*=-1),t!==this._bearing&&(this._bearing=t,cr(this._compass,"transform: rotate("+this._bearing+"deg);"))},i.onRemove=function(){this.getMap().off("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),delete this._compass,delete this._bearing},i._resetView=function(){var t={bearing:0};this.getMap().animateTo(t)},a}(qt);Rs.mergeOptions(Dg);$.mergeOptions({compassControl:!1});$.addOnLoadHook(function(){this.options.compassControl&&(this.compassControl=new Rs(this.options.compassControl),this.addControl(this.compassControl))});var kg={position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"},As=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(){var t=this.container=V("div",this.options.containerClass),e=this.panel=V("div","panel"),n=this.button=V("button");return t.appendChild(n),t.appendChild(e),t},i.onAdd=function(){gt(this.button,"mouseover",this._show,this),gt(this.panel,"mouseleave",this._hide,this),gt(this.getMap(),"click",this._hide,this)},i.onRemove=function(){this.panel&&(_t(this.button,"mouseover",this._show),_t(this.panel,"mouseleave",this._hide),_t(this.getMap(),"click",this._hide),Je(this.panel),Je(this.button),delete this.panel,delete this.button,delete this.container)},i._show=function(){es(this.container,"shown")||(Ze(this.container,"shown"),this._createPanel())},i._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||_n(this.container,this.options.containerClass)},i._createPanel=function(){this.panel.innerHTML="";var t=V("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},i._renderLayers=function(t,e){var n=this,o=t.getBaseLayer(),h=t.getLayers(),u=h.length;if(o){var l=o.layers||[o],f=V("li","group"),c=V("ul"),d=V("label");d.innerHTML=this.options.baseTitle,f.appendChild(d);for(var g=0,v=l.length;g<v;g++){var m=l[g];this._isExcluded(m)&&(c.appendChild(this._renderLayer(l[g],!0)),f.appendChild(c),e.appendChild(f))}}if(u){var _=V("li","group"),p=V("ul"),y=V("label"),w=V("input");w.type="checkbox",w.checked=!0,y.innerHTML=this.options.overlayTitle,_.appendChild(w),_.appendChild(y);for(var C=function(T){var b=T.target.checked,D=T.target.parentNode;if(D){var R=D.getElementsByTagName("ul")[0];if(R){var k=function(j){var G=j._layer;G&&G[b?"show":"hide"]()},O=function(j){var G=j._layer,N=j.childNodes[0];N&&(N.checked=b),G&&G[b?"show":"hide"]()};k(D),R.childNodes.forEach(function(A){O(A);var j=A.getElementsByTagName("ul")[0];j&&(k(A),j.childNodes.forEach(function(G){O(G)}))})}}},x=0;x<u;x++){var M=h[x];this._isExcluded(M)&&(M.getLayers?function(){var S=V("li","group"),T=V("ul"),b=V("label"),D=V("input");b.innerHTML=M.getId(),D.type="checkbox",D.checked=M.isVisible(),D.onchange=C,S.appendChild(D),S.appendChild(b),S.appendChild(T),S._layer=M,p.appendChild(S);var R=M.getLayers()||[];R.forEach(function(k){T.appendChild(n._renderLayer(k,!1,D.checked))})}():p.appendChild(this._renderLayer(M)),M&&!M.isVisible()&&(w.checked=!1))}_.appendChild(p),e.appendChild(_),w.onchange=C}},i._isExcluded=function(t){var e=t.getId(),n=this.options.excludeLayers;return!(n.length&&n.indexOf(e)>=0)},i._renderLayer=function(t,e,n){var o=this;n===void 0&&(n=!0);var h=V("li","layer"),u=V("label"),l=V("input"),f=this.getMap(),c=t.options.visible;t.options.visible=!0;var d=t.isVisible();return t.options.visible=c,h.className="layer",e?(l.type="radio",l.name="base"):l.type="checkbox",l.checked=c&&d,n||(l.checked=!1),d||l.setAttribute("disabled","disabled"),l.onchange=function(g){if(g.target.type==="radio"){var v=f.getBaseLayer(),m=v.layers;if(m)for(var _=0,p=m.length;_<p;_++){var y=m[_];y[y===t?"show":"hide"]()}else v.isVisible()||v.show();f._fireEvent("setbaselayer")}else t[g.target.checked?"show":"hide"]();o.fire("layerchange",{target:t})},h.appendChild(l),u.innerHTML=t.getId(),h.appendChild(u),h._layer=t,h},a}(qt);As.mergeOptions(kg);$.mergeOptions({layerSwitcherControl:!1});$.addOnLoadHook(function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new As(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))});var Lg={level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"},Os=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=V("div"),n=this.mapContainer=V("div");n.style.width=t[0]+"px",n.style.height=t[1]+"px",n.className=this.options.containerClass;var o=this.button=V("div");return o.className=this.options.buttonClass,e.appendChild(n),e.appendChild(o),e},i.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),gt(this.button,"click",this._onButtonClick,this),this._updateButtonText()},i.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),_t(this.button,"click",this._onButtonClick)},i.maxmize=function(){var t=this.options.size,e=this.mapContainer;return e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview(),this},i.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;return t.style.width="0px",t.style.height="0px",this},i.getOverviewMap=function(){return this._overview},i._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},i._updateButtonText=function(){this._overview?this.button.innerHTML="-":this.button.innerHTML="+"},i._createOverview=function(){var t=this.getMap(),e=this.mapContainer,n=t.config();F(n,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new $(e,n),this._updateBaseLayer(),this._perspective=new Ct(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new ye("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},i._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),n=t.getMinZoom(),o=this.options.level;if(o>0){for(var h=o;h>0;h--)if(e-h>=n)return e-h}else for(var u=o;u<0;u++)if(e-u>=n)return e-u;return e},i._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},i._getPerspectiveCoords=function(){var t=this.getMap(),e=t.getProjection();return t.getContainerExtent().toArray().map(function(n){if(e){var o=t._containerPointToPrj(n);return t._fixPrjOnWorldWide(o),e.unproject(o)}return t.containerPointToCoordinate(n)})},i._update=function(){if(this._overview){fr(this._overview._containerDOM);var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},i._updateSpatialReference=function(){if(this._overview){var t=this.getMap(),e=t.options.spatialReference;this._overview.setSpatialReference(e)}},i._updateBaseLayer=function(){if(this._overview){var t=this.getMap(),e=t.getBaseLayer();if(!e){this._overview.setBaseLayer(null);return}var n=e.layers,o=0;if(n)for(var h=0,u=n.length;h<u;h++){var l=n[h];if(l.isVisible()){o=h;break}}var f=e.toJSON(),c=null;n?(c=f.layers[o].options,c.visible=!0):c=f.options,this._overview.setMinZoom(c.minZoom||null).setMaxZoom(c.maxZoom||null),delete c.minZoom,delete c.maxZoom,delete f.options.canvas,f.options.visible=!0,f.options.renderer="canvas";var d=It.fromJSON(f);for(var g in e)it(e[g])&&e.hasOwnProperty(g)&&e[g]!==e.constructor.prototype[g]&&(d[g]=e[g]);this._overview.setBaseLayer(d)}},a}(qt);Os.mergeOptions(Lg);$.mergeOptions({overviewControl:!1});$.addOnLoadHook(function(){this.options.overviewControl&&(this.overviewControl=new Os(this.options.overviewControl),this.addControl(this.overviewControl))});var Ig={position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0},vl=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(){var t;if(this.options.custom)tt(this.options.content)?(t=V("div"),t.innerHTML=this.options.content):t=this.options.content;else{if(t=V("div","maptalks-panel"),this.options.closeButton){var e=V("a","maptalks-close");e.innerText="×",e.href="javascript:;",e.onclick=function(){t.style.display="none"},t.appendChild(e)}var n=V("div","maptalks-panel-content");n.innerHTML=this.options.content,t.appendChild(n)}return this.draggable=new gr(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},i.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),qt.prototype.update.call(this)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},i.getContent=function(){return this.options.content},i._cancelOn=function(t){var e=t.srcElement||t.target,n=e.tagName.toLowerCase();return n==="button"||n==="input"||n==="select"||n==="option"||n==="textarea"},i._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=F({},this.getPosition()),this.fire("dragstart",t)},i._onDragging=function(t){var e=t.mousePos,n=e.sub(this._startPos),o=this._startPosition,h=this.getPosition();P(h.top)||(h.top=parseInt(o.top)+n.y),P(h.bottom)||(h.bottom=parseInt(o.bottom)-n.y),P(h.left)||(h.left=parseInt(o.left)+n.x),P(h.right)||(h.right=parseInt(o.right)-n.x),this.setPosition(h),this.fire("dragging",t)},i._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},i._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),n=this.getDOM(),o=parseInt(n.clientWidth),h=parseInt(n.clientHeight),u=[t.containerPointToCoordinate(e.add(o/2,0)),t.containerPointToCoordinate(e.add(o,h/2)),t.containerPointToCoordinate(e.add(o/2,h)),t.containerPointToCoordinate(e.add(0,h/2))];return u},a}(qt);vl.mergeOptions(Ig);var zg={position:{top:156,left:20},view:null},Ds=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(){var t=this._getReset();return this._reset=t,this._registerDomEvents(),t},i.onAdd=function(){this._view=this.options.view?this.options.view:this.getMap().getView()},i.setView=function(t){this._view=t},i._getReset=function(){var t=V("div","maptalks-reset");return t},i._registerDomEvents=function(){gt(this._reset,"click",this._resetView,this)},i.onRemove=function(){delete this._reset,delete this._view},i._resetView=function(){this.getMap().setView(this._view)},a}(qt);Ds.mergeOptions(zg);$.mergeOptions({resetControl:!1});$.addOnLoadHook(function(){this.options.resetControl&&(this.resetControl=new Ds(this.options.resetControl),this.addControl(this.resetControl))});var jg={position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null},lh="zoomend moving moveend",ks=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(t){return this._map=t,this._scaleContainer=V("div",this.options.containerClass),this._addScales(),t.on(lh,this._update,this),this._map._loaded&&this._update(),this._scaleContainer},i.onRemove=function(){this.getMap().off(lh,this._update,this)},i._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=Sa("div",this.options.containerClass?null:t,this._scaleContainer)),this.options.imperial&&(this._iScale=Sa("div",this.options.containerClass?null:t,this._scaleContainer))},i._update=function(){var t=this._map,e=t.pixelToDistance(this.options.maxWidth,0);this._updateScales(e)},i._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},i._updateMetric=function(t){var e=this._getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,n,e/t)},i._updateImperial=function(t){var e=t*3.2808399,n,o,h;e>5280?(n=e/5280,o=this._getRoundNum(n),this._updateScale(this._iScale,o+" mile",o/n)):(h=this._getRoundNum(e),this._updateScale(this._iScale,h+" feet",h/e))},i._updateScale=function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},i._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,e*n},a}(qt);ks.mergeOptions(jg);$.mergeOptions({scaleControl:!1});$.addOnLoadHook(function(){this.options.scaleControl&&(this.scaleControl=new ks(this.options.scaleControl),this.addControl(this.scaleControl))});var Gg={height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}},ml=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(t){this._map=t;var e=V("div"),n=V("ul","maptalks-toolbar-hx");e.appendChild(n),this.options.vertical?Ze(e,"maptalks-toolbar-vertical"):Ze(e,"maptalks-toolbar-horizonal");var o=this;function h(m,_,p,y){var w=o._getItems()[_];return function(C){return jt(C),m({target:w,index:_,childIndex:p,dom:y})}}var u=this.options.items;if(st(u))for(var l=0,f=u.length;l<f;l++){var c=u[l],d=V("li");if(this.options.height!==28&&(d.style.lineHeight=this.options.height+"px"),d.style.height=this.options.height+"px",d.style.cursor="pointer",eu(c.item)){d.style.textAlign="center";var g=iu("div",c.item);d.innerHTML='<div style="margin-top:'+(this.options.height-g.height)/2+'px;">'+c.item+"</div>"}else d.innerHTML=c.item;if(c.click&&gt(d,"click",h(c.click,l,null,d)),st(c.children)){var v=this._createDropMenu(l);d.appendChild(v),d._menu=v,gt(d,"mouseover",function(){this._menu.style.display=""}),gt(d,"mouseout",function(){this._menu.style.display="none"})}n.appendChild(d)}return e},i._createDropMenu=function(t){var e=this;function n(C,x,M){var S=e._getItems()[x].children[M];return function(T){return jt(T),C({target:S,index:x,childIndex:M})}}var o=V("div","maptalks-dropMenu"),h=this._getItems(),u=h.length,l=V("ul"),f=h[t].children;t===u-1&&f&&(o.style.cssText="right: 0px;",l.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(l.style.bottom=0)),o.appendChild(V("em","maptalks-ico"));for(var c=0,d=0,g=f.length;d<g;d++){var v=cn(f[d].item,"12px");v.width>c&&(c=v.width)}for(var m=0,_=f.length;m<_;m++){var p=f[m],y=V("li");y.innerHTML='<a href="javascript:;">'+p.item+"</a>",y.style.cursor="pointer",y.style.width=c+24+"px",gt(y.childNodes[0],"click",n(p.click,t,m)),l.appendChild(y)}if(this.options.vertical){var w=c<95?95:c;this.options.reverseMenu?o.style.right=-(w+10*2+2)+"px":o.style.left=-(w+10*2+2)+"px"}else this.options.reverseMenu?o.style.bottom="28px":o.style.top="29px";return o.appendChild(l),o.style.display="none",o},i._getItems=function(){return this.options.items||[]},a}(qt);ml.mergeOptions(Gg);var Fg={position:"top-left",zoomLevel:!0,seamless:!1},Ls=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(t){var e=this.options,n=V("div","maptalks-zoom");if(e.zoomLevel){var o=V("span","maptalks-zoom-zoomlevel"),h=V("span","maptalks-zoom-zoomlevel-text");o.appendChild(h),n.appendChild(o),this._levelDOM=h}var u=V("div","maptalks-zoom-slider"),l=V("a","maptalks-zoom-zoomin");l.href="javascript:;",u.appendChild(l),this._zoomInButton=l;var f=V("a","maptalks-zoom-zoomout");return f.href="javascript:;",u.appendChild(f),this._zoomOutButton=f,n.appendChild(u),t.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),n},i.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this)},i._update=function(){this._updateText()},i._updateText=function(){if(this._levelDOM){var t=this.getMap(),e=t.getZoom();Ne(e)||(e=Math.floor(e*10)/10),this._levelDOM.innerHTML=e}},i._registerDomEvents=function(){this._zoomInButton&&gt(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&gt(this._zoomOutButton,"click",this._onZoomOutClick,this)},i._onZoomInClick=function(t){ue(t),this.getMap().zoomIn()},i._onZoomOutClick=function(t){ue(t),this.getMap().zoomOut()},a}(qt);Ls.mergeOptions(Fg);$.mergeOptions({zoomControl:!1});$.addOnLoadHook(function(){this.options.zoomControl&&(this.zoomControl=new Ls(this.options.zoomControl),this.addControl(this.zoomControl))});var Zv=Object.freeze({Control:qt,Attribution:Es,Compass:Rs,LayerSwitcher:As,Overview:Os,Panel:vl,Reset:Ds,Scale:ks,Toolbar:ml,Zoom:Ls}),Oe=function(){function s(a,i,r,t){Array.isArray(a)?(this.scale={x:a[0],y:a[1]},this.origin={x:a[2],y:a[3]}):(this.scale={x:a,y:i},this.origin={x:r,y:t})}return s.getDefault=function(i){var r=i.code.toLowerCase();return r==="baidu"?"baidu":r==="EPSG:4326".toLowerCase()||r==="EPSG:4490".toLowerCase()?"tms-global-geodetic":r==="identity"?[1,-1,0,0]:"web-mercator"},s}(),Dr=6378137*Math.PI;F(Oe,{"web-mercator":new Oe([1,-1,-Dr,Dr]),"tms-global-mercator":new Oe([1,1,-Dr,-Dr]),"tms-global-geodetic":new Oe([1,1,-180,-90]),baidu:new Oe([1,1,0,0])});var fh=function(){function s(i,r,t,e){this.map=i,this.tileSize=e,this.fullExtent=t,this.prepareTileInfo(r,t),this._xScale=t.right>=t.left?1:-1,this._yScale=t.top>=t.bottom?1:-1;var n=i.getGLRes();this._pointOrigin=i._prjToPointAtRes(new E(this.tileSystem.origin),n),this._glRes=n}var a=s.prototype;return a.prepareTileInfo=function(r,t){if(tt(r)?r=Oe[r.toLowerCase()]:Array.isArray(r)&&(r=new Oe(r)),!r)throw new Error("Invalid TileSystem");this.tileSystem=r;var e=t.right>t.left?1:-1,n=t.top>t.bottom?-1:1,o=r.origin.x,h=r.origin.y;this.transformation=new xu([e,n,o,h])},a._getTileNum=function(r,t){var e=this.tileSystem,n=this.tileSize,o=1e-7,h=Math.floor(o*e.scale.x+r.x/(n.width*t)),u=Math.ceil(o*e.scale.y+r.y/(n.height*t));return{x:e.scale.x*h,y:e.scale.y*u}},a.getTileIndex=function(r,t,e){var n=this.tileSystem,o=this.transformation.transform(r,1),h=this._getTileNum(o,t);return n.scale.x<0&&(h.x-=1),n.scale.y>0&&(h.y-=1),this.getNeighorTileIndex(h.x,h.y,0,0,t,e)},a.getNeighorTileIndex=function(r,t,e,n,o,h){var u=this.tileSystem,l=r+u.scale.x*e,f=t-u.scale.y*n,c=!1,d=l,g=f,v=this._getTileFullIndex(o);return h&&((h===!0||h==="x")&&(v.xmax===v.xmin?l=v.xmin:l<v.xmin?(l=v.xmax-(v.xmin-l)%(v.xmax-v.xmin),l===v.xmax&&(l=v.xmin)):l>=v.xmax&&(l=v.xmin+(l-v.xmin)%(v.xmax-v.xmin))),(h===!0||h==="y")&&(v.ymax===v.ymin?f=v.ymin:f>=v.ymax?f=v.ymin+(f-v.ymin)%(v.ymax-v.ymin):f<v.ymin&&(f=v.ymax-(v.ymin-f)%(v.ymax-v.ymin),f===v.ymax&&(f=v.ymin)))),(l<v.xmin||l>v.xmax||f>v.ymax||f<v.ymin)&&(c=!0),{x:l,y:f,idx:d,idy:g,out:c}},a._getTileFullIndex=function(r){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[r])return this._tileFullIndex[r];var t=this.fullExtent,e=this.transformation,n=this._getTileNum(e.transform(new L(t.left,t.top),1),r),o=this._getTileNum(e.transform(new L(t.right,t.bottom),1),r),h=this.tileSystem;return h.scale.x<0&&(n.x-=1,o.x-=1),h.scale.y>0&&(n.y-=1,o.y-=1),this._tileFullIndex[r]=new ft(n,o),this._tileFullIndex[r]},a.getTilePrjNW=function(r,t,e,n){var o=this.tileSystem,h=this.tileSize,u=o.origin.y+this._yScale*o.scale.y*(t+(o.scale.y===1?1:0))*e*h.height,l=o.origin.x+this._xScale*o.scale.x*(r+(o.scale.x===1?0:1))*e*h.width;return n?(n.set(l,u),n):new L(l,u)},a.getTilePointNW=function(r,t,e,n){var o=this._glRes/e,h=this.tileSystem,u=this.tileSize,l=this._pointOrigin.y*o+this._yScale*h.scale.y*(t+(h.scale.y===1?1:0))*u.height,f=this._pointOrigin.x*o+this._xScale*h.scale.x*(r+(h.scale.x===1?0:1))*u.width;return n?(n.set(f,l),n):new E(f,l)},a.getTilePrjSE=function(r,t,e,n){var o=this.tileSystem,h=this.tileSize,u=o.origin.y+this._yScale*o.scale.y*(t+(o.scale.y===1?0:1))*e*h.height,l=o.origin.x+this._xScale*o.scale.x*(r+(o.scale.x===1?1:0))*e*h.width;return n?(n.set(l,u),n):new L(l,u)},a.getTilePointSE=function(r,t,e,n){var o=this._glRes/e,h=this.tileSystem,u=this.tileSize,l=this._pointOrigin.y*o+this._yScale*h.scale.y*(t+(h.scale.y===1?0:1))*u.height,f=this._pointOrigin.x*o+this._xScale*h.scale.x*(r+(h.scale.x===1?1:0))*u.width;return n?(n.set(f,l),n):new E(f,l)},a.getTilePrjExtent=function(r,t,e){var n=this.getTilePrjNW(r,t,e),o=this.getTilePrjSE(r,t,e);return new ft(n,o)},s}(),Hg=1,Oi=new E(0,0),Ng=32,kr=typeof Set<"u",ch=function(){function s(){this._table=kr?new Set:{}}var a=s.prototype;return a.add=function(r){kr?this._table.add(r):this._table[r]=!0},a.has=function(r){return kr?this._table.has(r):this._table[r]},a.reset=function(){kr?this._table.clear():this._table={}},s}(),Bg={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,loadingLimitOnInteracting:3,loadingLimit:0,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!bt,fadeDuration:1e3/60*10,debug:!1,spatialReference:null,maxCacheSize:256,renderer:function(){return q.webgl?"gl":"canvas"}(),clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1,tileLimitPerFrame:0,tileStackStartDepth:7,tileStackDepth:6,awareOfTerrain:!0,bufferPixel:.5,mipmapTexture:!0,depthMask:!0,currentTilesFirst:!0},Zg=/\{ *([\w_]+) *\}/g,Wg=new E(0,0),Lr=new E(0,0),Di=new E(0,0),be=new E(0,0),Vg=new E(0,0),Ug=new E(0,0),At=[[0,0,0],[0,0,0]],ca=[0,0,0],da=[0,0,0],ga=[],te=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}a.fromJSON=function(t){return!t||t.type!=="TileLayer"?null:new a(t.id,t.options)};var i=a.prototype;return i.forceReload=function(){return this.fire("forcereloadstart"),this.clear(),this.load(),this.fire("forcereloadend"),this},i.getTileSize=function(){if(this._tileSize)return this._tileSize;var t=this.options.tileSize;return H(t)&&(t=[t,t]),this._tileSize=new xt(t),this._tileSize},i.getTiles=function(t,e){return this._coordCache={},this._isPyramidMode()?this._getPyramidTiles(t,e):this._getCascadeTiles(t,e)},i._isPyramidMode=function(){var t=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&t&&t.isPyramid()},i._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var t=this.getSpatialReference(),e=t.getFullExtent(),n=t.getResolution(0),o=this.getMap();return this._tileFullExtent=e.convertTo(function(h){return o._prjToPointAtRes(h,n,Oi)}),this._tileFullExtent},i._getRootNodes=function(t){var e=this.getMap();if(this._rootNodes){var n=this._rootNodes,o=n.tiles,h=n.mapWidth,u=n.mapHeight;if(e.width!==h||e.height!==u){for(var l=this._getRootError(),f=0;f<o.length;f++)o[f].error=l;this._rootNodes.mapWidth=e.width,this._rootNodes.mapHeight=e.height}for(var c=0;c<o.length;c++)o[c].offset[0]=t[0],o[c].offset[1]=t[1];return this._rootNodes}var d=this.getSpatialReference(),g=d.getResolution(0),v=this._getTileConfig(),m=d.getFullExtent(),_=v.tileSystem,p=_.origin,y=_.scale,w=v.getTilePrjExtent(0,0,g),C=w.getWidth(),x=w.getHeight(),M=1e-5,S=Math.abs((p.x-m.left)/C);S=Math.ceil(S-M);var T=Math.abs((m.right-p.x)/C);T=Math.ceil(T-M);var b=Math.ceil(Math.abs(m.top-p.y)/x);b=Math.ceil(b-M);var D=Math.ceil(Math.abs(m.bottom-p.y)/x);if(D=Math.ceil(D-M),(T+S)*(D+b)>Ng)return{status:0,error:"Too many root nodes"};for(var R=this._getRootError(),k=[],O=0,A=-S;A<T;A++)for(var j=-b;j<D;j++){var G=y.y<0?j:-(j+1);k.push(this.createTileNode(A,G,O,A,G,g,R))}return this._rootNodes={status:1,tiles:k,mapWidth:e.width,mapHeight:e.height},this._getRootNodes(t)},i.createTileNode=function(t,e,n,o,h,u,l,f,c,d){var g=this.getMap(),v=this.options.zoomOffset;if(!c){var m=this._getTileConfig();c=m.getTilePrjExtent(t,e,u).convertTo(function(p){return g._prjToPointAtRes(p,u,Oi)})}var _=this._getTileOffset(n);return{parent:f,layer:this.getId(),x:t,y:e,z:n,idx:o,idy:h,res:u,extent2d:c,id:d||this._getTileId(t,e,n),url:this.getTileUrl(t,e,n+v),offset:_,error:l,children:[]}},i._getRootError=function(){var t=this.getMap(),e=pt(t.getFov()),n=t.width/t.height,o=t.cameraPosition[2],h=o*Math.tan(.5*e),u=h*n,l=Math.sqrt(o*o+h*h+u*u),f=t._getFovZ(0),c=f*(l/o),d=this.getSpatialReference(),g=d.getResolution(0);return c*g/t.getResolution(0)},i._getPyramidTiles=function(t,e){var n=this.getMap();isNaN(+t)&&(t=this._getTileZoom(n.getZoom()));var o=this.getSpatialReference(),h=Math.min(t,this.getMaxZoom(),this.getMaxAvailableZoom()||1/0),u=n.projViewMatrix,l=this._getTileFullExtent(),f=this._getTileOffset(0),c;if(this.options.repeatWorld){var d=n.getContainerExtent(),g=this._convertToExtent2d(d),v=o.getResolution(0)/n.getResolution();if(g.within(l.copy()._scale(v))){var x=this._getRootNodes(f);if(x.status!==1)return console.warn(x.error),this._disablePyramid=!0,this.getTiles(t,e);c=x.tiles.concat()}else{var m=n.getPitch(),_=n.options.cascadePitches[1],p=Math.floor(n._getVisualHeight(_)),y=m<=_?d:new Q(0,n.height-p,n.width,n.height);this._visitedTiles=new ch;var w=this._getTiles(0-this.options.zoomOffset,y,2,e&&e.getRenderer(),!0),C=this._getRootError()*Math.pow(2,this.options.zoomOffset);w.tiles.forEach(function(O){O.error=C}),c=w.tiles}}else{var M=this._getRootNodes(f);if(M.status!==1)return console.warn(M.error),this._disablePyramid=!0,this.getTiles(t,e);c=M.tiles.concat()}for(var S=n.getGLRes(),T={0:f},b=new Q,D=[],R=[];c.length>0;){var k=c.pop();if(k.z===h){b._combine(k.extent2d),D.push(k);continue}T[k.z+1]||(T[k.z+1]=this._getTileOffset(k.z+1)),this._splitNode(k,u,c,D,b,h,T[k.z+1],e&&e.getRenderer(),S),this.isParentTile(t,h,k)&&R.push(k)}return R.sort(Xg),{tileGrids:[{extent:b,count:D.length,tiles:D,parents:R,offset:[0,0],zoom:t}],count:D.length}},i.isParentTile=function(t,e,n){var o=Math.max(this.getMinZoom(),t-this.options.tileStackStartDepth),h=Math.min(e,o+this.options.tileStackDepth);return n.z>=o&&n.z<h},i._splitNode=function(t,e,n,o,h,u,l,f,c){for(var d=t.z+1,g=this.getSpatialReference(),v=t.idx,m=t.idy,_=f||this.getRenderer(),p=!1,y=[],w=g.getResolution(d),C=w/c,x=0;x<4;x++){var M=x%2,S=x>>1,T=(v<<1)+M,b=(m<<1)+S;t.children||(t.children=[]);var D=t.children[x];D||(D=this._getTileId(T,b,d),t.children[x]=D);var R=_.isTileCachedOrLoading(D),k=R&&R.info;k||(this.tileInfoCache||(this.tileInfoCache=new gu(this.options.maxCacheSize*4)),k=this.tileInfoCache.get(D),k||(k=this._createChildNode(t,M,S,l,D))),k.error=t.error/2,k.offset[0]=l[0],k.offset[1]=l[1];var O=this._isTileVisible(k,e,C,u,l);if(O===1)p=!0;else{if(O===-1)continue;if(O===0&&d!==u){o.push(t),h._combine(t.extent2d);return}}y.push(k)}d===u?p?n.push.apply(n,y):(o.push(t),h._combine(t.extent2d)):n.push.apply(n,y)},i._createChildNode=function(t,e,n,o,h){var u=t.x,l=t.y,f=t.idx,c=t.idy,d=t.extent2d,g=t.z+1,v=(u<<1)+e,m=(l<<1)+n,_=(f<<1)+e,p=(c<<1)+n,y=2,w=d.getWidth()/2*y,C=d.getHeight()/2*y,x=d.xmin*y,M=d.ymax*y,S=d.ymin*y,T=this._getTileConfig().tileSystem,b=T.scale.y;h=h||this._getTileId(_,p,g);var D;if(b<0){var R=x+e*w,k=M-n*C;D=new Q(R,k-C,R+w,k)}else{var O=x+e*w,A=S+n*C;D=new Q(O,A,O+w,A+C)}var j=this.createTileNode(v,m,g,_,p,t.res/2,t.error/2,t.id,D,h);return this.tileInfoCache.add(h,j),j},i._isTileVisible=function(t,e,n,o,h){if(t.z===0)return 1;if(!this._isTileInFrustum(t,e,n,h))return-1;var u=this.options.maxError;P(u)&&(u=Hg);var l=this._getScreenSpaceError(t,n,o,h);return l>=u?1:0},i._isTileInFrustum=function(t,e,n,o){if(!this._zScale){var h=this.getMap(),u=h.getGLRes();this._zScale=h.altitudeToPoint(100,u)/100}var l=this.getRenderer(),f=t.extent2d,c=f.xmin,d=f.ymin,g=f.xmax,v=f.ymax;At[0][0]=(c-o[0])*n,At[0][1]=(d-o[1])*n;var m=t.minAltitude||l&&l.avgMinAltitude||0;At[0][2]=m*this._zScale,At[1][0]=(g-o[0])*n,At[1][1]=(v-o[1])*n;var _=t.maxAltitude||l&&l.avgMaxAltitude||0;return At[1][2]=_*this._zScale,An(e,At)},i._getScreenSpaceError=function(t,e,n,o){var h=t.error,u=this.getMap(),l=t.extent2d,f=l.xmin,c=l.ymin,d=l.xmax,g=l.ymax;ca[0]=(f-o[0])*e,ca[1]=(c-o[1])*e,da[0]=(d-o[0])*e,da[1]=(g-o[1])*e;var v=Jg(ca,da,u.cameraPosition),m=Math.max(Math.abs(v),1e-7),_=Math.abs(t.z-n),p;u.height<1e3?p=1:p=_<=1?1:_<=2?.7:.605;var y=h*p/m;return y},i._getCascadeTiles=function(t,e){var n=this.getMap(),o=n.getPitch(),h=e&&e.getRenderer(),u=n.getContainerExtent(),l=[],f=0,c=this.getMinZoom(),d=n.options.cascadePitches[0],g=n.options.cascadePitches[1],v=Math.floor(n._getVisualHeight(g)),m=P(t)?this._getTileZoom(n.getZoom()):t;if(this._visitedTiles=new ch,!P(t)||!this.options.cascadeTiles||o<=d||!P(c)&&m<=c){var _=o<=g?u:new Q(0,n.height-v,n.width,n.height),p=this._getTiles(m,_,2,h);return p&&(f+=p.tiles.length,l.push(p)),{tileGrids:l,count:f}}var y=Math.floor(n._getVisualHeight(d)),w=new Q(0,n.height-y,n.width,n.height),C=this._getTiles(m,w,0,h);f+=C?C.tiles.length:0,l.push(C);var x=w.ymin,M=n.getSpatialReference().getZoomDirection(),S=M,T;if(o>g){m-S<=c&&(S=0);var b=new Q(0,n.height-v,n.width,x);T=this._getTiles(m-S,b,1,h),f+=T?T.tiles.length:0,x=b.ymin,S+=4*M,l.push(T)}var D;if(m-S>=c){var R=new Q(0,u.ymin,n.width,x);D=this._getTiles(m-S,R,2,h),f+=D?D.tiles.length:0,l.push(D)}return T&&D&&(l[1]=D,l[2]=T),{tileGrids:l,count:f}},i.getTileUrl=function(t,e,n){var o=this.options.urlTemplate,h="";if(this.options.subdomains){var u=this.options.subdomains;if(st(u)){var l=u.length,f=(t+e)%l;f<0&&(f=0),h=u[f]}}if(it(o))return o(t,e,n,h);var c={x:t,y:e,z:n,s:h};return this.options.token&&(c.token=this.options.token),this.options.customTags&&F(c,this.options.customTags),o.replace(Zg,function(d,g){var v=c[g];if(v===void 0)throw new Error("No value provided for variable "+d);return typeof v=="function"&&(v=v(c)),v})},i.clear=function(){return this._renderer&&this._renderer.clear(),this.tileInfoCache&&this.tileInfoCache.reset(),this.fire("clear"),this},i.toJSON=function(){var t={type:this.getJSONType(),id:this.getId(),options:this.config()};return t},i.getSpatialReference=function(){var t=this.getMap();if(t&&(!this.options.spatialReference||oe.equals(this.options.spatialReference,t.options.spatialReference)))return t.getSpatialReference();if(this._sr)return this._sr;var e=this.options.spatialReference;if(tt(e)&&(e=oe.getPreset(e),!e))throw new Error("Unsupported spatial reference: "+this.options.spatialReference+", possible values: "+oe.getAllPresets().join());return this._sr=new oe(e),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==t.getSpatialReference().toJSON().projection,this._sr},i.getMinZoom=function(){var t=this.options.minZoom||0,e=this.getSpatialReference();return e!==this.getMap().getSpatialReference()?Math.max(t,this._srMinZoom):t},i.getMaxZoom=function(){var t=this.getSpatialReference();return t!==this.getMap().getSpatialReference()?Math.min(s.prototype.getMaxZoom.call(this),this._srMaxZoom):s.prototype.getMaxZoom.call(this)},i._getTileZoom=function(t){if(!this._hasOwnSR){var e=this.getMap().getResolution(t),n=this.getSpatialReference().getResolution(t),o=Math.log(n/e)*Math.LOG2E;t+=o}var h=this.getMaxAvailableZoom();return!P(h)&&t>h&&(t=h),Ne(t)||(t=Math.round(t)),t=Math.max(0,t),t},i.getMaxAvailableZoom=function(){var t=this.getSpatialReference();return this.options.maxAvailableZoom||t&&t.getMaxZoom()},i._getTiles=function(t,e,n,o,h){var u=this.getMap(),l=t,f=u.projViewMatrix,c=u.getResolution(t)/u.getResolution(t-1)===.5;n<2&&(n===0&&c&&(l-=1),f=n===0?u.cascadeFrustumMatrix0:n===1?u.cascadeFrustumMatrix1:u.projViewMatrix);var d=l+this.options.zoomOffset,g=this._getTileOffset(l),v=g[0]||g[1],m={zoom:l,extent:null,offset:g,tiles:[]};if(d<0||!u||!this.isVisible()||!u.width||!u.height)return m;if(!h){var _=this.getMinZoom(),p=this.getMaxZoom();if(!P(_)&&l<_||!P(p)&&l>p)return m}var y=this._getTileConfig();if(!y)return m;var w={zoom:g},C=this.getSpatialReference(),x=C.getResolution(l),M;this._hasOwnSR?M=u.getGLScale(l):M=x/u.getGLRes();var S=!this._hasOwnSR&&this.options.repeatWorld,T=this._convertToExtent2d(e),b=this._getMask2DExtent();if(b){var D=b.intersection(T);if(!D)return m;e=D.convertTo(function(Ke){return u._pointToContainerPoint(Ke,void 0,0,Oi)})}var R=u._containerPointToPrj(e.getCenter(),Wg),k=u._prjToPoint(R,l,Lr),O;v?O=this._project(u._pointToPrj(k._add(g),l,Lr),Lr):O=this._project(R,Lr);var A=u.getGLScale()/u.getGLScale(l);Di.x=T.xmin*A,Di.y=T.ymax*A,be.x=T.xmax*A,be.y=T.ymin*A;for(var j=this._project(u._pointToPrj(Di._add(g),l,Di),Di),G=this._project(u._pointToPrj(be._add(g),l,be),be),N=y.getTileIndex(O,x,S),B=y.getTileIndex(j,x,S),Z=y.getTileIndex(G,x,S),U=Math.ceil(Math.abs(N.idy-B.idy)),J=Math.ceil(Math.abs(N.idx-B.idx)),ht=Math.ceil(Math.abs(N.idy-Z.idy)),Y=Math.ceil(Math.abs(N.idx-Z.idx)),X=(U+ht+1)*(J+Y+1),et=this.getTileSize(),ut=this.getRenderer()||o,Pt=this._getTileConfig().tileSystem.scale,K=[],dt=new Q,vt=new E(0,0),nt=-U;nt<=ht;nt++)for(var ct=-J,Tt=-1/0,Dt=!1;ct>=Tt&&ct<=Y;){var rt=y.getNeighorTileIndex(N.idx,N.idy,ct,nt,x,S);Tt===-1/0?ct++:ct--;var St=this._getTileId(rt.idx,rt.idy,l);if(!(rt.out||this._visitedTiles&&this._visitedTiles.has(St))){var Mt=ut&&ut.isTileCachedOrLoading(St);Mt&&(Mt=Mt.info);var kt=void 0;if(Mt){var Ye=Mt,xe=Ye.extent2d;vt.set(xe.xmin,xe.ymax),kt=vt}else if(!this._hasOwnSR)kt=y.getTilePointNW(rt.x,rt.y,x);else{var Ie=y.getTilePrjNW(rt.x,rt.y,x);kt=u._prjToPoint(this._unproject(Ie,be),l)}var se=void 0,Ce=void 0;if(!this._hasOwnSR)se=et.width,Ce=et.height;else{var Pe=void 0;if(!this._hasOwnSR)Pe=y.getTilePointSE(rt.x,rt.y,x);else{var Qe=y.getTilePrjSE(rt.x,rt.y,x);Pe=u._prjToPoint(this._unproject(Qe,be),l,be)}se=Math.ceil(Math.abs(Pe.x-kt.x)),Ce=Math.ceil(Math.abs(Pe.y-kt.y))}var ze=Pt.x*(rt.idx-rt.x)*se,je=Pt.y*(rt.idy-rt.y)*Ce;!Mt&&(ze||je)&&kt._add(ze,je);var fe=Mt&&Mt.extent2d||new Q(kt.x,kt.y-Ce,kt.x+se,kt.y);if(X<=4||Dt||this._isTileInExtent(f,fe,g,M)){var Gt=this._hasOwnSR?u._getResolution(l):x;this._visitedTiles&&n===0&&this._visitedTiles.add(St),c&&n===0?(this._splitTiles(f,K,ut,rt,l+1,Gt,fe,ze,je,w),dt._combine(fe)):(Mt?(Mt.offset[0]=g[0],Mt.offset[1]=g[1]):Mt=this.createTileNode(rt.x,rt.y,l,rt.idx,rt.idy,Gt,0,null,fe,St),K.push(Mt),dt._combine(fe)),Tt===-1/0?(Tt=ct,ct=Y):Dt||(Dt=!0)}}}if(K.length){var Te=u._containerPointToPoint(e.getCenter(),l,Oi)._add(g),_r=new E(0,0),Ws=new E(0,0);K.sort(function(Ke,pr){return _r.set((Ke.extent2d.xmin+Ke.extent2d.xmax)/2,(Ke.extent2d.ymin+Ke.extent2d.ymax)/2),Ws.set((pr.extent2d.xmin+pr.extent2d.xmax)/2,(pr.extent2d.ymin+pr.extent2d.ymax)/2),_r.distanceTo(Te)-Ws.distanceTo(Te)})}return{offset:g,zoom:t,extent:dt,tiles:K}},i._convertToExtent2d=function(t){var e=this,n=this.getMap();return t.convertTo(function(o){var h;if(o.y>0&&o.y<n.height){var u=(o.x===0?0:1)+o.y;e._coordCache[u]||(e._coordCache[u]=n._containerPointToPoint(o)),h=e._coordCache[u]}return h=n._containerPointToPoint(o,void 0,Oi),h})},i._splitTiles=function(t,e,n,o,h,u,l,f,c,d){var g=this._getTileConfig().tileSystem.scale.y,v=this.getMap().getGLScale(h),m=Vg.set(l.xmin*2,g<0?l.ymax*2:l.ymin*2),_=l.getWidth(),p=l.getHeight(),y=o.idx*2,w=o.idy*2,C=o.x*2,x=o.y*2,M=this._checkAndAddTile(t,n,y,w,C,x,h,u,0,0,_,p,m,v,d);M&&e.push(M),M=this._checkAndAddTile(t,n,y,w,C,x,h,u,0,1,_,p,m,v,d),M&&e.push(M),M=this._checkAndAddTile(t,n,y,w,C,x,h,u,1,0,_,p,m,v,d),M&&e.push(M),M=this._checkAndAddTile(t,n,y,w,C,x,h,u,1,1,_,p,m,v,d),M&&e.push(M)},i._checkAndAddTile=function(t,e,n,o,h,u,l,f,c,d,g,v,m,_,p){var y=this._getTileId(n+c,o+d,l);if(this._visitedTiles&&this._visitedTiles.has(y))return null;var w=p[l];w||(w=p[l]=this._getTileOffset(l));var C=this._getTileConfig().tileSystem.scale.y,x=new Q(m.x+c*g,m.y+C*d*v,m.x+(c+1)*g,m.y+C*(d+1)*v);if(!this._isSplittedTileInExtent(t,x,w,_))return null;var M=f/2,S=e&&e.isTileCachedOrLoading(y);return S?S=S.info:S=this.createTileNode(h+c,u+d,l,n+c,n+u,M,0,null,x,y),S},i._getTileOffset=function(){var t=this.options.offset;if(it(t)){for(var e,n=arguments.length,o=new Array(n),h=0;h<n;h++)o[h]=arguments[h];t=(e=t).call.apply(e,[this].concat(o))}return H(t)&&(t=[t,t]),t||[0,0]},i.getTileId=function(t,e,n,o){return this._getTileId(t,e,n,o)},i._getTileId=function(t,e,n,o){return(o||this.getId())+"_"+t+"_"+e+"_"+n},i._project=function(t,e){if(this._hasOwnSR){var n=this.getMap(),o=n.getProjection(),h=this.getSpatialReference().getProjection();return h.project(o.unproject(t,e),e)}else return t},i._unproject=function(t,e){if(this._hasOwnSR){var n=this.getMap(),o=this.getSpatialReference(),h=n.getProjection(),u=o.getProjection();return h.project(u.unproject(t,e),e)}else return t},i._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),n=this.getSpatialReference(),o=n.getProjection(),h=n.getFullExtent();this._defaultTileConfig=new fh(t,Oe.getDefault(o),h,e),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new fh(t,this.options.tileSystem,h,e)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},i._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},i._bindMap=function(t){var e=t.getBaseLayer();return e===this&&(e.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),this._onSpatialReferenceChange(),s.prototype._bindMap.apply(this,arguments)},i._isTileInExtent=function(t,e,n,o){var h=this.getMap(),u;if(t!==h.projViewMatrix){var l=e.getCenter(Ug)._sub(n[0],n[1])._multi(o);zt(ga,l.x,l.y,0);var f=Xd(ga,ga,h.projViewMatrix);u=f[1]<0?h.projViewMatrix:t}else u=h.projViewMatrix;return At[0][0]=(e.xmin-n[0])*o,At[0][1]=(e.ymin-n[1])*o,At[1][0]=(e.xmax-n[0])*o,At[1][1]=(e.ymax-n[1])*o,An(u,At)},i._isSplittedTileInExtent=function(t,e,n,o){var h=this.getMap();return At[0][0]=(e.xmin-n[0])*o,At[0][1]=(e.ymin-n[1])*o,At[1][0]=(e.xmax-n[0])*o,At[1][1]=(e.ymax-n[1])*o,An(h.projViewMatrix,At)},i.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},i._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR,delete this._rootNodes,this.tileInfoCache&&this.tileInfoCache.reset();var t=this.getRenderer();t&&t.clear()},i.getPolygonOffsetCount=function(){return 2},i.getPolygonOffset=function(){return this._polygonOffset||0},i.setPolygonOffset=function(t){return this._polygonOffset=t,this},a}(It);te.registerJSONType("TileLayer");te.mergeOptions(Bg);function Jg(s,a,i){var r=Math.max(s[0]-i[0],0,i[0]-a[0]),t=Math.max(s[1]-i[1],0,i[1]-a[1]),e=Math.max(s[2]-i[2],0,i[2]-a[2]);return Math.sqrt(r*r+t*t+e*e)}function Xg(s,a){return s.z-a.z}var qg={maxCacheSize:1024},$g=new xt(256,256),ui="show hide remove setzindex forcereloadstart";function dh(s){return Array.isArray(s)||(s=[s]),s}var _l=function(s){z(a,s),a.fromJSON=function(t){if(!t||t.type!=="GroupTileLayer")return null;var e=t.layers.map(function(n){return It.fromJSON(n)});return new a(t.id,e,t.options)};function a(r,t,e){var n;return n=s.call(this,r,e)||this,n.layers=t||[],n._checkChildren(),n.layerMap={},n._groupChildren=[],n}var i=a.prototype;return i.getLayers=function(){return this.layers},i.addLayer=function(t){var e=this;t===void 0&&(t=[]),t=dh(t);var n=this.layers.length;return t.forEach(function(o){o instanceof te&&e.layers.indexOf(o)===-1&&!e.layerMap[o.getId()]&&e.layers.push(o)}),n!==this.layers.length&&(this._sortLayers(),this._refresh(),this._renderLayers()),this},i.removeLayer=function(t){var e=this;t===void 0&&(t=[]),t=dh(t);var n=this.layers.length;return t.forEach(function(o){if(o instanceof te||(o=e.layerMap[o]),o instanceof te){var h=e.layers.indexOf(o);h>=0&&(e.layers.splice(h,1),o._doRemove(),o.off(ui,e._onLayerShowHide,e))}}),n!==this.layers.length&&(this._refresh(),this._renderLayers()),this},i.clearLayers=function(){var t=this;return this.layers.forEach(function(e){e._doRemove(),e.off(ui,t._onLayerShowHide,t)}),this.layers=[],this._refresh(),this._renderLayers(),this},i.toJSON=function(){var t={type:this.getJSONType(),id:this.getId(),layers:this.layers.map(function(e){return e.toJSON()}),options:this.config()};return t},i.getTileSize=function(t){var e=this.getLayer(t);return e?e.getTileSize():$g},i.getTiles=function(t,e){for(var n=this.layers,o=[],h=0,u=0,l=n.length;u<l;u++){var f=n[u];if(!(!f||!f.options.visible||!f.isVisible()||!f.getMap())){var c=f.getTiles(t,e||this);!c||c.count===0||(h+=c.count,ie(o,c.tileGrids))}}return{count:h,tileGrids:o}},i.onAdd=function(){this._sortLayers(),this._refresh(),s.prototype.onAdd.call(this)},i.onRemove=function(){var t=this;this.layers.forEach(function(e){e._doRemove(),e.off(ui,t._onLayerShowHide,t)}),this.layerMap={},this._groupChildren=[],s.prototype.onRemove.call(this)},i.getLayer=function(t){return this.getChildLayer(t)},i.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var n=0;n<this._groupChildren.length;n++){var o=this._groupChildren[n].getChildLayer(t);if(o)return o}return null},i._removeChildTileCache=function(t){if(!t)return this;var e=this.getRenderer();if(!e)return this;var n,o=t.getId(),h=function(){return n&&n.info&&n.info.layer===o};if(e.tileCache){var u=e.tileCache.keys();u.forEach(function(g){n=e.tileCache.get(g),h()&&e.tileCache.remove(g)})}var l=e.tilesInView||{};for(var f in l)n=l[f],h()&&delete l[f];var c=e.tilesLoading||{};for(var d in c)n=c[d],h()&&e.abortTileLoading(n.image,n.info);return this},i._onLayerShowHide=function(t){var e=t||{},n=e.type,o=e.target;return n==="remove"&&o?(this.layers.splice(this.layers.indexOf(o),1),o._doRemove(),o.off(ui,this._onLayerShowHide,this),this._refresh()):n==="setzindex"?this._sortLayers():n==="forcereloadstart"&&this._removeChildTileCache(o),this._renderLayers(),this},i._renderLayers=function(){var t=this.getRenderer();return t&&t.setToRedraw(),this},i._refresh=function(){var t=this,e=this.getMap();return this._groupChildren=[],this.layerMap={},this.layers.forEach(function(n){t.layerMap[n.getId()]=n,n.getChildLayer&&t._groupChildren.push(n),n.getMap()||n._bindMap(e),n.off(ui,t._onLayerShowHide,t),n.on(ui,t._onLayerShowHide,t)}),this},i.isVisible=function(){if(!s.prototype.isVisible.call(this))return!1;for(var t=this.layers,e=0,n=t.length;e<n;e++)if(t[e].isVisible())return!0;return!1},i._checkChildren=function(){var t=this,e={};this.layers.forEach(function(n){var o=n.getId();if(e[o])throw new Error("Duplicate child layer id ("+o+") in the GroupTileLayer ("+t.getId()+")");e[o]=1})},i._sortLayers=function(){this.layers.sort(function(t,e){return t.options.zIndex-e.options.zIndex})},a}(te);_l.registerJSONType("GroupTileLayer");_l.mergeOptions(qg);var pl={crs:null,uppercase:!1,detectRetina:!1},Yg={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},va,Is=function(s){z(a,s);function a(r,t){var e;return e=s.call(this,r)||this,va||(va=F({},e.options)),e.wmsParams=F({},Yg),e.setOptions(t),e.setZIndex(t.zIndex),q.proxy||e._optionsHook(t),e}var i=a.prototype;return i._optionsHook=function(t){t===void 0&&(t={});for(var e in t)e==="tileSize"&&(this._tileSize=null),e in va||(this.wmsParams[e]=t[e]);var n=this.getTileSize();return this.wmsParams.width=n.width,this.wmsParams.height=n.height,this._wmsVersion=parseFloat(this.wmsParams.version),this},i.onAdd=function(){var t=this.getMap().getDevicePixelRatio(),e=pl.detectRetina?t:1;this.wmsParams.width*=e,this.wmsParams.height*=e;var n=this.options.crs||this.getMap().getProjection().code,o=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[o]=n,s.prototype.onAdd.call(this)},i.getTileUrl=function(t,e,n){var o=this.getSpatialReference().getResolution(n),h=this._getTileConfig(),u=h.getTilePrjExtent(t,e,o),l=u.getMax(),f=u.getMin(),c=(this._wmsVersion>=1.3&&(this.wmsParams.crs==="EPSG:4326"||this.wmsParams.crs==="EPSG:4490")?[f.y,f.x,l.y,l.x]:[f.x,f.y,l.x,l.y]).join(","),d=s.prototype.getTileUrl.call(this,t,e,n);return d+Qg(this.wmsParams,d,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+c},i.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},a.fromJSON=function(t){return!t||t.type!=="WMSTileLayer"?null:new a(t.id,t.options)},a}(te);Is.registerJSONType("WMSTileLayer");Is.mergeOptions(pl);function Qg(s,a,i){var r=[];for(var t in s)r.push(encodeURIComponent(i?t.toUpperCase():t)+"="+encodeURIComponent(s[t]));return(!a||a.indexOf("?")===-1?"?":"&")+r.join("&")}var zs=function(s){z(a,s);function a(r,t){var e;return e=s.call(this,r,t)||this,e.options.hasOwnProperty("forceRenderOnMoving")||(e.options.forceRenderOnMoving=!1),e}var i=a.prototype;return i.drawTile=function(){},i.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},a.fromJSON=function(t){return!t||t.type!=="CanvasTileLayer"?null:new a(t.id,t.options)},a}(te);zs.registerJSONType("CanvasTileLayer");function Kg(s,a){for(var i={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},r=["webgl","experimental-webgl"],t=null,e=0;e<r.length;++e){try{t=s.getContext(r[e],a||i)}catch{}if(t)break}return t}function gh(s,a,i){var r=s.createShader(a);s.shaderSource(r,i),s.compileShader(r);var t=s.getShaderParameter(r,s.COMPILE_STATUS);if(!t){var e=s.getShaderInfoLog(r);throw s.deleteShader(r),new Error("Failed to compile shader: "+e)}return r}function yl(s,a,i){var r=gh(s,s.VERTEX_SHADER,a),t=gh(s,s.FRAGMENT_SHADER,i);if(!r||!t)return null;var e=s.createProgram();return e?(s.attachShader(e,r),s.attachShader(e,t),s.linkProgram(e),{program:e,vertexShader:r,fragmentShader:t}):null}function wl(s,a,i){if(Array.isArray(i[0])){for(var r=Float32Array.BYTES_PER_ELEMENT,t=0,e=0;e<i.length;e++)t+=i[e][1]||0;for(var n=0,o=0;o<i.length;o++){var h=s.getAttribLocation(a,i[o][0]);if(h<0)throw new Error("Failed to get the storage location of "+i[o][0]);s.vertexAttribPointer(h,i[o][1],s[i[o][2]||"FLOAT"],!1,r*t,r*n),n+=i[o][1]||0,s.enableVertexAttribArray(h)}}else{var u=s.getAttribLocation(a,i[0]);s.vertexAttribPointer(u,i[1],s[i[2]||"FLOAT"],!1,0,0),s.enableVertexAttribArray(u)}}var tv={never:512,"<":513,"=":514,"<=":515,">":516,"!=":517,">=":518,always:519};function ev(s){return tv[s]}var vh=[1,1,1,1],mh={vertexShader:`
        attribute vec2 a_position;

        attribute vec2 a_texCoord;

        uniform mat4 u_matrix;

        varying vec2 v_texCoord;

        void main() {
            gl_Position = u_matrix * vec4(a_position, 0., 1.);

            v_texCoord = a_texCoord;
        }
    `,fragmentShader:`
        precision mediump float;

        uniform sampler2D u_image;

        uniform float u_opacity;
        uniform float u_debug_line;
        uniform vec4 u_base_color;
        uniform float u_alpha_test;
        varying vec2 v_texCoord;

        void main() {
            if (u_debug_line == 1.) {
                gl_FragColor = vec4(0., 1., 0., 1.);
            } else {
                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
            }
            gl_FragColor *= u_base_color;
            if (gl_FragColor.a < u_alpha_test) {
                discard;
            }
        }
    `},Ee=[0,0],ki=[0,0,0],iv=new Array(16),rv=new E(20,20),js=function(a){var i=function(r){z(t,r);function t(){return r.apply(this,arguments)||this}var e=t.prototype;return e.drawGLImage=function(o,h,u,l,f,c,d,g,v){this.gl.program!==this.program&&this.useProgram(this.program);var m=this.gl;this.loadTexture(o);var _=this.canvas.gl&&this.canvas.gl.wrap;if(_){var p=this.layer&&this.layer.options.opacity;P(p)&&(p=1),d*=p}ki[0]=h||0,ki[1]=u||0,ki[2]=0;var y=this.layer;if(y){var w=y.options.altitude,C=H(w);if(C||(this._layerAlt=0),this._layerAltitude!==w&&C){var x=y.getMap();if(x){var M=x.altitudeToPoint(w,x.getGLRes());this._layerAltitude=w,this._layerAlt=M}}}ki[2]=this._layerAlt||0;var S=Ms(iv);nl(S,S,ki),ja(S,S,[c,c,1]),Wi(S,this.getMap().projViewMatrix,S),m.uniformMatrix4fv(this.program.u_matrix,!1,S),m.uniform1f(this.program.u_opacity,d),m.uniform1f(this.program.u_debug_line,0),m.uniform4fv(this.program.u_base_color,v||vh),m.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0);var T=o.glBuffer;T&&(T.width!==l||T.height!==f)&&(this.saveImageBuffer(T),delete o.glBuffer),o.glBuffer?m.bindBuffer(m.ARRAY_BUFFER,T):o.glBuffer=this.bufferTileData(0,0,l,f),Ee[0]="a_position",Ee[1]=2,Ee[2]=o.glBuffer.type,this.enableVertexAttrib(Ee),m.bindBuffer(m.ARRAY_BUFFER,this.texBuffer),Ee[0]="a_texCoord",Ee[1]=2,Ee[2]="UNSIGNED_BYTE",this.enableVertexAttrib(Ee),m.drawArrays(m.TRIANGLE_STRIP,0,4),g&&this.drawDebug(S,0,0,l,f,g)},e.drawDebug=function(o,h,u,l,f,c){var d=this.gl;d.disable(d.DEPTH_TEST),d.bindBuffer(d.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),d.bufferData(d.ARRAY_BUFFER,new Float32Array([h,u,h+l,u,h+l,u-f,h,u-f,h,u]),d.DYNAMIC_DRAW),d.uniformMatrix4fv(this.program.u_matrix,!1,o),d.uniform1f(this.program.u_opacity,1),d.uniform1f(this.program.u_debug_line,1),d.uniform4fv(this.program.u_base_color,vh),d.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0),d.drawArrays(d.LINE_STRIP,0,5);var g=this._debugInfoCanvas;if(!g){var v=this.getMap().getDevicePixelRatio()>1?2:1;g=this._debugInfoCanvas=document.createElement("canvas"),g.width=256*v,g.height=32*v;var m=g.getContext("2d");m.font="20px monospace",m.scale(v,v)}var _=g.getContext("2d");_.clearRect(0,0,g.width,g.height);var p=this.layer.options.debugOutline;I.fillText(_,c,rv,p),this.loadTexture(g),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,g),l=256;var y=h,w=h+l,C=u-f+32,x=u-f;d.bufferData(d.ARRAY_BUFFER,this.set8(y,C,y,x,w,C,w,x),d.DYNAMIC_DRAW),d.uniform1f(this.program.u_debug_line,0),d.bindBuffer(d.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.enable(d.DEPTH_TEST)},e.bufferTileData=function(o,h,u,l,f){var c=o,d=o+u,g=h,v=h-l,m;Ne(c)&&Ne(d)&&Ne(g)&&Ne(v)?m=this.set8Int(c,g,c,v,d,g,d,v):m=this.set8(c,g,c,v,d,g,d,v);var _=this.loadImageBuffer(m,f);return _.width=u,_.height=l,_.type=m instanceof Int16Array?"SHORT":"FLOAT",_},e.drawTinImage=function(o,h,u,l,f){var c=this.gl;this.loadTexture(o),c.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),c.uniform1f(this.program.u_opacity,f),c.bindBuffer(c.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),c.bufferData(c.ARRAY_BUFFER,new Float32Array(h),c.DYNAMIC_DRAW),c.bindBuffer(c.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),c.bufferData(c.ARRAY_BUFFER,new Float32Array(u),c.DYNAMIC_DRAW),c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),c.DYNAMIC_DRAW),c.drawElements(c.TRIANGLES,l.length,c.UNSIGNED_SHORT,0)},e.createCanvas2=function(){this.canvas2=I.createCanvas(this.canvas.width,this.canvas.height)},e.createGLContext=function(){this.canvas.gl&&this.canvas.gl.wrap?this.gl=this.canvas.gl.wrap():this.gl=Kg(this.canvas2||this.canvas,this.layer.options.glOptions);var o=this.gl;o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.enable(o.STENCIL_TEST),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(mh.vertexShader,this.layer.options.fragmentShader||mh.fragmentShader),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),o.bufferData(o.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),o.STATIC_DRAW),this.enableSampler("u_image"),o.activeTexture(o.TEXTURE0),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},e.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width!==this.canvas.width||this.canvas2.height!==this.canvas.height)&&(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height)},e.clearGLCanvas=function(){this.gl&&(this.gl.clearStencil(255),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)),this.gl.wrap||this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},e.disposeImage=function(o){o&&(o.texture&&this.saveTexture(o.texture),o.glBuffer&&this.saveImageBuffer(o.glBuffer),delete o.texture,delete o.glBuffer)},e._createTexture=function(o){var h=this.gl,u=this.getTexture()||h.createTexture();h.bindTexture(h.TEXTURE_2D,u),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);var l=this.layer.options.mipmapTexture;return l&&(!ci(o.width)||!ci(o.height))&&(o=nv(o)),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,o),l&&h.generateMipmap(h.TEXTURE_2D),u},e.getTexture=function(){this._textures||(this._textures=[]);var o=this._textures;return o&&o.length>0?o.pop():null},e.saveTexture=function(o){this._textures.push(o)},e.loadTexture=function(o){var h=this.getMap(),u=this.gl,l=o.texture;l||(l=this._createTexture(o),o.texture=l),u.bindTexture(u.TEXTURE_2D,l);var f=this.layer.options.mipmapTexture;return f&&(h.isMoving()&&h.getRenderer().isViewChanged()?u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_LINEAR):u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR)),l},e.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var o=this._imageBuffers;return o&&o.length>0?o.pop():null},e.saveImageBuffer=function(o){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(o)},e.loadImageBuffer=function(o,h){var u=this.gl,l=h||this.createImageBuffer();return u.bindBuffer(u.ARRAY_BUFFER,l),u.bufferData(u.ARRAY_BUFFER,o,u.STATIC_DRAW),l},e.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},e.removeGLCanvas=function(){var o=this.gl;if(o){if(this._debugBuffer&&(o.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach(function(l){o.deleteBuffer(l)}),delete this._buffers),this._textures&&(this._textures.forEach(function(l){return o.deleteTexture(l)}),delete this._textures),this._debugInfoCanvas){var h=this._debugInfoCanvas.texture;h&&o.deleteTexture(h),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var u=o.program;o.deleteShader(u.fragmentShader),o.deleteShader(u.vertexShader),o.deleteProgram(u),delete this.gl,delete this.canvas2}},e.createBuffer=function(){var o=this.gl,h=o.createBuffer();if(!h)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(h),h},e.enableVertexAttrib=function(o){wl(this.gl,this.gl.program,o)},e.createProgram=function(o,h){for(var u=this.gl,l=yl(u,o,h),f=l.program,c=l.vertexShader,d=l.fragmentShader,g=u.getProgramParameter(f,35718),v=[],m=0;m<g;++m){var _=u.getActiveUniform(f,m);v.push(_.name)}return f.vertexShader=c,f.fragmentShader=d,this._initUniforms(f,v),f},e.useProgram=function(o){var h=this.gl;return h.useProgram(o),h.program=o,this},e.enableSampler=function(o,h){var u=this.gl,l=this._getUniform(u.program,o);return h||(h=0),u.uniform1i(l,h),l},e._initUniforms=function(o,h){for(var u=0;u<h.length;u++){var l=h[u],f=h[u],c=l.indexOf("[");c>=0&&(l=l.substring(0,c),bt||(f=f.substring(0,c))),o[l]=this._getUniform(o,f)}},e._getUniform=function(o,h){var u=this.gl,l=u.getUniformLocation(o,h);if(!l)throw new Error("Failed to get the storage location of "+h);return l},t}(a);return F(i.prototype,{set8:function(){var r=q.ie9?null:new Float32Array(8);return function(t,e,n,o,h,u,l,f){return r[0]=t,r[1]=e,r[2]=n,r[3]=o,r[4]=h,r[5]=u,r[6]=l,r[7]=f,r}}(),set8Int:function(){var r=q.ie9?null:new Int16Array(8);return function(t,e,n,o,h,u,l,f){return r[0]=t,r[1]=e,r[2]=n,r[3]=o,r[4]=h,r[5]=u,r[6]=l,r[7]=f,r}}()}),i};function nv(s){if(ci(s.width)&&ci(s.height))return s;var a=s.width,i=s.height;ci(a)||(a=_h(a)),ci(i)||(i=_h(i));var r=document.createElement("canvas");r.width=a,r.height=i;var t=r.getContext("2d");return t.imageSmoothingEnabled=!1,t.drawImage(s,0,0,a,i),r}function ci(s){return(s&s-1)===0&&s!==0}function _h(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}var av={renderer:q.webgl?"gl":"canvas",crossOrigin:null,alphaTest:0,depthMask:!0,depthFunc:"<="},sv=new E(0,0),Gs=function(s){z(a,s);function a(r,t,e){var n;return t&&!Array.isArray(t)&&!t.url&&(e=t,t=null),n=s.call(this,r,e)||this,n._images=t,n}var i=a.prototype;return i.onAdd=function(){this._prepareImages(this._images)},i.setImages=function(t){return this._images=t,this._prepareImages(t),this},i.getImages=function(){return this._images},i._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]);var e=this.getMap(),n=e.getGLRes();this._imageData=t.map(function(h){var u=new ft(h.extent);return F({},h,{extent:u,extent2d:u.convertTo(function(l){return e.coordToPointAtRes(l,n)})})}),this._images=t;var o=this.getRenderer();o&&o.refreshImages()},a}(It);Gs.mergeOptions(av);var ov=[],Fs=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.isDrawable=function(){return this.getMap().getPitch()?(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1):!0},i.checkResources=function(){var t=this;if(this._imageLoaded)return ov;var e=this.layer,n=e._imageData.map(function(u){return[u.url,null,null]});if(this.resources){var o=[],h=new Xe;n.forEach(function(u){if(t.resources.isResourceLoaded(u)){var l=t.resources.getImage(u);h.addResource(u,l)}else o.push(u)}),this.resources.forEach(function(u,l){h.isResourceLoaded(u)||t.retireImage(l.image)}),this.resources=h,n=o}return this._imageLoaded=!0,n},i.retireImage=function(t){t.close&&t.close()},i.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},i.draw=function(t,e){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(t,e),this.completeRender())},i._drawImages=function(){var t=this.layer._imageData,e=this.getMap(),n=e._get2DExtentAtRes(e.getGLRes());if(t&&t.length)for(var o=0;o<t.length;o++){var h=t[o].extent2d,u=this.resources&&this.resources.getImage(t[o].url);u&&n.intersects(h)&&(this._painted=!0,this._drawImage(u,h,t[o].opacity||1))}},i._drawImage=function(t,e,n){var o=0,h=this.context;n<1&&(o=h.globalAlpha,h.globalAlpha=n);var u=this.getMap(),l=sv.set(e.xmin,e.ymax),f=u._pointAtResToContainerPoint(l,u.getGLRes()),c=f.x,d=f.y,g=u.getBearing();g&&(h.save(),h.translate(c,d),g&&h.rotate(-g*Math.PI/180),c=d=0);var v=u.getGLScale();h.drawImage(t,c,d,e.getWidth()/v,e.getHeight()/v),g&&h.restore(),o&&(h.globalAlpha=o)},i.drawOnInteracting=function(){this.draw()},a}(Ci),xl=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.drawOnInteracting=function(t,e,n){this.draw(e,n)},i._prepareGLContext=function(){var t=this.gl;if(t){t.disable(t.STENCIL_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.depthFunc(ev(this.layer.options.depthFunc));var e=!!this.layer.options.depthMask;t.depthMask(e)}},i._drawImages=function(t,e){var n=this.gl;if(e&&e.renderTarget){var o=e.renderTarget.fbo;if(o){var h=e.renderTarget.getFramebuffer(o);n.bindFramebuffer(n.FRAMEBUFFER,h)}}if(this._prepareGLContext(),s.prototype._drawImages.call(this),e&&e.renderTarget){var u=e.renderTarget.fbo;u&&n.bindFramebuffer(n.FRAMEBUFFER,null)}},i.isDrawable=function(){return!0},i._drawImage=function(t,e,n){this.drawGLImage(t,e.xmin,e.ymax,e.getWidth(),e.getHeight(),1,n)},i.createContext=function(){this.createGLContext()},i.resizeCanvas=function(t){this.canvas&&(s.prototype.resizeCanvas.call(this,t),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(s.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.retireImage=function(t){t.close&&t.close(),this.disposeImage(t)},i.onRemove=function(){this.removeGLCanvas(),s.prototype.onRemove.call(this)},a}(js(Fs));Gs.registerRenderer("canvas",Fs);Gs.registerRenderer("gl",xl);var Hs=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.getPrepareParams=function(){return[]},i.getDrawParams=function(){return[]},i.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=I.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},i.needToRedraw=function(){if(this.layer.options.animation)return!0;var t=this.getMap();return t.isInteracting()&&!this.layer.drawOnInteracting?!1:s.prototype.needToRedraw.call(this)},i.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer.apply(this,arguments)},i.drawOnInteracting=function(){this._drawLayerOnInteracting.apply(this,arguments)},i.getCanvasImage=function(){var t=s.prototype.getCanvasImage.call(this);if(t&&t.image&&this.layer.options.doubleBuffer){var e=t.image;(this.buffer.width!==e.width||this.buffer.height!==e.height)&&(this.buffer.width=e.width,this.buffer.height=e.height);var n=this.buffer.getContext("2d"),o=this.layer.doubleBuffer(n,this.context);(o===void 0||o)&&(I.image(n,e,0,0),t.image=this.buffer)}return t},i.remove=function(){return delete this._drawContext,s.prototype.remove.call(this)},i.onZoomStart=function(t){this.layer.onZoomStart(t),s.prototype.onZoomStart.call(this,t)},i.onZooming=function(t){this.layer.onZooming(t),s.prototype.onZooming.call(this,t)},i.onZoomEnd=function(t){this.layer.onZoomEnd(t),s.prototype.onZoomEnd.call(this,t)},i.onMoveStart=function(t){this.layer.onMoveStart(t),s.prototype.onMoveStart.call(this,t)},i.onMoving=function(t){this.layer.onMoving(t),s.prototype.onMoving.call(this,t)},i.onMoveEnd=function(t){this.layer.onMoveEnd(t),s.prototype.onMoveEnd.call(this,t)},i.onResize=function(t){this.layer.onResize(t),s.prototype.onResize.call(this,t)},i.prepareDrawContext=function(){if(!this._predrawed){var t=ph(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(t)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},i._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();if(t.maskExtent&&!t.extent.intersects(t.maskExtent))return this.completeRender(),null;var e=[this.context,t],n=ph(this.getDrawParams());return e.push.apply(e,n),e.push.apply(e,this._drawContext),e},i._drawLayer=function(){var t=this._prepareDrawParams();if(t){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];this.layer.draw.apply(this.layer,t.concat(n)),this.completeRender()}},i._drawLayerOnInteracting=function(){if(this.layer.drawOnInteracting){var t=this._prepareDrawParams();if(t){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];this.layer.drawOnInteracting.apply(this.layer,t.concat(n)),this.completeRender()}}},a}(Ci);function ph(s){return s||(s=[]),Array.isArray(s)||(s=[s]),s}var hv={doubleBuffer:!1,animation:!1},Ns=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.isCanvasRender=function(){return!0},i.prepareToDraw=function(){},i.draw=function(){},i.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},i.play=function(){return this.config("animation",!0),this},i.pause=function(){return this.config("animation",!1),this},i.isPlaying=function(){return this.options.animation},i.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},i.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},i.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},i.onCanvasCreate=function(){return this},i.onZoomStart=function(){},i.onZooming=function(){},i.onZoomEnd=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){},i.onResize=function(){},i.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},a}(It);Ns.mergeOptions(hv);Ns.registerRenderer("canvas",Hs);var uv=new E(0,0),lv={animation:!0},Cl=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.getParticles=function(){},i.draw=function(t,e){var n=this.getParticles(at());if(!n||n.length===0){var o=this._getRenderer();o&&(this._getRenderer()._shouldClear=!0);return}var h=this.getMap(),u=e.extent;e.maskExtent&&(u=e.extent.intersection(e.maskExtent)),u=u.convertTo(function(m){return h._pointToContainerPoint(m,void 0,0,uv)});for(var l=2*Math.PI,f=0,c=n.length;f<c;f++){var d=n[f].point;if(u.contains(d)){var g=n[f].color||this.options.lineColor||"#fff",v=n[f].r;t.fillStyle!==g&&(t.fillStyle=g),v<=2?t.fillRect(d.x-v/2,d.y-v/2,v,v):(t.beginPath(),t.arc(d.x,d.y,v/2,0,l),t.fill())}}this._fillCanvas(t)},i._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out";var n=this.options.trail||30;t.fillStyle="rgba(0, 0, 0, "+1/n+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},a}(Ns);Cl.mergeOptions(lv);Cl.registerRenderer("canvas",function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.draw=function(){(!this.canvas||!this.layer.options.animation||this._shouldClear)&&(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},i.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},i.onSkipDrawOnInteracting=function(){this._shouldClear=!0},a}(Hs));var Li=new Xe,Ii,zi,fv=function(s){z(a,s);function a(r,t,e){var n;n=s.call(this,e)||this,n.target=r,r.once("remove",n.delete,mt(mt(n)));var o=n.options.symbol,h=o.markerLineWidth||1;return n.w=o.markerWidth+h,n.h=o.markerHeight+h,n.opacity=P(o.opacity)?1:o.opacity,n.map=t,n.events=e.events,n._fetchImage(),n.addTo(t),n}var i=a.prototype;return i.getCursor=function(){return this.options.cursor||"default"},i._fetchImage=function(){var t=this.map,e=this.options.symbol,n=e.markerFile;this.url=n||lr(e);var o=Li.getImage(this.url);if(!o){var h=this.w,u=this.h;if(n)o=new Image,o.onload=function(){var c=t.getRenderer();c&&c.setToRedraw()},o.src=this.url;else{var l=document.createElement("canvas");l.width=h,l.height=u;var f=l.getContext("2d");o=Lu(f,{x:h/2,y:u/2},e,Li)}Li.addResource([this.url,h,u],o)}Li.login(this.url),this._img=o},i.setContainerPoint=function(t){this._point=t,this._point._sub(this.w/2,this.h/2)},i.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},i.offset=function(t){this._point._add(t)},i.render=function(t){if(!this._img)return!1;var e=this.options.symbol,n=e.markerDx||0,o=e.markerDy||0,h=this.map,u=this._point,l=u.x,f=u.y,c=this.w,d=this.h;if(l+c>0&&l<h.width&&f+d>0&&f<h.height){var g=h.getDevicePixelRatio();return t.globalAlpha=this.opacity,t.drawImage(this._img,Math.round((l+n)*g),Math.round((f+o)*g),Math.round(c*g),Math.round(d*g)),!0}return!1},i.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}Li.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},i.hitTest=function(t){var e=this.options.symbol,n=e.markerDx||0,o=e.markerDy||0,h=this.w,u=this.h,l=this._point.x+n,f=this._point.y+o;return t.x>=l&&t.x<=l+h&&t.y>=f&&t.y<=f+u},i.addTo=function(t){this.map=t;var e=t.getRenderer();e.addTopElement(this)},i.onEvent=function(t){this.fire(t.type,t)},i.mousedown=function(t){var e=t.target,n=this.options.cursor;n&&e.setCursor(n),this.onDragstart(t)},i.onDragstart=function(t){var e=t.containerPoint,n=t.target,o=n._panels.mapWrapper||n._containerDOM,h=this._dragger=new gr(o);h.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),h.type="handle",h.onMouseDown(t.domEvent),Ii=e.x,zi=e.y,this.fire("dragstart",{containerPoint:e})},i.onDragging=function(t){if(this._dragger){var e=this.map,n=Ht(t.domEvent,e._containerDOM),o={x:n.x-Ii,y:n.y-zi},h=e.containerPointToCoord(new E(Ii,zi)),u=e.containerPointToCoord(n);Ii=n.x,zi=n.y,this.offset(o),this.fire("dragging",{containerPoint:n,coordOffset:u._sub(h)})}},i.onDragend=function(t){if(this._dragger){var e=this.map;e.resetCursor();var n=Ht(t.domEvent,e._containerDOM),o={x:n.x-Ii,y:n.y-zi};this.offset(o),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:n})}},i.needCollision=function(){var t=this.target;return t&&t.options&&t.options.collision},i.getRenderBBOX=function(t){var e=this.target,n=this.map;if(!e||!e.options||!n)return null;var o=this.options.symbol,h=o.markerDx||0,u=o.markerDy||0,l=this._point,f=l.x,c=l.y,d=this.w,g=this.h;t=t||n.getDevicePixelRatio(),this.bbox=this.bbox||qe();var v=Math.round((f+h)*t),m=Math.round((c+u)*t),_=Math.round(d*t),p=Math.round(g*t);this.bbox[0]=v,this.bbox[1]=m,this.bbox[2]=v+_,this.bbox[3]=m+p;var y=e.options,w=y.collisionBufferSize||0;return yu(this.bbox,w),this.bbox},a}(le(Bt)),cv=function(){function s(i,r){this.target=i,i.once("remove",this.delete,this),this.map=r,this.addTo(r)}var a=s.prototype;return a.setPoints=function(r){this.points=r;var t=r.map(function(n){return n.x}),e=r.map(function(n){return n.y});this.xmin=Math.min.apply(Math,t),this.xmax=Math.max.apply(Math,t),this.ymin=Math.min.apply(Math,e),this.ymax=Math.max.apply(Math,e)},a.hitTest=function(){return!1},a.render=function(r){var t=this.map;if(this.xmax<=0||this.xmin>=t.width||this.ymax<=0||this.ymin>=t.height)return;var e=t.getDevicePixelRatio(),n=.5;function o(l){return Math.round(l)*e+n}r.lineWidth=1,r.strokeStyle="#000",r.globalAlpha=1,r.beginPath();var h=this.points;r.moveTo(o(h[0].x),o(h[0].y));for(var u=1;u<this.points.length;u++)r.lineTo(o(h[u].x),o(h[u].y));r.closePath(),r.stroke()},a.addTo=function(r){this.map=r;var t=r.getRenderer();t.addTopElement(this)},a.delete=function(){if(this.map){var r=this.map.getRenderer();r&&r.removeTopElement(this)}},s}(),dv=or+"_edit_stage_";function ma(s,a){return{markerType:s,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:a}}var gv={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:ma("ellipse",1),vertexHandleSymbol:ma("square",1),newVertexHandleSymbol:ma("square",.4),collision:!1,collisionBufferSize:0},Pl=function(s){z(a,s);function a(r,t){var e;return e=s.call(this,t)||this,e._geometry=r,e._geometry?e:mt(e)}var i=a.prototype;return i.getMap=function(){return this._geometry.getMap()},i.prepare=function(){var t=this.getMap();t&&(t.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},i._prepareEditStageLayer=function(){var t=this._geometry.getLayer();if(t.options.renderer==="canvas"){var e=this.getMap(),n=we(),o=dv+n+"_shadow";if(this._shadowLayer=e.getLayer(o),!this._shadowLayer){var h=t.constructor;this._shadowLayer=new h(o),e.addLayer(this._shadowLayer)}}},i.start=function(){if(!(!this._geometry||!this._geometry.getMap()||this._geometry.editing)){this.editing=!0,this.prepare();var t=this._geometry,e,n=this._geometry.getLayer(),o=n.options.renderer==="canvas";this._geometryDraggble=t.options.draggable,o?(t.config("draggable",!1),e=t.copy(),e.setSymbol(t._getInternalSymbol()),e.copyEventListeners(t),t._getParent()&&e.copyEventListeners(t._getParent()),e._setEventTarget(t),e.setId(null).config({draggable:!1}),this._shadow=e,t.hide()):t instanceof wt&&t.config("draggable",!0),this._switchGeometryEvents("on"),(t instanceof wt||t instanceof re||t instanceof _i||t instanceof pe)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(e),t instanceof wt?e&&(e.config("draggable",!0),e.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),t instanceof wt&&this.options.resize!==!1?this.createMarkerEditor():t instanceof re?this.createCircleEditor():t instanceof _i?this.createEllipseOrRectEditor():t instanceof pe?this.createEllipseOrRectEditor():t instanceof Pi||(t instanceof Ct||t instanceof yt)&&this.createPolygonEditor()}},i.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off");var t=this.getMap();if(!t){this.fire("remove");return}this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")},i.isEditing=function(){return P(this.editing)?!1:this.editing},i._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},i._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var n in e)this._geometry[t](n,e[n],this)}},i._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},i._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},i._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;e||(this._editOutline=new cv(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var n=this._editOutline.points;if(t instanceof wt)this._editOutline.setPoints(t.getContainerExtent().toArray(n));else{var o=this.getMap(),h=t._getPrjExtent();n=h.toArray(n),n.forEach(function(u){return o._prjToContainerPoint(u,null,u)}),this._editOutline.setPoints(n)}return e},i._createCenterHandle=function(){var t=this,e=this.getMap(),n=this.options.centerHandleSymbol,o,h=e.coordToContainerPoint(this._geometry.getCenter()),u=this.createHandle(h,{symbol:n,cursor:"move",onDown:function(){if(t._shadow){o=t._shadow.copy();var f=Xr(o._getInternalSymbol(),.5);o.setSymbol(f).addTo(t._geometry.getLayer())}},onMove:function(f){var c=f.coordOffset;o?o.translate(c):t._geometry.translate(c)},onUp:function(){if(o){var f=o.getFirstCoordinate(),c=t._geometry.getFirstCoordinate(),d=f.sub(c);t._update("translate",d),o.remove()}}});this._addRefreshHook(function(){var l=t._geometry.getCenter();u.setContainerPoint(e.coordToContainerPoint(l))})},i._createHandleInstance=function(t,e){var n=this.getMap(),o=hn(e.symbol,function(){return[n.getZoom(),{"{bearing}":n.getBearing(),"{pitch}":n.getPitch(),"{zoom}":n.getZoom()}]}),h=this.options.removeVertexOn,u=new fv(this,n,{symbol:o,cursor:e.cursor,events:h});return u.setContainerPoint(t),u},i.createHandle=function(t,e){e||(e={});var n=this._createHandleInstance(t,e),o=this;function h(f){return this._updating=!0,e.onDown&&(e.onDown.call(o,f.containerPoint,f),this._geometry.fire("handledragstart")),!1}function u(f){return o._hideContext(),e.onMove&&(e.onMove.call(o,f),this._geometry.fire("handledragging")),!1}function l(f){return e.onUp&&(e.onUp.call(o,f),this._geometry.fire("handledragend")),this._updating=!1,!1}return n.on("dragstart",h,this),n.on("dragging",u,this),n.on("dragend",l,this),e.onRefresh&&(n.refresh=e.onRefresh),n},i._createResizeHandles=function(t,e,n){var o=this,h=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],u=[null,"y",null,"x","x",null,"y",null],l=this._geometry,f=l instanceof wt;function c(){if(f){var y=l.getContainerExtent();return[new E(y.xmin,y.ymin),new E((y.xmax+y.xmin)/2,y.ymin),new E(y.xmax,y.ymin),new E(y.xmin,(y.ymin+y.ymax)/2),new E(y.xmax,(y.ymin+y.ymax)/2),new E(y.xmin,y.ymax),new E((y.xmax+y.xmin)/2,y.ymax),new E(y.xmax,y.ymax)]}var w=l._getPrjExtent();return[new E(w.xmin,w.ymax),new E((w.xmax+w.xmin)/2,w.ymax),new E(w.xmax,w.ymax),new E(w.xmin,(w.ymax+w.ymin)/2),new E(w.xmax,(w.ymax+w.ymin)/2),new E(w.xmin,w.ymin),new E((w.xmax+w.xmin)/2,w.ymin),new E(w.xmax,w.ymin)]}t||(t=[]);var d=this,g=[],v={},m=this.getMap(),_=this.options.vertexHandleSymbol,p=function(){for(var w=c(),C=function(T){if(Array.isArray(t)){var b=t.some(function(O){return O===T});if(b)return"continue"}var D=w[T],R=f?D:m._prjToContainerPoint(D);if(g.length<w.length-t.length){var k=o.createHandle(R,{symbol:_,cursor:h[T],axis:u[T],onMove:function(O){return function(A){d._updating=!0,e(A.containerPoint,O),l.fire("resizing")}}(T),onUp:function(){d._updating=!1,n()}});v[T]=g.length,g.push(k)}else g[v[T]].setContainerPoint(R)},x=0;x<w.length;x++)var M=C(x)};return p(),this._addRefreshHook(p),g},i.createMarkerEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();if(!e._canEdit()){console&&console.warn("A marker can't be resized with symbol:",e.getSymbol());return}this._history||this._recordHistory(_());var o=e._getInternalSymbol(),h=new E(0,0);H(o.markerDx)&&(h.x=o.markerDx),H(o.markerDy)&&(h.y=o.markerDy);var u=null,l="middle",f="middle";if(ys.test(o)){var c=o.markerType;c==="pin"||c==="pie"||c==="bar"?(u=[5,6,7],l="bottom"):c==="rectangle"&&(u=[0,1,2,3,5],l="top",f="left")}else(Cn.test(o)||ws.test(o))&&(l="bottom",u=[5,6,7]);var d=[2,1,2,0,0,2,1,2],g;if(this.options.fixAspectRatio){var v=e.getSize();g=v.width/v.height}var m=this._createResizeHandles(u,function(p,y){if(u&&u.indexOf(y)>=0){var w=n.containerPointToCoordinate(p.sub(h)),C=e.getCoordinates();w.x=C.x,e.setCoordinates(w),t._updateCoordFromShadow(!0);var x=m[m.length-1-y],M=x.getContainerPoint();p=M}var S=n.coordToContainerPoint(e.getCoordinates()).add(h),T=e._getInternalSymbol(),b=p.sub(S);l==="bottom"&&p.y>S.y&&(b.y=0);var D=l==="middle"?2:1,R=f==="left"?1:2,k=Math.abs(b.x)*R,O=Math.abs(b.y)*D;g&&(k=Math.max(k,O*g),O=k/g);var A=d[y];e instanceof rn?((g||A===0||A===2)&&(e.setWidth(k),e!==t._geometry&&t._geometry.setWidth(k)),(g||A===1||A===2)&&(e.setHeight(O),e!==t._geometry&&t._geometry.setHeight(O))):((g||A===0||A===2)&&(T.markerWidth=Math.min(k,t._geometry.options.maxMarkerWidth||1/0)),(g||A===1||A===2)&&(T.markerHeight=Math.min(O,t._geometry.options.maxMarkerHeight||1/0)),e.setSymbol(T),e!==t._geometry&&t._geometry.setSymbol(T))},function(){t._update(_())});function _(){var p=[["setCoordinates",e.getCoordinates().toArray()]];return e instanceof rn?(p.push(["setWidth",e.getWidth()]),p.push(["setHeight",e.getHeight()])):p.push(["setSymbol",e.getSymbol()]),p}},i.createCircleEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();this._history||this._recordHistory([["setCoordinates",e.getCoordinates().toArray()],["setRadius",e.getRadius()]]),this._createResizeHandles(null,function(o){var h=e.getCenter(),u=n.containerPointToCoord(o),l=new yt([[h.x,h.y],[u.x,h.y]]),f=new yt([[h.x,h.y],[h.x,u.y]]),c=Math.max(n.computeGeometryLength(l),n.computeGeometryLength(f));e.setRadius(c),e!==t._geometry&&t._geometry.setRadius(c)},function(){t._update("setRadius",e.getRadius())})},i.createEllipseOrRectEditor=function(){var t=this,e=[2,1,2,0,0,2,1,2],n=this._shadow||this._geometry;this._history||this._recordHistory(f());var o=this.getMap(),h=this._geometry instanceof _i,u;this.options.fixAspectRatio&&(u=n.getWidth()/n.getHeight());var l=this._createResizeHandles(null,function(c,d){var g=h?1:2,v,m,_,p=l[d],y=p.getContainerPoint(),w=e[d];if(h){var C=l[7-d],x=C.getContainerPoint();v=y.sub(x);var M=v.abs();m=o.pixelToDistance(M.x,0),_=o.pixelToDistance(0,M.y);var S=n.getSize(),T=n.getCoordinates(),b=n.getWidth(),D=n.getHeight(),R=o.containerPointToCoord(c),k=o.containerPointToCoord(x),O=new yt([[k.x,k.y],[R.x,k.y]]),A=new yt([[k.x,k.y],[k.x,R.y]]);if(m=o.computeGeometryLength(O),_=o.computeGeometryLength(A),w===0)if(u&&(M.y=M.x/u,S.height=Math.abs(M.y),_=m/u),y.y=x.y-S.height/2,R.y=T.y,d===4)R.x=Math.min(R.x,T.x);else{var j=o.locate(T,b,0);R.x=o.locate(new L(j.x,R.y),-m,0).x}else if(w===1)u&&(M.x=M.y*u,S.width=Math.abs(M.x),m=_*u),y.x=x.x-S.width/2,R.x=T.x,R.y=Math.max(R.y,k.y);else{if(u&&(m>_*u?(_=m/u,y.y=x.y+M.x*Ot(v.y)/u):(m=_*u,y.x=x.x+M.y*Ot(v.x)*u)),d===0||d===5){var G=d===0?o.locate(T,b,0):o.locate(T,b,-D);R.x=o.locate(new L(G.x,R.y),-m,0).x}else R.x=Math.min(R.x,k.x);R.y=Math.max(R.y,k.y)}n.setCoordinates(R),t._updateCoordFromShadow(!0)}else{var N=n.getCenter(),B=o.containerPointToCoord(y),Z=new yt([[N.x,N.y],[B.x,N.y]]),U=new yt([[N.x,N.y],[N.x,B.y]]);m=o.computeGeometryLength(Z),_=o.computeGeometryLength(U),u&&(m=Math.max(m,_*u),_=m/u)}(u||w===0||w===2)&&(n.setWidth(m*g),n!==t._geometry&&t._geometry.setWidth(m*g)),(u||w===1||w===2)&&(n.setHeight(_*g),n!==t._geometry&&t._geometry.setHeight(_*g))},function(){t._update(f())});function f(){return[["setCoordinates",n.getCoordinates().toArray()],["setWidth",n.getWidth()],["setHeight",n.getHeight()]]}},i.createPolygonEditor=function(){var t=this.getMap(),e=this._shadow||this._geometry,n=this;this._history||this._recordHistory("setCoordinates",L.toNumberArrays(e.getCoordinates()));var o=e instanceof Ct?3:2,h="maptalks--editor-vertex-index",u={0:[]},l={0:[]};function f(O){if(O===void 0&&(O=0),e instanceof Ct){var A=e.getCoordinates()[O]||[];return A.slice(0,A.length-1)}else return e.getCoordinates()}function c(O){return O===void 0&&(O=0),O===0?e._getPrjCoordinates():e._getPrjHoles()[O-1]}function d(){for(var O in u){for(var A=u[O].length-1;A>=0;A--)u[O][A][h]=A;for(var j=l[O].length-1;j>=0;j--)l[O][j][h]=j}n._updateCoordFromShadow()}function g(O){n._updating=!0;var A=O.target,j=A[h],G=H(A._ringIndex)?A._ringIndex:0,N=c(G);if(!(N.length<=o)){var B=e instanceof yt&&(j===0||j===N.length-1);N.splice(j,1),G>0?e._prjHoles[G-1]=N:e._setPrjCoordinates(N),e._updateCache(),u[G].splice(j,1)[0].delete(),j<l[G].length&&l[G].splice(j,1)[0].delete();var Z;if(j===0?Z=l[G].length-1:Z=j-1,l[G].splice(Z,1)[0].delete(),B||l[G].splice(Z,0,w.call(n,Z,G)),G>0){var U=e.getCoordinates(),J=U[G];J&&Array.isArray(J)&&J.length>1&&(J.splice(j,1),e!==this._geometry&&e.setCoordinates(U))}d(),n._updating=!1}}function v(O,A,j){j===void 0&&(j=0);var G=n._geometry.snapTo;G&&it(G)&&(O=n._geometry.snapTo(O)||O);var N=c(j),B=t._containerPointToPrj(O.sub(_())),Z=N[A];Z.x=B.x,Z.y=B.y,e._updateCache(),e.onShapeChanged(),n._updateCoordFromShadow(!0);var U;A===0?U=l[j].length-1:U=A-1,l[j][A]&&l[j][A].refresh(),l[j][U]&&l[j][U].refresh()}var m=new E(0,0);function _(){var O=e._getCompiledSymbol();return m.x=O.lineDx||0,m.y=O.lineDy||0,m}function p(O,A,j){A===void 0&&(A=0);var G=(j||f(A))[O],N=n.createHandle(t.coordToContainerPoint(G)._add(_()),{symbol:n.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){v(N.getContainerPoint(),N[h],A)},onRefresh:function(Z,U){G=(U||f(A))[N[h]];var J=t.coordToContainerPoint(G);N.setContainerPoint(J._add(_()))},onUp:function(){n._updateCoordFromShadow()},onDown:function(Z,U){U&&U.domEvent&&U.domEvent.button}});return N[h]=O,N._ringIndex=A,N.on(n.options.removeVertexOn,g),N}var y=!1;function w(O,A,j){A===void 0&&(A=0);var G=j||f(A),N;O+1>=G.length?N=G[0]:N=G[O+1];var B=G[O].add(N).multi(1/2),Z=n.createHandle(B,{symbol:n.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(J,ht){if(!(ht&&ht.domEvent&&ht.domEvent.button===2)){var Y=c(A),X=Z[h],et=Z.getContainerPoint(),ut=t._containerPointToPrj(et);Y.splice(X+1,0,ut),A>0?e._prjHoles[A-1]=Y:e._setPrjCoordinates(Y),e._updateCache(),Z.opacity=1,l[A].splice(X,0,w.call(n,X,A),w.call(n,X+1,A)),y=!0}},onMove:function(){v(Z.getContainerPoint(),Z[h]+1,A)},onUp:function(J){if(J&&J.domEvent&&J.domEvent.button===2){y=!1;return}var ht=Z[h];Hr(Z,l[A]),Z.delete(),u[A].splice(ht+1,0,p.call(n,ht+1,A)),d(),n._updateCoordFromShadow(),y=!1},onRefresh:function(J,ht){G=ht||f(J);var Y=Z[h],X;Y===G.length-1?X=0:X=Y+1;var et=G[Y].add(G[X]).multi(1/2),ut=t.coordToContainerPoint(et);Z.setContainerPoint(ut._add(_()))}});return Z[h]=O,Z}if(e instanceof Ct)for(var C=e.getHoles().length+1,x=0;x<C;x++){u[x]=[],l[x]=[];for(var M=f(x),S=0,T=M.length;S<T;S++)u[x].push(p.call(this,S,x,M)),S<T-1&&l[x].push(w.call(this,S,x,M));l[x].push(w.call(this,M.length-1,x,M))}else{for(var b=0,D=f(b),R=0,k=D.length;R<k;R++)u[b].push(p.call(this,R,b,D)),R<k-1&&l[b].push(w.call(this,R,b,D));l[b].length&&e.getCoordinates().length===2&&(l[b][0].options.symbol.markerDx=12)}this._addRefreshHook(function(){if(!y){for(var O in l)for(var A=f(O),j=l[O].length-1;j>=0;j--)l[O][j].refresh(O,A);l[0].length&&e instanceof yt&&(e.getCoordinates().length===2?l[0][0].options.symbol.markerDx=12:e.getCoordinates().length>2&&(l[0][0].options.symbol.markerDx=0));for(var G in u)for(var N=f(G),B=u[G].length-1;B>=0;B--)u[G][B].refresh(G,N)}})},i._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;t>=0;t--)this._refreshHooks[t].call(this)},i._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},i._addRefreshHook=function(t){t&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},i._update=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this._exeHistory([t,n]),this._recordHistory.apply(this,[t].concat(n))},i._updateCoordFromShadow=function(t){var e=this._shadow||this._geometry,n=e.getCoordinates(),o=this._geometry,h=this._updating;this._updating=!0,o.setCoordinates(n),t||this._recordHistory("setCoordinates",L.toNumberArrays(o.getCoordinates())),this._updating=h},i._recordHistory=function(t){this._history||(this._history=[],this._historyPointer=0);for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];if(this._history.length){var h=this._history[this._history.length-1];if(h[0]===t&&JSON.stringify(h[1])===JSON.stringify(n))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([t,n]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},i.cancel=function(){if(!this._history||this._historyPointer===0)return this;this._historyPointer=0;var t=this._history[0];return this._exeAndReset(t),this},i.undo=function(){if(!this._history||this._historyPointer===0)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},i.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},i._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,n=this._historyPointer;this.stop(),this._history=e,this._historyPointer=n,this.start()}},i._onDragStart=function(){this._updating=!0},i._onDragEnd=function(){this._updating=!1},i._exeHistory=function(t){if(Array.isArray(t)){var e=this._updating;this._updating=!0;var n=this._shadow||this._geometry,o=this._geometry;Array.isArray(t[0])?t[0].forEach(function(h){var u=h[0],l=h.slice(1);n[u].apply(n,l),n!==o&&o[u].apply(o,l)}):(n[t[0]].apply(n,t[1]),n!==o&&o[t[0]].apply(o,t[1])),this._updating=e}},a}(le(Bt));Pl.mergeOptions(gv);var vv={startEditText:function(){return this.getMap()?(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var a=this._textEditor.innerHTML;a=a.replace(/<p>/ig,"").replace(/<\/p>/ig,"<br/>"),this._textEditor.innerHTML=a;var i=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(i),_t(this._textEditor,"mousedown dblclick",jt),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var a=this.getMap(),i=this._createEditor();this._textEditor=i,a.on("mousedown",this.endEditText,this);var r=this._getEditorOffset();this._editUIMarker=new Mn(this.getCoordinates(),{animation:null,content:i,dx:r.dx,dy:r.dy}).addTo(a),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var a=this._getInternalSymbol()||{},i=0,r=0,t=a.textHorizontalAlignment;return t==="middle"||P(t)?(i=(a.textDx||0)-2,r=(a.textDy||0)-2):(i=(a.markerDx||0)-2,r=(a.markerDy||0)-2),{dx:i,dy:r}},_createEditor:function(){var a=this.getContent(),i=this.getSize(),r=this._getInternalSymbol()||{},t=i.width,e=r.textFill||"#000000",n=r.textSize||12,o=i.height,h=r.markerLineColor||"#000",u=r.markerFill||"#3398CC",l=r.textLineSpacing||0,f=V("div");return f.contentEditable=!0,f.style.cssText="background:"+u+"; border:1px solid "+h+`;
            color:`+e+";font-size:"+n+"px;width:"+(t-2)+"px;height:"+(o-2)+`px;margin: auto;
            line-height:`+(n+l)+`px;outline: 0; padding:0; margin:0;word-wrap: break-word;
            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;`,f.innerText=a,gt(f,"mousedown dblclick",jt),f.onkeyup=function(c){var d=f.style.height||0;c.keyCode===13&&(f.style.height=parseInt(d)+n/2+"px")},f},_setCursorToLast:function(a){var i;window.getSelection?(a.focus(),i=window.getSelection(),i.selectAllChildren(a),i.collapseToEnd()):document.selection&&(i=document.selection.createRange(),i.moveToElementText(a),i.collapse(!1),i.select())}};Ts.include(vv);ot.include({animate:function(a,i,r){var t=this;this._animPlayer&&this._animPlayer.finish(),it(i)&&(r=i),i||(i={});var e=this.getMap(),n=this._getProjection(),o=this._prepareAnimationStyles(a),h,u=i.focus;if(delete this._animationStarted,e){var l=e._getRenderer(),f=function(g){l.callInNextFrame(g)};i.framer=f}var c=Et.animate(o,i,function(d){if(e&&e.isRemoved()){c.finish();return}e&&!t._animationStarted&&u&&e.onMoveStart();var g=d.styles;for(var v in g)if(v!=="symbol"&&v!=="translate"&&g.hasOwnProperty(v)){var m="set"+v[0].toUpperCase()+v.slice(1);t[m](g[v])}var _=g.translate;if(_){var p=_;h&&(p=_.sub(h)),h=_,t.translate(p)}var y=g.symbol;if(y){var w=t.getSymbol()||{};t.setSymbol(Kt(w,y))}if(e&&u){var C=n.project(t.getCenter());e._setPrjCenter(C);var x=e._parseEventFromCoord(n.unproject(C));c.playState!=="running"?e.onMoveEnd(x):e.onMoving(x)}t._fireAnimateEvent(c.playState),r&&r(d)},this);return this._animPlayer=c,this._animPlayer.play()},_prepareAnimationStyles:function(a){var i=this._getInternalSymbol(),r={};for(var t in a)if(a.hasOwnProperty(t)){var e=a[t];if(t!=="translate"&&t!=="symbol"){var n="get"+t[0].toUpperCase()+t.substring(1),o=this[n]();r[t]=[o,e]}else if(t==="symbol"){var h=void 0;if(Array.isArray(a.symbol)){if(!Array.isArray(i))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");h=[];for(var u=a.symbol,l=0;l<u.length;l++){if(!u[l]){h.push(null);continue}var f={};for(var c in u[l])u[l].hasOwnProperty(c)&&(f[c]=[i[l][c],u[l][c]]);h.push(f)}}else{if(Array.isArray(i))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");h={};for(var d in e)e.hasOwnProperty(d)&&(h[d]=[i[d],e[d]])}r.symbol=h}else t==="translate"&&(r.translate=new L(e))}return r},_fireAnimateEvent:function(a){a==="finished"?(delete this._animationStarted,this._fireEvent("animateend")):a==="running"&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var _a=or+"_drag_stage",yh=q.touch?"touchstart mousedown":"mousedown",mv=function(s){z(a,s);function a(r){return s.call(this,r)||this}var i=a.prototype;return i.addHooks=function(){this.target.on(yh,this._startDrag,this)},i.removeHooks=function(){this._endDrag(),this.target.off(yh,this._startDrag,this),delete this.container},i._prepareDragHandler=function(){this._dragHandler=new gr(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},i._prepareShadow=function(){var t=this,e=this.target,n=e.getLayer().options.renderer==="canvas";if(n){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var o=this._shadow=e.copy();if(o.getGeometries){var h=o.getGeometries(),u=e.getGeometries();h.forEach(function(l,f){t._updateShadowSymbol(l,u[f])})}else this._updateShadowSymbol(o,e);o.setId(null),this._prepareShadowConnectors()}},i._updateShadowSymbol=function(t,e){if(t.setSymbol(e._getInternalSymbol()),e.options.dragShadow){var n=Xr(t._getInternalSymbol(),.5);t.setSymbol(n)}},i._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,n=this._dragStageLayer._getRenderer().resources,o=[];if(nn._hasConnectors(t))for(var h=nn._getConnectors(t),u=0,l=h.length;u<l;u++){var f=h[u],c=f.config(),d=f._getInternalSymbol();c.symbol=Xr(d,.5);var g=void 0;f.getConnectSource()===t?g=new f.constructor(e,f.getConnectTarget(),c):g=new f.constructor(f.getConnectSource(),e,c),o.push(g),f.getLayer()&&f.getLayer()._getRenderer()&&n.merge(f.getLayer()._getRenderer().resources)}this._shadowConnectors=o,o.push(e),this._dragStageLayer.bringToFront().addGeometry(o)},i._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},i._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer(_a),this._dragStageLayer||(this._dragStageLayer=new ye(_a,{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var n=new Xe;n.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=n},i._startDrag=function(t){var e=this.target.getMap();if(e){var n=this.target._getParent();if(!n&&!this.isDragging()){var o=t.domEvent;o.touches&&o.touches.length>1||o.button===2||(this.container=e._panels.mapWrapper||e._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(t.coordinate),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),gt(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1)}}},i._dragging=function(t){var e=this.target,n=e.getMap();if(!n._isEventOutMap(t.domEvent)){var o=n._parseEvent(t.domEvent),h=o.domEvent;if(!(h.touches&&h.touches.length>1)){var u=n._getVisualHeight(n.options.maxVisualPitch);if(!(o.containerPoint.y<n.height-u)){if(!this._moved){this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",o)),this.target._fireEvent("dragstart",this._startParam||o),delete this._startParam;return}var l=this._shadow||e,f=l.options.dragOnAxis,c=l.options.dragOnScreenAxis,d=o.containerPoint,g=o.coordinate;this._lastPoint=this._lastPoint||d,this._lastCoord=this._lastCoord||g,c?(f==="x"?d.y=this._lastPoint.y:f==="y"&&(d.x=this._lastPoint.x),g=n.containerPointToCoord(d)):g=this._correctCoord(g);var v=d.sub(this._lastPoint),m=g.sub(this._lastCoord);c||(f==="x"?v.y=m.y=0:f==="y"&&(v.x=m.x=0)),this._lastPoint=d,this._lastCoord=g,l.translate(m),l!==e&&!e.options.dragShadow&&e.translate(m),o.coordOffset=m,o.pointOffset=v,l._fireEvent("dragging",o),l!==e&&e._fireEvent("dragging",o)}}}},i._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&_t(this.container,"mouseleave",this._endDrag),!!this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var n=e.getMap();if(this.enabled()&&n){var o=n._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(o),this._moved&&e._fireEvent("dragend",o)}}},i.isDragging=function(){return!!this._isDragging},i._updateTargetAndRemoveShadow=function(t){if(this._shadow){var e=this.target,n=e.getMap();e.options.dragShadow||e.show();var o=this._shadow;if(o){if(e.options.dragShadow){var h=o.getFirstCoordinate(),u=e.getFirstCoordinate(),l=h.sub(u);e.translate(l)}o._fireEvent("dragend",t),o.remove(),delete this._shadow}this._shadowConnectors&&(n.getLayer(_a).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new Xe,this._dragStageLayer.remove())}},i._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var n=this.target;if(!n.getMinAltitude())return t;var o=(n.getMinAltitude()+n.getMaxAltitude())/2;return e.locateByPoint(t,0,-o)},a}(ae);ot.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1});ot.addInitHook("addHandler","draggable",mv);ot.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():this.draggable?this.draggable.isDragging():!1}});ot.include({startEdit:function(a){var i=this.getMap();return!i||!this.options.editable?this:(this._editor&&this.endEdit(),this._editor=new Pl(this,a),this._editor.start(),this._getParent()||this.fire("editstart"),i.getRenderer().setToRedraw(),this)},endEdit:function(){if(this._editor){this._editor.stop(),delete this._editor,this._getParent()||this.fire("editend");var a=this.getMap();a&&a.getRenderer().setToRedraw()}return this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this._getParent()||this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this._getParent()||this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._editor.cancel(),this._getParent()||this.fire("canceledit"),this):this},isEditing:function(){return this._editor?this._editor.isEditing():!1}});ot.include({_onEvent:function(a,i){var r=this.getMap();if(r){var t=i||this._getEventTypeToFire(a);t==="contextmenu"&&this.listens("contextmenu")&&(jt(a),ue(a));var e=r._getEventParams(a);H(this._pickGeometryIndex)&&(e.pickGeometryIndex=this._pickGeometryIndex),this._fireEvent(t,e)}},_getEventTypeToFire:function(a){return a.type}});ot.include({setInfoWindow:function(a){return this.removeInfoWindow(),a instanceof an?(this._infoWindow=a,this._infoWinOptions=F({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=F({},a),this._infoWindow?this._infoWindow.setOptions(a):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(a){return this.getMap()?(a||(a=this.getCenter()),this._infoWindow?this._infoWindow.show(a):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(a)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var a=this._infoWinOptions;return a?(this._infoWindow=new an(a),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var _v=new E(0,0),pv=new E(0,0),wh=new E(0,0),xh=new E(0,0),Fa=[],yv=function(s){z(a,s);function a(){return s.call(this,as)||this}var i=a.prototype;return i.checkUrl=function(t){return!t||!tt(t)?t:on(t)},i.fetchImage=function(t,e,n,o){t=this.checkUrl(t);var h={url:t,fetchOptions:o};this.send(h,Fa,n,e)},a}(wn),Sn=function(s){z(a,s);function a(r){var t;t=s.call(this,r)||this,t.tilesInView={},t.tilesLoading={},t._parentTiles=[],t._childTiles=[],t._tileQueue=[],t._tileQueueIds=new Set;var e=r.getTileSize().width;return t.tileCache=new gu(r.options.maxCacheSize*e/512*e/512,function(n){t.deleteTile(n)}),q.decodeImageInWorker&&t.layer.options.decodeImageInWorker&&(r.options.renderer==="gl"||!q.safari&&!q.iosWeixin)&&(t._tileImageWorkerConn=new yv),t._compareTiles=xv.bind(mt(mt(t))),t}var i=a.prototype;return i.getCurrentTileZoom=function(){return this._tileZoom},i.draw=function(t,e){var n=this.getMap();if(this.isDrawable()){var o=this.prepareCanvas();if(o&&!o.intersects(this.canvasExtent2D)){this.completeRender();return}this._renderTimestamp!==t&&(this._consumeTileQueue(),this._computeAvgTileAltitude(),this._renderTimestamp=t);var h,u=!1,l=this._frameTiles;if(l&&t===l.timestamp){if(l.empty)return;h=l}else{if(h=this._getTilesInCurrentFrame(),!h){this._frameTiles={empty:!0,timestamp:t},this.completeRender();return}u=!0,this._frameTiles=h,this._frameTiles.timestamp=t,h.loadingCount&&this.loadTileQueue(h.tileQueue)}var f=h,c=f.tiles,d=f.childTiles,g=f.parentTiles,v=f.placeholders,m=f.loading,_=f.loadingCount,p=f.missedTiles,y=f.incompleteTiles;this._drawTiles(c,g,d,v,e,p,y),_||m||(!n.isAnimating()&&(this._parentTiles.length||this._childTiles.length)&&(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),u&&this.retireTiles()}},i.getTileGridsInCurrentFrame=function(){return this._frameTileGrids},i.getCurrentTimestamp=function(){return this._renderTimestamp||0},i._getTilesInCurrentFrame=function(){var t=this.getMap(),e=this.layer,n=e._isPyramidMode()&&e.options.terrainTileMode,o=e.getTiles();if(this._frameTileGrids=o,o=o.tileGrids,!o||!o.length)return null;var h=o.reduce(function(rt,St){return rt+(St&&St.tiles&&St.tiles.length||0)},0);h>=this.tileCache.max/2&&this.tileCache.setMaxSize(h*2+1);var u=0,l=!1,f={},c=[],d=[],g={},v=[],m={},_=[],p={},y={},w=this.markTiles(),C=this._getLoadLimit(),x=o.length,M=this._tileZoom===void 0&&e.options.currentTilesFirst&&!this._terrainHelper;this._tileZoom=o[0].zoom;var S=null,T=null;n&&(S=[],T=new Map);for(var b=0;b<x;b++){var D=o[b],R=D.tiles,k=D.parents||Fa,O=k.length,A=M?R:k.concat(R),j=void 0;A.length&&(j=this._generatePlaceHolder(A[0].res));for(var G=0,N=A.length;G<N;G++){var B=A[G],Z=B.id,U=G<O,J=!1,ht=c.length;if(this._isLoadingTile(Z))J=l=!0,this.markCurrent(this.tilesLoading[Z],!0);else{var Y=this.getCachedTile(B,U);if(Y)U||(Y.image&&this.isTileFadingIn(Y.image)&&(J=l=!0,this.setToRedraw()),this.isTileComplete(Y)?c.push(Y):(J=!0,n&&T.set(Z,Y)));else{J=l=!0;var X=C&&u+w[0]>C;if(!this._tileQueueIds.has(B.id)&&!X&&(!t.isInteracting()||t.isMoving()||t.isRotating())){u++;var et=Z;y[et]=B}}}if(n&&!U&&(c.length===ht?S.push(B):f[B.id]=1),!n&&!U&&J&&!f[Z]){f[Z]=1,j&&!p[Z]&&(B.cache=!1,_.push({image:j,info:B}),p[Z]=1);var ut=this._findChildTiles(B);if(ut.length&&ut.forEach(function(rt){m[rt.info.id]||(v.push(rt),m[rt.info.id]=1)}),!ut.length||ut.length!==4){var Pt=this._findParentTile(B);if(Pt){var K=Pt.info.id;g[K]===void 0&&(g[K]=d.length,d.push(Pt))}}}}}var dt=[];if(n)for(var vt=0;vt<S.length;vt++){var nt=S[vt].info?S[vt].info:S[vt];if(!(!nt.parent||f[nt.id])){var ct=this._findChildTiles(nt),Tt=ct.tiles,Dt=ct.missedTiles;if(Tt.length){ie(c,Tt),ie(dt,Dt);continue}else if(T.has(nt.id)){c.push(T.get(nt.id)),T.delete(nt.id);continue}f[nt.id]=1,dt.push(nt)}}return this.tileCache.shrink(),{childTiles:v,missedTiles:dt,parentTiles:d,tiles:c,incompleteTiles:T&&Array.from(T.values()),placeholders:_,loading:l,loadingCount:u,tileQueue:y}},i.removeTileCache=function(t){delete this.tilesInView[t],this.tileCache.remove(t)},i.isTileCachedOrLoading=function(t){return this.tileCache.get(t)||this.tilesInView[t]||this.tilesLoading[t]},i.isTileCached=function(t){return!!(this.tileCache.get(t)||this.tilesInView[t])},i.isTileFadingIn=function(t){return this._getTileFadingOpacity(t)<1},i._drawTiles=function(t,e,n,o,h){var u=this;e.length&&(e.sort(this._compareTiles),this._parentTiles=e),n.length&&(this._childTiles=n,this._childTiles.sort(this._compareTiles));var l=!0,f=this.canvas._parentTileTimestamp;(this.layer.constructor===te||this.layer.constructor===Is)&&(this._renderTimestamp===f?l=!1:this.canvas._parentTileTimestamp=this._renderTimestamp);var c=this.layer.options.renderer==="gl"&&(!this.isGL||this.isGL()),d={tiles:t,parentTiles:this._parentTiles,childTiles:this._childTiles,parentContext:h};if(this.onDrawTileStart(d,h),l&&this.layer.options.opacity===1){this.layer._silentConfig=!0;var g=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,c?(this._drawChildTiles(n,h),this._drawParentTiles(this._parentTiles,h)):(this._drawParentTiles(this._parentTiles,h),this._drawChildTiles(n,h)),this.layer.options.fadeAnimation=g,this.layer._silentConfig=!1}this.drawingCurrentTiles=!0,t.sort(this._compareTiles);for(var v=0,m=t.length;v<m;v++)this._drawTileAndCache(t[v],h);if(delete this.drawingCurrentTiles,l&&this.layer.options.opacity<1){this.layer._silentConfig=!0;var _=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,c?(this._drawChildTiles(n,h),this._drawParentTiles(this._parentTiles,h)):(this._drawParentTiles(this._parentTiles,h),this._drawChildTiles(n,h)),this.layer.options.fadeAnimation=_,this.layer._silentConfig=!1}o.forEach(function(p){return u._drawTile(p.info,p.image,h)}),this.onDrawTileEnd(d,h)},i._drawChildTiles=function(t,e){var n=this;this.drawingChildTiles=!0,t.forEach(function(o){return n._drawTile(o.info,o.image,e)}),delete this.drawingChildTiles},i._drawParentTiles=function(t,e){var n=this;this.drawingParentTiles=!0,this._parentTiles.forEach(function(o){return n._drawTile(o.info,o.image,e)}),delete this.drawingParentTiles},i.onDrawTileStart=function(){},i.onDrawTileEnd=function(){},i._drawTile=function(t,e,n){e&&this.drawTile(t,e,n)},i._drawTileAndCache=function(t,e){this.isValidCachedTile(t)&&this._addTileToCache(t.info,t.image),this._drawTile(t.info,t.image,e)},i.drawOnInteracting=function(t,e,n){this.draw(e,n)},i.needToRedraw=function(){var t=this.getMap();return this._tileQueue.length?!0:t.getPitch()?s.prototype.needToRedraw.call(this):t.isRotating()||t.isZooming()?!0:t.isMoving()?!!this.layer.options.forceRenderOnMoving:s.prototype.needToRedraw.call(this)},i.hitDetect=function(){return!1},i._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit||0},i.isDrawable=function(){return this.getMap().getPitch()?(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1):!0},i.clear=function(){this.retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._tileQueue=[],this._tileQueueIds.clear(),this._parentTiles=[],this._childTiles=[],s.prototype.clear.call(this)},i._isLoadingTile=function(t){return!!this.tilesLoading[t]},i.clipCanvas=function(t){return s.prototype.clipCanvas.call(this,t)},i._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch||!this.layer.options.clipByPitch)return!1;var n=e.getContainerExtent(),o=e.getDevicePixelRatio();return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(n.ymin)*o,Math.ceil(n.getWidth())*o,Math.ceil(n.getHeight())*o),t.stroke(),t.clip(),!0},i.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e],o=this.loadTile(n);o.loadTime===void 0&&(this.tilesLoading[n.id]={image:o,current:!0,info:n})}},i.loadTile=function(t){var e=this,n={};if(this.loadTileBitmap){var o=function(l){e.onTileLoad(l,t)};this.loadTileBitmap(t.url,t,o)}else if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)this._fetchImage(n,t);else{var h=this.layer.getTileSize(t.layer);n=new Image,n.width=h.width,n.height=h.height,n.onload=this.onTileLoad.bind(this,n,t),n.onerror=this.onTileError.bind(this,n,t),this.loadTileImage(n,t.url)}return n},i._fetchImage=function(t,e){var n=this;if(t instanceof Image)t.src=e.url;else{var o=e.x,h=e.y,u=Math.abs(o+h)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(e.url,u,function(l,f){l?n.onTileError(t,e,l):Za(f,function(c){n.onTileLoad(c,e)})},this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},i.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;return P(n)||(t.crossOrigin=n),Xi(t,[e])},i.abortTileLoading=function(t,e){e&&e.id!==void 0&&this.removeTileLoading(e),t&&t instanceof Image&&(t.onload=Ch,t.onerror=Ch,t.src=Na)},i.onTileLoad=function(t,e){this.removeTileLoading(e),this._tileQueue.push({tileInfo:e,tileData:t}),this._tileQueueIds.add(e.id),this.setToRedraw()},i.removeTileLoading=function(t){delete this.tilesLoading[t.id],this.setToRedraw()},i._consumeTileQueue=function(){for(var t=0,e=this.layer.options.tileLimitPerFrame,n=this._tileQueue;n.length&&(e<=0||t<e);){var o=n.shift(),h=o.tileData,u=o.tileInfo;this._tileQueueIds.has(u.id)&&(this._tileQueueIds.delete(u.id),this.checkTileInQueue(h,u)&&(this.consumeTile(h,u),t++))}},i._computeAvgTileAltitude=function(){var t=0,e=0,n=0;for(var o in this.tilesInView){var h=this.tilesInView[o]&&this.tilesInView[o].info;h&&(t+=h.minAltitude||0,e+=h.maxAltitude||0,n++)}this.avgMinAltitude=t/n,this.avgMaxAltitude=e/n},i.checkTileInQueue=function(){return!0},i.consumeTile=function(t,e){if(this.layer&&this.tilesInView){var n={tile:e,tileImage:t};t=n.tileImage,this.resetTileLoadTime(t),this.removeTileLoading(e),this._addTileToCache(e,t),this.layer.fire("tileload",n),this.setToRedraw()}},i.resetTileLoadTime=function(t){t.loadTime!==0&&(t.loadTime=at())},i.onTileError=function(t,e){if(this.layer){t.onerrorTick=t.onerrorTick||0;var n=this.layer.options.tileRetryCount;if(n>t.onerrorTick){t.onerrorTick++,this._fetchImage(t,e),this.removeTileLoading(e);return}var o=this.layer.options.errorUrl;if(o)if(t instanceof Image&&t.src!==o){t.src=o,this.removeTileLoading(e);return}else t=new Image,t.src=o;this.abortTileLoading(t,e),t.loadTime=0,this.removeTileLoading(e),this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e})}},i.drawTile=function(t,e){if(!(!e||!this.getMap())){var n=t.extent2d,o=t.offset,h=_v.set(n.xmin-o[0],n.ymax-o[1]),u=t.z,l=t.id,f=this.getMap(),c=f.getZoom(),d=this.context,g=f._pointAtResToContainerPoint(h,t.res,0,pv),v=f.getBearing(),m=v||c!==u,_=this.getTileOpacity(e,t),p=d.globalAlpha;_<1&&(d.globalAlpha=_),m||g._round();var y=g.x,w=g.y,C=t.extent2d.xmax-t.extent2d.xmin,x=t.extent2d.ymax-t.extent2d.ymin,M=this.layer,S=M?M.options.bufferPixel:0;if(m){d.save(),d.translate(y,w),v&&d.rotate(-v*Math.PI/180),C+=S,x+=S;var T=f._getResolution();if(T!==t.res){var b=t.res/T;d.scale(b,b)}y=w=0}if(I.image(d,e,y,w,C,x),this.layer.options.debug){var D=this.layer.options.debugOutline;d.save(),d.strokeStyle=D,d.fillStyle=D,d.strokeWidth=10,d.font="20px monospace";var R=new E(y,w);I.rectangle(d,R,{width:C,height:x},1,0),I.fillText(d,this.getDebugInfo(l),R._add(32,x-14),D),I.drawCross(d,y+C/2,w+x/2,2,D),d.restore()}m&&d.restore(),d.globalAlpha!==p&&(d.globalAlpha=p),this.setCanvasUpdated()}},i.getDebugInfo=function(t){var e=t.split("_"),n=e.length;return e[n-3]+"/"+e[n-2]+"/"+e[n-1]},i.findChildTiles=function(t){return this._findChildTiles(t)},i._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer),n=e&&e.options.terrainTileMode&&e._isPyramidMode();if(!e||!e.options.background&&!n||t.z>this.layer.getMaxZoom())return Fa;var o=this.getMap(),h=[];if(e._isPyramidMode()){if(!n){for(var u=this._getLayerOfTile(t.layer),l=2,f=t.x*2,c=t.y*2,d=t.z+1,g=[],v=0;v<2;v++)for(var m=0;m<2;m++)g.push(f+v,c+m,d);for(;g.length;){var _=g.pop(),p=g.pop(),y=g.pop(),w=u._getTileId(y,p,_,t.layer),C=_+1<=t.z+l,x=this.tileCache.getAndRemove(w);if(x){if(this.isValidCachedTile(x))h.push(x),this.tileCache.add(w,x);else if(C)for(var M=0;M<2;M++)for(var S=0;S<2;S++)g.push(y*2+M,p*2+S,_+1)}else if(C)for(var T=0;T<2;T++)for(var b=0;b<2;b++)g.push(y*2+T,p*2+b,_+1)}return h}var D;n&&(D=[]);for(var R=t.x*2,k=t.y*2,O=t.z+1,A=[],j=0;j<2;j++)for(var G=0;G<2;G++){var N=R+j,B=k+G,Z=O,U=e._getTileId(N,B,Z,t.layer),J=this.tileCache.getAndRemove(U);J&&this.isValidCachedTile(J)?(h.push(J),this.tileCache.add(U,J),A.push(null)):A.push(U)}if(h.length<4)for(var ht=0,Y=0;Y<2;Y++)for(var X=0;X<2;X++){var et=A[ht++];if(et){for(var ut=R+Y,Pt=k+X,K=O,dt=h.length,vt=[],nt=0;nt<2;nt++)for(var ct=0;ct<2;ct++){var Tt=ut*2+nt,Dt=Pt*2+ct,rt=K+1,St=e._getTileId(Tt,Dt,rt,t.layer),Mt=this.tileCache.getAndRemove(St);Mt&&this.isValidCachedTile(Mt)?(h.push(Mt),this.tileCache.add(St,Mt),vt.push(null)):vt.push(St)}if(n&&h.length-dt<4){var kt=e.tileInfoCache.get(et)||e._createChildNode(t,Y,X,[0,0],et);if(h.length-dt===0)D.push(kt);else for(var Ye=0,xe=0;xe<2;xe++)for(var Ie=0;Ie<2;Ie++){var se=vt[Ye++];if(se){var Ce=this.layer.tileInfoCache.get(se)||e._createChildNode(kt,xe,Ie,[0,0],se);D.push(Ce)}}}}}return n?{tiles:h,missedTiles:D}:h}for(var Pe=1,Qe=t.res,ze=t.extent2d.getMin(),je=t.extent2d.getMax(),fe=e._project(o._pointToPrjAtRes(ze,Qe,wh),wh),Gt=e._project(o._pointToPrjAtRes(je,Qe,xh),xh),Te=1;Te<Pe;Te++)this._findChildTilesAt(h,fe,Gt,e,t.z+Te);return h},i._findChildTilesAt=function(t,e,n,o,h){var u=o.getId(),l=o.getSpatialReference().getResolution(h);if(l)for(var f=o._getTileConfig().getTileIndex(e,l),c=o._getTileConfig().getTileIndex(n,l),d=Math.min(f.idx,c.idx),g=Math.max(f.idx,c.idx),v=Math.min(f.idy,c.idy),m=Math.max(f.idy,c.idy),_,p,y=d;y<g;y++)for(var w=v;w<m;w++)_=o._getTileId(y,w,h,u),p=this.tileCache.getAndRemove(_),p&&this.isValidCachedTile(p)&&(t.push(p),this.tileCache.add(_,p))},i.findParentTile=function(t,e){return this._findParentTile(t,e)},i._findParentTile=function(t,e){var n=this.getMap(),o=this._getLayerOfTile(t.layer);if(!o||!o.options.background&&!o.options.terrainTileMode)return null;var h=o.getMinZoom(),u=e||t.z-h;if(o._isPyramidMode()){for(var l=t.z-u,f=t.z-1;f>=l;f--){var c=t.z-f,d=Math.pow(2,c),g=Math.floor(t.x/d),v=Math.floor(t.y/d),m=void 0;f===t.z-1?m=t.parent:m=o._getTileId(g,v,f,t.layer);var _=this.tileCache.getAndRemove(m);if(_&&this.isValidCachedTile(_))return this.tileCache.add(m,_),_}return null}for(var p=o.getSpatialReference(),y=p.getZoomDirection(),w=t.res,C=t.extent2d.getCenter(),x=o._project(n._pointToPrjAtRes(C,w)),M=1;M<=u;M++){var S=t.z-y*M,T=p.getResolution(S);if(T){var b=o._getTileConfig().getTileIndex(x,T),D=o._getTileId(b.x,b.y,S,t.layer),R=this.tileCache.getAndRemove(D);if(R)return this.tileCache.add(D,R),R}}return null},i.isValidCachedTile=function(t){return!!t.image},i.isTileComplete=function(){return!0},i._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},i.getCachedTile=function(t,e){var n=t.id,o=this.tilesInView,h=this.tileCache.getAndRemove(n);if(h){e||(o[n]=h);var u=this.tilesLoading;if(u&&u[n]){this.markCurrent(u[n],!1);var l=u[n],f=l.image,c=l.info;this.abortTileLoading(f,c),delete u[n]}}else h=o[n];return h&&(h.current=!0,this.isValidCachedTile(h)&&this.tileCache.add(n,h)),h},i._addTileToCache=function(t,e){this.isValidCachedTile({info:t,image:e})&&(this.tilesInView[t.id]={image:e,current:!0,info:t})},i.getTileOpacity=function(t,e){var n=this._getTileFadingOpacity(t);if(this.layer.getChildLayer){var o=this.layer.getLayer(e.layer);o&&(n*=o.options.opacity)}return n},i._getTileFadingOpacity=function(t){return!this.layer.options.fadeAnimation||!t.loadTime?1:Math.min(1,(at()-t.loadTime)/this.layer.options.fadeDuration)},i.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,delete this._tileZoom,s.prototype.onRemove.call(this)},i.markCurrent=function(t,e){t.current=e},i.markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var n in this.tilesLoading)this.markCurrent(this.tilesLoading[n],!1),t++;if(this.tilesInView)for(var o in this.tilesInView)this.markCurrent(this.tilesInView[o],!1),e++;return[t,e]},i.retireTiles=function(t){for(var e in this.tilesLoading){var n=this.tilesLoading[e];(t||!n.current)&&(n.image&&this.abortTileLoading(n.image,n.info),this.deleteTile(n),this.removeTileLoading(n.info))}for(var o in this.tilesInView){var h=this.tilesInView[o];h.current||(delete this.tilesInView[o],this.tileCache.has(o)||this.deleteTile(h))}},i.deleteTile=function(t){if(!(!t||!t.image)){var e=t.info.id;this._tileQueueIds.has(e)&&this._tileQueueIds.delete(e),t.image.close&&t.image.close(),t.image instanceof Image&&(t.image.onload=null,t.image.onerror=null)}},i._generatePlaceHolder=function(t){var e=this.getMap(),n=this.layer.options.placeholder;if(!n||e.getPitch())return null;var o=this.layer.getTileSize(),h=t/e._getResolution(),u=this._tilePlaceHolder=this._tilePlaceHolder||I.createCanvas(1,1,e.CanvasClass);return u.width=o.width*h,u.height=o.height*h,it(n)?n(u):wv(u),u},i.setTerrainHelper=function(t){this._terrainHelper=t},a}(Ci);te.registerRenderer("canvas",Sn);function Ch(){return!1}function wv(s){var a=s.getContext("2d"),i=s.width,r=s.height,t=i/16,e=r/16;a.beginPath();for(var n=0;n<16;n++)a.moveTo(0,n*e),a.lineTo(i,n*e),a.moveTo(n*t,0),a.lineTo(n*t,r);a.strokeStyle="rgba(180, 180, 180, 0.1)",a.lineWidth=1,a.stroke(),a.beginPath();for(var o=[[0,0],[i,0],[0,r],[i,r],[0,0],[0,r],[i,0],[i,r],[0,r/2],[i,r/2],[i/2,0],[i/2,r]],h=1;h<o.length;h+=2)a.moveTo(o[h-1][0],o[h-1][1]),a.lineTo(o[h][0],o[h][1]);a.lineWidth=1*4,a.stroke()}function xv(s,a){return Math.abs(this._tileZoom-s.info.z)-Math.abs(this._tileZoom-a.info.z)}var Cv=new E(0,0),Pv={properties:{}},Bs=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.isDrawable=function(){return!0},i.needToRedraw=function(){var t=this.getMap();return this.isGL()&&!t.getPitch()&&t.isZooming()&&!t.isMoving()&&!t.isRotating()?!0:s.prototype.needToRedraw.call(this)},i.onDrawTileStart=function(t,e){var n=this.gl;n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.enable(n.POLYGON_OFFSET_FILL),n.enable(n.STENCIL_TEST),n.stencilOp(n.KEEP,n.KEEP,n.REPLACE);var o=!!this.layer.options.depthMask;if(n.depthMask(o),e&&e.renderTarget){var h=e.renderTarget.fbo;if(h){var u=e.renderTarget.getFramebuffer(h);n.bindFramebuffer(n.FRAMEBUFFER,u)}}},i.onDrawTileEnd=function(t,e){var n=this.gl;if(e&&e.renderTarget){var o=e.renderTarget.fbo;o&&n.bindFramebuffer(n.FRAMEBUFFER,null)}},i.drawTile=function(t,e,n){if(!(n&&n.sceneFilter&&!n.sceneFilter(Pv))){var o=this.getMap();if(!(!t||!o||!e)){var h=t._glScale=t._glScale||t.res/o.getGLRes(),u=t.extent2d.xmax-t.extent2d.xmin,l=t.extent2d.ymax-t.extent2d.ymin;if(t.cache!==!1&&this._bindGLBuffer(e,u,l),!this.isGL()){s.prototype.drawTile.call(this,t,e);return}var f=t.extent2d,c=t.offset,d=Cv.set(f.xmin-c[0],t.extent2d.ymax-c[1]),g=d.x*h,v=d.y*h,m=this.getTileOpacity(e,t),_=null;this.layer.options.debug&&(_=this.getDebugInfo(t.id));var p=this.gl;p.stencilFunc(p.LEQUAL,Math.abs(this.getCurrentTileZoom()-t.z),255);var y=this.layer.getPolygonOffset(),w=this.drawingCurrentTiles?y:y+1;p.polygonOffset(w,w),this.drawGLImage(e,g,v,u,l,h,m,_),this._getTileFadingOpacity(e)<1?this.setToRedraw():this.setCanvasUpdated()}}},i._bindGLBuffer=function(t,e,n){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,n))},i.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;t.crossOrigin=n!==null?n:"",t.src=e},i.onCanvasCreate=function(){(!this.canvas.gl||!this.canvas.gl.wrap)&&this.createCanvas2()},i.createContext=function(){s.prototype.createContext.call(this),this.createGLContext()},i.resizeCanvas=function(t){this.canvas&&(s.prototype.resizeCanvas.call(this,t),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(s.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.getCanvasImage=function(){if(!this.isGL()||!this.canvas2)return s.prototype.getCanvasImage.call(this);var t=s.prototype.getCanvasImage.call(this);return t&&(t.image=this.canvas2),t},i.isGL=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var t=this.getMap();return t&&(t.getPitch()||t.getBearing())||this.layer&&!!this.layer.options.fragmentShader},i.deleteTile=function(t){s.prototype.deleteTile.call(this,t),t&&t.image&&this.disposeImage(t.image),delete t.image},i.onRemove=function(){s.prototype.onRemove.call(this),this.removeGLCanvas()},a}(js(Sn));te.registerRenderer("gl",Bs);function Tl(s){var a=this.layer.getTileSize(),i=this.canvas.constructor,r=this.getMap(),t=r.getDevicePixelRatio(),e=I.createCanvas(a.width*t,a.height*t,i);e.layer=this.layer;var n=this,o=new E(s.extent2d.xmin,s.extent2d.ymax),h=new ft(r.pointToCoordinate(o),r.pointToCoordinate(o.add(a.width,a.height)),r.getProjection());return this.layer.drawTile(e,{url:s.url,point:o,center:r.pointToCoordinate(o.add(a.width/2,a.height/2)),extent:h,z:s.z,x:s.x,y:s.y},function(u){if(u){n.onTileError(e,s);return}n.onTileLoad(e,s)}),e}var Ml=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.loadTile=function(){return Tl.apply(this,arguments)},a}(Sn),Sl=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.loadTile=function(){return Tl.apply(this,arguments)},a}(Bs);zs.registerRenderer("canvas",Ml);zs.registerRenderer("gl",Sl);var Tv=typeof Int8Array<"u"?new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]):[],Mv=`
    attribute vec3 a_position;
    uniform mat4 transform;

    void main()
    {
        gl_Position = transform * vec4(a_position, 1.0);
    }
`,Sv=`
    precision mediump float;
    uniform vec3 color;
    void main()
    {
        gl_FragColor = vec4(color, 1.0);
    }
`,bv=function(){function s(i,r,t){this.gl=i,this.quadVertices=r||Tv,this.attributes=["a_position",3,Ev(r)],this.debug=t}var a=s.prototype;return a.start=function(){var r=this.gl;r.enable(r.STENCIL_TEST),r.stencilMask(255),r.stencilOp(r.KEEP,r.REPLACE,r.REPLACE),r.depthMask(!1),this._save(),this.buffer||(this._createBuffer(),this._createProgram()),r.useProgram(this.program),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),wl(r,this.program,this.attributes),this.transformLoc||(this.transformLoc=r.getUniformLocation(this.program,"transform")),this.colorLoc||(this.colorLoc=r.getUniformLocation(this.program,"color")),!this.debug&&r.colorMask(!1,!1,!1,!1)},a.end=function(){var r=this.gl;r.depthMask(!0),this._restore(),!this.debug&&r.colorMask(!0,!0,!0,!0)},a.draw=function(r){var t=this.gl;t.uniformMatrix4fv(this.transformLoc,!1,r),t.uniform3fv(this.colorLoc,[Math.random(),Math.random(),Math.random()]),t.drawArrays(t.TRIANGLE_STRIP,0,4)},a.remove=function(){var r=this.gl;return this.buffer&&r.deleteBuffer(this.buffer),this.program&&(r.deleteShader(this.program.fragmentShader),r.deleteShader(this.program.vertexShader),r.deleteProgram(this.program)),delete this.transformLoc,delete this.gl,this},a.stencilMask=function(r){return this.gl.stencilMask(r),this},a.stencilFunc=function(r,t,e){return this.ref=t,this.gl.stencilFunc(r,t,e),this},a.stencilOp=function(r,t,e){return this.gl.stencilOp(r,t,e),this},a.resetFunc=function(){return this.ref=1,this.gl.stencilFunc(this.gl.ALWAYS,1,255),this},a._save=function(){var r=this.gl;this._savedProgram=r.program},a._restore=function(){var r=this.gl;r.program=this._savedProgram,r.program&&r.useProgram(r.program)},a._createBuffer=function(){var r=this.gl;if(this.buffer=r.createBuffer(),!this.buffer)throw new Error("Failed to create the buffer object");r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.bufferData(r.ARRAY_BUFFER,this.quadVertices,r.STATIC_DRAW)},a._createProgram=function(){var r=yl(this.gl,Mv,Sv),t=r.program,e=r.vertexShader,n=r.fragmentShader;t.vertexShader=e,t.fragmentShader=n,this.program=t},s}();function Ev(s){return s instanceof Float32Array?"FLOAT":s instanceof Int16Array?"SHORT":s instanceof Uint16Array?"UNSIGNED_SHORT":s instanceof Int8Array?"BYTE":s instanceof Uint8Array||s instanceof Uint8ClampedArray?"UNSIGNED_BYTE":"FLOAT"}var bl=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.checkResources=function(){var t=this._geosToCheck||[];if(!this._resourceChecked&&this.layer._geoList&&ie(t,this.layer._geoList),!st(t))return[];for(var e=[],n={},o=t.length-1;o>=0;o--){var h=t[o],u=h._getExternalResources();if(u.length)if(!this.resources)e.push.apply(e,u);else for(var l=0;l<u.length;l++){var f=u[l][0];!this.resources.isResourceLoaded(u[l])&&!n[f]&&(e.push(u[l]),n[f]=1)}}return this._resourceChecked=!0,delete this._geosToCheck,e},i.render=function(){return this.layer._sortGeometries(),s.prototype.render.apply(this,arguments)},i._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),ie(this._geosToCheck,t))},i.onGeometryAdd=function(t){this._addGeoToCheckRes(t),de(this)},i.onGeometryRemove=function(){de(this)},i.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),de(this)},i.onGeometryShapeChange=function(){de(this)},i.onGeometryPositionChange=function(){de(this)},i.onGeometryZIndexChange=function(){de(this)},i.onGeometryShow=function(){de(this)},i.onGeometryHide=function(){de(this)},i.onGeometryPropertiesChange=function(){de(this)},a}(Ci);function de(s){s.layer.options.drawImmediate&&s.render(),s.setToRedraw()}var Rv=new Q,Ir=[],pa=new Q,Av="center",Ph=new dr;function Th(s){if(!s)return null;var a=s.getContext("2d");return a.clearRect(0,0,s.width,s.height),a}function ji(s){return s&&s.options.progressiveRender&&s.options.progressiveRenderDebug}var El=function(s){z(a,s);function a(){return s.apply(this,arguments)||this}var i=a.prototype;return i.setToRedraw=function(){return s.prototype.setToRedraw.call(this),this._resetProgressiveRender(),this},i._geoIsCollision=function(t,e){if(!t)return!1;var n=t.options.collision;if(!n)return!1;if(t.isPoint&&t.getContainerExtent){t.bbox||(t.bbox=[0,0,0,0]);var o=this.layer.options.collisionBufferSize,h=t.getContainerExtent();if(!h)return!1;if(t.bbox[0]=h.xmin-o,t.bbox[1]=h.ymin-o,t.bbox[2]=h.xmax+o,t.bbox[3]=h.ymax+o,e.collides(t.bbox))return!0;e.insertBox(t.bbox)}return!1},i.getImageData=function(){if(!this._lastRenderTime||at()-this._lastRenderTime<32||!this.context||!this.context.canvas)return null;if(!this._imageData){var t=this.context.canvas,e=t.width,n=t.height;try{this._imageData=this.context.getImageData(0,0,e,n)}catch(o){console.warn(`hit detect failed with tainted canvas, some geometries have external resources in another domain:
`,o)}}return this._imageData},i.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=at()},i.checkResources=function(){var t=this,e=s.prototype.checkResources.apply(this,arguments),n=this.layer.getStyle();return n&&(Array.isArray(n)||(n=[n]),n.forEach(function(o){for(var h=hr(o.symbol,!0),u=0,l=h.length;u<l;u++)t.resources.isResourceLoaded(h[u])||e.push(h[u])})),e},i.needToRedraw=function(){if(this.isProgressiveRender()&&!this.renderEnd)return!0;var t=this.getMap();return t.isInteracting()&&this.layer.options.enableAltitude?!0:t.isZooming()&&!t.isRotating()&&!t.getPitch()&&!this._hasPoint&&this.layer.constructor===ye?!1:s.prototype.needToRedraw.call(this)},i.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty()){this.clearCanvas(),this.completeRender();return}this.prepareCanvas(),this.drawGeos(),this.completeRender()}},i.isBlank=function(){return!this.context||this.isProgressiveRender()?!1:!this.context.canvas._drawn},i.drawOnInteracting=function(){if(this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var t=this.getMap(),e=this.layer.getCount(),n=this.mapStateCache.resolution;(t.isZooming()&&t.options.seamlessZoom&&this._drawnRes!==void 0&&n>this._drawnRes*1.5&&this._geosToDraw.length<e||t.isMoving()||t.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._drawnRes=n),this._sortByDistanceToCamera(t.cameraPosition);var o=this.layer.options,h=o.collision,u=o.collisionDelay;if(h){var l=at();this._lastCollisionTime||(this._lastCollisionTime=l),l-this._lastCollisionTime<=u?this._geosToDraw=this._lastGeosToDraw||this._geosToDraw:(this._collidesGeos(),this._lastCollisionTime=l)}for(var f=0,c=this._geosToDraw.length;f<c;f++){var d=this._geosToDraw[f];if(!d._isCheck&&!d.isVisible()){delete d._cPoint,delete d._inCurrentView;continue}d._paint(this._displayExtent),this._geosToDraw[f]._cPoint=void 0,this._geosToDraw[f]._inCurrentView=void 0}this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,ji(this.layer)&&console.log("progressiveRender on drawOnInteracting page:",this.page)}},i.show=function(){this.layer.forEach(function(t){t._repaint()}),s.prototype.show.apply(this,arguments)},i.forEachGeo=function(t,e){this.layer.forEach(t,e)},i._checkGeos=function(){for(var t=this._getCurrentNeedRenderGeos(),e=0,n=t.length;e<n;e++)this.checkGeo(t[e]);return this},i.drawGeos=function(){this._drawSnapshot(),this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._sortByDistanceToCamera(this.getMap().cameraPosition),this._collidesGeos();for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint(),this._geosToDraw[t]._cPoint=void 0,this._geosToDraw[t]._inCurrentView=void 0;this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,ji(this.layer)&&console.log("progressiveRender drawGeos page:",this.page),this._snapshot(),this._setDrawGeosDrawTime()},i.prepareToDraw=function(){return this.layer._drawTime=at(),this._hasPoint=!1,this._geosToDraw=[],this},i._setDrawGeosDrawTime=function(){for(var t=at(),e=this.layer._drawTime,n=this.getGeoPainterList(),o=0,h=n.length;o<h;o++){var u=n[o];u&&u._setDrawTime&&u._setDrawTime(e)}return ji(this.layer)&&console.log("_setDrawGeosDrawTime time:",at()-t+"ms"),this},i.checkGeo=function(t){if(t.isPoint&&this._onlyHasPoint!==void 0){t._inCurrentView&&(this._hasPoint=!0,t._isCheck=!0,this._geosToDraw.push(t));return}if(t._isCheck=!1,!(!t||!t.isVisible()||!t.getMap()||!t.getLayer()||!t.getLayer().isCanvasRender())){var e=t._getPainter(),n=!0;if(t._inCurrentView)n=!0;else if(t._inCurrentView===!1)n=!1;else{var o=e.get2DExtent(this.resources,Rv);(!o||!o.intersects(this._displayExtent))&&(n=!1)}n&&(e.hasPoint()&&(this._hasPoint=!0),t._isCheck=!0,this._geosToDraw.push(t))}},i._collidesGeos=function(){var t=this.layer.options.collision;if(!t)return this;var e=this.layer.options.collisionScope,n=this.layer.getMap(),o=e==="map"?n.getCollisionIndex():Ph;o===Ph&&o.clear();var h=this._geosToDraw;this._geosToDraw=[];for(var u=0,l=h.length;u<l;u++)this._geoIsCollision(h[u],o)||this._geosToDraw.push(h[u]);return this},i.onZoomEnd=function(){delete this.canvasExtent2D,s.prototype.onZoomEnd.apply(this,arguments)},i.onRemove=function(){this.forEachGeo(function(t){t.onHide()}),delete this._geosToDraw,delete this.snapshotCanvas,delete this.pageGeos,delete this.geoPainterList},i.onGeometryPropertiesChange=function(t){t&&this.layer._styleGeometry(t.target),s.prototype.onGeometryPropertiesChange.call(this,t)},i._updateDisplayExtent=function(){var t=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t)){this.completeRender();return}t=t.intersection(this._maskExtent)}this._displayExtent=t},i.identifyAtPoint=function(t,e){e===void 0&&(e={});var n=this.getGeosForIdentify();return n?this.layer._hitGeos(n,t,e):[]},i._updateMapStateCache=function(){var t=this.getMap(),e=t._pointToContainerPoint(this.middleWest)._add(0,-t.height/2),n=t.getResolution(),o=t.getPitch(),h=t.getBearing(),u=t.getGLScale(),l=t.getGLRes(),f=t.getContainerExtent(),c=t._get2DExtent(),d=t._get2DExtentAtRes(l);return this.mapStateCache={resolution:n,pitch:o,bearing:h,glScale:u,glRes:l,_2DExtent:c,glExtent:d,containerExtent:f,offset:e},this},i._batchConversionMarkers=function(t){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var e=[],n=[],o=[],h={},u=this.layer,l=u.options,f=u.getAltitude?u.getAltitude():0,c=u.isCanvasRender();this._onlyHasPoint=!0;for(var d=0,g=this._getCurrentNeedRenderGeos(),v=0,m=g.length;v<m;v++){var _=g[v];if(_.isPoint){var p=_._painter;p||(p=_._getPainter());var y=p.getRenderPoints(Av)[0][0],w=l.enableAltitude?_._getAltitude():f;h[w]===void 0&&(h[w]=p.getAltitude()),e[d]=y,o[d]=h[w],n[d]=_,d++}else this._onlyHasPoint=!1}if(d===0)return[];var C=this.getMap(),x=$i(e,"_pt");x=C._pointsAtResToContainerPoints(e,t,o,x);for(var M=C.getContainerExtent(),S=M.xmax,T=M.ymax,b=M.xmin,D=M.ymin,R={},k=0,O=n.length;k<O;k++){var A=n[k];if(A._cPoint=x[k],!A._cPoint){A._inCurrentView=!1;continue}var j=x[k],G=j.x,N=j.y;if(A._inCurrentView=G>=b&&N>=D&&G<=S&&N<=T,!A._inCurrentView){var B=A.getSymbolHash(),Z=void 0;B?Z=R[B]=R[B]||A._painter.getFixedExtent():Z=A._painter.getFixedExtent(),pa.set(Z.xmin,Z.ymin,Z.xmax,Z.ymax),pa._add(x[k]),A._inCurrentView=pa.intersects(M)}A._inCurrentView&&((!A.isVisible()||!c)&&(A._inCurrentView=!1),this._onlyHasPoint&&A._inCurrentView&&(this._hasPoint=!0,A._isCheck=!0,this._geosToDraw.push(A)))}return x},i._sortByDistanceToCamera=function(t){if(this.layer.options.sortByDistanceToCamera&&this._geosToDraw.length){var e=this.getMap(),n=e.distanceToPoint(1e3,0,e.getGLScale()).x,o=n/1e3,h="center";this._geosToDraw.sort(function(u,l){if(!u.isPoint||!l.isPoint)return 0;var f=u._painter,c=l._painter;if(!f||!c)return 0;var d=f.getRenderPoints(h)[0][0],g=c.getRenderPoints(h)[0][0],v=f.getAltitude()*o,m=c.getAltitude()*o;zt(Ir,d.x,d.y,v);var _=Ga(Ir,t);zt(Ir,g.x,g.y,m);var p=Ga(Ir,t);return p-_})}},i._constructorIsThis=function(){return this.constructor===a},i.isProgressiveRender=function(){var t=this.layer;if(!t)return!1;var e=t.options||{},n=e.progressiveRender,o=e.collision;return o?!1:n},i.getGeosForIdentify=function(){return this.isProgressiveRender()?this.pageGeos||[]:this._geosToDraw||[]},i.getGeoPainterList=function(){if(!this.isProgressiveRender()){for(var t=[],e=this._geosToDraw||[],n=0,o=e.length;n<o;n++)t.push(e[n]._painter);return t}return this.geoPainterList||[]},i._checkSnapshotCanvas=function(){if(!this.isProgressiveRender())return delete this.snapshotCanvas,null;var t=this.canvas;if(!t)return delete this.snapshotCanvas,null;this.snapshotCanvas||(this.snapshotCanvas=I.createCanvas(1,1));var e=this.snapshotCanvas,n=t.width,o=t.height,h=t.style;return(e.width!==n||e.height!==o)&&(e.width=n,e.height=o),(e.style.width!==h.width||e.style.height!==h.height)&&(e.style.width=h.width,e.style.height=h.height),e},i._getCurrentNeedRenderGeos=function(){var t=this.layer._geoList||[];if(!this.isProgressiveRender())return t;if(this.renderEnd)return[];var e=this.layer,n=e.options.progressiveRenderCount,o=n,h=this.page,u=(h-1)*o,l=h*o,f=t.slice(u,l);return f},i._resetProgressiveRender=function(){ji(this.layer)&&console.log("progressiveRender resetProgressiveRender"),this.renderEnd=!1,this.page=1,this.pageGeos=[],this.geoPainterList=[],this.maxTolerance=0,this._clearSnapshotCanvas()},i._clearSnapshotCanvas=function(){var t=this._checkSnapshotCanvas();t&&Th(t)},i._snapshot=function(){for(var t=this.isProgressiveRender(),e=this._geosToDraw||[],n=0,o=e.length;n<o;n++){var h=e[n],u=h._hitTestTolerance()||0;if(this.maxTolerance=Math.max(this.maxTolerance,u),t){this.pageGeos.push(h);var l=h._painter;this.geoPainterList.push(l)}}if(!t)return this;var f=at(),c=this._checkSnapshotCanvas();if(c&&this.canvas){var d=Th(c);d.drawImage(this.canvas,0,0)}var g=this.layer,v=g.options.progressiveRenderCount,m=g._geoList||[],_=Math.ceil(m.length/v);return this.renderEnd=this.page>=_,this.renderEnd&&this._setDrawGeosDrawTime(),ji(this.layer)&&console.log("snapshot time:",at()-f+"ms"),this.page++,this},i._drawSnapshot=function(){if(!this.isProgressiveRender())return this;var t=this.snapshotCanvas,e=this.context;if(!t||!e)return this;var n=this.getMap();if(!n)return this;var o=n.getDevicePixelRatio()||1,h=1/o;return e.scale(h,h),e.drawImage(t,0,0),e.scale(o,o),this},a}(bl);ye.registerRenderer("canvas",El);var Rl=function(s){z(a,s);function a(r){var t;return t=s.call(this)||this,t.map=r,t._handlerQueue=[],t._thisDocVisibilitychange=t._onDocVisibilitychange.bind(mt(mt(t))),t._thisDocDragStart=t._onDocDragStart.bind(mt(mt(t))),t._thisDocDragEnd=t._onDocDragEnd.bind(mt(mt(t))),t._thisDocDPRChange=t._onDocDPRChange.bind(mt(mt(t))),t}var i=a.prototype;return i.callInNextFrame=function(t){this._handlerQueue.push(t)},i.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]()},i.offsetPlatform=function(t,e){if(!this.map._panels.front)return this;if(!e&&t.x===0&&t.y===0)return this;var n=this.map._panels,o=this._frontCount=n.back.layerDOM.childElementCount,h=this._backCount=n.front.layerDOM.childElementCount,u=this._uiCount=n.front.uiDOM.childElementCount;if(o||h||u){var l=this.map.offsetPlatform();t?l=l.add(t)._round():l=l.round(),h&&Ni(n.back,l),(o||u)&&Ni(n.front,l)}return this},i.domChanged=function(){var t=this.map._panels;if(!t.front)return!1;var e=t.back.layerDOM.childElementCount;if(this._frontCount===void 0||this._frontCount!==e)return!0;var n=t.front.layerDOM.childElementCount;if(this._backCount===void 0||this._backCount!==n)return!0;var o=t.front.uiDOM.childElementCount;return this._uiCount===void 0||this._uiCount!==o},i.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var t=new E(0,0);Ni(this.map._panels.back,t),Ni(this.map._panels.front,t)}},i.onZoomEnd=function(){this.resetContainer()},i.onLoad=function(){this._frameLoop()},i._onDocVisibilitychange=function(){document.visibilityState==="visible"&&this.setToRedraw()},i._getWrapPanel=function(){if(!this.map)return null;var t=this.map.getPanels();return t&&t.mapWrapper},i._onDocDragStart=function(){var t=this._getWrapPanel();t&&(t.style.overflow="visible")},i._onDocDragEnd=function(){var t=this._getWrapPanel();t&&(t.style.overflow="hidden")},i._onDocDPRChange=function(){var t=this.map;if(!(!t||!t.options||t.options.devicePixelRatio||!t.checkSize||!t.getRenderer)){var e=t.getRenderer();e&&t.checkSize(!0)}},i._containerIsOffscreen=function(){var t=this.map.getContainer();if(!t||!t.style||t.style.display==="none")return!0;var e=Math.min(t.clientWidth,t.clientHeight);return e<=0},a}(Bt),Ov=new dr,Al=function(s){z(a,s);function a(r){var t;return t=s.call(this,r)||this,t._containerIsCanvas=!!r._containerDOM.getContext,t._registerEvents(),t._loopTime=0,t._resizeEventList=[],t._resizeTime=-1/0,t}var i=a.prototype;return i.load=function(){this.initContainer()},i.renderFrame=function(t){var e=this.map;if(!e||!e.options.renderable)return!1;if(this._handleResizeEventList(t),e.options.stopRenderOnOffscreen&&this._containerIsOffscreen())return!0;this._updateDomPosition(t),delete this._isViewChanged,e._fireEvent("framestart"),this.updateMapDOM(),e.clearCollisionIndex();var n=this._getAllLayerToRender();this.drawLayers(n,t);var o=this.drawLayerCanvas(n);return o&&(this.drawTops(),this._drawCenterCross(),e.options.debugSky&&this._debugSky()),this._needClear=!1,e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,e.uiCollides(),!0},i.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t._getViewPointFrameOffset();e?t.offsetPlatform(e):this.domChanged()&&this.offsetPlatform(null,!0)}},i.drawLayers=function(t,e){for(var n=this.map,o=n.isInteracting(),h=[],u=[],l=n.options.fpsOnInteracting||0,f=l===0?0:1e3/l,c=this.map.options.layerCanvasLimitOnInteracting,d=t.length,g=n.getBaseLayer(),v=0,m=0;m<d;m++){var _=t[m];if(_.isVisible()){var p=_.isCanvasRender();p&&h.push(_.getId());var y=_._getRenderer();if(y){var w=this._checkLayerRedraw(_);p&&y.isCanvasUpdated()&&(w||u.push(_.getId()),this.setLayerCanvasUpdated());var C=y.__zoomTransformMatrix;if(delete y.__zoomTransformMatrix,!w){p&&o&&(n.isZooming()&&!n.getPitch()?(y.prepareRender(),y.__zoomTransformMatrix=this._zoomMatrix):(n.getPitch()||n.isRotating())&&y.clearCanvas());continue}if(o&&p){if(c>0&&d-1-m>c&&_!==g){_._getRenderer().clearCanvas();continue}v+=this._drawCanvasLayerOnInteracting(_,v,f,e)}else o&&y.drawOnInteracting?(y.prepareRender&&y.prepareRender(),y.checkAndDraw?y.checkAndDraw(y.drawOnInteracting,this._eventParam,e):y.drawOnInteracting(this._eventParam,e)):(y.render(e),p&&C&&y.isLoadingResource()&&(y.__zoomTransformMatrix=C));p&&(u.push(_.getId()),this.setLayerCanvasUpdated())}}}var x=this._canvasIds||[],M=this._updatedIds||[];if(this._canvasIds=h,this._updatedIds=u,!this.isLayerCanvasUpdated()){var S="---";(x.join(S)!==h.join(S)||M.join(S)!==u.join(S))&&this.setLayerCanvasUpdated()}},i._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,n=t._getRenderer();return t.isCanvasRender()?n.testIfNeedRedraw():n.needToRedraw&&n.needToRedraw()?!0:e.isInteracting()||this.isViewChanged()},i._drawCanvasLayerOnInteracting=function(t,e,n,o){var h=this.map,u=t._getRenderer(),l=u.getDrawTime(),f=n===0||n>0&&e+l<=n;if(u.mustRenderOnInteracting&&u.mustRenderOnInteracting())u.render(o);else{if(u.drawOnInteracting&&(t===h.getBaseLayer()||f||h.isZooming()&&t.options.forceRenderOnZooming||h.isMoving()&&t.options.forceRenderOnMoving||h.isRotating()&&t.options.forceRenderOnRotating))return u.prepareRender(),u.prepareCanvas(),u.checkAndDraw?u.checkAndDraw(u.drawOnInteracting,this._eventParam,o):u.drawOnInteracting(this._eventParam,o),l;h.isZooming()&&!h.getPitch()&&!h.isRotating()?(u.prepareRender(),u.__zoomTransformMatrix=this._zoomMatrix):(h.getPitch()||h.isRotating())&&u.clearCanvas()}return u.drawOnInteracting&&!f&&u.onSkipDrawOnInteracting(this._eventParam,o),0},i._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach(function(e){var n=t.getLayer(e);if(n){var o=n._getRenderer();!o||!o.isRenderComplete()||n.fire("layerload")}})}},i.isLayerCanvasUpdated=function(){return this._canvasUpdated},i.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},i.drawLayerCanvas=function(t){var e=this.map;if(!e||!this.isLayerCanvasUpdated()&&!this.isViewChanged()&&this._needClear===!1)return!1;this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var n=e.isInteracting(),o=e.options.layerCanvasLimitOnInteracting,h=t.length,u,l=[],f=0;f<h;f++)if(!(!t[f].isVisible()||!t[f].isCanvasRender())){var c=t[f]._getRenderer();if(c){var d=this._getLayerImage(t[f]);d&&d.image&&(t[f]===e.getBaseLayer()?u=[t[f],d]:l.push([t[f],d]))}}var g=this.canvas.width,v=this.canvas.height;u&&(this._drawLayerCanvasImage(u[0],u[1],g,v),this._drawFog()),h=l.length;for(var m=n&&o>=0&&h>o?h-o:0,_=m;_<h;_++)this._drawLayerCanvasImage(l[_][0],l[_][1],g,v);return e._fireEvent("renderend",{context:this.context}),!0},i.setToRedraw=function(){var t=this._getAllLayerToRender();this._needClear=!0;for(var e=0,n=t.length;e<n;e++){var o=t[e].getRenderer();o&&o.canvas&&o.setToRedraw&&o.setToRedraw()}},i.updateMapSize=function(t){if(!(!t||this._containerIsCanvas)){var e=t.width+"px",n=t.height+"px",o=this.map._panels;o.mapWrapper.style.width=e,o.mapWrapper.style.height=n,this._updateCanvasSize()}},i.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},i.toDataURL=function(t,e){return this.canvas?this.canvas.toDataURL(t,e):null},i.remove=function(){q.webgl&&typeof document<"u"&&(Vt.off(Ra,this._thisDocDPRChange,this),Vt.off(Aa,this._thisDocVisibilitychange,this),Vt.off(Oa,this._thisDocDragStart,this),Vt.off(Da,this._thisDocDragEnd,this)),this._resizeInterval&&clearInterval(this._resizeInterval),this._resizeObserver&&this._resizeObserver.disconnect(),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},i.hitDetect=function(t){var e=this.map;if(!(!e||!e.options.hitDetect||e.isInteracting())){var n=e._getLayers(),o="default",h=e.options.hitDetectLimit||0,u=0;t&&t._round&&t._round();for(var l=n.length-1;l>=0;l--){var f=n[l];if(!(!f.options.hitDetect||f.isEmpty&&f.isEmpty()||!f.options.geometryEvents)){var c=f._getRenderer();if(!(!c||!c.hitDetect)&&!(c.isBlank&&c.isBlank())){if(f.options.cursor!=="default"&&c.hitDetect(t)){o=f.options.cursor||"pointer";break}if(u++,h>0&&u>h)break}}}e._trySetCursor(o)}},i._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},i.initContainer=function(){var t=this.map._panels;function e(w,C,x,M){var S=V("div",C);return x&&(S.style.cssText=x),t[w]=S,M||Kh(S),S}var n=this.map._containerDOM;if(!this._containerIsCanvas){n.innerHTML="";var o="position:absolute;top:0px;left:0px;",h=e("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),u=e("allLayers","maptalks-all-layers",o+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),l=e("backStatic","maptalks-back-static",o+"z-index:0;",!0),f=e("back","maptalks-back",o+"z-index:1;"),c=e("backLayer","maptalks-back-layer",o),d=e("canvasContainer","maptalks-canvas-layer",o+"border:none;z-index:2;"),g=e("frontStatic","maptalks-front-static",o+"z-index:3;",!0),v=e("front","maptalks-front",o+"z-index:4;",!0),m=e("frontLayer","maptalks-front-layer",o+"z-index:0;"),_=e("ui","maptalks-ui",o+"border:none;z-index:1;",!0),p=e("control","maptalks-control","z-index:1",!0);n.appendChild(h),u.appendChild(l),f.appendChild(c),f.layerDOM=c,u.appendChild(f),u.appendChild(d),v.appendChild(m),v.layerDOM=m,v.uiDOM=_,u.appendChild(g),u.appendChild(v),v.appendChild(_),h.appendChild(u),h.appendChild(p),this.createCanvas(),this.resetContainer();var y=this.map._getContainerDomSize();this.updateMapSize(y)}},i.isViewChanged=function(){if(this._isViewChanged!==void 0)return this._isViewChanged;var t=this._mapview,e=this._getMapView();return this._isViewChanged=!t||!Wr(t,e),this._isViewChanged},i._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||Wr(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},i.isSpatialReferenceChanged=function(){return this._spatialRefChanged},i._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},i._frameLoop=function(t){var e=this;if(!this.map){this._cancelFrameLoop();return}t=t||0,this._frameTimestamp=t,this._resizeCount=0,this.renderFrame(t),this._animationFrame=ve(function(n){e._frameLoop(n)})},i._cancelFrameLoop=function(){this._animationFrame&&Ji(this._animationFrame)},i._drawLayerCanvasImage=function(t,e,n,o){var h=this.context,u=e.point.round(),l=this.map.getDevicePixelRatio();l!==1&&u._multi(l);var f=e.image,c=f.width,d=f.height;if(!(u.x+c<=0||u.y+d<=0)){var g=t.options.opacity;if(H(g)||(g=1),!(g<=0)){var v=e.opacity;if(H(v)||(v=1),!(v<=0)){var m=h.globalAlpha;g<1&&(h.globalAlpha*=g),v<1&&(h.globalAlpha*=v),t.options.cssFilter&&(h.filter=t.options.cssFilter);var _=t.getRenderer(),p=_.__zoomTransformMatrix,y=_.clipCanvas(this.context);p&&(h.save(),h.setTransform.apply(h,p)),h.drawImage(f,0,0,c,d,u.x,u.y,n,o),p&&h.restore(),y&&h.restore(),h.filter!=="none"&&(h.filter="none"),h.globalAlpha=m}}}},i._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,n=new E(this.canvas.width/2,this.canvas.height/2);it(t)?t(e,n):I.drawCross(this.context,n.x,n.y,2,"#f00")}},i._drawContainerExtent=function(){var t=this.map.options.cascadePitches,e=this.map.height-this.map._getVisualHeight(t[0]),n=this.map.height-this.map._getVisualHeight(t[1]),o=this.map.getContainerExtent(),h=this.context;h.beginPath(),h.moveTo(0,o.ymin),h.lineTo(o.xmax,o.ymin),h.stroke(),h.beginPath(),h.moveTo(0,e),h.lineTo(o.xmax,e),h.stroke(),h.beginPath(),h.moveTo(0,n),h.lineTo(o.xmax,n),h.stroke()},i._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch||!t.options.fog)){var e=30,n=t.getDevicePixelRatio(),o=this.context,h=t.getContainerExtent(),u=(t.height-t._getVisualHeight(75))*n;u<0&&(u=0);var l=h.ymin*n,f=Math.ceil(l-u),c=t.options.fogColor.join(),d=o.createLinearGradient(0,u,0,l+e),g=1-e/(f+e);d.addColorStop(0,"rgba("+c+", 0)"),d.addColorStop(.3,"rgba("+c+", 0.3)"),d.addColorStop(g,"rgba("+c+", 1)"),d.addColorStop(1,"rgba("+c+", 0)"),o.beginPath(),o.fillStyle=d,o.fillRect(0,u,Math.ceil(h.getWidth())*n,Math.ceil(f+e))}},i._debugSky=function(){var t=this.map;if(!t)return this;var e=t.getContainerExtent().ymin;if(e<=0)return this;var n=this.context;return n.strokeStyle="red",n.strokeRect(0,0,t.width,e),this},i._getAllLayerToRender=function(){return this.map._getLayers()},i.clearCanvas=function(){this.canvas&&I.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},i._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),n=this.canvas,o=t.getDevicePixelRatio(),h=Wa(e,o),u=h.width,l=h.height,f=h.cssWidth,c=h.cssHeight;return n.style&&(n.style.width!==f||n.style.height!==c)&&(n.style.width=f,n.style.height=c),u===n.width&&l===n.height?!1:(n.height=l,n.width=u,this.topLayer.width=n.width,this.topLayer.height=n.height,!0)},i.createCanvas=function(){this.topLayer=V("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=V("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},i._updateDomPosition=function(t){this._checkPositionTime===void 0&&(this._checkPositionTime=-1/0);var e=Math.abs(t-this._checkPositionTime);return e>=500&&(fr(this.map._containerDOM),this._checkPositionTime=Math.min(t,this._checkPositionTime)),this},i._handleResizeEventList=function(t){if(!this._resizeEventList)return this;var e=this._resizeEventList.length;if(e===0)return this;if(this._resizeTime&&t-this._resizeTime<60)return this;var n=this._resizeEventList[e-1].contentRect;return this.map._containerDomContentRect=n,this._resizeEventList=[],this._checkSize(n),this._resizeCount=this._resizeCount||0,this.renderFrame((this._frameTimestamp||0)+ ++this._resizeCount/100),this._resizeTime=t,this},i._checkSize=function(){this.map&&this.map.checkSize()},i._setCheckSizeInterval=function(t){var e=this;q.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver(function(n){!e.map||e.map.isRemoved()?e._resizeObserver.disconnect():n.length&&(e._resizeEventList=e._resizeEventList||[],e._resizeEventList.push(n[0]))}),this._resizeObserver.observe(this.map._containerDOM))):(clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval(function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()},this._checkSizeInterval))},i._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!bt&&typeof window<"u"&&this._setCheckSizeInterval(e.options.checkSizeInterval),q.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",function(n){t._eventParam=n}),e.on("_zooming",function(n){e.getPitch()||(t._zoomMatrix=n.matrix.container),t._eventParam=n}),e.on("_zoomend",function(n){t._eventParam=n,delete t._zoomMatrix}),e.on("_spatialreferencechange",function(){t._spatialRefChanged=!0}),q.webgl&&typeof document<"u"&&(Vt.on(Ra,this._thisDocDPRChange,this),Vt.on(Aa,this._thisDocVisibilitychange,this),Vt.on(Oa,this._thisDocDragStart,this),Vt.on(Da,this._thisDocDragEnd,this))},i._onMapMouseMove=function(t){var e=this,n=this.map;n.isInteracting()||!n.options.hitDetect||(this._hitDetectFrame&&Ji(this._hitDetectFrame),this._hitDetectFrame=ve(function(){e.hitDetect(t.containerPoint)}))},i._getCanvasLayers=function(){return this.map._getLayers(function(t){return t.isCanvasRender()})},i.addTopElement=function(t){this._tops||(this._tops=[]),this._tops.push(t)},i.removeTopElement=function(t){if(this._tops){var e=this._tops.indexOf(t);e>=0&&this._tops.splice(e,1)}},i.getTopElements=function(){return this._tops||[]},i.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height);var t=Ov;t.clear(),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var e=this.getTopElements(),n=!1,o=this.map.getDevicePixelRatio(),h=[],u=0;u<e.length;u++){var l=e[u];if(l.needCollision&&l.needCollision()){var f=l.getRenderBBOX(o);if(f)if(t.collides(f)){var c=l.target&&l.target._geometry;c&&h.indexOf(c)===-1&&(h.push(c),c.fire("handlecollision"));continue}else t.insertBox(f)}l.render(this.topCtx)&&(n=!0)}n&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},a}(Rl);$.registerRenderer("canvas",Al);$.mergeOptions({fog:!1,fogColor:[233,233,233]});var Wv=Object.freeze({ResourceCache:Xe,CanvasRenderer:Ci,ImageGLRenderable:js,MapRenderer:Rl,MapCanvasRenderer:Al,Renderable:cs,ImageLayerCanvasRenderer:Fs,ImageLayerGLRenderer:xl,TileLayerCanvasRenderer:Sn,TileLayerGLRenderer:Bs,CanvasTileLayerCanvasRenderer:Ml,CanvasTileLayerGLRenderer:Sl,QuadStencil:bv,OverlayLayerCanvasRenderer:bl,VectorLayerCanvasRenderer:El,CanvasLayerRenderer:Hs}),bn={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};wt.include(bn);pe.include(bn);re.include(bn);Pi.include(bn);_i.include({_getRenderPoints:function(a){var i=this.getMap(),r=i.getGLRes();if(a==="vertex"){for(var t=this._trimRing(this.getShell()),e=[],n=0,o=t.length;n<o;n++)e.push(i.coordToPointAtRes(t[n],r));return[e,null]}else{var h=i.coordToPointAtRes(this.getCenter(),r);return[[h],null]}}});var Ol={_getRenderPoints:function(a){var i=this.getMap(),r=i.getGLRes(),t,e=null;if(a==="point")t=this._getPath2DPoints(this._getPrjCoordinates(),!1,r),t&&t.length>0&&Array.isArray(t[0])&&(t=t[0].concat(t[1]));else if(a==="vertex")if(t=this._getPath2DPoints(this._getPrjCoordinates(),!1,r),e=[],t&&t.length>0&&Array.isArray(t[0])){for(var n=0,o=t.length;n<o;n++)for(var h=0,u=t[n].length;h<u;h++)h===0?e.push([t[n][h],t[n][h+1]]):e.push([t[n][h-1],t[n][h]]);t=t[0].concat(t[1])}else for(var l=0,f=t.length;l<f;l++)l===0?e.push([t[l],t[l+1]]):e.push([t[l-1],t[l]]);else if(a==="line"){t=[],e=[];var c=this._getPath2DPoints(this._getPrjCoordinates(),!1,r),d=c.length>0&&Array.isArray(c[0]);if(d)for(var g,v=1,m=c.length;v<m;v++){g=c[v],this instanceof Ct&&g.length>0&&!g[0].equals(g[g.length-1])&&g.push(g[0]);for(var _=1,p=g.length;_<p;_++)t.push(g[_].add(g[_-1])._multi(.5)),e.push([g[_-1],g[_]])}else{this instanceof Ct&&c.length>0&&!c[0].equals(c[c.length-1])&&c.push(c[0]);for(var y=1,w=c.length;y<w;y++)t.push(c[y].add(c[y-1])._multi(.5)),e.push([c[y-1],c[y]])}}else if(a==="vertex-first"){var C=this._getPrjCoordinates(),x=C.length,M=x?i._prjToPointAtRes(C[0],r):null;t=x?[M]:[],e=x?[[M,C[1]?i._prjToPointAtRes(C[1],r):M]]:[]}else if(a==="vertex-last"){var S=this._getPrjCoordinates(),T=S.length,b=T?i._prjToPointAtRes(S[T-1],r):null;t=T?[b]:[];var D=T>1?T-2:T-1;e=T?[[S[D]?i._prjToPointAtRes(S[D],r):b,b]]:[]}else{var R=this.getCenter();if(!R)t=[];else{var k=this._getProjection().project(R);t=[i._prjToPointAtRes(k,r)]}}return[t,e]}};yt.include(Ol);Ct.include(Ol);var li={within:!1,center:[0,0]};function Dl(s){if(!s||!s._containerBbox)li.within=!1;else{li.within=!1;var a=s._containerBbox,i=a.minx,r=a.miny,t=a.maxx,e=a.maxy,n=Math.abs(t-i),o=Math.abs(e-r);n<=1&&o<=1&&(li.within=!0,li.center[0]=(i+t)/2,li.center[1]=(r+e)/2),delete s._containerBbox}return li}ot.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1},_getRenderBBOX:function(a,i){return a.isHitTesting?null:(nr(di),pn(i,di),di)}});function kl(){var s=this._getPrjShell(),a=qe();pn(s,a);var i=a[0],r=a[1],t=a[2],e=a[3];return new ft(i,r,t,e)}function Ll(){var s=this._getPrjShell();if(!s||!Array.isArray(s))return[];var a=this._getProjection(),i=this.getCoordinates()||{};return s.map(function(r){var t=a.unproject(r);return t.z=i.z||0,t})}var Zs={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof pe||this instanceof Pi},_computeRotatedPrjExtent:kl,getRotatedShell:Ll,_paintAsPath:function(){if(this.isRotated())return!0;var a=this.getMap(),i=this._getAltitude();return i>0||a.getPitch()||this instanceof pe&&a.getBearing()},_getPaintParams:function(){var a=this.getMap();if(this._paintAsPath())return Ct.prototype._getPaintParams.call(this,!0);var i=this._getPrjCoordinates(),r=a._prjToPointAtRes(i,a.getGLRes()),t=this._getRenderSize(r);return[r].concat(t)},_paintOn:function(){return this._paintAsPath()?I.polygon.apply(I,arguments):I.ellipse.apply(I,arguments)},_getRenderSize:function(a){var i=this.getMap(),r=i.getGLRes(),t=this._getPrjExtent(),e=i._prjToPointAtRes(t.getMin(),r),n=i._prjToPointAtRes(t.getMax(),r);return[Math.abs(n.x-e.x)/2,Math.abs(n.y-a.y),Math.abs(a.y-e.y)]}};pe.include(Zs);re.include(Zs);_i.include({_getPaintParams:function(){var a=this.getMap(),i=this._getPrjShell(),r=this._getPath2DPoints(i,!1,a.getGLRes());return[r]},_paintOn:I.polygon,_computeRotatedPrjExtent:kl,getRotatedShell:Ll});Pi.include(Zs,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return Ct.prototype._getPaintParams.call(this,!0);var a=this.getMap(),i=a._prjToPointAtRes(this._getPrjCoordinates(),a.getGLRes()),r=this._getRenderSize(i);return[i,r[0],[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return I.polygon.apply(I,arguments);var a=this.getMap().getBearing(),i=arguments;return a&&(i[3]=i[3].slice(0),i[3][0]+=a,i[3][1]+=a),I.sector.apply(I,i)}});Pn.include({_paintAsPath:function(){return!0}});yt.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(a,i,r,t,e){if(!a||!i||a.equals(i))return null;e||(e=0);var n=r*t[0],o=r*t[1]+e,h=n/2+e,u;i.nextCtrlPoint||i.prevCtrlPoint?i.prevCtrlPoint?u=i.sub(new E(i.prevCtrlPoint)):u=i.sub(new E(i.nextCtrlPoint)):u=i.sub(a),u._unit();var l=i.sub(u.multi(o));u._perp();var f=l.add(u.multi(h));u._multi(-1);var c=l.add(u.multi(h));return[f,i,c,f]},_getPaintParams:function(){var a=this._getPrjCoordinates(),i=this._getPath2DPoints(a,!1,this.getMap().getGLRes());return[i]},_paintOn:function(a,i,r,t,e){var n=Dl(this._painter);return n.within?I.pixelRect(a,n.center,r,t):this.options.smoothness?I.paintSmoothLine(a,i,r,this.options.smoothness,!1,this._animIdx,this._animTailRatio):I.path(a,i,r,null,e),this._paintArrow(a,i,r),this._getRenderBBOX(a,i)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var a=this.options.arrowStyle;return a?Array.isArray(a)?a:this.arrowStyles[a]:null},_getArrows:function(a,i,r){var t=this._getArrowStyle();if(!t||a.length<2)return[];for(var e=a.length>0&&Array.isArray(a[0]),n=e?a:[a],o=this._getArrowPlacement(),h=[],u=this.getMap(),l=u.coordToContainerPoint(this.getFirstCoordinate()),f=u.coordToContainerPoint(this.getLastCoordinate()),c=n.length-1;c>=0;c--){if(o==="vertex-first"||o==="vertex-firstlast"&&n[c][0].closeTo(l,.01)){var d=this._getArrowShape(n[c][1],n[c][0],i,t,r);d&&h.push(d)}if(o==="vertex-last"||o==="vertex-firstlast"&&n[c][n[c].length-1].closeTo(f,.01)){var g=this._getArrowShape(n[c][n[c].length-2],n[c][n[c].length-1],i,t,r);g&&h.push(g)}else o==="point"&&this._getArrowPoints(h,n[c],i,t,r)}return h},_getArrowPoints:function(a,i,r,t,e){for(var n=0,o=i.length-1;n<o;n++){var h=this._getArrowShape(i[n],i[n+1],r,t,e);h&&a.push(h)}},_paintArrow:function(a,i,r){var t=this._getInternalSymbol().lineWidth;(!H(t)||t<3)&&(t=3);var e=this._getArrows(i,t);if(e.length){a.setLineDash&&a.setLineDash([]);for(var n=e.length-1;n>=0;n--)a.fillStyle=a.strokeStyle,I.polygon(a,e[n],r,r)}}});Ct.include({_getPaintParams:function(a){var i=this.getMap().getGLRes(),r=this._getPrjShell(),t=this._getPath2DPoints(r,a,i),e=t.length>0&&Array.isArray(t[0]);e&&(t=[[t[0]],[t[1]]]);var n=this._getPrjHoles(),o=[];if(n&&n.length>0){for(var h=this._simplified,u=0;u<n.length;u++){var l=this._getPath2DPoints(n[u],a,i);Array.isArray(l)&&e?Array.isArray(l[0])?(t[0].push(l[0]),t[1].push(l[1])):t[0].push(l):o.push(l)}h&&(this._simplified=h)}return e||(t=[t],ie(t,o)),[t]},_paintOn:function(a,i,r,t,e){var n=Dl(this._painter);return n.within?I.pixelRect(a,n.center,r,t):I.polygon(a,i,r,t,e,this.options.smoothness),this._getRenderBBOX(a,i)}});$.VERSION=Bl;var Vv={Actor:wn};export{Ft as Ajax,il as ArcConnectorLine,Tn as ArcCurve,mg as AreaTool,q as Browser,Vl as COLOR_PROPERTIES,Lt as CRS,I as Canvas,Ns as CanvasLayer,zs as CanvasTileLayer,re as Circle,Bt as Class,dr as CollisionIndex,nn as ConnectorLine,L as Coordinate,Qu as CubicBezierCurve,vr as Curve,Oh as DEFAULT_TEXT_SIZE,ol as DistanceTool,jv as DomUtil,gr as DragHandler,Rt as DrawTool,pe as Ellipse,le as Eventable,ft as Extent,Rh as GEOJSON_TYPES,Eh as GEOMETRY_COLLECTION_TYPES,Ut as GeoJSON,ot as Geometry,sr as GeometryCollection,Qt as GlobalConfig,Vt as GlobalEvent,_l as GroupTileLayer,ae as Handler,os as Handlerable,or as INTERNAL_LAYER_PREFIX,Gs as ImageLayer,wu as JSONAble,gu as LRUCache,pi as Label,It as Layer,yt as LineString,$ as Map,Uo as MapTool,Lv as MapboxUtil,wt as Marker,Gv as MicroTask,en as MultiLineString,tn as MultiPoint,$u as MultiPolygon,Wl as NUMERICAL_PROPERTIES,rl as OverlayLayer,Cl as ParticleLayer,E as Point,Q as PointExtent,Ct as Polygon,rr as Promise,Ku as QuadBezierCurve,Ah as RESOURCE_PROPERTIES,Zl as RESOURCE_SIZE_PROPERTIES,_i as Rectangle,Pi as Sector,xt as Size,oe as SpatialReference,Iv as StringUtil,rn as TextBox,Ts as TextMarker,fh as TileConfig,te as TileLayer,Oe as TileSystem,xu as Transformation,zv as Util,ye as VectorLayer,Is as WMSTileLayer,pd as animate,Nv as animation,Zv as control,Fv as measurer,ce as projection,uu as registerWorkerAdapter,Wv as renderer,Hv as symbolizer,Bv as ui,Vv as worker};
