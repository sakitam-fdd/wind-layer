import{a as yt,e as Gt,m as U,c as it,g as W}from"./math.E5ukR3YQ.js";import{T as p,c as rt,L as Mt,d as Xt,e as st,t as G,s as Zt}from"./TileRange.DvsT0Zm5.js";import{g as bt,h as zt,D as Et,c as Dt,j as Ut}from"./easing.BmLONCSm.js";import{B as Wt,a as z,b as Yt,j as gt,c as nt,l as Ft,E as wt}from"./Object.BbzoBtIW.js";import{C as Y,v as Kt,n as j,r as ot,o as at,f as xt,N as Nt,O as pt,y as Ct,D as kt,k as qt,p as $t,j as Ht,P as dt,m as Qt,t as V,g as J,Q as vt,l as Bt,a as X,u as lt,M as Vt,U as Jt,S as te,T as ee,z as Z}from"./proj.Cr1UOlyj.js";import{S as ie}from"./State.DdpVcuyW.js";var re=function(n){function t(e){n.call(this),this.projection_=Y(e.projection),this.attributions_=_t(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:ie.READY,this.wrapX_=e.wrapX!==void 0?e.wrapX:!1}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.getAttributions=function(){return this.attributions_},t.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},t.prototype.getProjection=function(){return this.projection_},t.prototype.getResolutions=function(){return yt()},t.prototype.getState=function(){return this.state_},t.prototype.getWrapX=function(){return this.wrapX_},t.prototype.refresh=function(){this.changed()},t.prototype.setAttributions=function(i){this.attributions_=_t(i),this.changed()},t.prototype.setState=function(i){this.state_=i,this.changed()},t}(Wt);function _t(n){return n?Array.isArray(n)?function(t){return n}:typeof n=="function"?n:function(t){return[n]}:null}const ne=re;var oe=.5,se=function(n){function t(e,i,r){n.call(this);var o=r||{};this.tileCoord=e,this.state=i,this.interimTile=null,this.key="",this.transition_=o.transition===void 0?250:o.transition,this.transitionStarts_={}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.changed=function(){this.dispatchEvent(z.CHANGE)},t.prototype.getKey=function(){return this.key+"/"+this.tileCoord},t.prototype.getInterimTile=function(){if(!this.interimTile)return this;var i=this.interimTile;do{if(i.getState()==p.LOADED)return i;i=i.interimTile}while(i);return this},t.prototype.refreshInterimChain=function(){if(this.interimTile){var i=this.interimTile,r=this;do{if(i.getState()==p.LOADED){i.interimTile=null;break}else i.getState()==p.LOADING?r=i:i.getState()==p.IDLE?r.interimTile=i.interimTile:r=i;i=r.interimTile}while(i)}},t.prototype.getTileCoord=function(){return this.tileCoord},t.prototype.getState=function(){return this.state},t.prototype.setState=function(i){this.state=i,this.changed()},t.prototype.load=function(){},t.prototype.getAlpha=function(i,r){if(!this.transition_)return 1;var o=this.transitionStarts_[i];if(!o)o=r,this.transitionStarts_[i]=o;else if(o===-1)return 1;var s=r-o+1e3/60;return s>=this.transition_?1:bt(s/this.transition_)},t.prototype.inTransition=function(i){return this.transition_?this.transitionStarts_[i]!==-1:!1},t.prototype.endTransition=function(i){this.transition_&&(this.transitionStarts_[i]=-1)},t}(Yt);const Rt=se;var ae=function(n){function t(e,i,r,o,s,a){n.call(this,e,i,a),this.crossOrigin_=o,this.src_=r,this.image_=new Image,o!==null&&(this.image_.crossOrigin=o),this.imageListenerKeys_=null,this.tileLoadFunction_=s}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.disposeInternal=function(){this.state==p.LOADING&&(this.unlistenImage_(),this.image_=Tt()),this.interimTile&&this.interimTile.dispose(),this.state=p.ABORT,this.changed(),n.prototype.disposeInternal.call(this)},t.prototype.getImage=function(){return this.image_},t.prototype.getKey=function(){return this.src_},t.prototype.handleImageError_=function(){this.state=p.ERROR,this.unlistenImage_(),this.image_=Tt(),this.changed()},t.prototype.handleImageLoad_=function(){var i=this.image_;i.naturalWidth&&i.naturalHeight?this.state=p.LOADED:this.state=p.EMPTY,this.unlistenImage_(),this.changed()},t.prototype.load=function(){this.state==p.ERROR&&(this.state=p.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==p.IDLE&&(this.state=p.LOADING,this.changed(),this.imageListenerKeys_=[gt(this.image_,z.ERROR,this.handleImageError_,this),gt(this.image_,z.LOAD,this.handleImageLoad_,this)],this.tileLoadFunction_(this,this.src_))},t.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(nt),this.imageListenerKeys_=null},t}(Rt);function Tt(){var n=rt(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}const le=ae;function Pt(n,t,e,i){return i!==void 0?(i[0]=n,i[1]=t,i[2]=e,i):[n,t,e]}function w(n,t,e){return n+"/"+t+"/"+e}function St(n){return w(n[0],n[1],n[2])}function ue(n){return n.split("/").map(Number)}function he(n){return(n[1]<<n[0])+n[2]}function ce(n,t){var e=n[0],i=n[1],r=n[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;var o=t.getExtent(),s;return o?s=t.getTileRangeForExtentAndZ(o,e):s=t.getFullTileRange(e),s?s.containsXY(i,r):!0}var fe=function(n){function t(e){n.call(this,e)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.expireCache=function(i){for(;this.canExpireCache();){var r=this.peekLast(),o=r.tileCoord[0].toString();if(o in i&&i[o].contains(r.tileCoord))break;this.pop().dispose()}},t.prototype.pruneExceptNewestZ=function(){if(this.getCount()!==0){var i=this.peekFirstKey(),r=ue(i),o=r[0];this.forEach(function(s){s.tileCoord[0]!==o&&(this.remove(St(s.tileCoord)),s.dispose())},this)}},t}(Mt);const It=fe;function ge(n,t,e,i){var r=Nt(e,t,n),o=pt(t,i,e),s=t.getMetersPerUnit();s!==void 0&&(o*=s);var a=n.getMetersPerUnit();a!==void 0&&(o/=a);var l=n.getExtent();if(!l||Ct(l,r)){var h=pt(n,o,r)/o;isFinite(h)&&h>0&&(o/=h)}return o}function tt(n,t,e,i){var r=e-n,o=i-t,s=Math.sqrt(r*r+o*o);return[Math.round(e+r/s),Math.round(i+o/s)]}function pe(n,t,e,i,r,o,s,a,l,h,c){var u=rt(Math.round(e*n),Math.round(e*t));if(l.length===0)return u.canvas;u.scale(e,e);var d=xt();l.forEach(function(g,x,R){Kt(d,g.extent)});var _=j(d),v=ot(d),T=rt(Math.round(e*_/i),Math.round(e*v/i)),F=e/i;l.forEach(function(g,x,R){var y=g.extent[0]-d[0],E=-(g.extent[3]-d[3]),C=j(g.extent),P=ot(g.extent);T.drawImage(g.image,h,h,g.image.width-2*h,g.image.height-2*h,y*F,E*F,C*F,P*F)});var f=at(s);return a.getTriangles().forEach(function(g,x,R){var y=g.source,E=g.target,C=y[0][0],P=y[0][1],S=y[1][0],I=y[1][1],O=y[2][0],M=y[2][1],L=(E[0][0]-f[0])/o,A=-(E[0][1]-f[1])/o,K=(E[1][0]-f[0])/o,N=-(E[1][1]-f[1])/o,k=(E[2][0]-f[0])/o,q=-(E[2][1]-f[1])/o,$=C,H=P;C=0,P=0,S-=$,I-=H,O-=$,M-=H;var At=[[S,I,0,0,K-L],[O,M,0,0,k-L],[0,0,S,I,N-A],[0,0,O,M,q-A]],b=Gt(At);if(b){u.save(),u.beginPath();var Q=(L+K+k)/3,B=(A+N+q)/3,ht=tt(Q,B,L,A),ct=tt(Q,B,K,N),ft=tt(Q,B,k,q);u.moveTo(ct[0],ct[1]),u.lineTo(ht[0],ht[1]),u.lineTo(ft[0],ft[1]),u.clip(),u.transform(b[0],b[2],b[1],b[3],L,A),u.translate(d[0]-$,d[3]-H),u.scale(i/e,-i/e),u.drawImage(T.canvas,0,0),u.restore()}}),c&&(u.save(),u.strokeStyle="black",u.lineWidth=1,a.getTriangles().forEach(function(g,x,R){var y=g.target,E=(y[0][0]-f[0])/o,C=-(y[0][1]-f[1])/o,P=(y[1][0]-f[0])/o,S=-(y[1][1]-f[1])/o,I=(y[2][0]-f[0])/o,O=-(y[2][1]-f[1])/o;u.beginPath(),u.moveTo(P,S),u.lineTo(E,C),u.lineTo(I,O),u.closePath(),u.stroke()}),u.restore()),u.canvas}var de=10,mt=.25,D=function(t,e,i,r,o){this.sourceProj_=t,this.targetProj_=e;var s={},a=kt(this.targetProj_,this.sourceProj_);this.transformInv_=function(f){var g=f[0]+"/"+f[1];return s[g]||(s[g]=a(f)),s[g]},this.maxSourceExtent_=r,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&j(r)==j(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?j(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?j(this.targetProj_.getExtent()):null;var l=at(i),h=qt(i),c=$t(i),u=Ht(i),d=this.transformInv_(l),_=this.transformInv_(h),v=this.transformInv_(c),T=this.transformInv_(u);if(this.addQuad_(l,h,c,u,d,_,v,T,de),this.wrapsXInSource_){var F=1/0;this.triangles_.forEach(function(f,g,x){F=Math.min(F,f.source[0][0],f.source[1][0],f.source[2][0])}),this.triangles_.forEach((function(f){if(Math.max(f.source[0][0],f.source[1][0],f.source[2][0])-F>this.sourceWorldWidth_/2){var g=[[f.source[0][0],f.source[0][1]],[f.source[1][0],f.source[1][1]],[f.source[2][0],f.source[2][1]]];g[0][0]-F>this.sourceWorldWidth_/2&&(g[0][0]-=this.sourceWorldWidth_),g[1][0]-F>this.sourceWorldWidth_/2&&(g[1][0]-=this.sourceWorldWidth_),g[2][0]-F>this.sourceWorldWidth_/2&&(g[2][0]-=this.sourceWorldWidth_);var x=Math.min(g[0][0],g[1][0],g[2][0]),R=Math.max(g[0][0],g[1][0],g[2][0]);R-x<this.sourceWorldWidth_/2&&(f.source=g)}}).bind(this))}s={}};D.prototype.addTriangle_=function(t,e,i,r,o,s){this.triangles_.push({source:[r,o,s],target:[t,e,i]})};D.prototype.addQuad_=function(t,e,i,r,o,s,a,l,h){var c=dt([o,s,a,l]),u=this.sourceWorldWidth_?j(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,_=this.sourceProj_.canWrapX()&&u>.5&&u<1,v=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var T=dt([t,e,i,r]),F=j(T)/this.targetWorldWidth_;v=F>mt||v}!_&&this.sourceProj_.isGlobal()&&u&&(v=u>mt||v)}if(!(!v&&this.maxSourceExtent_&&!Qt(c,this.maxSourceExtent_))){if(!v&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1])))if(h>0)v=!0;else return;if(h>0){if(!v){var f=[(t[0]+i[0])/2,(t[1]+i[1])/2],g=this.transformInv_(f),x;if(_){var R=(U(o[0],d)+U(a[0],d))/2;x=R-U(g[0],d)}else x=(o[0]+a[0])/2-g[0];var y=(o[1]+a[1])/2-g[1],E=x*x+y*y;v=E>this.errorThresholdSquared_}if(v){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){var C=[(e[0]+i[0])/2,(e[1]+i[1])/2],P=this.transformInv_(C),S=[(r[0]+t[0])/2,(r[1]+t[1])/2],I=this.transformInv_(S);this.addQuad_(t,e,C,S,o,s,P,I,h-1),this.addQuad_(S,C,i,r,I,P,a,l,h-1)}else{var O=[(t[0]+e[0])/2,(t[1]+e[1])/2],M=this.transformInv_(O),L=[(i[0]+r[0])/2,(i[1]+r[1])/2],A=this.transformInv_(L);this.addQuad_(t,O,L,r,o,M,A,l,h-1),this.addQuad_(O,e,i,L,M,s,a,A,h-1)}return}}if(_){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,i,r,o,a,l),this.addTriangle_(t,e,i,o,s,a)}};D.prototype.calculateSourceExtent=function(){var t=xt();return this.triangles_.forEach(function(e,i,r){var o=e.source;V(t,o[0]),V(t,o[1]),V(t,o[2])}),t};D.prototype.getTriangles=function(){return this.triangles_};var ve=function(n){function t(e,i,r,o,s,a,l,h,c,u,d){n.call(this,s,p.IDLE),this.renderEdges_=d!==void 0?d:!1,this.pixelRatio_=l,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=i,this.targetTileGrid_=o,this.wrappedTileCoord_=a||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;var _=o.getTileCoordExtent(this.wrappedTileCoord_),v=this.targetTileGrid_.getExtent(),T=this.sourceTileGrid_.getExtent(),F=v?J(_,v):_;if(vt(F)===0){this.state=p.EMPTY;return}var f=e.getExtent();f&&(T?T=J(T,f):T=f);var g=o.getResolution(this.wrappedTileCoord_[0]),x=Bt(F),R=ge(e,r,x,g);if(!isFinite(R)||R<=0){this.state=p.EMPTY;return}var y=u!==void 0?u:oe;if(this.triangulation_=new D(e,r,F,T,R*y),this.triangulation_.getTriangles().length===0){this.state=p.EMPTY;return}this.sourceZ_=i.getZForResolution(R);var E=this.triangulation_.calculateSourceExtent();if(T&&(e.canWrapX()?(E[1]=it(E[1],T[1],T[3]),E[3]=it(E[3],T[1],T[3])):E=J(E,T)),!vt(E))this.state=p.EMPTY;else{for(var C=i.getTileRangeForExtentAndZ(E,this.sourceZ_),P=C.minX;P<=C.maxX;P++)for(var S=C.minY;S<=C.maxY;S++){var I=c(this.sourceZ_,P,S,l);I&&this.sourceTiles_.push(I)}this.sourceTiles_.length===0&&(this.state=p.EMPTY)}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.disposeInternal=function(){this.state==p.LOADING&&this.unlistenSources_(),n.prototype.disposeInternal.call(this)},t.prototype.getImage=function(){return this.canvas_},t.prototype.reproject_=function(){var i=[];if(this.sourceTiles_.forEach((function(u,d,_){u&&u.getState()==p.LOADED&&i.push({extent:this.sourceTileGrid_.getTileCoordExtent(u.tileCoord),image:u.getImage()})}).bind(this)),this.sourceTiles_.length=0,i.length===0)this.state=p.ERROR;else{var r=this.wrappedTileCoord_[0],o=this.targetTileGrid_.getTileSize(r),s=typeof o=="number"?o:o[0],a=typeof o=="number"?o:o[1],l=this.targetTileGrid_.getResolution(r),h=this.sourceTileGrid_.getResolution(this.sourceZ_),c=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=pe(s,a,this.pixelRatio_,h,this.sourceTileGrid_.getExtent(),l,c,this.triangulation_,i,this.gutter_,this.renderEdges_),this.state=p.LOADED}this.changed()},t.prototype.load=function(){if(this.state==p.IDLE){this.state=p.LOADING,this.changed();var i=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((function(r,o,s){var a=r.getState();if(a==p.IDLE||a==p.LOADING){i++;var l=Ft(r,z.CHANGE,function(h){var c=r.getState();(c==p.LOADED||c==p.ERROR||c==p.EMPTY)&&(nt(l),i--,i===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(l)}}).bind(this)),this.sourceTiles_.forEach(function(r,o,s){var a=r.getState();a==p.IDLE&&r.load()}),i===0&&setTimeout(this.reproject_.bind(this),0)}},t.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(nt),this.sourcesListenerKeys_=null},t}(Rt);const _e=ve;function Te(n,t){var e=/\{z\}/g,i=/\{x\}/g,r=/\{y\}/g,o=/\{-y\}/g;return function(s,a,l){if(s)return n.replace(e,s[0].toString()).replace(i,s[1].toString()).replace(r,function(){var h=-s[2]-1;return h.toString()}).replace(o,function(){var h=s[0],c=t.getFullTileRange(h);X(c,55);var u=c.getHeight()+s[2];return u.toString()})}}function me(n,t){for(var e=n.length,i=new Array(e),r=0;r<e;++r)i[r]=Te(n[r],t);return ye(i)}function ye(n){return n.length===1?n[0]:function(t,e,i){if(t){var r=he(t),o=U(r,n.length);return n[o](t,e,i)}else return}}function Ee(n,t,e){}function Fe(n){var t=[],e=/\{([a-z])-([a-z])\}/.exec(n);if(e){var i=e[1].charCodeAt(0),r=e[2].charCodeAt(0),o;for(o=i;o<=r;++o)t.push(n.replace(e[0],String.fromCharCode(o)));return t}if(e=e=/\{(\d+)-(\d+)\}/.exec(n),e){for(var s=parseInt(e[2],10),a=parseInt(e[1],10);a<=s;a++)t.push(n.replace(e[0],a.toString()));return t}return t.push(n),t}var xe=[0,0,0],m=function(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,X(zt(this.resolutions_,function(s,a){return a-s},!0),17);var e;if(!t.origins){for(var i=0,r=this.resolutions_.length-1;i<r;++i)if(!e)e=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,X(this.origins_.length==this.resolutions_.length,20));var o=t.extent;o!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=at(o)),X(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,X(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Et,X(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=o!==void 0?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(s,a){var l=new Xt(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));return l},this):o&&this.calculateTileRanges_(o)};m.prototype.forEachTileCoord=function(t,e,i){for(var r=this.getTileRangeForExtentAndZ(t,e),o=r.minX,s=r.maxX;o<=s;++o)for(var a=r.minY,l=r.maxY;a<=l;++a)i([e,o,a])};m.prototype.forEachTileCoordParentTileRange=function(t,e,i,r,o){var s,a,l,h=null,c=t[0]-1;for(this.zoomFactor_===2?(a=t[1],l=t[2]):h=this.getTileCoordExtent(t,o);c>=this.minZoom;){if(this.zoomFactor_===2?(a=Math.floor(a/2),l=Math.floor(l/2),s=st(a,a,l,l,r)):s=this.getTileRangeForExtentAndZ(h,c,r),e.call(i,c,s))return!0;--c}return!1};m.prototype.getExtent=function(){return this.extent_};m.prototype.getMaxZoom=function(){return this.maxZoom};m.prototype.getMinZoom=function(){return this.minZoom};m.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]};m.prototype.getResolution=function(t){return this.resolutions_[t]};m.prototype.getResolutions=function(){return this.resolutions_};m.prototype.getTileCoordChildTileRange=function(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){var r=t[1]*2,o=t[2]*2;return st(r,r+1,o,o+1,e)}var s=this.getTileCoordExtent(t,i);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null};m.prototype.getTileRangeExtent=function(t,e,i){var r=this.getOrigin(t),o=this.getResolution(t),s=G(this.getTileSize(t),this.tmpSize_),a=r[0]+e.minX*s[0]*o,l=r[0]+(e.maxX+1)*s[0]*o,h=r[1]+e.minY*s[1]*o,c=r[1]+(e.maxY+1)*s[1]*o;return lt(a,h,l,c,i)};m.prototype.getTileRangeForExtentAndZ=function(t,e,i){var r=xe;this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r);var o=r[1],s=r[2];return this.getTileCoordForXYAndZ_(t[2],t[3],e,!0,r),st(o,r[1],s,r[2],i)};m.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=G(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]+(t[2]+.5)*r[1]*i]};m.prototype.getTileCoordExtent=function(t,e){var i=this.getOrigin(t[0]),r=this.getResolution(t[0]),o=G(this.getTileSize(t[0]),this.tmpSize_),s=i[0]+t[1]*o[0]*r,a=i[1]+t[2]*o[1]*r,l=s+o[0]*r,h=a+o[1]*r;return lt(s,a,l,h,e)};m.prototype.getTileCoordForCoordAndResolution=function(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)};m.prototype.getTileCoordForXYAndResolution_=function(t,e,i,r,o){var s=this.getZForResolution(i),a=i/this.getResolution(s),l=this.getOrigin(s),h=G(this.getTileSize(s),this.tmpSize_),c=r?.5:0,u=r?0:.5,d=Math.floor((t-l[0])/i+c),_=Math.floor((e-l[1])/i+u),v=a*d/h[0],T=a*_/h[1];return r?(v=Math.ceil(v)-1,T=Math.ceil(T)-1):(v=Math.floor(v),T=Math.floor(T)),Pt(s,v,T,o)};m.prototype.getTileCoordForXYAndZ_=function(t,e,i,r,o){var s=this.getOrigin(i),a=this.getResolution(i),l=G(this.getTileSize(i),this.tmpSize_),h=r?.5:0,c=r?0:.5,u=Math.floor((t-s[0])/a+h),d=Math.floor((e-s[1])/a+c),_=u/l[0],v=d/l[1];return r?(_=Math.ceil(_)-1,v=Math.ceil(v)-1):(_=Math.floor(_),v=Math.floor(v)),Pt(i,_,v,o)};m.prototype.getTileCoordForCoordAndZ=function(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)};m.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]};m.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]};m.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null};m.prototype.getZForResolution=function(t,e){var i=Dt(this.resolutions_,t,e||0);return it(i,this.minZoom,this.maxZoom)};m.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,i=new Array(e),r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i};const jt=m;function Ot(n){var t=n.getDefaultTileGrid();return t||(t=Se(n),n.setDefaultTileGrid(t)),t}function Ce(n,t,e){var i=t[0],r=n.getTileCoordCenter(t),o=ut(e);if(Ct(o,r))return t;var s=j(o),a=Math.ceil((o[0]-r[0])/s);return r[0]+=s*a,n.getTileCoordForCoordAndZ(r,i)}function Re(n,t,e,i){var r=i!==void 0?i:ee.TOP_LEFT,o=Lt(n,t,e);return new jt({extent:n,origin:te(n,r),resolutions:o,tileSize:e})}function Pe(n){var t=n||{},e=t.extent||Y("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Lt(e,t.maxZoom,t.tileSize)};return new jt(i)}function Lt(n,t,e){for(var i=t!==void 0?t:Ut,r=ot(n),o=j(n),s=G(e!==void 0?e:Et),a=Math.max(o/s[0],r/s[1]),l=i+1,h=new Array(l),c=0;c<l;++c)h[c]=a/Math.pow(2,c);return h}function Se(n,t,e,i){var r=ut(n);return Re(r,t,e,i)}function ut(n){n=Y(n);var t=n.getExtent();if(!t){var e=180*Vt[Jt.DEGREES]/n.getMetersPerUnit();t=lt(-e,-e,e,e)}return t}var Ie=function(n){function t(e){n.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX}),this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null,this.tileCache=new It(e.cacheSize),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},t.prototype.expireCache=function(i,r){var o=this.getTileCacheForProjection(i);o&&o.expireCache(r)},t.prototype.forEachLoadedTile=function(i,r,o,s){var a=this.getTileCacheForProjection(i);if(!a)return!1;for(var l=!0,h,c,u,d=o.minX;d<=o.maxX;++d)for(var _=o.minY;_<=o.maxY;++_)c=w(r,d,_),u=!1,a.containsKey(c)&&(h=a.get(c),u=h.getState()===p.LOADED,u&&(u=s(h)!==!1)),u||(l=!1);return l},t.prototype.getGutterForProjection=function(i){return 0},t.prototype.getKey=function(){return this.key_},t.prototype.setKey=function(i){this.key_!==i&&(this.key_=i,this.changed())},t.prototype.getOpaque=function(i){return this.opaque_},t.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},t.prototype.getTile=function(i,r,o,s,a){return yt()},t.prototype.getTileGrid=function(){return this.tileGrid},t.prototype.getTileGridForProjection=function(i){return this.tileGrid?this.tileGrid:Ot(i)},t.prototype.getTileCacheForProjection=function(i){var r=this.getProjection();return r&&!Z(r,i)?null:this.tileCache},t.prototype.getTilePixelRatio=function(i){return this.tilePixelRatio_},t.prototype.getTilePixelSize=function(i,r,o){var s=this.getTileGridForProjection(o),a=this.getTilePixelRatio(r),l=G(s.getTileSize(i),this.tmpSize);return a==1?l:Zt(l,a,this.tmpSize)},t.prototype.getTileCoordForTileUrlFunction=function(i,r){var o=r!==void 0?r:this.getProjection(),s=this.getTileGridForProjection(o);return this.getWrapX()&&o.isGlobal()&&(i=Ce(s,i,o)),ce(i,s)?i:null},t.prototype.refresh=function(){this.tileCache.clear(),this.changed()},t.prototype.useTile=function(i,r,o,s){},t}(ne),je=function(n){function t(e,i){n.call(this,e),this.tile=i}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(wt);const Oe=Ie,et={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var Le=function(n){function t(e){n.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible}),this.generateTileUrlFunction_=!e.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,this.tileUrlFunction=e.tileUrlFunction?e.tileUrlFunction.bind(this):Ee,this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),e.tileUrlFunction&&this.setTileUrlFunction(e.tileUrlFunction,this.key_),this.tileLoadingKeys_={}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},t.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},t.prototype.getUrls=function(){return this.urls},t.prototype.handleTileChange=function(i){var r=i.target,o=W(r),s=r.getState(),a;s==p.LOADING?(this.tileLoadingKeys_[o]=!0,a=et.TILELOADSTART):o in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[o],a=s==p.ERROR?et.TILELOADERROR:s==p.LOADED||s==p.ABORT?et.TILELOADEND:void 0),a!=null&&this.dispatchEvent(new je(a,r))},t.prototype.setTileLoadFunction=function(i){this.tileCache.clear(),this.tileLoadFunction=i,this.changed()},t.prototype.setTileUrlFunction=function(i,r){this.tileUrlFunction=i,this.tileCache.pruneExceptNewestZ(),typeof r<"u"?this.setKey(r):this.changed()},t.prototype.setUrl=function(i){var r=this.urls=Fe(i);this.setUrls(r)},t.prototype.setUrls=function(i){this.urls=i;var r=i.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(me(i,this.tileGrid),r):this.setKey(r)},t.prototype.useTile=function(i,r,o){var s=w(i,r,o);this.tileCache.containsKey(s)&&this.tileCache.get(s)},t}(Oe);const Ae=Le;var Ge=function(n){function t(e){n.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Me,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:le,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var i in this.tileCacheForProjection)if(this.tileCacheForProjection[i].canExpireCache())return!0;return!1},t.prototype.expireCache=function(i,r){var o=this.getTileCacheForProjection(i);this.tileCache.expireCache(this.tileCache==o?r:{});for(var s in this.tileCacheForProjection){var a=this.tileCacheForProjection[s];a.expireCache(a==o?r:{})}},t.prototype.getGutterForProjection=function(i){return this.getProjection()&&i&&!Z(this.getProjection(),i)?0:this.getGutter()},t.prototype.getGutter=function(){return 0},t.prototype.getOpaque=function(i){return this.getProjection()&&i&&!Z(this.getProjection(),i)?!1:n.prototype.getOpaque.call(this,i)},t.prototype.getTileGridForProjection=function(i){var r=this.getProjection();if(this.tileGrid&&(!r||Z(r,i)))return this.tileGrid;var o=W(i);return o in this.tileGridForProjection||(this.tileGridForProjection[o]=Ot(i)),this.tileGridForProjection[o]},t.prototype.getTileCacheForProjection=function(i){var r=this.getProjection();if(!r||Z(r,i))return this.tileCache;var o=W(i);return o in this.tileCacheForProjection||(this.tileCacheForProjection[o]=new It(this.tileCache.highWaterMark)),this.tileCacheForProjection[o]},t.prototype.createTile_=function(i,r,o,s,a,l){var h=[i,r,o],c=this.getTileCoordForTileUrlFunction(h,a),u=c?this.tileUrlFunction(c,s,a):void 0,d=new this.tileClass(h,u!==void 0?p.IDLE:p.EMPTY,u!==void 0?u:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return d.key=l,Ft(d,z.CHANGE,this.handleTileChange,this),d},t.prototype.getTile=function(i,r,o,s,a){var l=this.getProjection();if(!l||!a||Z(l,a))return this.getTileInternal(i,r,o,s,l||a);var h=this.getTileCacheForProjection(a),c=[i,r,o],u,d=St(c);h.containsKey(d)&&(u=h.get(d));var _=this.getKey();if(u&&u.key==_)return u;var v=this.getTileGridForProjection(l),T=this.getTileGridForProjection(a),F=this.getTileCoordForTileUrlFunction(c,a),f=new _e(l,v,a,T,c,F,this.getTilePixelRatio(s),this.getGutter(),(function(g,x,R,y){return this.getTileInternal(g,x,R,y,l)}).bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return f.key=_,u?(f.interimTile=u,f.refreshInterimChain(),h.replace(d,f)):h.set(d,f),f},t.prototype.getTileInternal=function(i,r,o,s,a){var l=null,h=w(i,r,o),c=this.getKey();if(!this.tileCache.containsKey(h))l=this.createTile_(i,r,o,s,a,c),this.tileCache.set(h,l);else if(l=this.tileCache.get(h),l.key!=c){var u=l;l=this.createTile_(i,r,o,s,a,c),u.getState()==p.IDLE?l.interimTile=u.interimTile:l.interimTile=u,l.refreshInterimChain(),this.tileCache.replace(h,l)}return l},t.prototype.setRenderReprojectionEdges=function(i){if(this.renderReprojectionEdges_!=i){this.renderReprojectionEdges_=i;for(var r in this.tileCacheForProjection)this.tileCacheForProjection[r].clear();this.changed()}},t.prototype.setTileGridForProjection=function(i,r){{var o=Y(i);if(o){var s=W(o);s in this.tileGridForProjection||(this.tileGridForProjection[s]=r)}}},t}(Ae);function Me(n,t){n.getImage().src=t}const Xe=Ge;var Ze=function(n){function t(e){var i=e||{},r=i.projection!==void 0?i.projection:"EPSG:3857",o=i.tileGrid!==void 0?i.tileGrid:Pe({extent:ut(r),maxZoom:i.maxZoom,minZoom:i.minZoom,tileSize:i.tileSize});n.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,opaque:i.opaque,projection:r,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileGrid:o,tileLoadFunction:i.tileLoadFunction,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:i.wrapX!==void 0?i.wrapX:!0,transition:i.transition,attributionsCollapsible:i.attributionsCollapsible})}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(Xe);const be=Ze;var ze='&#169; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.',Ne=function(n){function t(e){var i=e||{},r;i.attributions!==void 0?r=i.attributions:r=[ze];var o=i.crossOrigin!==void 0?i.crossOrigin:"anonymous",s=i.url!==void 0?i.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";n.call(this,{attributions:r,cacheSize:i.cacheSize,crossOrigin:o,opaque:i.opaque!==void 0?i.opaque:!0,maxZoom:i.maxZoom!==void 0?i.maxZoom:19,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileLoadFunction:i.tileLoadFunction,url:s,wrapX:i.wrapX,attributionsCollapsible:!1})}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(be);export{ze as ATTRIBUTION,Ne as default};
