import{q as I}from"./index.cI_fw6Fh.js";class R{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let i=this.data;const n=[];if(!X(t,i))return n;const h=this.toBBox,s=[];for(;i;){for(let r=0;r<i.children.length;r++){const l=i.children[r],a=i.leaf?h(l):l;X(t,a)&&(i.leaf?n.push(l):M(t,a)?this._all(l,n):s.push(l))}i=s.pop()}return n}collides(t){let i=this.data;if(!X(t,i))return!1;const n=[];for(;i;){for(let h=0;h<i.children.length;h++){const s=i.children[h],r=i.leaf?this.toBBox(s):s;if(X(t,r)){if(i.leaf||M(t,r))return!0;n.push(s)}}i=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let i=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=i;else if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=x([]),this}remove(t,i){if(!t)return this;let n=this.data;const h=this.toBBox(t),s=[],r=[];let l,a,c;for(;n||s.length;){if(n||(n=s.pop(),a=s[s.length-1],l=r.pop(),c=!0),n.leaf){const o=y(t,n.children,i);if(o!==-1)return n.children.splice(o,1),s.push(n),this._condense(s),this}!c&&!n.leaf&&M(n,h)?(s.push(n),r.push(l),l=0,a=n,n=n.children[0]):a?(l++,n=a.children[l],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,i){return t.minX-i.minX}compareMinY(t,i){return t.minY-i.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,i){const n=[];for(;t;)t.leaf?i.push(...t.children):n.push(...t.children),t=n.pop();return i}_build(t,i,n,h){const s=n-i+1;let r=this._maxEntries,l;if(s<=r)return l=x(t.slice(i,n+1)),f(l,this.toBBox),l;h||(h=Math.ceil(Math.log(s)/Math.log(r)),r=Math.ceil(s/Math.pow(r,h-1))),l=x([]),l.leaf=!1,l.height=h;const a=Math.ceil(s/r),c=a*Math.ceil(Math.sqrt(r));g(t,i,n,c,this.compareMinX);for(let o=i;o<=n;o+=c){const m=Math.min(o+c-1,n);g(t,o,m,a,this.compareMinY);for(let d=o;d<=m;d+=a){const _=Math.min(d+a-1,m);l.children.push(this._build(t,d,_,h-1))}}return f(l,this.toBBox),l}_chooseSubtree(t,i,n,h){for(;h.push(i),!(i.leaf||h.length-1===n);){let s=1/0,r=1/0,l;for(let a=0;a<i.children.length;a++){const c=i.children[a],o=Y(c),m=E(t,c)-o;m<r?(r=m,s=o<s?o:s,l=c):m===r&&o<s&&(s=o,l=c)}i=l||i.children[0]}return i}_insert(t,i,n){const h=n?t:this.toBBox(t),s=[],r=this._chooseSubtree(h,this.data,i,s);for(r.children.push(t),p(r,h);i>=0&&s[i].children.length>this._maxEntries;)this._split(s,i),i--;this._adjustParentBBoxes(h,s,i)}_split(t,i){const n=t[i],h=n.children.length,s=this._minEntries;this._chooseSplitAxis(n,s,h);const r=this._chooseSplitIndex(n,s,h),l=x(n.children.splice(r,n.children.length-r));l.height=n.height,l.leaf=n.leaf,f(n,this.toBBox),f(l,this.toBBox),i?t[i-1].children.push(l):this._splitRoot(n,l)}_splitRoot(t,i){this.data=x([t,i]),this.data.height=t.height+1,this.data.leaf=!1,f(this.data,this.toBBox)}_chooseSplitIndex(t,i,n){let h,s=1/0,r=1/0;for(let l=i;l<=n-i;l++){const a=u(t,0,l,this.toBBox),c=u(t,l,n,this.toBBox),o=A(a,c),m=Y(a)+Y(c);o<s?(s=o,h=l,r=m<r?m:r):o===s&&m<r&&(r=m,h=l)}return h||n-i}_chooseSplitAxis(t,i,n){const h=t.leaf?this.compareMinX:S,s=t.leaf?this.compareMinY:w,r=this._allDistMargin(t,i,n,h),l=this._allDistMargin(t,i,n,s);r<l&&t.children.sort(h)}_allDistMargin(t,i,n,h){t.children.sort(h);const s=this.toBBox,r=u(t,0,i,s),l=u(t,n-i,n,s);let a=B(r)+B(l);for(let c=i;c<n-i;c++){const o=t.children[c];p(r,t.leaf?s(o):o),a+=B(r)}for(let c=n-i-1;c>=i;c--){const o=t.children[c];p(l,t.leaf?s(o):o),a+=B(l)}return a}_adjustParentBBoxes(t,i,n){for(let h=n;h>=0;h--)p(i[h],t)}_condense(t){for(let i=t.length-1,n;i>=0;i--)t[i].children.length===0?i>0?(n=t[i-1].children,n.splice(n.indexOf(t[i]),1)):this.clear():f(t[i],this.toBBox)}}function y(e,t,i){if(!i)return t.indexOf(e);for(let n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function f(e,t){u(e,0,e.children.length,t,e)}function u(e,t,i,n,h){h||(h=x(null)),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(let s=t;s<i;s++){const r=e.children[s];p(h,e.leaf?n(r):r)}return h}function p(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function S(e,t){return e.minX-t.minX}function w(e,t){return e.minY-t.minY}function Y(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function B(e){return e.maxX-e.minX+(e.maxY-e.minY)}function E(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function A(e,t){const i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),h=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,h-i)*Math.max(0,s-n)}function M(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function X(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function x(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(e,t,i,n,h){const s=[t,i];for(;s.length;){if(i=s.pop(),t=s.pop(),i-t<=n)continue;const r=t+Math.ceil((i-t)/n/2)*n;I(e,r,t,i,h),s.push(t,r,r,i)}}export{R};
