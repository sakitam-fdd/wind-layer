import{c as X_,g as W_}from"./commonjsHelpers.Cpj98o6Y.js";import{h as zg,r as Pg,p as kg,b as Dg,S as Lg,O as t_,B as Rg,L as Qm,c as Bp,i as i_,a as Bg,M as jl,P as Fg,V as Rp,d as Og}from"./index.CGiPxbJQ.js";import{R as Ug}from"./index.esm.ZNDlV88T.js";var $_={exports:{}};(function(Ar,gi){var Oi={};(function($i,ci){Ar.exports=ci()})(X_,function(){var $i,ci,rr;function T(c,st){if(!$i)$i=st;else if(!ci)ci=st;else{var Kt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+$i+")(sharedChunk); ("+ci+")(sharedChunk); self.onerror = null;",Zi={};$i(Zi),rr=st(Zi),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(rr.workerUrl=window.URL.createObjectURL(new Blob([Kt],{type:"text/javascript"})))}}T(["exports"],function(c){var st=typeof self<"u"?self:{},Kt="2.15.0";let Zi;const Gt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Zi==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Zi=Oi.API_URL_REGEX!=null?new RegExp(Oi.API_URL_REGEX):i}catch{Zi=i}}return Zi},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Gt.API_URL)return null;try{const i=new URL(Gt.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},di={supported:!1,testSupport:function(i){!tr&&nr&&(Xn?Wn(i):Di=i)}};let Di,nr,tr=!1,Xn=!1;function Wn(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,nr),i.isContextLost())return;di.supported=!0}catch{}i.deleteTexture(e),tr=!0}st.document&&(nr=st.document.createElement("img"),nr.onload=function(){Di&&Wn(Di),Di=null,Xn=!0},nr.onerror=function(){tr=!0,Di=null},nr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const co="01";function _o(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ao=to;function to(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}to.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<e)return r;var _=this.sampleCurveDerivativeX(r);if(Math.abs(_)<1e-6)break;r-=u/_}var v=0,w=1;for(r=i,a=0;a<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<e));a++)i>u?v=r:w=r,r=.5*(w-v)+v;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Mo=_o(Ao),ra=jr;function jr(i,e){this.x=i,this.y=e}jr.prototype={clone:function(){return new jr(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),u=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},jr.convert=function(i){return i instanceof jr?i:Array.isArray(i)?new jr(i[0],i[1]):i};var Xt=_o(ra);const En=Math.PI/180,Wo=180/Math.PI;function Ki(i){return i*En}function en(i){return i*Wo}const us=[[0,0],[1,0],[1,1],[0,1]];function fa(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function hs(i,e,r,a){const u=new Mo(i,e,r,a);return function(_){return u.solve(_)}}const gl=hs(.25,.1,.25,1);function or(i,e,r){return Math.min(r,Math.max(e,i))}function Cs(i,e,r){return(r=or((r-i)/(e-i),0,1))*r*(3-2*r)}function tn(i,e,r){const a=r-e,u=((i-e)%a+a)%a+e;return u===e?r:u}function hn(i,e,r){if(!i.length)return r(null,[]);let a=i.length;const u=new Array(i.length);let _=null;i.forEach((v,w)=>{e(v,(A,C)=>{A&&(_=A),u[w]=C,--a==0&&r(_,u)})})}function zs(i){const e=[];for(const r in i)e.push(i[r]);return e}function Gn(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let ma=1;function _a(){return ma++}function pn(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function ga(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function ps(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Fn(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ya(i,e){return i.indexOf(e,i.length-e.length)!==-1}function cr(i,e,r){const a={};for(const u in i)a[u]=e.call(r||this,i[u],u,i);return a}function On(i,e,r){const a={};for(const u in i)e.call(r||this,i[u],u,i)&&(a[u]=i[u]);return a}function Ui(i){return Array.isArray(i)?i.map(Ui):typeof i=="object"&&i?cr(i,Ui):i}const Ps={};function Hr(i){Ps[i]||(typeof console<"u"&&console.warn(i),Ps[i]=!0)}function vn(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Ma(i){let e=0;for(let r,a,u=0,_=i.length,v=_-1;u<_;v=u++)r=i[u],a=i[v],e+=(a.x-r.x)*(r.y+a.y);return e}function va(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ko(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,u,_)=>{const v=u||_;return e[a]=!v||v.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let na=null;function Co(i){if(na==null){const e=i.navigator?i.navigator.userAgent:null;na=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return na}function Na(i){try{const e=st[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function xa(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const ks="mapbox-tiles";let ql=500,Gl=50,zo,Ca;function ds(){try{return st.caches}catch{}}function fs(){ds()&&!zo&&(zo=st.caches.open(ks))}function Ds(i){const e=i.indexOf("?");if(e<0)return i;const r=function(u){const _=u.indexOf("?");return _>0?u.slice(_+1).split("&"):[]}(i),a=r.filter(u=>{const _=u.split("=");return _[0]==="language"||_[0]==="worldview"});return a.length?`${i.slice(0,e)}?${a.join("&")}`:i.slice(0,e)}let ja=1/0;const Ls={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ls);class qa extends Error{constructor(e,r,a){r===401&&tt(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Do=va()?()=>self.worker&&self.worker.referrer:()=>(st.location.protocol==="blob:"?st.parent:st).location.href,ms=function(i,e){if(!(/^file:/.test(r=i.url)||/^file:/.test(Do())&&!/^\w+:/.test(r))){if(st.fetch&&st.Request&&st.AbortController&&st.Request.prototype.hasOwnProperty("signal"))return function(a,u){const _=new st.AbortController,v=new st.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Do(),referrerPolicy:a.referrerPolicy,signal:_.signal});let w=!1,A=!1;const C=(R=v.url).indexOf("sku=")>0&&tt(R);var R;a.type==="json"&&v.headers.set("Accept","application/json");const F=(Z,$,J)=>{if(A)return;if(Z&&Z.message!=="SecurityError"&&Hr(Z.toString()),$&&J)return j($);const se=Date.now();st.fetch(v).then(ye=>{if(ye.ok){const Pe=C?ye.clone():null;return j(ye,Pe,se)}return u(new qa(ye.statusText,ye.status,a.url))}).catch(ye=>{ye.name!=="AbortError"&&u(new Error(`${ye.message} ${a.url}`))})},j=(Z,$,J)=>{(a.type==="arrayBuffer"?Z.arrayBuffer():a.type==="json"?Z.json():Z.text()).then(se=>{A||($&&J&&function(ye,Pe,ve){if(fs(),!zo)return;const ze={status:Pe.status,statusText:Pe.statusText,headers:new st.Headers};Pe.headers.forEach((ht,at)=>ze.headers.set(at,ht));const Ue=ko(Pe.headers.get("Cache-Control")||"");if(Ue["no-store"])return;Ue["max-age"]&&ze.headers.set("Expires",new Date(ve+1e3*Ue["max-age"]).toUTCString());const Oe=ze.headers.get("Expires");Oe&&(new Date(Oe).getTime()-ve<42e4||function(ht,at){if(Ca===void 0)try{new Response(new ReadableStream),Ca=!0}catch{Ca=!1}Ca?at(ht.body):ht.blob().then(at)}(Pe,ht=>{const at=new st.Response(ht,ze);fs(),zo&&zo.then(wt=>wt.put(Ds(ye.url),at)).catch(wt=>Hr(wt.message))}))}(v,$,J),w=!0,u(null,se,Z.headers.get("Cache-Control"),Z.headers.get("Expires")))}).catch(se=>{A||u(new Error(se.message))})};return C?function(Z,$){if(fs(),!zo)return $(null);const J=Ds(Z.url);zo.then(se=>{se.match(J).then(ye=>{const Pe=function(ve){if(!ve)return!1;const ze=new Date(ve.headers.get("Expires")||0),Ue=ko(ve.headers.get("Cache-Control")||"");return ze>Date.now()&&!Ue["no-cache"]}(ye);se.delete(J),Pe&&se.put(J,ye.clone()),$(null,ye,Pe)}).catch($)}).catch($)}(v,F):F(null,null),{cancel:()=>{A=!0,w||_.abort()}}}(i,e);if(va()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(a,u){const _=new st.XMLHttpRequest;_.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const v in a.headers)_.setRequestHeader(v,a.headers[v]);return a.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=a.credentials==="include",_.onerror=()=>{u(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let v=_.response;if(a.type==="json")try{v=JSON.parse(_.response)}catch(w){return u(w)}u(null,v,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else u(new qa(_.statusText,_.status,a.url))},_.send(a.body),{cancel:()=>_.abort()}}(i,e)},Rs=function(i,e){return ms(Gn(i,{type:"arrayBuffer"}),e)};function yl(i){const e=st.document.createElement("a");return e.href=i,e.protocol===st.document.location.protocol&&e.host===st.document.location.host}const Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let te,re;te=[],re=0;const Ie=function(i,e){if(di.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),re>=Gt.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return te.push(_),_}re++;let r=!1;const a=()=>{if(!r)for(r=!0,re--;te.length&&re<Gt.MAX_PARALLEL_IMAGE_REQUESTS;){const _=te.shift(),{requestParameters:v,callback:w,cancelled:A}=_;A||(_.cancel=Ie(v,w).cancel)}},u=Rs(i,(_,v,w,A)=>{a(),_?e(_):v&&(st.createImageBitmap?function(C,R){const F=new st.Blob([new Uint8Array(C)],{type:"image/png"});st.createImageBitmap(F).then(j=>{R(null,j)}).catch(j=>{R(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(C,R)=>e(C,R,w,A)):function(C,R){const F=new st.Image,j=st.URL;F.onload=()=>{R(null,F),j.revokeObjectURL(F.src),F.onload=null,st.requestAnimationFrame(()=>{F.src=Ce})},F.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Z=new st.Blob([new Uint8Array(C)],{type:"image/png"});F.src=C.byteLength?j.createObjectURL(Z):Ce}(v,(C,R)=>e(C,R,w,A)))});return{cancel:()=>{u.cancel(),a()}}},De="NO_ACCESS_TOKEN";function Ze(i){return i.indexOf("mapbox:")===0}function tt(i){return Gt.API_URL_REGEX.test(i)}function Qe(i){return Gt.API_CDN_URL_REGEX.test(i)}function Ge(i){return Gt.API_STYLE_REGEX.test(i)&&!pt(i)}function pt(i){return Gt.API_SPRITE_REGEX.test(i)}const vt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pt(i){const e=i.match(vt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Et(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}const mi="mapbox.eventData";function Li(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(st.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class li{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Li(Gt.ACCESS_TOKEN);let a="";return a=r&&r.u?st.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(u,_)=>String.fromCharCode(+("0x"+_)))):Gt.ACCESS_TOKEN||"",e?`${mi}.${e}:${a}`:`${mi}:${a}`}fetchEventData(){const e=Na("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=st.localStorage.getItem(r);u&&(this.eventData=JSON.parse(u));const _=st.localStorage.getItem(a);_&&(this.anonId=_)}catch{Hr("Unable to read from LocalStorage")}}saveEventData(){const e=Na("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{st.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&st.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Hr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,u){if(!Gt.EVENTS_URL)return;const _=Pt(Gt.EVENTS_URL);_.params.push(`access_token=${u||Gt.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(e).toISOString()},w=r?Gn(v,r):v,A={url:Et(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=function(C,R){return ms(Gn(C,{method:"POST"}),R)}(A,C=>{this.pendingRequest=null,a(C),this.saveEventData(),this.processRequests(u)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const V=new class extends li{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Gt.EVENTS_URL&&Gt.ACCESS_TOKEN&&Array.isArray(i)&&i.some(r=>Ze(r)||tt(r))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Li(Gt.ACCESS_TOKEN),r=e?e.u:Gt.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;ps(this.anonId)||(this.anonId=pn(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),v=new Date(u),w=(u-this.eventData.lastSuccess)/864e5;a=a||w>=1||w<-1||_.getDate()!==v.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Kt,skuId:co,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=u,this.eventData.tokenU=r)},i):this.processRequests()}},X=V.postTurnstileEvent.bind(V),ee=new class extends li{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,r,a){this.skuToken=e,this.errorCb=a,Gt.EVENTS_URL&&(r||Gt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(De)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ps(this.anonId)||(this.anonId=pn()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Kt,skuId:co,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},i))}},pe=ee.postMapLoadEvent.bind(ee),xe=new class extends li{constructor(){super("gljs.performance")}postPerformanceEvent(i,e){Gt.EVENTS_URL&&(i||Gt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),a=function(u){const _=st.performance.getEntriesByType("resource"),v=st.performance.getEntriesByType("mark"),w=function(j){const Z={};if(j){for(const $ in j)if($!=="other")for(const J of j[$]){const se=`${$}ResolveRangeMin`,ye=`${$}ResolveRangeMax`,Pe=`${$}RequestCount`,ve=`${$}RequestCachedCount`;Z[se]=Math.min(Z[se]||1/0,J.startTime),Z[ye]=Math.max(Z[ye]||-1/0,J.responseEnd);const ze=Ue=>{Z[Ue]===void 0&&(Z[Ue]=0),++Z[Ue]};J.transferSize!==void 0&&J.transferSize===0&&ze(ve),ze(Pe)}}return Z}(function(j,Z){const $={};if(j)for(const J of j){const se=Z(J);$[se]===void 0&&($[se]=[]),$[se].push(J)}return $}(_,_t)),A=st.devicePixelRatio,C=st.navigator.connection||st.navigator.mozConnection||st.navigator.webkitConnection,R={counters:[],metadata:[],attributes:[]},F=(j,Z,$)=>{$!=null&&j.push({name:Z,value:$.toString()})};for(const j in w)F(R.counters,j,w[j]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(F(R.counters,"interactionRangeMin",u.interactionRange[0]),F(R.counters,"interactionRangeMax",u.interactionRange[1])),v)for(const j of Object.keys(Ae)){const Z=Ae[j],$=v.find(J=>J.name===Z);$&&F(R.counters,Z,$.startTime)}return F(R.counters,"visibilityHidden",u.visibilityHidden),F(R.attributes,"style",function(j){if(j)for(const Z of j){const $=Z.name.split("?")[0];if(Ge($)){const J=$.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(_)),F(R.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),F(R.attributes,"fogEnabled",u.fogEnabled?"true":"false"),F(R.attributes,"projection",u.projection),F(R.attributes,"zoom",u.zoom),F(R.metadata,"devicePixelRatio",A),F(R.metadata,"connectionEffectiveType",C?C.effectiveType:void 0),F(R.metadata,"navigatorUserAgent",st.navigator.userAgent),F(R.metadata,"screenWidth",st.screen.width),F(R.metadata,"screenHeight",st.screen.height),F(R.metadata,"windowWidth",st.innerWidth),F(R.metadata,"windowHeight",st.innerHeight),F(R.metadata,"mapWidth",u.width/A),F(R.metadata,"mapHeight",u.height/A),F(R.metadata,"webglRenderer",u.renderer),F(R.metadata,"webglVendor",u.vendor),F(R.metadata,"sdkVersion",Kt),F(R.metadata,"sdkIdentifier","mapbox-gl-js"),R}(r);for(const u of a.metadata);for(const u of a.counters);for(const u of a.attributes);this.postEvent(e,a,()=>{},i)}},Be=xe.postPerformanceEvent.bind(xe),Xe=new class extends li{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,r,a){if(!Gt.API_URL||!Gt.SESSION_PATH)return;const u=Pt(Gt.API_URL+Gt.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||Gt.ACCESS_TOKEN||""}`);const _={url:Et(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(v,w){return ms(Gn(v,{method:"GET"}),w)}(_,v=>{this.pendingRequest=null,r(v),this.saveEventData(),this.processRequests(a)})}getSessionAPI(i,e,r,a){this.skuToken=e,this.errorCb=a,Gt.SESSION_PATH&&Gt.API_URL&&(r||Gt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(De)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},i)}},Re=Xe.getSessionAPI.bind(Xe),Le=new Set,Ae={create:"create",load:"load",fullLoad:"fullLoad"},ft={mark(i){st.performance.mark(i)},measure(i,e,r){st.performance.measure(i,e,r)}};function _t(i){const e=i.name.split("?")[0];return Qe(e)&&e.includes("mapbox-gl.js")?"javascript":Qe(e)&&e.includes("mapbox-gl.css")?"css":function(r){return Gt.API_FONTS_REGEX.test(r)}(e)?"fontRange":pt(e)?"sprite":Ge(e)?"style":function(r){return Gt.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}const rt=st.performance;function Wt(i){const e=i?i.url.toString():void 0;return rt.getEntriesByName(e)}let Zt,yi,_i,ri;const Ti={now:()=>_i!==void 0?_i:st.performance.now(),setNow(i){_i=i},restoreNow(){_i=void 0},frame(i){const e=st.requestAnimationFrame(i);return{cancel:()=>st.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:r,height:a}=i;ri||(ri=st.document.createElement("canvas"));const u=ri.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>ri.width||a>ri.height)&&(ri.width=r,ri.height=a),u.clearRect(-e,-e,r+2*e,a+2*e),u.drawImage(i,0,0,r,a),u.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:i=>(Zt||(Zt=st.document.createElement("a")),Zt.href=i,Zt.href),get devicePixelRatio(){return st.devicePixelRatio},get prefersReducedMotion(){return!!st.matchMedia&&(yi==null&&(yi=st.matchMedia("(prefers-reduced-motion: reduce)")),yi.matches)}};function zi(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Ji(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class ir{constructor(e,r={}){Gn(this,r),this.type=e}}class zr extends ir{constructor(e,r={}){super("error",Gn({error:e},r))}}class Ei{on(e,r){return this._listeners=this._listeners||{},zi(e,r,this._listeners),this}off(e,r){return Ji(e,r,this._listeners),Ji(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},zi(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new ir(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const w of u)w.call(this,e);const _=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const w of _)Ji(a,w,this._oneTimeListeners),w.call(this,e);const v=this._eventedParent;v&&(Gn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(e))}else e instanceof zr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var lt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function dn(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}function Qi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function _r(i){if(Array.isArray(i))return i.map(_r);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=_r(i[r]);return e}return Qi(i)}class ba extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var dr=ba;class Kr{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,u]of r)this.bindings[a]=u}concat(e){return new Kr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Or=Kr;const Un={kind:"null"},Rt={kind:"number"},Bi={kind:"string"},qi={kind:"boolean"},io={kind:"color"},_s={kind:"object"},Xi={kind:"value"},wa={kind:"collator"},Ga={kind:"formatted"},Mr={kind:"resolvedImage"};function Zn(i,e){return{kind:"array",itemType:i,N:e}}function on(i){if(i.kind==="array"){const e=on(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const uc=[Un,Rt,Bi,qi,io,Ga,_s,Zn(Xi),Mr];function Za(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Za(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of uc)if(!Za(r,e))return null}}return`Expected ${on(i)} but found ${on(e)} instead.`}function Xa(i,e){return e.some(r=>r.kind===i.kind)}function Wa(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var hc,el={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Sn(i){return(i=Math.round(i))<0?0:i>255?255:i}function gs(i){return Sn(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function pc(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function Bs(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{hc={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in el)return el[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),u=r.indexOf(")");if(a!==-1&&u+1===r.length){var _=r.substr(0,a),v=r.substr(a+1,u-(a+1)).split(","),w=1;switch(_){case"rgba":if(v.length!==4)return null;w=pc(v.pop());case"rgb":return v.length!==3?null:[gs(v[0]),gs(v[1]),gs(v[2]),w];case"hsla":if(v.length!==4)return null;w=pc(v.pop());case"hsl":if(v.length!==3)return null;var A=(parseFloat(v[0])%360+360)%360/360,C=pc(v[1]),R=pc(v[2]),F=R<=.5?R*(C+1):R+C-R*C,j=2*R-F;return[Sn(255*Bs(j,F,A+1/3)),Sn(255*Bs(j,F,A)),Sn(255*Bs(j,F,A-1/3)),w];default:return null}}return null}}catch{}class oa{constructor(e,r,a,u=1){this.r=e,this.g=r,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof oa)return e;if(typeof e!="string")return;const r=hc(e);return r?new oa(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${u})`}toArray(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*a/u,u]}toArray01(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,r/u,a/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:u}=this;return[e,r,a,u]}}oa.black=new oa(0,0,0,1),oa.white=new oa(1,1,1,1),oa.transparent=new oa(0,0,0,0),oa.red=new oa(1,0,0,1),oa.blue=new oa(0,0,1,1);var In=oa;class tl{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class vl{constructor(e,r,a,u,_){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=u,this.textColor=_}}class Lo{constructor(e){this.sections=e}static fromString(e){return new Lo([new vl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Lo?e:Lo.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(a)}return e}}class aa{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new aa({name:e,available:!1}):null}serialize(){return["image",this.name]}}function mh(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zl(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof In||i instanceof tl||i instanceof Lo||i instanceof aa)return!0;if(Array.isArray(i)){for(const e of i)if(!Zl(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Zl(i[e]))return!1;return!0}return!1}function An(i){if(i===null)return Un;if(typeof i=="string")return Bi;if(typeof i=="boolean")return qi;if(typeof i=="number")return Rt;if(i instanceof In)return io;if(i instanceof tl)return wa;if(i instanceof Lo)return Ga;if(i instanceof aa)return Mr;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const u=An(a);if(r){if(r===u)continue;r=Xi;break}r=u}return Zn(r||Xi,e)}return _s}function $a(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof In||i instanceof Lo||i instanceof aa?i.toString():JSON.stringify(i)}class xl{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Zl(e[1]))return r.error("invalid value");const a=e[1];let u=An(a);const _=r.expectedType;return u.kind!=="array"||u.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(u=_),new xl(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof In?["rgba"].concat(this.value.toArray()):this.value instanceof Lo?this.value.serialize():this.value}}var Fs=xl,Po=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const Fu={string:Bi,number:Rt,boolean:qi,object:_s};class Xl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,u=1;const _=e[0];if(_==="array"){let w,A;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in Fu)||C==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);w=Fu[C],u++}else w=Xi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);A=e[2],u++}a=Zn(w,A)}else a=Fu[_];const v=[];for(;u<e.length;u++){const w=r.parse(e[u],u,Xi);if(!w)return null;v.push(w)}return new Xl(a,v)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!Za(this.type,An(a)))return a;if(r===this.args.length-1)throw new Po(`Expected value to be of type ${on(this.type)}, but found ${on(An(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(a=>a.serialize()))}}var za=Xl;class il{constructor(e){this.type=Ga,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const u=[];let _=!1;for(let v=1;v<=e.length-1;++v){const w=e[v];if(_&&typeof w=="object"&&!Array.isArray(w)){_=!1;let A=null;if(w["font-scale"]&&(A=r.parse(w["font-scale"],1,Rt),!A))return null;let C=null;if(w["text-font"]&&(C=r.parse(w["text-font"],1,Zn(Bi)),!C))return null;let R=null;if(w["text-color"]&&(R=r.parse(w["text-color"],1,io),!R))return null;const F=u[u.length-1];F.scale=A,F.font=C,F.textColor=R}else{const A=r.parse(e[v],1,Xi);if(!A)return null;const C=A.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,u.push({content:A,scale:null,font:null,textColor:null})}}return new il(u)}evaluate(e){return new Lo(this.sections.map(r=>{const a=r.content.evaluate(e);return An(a)===Mr?new vl("",a,null,null,null):new vl($a(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class ro{constructor(e){this.type=Mr,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Bi);return a?new ro(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=aa.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ou={"to-boolean":qi,"to-color":io,"to-number":Rt,"to-string":Bi};class Os{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=Ou[a],_=[];for(let v=1;v<e.length;v++){const w=r.parse(e[v],v,Xi);if(!w)return null;_.push(w)}return new Os(u,_)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const u of this.args){if(r=u.evaluate(e),a=null,r instanceof In)return r;if(typeof r=="string"){const _=e.parseColor(r);if(_)return _}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:mh(r[0],r[1],r[2],r[3]),!a))return new In(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Po(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Po(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Lo.fromString($a(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?aa.fromString($a(this.args[0].evaluate(e))):$a(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new il([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ro(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Pa=Os;const $o=["Unknown","Point","LineString","Polygon"];var rl=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$o[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-i[0])+this.featureDistanceData.bearing[1]*(a*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=In.parse(i)),e}};class ka{constructor(e,r,a,u){this.name=e,this.type=r,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],u=ka.definitions[a];if(!u)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(u)?u[0]:u.type,v=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,w=v.filter(([C])=>!Array.isArray(C)||C.length===e.length-1);let A=null;for(const[C,R]of w){A=new ju(r.registry,r.path,null,r.scope);const F=[];let j=!1;for(let Z=1;Z<e.length;Z++){const $=e[Z],J=Array.isArray(C)?C[Z-1]:C.type,se=A.parse($,1+F.length,J);if(!se){j=!0;break}F.push(se)}if(!j)if(Array.isArray(C)&&C.length!==F.length)A.error(`Expected ${C.length} arguments, but found ${F.length} instead.`);else{for(let Z=0;Z<F.length;Z++){const $=Array.isArray(C)?C[Z]:C.type,J=F[Z];A.concat(Z+1).checkSubtype($,J.type)}if(A.errors.length===0)return new ka(a,_,R,F)}}if(w.length===1)r.errors.push(...A.errors);else{const C=(w.length?w:v).map(([F])=>{return j=F,Array.isArray(j)?`(${j.map(on).join(", ")})`:`(${on(j.type)}...)`;var j}).join(" | "),R=[];for(let F=1;F<e.length;F++){const j=r.parse(e[F],1+R.length);if(!j)return null;R.push(on(j.type))}r.error(`Expected arguments of type ${C}, but found (${R.join(", ")}) instead.`)}return null}static register(e,r){ka.definitions=r;for(const a in r)e[a]=ka}}var sa=ka;class dc{constructor(e,r,a){this.type=wa,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const u=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,qi);if(!u)return null;const _=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,qi);if(!_)return null;let v=null;return a.locale&&(v=r.parse(a.locale,1,Bi),!v)?null:new dc(u,_,v)}evaluate(e){return new tl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Us=8192;function nl(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function fc(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Vc(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*Us),Math.round(a*u*Us)]}function _h(i,e,r){const a=i[0]-e[0],u=i[1]-e[1],_=i[0]-r[0],v=i[1]-r[1];return a*v-_*u==0&&a*_<=0&&u*v<=0}function cu(i,e){let r=!1;for(let v=0,w=e.length;v<w;v++){const A=e[v];for(let C=0,R=A.length;C<R-1;C++){if(_h(i,A[C],A[C+1]))return!1;(u=A[C])[1]>(a=i)[1]!=(_=A[C+1])[1]>a[1]&&a[0]<(_[0]-u[0])*(a[1]-u[1])/(_[1]-u[1])+u[0]&&(r=!r)}}var a,u,_;return r}function Uu(i,e){for(let r=0;r<e.length;r++)if(cu(i,e[r]))return!0;return!1}function Vu(i,e,r,a){const u=a[0]-r[0],_=a[1]-r[1],v=(i[0]-r[0])*_-u*(i[1]-r[1]),w=(e[0]-r[0])*_-u*(e[1]-r[1]);return v>0&&w<0||v<0&&w>0}function Ha(i,e,r){for(const C of r)for(let R=0;R<C.length-1;++R)if((w=[(v=C[R+1])[0]-(_=C[R])[0],v[1]-_[1]])[0]*(A=[(u=e)[0]-(a=i)[0],u[1]-a[1]])[1]-w[1]*A[0]!=0&&Vu(a,u,_,v)&&Vu(_,v,a,u))return!0;var a,u,_,v,w,A;return!1}function wr(i,e){for(let r=0;r<i.length;++r)if(!cu(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Ha(i[r],i[r+1],e))return!1;return!0}function mc(i,e){for(let r=0;r<e.length;r++)if(wr(i,e[r]))return!0;return!1}function an(i,e,r){const a=[];for(let u=0;u<i.length;u++){const _=[];for(let v=0;v<i[u].length;v++){const w=Vc(i[u][v],r);nl(e,w),_.push(w)}a.push(_)}return a}function Nu(i,e,r){const a=[];for(let u=0;u<i.length;u++){const _=an(i[u],e,r);a.push(_)}return a}function bl(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const u=.5*a;let _=i[0]-r[0]>u?-a:r[0]-i[0]>u?a:0;_===0&&(_=i[0]-r[2]>u?-a:r[2]-i[0]>u?a:0),i[0]+=_}nl(e,i)}function ol(i,e,r,a){const u=Math.pow(2,a.z)*Us,_=[a.x*Us,a.y*Us],v=[];if(!i)return v;for(const w of i)for(const A of w){const C=[A.x+_[0],A.y+_[1]];bl(C,e,r,u),v.push(C)}return v}function _c(i,e,r,a){const u=Math.pow(2,a.z)*Us,_=[a.x*Us,a.y*Us],v=[];if(!i)return v;for(const A of i){const C=[];for(const R of A){const F=[R.x+_[0],R.y+_[1]];nl(e,F),C.push(F)}v.push(C)}if(e[2]-e[0]<=u/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const A of v)for(const C of A)bl(C,e,r,u)}var w;return v}class Ka{constructor(e,r){this.type=qi,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Zl(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const _=a.features[u].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Ka(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ka(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ka(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=r.canonicalID();if(!v)return!1;if(a.type==="Polygon"){const w=an(a.coordinates,_,v),A=ol(r.geometry(),u,_,v);if(!fc(u,_))return!1;for(const C of A)if(!cu(C,w))return!1}if(a.type==="MultiPolygon"){const w=Nu(a.coordinates,_,v),A=ol(r.geometry(),u,_,v);if(!fc(u,_))return!1;for(const C of A)if(!Uu(C,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=r.canonicalID();if(!v)return!1;if(a.type==="Polygon"){const w=an(a.coordinates,_,v),A=_c(r.geometry(),u,_,v);if(!fc(u,_))return!1;for(const C of A)if(!wr(C,w))return!1}if(a.type==="MultiPolygon"){const w=Nu(a.coordinates,_,v),A=_c(r.geometry(),u,_,v);if(!fc(u,_))return!1;for(const C of A)if(!mc(C,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var al=Ka;function wl(i){if(i instanceof sa&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof al)return!1;let e=!0;return i.eachChild(r=>{e&&!wl(r)&&(e=!1)}),e}function Ya(i){if(i instanceof sa&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Ya(r)&&(e=!1)}),e}function Pr(i,e){if(i instanceof sa&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!Pr(a,e)&&(r=!1)}),r}class Wl{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new Wl(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var gh=Wl;class Vs{constructor(e,r=[],a,u=new Or,_=[]){this.registry=e,this.path=r,this.key=r.map(v=>`[${v}]`).join(""),this.scope=u,this.errors=_,this.expectedType=a}parse(e,r,a,u,_={}){return r?this.concat(r,a,u)._parse(e,_):this._parse(e,_)}_parse(e,r){function a(u,_,v){return v==="assert"?new za(_,[u]):v==="coerce"?new Pa(_,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[u];if(_){let v=_.parse(e,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,A=v.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||A.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(w,A))return null}else v=a(v,w,r.typeAnnotation||"coerce");else v=a(v,w,r.typeAnnotation||"assert")}if(!(v instanceof Fs)&&v.type.kind!=="resolvedImage"&&Nc(v)){const w=new rl;try{v=new Fs(v.type,v.evaluate(w))}catch(A){return this.error(A.message),null}}return v}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const u=typeof e=="number"?this.path.concat(e):this.path,_=a?this.scope.concat(a):this.scope;return new Vs(this.registry,u,r||null,_,this.errors)}error(e,...r){const a=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new dr(a,e))}checkSubtype(e,r){const a=Za(e,r);return a&&this.error(a),a}}var ju=Vs;function Nc(i){if(i instanceof gh)return Nc(i.boundExpression);if(i instanceof sa&&i.name==="error"||i instanceof dc||i instanceof al)return!1;const e=i instanceof Pa||i instanceof za;let r=!0;return i.eachChild(a=>{r=e?r&&Nc(a):r&&a instanceof Fs}),!!r&&wl(i)&&Pr(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function gc(i,e){const r=i.length-1;let a,u,_=0,v=r,w=0;for(;_<=v;)if(w=Math.floor((_+v)/2),a=i[w],u=i[w+1],a<=e){if(w===r||e<u)return w;_=w+1}else{if(!(a>e))throw new Po("Input is not a number.");v=w-1}return 0}class uu{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,_]of a)this.labels.push(u),this.outputs.push(_)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Rt);if(!a)return null;const u=[];let _=null;r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(let v=1;v<e.length;v+=2){const w=v===1?-1/0:e[v],A=e[v+1],C=v,R=v+1;if(typeof w!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(u.length&&u[u.length-1][0]>=w)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const F=r.parse(A,R,_);if(!F)return null;_=_||F.type,u.push([w,F])}return new uu(_,a,u)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const _=r.length;return u>=r[_-1]?a[_-1].evaluate(e):a[gc(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var $l=uu;function Tr(i,e,r){return i*(1-r)+e*r}var Tl=Object.freeze({__proto__:null,array:function(i,e,r){return i.map((a,u)=>Tr(a,e[u],r))},color:function(i,e,r){return new In(Tr(i.r,e.r,r),Tr(i.g,e.g,r),Tr(i.b,e.b,r),Tr(i.a,e.a,r))},number:Tr});const yc=.95047,Ns=1.08883,qu=4/29,ys=6/29,Da=3*ys*ys,Gu=ys*ys*ys,Zu=Math.PI/180,yh=180/Math.PI;function El(i){return i>Gu?Math.pow(i,1/3):i/Da+qu}function Hl(i){return i>ys?i*i*i:Da*(i-qu)}function vc(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function hu(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function jc(i){const e=hu(i.r),r=hu(i.g),a=hu(i.b),u=El((.4124564*e+.3575761*r+.1804375*a)/yc),_=El((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*_-16,a:500*(u-_),b:200*(_-El((.0193339*e+.119192*r+.9503041*a)/Ns)),alpha:i.a}}function vh(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,a=isNaN(i.b)?e:e-i.b/200;return e=1*Hl(e),r=yc*Hl(r),a=Ns*Hl(a),new In(vc(3.2404542*r-1.5371385*e-.4985314*a),vc(-.969266*r+1.8760108*e+.041556*a),vc(.0556434*r-.2040259*e+1.0572252*a),i.alpha)}function pu(i,e,r){const a=e-i;return i+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const Sl={forward:jc,reverse:vh,interpolate:function(i,e,r){return{l:Tr(i.l,e.l,r),a:Tr(i.a,e.a,r),b:Tr(i.b,e.b,r),alpha:Tr(i.alpha,e.alpha,r)}}},Il={forward:function(i){const{l:e,a:r,b:a}=jc(i),u=Math.atan2(a,r)*yh;return{h:u<0?u+360:u,c:Math.sqrt(r*r+a*a),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Zu,r=i.c;return vh({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:pu(i.h,e.h,r),c:Tr(i.c,e.c,r),l:Tr(i.l,e.l,r),alpha:Tr(i.alpha,e.alpha,r)}}};var du=Object.freeze({__proto__:null,hcl:Il,lab:Sl});class Al{constructor(e,r,a,u,_){this.type=e,this.operator=r,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[v,w]of _)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(e,r,a,u){let _=0;if(e.name==="exponential")_=qc(r,e.base,a,u);else if(e.name==="linear")_=qc(r,1,a,u);else if(e.name==="cubic-bezier"){const v=e.controlPoints;_=new Mo(v[0],v[1],v[2],v[3]).solve(qc(r,1,a,u))}return _}static parse(e,r){let[a,u,_,...v]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const C=u[1];if(typeof C!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:C}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const C=u.slice(1);if(C.length!==4||C.some(R=>typeof R!="number"||R<0||R>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(_=r.parse(_,2,Rt),!_)return null;const w=[];let A=null;a==="interpolate-hcl"||a==="interpolate-lab"?A=io:r.expectedType&&r.expectedType.kind!=="value"&&(A=r.expectedType);for(let C=0;C<v.length;C+=2){const R=v[C],F=v[C+1],j=C+3,Z=C+4;if(typeof R!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(w.length&&w[w.length-1][0]>=R)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const $=r.parse(F,Z,A);if(!$)return null;A=A||$.type,w.push([R,$])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new Al(A,a,u,_,w):r.error(`Type ${on(A)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const _=r.length;if(u>=r[_-1])return a[_-1].evaluate(e);const v=gc(r,u),w=Al.interpolationFactor(this.interpolation,u,r[v],r[v+1]),A=a[v].evaluate(e),C=a[v+1].evaluate(e);return this.operator==="interpolate"?Tl[this.type.kind.toLowerCase()](A,C,w):this.operator==="interpolate-hcl"?Il.reverse(Il.interpolate(Il.forward(A),Il.forward(C),w)):Sl.reverse(Sl.interpolate(Sl.forward(A),Sl.forward(C),w))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function qc(i,e,r,a){const u=a-r,_=i-r;return u===0?0:e===1?_/u:(Math.pow(e,_)-1)/(Math.pow(e,u)-1)}var vs=Al;class xc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const u=r.expectedType;u&&u.kind!=="value"&&(a=u);const _=[];for(const w of e.slice(1)){const A=r.parse(w,1+_.length,a,void 0,{typeAnnotation:"omit"});if(!A)return null;a=a||A.type,_.push(A)}const v=u&&_.some(w=>Za(u,w.type));return new xc(v?Xi:a,_)}evaluate(e){let r,a=null,u=0;for(const _ of this.args){if(u++,a=_.evaluate(e),a&&a instanceof aa&&!a.available&&(r||(r=a),a=null,u===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Gc=xc;class bc{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let _=1;_<e.length-1;_+=2){const v=e[_];if(typeof v!="string")return r.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return r.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=r.parse(e[_+1],_+1);if(!w)return null;a.push([v,w])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return u?new bc(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}var sl=bc;class fu{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Rt),u=r.parse(e[2],2,Zn(r.expectedType||Xi));return a&&u?new fu(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Po(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Po(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Po(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var xh=fu;class mu{constructor(e,r){this.type=qi,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Xi),u=r.parse(e[2],2,Xi);return a&&u?Xa(a.type,[qi,Bi,Rt,Un,Xi])?new mu(a,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Wa(r,["boolean","string","number","null"]))throw new Po(`Expected first argument to be of type boolean, string, number or null, but found ${on(An(r))} instead.`);if(!Wa(a,["string","array"]))throw new Po(`Expected second argument to be of type array or string, but found ${on(An(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Zc=mu;class la{constructor(e,r,a){this.type=Rt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Xi),u=r.parse(e[2],2,Xi);if(!a||!u)return null;if(!Xa(a.type,[qi,Bi,Rt,Un,Xi]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(a.type)} instead`);if(e.length===4){const _=r.parse(e[3],3,Rt);return _?new la(a,u,_):null}return new la(a,u)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Wa(r,["boolean","string","number","null"]))throw new Po(`Expected first argument to be of type boolean, string, number or null, but found ${on(An(r))} instead.`);if(!Wa(a,["string","array"]))throw new Po(`Expected second argument to be of type array or string, but found ${on(An(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(r,u)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Xu=la;class Ur{constructor(e,r,a,u,_,v){this.inputType=e,this.type=r,this.input=a,this.cases=u,this.outputs=_,this.otherwise=v}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const _={},v=[];for(let C=2;C<e.length-1;C+=2){let R=e[C];const F=e[C+1];Array.isArray(R)||(R=[R]);const j=r.concat(C);if(R.length===0)return j.error("Expected at least one branch label.");for(const $ of R){if(typeof $!="number"&&typeof $!="string")return j.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return j.error("Numeric branch labels must be integer values.");if(a){if(j.checkSubtype(a,An($)))return null}else a=An($);if(_[String($)]!==void 0)return j.error("Branch labels must be unique.");_[String($)]=v.length}const Z=r.parse(F,C,u);if(!Z)return null;u=u||Z.type,v.push(Z)}const w=r.parse(e[1],1,Xi);if(!w)return null;const A=r.parse(e[e.length-1],e.length-1,u);return A?w.type.kind!=="value"&&r.concat(1).checkSubtype(a,w.type)?null:new Ur(a,u,w,_,v,A):null}evaluate(e){const r=this.input.evaluate(e);return(An(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],u={};for(const v of r){const w=u[this.cases[v]];w===void 0?(u[this.cases[v]]=a.length,a.push([this.cases[v],[v]])):a[w][1].push(v)}const _=v=>this.inputType.kind==="number"?Number(v):v;for(const[v,w]of a)e.push(w.length===1?_(w[0]):w.map(_)),e.push(this.outputs[v].serialize());return e.push(this.otherwise.serialize()),e}}var _u=Ur;class La{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const u=[];for(let v=1;v<e.length-1;v+=2){const w=r.parse(e[v],v,qi);if(!w)return null;const A=r.parse(e[v+1],v+1,a);if(!A)return null;u.push([w,A]),a=a||A.type}const _=r.parse(e[e.length-1],e.length-1,a);return _?new La(a,u,_):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var kr=La;class rn{constructor(e,r,a,u){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Xi),u=r.parse(e[2],2,Rt);if(!a||!u)return null;if(!Xa(a.type,[Zn(Xi),Bi,Xi]))return r.error(`Expected first argument to be of type array or string, but found ${on(a.type)} instead`);if(e.length===4){const _=r.parse(e[3],3,Rt);return _?new rn(a.type,a,u,_):null}return new rn(a.type,a,u)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Wa(r,["string","array"]))throw new Po(`Expected first argument to be of type array or string, but found ${on(An(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(a,u)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ml=rn;function ca(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function wc(i,e,r,a){return a.compare(e,r)===0}function xs(i,e,r){const a=i!=="=="&&i!=="!=";return class H_{constructor(_,v,w){this.type=qi,this.lhs=_,this.rhs=v,this.collator=w,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const w=_[0];let A=v.parse(_[1],1,Xi);if(!A)return null;if(!ca(w,A.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${on(A.type)}'.`);let C=v.parse(_[2],2,Xi);if(!C)return null;if(!ca(w,C.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${on(C.type)}'.`);if(A.type.kind!==C.type.kind&&A.type.kind!=="value"&&C.type.kind!=="value")return v.error(`Cannot compare types '${on(A.type)}' and '${on(C.type)}'.`);a&&(A.type.kind==="value"&&C.type.kind!=="value"?A=new za(C.type,[A]):A.type.kind!=="value"&&C.type.kind==="value"&&(C=new za(A.type,[C])));let R=null;if(_.length===4){if(A.type.kind!=="string"&&C.type.kind!=="string"&&A.type.kind!=="value"&&C.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(R=v.parse(_[3],3,wa),!R)return null}return new H_(A,C,R)}evaluate(_){const v=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(a&&this.hasUntypedArgument){const A=An(v),C=An(w);if(A.kind!==C.kind||A.kind!=="string"&&A.kind!=="number")throw new Po(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${A.kind}, ${C.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const A=An(v),C=An(w);if(A.kind!=="string"||C.kind!=="string")return e(_,v,w)}return this.collator?r(_,v,w,this.collator.evaluate(_)):e(_,v,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[i];return this.eachChild(v=>{_.push(v.serialize())}),_}}}const uo=xs("==",function(i,e,r){return e===r},wc),ho=xs("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!wc(0,e,r,a)}),bh=xs("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),Ro=xs(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),Tc=xs("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),Jt=xs(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class js{constructor(e,r,a,u,_,v){this.type=Bi,this.number=e,this.locale=r,this.currency=a,this.unit=u,this.minFractionDigits=_,this.maxFractionDigits=v}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Rt);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let _=null;if(u.locale&&(_=r.parse(u.locale,1,Bi),!_))return null;let v=null;if(u.currency&&(v=r.parse(u.currency,1,Bi),!v))return null;let w=null;if(u.unit&&(w=r.parse(u.unit,1,Bi),!w))return null;let A=null;if(u["min-fraction-digits"]&&(A=r.parse(u["min-fraction-digits"],1,Rt),!A))return null;let C=null;return u["max-fraction-digits"]&&(C=r.parse(u["max-fraction-digits"],1,Rt),!C)?null:new js(a,_,v,w,A,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Kl{constructor(e){this.type=Rt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${on(a.type)} instead.`):new Kl(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Po(`Expected value to be of type string or array, but found ${on(An(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Ja={"==":uo,"!=":ho,">":Ro,"<":bh,">=":Jt,"<=":Tc,array:za,at:xh,boolean:za,case:kr,coalesce:Gc,collator:dc,format:il,image:ro,in:Zc,"index-of":Xu,interpolate:vs,"interpolate-hcl":vs,"interpolate-lab":vs,length:Kl,let:sl,literal:Fs,match:_u,number:za,"number-format":js,object:za,slice:Ml,step:$l,string:za,"to-boolean":Pa,"to-color":Pa,"to-number":Pa,"to-string":Pa,var:gh,within:al};function Ec(i,[e,r,a,u]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const _=u?u.evaluate(i):1,v=mh(e,r,a,_);if(v)throw new Po(v);return new In(e/255*_,r/255*_,a/255*_,_)}function Mn(i,e){return i in e}function Yl(i,e){const r=e[i];return r===void 0?null:r}function Yt(i){return{type:i}}sa.register(Ja,{error:[{kind:"error"},[Bi],(i,[e])=>{throw new Po(e.evaluate(i))}],typeof:[Bi,[Xi],(i,[e])=>on(An(e.evaluate(i)))],"to-rgba":[Zn(Rt,4),[io],(i,[e])=>e.evaluate(i).toArray()],rgb:[io,[Rt,Rt,Rt],Ec],rgba:[io,[Rt,Rt,Rt,Rt],Ec],has:{type:qi,overloads:[[[Bi],(i,[e])=>Mn(e.evaluate(i),i.properties())],[[Bi,_s],(i,[e,r])=>Mn(e.evaluate(i),r.evaluate(i))]]},get:{type:Xi,overloads:[[[Bi],(i,[e])=>Yl(e.evaluate(i),i.properties())],[[Bi,_s],(i,[e,r])=>Yl(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Xi,[Bi],(i,[e])=>Yl(e.evaluate(i),i.featureState||{})],properties:[_s,[],i=>i.properties()],"geometry-type":[Bi,[],i=>i.geometryType()],id:[Xi,[],i=>i.id()],zoom:[Rt,[],i=>i.globals.zoom],pitch:[Rt,[],i=>i.globals.pitch||0],"distance-from-center":[Rt,[],i=>i.distanceFromCenter()],"heatmap-density":[Rt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Rt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Rt,[],i=>i.globals.skyRadialProgress||0],accumulated:[Xi,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Rt,Yt(Rt),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[Rt,Yt(Rt),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:Rt,overloads:[[[Rt,Rt],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Rt],(i,[e])=>-e.evaluate(i)]]},"/":[Rt,[Rt,Rt],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Rt,[Rt,Rt],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Rt,[Rt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Rt,[Rt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Rt,[Rt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Rt,[Rt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Rt,[Rt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Rt,[Rt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Rt,[Rt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Rt,[Rt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Rt,[Rt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Rt,[Rt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Rt,Yt(Rt),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Rt,Yt(Rt),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Rt,[Rt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Rt,[Rt],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Rt,[Rt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Rt,[Rt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[qi,[Bi,Xi],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[qi,[Xi],(i,[e])=>i.id()===e.value],"filter-type-==":[qi,[Bi],(i,[e])=>i.geometryType()===e.value],"filter-<":[qi,[Bi,Xi],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a<u}],"filter-id-<":[qi,[Xi],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[qi,[Bi,Xi],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a>u}],"filter-id->":[qi,[Xi],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[qi,[Bi,Xi],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[qi,[Xi],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[qi,[Bi,Xi],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[qi,[Xi],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[qi,[Xi],(i,[e])=>e.value in i.properties()],"filter-has-id":[qi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[qi,[Zn(Bi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[qi,[Zn(Xi)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[qi,[Bi,Zn(Xi)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[qi,[Bi,Zn(Xi)],(i,[e,r])=>function(a,u,_,v){for(;_<=v;){const w=_+v>>1;if(u[w]===a)return!0;u[w]>a?v=w-1:_=w+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:qi,overloads:[[[qi,qi],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Yt(qi),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:qi,overloads:[[[qi,qi],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Yt(qi),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[qi,[qi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[qi,[Bi],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Bi,[Bi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Bi,[Bi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Bi,Yt(Xi),(i,e)=>e.map(r=>$a(r.evaluate(i))).join("")],"resolved-locale":[Bi,[wa],(i,[e])=>e.evaluate(i).resolvedLocale()]});var ua=Ja;function Cl(i){return{result:"success",value:i}}function Ra(i){return{result:"error",value:i}}function Jl(i){return i["property-type"]==="data-driven"}function Ql(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function gu(i){return!!i.expression&&i.expression.interpolated}function vr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ta(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function ll(i){return i}function Sc(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",u=a||!(a||i.property!==void 0),_=i.type||(gu(e)?"exponential":"interval");if(r&&((i=dn({},i)).stops&&(i.stops=i.stops.map(C=>[C[0],In.parse(C[1])])),i.default=In.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!du[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let v,w,A;if(_==="exponential")v=Ko;else if(_==="interval")v=bs;else if(_==="categorical"){v=Ho,w=Object.create(null);for(const C of i.stops)w[C[0]]=C[1];A=typeof i.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);v=Xc}if(a){const C={},R=[];for(let Z=0;Z<i.stops.length;Z++){const $=i.stops[Z],J=$[0].zoom;C[J]===void 0&&(C[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},R.push(J)),C[J].stops.push([$[0].value,$[1]])}const F=[];for(const Z of R)F.push([C[Z].zoom,Sc(C[Z],e)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:vs.interpolationFactor.bind(void 0,j),zoomStops:F.map(Z=>Z[0]),evaluate:({zoom:Z},$)=>Ko({stops:F,base:i.base},e,Z).evaluate(Z,$)}}if(u){const C=_==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:vs.interpolationFactor.bind(void 0,C),zoomStops:i.stops.map(R=>R[0]),evaluate:({zoom:R})=>v(i,e,R,w,A)}}return{kind:"source",evaluate(C,R){const F=R&&R.properties?R.properties[i.property]:void 0;return F===void 0?zl(i.default,e.default):v(i,e,F,w,A)}}}function zl(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Ho(i,e,r,a,u){return zl(typeof r===u?a[r]:void 0,i.default,e.default)}function bs(i,e,r){if(vr(r)!=="number")return zl(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const u=gc(i.stops.map(_=>_[0]),r);return i.stops[u][1]}function Ko(i,e,r){const a=i.base!==void 0?i.base:1;if(vr(r)!=="number")return zl(i.default,e.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const _=gc(i.stops.map(R=>R[0]),r),v=function(R,F,j,Z){const $=Z-j,J=R-j;return $===0?0:F===1?J/$:(Math.pow(F,J)-1)/(Math.pow(F,$)-1)}(r,a,i.stops[_][0],i.stops[_+1][0]),w=i.stops[_][1],A=i.stops[_+1][1];let C=Tl[e.type]||ll;if(i.colorSpace&&i.colorSpace!=="rgb"){const R=du[i.colorSpace];C=(F,j)=>R.reverse(R.interpolate(R.forward(F),R.forward(j),v))}return typeof w.evaluate=="function"?{evaluate(...R){const F=w.evaluate.apply(void 0,R),j=A.evaluate.apply(void 0,R);if(F!==void 0&&j!==void 0)return C(F,j,v)}}:C(w,A,v)}function Xc(i,e,r){return e.type==="color"?r=In.parse(r):e.type==="formatted"?r=Lo.fromString(r.toString()):e.type==="resolvedImage"?r=aa.fromString(r.toString()):vr(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),zl(r,i.default,e.default)}class Pl{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new rl,this._defaultValue=r?function(a){return a.type==="color"&&(Ta(a.default)||Array.isArray(a.default))?new In(0,0,0,0):a.type==="color"?In.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,u,_,v,w,A){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,u,_,v,w,A){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=A||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new Po(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function cl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ua}function Qa(i,e){const r=new ju(ua,[],e?function(u){const _={color:io,string:Bi,number:Rt,enum:Bi,boolean:qi,formatted:Ga,resolvedImage:Mr};return u.type==="array"?Zn(_[u.value]||Xi,u.length):_[u.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Cl(new Pl(a,e)):Ra(r.errors)}class Bo{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Ya(r.expression)}evaluateWithoutErrorHandling(e,r,a,u,_,v){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,_,v)}evaluate(e,r,a,u,_,v){return this._styleExpression.evaluate(e,r,a,u,_,v)}}class qr{constructor(e,r,a,u){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ya(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,a,u,_,v){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,_,v)}evaluate(e,r,a,u,_,v){return this._styleExpression.evaluate(e,r,a,u,_,v)}interpolationFactor(e,r,a){return this.interpolationType?vs.interpolationFactor(this.interpolationType,e,r,a):0}}function es(i,e){if((i=Qa(i,e)).result==="error")return i;const r=i.value.expression,a=wl(r);if(!a&&!Jl(e))return Ra([new dr("","data expressions not supported")]);const u=Pr(r,["zoom","pitch","distance-from-center"]);if(!u&&!Ql(e))return Ra([new dr("","zoom expressions not supported")]);const _=is(r);return _||u?_ instanceof dr?Ra([_]):_ instanceof vs&&!gu(e)?Ra([new dr("",'"interpolate" expressions cannot be used with this property')]):Cl(_?new qr(a?"camera":"composite",i.value,_.labels,_ instanceof vs?_.interpolation:void 0):new Bo(a?"constant":"source",i.value)):Ra([new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ts{constructor(e,r){this._parameters=e,this._specification=r,dn(this,Sc(this._parameters,this._specification))}static deserialize(e){return new ts(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function is(i){let e=null;if(i instanceof sl)e=is(i.result);else if(i instanceof Gc){for(const r of i.args)if(e=is(r),e)break}else(i instanceof $l||i instanceof vs)&&i.input instanceof sa&&i.input.name==="zoom"&&(e=i);return e instanceof dr||i.eachChild(r=>{const a=is(r);a instanceof dr?e=a:!e&&a?e=new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ti{constructor(e,r,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function go(i){const e=i.key,r=i.value,a=i.valueSpec||{},u=i.objectElementValidators||{},_=i.style,v=i.styleSpec;let w=[];const A=vr(r);if(A!=="object")return[new ti(e,r,`object expected, ${A} found`)];for(const C in r){const R=C.split(".")[0];let F;u[R]?F=u[R]:a[R]?F=Nt:u["*"]?F=u["*"]:a["*"]&&(F=Nt),F?w=w.concat(F({key:(e&&`${e}.`)+C,value:r[C],valueSpec:a[R]||a["*"],style:_,styleSpec:v,object:r,objectKey:C},r)):w.push(new ti(e,r[C],`unknown property "${C}"`))}for(const C in a)u[C]||a[C].required&&a[C].default===void 0&&r[C]===void 0&&w.push(new ti(e,r,`missing required property "${C}"`));return w}function ec(i){const e=i.value,r=i.valueSpec,a=i.style,u=i.styleSpec,_=i.key,v=i.arrayElementValidator||Nt;if(vr(e)!=="array")return[new ti(_,e,`array expected, ${vr(e)} found`)];if(r.length&&e.length!==r.length)return[new ti(_,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ti(_,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let w={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};u.$version<7&&(w.function=r.function),vr(r.value)==="object"&&(w=r.value);let A=[];for(let C=0;C<e.length;C++)A=A.concat(v({array:e,arrayIndex:C,value:e[C],valueSpec:w,style:a,styleSpec:u,key:`${_}[${C}]`}));return A}function $n(i){const e=i.key,r=i.value,a=i.valueSpec;let u=vr(r);if(u==="number"&&r!=r&&(u="NaN"),u!=="number")return[new ti(e,r,`number expected, ${u} found`)];if("minimum"in a){let _=a.minimum;if(vr(a.minimum)==="array"&&(_=a.minimum[i.arrayIndex]),r<_)return[new ti(e,r,`${r} is less than the minimum value ${_}`)]}if("maximum"in a){let _=a.maximum;if(vr(a.maximum)==="array"&&(_=a.maximum[i.arrayIndex]),r>_)return[new ti(e,r,`${r} is greater than the maximum value ${_}`)]}return[]}function Yo(i){const e=i.valueSpec,r=Qi(i.value.type);let a,u,_,v={};const w=r!=="categorical"&&i.value.property===void 0,A=!w,C=vr(i.value.stops)==="array"&&vr(i.value.stops[0])==="array"&&vr(i.value.stops[0][0])==="object",R=go({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Z){if(r==="identity")return[new ti(Z.key,Z.value,'identity function may not have a "stops" property')];let $=[];const J=Z.value;return $=$.concat(ec({key:Z.key,value:J,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:F})),vr(J)==="array"&&J.length===0&&$.push(new ti(Z.key,J,"array must have at least one stop")),$},default:function(Z){return Nt({key:Z.key,value:Z.value,valueSpec:e,style:Z.style,styleSpec:Z.styleSpec})}}});return r==="identity"&&w&&R.push(new ti(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||R.push(new ti(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!gu(i.valueSpec)&&R.push(new ti(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(A&&!Jl(i.valueSpec)?R.push(new ti(i.key,i.value,"property functions not supported")):w&&!Ql(i.valueSpec)&&R.push(new ti(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!C||i.value.property!==void 0||R.push(new ti(i.key,i.value,'"property" property is required')),R;function F(Z){let $=[];const J=Z.value,se=Z.key;if(vr(J)!=="array")return[new ti(se,J,`array expected, ${vr(J)} found`)];if(J.length!==2)return[new ti(se,J,`array length 2 expected, length ${J.length} found`)];if(C){if(vr(J[0])!=="object")return[new ti(se,J,`object expected, ${vr(J[0])} found`)];if(J[0].zoom===void 0)return[new ti(se,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new ti(se,J,"object stop key must have value")];const ye=Qi(J[0].zoom);if(typeof ye!="number")return[new ti(se,J[0].zoom,"stop zoom values must be numbers")];if(_&&_>ye)return[new ti(se,J[0].zoom,"stop zoom values must appear in ascending order")];ye!==_&&(_=ye,u=void 0,v={}),$=$.concat(go({key:`${se}[0]`,value:J[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:$n,value:j}}))}else $=$.concat(j({key:`${se}[0]`,value:J[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},J));return cl(_r(J[1]))?$.concat([new ti(`${se}[1]`,J[1],"expressions are not allowed in function stops.")]):$.concat(Nt({key:`${se}[1]`,value:J[1],valueSpec:e,style:Z.style,styleSpec:Z.styleSpec}))}function j(Z,$){const J=vr(Z.value),se=Qi(Z.value),ye=Z.value!==null?Z.value:$;if(a){if(J!==a)return[new ti(Z.key,ye,`${J} stop domain type must match previous stop domain type ${a}`)]}else a=J;if(J!=="number"&&J!=="string"&&J!=="boolean"&&typeof se!="number"&&typeof se!="string"&&typeof se!="boolean")return[new ti(Z.key,ye,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&r!=="categorical"){let Pe=`number expected, ${J} found`;return Jl(e)&&r===void 0&&(Pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ti(Z.key,ye,Pe)]}return r!=="categorical"||J!=="number"||typeof se=="number"&&isFinite(se)&&Math.floor(se)===se?r!=="categorical"&&J==="number"&&typeof se=="number"&&typeof u=="number"&&u!==void 0&&se<u?[new ti(Z.key,ye,"stop domain values must appear in ascending order")]:(u=se,r==="categorical"&&se in v?[new ti(Z.key,ye,"stop domain values must be unique")]:(v[se]=!0,[])):[new ti(Z.key,ye,`integer expected, found ${String(se)}`)]}}function ai(i){const e=(i.expressionContext==="property"?es:Qa)(_r(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new ti(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ti(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ya(r))return[new ti(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Mi(r,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Pr(r,["zoom","feature-state"]))return[new ti(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!wl(r))return[new ti(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Mi(i,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)r.delete(u);if(r.size===0)return[];const a=[];return i instanceof sa&&r.has(i.name)?[new ti(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(u=>{a.push(...Mi(u,e))}),a)}function kl(i){const e=i.key,r=i.value,a=i.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(Qi(r))===-1&&u.push(new ti(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Qi(r))===-1&&u.push(new ti(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function h(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!h(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function d(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};h(i)||(i=G(i));const r=i;let a=!0;try{a=function(C){if(!I(C))return C;let R=_r(C);return y(R),R=p(R),R}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const u=lt[`filter_${e}`],_=Qa(a,u);let v=null;if(_.result==="error")throw new Error(_.value.map(C=>`${C.key}: ${C.message}`).join(", "));v=(C,R,F)=>_.value.evaluate(C,R,{},F);let w=null,A=null;if(a!==r){const C=Qa(r,u);if(C.result==="error")throw new Error(C.value.map(R=>`${R.key}: ${R.message}`).join(", "));w=(R,F,j,Z,$)=>C.value.evaluate(R,F,{},j,void 0,void 0,Z,$),A=!wl(C.value.expression)}return{filter:v,dynamicFilter:w||void 0,needGeometry:O(a),needFeature:!!A}}function p(i){if(!Array.isArray(i))return i;const e=function(r){if(P.has(r[0])){for(let a=1;a<r.length;a++)if(I(r[a]))return!0}return r}(i);return e===!0?e:e.map(r=>p(r))}function y(i){let e=!1;const r=[];if(i[0]==="case"){for(let a=1;a<i.length-1;a+=2)e=e||I(i[a]),r.push(i[a+1]);r.push(i[i.length-1])}else if(i[0]==="match"){e=e||I(i[1]);for(let a=2;a<i.length-1;a+=2)r.push(i[a+1]);r.push(i[i.length-1])}else if(i[0]==="step"){e=e||I(i[1]);for(let a=1;a<i.length-1;a+=2)r.push(i[a+1])}e&&(i.length=0,i.push("any",...r));for(let a=1;a<i.length;a++)y(i[a])}function I(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<i.length;r++)if(I(i[r]))return!0;return!1}const P=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function D(i,e){return i<e?-1:i>e?1:0}function O(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(O(i[e]))return!0;return!1}function G(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Q(i[1],i[2],"=="):e==="!="?Se(Q(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Q(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(G))):e==="all"?["all"].concat(i.slice(1).map(G)):e==="none"?["all"].concat(i.slice(1).map(G).map(Se)):e==="in"?oe(i[1],i.slice(2)):e==="!in"?Se(oe(i[1],i.slice(2))):e==="has"?_e(i[1]):e==="!has"?Se(_e(i[1])):e!=="within"||i;var r}function Q(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function oe(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(D)]]:["filter-in-small",i,["literal",e]]}}function _e(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Se(i){return["!",i]}function Te(i){return h(_r(i.value))?ai(dn({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):ge(i)}function ge(i){const e=i.value,r=i.key;if(vr(e)!=="array")return[new ti(r,e,`array expected, ${vr(e)} found`)];const a=i.styleSpec;let u,_=[];if(e.length<1)return[new ti(r,e,"filter array must have at least 1 element")];switch(_=_.concat(kl({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Qi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Qi(e[1])==="$type"&&_.push(new ti(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&_.push(new ti(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=vr(e[1]),u!=="string"&&_.push(new ti(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let v=2;v<e.length;v++)u=vr(e[v]),Qi(e[1])==="$type"?_=_.concat(kl({key:`${r}[${v}]`,value:e[v],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&_.push(new ti(`${r}[${v}]`,e[v],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let v=1;v<e.length;v++)_=_.concat(ge({key:`${r}[${v}]`,value:e[v],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=vr(e[1]),e.length!==2?_.push(new ti(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&_.push(new ti(`${r}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=vr(e[1]),e.length!==2?_.push(new ti(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&_.push(new ti(`${r}[1]`,e[1],`object expected, ${u} found`))}return _}function be(i,e){const r=i.key,a=i.style,u=i.styleSpec,_=i.value,v=i.objectKey,w=u[`${e}_${i.layerType}`];if(!w)return[];const A=v.match(/^(.*)-transition$/);if(e==="paint"&&A&&w[A[1]]&&w[A[1]].transition)return Nt({key:r,value:_,valueSpec:u.transition,style:a,styleSpec:u});const C=i.valueSpec||w[v];if(!C)return[new ti(r,_,`unknown property "${v}"`)];let R;if(vr(_)==="string"&&Jl(C)&&!C.tokens&&(R=/^{([^}]+)}$/.exec(_))){const j=`\`{ "type": "identity", "property": ${R?JSON.stringify(R[1]):'"_"'} }\``;return[new ti(r,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}const F=[];return i.layerType==="symbol"&&(v==="text-field"&&a&&!a.glyphs&&F.push(new ti(r,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Ta(_r(_))&&Qi(_.type)==="identity"&&F.push(new ti(r,_,'"text-font" does not support identity functions'))),F.concat(Nt({key:i.key,value:_,valueSpec:C,style:a,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:v}))}function We(i){return be(i,"paint")}function Ne(i){return be(i,"layout")}function et(i){let e=[];const r=i.value,a=i.key,u=i.style,_=i.styleSpec;r.type||r.ref||e.push(new ti(a,r,'either "type" or "ref" is required'));let v=Qi(r.type);const w=Qi(r.ref);if(r.id){const A=Qi(r.id);for(let C=0;C<i.arrayIndex;C++){const R=u.layers[C];Qi(R.id)===A&&e.push(new ti(a,r.id,`duplicate layer id "${r.id}", previously used at line ${R.id.__line__}`))}}if("ref"in r){let A;["type","source","source-layer","filter","layout"].forEach(C=>{C in r&&e.push(new ti(a,r[C],`"${C}" is prohibited for ref layers`))}),u.layers.forEach(C=>{Qi(C.id)===w&&(A=C)}),A?A.ref?e.push(new ti(a,r.ref,"ref cannot reference another ref layer")):v=Qi(A.type):typeof w=="string"&&e.push(new ti(a,r.ref,`ref layer "${w}" not found`))}else if(v!=="background"&&v!=="sky")if(r.source){const A=u.sources&&u.sources[r.source],C=A&&Qi(A.type);A?C==="vector"&&v==="raster"?e.push(new ti(a,r.source,`layer "${r.id}" requires a raster source`)):C==="raster"&&v!=="raster"?e.push(new ti(a,r.source,`layer "${r.id}" requires a vector source`)):C!=="vector"||r["source-layer"]?C==="raster-dem"&&v!=="hillshade"?e.push(new ti(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||C==="geojson"&&A.lineMetrics||e.push(new ti(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ti(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ti(a,r.source,`source "${r.source}" not found`))}else e.push(new ti(a,r,'missing required property "source"'));return e=e.concat(go({key:a,value:r,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Nt({key:`${a}.type`,value:r.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:A=>Te(dn({layerType:v},A)),layout:A=>go({layer:r,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":C=>Ne(dn({layerType:v},C))}}),paint:A=>go({layer:r,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":C=>We(dn({layerType:v},C))}})}})),e}function Je(i){const e=i.value,r=i.key,a=vr(e);return a!=="string"?[new ti(r,e,`string expected, ${a} found`)]:[]}const ot={promoteId:function({key:i,value:e}){if(vr(e)==="string")return Je({key:i,value:e});{const r=[];for(const a in e)r.push(...Je({key:`${i}.${a}`,value:e[a]}));return r}}};function gt(i){const e=i.value,r=i.key,a=i.styleSpec,u=i.style;if(!e.type)return[new ti(r,e,'"type" is required')];const _=Qi(e.type);let v;switch(_){case"vector":case"raster":case"raster-dem":return v=go({key:r,value:e,valueSpec:a[`source_${_.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:ot}),v;case"geojson":if(v=go({key:r,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:ot}),e.cluster)for(const w in e.clusterProperties){const[A,C]=e.clusterProperties[w],R=typeof A=="string"?[A,["accumulated"],["get",w]]:A;v.push(...ai({key:`${r}.${w}.map`,value:C,expressionContext:"cluster-map"})),v.push(...ai({key:`${r}.${w}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return v;case"video":return go({key:r,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return go({key:r,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new ti(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return kl({key:`${r}.type`,value:e.type,valueSpec:{values:Ct(a)},style:u,styleSpec:a})}}function Ct(i){return i.source.reduce((e,r)=>{const a=i[r];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Vt(i){const e=i.value,r=i.styleSpec,a=r.light,u=i.style;let _=[];const v=vr(e);if(e===void 0)return _;if(v!=="object")return _=_.concat([new ti("light",e,`object expected, ${v} found`)]),_;for(const w in e){const A=w.match(/^(.*)-transition$/);_=_.concat(A&&a[A[1]]&&a[A[1]].transition?Nt({key:w,value:e[w],valueSpec:r.transition,style:u,styleSpec:r}):a[w]?Nt({key:w,value:e[w],valueSpec:a[w],style:u,styleSpec:r}):[new ti(w,e[w],`unknown property "${w}"`)])}return _}function fi(i){const e=i.value,r=i.key,a=i.style,u=i.styleSpec,_=u.terrain;let v=[];const w=vr(e);if(e===void 0)return v;if(w!=="object")return v=v.concat([new ti("terrain",e,`object expected, ${w} found`)]),v;for(const A in e){const C=A.match(/^(.*)-transition$/);v=v.concat(C&&_[C[1]]&&_[C[1]].transition?Nt({key:A,value:e[A],valueSpec:u.transition,style:a,styleSpec:u}):_[A]?Nt({key:A,value:e[A],valueSpec:_[A],style:a,styleSpec:u}):[new ti(A,e[A],`unknown property "${A}"`)])}if(e.source){const A=a.sources&&a.sources[e.source],C=A&&Qi(A.type);A?C!=="raster-dem"&&v.push(new ti(r,e.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):v.push(new ti(r,e.source,`source "${e.source}" not found`))}else v.push(new ti(r,e,'terrain is missing required property "source"'));return v}function ei(i){const e=i.value,r=i.style,a=i.styleSpec,u=a.fog;let _=[];const v=vr(e);if(e===void 0)return _;if(v!=="object")return _=_.concat([new ti("fog",e,`object expected, ${v} found`)]),_;for(const w in e){const A=w.match(/^(.*)-transition$/);_=_.concat(A&&u[A[1]]&&u[A[1]].transition?Nt({key:w,value:e[w],valueSpec:a.transition,style:r,styleSpec:a}):u[w]?Nt({key:w,value:e[w],valueSpec:u[w],style:r,styleSpec:a}):[new ti(w,e[w],`unknown property "${w}"`)])}return _}const ni={"*":()=>[],array:ec,boolean:function(i){const e=i.value,r=i.key,a=vr(e);return a!=="boolean"?[new ti(r,e,`boolean expected, ${a} found`)]:[]},number:$n,color:function(i){const e=i.key,r=i.value,a=vr(r);return a!=="string"?[new ti(e,r,`color expected, ${a} found`)]:hc(r)===null?[new ti(e,r,`color expected, "${r}" found`)]:[]},enum:kl,filter:Te,function:Yo,layer:et,object:go,source:gt,light:Vt,terrain:fi,fog:ei,string:Je,formatted:function(i){return Je(i).length===0?[]:ai(i)},resolvedImage:function(i){return Je(i).length===0?[]:ai(i)},projection:function(i){const e=i.value,r=i.styleSpec,a=r.projection,u=i.style;let _=[];const v=vr(e);if(v==="object")for(const w in e)_=_.concat(Nt({key:w,value:e[w],valueSpec:a[w],style:u,styleSpec:r}));else v!=="string"&&(_=_.concat([new ti("projection",e,`object or string expected, ${v} found`)]));return _}};function Nt(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return r.expression&&Ta(Qi(e))?Yo(i):r.expression&&cl(_r(e))?ai(i):r.type&&ni[r.type]?ni[r.type](i):go(dn({},i,{valueSpec:r.type?a[r.type]:r}))}function Hi(i){const e=i.value,r=i.key,a=Je(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new ti(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new ti(r,e,'"glyphs" url must include a "{range}" token'))),a}function Ii(i,e=lt){return Pi(Nt({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Hi,"*":()=>[]}}))}const Vi=i=>Pi(We(i)),Ni=i=>Pi(Ne(i));function Pi(i){return i.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function ji(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new zr(new Error(a.message))),r=!0;return r}var Dr=gr,Ri=3;function gr(i,e,r){var a=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var u=new Int32Array(this.arrayBuffer);i=u[0],this.d=(e=u[1])+2*(r=u[2]);for(var _=0;_<this.d*this.d;_++){var v=u[Ri+_],w=u[Ri+_+1];a.push(v===w?null:u.subarray(v,w))}var A=u[Ri+a.length+1];this.keys=u.subarray(u[Ri+a.length],A),this.bboxes=u.subarray(A),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var C=0;C<this.d*this.d;C++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=r,this.scale=e/i,this.uid=0;var R=r/e*i;this.min=-R,this.max=i+R}gr.prototype.insert=function(i,e,r,a,u){this._forEachCell(e,r,a,u,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u)},gr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},gr.prototype._insertCell=function(i,e,r,a,u,_){this.cells[u].push(_)},gr.prototype.query=function(i,e,r,a,u){var _=this.min,v=this.max;if(i<=_&&e<=_&&v<=r&&v<=a&&!u)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(i,e,r,a,this._queryCell,w,{},u),w},gr.prototype._queryCell=function(i,e,r,a,u,_,v,w){var A=this.cells[u];if(A!==null)for(var C=this.keys,R=this.bboxes,F=0;F<A.length;F++){var j=A[F];if(v[j]===void 0){var Z=4*j;(w?w(R[Z+0],R[Z+1],R[Z+2],R[Z+3]):i<=R[Z+2]&&e<=R[Z+3]&&r>=R[Z+0]&&a>=R[Z+1])?(v[j]=!0,_.push(C[j])):v[j]=!1}}},gr.prototype._forEachCell=function(i,e,r,a,u,_,v,w){for(var A=this._convertToCellCoord(i),C=this._convertToCellCoord(e),R=this._convertToCellCoord(r),F=this._convertToCellCoord(a),j=A;j<=R;j++)for(var Z=C;Z<=F;Z++){var $=this.d*Z+j;if((!w||w(this._convertFromCellCoord(j),this._convertFromCellCoord(Z),this._convertFromCellCoord(j+1),this._convertFromCellCoord(Z+1)))&&u.call(this,i,e,r,a,$,_,v,w))return}},gr.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},gr.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},gr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=Ri+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var u=new Int32Array(e+r+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var _=e,v=0;v<i.length;v++){var w=i[v];u[Ri+v]=_,u.set(w,_),_+=w.length}return u[Ri+i.length]=_,u.set(this.keys,_),u[Ri+i.length+1]=_+=this.keys.length,u.set(this.bboxes,_),_+=this.bboxes.length,u.buffer};var fr=_o(Dr);const xr={};function Ft(i,e,r={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),xr[e]={klass:i,omit:r.omit||[]}}Ft(Object,"Object"),fr.serialize=function(i,e){const r=i.toArrayBuffer();return e&&e.push(r),{buffer:r}},fr.deserialize=function(i){return new fr(i.buffer)},Object.defineProperty(fr,"name",{value:"Grid"}),Ft(fr,"Grid"),Ft(In,"Color"),Ft(Error,"Error"),Ft(qa,"AJAXError"),Ft(aa,"ResolvedImage"),Ft(ts,"StylePropertyFunction"),Ft(Pl,"StyleExpression",{omit:["_evaluator"]}),Ft(qr,"ZoomDependentExpression"),Ft(Bo,"ZoomConstantExpression"),Ft(sa,"CompoundExpression",{omit:["_evaluate"]});for(const i in ua)xr[ua[i]._classRegistryKey]||Ft(ua[i],`Expression${i}`);function Vn(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Cn(i){return st.ImageBitmap&&i instanceof st.ImageBitmap}function Fo(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Vn(i)||Cn(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof st.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(Fo(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const u=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(const _ in i)i.hasOwnProperty(_)&&(xr[a].omit.indexOf(_)>=0||(u[_]=Fo(i[_],e)));i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof i)}function Lr(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Vn(i)||Cn(i)||ArrayBuffer.isView(i)||i instanceof st.ImageData)return i;if(Array.isArray(i))return i.map(Lr);if(typeof i=="object"){const e=i.$name||"Object",{klass:r}=xr[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const u of Object.keys(i))u!=="$name"&&(a[u]=Lr(i[u]));return a}throw new Error("can't deserialize object of type "+typeof i)}const $t={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function qs(i){for(const e of i)if(ul(e.charCodeAt(0)))return!0;return!1}function tc(i){for(const e of i)if(!ha(e.charCodeAt(0)))return!1;return!0}function ha(i){return!($t.Arabic(i)||$t["Arabic Supplement"](i)||$t["Arabic Extended-A"](i)||$t["Arabic Presentation Forms-A"](i)||$t["Arabic Presentation Forms-B"](i))}function ul(i){return!(i!==746&&i!==747&&(i<4352||!($t["Bopomofo Extended"](i)||$t.Bopomofo(i)||$t["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||$t["CJK Compatibility Ideographs"](i)||$t["CJK Compatibility"](i)||$t["CJK Radicals Supplement"](i)||$t["CJK Strokes"](i)||!(!$t["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||$t["CJK Unified Ideographs Extension A"](i)||$t["CJK Unified Ideographs"](i)||$t["Enclosed CJK Letters and Months"](i)||$t["Hangul Compatibility Jamo"](i)||$t["Hangul Jamo Extended-A"](i)||$t["Hangul Jamo Extended-B"](i)||$t["Hangul Jamo"](i)||$t["Hangul Syllables"](i)||$t.Hiragana(i)||$t["Ideographic Description Characters"](i)||$t.Kanbun(i)||$t["Kangxi Radicals"](i)||$t["Katakana Phonetic Extensions"](i)||$t.Katakana(i)&&i!==12540||!(!$t["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!$t["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||$t["Unified Canadian Aboriginal Syllabics"](i)||$t["Unified Canadian Aboriginal Syllabics Extended"](i)||$t["Vertical Forms"](i)||$t["Yijing Hexagram Symbols"](i)||$t["Yi Syllables"](i)||$t["Yi Radicals"](i))))}function ic(i){return!(ul(i)||function(e){return!!($t["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||$t["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||$t["Letterlike Symbols"](e)||$t["Number Forms"](e)||$t["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||$t["Control Pictures"](e)&&e!==9251||$t["Optical Character Recognition"](e)||$t["Enclosed Alphanumerics"](e)||$t["Geometric Shapes"](e)||$t["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||$t["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||$t["CJK Symbols and Punctuation"](e)||$t.Katakana(e)||$t["Private Use Area"](e)||$t["CJK Compatibility Forms"](e)||$t["Small Form Variants"](e)||$t["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function rs(i){return i>=1424&&i<=2303||$t["Arabic Presentation Forms-A"](i)||$t["Arabic Presentation Forms-B"](i)}function Wc(i,e){return!(!e&&rs(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||$t.Khmer(i))}function Ic(i){for(const e of i)if(rs(e.charCodeAt(0)))return!0;return!1}const ws="deferred",Ba="loading",Ac="loaded";let Fa=null,m="unavailable",n=null;const l=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(m="error"),Fa&&Fa(i)};function g(){x.fire(new ir("pluginStateChange",{pluginStatus:m,pluginURL:n}))}const x=new Ei,E=function(){return m},z=function(){if(m!==ws||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");m=Ba,g(),n&&Rs({url:n},i=>{i?l(i):(m=Ac,g())})},k={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>m===Ac||k.applyArabicShaping!=null,isLoading:()=>m===Ba,setState(i){m=i.pluginStatus,n=i.pluginURL},isParsed:()=>k.applyArabicShaping!=null&&k.processBidirectionalText!=null&&k.processStyledBidirectionalText!=null,getPluginURL:()=>n};class B{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,a){for(const u of r)if(!Wc(u.charCodeAt(0),a))return!1;return!0}(e,k.isLoaded())}}class q{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,u){if(Ta(a))return new ts(a,u);if(cl(a)){const _=es(a,u);if(_.result==="error")throw new Error(_.value.map(v=>`${v.key}: ${v.message}`).join(", "));return _.value}{let _=a;return typeof a=="string"&&u.type==="color"&&(_=In.parse(a)),{kind:"constant",evaluate:()=>_}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class N{constructor(e){this.property=e,this.value=new q(e,void 0)}transitioned(e,r){return new ne(this.property,this.value,r,Gn({},e.transition,this.transition),e.now)}untransitioned(){return new ne(this.property,this.value,null,{},0)}}class H{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ui(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new N(this._values[e].property)),this._values[e].value=new q(this._values[e].property,r===null?void 0:Ui(r))}getTransition(e){return Ui(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new N(this._values[e].property)),this._values[e].transition=Ui(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const a=new ce(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,r._values[u]);return a}untransitioned(){const e=new ce(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class ne{constructor(e,r,a,u,_){const v=u.delay||0,w=u.duration||0;_=_||0,this.property=e,this.value=r,this.begin=_+v,this.end=this.begin+w,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const u=e.now||0,_=this.value.possiblyEvaluate(e,r,a),v=this.prior;if(v){if(u>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(u<this.begin)return v.possiblyEvaluate(e,r,a);{const w=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(e,r,a),_,fa(w))}}return _}}class ce{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const u=new de(this._properties);for(const _ of Object.keys(this._values))u._values[_]=this._values[_].possiblyEvaluate(e,r,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ui(this._values[e].value)}setValue(e,r){this._values[e]=new q(this._values[e].property,r===null?void 0:Ui(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const u=new de(this._properties);for(const _ of Object.keys(this._values))u._values[_]=this._values[_].possiblyEvaluate(e,r,a);return u}}class me{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,u){return this.property.evaluate(this.value,this.parameters,e,r,a,u)}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Y{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const u=Tl[this.specification.type];return u?u(e,r,a):e}}class ue{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,u){return new me(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,u)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new me(this,{kind:"constant",value:void 0},e.parameters);const u=Tl[this.specification.type];return u?new me(this,{kind:"constant",value:u(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,u,_,v){return e.kind==="constant"?e.value:e.evaluate(r,a,u,_,v)}}class we{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){return!!e.expression.evaluate(r,null,{},a,u)}interpolate(){return!1}}class Ee{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new B(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const _=this.defaultPropertyValues[a]=new q(u,void 0),v=this.defaultTransitionablePropertyValues[a]=new N(u);this.defaultTransitioningPropertyValues[a]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=_.possiblyEvaluate(r)}}}function Fe(i,e){return 256*(i=or(Math.floor(i),0,255))+or(Math.floor(e),0,255)}Ft(ue,"DataDrivenProperty"),Ft(Y,"DataConstantProperty"),Ft(we,"ColorRampProperty");const qe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class je{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ke{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $e(i,e=1){let r=0,a=0;return{members:i.map(u=>{const _=qe[u.type].BYTES_PER_ELEMENT,v=r=ct(r,Math.max(e,_)),w=u.components||1;return a=Math.max(a,_),r+=_*w,{name:u.name,type:u.type,components:w,offset:v}}),size:ct(r,Math.max(a,e)),alignment:e}}function ct(i,e){return Math.ceil(i/e)*e}class Bt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=a,e}}Bt.prototype.bytesPerElement=4,Ft(Bt,"StructArrayLayout2i4");class nt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const _=3*e;return this.int16[_+0]=r,this.int16[_+1]=a,this.int16[_+2]=u,e}}nt.prototype.bytesPerElement=6,Ft(nt,"StructArrayLayout3i6");class Tt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u)}emplace(e,r,a,u,_){const v=4*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=u,this.int16[v+3]=_,e}}Tt.prototype.bytesPerElement=8,Ft(Tt,"StructArrayLayout4i8");class dt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_,v,w){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,a,u,_,v,w)}emplace(e,r,a,u,_,v,w,A){const C=6*e,R=12*e,F=3*e;return this.int16[C+0]=r,this.int16[C+1]=a,this.uint8[R+4]=u,this.uint8[R+5]=_,this.uint8[R+6]=v,this.uint8[R+7]=w,this.float32[F+2]=A,e}}dt.prototype.bytesPerElement=12,Ft(dt,"StructArrayLayout2i4ub1f12");class kt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u)}emplace(e,r,a,u,_){const v=4*e;return this.float32[v+0]=r,this.float32[v+1]=a,this.float32[v+2]=u,this.float32[v+3]=_,e}}kt.prototype.bytesPerElement=16,Ft(kt,"StructArrayLayout4f16");class ut extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,u,_)}emplace(e,r,a,u,_,v){const w=6*e,A=3*e;return this.uint16[w+0]=r,this.uint16[w+1]=a,this.uint16[w+2]=u,this.uint16[w+3]=_,this.float32[A+2]=v,e}}ut.prototype.bytesPerElement=12,Ft(ut,"StructArrayLayout4ui1f12");class xt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u)}emplace(e,r,a,u,_){const v=4*e;return this.uint16[v+0]=r,this.uint16[v+1]=a,this.uint16[v+2]=u,this.uint16[v+3]=_,e}}xt.prototype.bytesPerElement=8,Ft(xt,"StructArrayLayout4ui8");class Lt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,a,u,_,v)}emplace(e,r,a,u,_,v,w){const A=6*e;return this.int16[A+0]=r,this.int16[A+1]=a,this.int16[A+2]=u,this.int16[A+3]=_,this.int16[A+4]=v,this.int16[A+5]=w,e}}Lt.prototype.bytesPerElement=12,Ft(Lt,"StructArrayLayout6i12");class Mt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_,v,w,A,C,R,F,j){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,r,a,u,_,v,w,A,C,R,F,j)}emplace(e,r,a,u,_,v,w,A,C,R,F,j,Z){const $=12*e;return this.int16[$+0]=r,this.int16[$+1]=a,this.int16[$+2]=u,this.int16[$+3]=_,this.uint16[$+4]=v,this.uint16[$+5]=w,this.uint16[$+6]=A,this.uint16[$+7]=C,this.int16[$+8]=R,this.int16[$+9]=F,this.int16[$+10]=j,this.int16[$+11]=Z,e}}Mt.prototype.bytesPerElement=24,Ft(Mt,"StructArrayLayout4i4ui4i24");class Ut extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,a,u,_,v)}emplace(e,r,a,u,_,v,w){const A=10*e,C=5*e;return this.int16[A+0]=r,this.int16[A+1]=a,this.int16[A+2]=u,this.float32[C+2]=_,this.float32[C+3]=v,this.float32[C+4]=w,e}}Ut.prototype.bytesPerElement=20,Ft(Ut,"StructArrayLayout3i3f20");class Si extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Si.prototype.bytesPerElement=4,Ft(Si,"StructArrayLayout1ul4");class Ai extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_,v,w,A,C,R,F,j,Z){const $=this.length;return this.resize($+1),this.emplace($,e,r,a,u,_,v,w,A,C,R,F,j,Z)}emplace(e,r,a,u,_,v,w,A,C,R,F,j,Z,$){const J=20*e,se=10*e;return this.int16[J+0]=r,this.int16[J+1]=a,this.int16[J+2]=u,this.int16[J+3]=_,this.int16[J+4]=v,this.float32[se+3]=w,this.float32[se+4]=A,this.float32[se+5]=C,this.float32[se+6]=R,this.int16[J+14]=F,this.uint32[se+8]=j,this.uint16[J+18]=Z,this.uint16[J+19]=$,e}}Ai.prototype.bytesPerElement=40,Ft(Ai,"StructArrayLayout5i4f1i1ul2ui40");class ui extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_,v,w){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,a,u,_,v,w)}emplace(e,r,a,u,_,v,w,A){const C=8*e;return this.int16[C+0]=r,this.int16[C+1]=a,this.int16[C+2]=u,this.int16[C+4]=_,this.int16[C+5]=v,this.int16[C+6]=w,this.int16[C+7]=A,e}}ui.prototype.bytesPerElement=16,Ft(ui,"StructArrayLayout3i2i2i16");class Fi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,u,_)}emplace(e,r,a,u,_,v){const w=4*e,A=8*e;return this.float32[w+0]=r,this.float32[w+1]=a,this.float32[w+2]=u,this.int16[A+6]=_,this.int16[A+7]=v,e}}Fi.prototype.bytesPerElement=16,Ft(Fi,"StructArrayLayout2f1f2i16");class ur extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u)}emplace(e,r,a,u,_){const v=12*e,w=3*e;return this.uint8[v+0]=r,this.uint8[v+1]=a,this.float32[w+1]=u,this.float32[w+2]=_,e}}ur.prototype.bytesPerElement=12,Ft(ur,"StructArrayLayout2ub2f12");class yr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const _=3*e;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=u,e}}yr.prototype.bytesPerElement=12,Ft(yr,"StructArrayLayout3f12");class wi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const _=3*e;return this.uint16[_+0]=r,this.uint16[_+1]=a,this.uint16[_+2]=u,e}}wi.prototype.bytesPerElement=6,Ft(wi,"StructArrayLayout3ui6");class Gr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_,v,w,A,C,R,F,j,Z,$,J,se,ye,Pe,ve,ze,Ue){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,e,r,a,u,_,v,w,A,C,R,F,j,Z,$,J,se,ye,Pe,ve,ze,Ue)}emplace(e,r,a,u,_,v,w,A,C,R,F,j,Z,$,J,se,ye,Pe,ve,ze,Ue,Oe){const ht=30*e,at=15*e,wt=60*e;return this.int16[ht+0]=r,this.int16[ht+1]=a,this.int16[ht+2]=u,this.float32[at+2]=_,this.float32[at+3]=v,this.uint16[ht+8]=w,this.uint16[ht+9]=A,this.uint32[at+5]=C,this.uint32[at+6]=R,this.uint32[at+7]=F,this.uint16[ht+16]=j,this.uint16[ht+17]=Z,this.uint16[ht+18]=$,this.float32[at+10]=J,this.float32[at+11]=se,this.uint8[wt+48]=ye,this.uint8[wt+49]=Pe,this.uint8[wt+50]=ve,this.uint32[at+13]=ze,this.int16[ht+28]=Ue,this.uint8[wt+58]=Oe,e}}Gr.prototype.bytesPerElement=60,Ft(Gr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class sn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_,v,w,A,C,R,F,j,Z,$,J,se,ye,Pe,ve,ze,Ue,Oe,ht,at,wt,Ot,mt,It,At,Dt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,e,r,a,u,_,v,w,A,C,R,F,j,Z,$,J,se,ye,Pe,ve,ze,Ue,Oe,ht,at,wt,Ot,mt,It,At,Dt)}emplace(e,r,a,u,_,v,w,A,C,R,F,j,Z,$,J,se,ye,Pe,ve,ze,Ue,Oe,ht,at,wt,Ot,mt,It,At,Dt,jt){const yt=38*e,ii=19*e;return this.int16[yt+0]=r,this.int16[yt+1]=a,this.int16[yt+2]=u,this.float32[ii+2]=_,this.float32[ii+3]=v,this.int16[yt+8]=w,this.int16[yt+9]=A,this.int16[yt+10]=C,this.int16[yt+11]=R,this.int16[yt+12]=F,this.int16[yt+13]=j,this.uint16[yt+14]=Z,this.uint16[yt+15]=$,this.uint16[yt+16]=J,this.uint16[yt+17]=se,this.uint16[yt+18]=ye,this.uint16[yt+19]=Pe,this.uint16[yt+20]=ve,this.uint16[yt+21]=ze,this.uint16[yt+22]=Ue,this.uint16[yt+23]=Oe,this.uint16[yt+24]=ht,this.uint16[yt+25]=at,this.uint16[yt+26]=wt,this.uint16[yt+27]=Ot,this.uint16[yt+28]=mt,this.uint32[ii+15]=It,this.float32[ii+16]=At,this.float32[ii+17]=Dt,this.float32[ii+18]=jt,e}}sn.prototype.bytesPerElement=76,Ft(sn,"StructArrayLayout3i2f6i15ui1ul3f76");class nn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}nn.prototype.bytesPerElement=4,Ft(nn,"StructArrayLayout1f4");class ln extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,u,_)}emplace(e,r,a,u,_,v){const w=5*e;return this.float32[w+0]=r,this.float32[w+1]=a,this.float32[w+2]=u,this.float32[w+3]=_,this.float32[w+4]=v,e}}ln.prototype.bytesPerElement=20,Ft(ln,"StructArrayLayout5f20");class Jo extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u)}emplace(e,r,a,u,_){const v=6*e;return this.uint32[3*e+0]=r,this.uint16[v+2]=a,this.uint16[v+3]=u,this.uint16[v+4]=_,e}}Jo.prototype.bytesPerElement=12,Ft(Jo,"StructArrayLayout1ul3ui12");class Hn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=a,e}}Hn.prototype.bytesPerElement=4,Ft(Hn,"StructArrayLayout2ui4");class zn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}zn.prototype.bytesPerElement=2,Ft(zn,"StructArrayLayout1ui2");class Dl extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=a,e}}Dl.prototype.bytesPerElement=8,Ft(Dl,"StructArrayLayout2f8");class Pn extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Pn.prototype.size=40;class fn extends Ai{get(e){return new Pn(this,e)}}Ft(fn,"CollisionBoxArray");class Vr extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Vr.prototype.size=60;class yo extends Gr{get(e){return new Vr(this,e)}}Ft(yo,"PlacedSymbolArray");class Ea extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ea.prototype.size=76;class xn extends sn{get(e){return new Ea(this,e)}}Ft(xn,"SymbolInstanceArray");class ns extends nn{getoffsetX(e){return this.float32[1*e+0]}}Ft(ns,"GlyphOffsetArray");class $c extends Bt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ft($c,"SymbolLineVertexArray");class Mc extends je{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Mc.prototype.size=12;class Gs extends Jo{get(e){return new Mc(this,e)}}Ft(Gs,"FeatureIndexArray");class Ts extends Hn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ft(Ts,"FillExtrusionCentroidArray");const Cc=$e([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Hc=$e([{name:"a_dash",components:4,type:"Uint16"}]);var wh={exports:{}},Wu={exports:{}};Wu.exports=function(i,e){var r,a,u,_,v,w,A,C;for(a=i.length-(r=3&i.length),u=e,v=3432918353,w=461845907,C=0;C<a;)A=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,u=27492+(65535&(_=5*(65535&(u=(u^=A=(65535&(A=(A=(65535&A)*v+(((A>>>16)*v&65535)<<16)&4294967295)<<15|A>>>17))*w+(((A>>>16)*w&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(A=0,r){case 3:A^=(255&i.charCodeAt(C+2))<<16;case 2:A^=(255&i.charCodeAt(C+1))<<8;case 1:u^=A=(65535&(A=(A=(65535&(A^=255&i.charCodeAt(C)))*v+(((A>>>16)*v&65535)<<16)&4294967295)<<15|A>>>17))*w+(((A>>>16)*w&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var lp=Wu.exports,Tf={exports:{}};Tf.exports=function(i,e){for(var r,a=i.length,u=e^a,_=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++_;switch(a){case 3:u^=(255&i.charCodeAt(_+2))<<16;case 2:u^=(255&i.charCodeAt(_+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(_)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Ef=lp,Md=Tf.exports;wh.exports=Ef,wh.exports.murmur3=Ef,wh.exports.murmur2=Md;var Cd=_o(wh.exports);class Kc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,u){this.ids.push(Sf(e)),this.positions.push(r,a,u)}getPositions(e){const r=Sf(e);let a=0,u=this.ids.length-1;for(;a<u;){const v=a+u>>1;this.ids[v]>=r?u=v:a=v+1}const _=[];for(;this.ids[a]===r;)_.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return _}static serialize(e,r){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return no(a,u,0,a.length-1),r&&r.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const r=new Kc;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Sf(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Cd(String(i))}function no(i,e,r,a){for(;r<a;){const u=i[r+a>>1];let _=r-1,v=a+1;for(;;){do _++;while(i[_]<u);do v--;while(i[v]>u);if(_>=v)break;$u(i,_,v),$u(e,3*_,3*v),$u(e,3*_+1,3*v+1),$u(e,3*_+2,3*v+2)}v-r<a-v?(no(i,e,r,v),r=v+1):(no(i,e,v+1,a),a=v)}}function $u(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}Ft(Kc,"FeaturePositionMap");class zc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class Hu extends zc{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class cp extends zc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Th extends zc{constructor(e){super(e),this.current=In.transparent}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const If=new Float32Array(16),Af=new Float32Array(9),up=new Float32Array(4);function hp(i){return[Fe(255*i.r,255*i.g),Fe(255*i.b,255*i.a)]}class Ku{constructor(e,r,a){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=a}setUniform(e,r,a,u,_){r.set(e,_,u.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new Th(e):new Hu(e)}}class Eh{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,u,_){const v=_==="u_pattern"||_==="u_dash"?this.pattern:_==="u_pixel_ratio"?this.pixelRatio:null;v&&r.set(e,_,v)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new cp(e):new Hu(e)}}class hl{constructor(e,r,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,a,u,_,v){const w=this.paintVertexArray.length,A=this.expression.evaluate(new B(0),r,{},_,u,v);this.paintVertexArray.resize(e),this._setPaintValue(w,e,A)}updatePaintArray(e,r,a,u,_){const v=this.expression.evaluate({zoom:0},a,u,void 0,_);this._setPaintValue(e,r,v)}_setPaintValue(e,r,a){if(this.type==="color"){const u=hp(a);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rc{constructor(e,r,a,u,_,v){this.expression=e,this.uniformNames=r.map(w=>`u_${w}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=r.map(w=>({name:`a_${w}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(e,r,a,u,_,v){const w=this.expression.evaluate(new B(this.zoom),r,{},_,u,v),A=this.expression.evaluate(new B(this.zoom+1),r,{},_,u,v),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,w,A)}updatePaintArray(e,r,a,u,_){const v=this.expression.evaluate({zoom:this.zoom},a,u,void 0,_),w=this.expression.evaluate({zoom:this.zoom+1},a,u,void 0,_);this._setPaintValue(e,r,v,w)}_setPaintValue(e,r,a,u){if(this.type==="color"){const _=hp(a),v=hp(u);for(let w=e;w<r;w++)this.paintVertexArray.emplace(w,_[0],_[1],v[0],v[1])}else{for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,u,_){const v=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,w=or(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);r.set(e,_,w)}getBinding(e,r){return new Hu(e)}}class Pc{constructor(e,r,a,u,_){this.expression=e,this.layerId=_,this.paintVertexAttributes=(a==="array"?Hc:Cc).members;for(let v=0;v<r.length;++v);this.paintVertexArray=new u}populatePaintArray(e,r,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,u,_,v){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],v)}_setPaintValues(e,r,a,u){if(!u||!a)return;const _=u[a];if(!_)return;const{tl:v,br:w,pixelRatio:A}=_;for(let C=e;C<r;C++)this.paintVertexArray.emplace(C,v[0],v[1],w[0],w[1],A)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yu{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[];const u=[];for(const _ in e.paint._values){if(!a(_))continue;const v=e.paint.get(_);if(!(v instanceof me&&Jl(v.property.specification)))continue;const w=nc(_,e.type),A=v.value,C=v.property.specification.type,R=!!v.property.useIntegerZoom,F=_==="line-dasharray"||_.endsWith("pattern"),j=_==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(A.kind!=="constant"||j)if(A.kind==="source"||j||F){const Z=Mf(_,C,"source");this.binders[_]=F?new Pc(A,w,C,Z,e.id):new hl(A,w,C,Z),u.push(`/a_${_}`)}else{const Z=Mf(_,C,"composite");this.binders[_]=new rc(A,w,C,R,r,Z),u.push(`/z_${_}`)}else this.binders[_]=F?new Eh(A.value,w):new Ku(A.value,w,C),u.push(`/u_${_}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof hl||r instanceof rc?r.maxValue:0}populatePaintArrays(e,r,a,u,_,v){for(const w in this.binders){const A=this.binders[w];(A instanceof hl||A instanceof rc||A instanceof Pc)&&A.populatePaintArray(e,r,a,u,_,v)}}setConstantPatternPositions(e){for(const r in this.binders){const a=this.binders[r];a instanceof Eh&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,u,_,v){let w=!1;for(const A in e){const C=r.getPositions(A);for(const R of C){const F=a.feature(R.index);for(const j in this.binders){const Z=this.binders[j];if((Z instanceof hl||Z instanceof rc||Z instanceof Pc)&&Z.expression.isStateDependent===!0){const $=u.paint.get(j);Z.expression=$.value,Z.updatePaintArray(R.start,R.end,F,e[A],_,v),w=!0}}}}return w}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Ku||a instanceof Eh)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof hl||a instanceof rc||a instanceof Pc)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Ku||a instanceof Eh||a instanceof rc)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Ku||u instanceof Eh||u instanceof rc)for(const _ of u.uniformNames)r.push({name:_,property:a,binding:u.getBinding(e,_)})}return r}setUniforms(e,r,a,u,_){for(const{name:v,property:w,binding:A}of a)this.binders[w].setUniform(e,A,_,u.get(w),v)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof hl||r instanceof rc||r instanceof Pc)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof hl||a instanceof rc||a instanceof Pc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof hl||r instanceof rc||r instanceof Pc)&&r.destroy()}}}class Yc{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new yu(u,r,a);this.needsUpload=!1,this._featureMap=new Kc,this._bufferOffset=0}populatePaintArrays(e,r,a,u,_,v,w){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(e,r,u,_,v,w);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,u,_){for(const v of a)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(e,this._featureMap,r,v,u,_)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const zd={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function nc(i,e){return zd[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const vm={"line-pattern":{source:ut,composite:ut},"fill-pattern":{source:ut,composite:ut},"fill-extrusion-pattern":{source:ut,composite:ut},"line-dasharray":{source:xt,composite:xt}},xm={color:{source:Dl,composite:kt},number:{source:nn,composite:Dl}};function Mf(i,e,r){const a=vm[i];return a&&a[r]||xm[e][r]}Ft(Ku,"ConstantBinder"),Ft(Eh,"PatternConstantBinder"),Ft(hl,"SourceExpressionBinder"),Ft(Pc,"PatternCompositeBinder"),Ft(rc,"CompositeExpressionBinder"),Ft(yu,"ProgramConfiguration",{omit:["_buffers"]}),Ft(Yc,"ProgramConfigurationSet");const Pd="-transition";class Ll extends Ei{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new fe(r.layout)),r.paint)){this._transitionablePaint=new H(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new de(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Ni,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return ya(e,Pd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Vi,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(ya(e,Pd))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[e],_=u.value.isDataDriven(),v=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value,A=w.isDataDriven(),C=ya(e,"pattern")||e==="line-dasharray";return A||_||C||this._handleOverridablePaintPropertyUpdate(e,v,w)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),On(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,u,_={}){return(!_||_.validate!==!1)&&ji(this,e.call(Ii,{key:r,layerType:this.type,objectKey:a,value:u,styleSpec:lt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof me&&Jl(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=d(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Sh=$e([{name:"a_pos",components:2,type:"Int16"}],4),bm=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class vo{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,u){let _=this.segments[this.segments.length-1];return e>vo.MAX_VERTEX_ARRAY_LENGTH&&Hr(`Max vertices per segment is ${vo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!_||_.vertexLength+e>vo.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==u)&&(_={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},u!==void 0&&(_.sortKey=u),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,u){return new vo([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}vo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft(vo,"SegmentVector");var Ci=8192;class Jc{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof _n?new _n(e.lng,e.lat):_n.convert(e),this}setSouthWest(e){return this._sw=e instanceof _n?new _n(e.lng,e.lat):_n.convert(e),this}extend(e){const r=this._sw,a=this._ne;let u,_;if(e instanceof _n)u=e,_=e;else{if(!(e instanceof Jc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Jc.convert(e)):this.extend(_n.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(_n.convert(e)):this;if(u=e._sw,_=e._ne,!u||!_)return this}return r||a?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),a.lng=Math.max(_.lng,a.lng),a.lat=Math.max(_.lat,a.lat)):(this._sw=new _n(u.lng,u.lat),this._ne=new _n(_.lng,_.lat)),this}getCenter(){return new _n((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _n(this.getWest(),this.getNorth())}getSouthEast(){return new _n(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=_n.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof Jc?e:new Jc(e)}}var Fp=1e-6,Zs=typeof Float32Array<"u"?Float32Array:Array;function Yu(){var i=new Zs(9);return Zs!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Cf(i,e,r){var a=e[0],u=e[1],_=e[2],v=e[3],w=e[4],A=e[5],C=e[6],R=e[7],F=e[8],j=r[0],Z=r[1],$=r[2],J=r[3],se=r[4],ye=r[5],Pe=r[6],ve=r[7],ze=r[8];return i[0]=j*a+Z*v+$*C,i[1]=j*u+Z*w+$*R,i[2]=j*_+Z*A+$*F,i[3]=J*a+se*v+ye*C,i[4]=J*u+se*w+ye*R,i[5]=J*_+se*A+ye*F,i[6]=Pe*a+ve*v+ze*C,i[7]=Pe*u+ve*w+ze*R,i[8]=Pe*_+ve*A+ze*F,i}function pl(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ju(i,e){var r=e[0],a=e[1],u=e[2],_=e[3],v=e[4],w=e[5],A=e[6],C=e[7],R=e[8],F=e[9],j=e[10],Z=e[11],$=e[12],J=e[13],se=e[14],ye=e[15],Pe=r*w-a*v,ve=r*A-u*v,ze=r*C-_*v,Ue=a*A-u*w,Oe=a*C-_*w,ht=u*C-_*A,at=R*J-F*$,wt=R*se-j*$,Ot=R*ye-Z*$,mt=F*se-j*J,It=F*ye-Z*J,At=j*ye-Z*se,Dt=Pe*At-ve*It+ze*mt+Ue*Ot-Oe*wt+ht*at;return Dt?(i[0]=(w*At-A*It+C*mt)*(Dt=1/Dt),i[1]=(u*It-a*At-_*mt)*Dt,i[2]=(J*ht-se*Oe+ye*Ue)*Dt,i[3]=(j*Oe-F*ht-Z*Ue)*Dt,i[4]=(A*Ot-v*At-C*wt)*Dt,i[5]=(r*At-u*Ot+_*wt)*Dt,i[6]=(se*ze-$*ht-ye*ve)*Dt,i[7]=(R*ht-j*ze+Z*ve)*Dt,i[8]=(v*It-w*Ot+C*at)*Dt,i[9]=(a*Ot-r*It-_*at)*Dt,i[10]=($*Oe-J*ze+ye*Pe)*Dt,i[11]=(F*ze-R*Oe-Z*Pe)*Dt,i[12]=(w*wt-v*mt-A*at)*Dt,i[13]=(r*mt-a*wt+u*at)*Dt,i[14]=(J*ve-$*Ue-se*Pe)*Dt,i[15]=(R*Ue-F*ve+j*Pe)*Dt,i):null}function Oa(i,e,r){var a=e[0],u=e[1],_=e[2],v=e[3],w=e[4],A=e[5],C=e[6],R=e[7],F=e[8],j=e[9],Z=e[10],$=e[11],J=e[12],se=e[13],ye=e[14],Pe=e[15],ve=r[0],ze=r[1],Ue=r[2],Oe=r[3];return i[0]=ve*a+ze*w+Ue*F+Oe*J,i[1]=ve*u+ze*A+Ue*j+Oe*se,i[2]=ve*_+ze*C+Ue*Z+Oe*ye,i[3]=ve*v+ze*R+Ue*$+Oe*Pe,i[4]=(ve=r[4])*a+(ze=r[5])*w+(Ue=r[6])*F+(Oe=r[7])*J,i[5]=ve*u+ze*A+Ue*j+Oe*se,i[6]=ve*_+ze*C+Ue*Z+Oe*ye,i[7]=ve*v+ze*R+Ue*$+Oe*Pe,i[8]=(ve=r[8])*a+(ze=r[9])*w+(Ue=r[10])*F+(Oe=r[11])*J,i[9]=ve*u+ze*A+Ue*j+Oe*se,i[10]=ve*_+ze*C+Ue*Z+Oe*ye,i[11]=ve*v+ze*R+Ue*$+Oe*Pe,i[12]=(ve=r[12])*a+(ze=r[13])*w+(Ue=r[14])*F+(Oe=r[15])*J,i[13]=ve*u+ze*A+Ue*j+Oe*se,i[14]=ve*_+ze*C+Ue*Z+Oe*ye,i[15]=ve*v+ze*R+Ue*$+Oe*Pe,i}function pp(i,e,r){var a,u,_,v,w,A,C,R,F,j,Z,$,J=r[0],se=r[1],ye=r[2];return e===i?(i[12]=e[0]*J+e[4]*se+e[8]*ye+e[12],i[13]=e[1]*J+e[5]*se+e[9]*ye+e[13],i[14]=e[2]*J+e[6]*se+e[10]*ye+e[14],i[15]=e[3]*J+e[7]*se+e[11]*ye+e[15]):(u=e[1],_=e[2],v=e[3],w=e[4],A=e[5],C=e[6],R=e[7],F=e[8],j=e[9],Z=e[10],$=e[11],i[0]=a=e[0],i[1]=u,i[2]=_,i[3]=v,i[4]=w,i[5]=A,i[6]=C,i[7]=R,i[8]=F,i[9]=j,i[10]=Z,i[11]=$,i[12]=a*J+w*se+F*ye+e[12],i[13]=u*J+A*se+j*ye+e[13],i[14]=_*J+C*se+Z*ye+e[14],i[15]=v*J+R*se+$*ye+e[15]),i}function Qu(i,e,r){var a=r[0],u=r[1],_=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*_,i[9]=e[9]*_,i[10]=e[10]*_,i[11]=e[11]*_,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function kd(i,e,r){var a=Math.sin(r),u=Math.cos(r),_=e[4],v=e[5],w=e[6],A=e[7],C=e[8],R=e[9],F=e[10],j=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=_*u+C*a,i[5]=v*u+R*a,i[6]=w*u+F*a,i[7]=A*u+j*a,i[8]=C*u-_*a,i[9]=R*u-v*a,i[10]=F*u-w*a,i[11]=j*u-A*a,i}function Op(i,e,r){var a=Math.sin(r),u=Math.cos(r),_=e[0],v=e[1],w=e[2],A=e[3],C=e[8],R=e[9],F=e[10],j=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*u-C*a,i[1]=v*u-R*a,i[2]=w*u-F*a,i[3]=A*u-j*a,i[8]=_*a+C*u,i[9]=v*a+R*u,i[10]=w*a+F*u,i[11]=A*a+j*u,i}function Ih(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Dd(i,e,r){var a,u,_,v=r[0],w=r[1],A=r[2],C=Math.hypot(v,w,A);return C<Fp?null:(v*=C=1/C,w*=C,A*=C,a=Math.sin(e),u=Math.cos(e),i[0]=v*v*(_=1-u)+u,i[1]=w*v*_+A*a,i[2]=A*v*_-w*a,i[3]=0,i[4]=v*w*_-A*a,i[5]=w*w*_+u,i[6]=A*w*_+v*a,i[7]=0,i[8]=v*A*_+w*a,i[9]=w*A*_-v*a,i[10]=A*A*_+u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var zf=Oa;function Ld(){var i=new Zs(3);return Zs!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Pf(i){var e=new Zs(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Ah(i){return Math.hypot(i[0],i[1],i[2])}function Oo(i,e,r){var a=new Zs(3);return a[0]=i,a[1]=e,a[2]=r,a}function Qc(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function Up(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i}function Rd(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i}function dp(i,e,r){return i[0]=Math.min(e[0],r[0]),i[1]=Math.min(e[1],r[1]),i[2]=Math.min(e[2],r[2]),i}function Mh(i,e,r){return i[0]=Math.max(e[0],r[0]),i[1]=Math.max(e[1],r[1]),i[2]=Math.max(e[2],r[2]),i}function Es(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function fp(i,e,r,a){return i[0]=e[0]+r[0]*a,i[1]=e[1]+r[1]*a,i[2]=e[2]+r[2]*a,i}function os(i,e){var r=e[0],a=e[1],u=e[2],_=r*r+a*a+u*u;return _>0&&(_=1/Math.sqrt(_)),i[0]=e[0]*_,i[1]=e[1]*_,i[2]=e[2]*_,i}function dl(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function Vp(i,e,r){var a=e[0],u=e[1],_=e[2],v=r[0],w=r[1],A=r[2];return i[0]=u*A-_*w,i[1]=_*v-a*A,i[2]=a*w-u*v,i}function po(i,e,r){var a=e[0],u=e[1],_=e[2],v=r[3]*a+r[7]*u+r[11]*_+r[15];return i[0]=(r[0]*a+r[4]*u+r[8]*_+r[12])/(v=v||1),i[1]=(r[1]*a+r[5]*u+r[9]*_+r[13])/v,i[2]=(r[2]*a+r[6]*u+r[10]*_+r[14])/v,i}function Ch(i,e,r){var a=r[0],u=r[1],_=r[2],v=e[0],w=e[1],A=e[2],C=u*A-_*w,R=_*v-a*A,F=a*w-u*v,j=u*F-_*R,Z=_*C-a*F,$=a*R-u*C,J=2*r[3];return R*=J,F*=J,Z*=2,$*=2,i[0]=v+(C*=J)+(j*=2),i[1]=w+R+Z,i[2]=A+F+$,i}var xo,Rl=Up,kf=Rd,Np=Ah;function mn(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i}function Bd(i,e){var r=e[0],a=e[1],u=e[2],_=e[3],v=r*r+a*a+u*u+_*_;return v>0&&(v=1/Math.sqrt(v)),i[0]=r*v,i[1]=a*v,i[2]=u*v,i[3]=_*v,i}function Ss(i,e,r){var a=e[0],u=e[1],_=e[2],v=e[3];return i[0]=r[0]*a+r[4]*u+r[8]*_+r[12]*v,i[1]=r[1]*a+r[5]*u+r[9]*_+r[13]*v,i[2]=r[2]*a+r[6]*u+r[10]*_+r[14]*v,i[3]=r[3]*a+r[7]*u+r[11]*_+r[15]*v,i}function eh(){var i=new Zs(4);return Zs!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Fd(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Df(i,e,r){r*=.5;var a=e[0],u=e[1],_=e[2],v=e[3],w=Math.sin(r),A=Math.cos(r);return i[0]=a*A+v*w,i[1]=u*A+_*w,i[2]=_*A-u*w,i[3]=v*A-a*w,i}function Lf(i,e,r){r*=.5;var a=e[0],u=e[1],_=e[2],v=e[3],w=Math.sin(r),A=Math.cos(r);return i[0]=a*A-_*w,i[1]=u*A+v*w,i[2]=_*A+a*w,i[3]=v*A-u*w,i}Ld(),xo=new Zs(4),Zs!=Float32Array&&(xo[0]=0,xo[1]=0,xo[2]=0,xo[3]=0);var wm=Bd;Ld(),Oo(1,0,0),Oo(0,1,0),eh(),eh(),Yu();const Tm=$e([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rf}=Tm,Bf=$e([{name:"a_pos_3",components:3,type:"Int16"}]);var mp=$e([{name:"a_pos",type:"Int16",components:2}]);class Od{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const u=dl(r,this.dir);if(Math.abs(u)<1e-6)return!1;const _=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return a[0]=this.pos[0]+this.dir[0]*_,a[1]=this.pos[1]+this.dir[1]*_,a[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(e,r,a){if(function(Z,$){var J=Z[0],se=Z[1],ye=Z[2],Pe=$[0],ve=$[1],ze=$[2];return Math.abs(J-Pe)<=Fp*Math.max(1,Math.abs(J),Math.abs(Pe))&&Math.abs(se-ve)<=Fp*Math.max(1,Math.abs(se),Math.abs(ve))&&Math.abs(ye-ze)<=Fp*Math.max(1,Math.abs(ye),Math.abs(ze))}(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;const[u,_,v]=this.dir,w=this.pos[0]-e[0],A=this.pos[1]-e[1],C=this.pos[2]-e[2],R=u*u+_*_+v*v,F=2*(w*u+A*_+C*v),j=F*F-4*R*(w*w+A*A+C*C-r*r);if(j<0){const Z=Math.max(-F/2,0),$=w+u*Z,J=A+_*Z,se=C+v*Z,ye=Math.hypot($,J,se);return a[0]=$*r/ye,a[1]=J*r/ye,a[2]=se*r/ye,!1}{const Z=(-F-Math.sqrt(j))/(2*R);if(Z<0){const $=Math.hypot(w,A,C);return a[0]=w*r/$,a[1]=A*r/$,a[2]=C*r/$,!1}return a[0]=w+u*Z,a[1]=A+_*Z,a[2]=C+v*Z,!0}}}class Ud{constructor(e,r,a,u,_){this.TL=e,this.TR=r,this.BR=a,this.BL=u,this.horizon=_}static fromInvProjectionMatrix(e,r,a){const u=[-1,1,1],_=[1,1,1],v=[1,-1,1],w=[-1,-1,1],A=po(u,u,e),C=po(_,_,e),R=po(v,v,e),F=po(w,w,e);return new Ud(A,C,R,F,r/a)}}class zh{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a,u){const _=Math.pow(2,a),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const C=Ss([],A,e),R=1/C[3]/r*_;return function(F,j,Z){return F[0]=j[0]*Z[0],F[1]=j[1]*Z[1],F[2]=j[2]*Z[2],F[3]=j[3]*Z[3],F}(C,C,[R,R,u?1/C[3]:R,R])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const C=os([],Vp([],Rl([],v[A[0]],v[A[1]]),Rl([],v[A[2]],v[A[1]]))),R=-dl(C,v[A[1]]);return C.concat(R)});return new zh(v,w)}}class Uo{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)dp(r,r,u),Mh(a,a,u);return new Uo(r,a)}static applyTransform(e,r){const a=e.getCorners();for(let u=0;u<a.length;++u)po(a[u],a[u],r);return Uo.fromPoints(a)}constructor(e,r){this.min=e,this.max=r,this.center=Es([],Qc([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=Pf(this.min),u=Pf(this.max);for(let _=0;_<r.length;_++)a[_]=r[_]?this.min[_]:this.center[_],u[_]=r[_]?this.center[_]:this.max[_];return u[2]=this.max[2],new Uo(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let a=!0;for(let u=0;u<e.planes.length;u++){const _=e.planes[u];let v=0;for(let w=0;w<r.length;w++)v+=dl(_,r[w])+_[3]>=0;if(v===0)return 0;v!==r.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let _=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const A=e.points[w][u]-this.min[u];_=Math.min(_,A),v=Math.max(v,A)}if(v<0||_>this.max[u]-this.min[u])return 0}return 1}}const jp=5,qp=6,kc=Ci/Math.PI/2,Em=16383,th=64,Ph=[th,32,16],fl=-kc,Kn=kc,Gp=[new Uo([fl,fl,fl],[Kn,Kn,Kn]),new Uo([fl,fl,fl],[0,0,Kn]),new Uo([0,fl,fl],[Kn,0,Kn]),new Uo([fl,0,fl],[0,Kn,Kn]),new Uo([0,0,fl],[Kn,Kn,Kn])];function vu(i){return i*kc/Bh}function kh(i,e,r,a=!0){const u=Es([],i._camera.position,i.worldSize),_=[e,r,1,1];Ss(_,_,i.pixelMatrixInverse),mn(_,_,1/_[3]);const v=os([],Rl([],_,u)),w=i.globeMatrix,A=[w[12],w[13],w[14]],C=Rl([],A,u),R=Ah(C),F=os([],C),j=i.worldSize/(2*Math.PI),Z=dl(F,v),$=Math.asin(j/R);if($<Math.acos(Z)){if(!a)return null;const Ot=[],mt=[];Es(Ot,v,R/Z),os(mt,Rl(mt,Ot,C)),os(v,Qc(v,C,Es(v,mt,Math.tan($)*R)))}const J=[];new Od(u,v).closestPointOnSphere(A,j,J);const se=os([],xa(w,0)),ye=os([],xa(w,1)),Pe=os([],xa(w,2)),ve=dl(se,J),ze=dl(ye,J),Ue=dl(Pe,J),Oe=en(Math.asin(-ze/j));let ht=en(Math.atan2(ve,Ue));ht=i.center.lng+function(Ot,mt){const It=(mt-Ot+180)%360-180;return It<-180?It+360:It}(i.center.lng,ht);const at=oc(ht),wt=or(ml(Oe),0,1);return new Oh(at,wt)}class Xs{constructor(e,r,a){this.a=Rl([],e,a),this.b=Rl([],r,a),this.center=a;const u=os([],this.a),_=os([],this.b);this.angle=Math.acos(dl(u,_))}}function ih(i,e){if(i.angle===0)return null;let r;return r=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),r<0||r>1?null:function(a,u,_,v){const w=Math.sin(_);return a*(Math.sin((1-v)*_)/w)+u*(Math.sin(v*_)/w)}(i.a[e],i.b[e],i.angle,or(r,0,1))+i.center[e]}function Is(i){if(i.z<=1)return Gp[i.z+2*i.y+i.x];const e=Zp(yp(i));return Uo.fromPoints(e)}function fo(i,e,r){return Es(i,i,1-r),fp(i,i,e,r)}function _p(i,e){const r=bu(e.zoom);if(r===0)return Is(i);const a=yp(i),u=Zp(a),_=oc(a.getWest())*e.worldSize,v=oc(a.getEast())*e.worldSize,w=ml(a.getNorth())*e.worldSize,A=ml(a.getSouth())*e.worldSize,C=[_,w,0],R=[v,w,0],F=[_,A,0],j=[v,A,0],Z=Ju([],e.globeMatrix);return po(C,C,Z),po(R,R,Z),po(F,F,Z),po(j,j,Z),u[0]=fo(u[0],F,r),u[1]=fo(u[1],j,r),u[2]=fo(u[2],R,r),u[3]=fo(u[3],C,r),Uo.fromPoints(u)}function gp(i,e,r){for(const a of i)po(a,a,e),Es(a,a,r)}function As(i,e,r){const a=e/i.worldSize,u=i.globeMatrix;if(r.z<=1){const at=Is(r).getCorners();return gp(at,u,a),Uo.fromPoints(at)}const _=yp(r),v=Zp(_);gp(v,u,a);const w=Number.MAX_VALUE,A=[-w,-w,-w],C=[w,w,w];if(_.contains(i.center)){for(const Ot of v)dp(C,C,Ot),Mh(A,A,Ot);A[2]=0;const at=i.point,wt=[at.x*a,at.y*a,0];return dp(C,C,wt),Mh(A,A,wt),new Uo(C,A)}const R=[u[12]*a,u[13]*a,u[14]*a],F=_.getCenter(),j=or(i.center.lat,-bo,bo),Z=or(F.lat,-bo,bo),$=oc(i.center.lng),J=ml(j);let se=$-oc(F.lng);const ye=J-ml(Z);se>.5?se-=1:se<-.5&&(se+=1);let Pe=0;Math.abs(se)>Math.abs(ye)?Pe=se>=0?1:3:(Pe=ye>=0?0:2,fp(R,R,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(Ki(ye>=0?_.getSouth():_.getNorth()))*kc));const ve=v[Pe],ze=v[(Pe+1)%4],Ue=new Xs(ve,ze,R),Oe=[ih(Ue,0)||ve[0],ih(Ue,1)||ve[1],ih(Ue,2)||ve[2]],ht=bu(i.zoom);if(ht>0){const at=function({x:Ot,y:mt,z:It},At,Dt,jt,yt){const ii=1/(1<<It);let xi=Ot*ii,oi=xi+ii,ar=mt*ii,qt=ar+ii,ki=0;const sr=(xi+oi)/2-jt;return sr>.5?ki=-1:sr<-.5&&(ki=1),xi=((xi+ki)*At-(jt*=At))*Dt+jt,oi=((oi+ki)*At-jt)*Dt+jt,ar=(ar*At-(yt*=At))*Dt+yt,qt=(qt*At-yt)*Dt+yt,[[xi,qt,0],[oi,qt,0],[oi,ar,0],[xi,ar,0]]}(r,e,i._pixelsPerMercatorPixel,$,J);for(let Ot=0;Ot<v.length;Ot++)fo(v[Ot],at[Ot],ht);const wt=Qc([],at[Pe],at[(Pe+1)%4]);Es(wt,wt,.5),fo(Oe,wt,ht)}for(const at of v)dp(C,C,at),Mh(A,A,at);return C[2]=Math.min(ve[2],ze[2]),dp(C,C,Oe),Mh(A,A,Oe),new Uo(C,A)}function yp({x:i,y:e,z:r}){const a=1/(1<<r),u=new _n(as(i*a),Vo((e+1)*a)),_=new _n(as((i+1)*a),Vo(e*a));return new Jc(u,_)}function Zp(i){const e=Ki(i.getNorth()),r=Ki(i.getSouth()),a=Math.cos(e),u=Math.cos(r),_=Math.sin(e),v=Math.sin(r),w=i.getWest(),A=i.getEast();return[Dh(u,v,w),Dh(u,v,A),Dh(a,_,A),Dh(a,_,w)]}function Dh(i,e,r,a=kc){return r=Ki(r),[i*Math.sin(r)*a,-e*a,i*Math.cos(r)*a]}function rh(i,e,r){return Dh(Math.cos(Ki(i)),Math.sin(Ki(i)),e,r)}function nh(i,e,r,a){const u=1<<r.z,_=(i/Ci+r.x)/u;return rh(Vo((e/Ci+r.y)/u),as(_),a)}function Lh({min:i,max:e}){return Em/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const Ff=new Float64Array(16);function Rh(i){const e=Lh(i),r=Ih(Ff,[e,e,e]);return pp(r,r,((a=[])[0]=-(u=i.min)[0],a[1]=-u[1],a[2]=-u[2],a));var a,u}function xu(i){const e=(a=i.min,(r=Ff)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r);var r,a;const u=1/Lh(i);return Qu(e,e,[u,u,u])}function Bl(i,e,r,a,u){const _=function(A){const C=Ci/(2*Math.PI);return A/(2*Math.PI)/C}(r),v=[i,e,-r/(2*Math.PI)],w=pl(new Float64Array(16));return pp(w,w,v),Qu(w,w,[_,_,_]),kd(w,w,Ki(-u)),Op(w,w,Ki(-a)),w}function bu(i){return Cs(jp,qp,i)}function Vd(i,e){const r=rh(e.lat,e.lng),a=function($){const J=rh($._center.lat,$._center.lng);let se=Vp([],Oo(0,1,0),J);const ye=Dd([],-$.angle,J);se=po(se,se,ye),Dd(ye,-$._pitch,se);const Pe=os([],J);return Es(Pe,Pe,vu($.cameraToCenterDistance/$.pixelsPerMeter)),po(Pe,Pe,ye),Qc([],J,Pe)}(i);return v=(u=Up([],a,r))[0],w=u[1],A=u[2],C=(_=r)[0],R=_[1],F=_[2],Z=(j=Math.sqrt(v*v+w*w+A*A)*Math.sqrt(C*C+R*R+F*F))&&dl(u,_)/j,Math.acos(Math.min(Math.max(Z,-1),1));var u,_,v,w,A,C,R,F,j,Z}function Xp(i,e){return Vd(i,e)>Math.PI/2*1.01}const Of=Ki(85),Uf=Math.cos(Of),Vf=Math.sin(Of),Bh=63710088e-1,Nd=2*Math.PI*Bh;class wu{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new wu(tn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,u=e.lat*r,_=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return Bh*Math.acos(Math.min(_,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new Jc(new wu(this.lng-a,this.lat-r),new wu(this.lng+a,this.lat+r))}toEcef(e){const r=vu(e);return rh(this.lat,this.lng,kc+r)}static convert(e){if(e instanceof wu)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new wu(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new wu(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var _n=wu;function Tu(i){return Nd*Math.cos(i*Math.PI/180)}function oc(i){return(180+i)/360}function ml(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Fl(i,e){return i/Tu(e)}function as(i){return 360*i-180}function Vo(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Fh(i,e){return i*Tu(Vo(e))}const bo=85.051129;function Nf(i){return 1/Math.cos(i*Math.PI/180)}class Oh{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=_n.convert(e);return new Oh(oc(a.lng),ml(a.lat),Fl(r,a.lat))}toLngLat(){return new _n(as(this.x),Vo(this.y))}toAltitude(){return Fh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Nd*Nf(Vo(this.y))}}function jd(i,e,r,a,u,_,v,w,A){const C=(e+a)/2,R=(r+u)/2,F=new Xt(C,R);w(F),function(j,Z,$,J,se,ye){const Pe=$-se,ve=J-ye;return Math.abs((J-Z)*Pe-($-j)*ve)/Math.hypot(Pe,ve)}(F.x,F.y,_.x,_.y,v.x,v.y)>=A?(jd(i,e,r,C,R,_,F,w,A),jd(i,C,R,a,u,F,v,w,A)):i.push(v)}function oh(i,e,r){let a=i[0],u=a.x,_=a.y;e(a);const v=[a];for(let w=1;w<i.length;w++){const A=i[w],{x:C,y:R}=A;e(A),jd(v,u,_,C,R,a,A,e,r),u=C,_=R,a=A}return v}function Eu(i,e,r,a){if(a(e,r)){const u=e.add(r)._mult(.5);Eu(i,e,u,a),Eu(i,u,r,a)}else i.push(r)}function qd(i,e){let r=i[0];const a=[r];for(let u=1;u<i.length;u++){const _=i[u];Eu(a,r,_,e),r=_}return a}const Wp=Math.pow(2,14)-1,$p=-Wp-1;function vp(i,e){const r=Math.round(i.x*e),a=Math.round(i.y*e);return i.x=or(r,$p,Wp),i.y=or(a,$p,Wp),(r<i.x||r>i.x+1||a<i.y||a>i.y+1)&&Hr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function ss(i,e,r){const a=i.loadGeometry(),u=i.extent,_=Ci/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const v=1<<e.z,{scale:w,x:A,y:C,projection:R}=r,F=j=>{const Z=as((e.x+j.x/u)/v),$=Vo((e.y+j.y/u)/v),J=R.project(Z,$);j.x=(J.x*w-A)*u,j.y=(J.y*w-C)*u};for(let j=0;j<a.length;j++)if(i.type!==1)a[j]=oh(a[j],F,1);else{const Z=[];for(const $ of a[j])$.x<0||$.x>=u||$.y<0||$.y>=u||(F($),Z.push($));a[j]=Z}}for(const v of a)for(const w of v)vp(w,_);return a}function Su(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ss(i):[]}}function xp(i,e,r,a,u){i.emplaceBack(2*e+(a+1)/2,2*r+(u+1)/2)}function Hp(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Gd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Bt,this.indexArray=new wi,this.segments=new vo,this.programConfigurations=new Yc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,u){const _=this.layers[0],v=[];let w=null;_.type==="circle"&&(w=_.layout.get("circle-sort-key"));for(const{feature:C,id:R,index:F,sourceLayerIndex:j}of e){const Z=this.layers[0]._featureFilter.needGeometry,$=Su(C,Z);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),$,a))continue;const J=w?w.evaluate($,{},a):void 0,se={id:R,properties:C.properties,type:C.type,sourceLayerIndex:j,index:F,geometry:Z?$.geometry:ss(C,a,u),patterns:{},sortKey:J};v.push(se)}w&&v.sort((C,R)=>C.sortKey-R.sortKey);let A=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Lt,A=u.projection);for(const C of v){const{geometry:R,index:F,sourceLayerIndex:j}=C,Z=e[F].feature;this.addFeature(C,R,F,r.availableImages,a,A),r.featureIndex.insert(Z,R,F,j,this.index)}}update(e,r,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,bm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,u,_,v){for(const w of r)for(const A of w){const C=A.x,R=A.y;if(C<0||C>=Ci||R<0||R>=Ci)continue;if(v){const Z=v.projectTilePoint(C,R,_),$=v.upVector(_,C,R),J=this.globeExtVertexArray;Hp(J,Z,$),Hp(J,Z,$),Hp(J,Z,$),Hp(J,Z,$)}const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),j=F.vertexLength;xp(this.layoutVertexArray,C,R,-1,-1),xp(this.layoutVertexArray,C,R,1,-1),xp(this.layoutVertexArray,C,R,1,1),xp(this.layoutVertexArray,C,R,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+2,j+3),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,_)}}function jf(i,e){for(let r=0;r<i.length;r++)if(Ol(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ol(i,e[r]))return!0;return!!Iu(i,e)}function Kp(i,e,r){return!!Ol(i,e)||!!Rr(e,i,r)}function Yp(i,e){if(i.length===1)return Jp(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let u=0;u<a.length;u++)if(Ol(i,a[u]))return!0}for(let r=0;r<i.length;r++)if(Jp(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Iu(i,e[r]))return!0;return!1}function Sm(i,e,r){if(i.length>1){if(Iu(i,e))return!0;for(let a=0;a<e.length;a++)if(Rr(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(Rr(i[a],e,r))return!0;return!1}function Iu(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],u=i[r+1];for(let _=0;_<e.length-1;_++)if(ah(a,u,e[_],e[_+1]))return!0}return!1}function ah(i,e,r,a){return vn(i,r,a)!==vn(e,r,a)&&vn(i,e,r)!==vn(i,e,a)}function Rr(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(qf(i,e[u-1],e[u])<a)return!0;return!1}function qf(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const u=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function Jp(i,e){let r,a,u,_=!1;for(let v=0;v<i.length;v++){r=i[v];for(let w=0,A=r.length-1;w<r.length;A=w++)a=r[w],u=r[A],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(_=!_)}return _}function Ol(i,e){let r=!1;for(let a=0,u=i.length-1;a<i.length;u=a++){const _=i[a],v=i[u];_.y>e.y!=v.y>e.y&&e.x<(v.x-_.x)*(e.y-_.y)/(v.y-_.y)+_.x&&(r=!r)}return r}function Gf(i,e,r,a,u){for(const v of i)if(e<=v.x&&r<=v.y&&a>=v.x&&u>=v.y)return!0;const _=[new Xt(e,r),new Xt(e,u),new Xt(a,u),new Xt(a,r)];if(i.length>2){for(const v of _)if(Ol(i,v))return!0}for(let v=0;v<i.length-1;v++)if(Im(i[v],i[v+1],_))return!0;return!1}function Im(i,e,r){const a=r[0],u=r[2];if(i.x<a.x&&e.x<a.x||i.x>u.x&&e.x>u.x||i.y<a.y&&e.y<a.y||i.y>u.y&&e.y>u.y)return!1;const _=vn(i,e,r[0]);return _!==vn(i,e,r[1])||_!==vn(i,e,r[2])||_!==vn(i,e,r[3])}function Uh(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Qp(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Zf(i,e,r,a,u){if(!e[0]&&!e[1])return i;const _=Xt.convert(e)._mult(u);r==="viewport"&&_._rotate(-a);const v=[];for(let w=0;w<i.length;w++)v.push(i[w].sub(_));return v}function Xf(i,e,r,a){const u=Xt.convert(i)._mult(a);return e==="viewport"&&u._rotate(-r),u}Ft(Gd,"CircleBucket",{omit:["layers"]});const Am=new Ee({"circle-sort-key":new ue(lt.layout_circle["circle-sort-key"])});var Wf={paint:new Ee({"circle-radius":new ue(lt.paint_circle["circle-radius"]),"circle-color":new ue(lt.paint_circle["circle-color"]),"circle-blur":new ue(lt.paint_circle["circle-blur"]),"circle-opacity":new ue(lt.paint_circle["circle-opacity"]),"circle-translate":new Y(lt.paint_circle["circle-translate"]),"circle-translate-anchor":new Y(lt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Y(lt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Y(lt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ue(lt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ue(lt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ue(lt.paint_circle["circle-stroke-opacity"])}),layout:Am};function Zd(i,e,r,a,u,_,v,w,A){if(_&&i.queryGeometry.isAboveHorizon)return!1;_&&(A*=i.pixelToTileUnitsFactor);const C=i.tileID.canonical,R=r.projection.upVectorScale(C,r.center.lat,r.worldSize).metersToTile;for(const F of e)for(const j of F){const Z=j.add(w),$=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(Z.x,Z.y,!0):0,J=r.projection.projectTilePoint(Z.x,Z.y,C);if($>0){const ve=r.projection.upVector(C,Z.x,Z.y);J.x+=ve[0]*R*$,J.y+=ve[1]*R*$,J.z+=ve[2]*R*$}const se=_?Z:$f(J.x,J.y,J.z,a),ye=_?i.tilespaceRays.map(ve=>sh(ve,$)):i.queryGeometry.screenGeometry,Pe=Ss([],[J.x,J.y,J.z,1],a);if(!v&&_?A*=Pe[3]/r.cameraToCenterDistance:v&&!_&&(A*=r.cameraToCenterDistance/Pe[3]),_){const ve=Vo((j.y/Ci+C.y)/(1<<C.z));A/=r.projection.pixelsPerMeter(ve,1)/Fl(1,ve)}if(Kp(ye,se,A))return!0}return!1}function $f(i,e,r,a){const u=Ss([],[i,e,r,1],a);return new Xt(u[0]/u[3],u[1]/u[3])}const Xd=Oo(0,0,0),ed=Oo(0,0,1);function sh(i,e){const r=Ld();return Xd[2]=e,i.intersectsPlane(Xd,ed,r),new Xt(r[0],r[1])}class td extends Gd{}function lh(i,{width:e,height:r},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=u,i}function Wd(i,e,r){const{width:a,height:u}=e;a===i.width&&u===i.height||(oo(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,a),height:Math.min(i.height,u)},r),i.width=a,i.height=u,i.data=e.data)}function oo(i,e,r,a,u,_){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||r.x>i.width-u.width||r.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const v=i.data,w=e.data;for(let A=0;A<u.height;A++){const C=((r.y+A)*i.width+r.x)*_,R=((a.y+A)*e.width+a.x)*_;for(let F=0;F<u.width*_;F++)w[R+F]=v[C+F]}return e}Ft(td,"HeatmapBucket",{omit:["layers"]});class Nr{constructor(e,r){lh(this,e,1,r)}resize(e){Wd(this,new Nr(e),1)}clone(){return new Nr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,_){oo(e,r,a,u,_,1)}}class Ms{constructor(e,r){lh(this,e,4,r)}resize(e){Wd(this,new Ms(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ms({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,_){oo(e,r,a,u,_,4)}}Ft(Nr,"AlphaImage"),Ft(Ms,"RGBAImage");var Hf={paint:new Ee({"heatmap-radius":new ue(lt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ue(lt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Y(lt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new we(lt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Y(lt.paint_heatmap["heatmap-opacity"])})};function id(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,u=i.image||new Ms({width:r,height:a}),_=(v,w,A)=>{e[i.evaluationKey]=A;const C=i.expression.evaluate(e);u.data[v+w+0]=Math.floor(255*C.r/C.a),u.data[v+w+1]=Math.floor(255*C.g/C.a),u.data[v+w+2]=Math.floor(255*C.b/C.a),u.data[v+w+3]=Math.floor(255*C.a)};if(i.clips)for(let v=0,w=0;v<a;++v,w+=4*r)for(let A=0,C=0;A<r;A++,C+=4){const R=A/(r-1),{start:F,end:j}=i.clips[v];_(w,C,F*(1-R)+j*R)}else for(let v=0,w=0;v<r;v++,w+=4)_(0,w,v/(r-1));return u}var Kf={paint:new Ee({"hillshade-illumination-direction":new Y(lt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Y(lt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Y(lt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Y(lt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Y(lt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Y(lt.paint_hillshade["hillshade-accent-color"])})};const Yf=$e([{name:"a_pos",components:2,type:"Int16"}],4),{members:$d}=Yf;var eu={exports:{}};function Dc(i,e,r){r=r||2;var a,u,_,v,w,A,C,R=e&&e.length,F=R?e[0]*r:i.length,j=Hd(i,0,F,r,!0),Z=[];if(!j||j.next===j.prev)return Z;if(R&&(j=function(J,se,ye,Pe){var ve,ze,Ue,Oe=[];for(ve=0,ze=se.length;ve<ze;ve++)(Ue=Hd(J,se[ve]*Pe,ve<ze-1?se[ve+1]*Pe:J.length,Pe,!1))===Ue.next&&(Ue.steiner=!0),Oe.push(No(Ue));for(Oe.sort(Vh),ve=0;ve<Oe.length;ve++)ye=ru(Oe[ve],ye);return ye}(i,e,j,r)),i.length>80*r){a=_=i[0],u=v=i[1];for(var $=r;$<F;$+=r)(w=i[$])<a&&(a=w),(A=i[$+1])<u&&(u=A),w>_&&(_=w),A>v&&(v=A);C=(C=Math.max(_-a,v-u))!==0?32767/C:0}return tu(j,Z,r,a,u,C,0),Z}function Hd(i,e,r,a,u){var _,v;if(u===K(i,e,r,a)>0)for(_=e;_<r;_+=a)v=L(_,i[_],i[_+1],v);else for(_=r-a;_>=e;_-=a)v=L(_,i[_],i[_+1],v);return v&&o(v,v.next)&&(U(v),v=v.next),v}function kn(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!o(a,a.next)&&t(a.prev,a,a.next)!==0)a=a.next;else{if(U(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function tu(i,e,r,a,u,_,v){if(i){!v&&_&&function(R,F,j,Z){var $=R;do $.z===0&&($.z=Yd($.x,$.y,F,j,Z)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==R);$.prevZ.nextZ=null,$.prevZ=null,function(J){var se,ye,Pe,ve,ze,Ue,Oe,ht,at=1;do{for(ye=J,J=null,ze=null,Ue=0;ye;){for(Ue++,Pe=ye,Oe=0,se=0;se<at&&(Oe++,Pe=Pe.nextZ);se++);for(ht=at;Oe>0||ht>0&&Pe;)Oe!==0&&(ht===0||!Pe||ye.z<=Pe.z)?(ve=ye,ye=ye.nextZ,Oe--):(ve=Pe,Pe=Pe.nextZ,ht--),ze?ze.nextZ=ve:J=ve,ve.prevZ=ze,ze=ve;ye=Pe}ze.nextZ=null,at*=2}while(Ue>1)}($)}(i,a,u,_);for(var w,A,C=i;i.prev!==i.next;)if(w=i.prev,A=i.next,_?rd(i,a,u,_):iu(i))e.push(w.i/r|0),e.push(i.i/r|0),e.push(A.i/r|0),U(i),i=A.next,C=A.next;else if((i=A)===C){v?v===1?tu(i=nd(kn(i),e,r),e,r,a,u,_,2):v===2&&Kd(i,e,r,a,u,_):tu(kn(i),e,r,a,u,_,1);break}}}function iu(i){var e=i.prev,r=i,a=i.next;if(t(e,r,a)>=0)return!1;for(var u=e.x,_=r.x,v=a.x,w=e.y,A=r.y,C=a.y,R=u<_?u<v?u:v:_<v?_:v,F=w<A?w<C?w:C:A<C?A:C,j=u>_?u>v?u:v:_>v?_:v,Z=w>A?w>C?w:C:A>C?A:C,$=a.next;$!==e;){if($.x>=R&&$.x<=j&&$.y>=F&&$.y<=Z&&_l(u,w,_,A,v,C,$.x,$.y)&&t($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function rd(i,e,r,a){var u=i.prev,_=i,v=i.next;if(t(u,_,v)>=0)return!1;for(var w=u.x,A=_.x,C=v.x,R=u.y,F=_.y,j=v.y,Z=w<A?w<C?w:C:A<C?A:C,$=R<F?R<j?R:j:F<j?F:j,J=w>A?w>C?w:C:A>C?A:C,se=R>F?R>j?R:j:F>j?F:j,ye=Yd(Z,$,e,r,a),Pe=Yd(J,se,e,r,a),ve=i.prevZ,ze=i.nextZ;ve&&ve.z>=ye&&ze&&ze.z<=Pe;){if(ve.x>=Z&&ve.x<=J&&ve.y>=$&&ve.y<=se&&ve!==u&&ve!==v&&_l(w,R,A,F,C,j,ve.x,ve.y)&&t(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,ze.x>=Z&&ze.x<=J&&ze.y>=$&&ze.y<=se&&ze!==u&&ze!==v&&_l(w,R,A,F,C,j,ze.x,ze.y)&&t(ze.prev,ze,ze.next)>=0))return!1;ze=ze.nextZ}for(;ve&&ve.z>=ye;){if(ve.x>=Z&&ve.x<=J&&ve.y>=$&&ve.y<=se&&ve!==u&&ve!==v&&_l(w,R,A,F,C,j,ve.x,ve.y)&&t(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;ze&&ze.z<=Pe;){if(ze.x>=Z&&ze.x<=J&&ze.y>=$&&ze.y<=se&&ze!==u&&ze!==v&&_l(w,R,A,F,C,j,ze.x,ze.y)&&t(ze.prev,ze,ze.next)>=0)return!1;ze=ze.nextZ}return!0}function nd(i,e,r){var a=i;do{var u=a.prev,_=a.next.next;!o(u,_)&&s(u,a,a.next,_)&&S(u,_)&&S(_,u)&&(e.push(u.i/r|0),e.push(a.i/r|0),e.push(_.i/r|0),U(a),U(a.next),a=i=_),a=a.next}while(a!==i);return kn(a)}function Kd(i,e,r,a,u,_){var v=i;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&Qf(v,w)){var A=M(v,w);return v=kn(v,v.next),A=kn(A,A.next),tu(v,e,r,a,u,_,0),void tu(A,e,r,a,u,_,0)}w=w.next}v=v.next}while(v!==i)}function Vh(i,e){return i.x-e.x}function ru(i,e){var r=function(u,_){var v,w=_,A=u.x,C=u.y,R=-1/0;do{if(C<=w.y&&C>=w.next.y&&w.next.y!==w.y){var F=w.x+(C-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(F<=A&&F>R&&(R=F,v=w.x<w.next.x?w:w.next,F===A))return v}w=w.next}while(w!==_);if(!v)return null;var j,Z=v,$=v.x,J=v.y,se=1/0;w=v;do A>=w.x&&w.x>=$&&A!==w.x&&_l(C<J?A:R,C,$,J,C<J?R:A,C,w.x,w.y)&&(j=Math.abs(C-w.y)/(A-w.x),S(w,u)&&(j<se||j===se&&(w.x>v.x||w.x===v.x&&Jf(v,w)))&&(v=w,se=j)),w=w.next;while(w!==Z);return v}(i,e);if(!r)return e;var a=M(r,i);return kn(a,a.next),kn(r,r.next)}function Jf(i,e){return t(i.prev,i,e.prev)<0&&t(e.next,i,i.next)<0}function Yd(i,e,r,a,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function No(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function _l(i,e,r,a,u,_,v,w){return(u-v)*(e-w)>=(i-v)*(_-w)&&(i-v)*(a-w)>=(r-v)*(e-w)&&(r-v)*(_-w)>=(u-v)*(a-w)}function Qf(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&s(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(i,e)&&(S(i,e)&&S(e,i)&&function(r,a){var u=r,_=!1,v=(r.x+a.x)/2,w=(r.y+a.y)/2;do u.y>w!=u.next.y>w&&u.next.y!==u.y&&v<(u.next.x-u.x)*(w-u.y)/(u.next.y-u.y)+u.x&&(_=!_),u=u.next;while(u!==r);return _}(i,e)&&(t(i.prev,i,e.prev)||t(i,e.prev,e))||o(i,e)&&t(i.prev,i,i.next)>0&&t(e.prev,e,e.next)>0)}function t(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function o(i,e){return i.x===e.x&&i.y===e.y}function s(i,e,r,a){var u=b(t(i,e,r)),_=b(t(i,e,a)),v=b(t(r,a,i)),w=b(t(r,a,e));return u!==_&&v!==w||!(u!==0||!f(i,r,e))||!(_!==0||!f(i,a,e))||!(v!==0||!f(r,i,a))||!(w!==0||!f(r,e,a))}function f(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function b(i){return i>0?1:i<0?-1:0}function S(i,e){return t(i.prev,i,i.next)<0?t(i,e,i.next)>=0&&t(i,i.prev,e)>=0:t(i,e,i.prev)<0||t(i,i.next,e)<0}function M(i,e){var r=new W(i.i,i.x,i.y),a=new W(e.i,e.x,e.y),u=i.next,_=e.prev;return i.next=e,e.prev=i,r.next=u,u.prev=r,a.next=r,r.prev=a,_.next=a,a.prev=_,a}function L(i,e,r,a){var u=new W(i,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function U(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function W(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function K(i,e,r,a){for(var u=0,_=e,v=r-a;_<r;_+=a)u+=(i[v]-i[_])*(i[_+1]+i[v+1]),v=_;return u}eu.exports=Dc,eu.exports.default=Dc,Dc.deviation=function(i,e,r,a){var u=e&&e.length,_=Math.abs(K(i,0,u?e[0]*r:i.length,r));if(u)for(var v=0,w=e.length;v<w;v++)_-=Math.abs(K(i,e[v]*r,v<w-1?e[v+1]*r:i.length,r));var A=0;for(v=0;v<a.length;v+=3){var C=a[v]*r,R=a[v+1]*r,F=a[v+2]*r;A+=Math.abs((i[C]-i[F])*(i[R+1]-i[C+1])-(i[C]-i[R])*(i[F+1]-i[C+1]))}return _===0&&A===0?0:Math.abs((A-_)/_)},Dc.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,u=0;u<i.length;u++){for(var _=0;_<i[u].length;_++)for(var v=0;v<e;v++)r.vertices.push(i[u][_][v]);u>0&&r.holes.push(a+=i[u-1].length)}return r};var ie=_o(eu.exports);function le(i,e,r,a,u){ae(i,e,r||0,a||i.length-1,u||Me)}function ae(i,e,r,a,u){for(;a>r;){if(a-r>600){var _=a-r+1,v=e-r+1,w=Math.log(_),A=.5*Math.exp(2*w/3),C=.5*Math.sqrt(w*A*(_-A)/_)*(v-_/2<0?-1:1);ae(i,e,Math.max(r,Math.floor(e-v*A/_+C)),Math.min(a,Math.floor(e+(_-v)*A/_+C)),u)}var R=i[e],F=r,j=a;for(he(i,r,e),u(i[a],R)>0&&he(i,r,a);F<j;){for(he(i,F,j),F++,j--;u(i[F],R)<0;)F++;for(;u(i[j],R)>0;)j--}u(i[r],R)===0?he(i,r,j):he(i,++j,a),j<=e&&(r=j+1),e<=j&&(a=j-1)}}function he(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function Me(i,e){return i<e?-1:i>e?1:0}function ke(i,e){const r=i.length;if(r<=1)return[i];const a=[];let u,_;for(let v=0;v<r;v++){const w=Ma(i[v]);w!==0&&(i[v].area=Math.abs(w),_===void 0&&(_=w<0),_===w<0?(u&&a.push(u),u=[i[v]]):u.push(i[v]))}if(u&&a.push(u),e>1)for(let v=0;v<a.length;v++)a[v].length<=e||(le(a[v],e,1,a[v].length-1,Ve),a[v]=a[v].slice(0,e));return a}function Ve(i,e){return e.area-i.area}function Ye(i,e,r){const a=r.patternDependencies;let u=!1;for(const _ of e){const v=_.paint.get(`${i}-pattern`);v.isConstant()||(u=!0);const w=v.constantOr(null);w&&(u=!0,a[w]=!0)}return u}function He(i,e,r,a,u){const _=u.patternDependencies;for(const v of e){const w=v.paint.get(`${i}-pattern`).value;if(w.kind!=="constant"){let A=w.evaluate({zoom:a},r,{},u.availableImages);A=A&&A.name?A.name:A,_[A]=!0,r.patterns[v.id]=A}}return r}class it{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bt,this.indexArray=new wi,this.indexArray2=new Hn,this.programConfigurations=new Yc(e.layers,e.zoom),this.segments=new vo,this.segments2=new vo,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,a,u){this.hasPattern=Ye("fill",this.layers,r);const _=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:A,index:C,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,j=Su(w,F);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),j,a))continue;const Z=_?_.evaluate(j,{},a,r.availableImages):void 0,$={id:A,properties:w.properties,type:w.type,sourceLayerIndex:R,index:C,geometry:F?j.geometry:ss(w,a,u),patterns:{},sortKey:Z};v.push($)}_&&v.sort((w,A)=>w.sortKey-A.sortKey);for(const w of v){const{geometry:A,index:C,sourceLayerIndex:R}=w;if(this.hasPattern){const F=He("fill",this.layers,w,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(w,A,C,a,{},r.availableImages);r.featureIndex.insert(e[C].feature,A,C,R,this.index)}}update(e,r,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,u)}addFeatures(e,r,a,u,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$d),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,u,_,v=[]){for(const w of ke(r,500)){let A=0;for(const $ of w)A+=$.length;const C=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),R=C.vertexLength,F=[],j=[];for(const $ of w){if($.length===0)continue;$!==w[0]&&j.push(F.length/2);const J=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),se=J.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(se+$.length-1,se),F.push($[0].x),F.push($[0].y);for(let ye=1;ye<$.length;ye++)this.layoutVertexArray.emplaceBack($[ye].x,$[ye].y),this.indexArray2.emplaceBack(se+ye-1,se+ye),F.push($[ye].x),F.push($[ye].y);J.vertexLength+=$.length,J.primitiveLength+=$.length}const Z=ie(F,j);for(let $=0;$<Z.length;$+=3)this.indexArray.emplaceBack(R+Z[$],R+Z[$+1],R+Z[$+2]);C.vertexLength+=A,C.primitiveLength+=Z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,v,u)}}Ft(it,"FillBucket",{omit:["layers","patternFeatures"]});const bt=new Ee({"fill-sort-key":new ue(lt.layout_fill["fill-sort-key"])});var zt={paint:new Ee({"fill-antialias":new Y(lt.paint_fill["fill-antialias"]),"fill-opacity":new ue(lt.paint_fill["fill-opacity"]),"fill-color":new ue(lt.paint_fill["fill-color"]),"fill-outline-color":new ue(lt.paint_fill["fill-outline-color"]),"fill-translate":new Y(lt.paint_fill["fill-translate"]),"fill-translate-anchor":new Y(lt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ue(lt.paint_fill["fill-pattern"])}),layout:bt};const St=$e([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ht=$e([{name:"a_centroid_pos",components:2,type:"Uint16"}]),vi=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:hi}=St;var bi={},pi=ra,si=Qt;function Qt(i,e,r,a,u){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=u,i.readFields(br,this,e)}function br(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,u){for(var _=a.readVarint()+a.pos;a.pos<_;){var v=u._keys[a.readVarint()],w=u._values[a.readVarint()];u.properties[v]=w}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Br(i){for(var e,r,a=0,u=0,_=i.length,v=_-1;u<_;v=u++)a+=((r=i[v]).x-(e=i[u]).x)*(e.y+r.y);return a}Qt.types=["Unknown","Point","LineString","Polygon"],Qt.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,u=0,_=0,v=0,w=[];i.pos<r;){if(u<=0){var A=i.readVarint();a=7&A,u=A>>3}if(u--,a===1||a===2)_+=i.readSVarint(),v+=i.readSVarint(),a===1&&(e&&w.push(e),e=[]),e.push(new pi(_,v));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&w.push(e),w},Qt.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,u=0,_=0,v=1/0,w=-1/0,A=1/0,C=-1/0;i.pos<e;){if(a<=0){var R=i.readVarint();r=7&R,a=R>>3}if(a--,r===1||r===2)(u+=i.readSVarint())<v&&(v=u),u>w&&(w=u),(_+=i.readSVarint())<A&&(A=_),_>C&&(C=_);else if(r!==7)throw new Error("unknown command "+r)}return[v,A,w,C]},Qt.prototype.toGeoJSON=function(i,e,r){var a,u,_=this.extent*Math.pow(2,r),v=this.extent*i,w=this.extent*e,A=this.loadGeometry(),C=Qt.types[this.type];function R(Z){for(var $=0;$<Z.length;$++){var J=Z[$];Z[$]=[360*(J.x+v)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+w)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(a=0;a<A.length;a++)F[a]=A[a][0];R(A=F);break;case 2:for(a=0;a<A.length;a++)R(A[a]);break;case 3:for(A=function(Z){var $=Z.length;if($<=1)return[Z];for(var J,se,ye=[],Pe=0;Pe<$;Pe++){var ve=Br(Z[Pe]);ve!==0&&(se===void 0&&(se=ve<0),se===ve<0?(J&&ye.push(J),J=[Z[Pe]]):J.push(Z[Pe]))}return J&&ye.push(J),ye}(A),a=0;a<A.length;a++)for(u=0;u<A[a].length;u++)R(A[a][u])}A.length===1?A=A[0]:C="Multi"+C;var j={type:"Feature",geometry:{type:C,coordinates:A},properties:this.properties};return"id"in this&&(j.id=this.id),j};var Sr=si,er=Yr;function Yr(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Cr,this,e),this.length=this._features.length}function Cr(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var u=null,_=a.readVarint()+a.pos;a.pos<_;){var v=a.readVarint()>>3;u=v===1?a.readString():v===2?a.readFloat():v===3?a.readDouble():v===4?a.readVarint64():v===5?a.readVarint():v===6?a.readSVarint():v===7?a.readBoolean():null}return u}(r))}Yr.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Sr(this._pbf,e,this.extent,this._keys,this._values)};var mr=er;function Ir(i,e,r){if(i===3){var a=new mr(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}var Jr=bi.VectorTile=function(i,e){this.layers=i.readFields(Ir,{},e)},ao=bi.VectorTileFeature=si;function Yn(i,e,r,a){const u=[],_=a===0?(v,w,A,C,R,F)=>{v.push(new Xt(F,A+(F-w)/(C-w)*(R-A)))}:(v,w,A,C,R,F)=>{v.push(new Xt(w+(F-A)/(R-A)*(C-w),F))};for(const v of i){const w=[];for(const A of v){if(A.length<=2)continue;const C=[];for(let j=0;j<A.length-1;j++){const Z=A[j].x,$=A[j].y,J=A[j+1].x,se=A[j+1].y,ye=a===0?Z:$,Pe=a===0?J:se;ye<e?Pe>e&&_(C,Z,$,J,se,e):ye>r?Pe<r&&_(C,Z,$,J,se,r):C.push(A[j]),Pe<e&&ye>=e&&_(C,Z,$,J,se,e),Pe>r&&ye<=r&&_(C,Z,$,J,se,r)}let R=A[A.length-1];const F=a===0?R.x:R.y;F>=e&&F<=r&&C.push(R),C.length&&(R=C[C.length-1],C[0].x===R.x&&C[0].y===R.y||C.push(C[0]),w.push(C))}w.length&&u.push(w)}return u}bi.VectorTileLayer=er;const pa=ao.types,da=Math.pow(2,13);function Nn(i,e,r,a,u,_,v,w){i.emplaceBack((e<<1)+v,(r<<1)+_,(Math.floor(a*da)<<1)+u,Math.round(w))}function so(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class jo{constructor(){this.acc=new Xt(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Xt(e.x,e.y),this.max=new Xt(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,u=this.max;e.x<a.x?a.x=e.x:e.x>u.x&&(u.x=e.x),e.y<a.y?a.y=e.y:e.y>u.y&&(u.y=e.y),((e.x===0||e.x===Ci)&&e.x===r.x)!=((e.y===0||e.y===Ci)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,Tr(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Ci!=e.x>Ci&&this.addBorderIntersection(1,Tr(r.y,e.y,(Ci-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Tr(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Ci!=e.y>Ci&&this.addBorderIntersection(3,Tr(r.x,e.x,(Ci-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((r,a)=>r+a.edges,0);return e!==0?this.acc.div(e)._round():new Xt(0,0)}span(){return new Xt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class wo{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Tt,this.centroidVertexArray=new Ts,this.indexArray=new wi,this.programConfigurations=new Yc(e.layers,e.zoom),this.segments=new vo,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,a,u){this.features=[],this.hasPattern=Ye("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const v=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*v/(v*v+1)/Ci/(1<<_.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:_,id:v,index:w,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,R=Su(_,C);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),R,a))continue;const F={id:v,sourceLayerIndex:A,index:w,geometry:C?R.geometry:ss(_,a,u),properties:_.properties,type:_.type,patterns:{}},j=this.layoutVertexArray.length;this.hasPattern?this.features.push(He("fill-extrusion",this.layers,F,this.zoom,r)):this.addFeature(F,F.geometry,w,a,{},r.availableImages,u),r.featureIndex.insert(_,F.geometry,w,A,this.index,j)}this.sortBorders()}addFeatures(e,r,a,u,_){for(const v of this.features){const{geometry:w}=v;this.addFeature(v,w,v.index,r,a,u,_)}this.sortBorders()}update(e,r,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hi),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,vi.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ht.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,u,_,v,w){const A=[new Xt(0,0),new Xt(Ci,Ci)],C=w.projection,R=C.name==="globe",F=this.enableTerrain&&!R?new jo:null,j=pa[e.type]==="Polygon";R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Lt);const Z=ke(r,500);for(let ye=Z.length-1;ye>=0;ye--){const Pe=Z[ye];(Pe.length===0||($=Pe[0]).every(ve=>ve.x<=0)||$.every(ve=>ve.x>=Ci)||$.every(ve=>ve.y<=0)||$.every(ve=>ve.y>=Ci))&&Z.splice(ye,1)}var $;let J;if(R)J=Eo(Z,A,u);else{J=[];for(const ye of Z)J.push({polygon:ye,bounds:A})}const se=j?this.edgeRadius:0;for(const{polygon:ye,bounds:Pe}of J){let ve=0,ze=0;for(const Oe of ye)j&&!Oe[0].equals(Oe[Oe.length-1])&&Oe.push(Oe[0]),ze+=j?Oe.length-1:Oe.length;const Ue=this.segments.prepareSegment((j?5:4)*ze,this.layoutVertexArray,this.indexArray);if(j){const Oe=[],ht=[];ve=Ue.vertexLength;for(const wt of ye){let Ot,mt;wt.length&&wt!==ye[0]&&ht.push(Oe.length/2),Ot=wt[1].sub(wt[0])._perp()._unit();for(let It=1;It<wt.length;It++){const At=wt[It],Dt=wt[It===wt.length-1?1:It+1];let{x:jt,y:yt}=At;if(se){mt=Dt.sub(At)._perp()._unit();const ii=Ot.add(mt)._unit(),xi=se*Math.min(4,1/(Ot.x*ii.x+Ot.y*ii.y));jt+=xi*ii.x,yt+=xi*ii.y,Ot=mt}Nn(this.layoutVertexArray,jt,yt,0,0,1,1,0),Ue.vertexLength++,Oe.push(At.x,At.y),R&&so(this.layoutVertexExtArray,C.projectTilePoint(jt,yt,u),C.upVector(u,jt,yt))}}const at=ie(Oe,ht);for(let wt=0;wt<at.length;wt+=3)this.indexArray.emplaceBack(ve+at[wt],ve+at[wt+2],ve+at[wt+1]),Ue.primitiveLength++}for(const Oe of ye){F&&Oe.length&&F.startRing(Oe[0]);let ht,at,wt,Ot=Oe.length>4&&Zr(Oe[Oe.length-2],Oe[0],Oe[1]),mt=se?Dn(Oe[Oe.length-2],Oe[0],Oe[1],se):0;at=Oe[1].sub(Oe[0])._perp()._unit();let It=!0;for(let At=1,Dt=0;At<Oe.length;At++){let jt=Oe[At-1],yt=Oe[At];const ii=Oe[At===Oe.length-1?1:At+1];if(F&&j&&F.currentPolyCount.top++,Er(yt,jt,Pe)){se&&(at=ii.sub(yt)._perp()._unit(),It=!It);continue}F&&F.append(yt,jt);const xi=yt.sub(jt)._perp(),oi=xi.x/(Math.abs(xi.x)+Math.abs(xi.y)),ar=xi.y>0?1:0,qt=jt.dist(yt);if(Dt+qt>32768&&(Dt=0),se){wt=ii.sub(yt)._perp()._unit();let lr=Jn(jt,yt,ii,To(at,wt),se);isNaN(lr)&&(lr=0);const Wi=yt.sub(jt)._unit();jt=jt.add(Wi.mult(mt))._round(),yt=yt.add(Wi.mult(-lr))._round(),mt=lr,at=wt}const ki=Ue.vertexLength,sr=Oe.length>4&&Zr(jt,yt,ii);let $r=gn(Dt,Ot,It);if(Nn(this.layoutVertexArray,jt.x,jt.y,oi,ar,0,0,$r),Nn(this.layoutVertexArray,jt.x,jt.y,oi,ar,0,1,$r),Dt+=qt,$r=gn(Dt,sr,!It),Ot=sr,Nn(this.layoutVertexArray,yt.x,yt.y,oi,ar,0,0,$r),Nn(this.layoutVertexArray,yt.x,yt.y,oi,ar,0,1,$r),Ue.vertexLength+=4,this.indexArray.emplaceBack(ki+0,ki+1,ki+2),this.indexArray.emplaceBack(ki+1,ki+3,ki+2),Ue.primitiveLength+=2,se){const lr=ve+(At===1?Oe.length-2:At-2),Wi=At===1?ve:lr+1;if(this.indexArray.emplaceBack(ki+1,lr,ki+3),this.indexArray.emplaceBack(lr,Wi,ki+3),Ue.primitiveLength+=2,ht===void 0&&(ht=ki),!Er(ii,Oe[At],Pe)){const qn=At===Oe.length-1?ht:Ue.vertexLength;this.indexArray.emplaceBack(ki+2,ki+3,qn),this.indexArray.emplaceBack(ki+3,qn+1,qn),this.indexArray.emplaceBack(ki+3,Wi,qn+1),Ue.primitiveLength+=3}It=!It}if(R){const lr=this.layoutVertexExtArray,Wi=C.projectTilePoint(jt.x,jt.y,u),qn=C.projectTilePoint(yt.x,yt.y,u),hr=C.upVector(u,jt.x,jt.y),pr=C.upVector(u,yt.x,yt.y);so(lr,Wi,hr),so(lr,Wi,hr),so(lr,qn,pr),so(lr,qn,pr)}}j&&(ve+=Oe.length-1)}}if(F&&F.polyCount.length>0){if(F.borders){F.vertexArrayOffset=this.centroidVertexArray.length;const ye=F.borders,Pe=this.featuresOnBorder.push(F)-1;for(let ve=0;ve<4;ve++)ye[ve][0]!==Number.MAX_VALUE&&this.borders[ve].push(Pe)}this.encodeCentroid(F.borders?void 0:F.centroid(),F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,v,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,r,a=!0){let u,_;if(e)if(e.y!==0){const w=r.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(w.x/10)),_=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else u=Math.ceil(7*(e.x+450)),_=0;else u=0,_=+a;let v=a?this.centroidVertexArray.length:r.vertexArrayOffset;for(const w of r.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let A=0;A<w.top;A++)this.centroidVertexArray.emplace(v++,u,_);for(let A=0;A<2*w.edges;A++)this.centroidVertexArray.emplace(v++,0,_),this.centroidVertexArray.emplace(v++,u,_)}}}function To(i,e){const r=i.add(e)._unit();return i.x*r.x+i.y*r.y}function Dn(i,e,r,a){const u=e.sub(i)._perp()._unit(),_=r.sub(e)._perp()._unit();return Jn(i,e,r,To(u,_),a)}function Jn(i,e,r,a,u){const _=Math.sqrt(1-a*a);return Math.min(i.dist(e)/3,e.dist(r)/3,u*_/a)}function Er(i,e,r){return i.x<r[0].x&&e.x<r[0].x||i.x>r[1].x&&e.x>r[1].x||i.y<r[0].y&&e.y<r[0].y||i.y>r[1].y&&e.y>r[1].y}function Zr(i,e,r){if(i.x<0||i.x>=Ci||e.x<0||e.x>=Ci||r.x<0||r.x>=Ci)return!1;const a=r.sub(e),u=a.perp(),_=i.sub(e);return(a.x*_.x+a.y*_.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(_.x*_.x+_.y*_.y))>-.866&&u.x*_.x+u.y*_.y<0}function gn(i,e,r){const a=e?2|i:-3&i;return r?1|a:-2&a}function yn(){const i=Math.PI/32,e=Math.tan(i),r=Bh;return r*Math.sqrt(1+2*e*e)-r}function Eo(i,e,r){const a=1<<r.z,u=as(r.x/a),_=as((r.x+1)/a),v=Vo(r.y/a),w=Vo((r.y+1)/a);return function(A,C,R,F,j=0,Z){const $=[];if(!A.length||!R||!F)return $;const J=(Oe,ht)=>{for(const at of Oe)$.push({polygon:at,bounds:ht})},se=Math.ceil(Math.log2(R)),ye=Math.ceil(Math.log2(F)),Pe=se-ye,ve=[];for(let Oe=0;Oe<Math.abs(Pe);Oe++)ve.push(Pe>0?0:1);for(let Oe=0;Oe<Math.min(se,ye);Oe++)ve.push(0),ve.push(1);let ze=A;if(ze=Yn(ze,C[0].y-j,C[1].y+j,1),ze=Yn(ze,C[0].x-j,C[1].x+j,0),!ze.length)return $;const Ue=[];for(ve.length?Ue.push({polygons:ze,bounds:C,depth:0}):J(ze,C);Ue.length;){const Oe=Ue.pop(),ht=Oe.depth,at=ve[ht],wt=Oe.bounds[0],Ot=Oe.bounds[1],mt=at===0?wt.x:wt.y,It=at===0?Ot.x:Ot.y,At=Z?Z(at,mt,It):.5*(mt+It),Dt=Yn(Oe.polygons,mt-j,At+j,at),jt=Yn(Oe.polygons,At-j,It+j,at);if(Dt.length){const yt=[wt,new Xt(at===0?At:Ot.x,at===1?At:Ot.y)];ve.length>ht+1?Ue.push({polygons:Dt,bounds:yt,depth:ht+1}):J(Dt,yt)}if(jt.length){const yt=[new Xt(at===0?At:wt.x,at===1?At:wt.y),Ot];ve.length>ht+1?Ue.push({polygons:jt,bounds:yt,depth:ht+1}):J(jt,yt)}}return $}(i,e,Math.ceil((_-u)/11.25),Math.ceil((v-w)/11.25),1,(A,C,R)=>{if(A===0)return .5*(C+R);{const F=Vo((r.y+C/Ci)/a);return(ml(.5*(Vo((r.y+R/Ci)/a)+F))*a-r.y)*Ci}})}Ft(wo,"FillExtrusionBucket",{omit:["layers","features"]}),Ft(jo,"PartMetadata");const cn=new Ee({"fill-extrusion-edge-radius":new Y(lt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Qo={paint:new Ee({"fill-extrusion-opacity":new Y(lt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ue(lt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Y(lt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Y(lt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ue(lt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ue(lt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ue(lt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Y(lt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Y(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Y(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Y(lt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:cn};function jn(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Ws{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Ua(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=function(_,v,w){var A=jn(256*_,256*(v=Math.pow(2,w)-v-1),w),C=jn(256*(_+1),256*(v+1),w);return A[0]+","+A[1]+","+C[0]+","+C[1]}(this.x,this.y,this.z),u=function(_,v,w){let A,C="";for(let R=_;R>0;R--)A=1<<R-1,C+=(v&A?1:0)+(w&A?2:0);return C}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ea{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ua(e,r.z,r.z,r.x,r.y)}}class un{constructor(e,r,a,u,_){this.overscaledZ=e,this.wrap=r,this.canonical=new Ws(a,+u,+_),this.key=r===0&&e===a?this.canonical.key:Ua(r,e,a,u,_)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new un(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new un(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Ua(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Ua(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new un(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new un(r,this.wrap,r,a,u),new un(r,this.wrap,r,a+1,u),new un(r,this.wrap,r,a,u+1),new un(r,this.wrap,r,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new un(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new un(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ea(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ua(i,e,r,a,u){const _=1<<Math.min(r,22);let v=_*(u%_)+a%_;return i&&r<22&&(v+=_*_*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*v+r)+(e-r)}Ft(Ws,"CanonicalTileID"),Ft(un,"OverscaledTileID",{omit:["projMatrix"]});class Qn extends Xt{constructor(e,r,a){super(e,r),this.z=a}}function ls(i,e){return i.x*e.x+i.y*e.y}function ac(i,e){if(i.length===1){let r=0;const a=e[r++];let u;for(;!u||a.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const _=e[r],v=i[0],w=u.sub(a),A=_.sub(a),C=v.sub(a),R=ls(w,w),F=ls(w,A),j=ls(A,A),Z=ls(C,w),$=ls(C,A),J=R*j-F*F,se=(j*Z-F*$)/J,ye=(R*$-F*Z)/J,Pe=a.z*(1-se-ye)+u.z*se+_.z*ye;if(isFinite(Pe))return Pe}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function Ul(i,e,r,a,u,_,v,w){const A=v*u.getElevationAt(i,e,!0,!0),C=_[0]!==0,R=C?_[1]===0?v*(_[0]/7-450):v*function(F,j,Z){const $=Math.floor(j[0]/8),J=Math.floor(j[1]/8),se=10*(j[0]-8*$),ye=10*(j[1]-8*J),Pe=F.getElevationAt($,J,!0,!0),ve=F.getMeterToDEM(Z),ze=Math.floor(.5*(se*ve-1)),Ue=Math.floor(.5*(ye*ve-1)),Oe=F.tileCoordToPixel($,J),ht=2*ze+1,at=2*Ue+1,wt=function(jt,yt,ii,xi,oi){return[jt.getElevationAtPixel(yt,ii,!0),jt.getElevationAtPixel(yt+oi,ii,!0),jt.getElevationAtPixel(yt,ii+oi,!0),jt.getElevationAtPixel(yt+xi,ii+oi,!0)]}(F,Oe.x-ze,Oe.y-Ue,ht,at),Ot=Math.abs(wt[0]-wt[1]),mt=Math.abs(wt[2]-wt[3]),It=Math.abs(wt[0]-wt[2])+Math.abs(wt[1]-wt[3]),At=Math.min(.25,.5*ve*(Ot+mt)/ht),Dt=Math.min(.25,.5*ve*It/at);return Pe+Math.max(At*se,Dt*ye)}(u,_,w):A;return{base:A+(r===0)?-1:r,top:C?Math.max(R+a,A+r+2):A+a}}const bp=$e([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Lc}=bp,Jd=$e([{name:"a_packed",components:4,type:"Float32"}]),{members:Nh}=Jd,od=ao.types,jh=Math.cos(Math.PI/180*37.5);class Au{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new dt,this.layoutVertexArray2=new kt,this.indexArray=new wi,this.programConfigurations=new Yc(e.layers,e.zoom),this.segments=new vo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,u){this.hasPattern=Ye("line",this.layers,r);const _=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:R,id:F,index:j,sourceLayerIndex:Z}of e){const $=this.layers[0]._featureFilter.needGeometry,J=Su(R,$);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),J,a))continue;const se=_?_.evaluate(J,{},a):void 0,ye={id:F,properties:R.properties,type:R.type,sourceLayerIndex:Z,index:j,geometry:$?J.geometry:ss(R,a,u),patterns:{},sortKey:se};v.push(ye)}_&&v.sort((R,F)=>R.sortKey-F.sortKey);const{lineAtlas:w,featureIndex:A}=r,C=this.addConstantDashes(w);for(const R of v){const{geometry:F,index:j,sourceLayerIndex:Z}=R;if(C&&this.addFeatureDashes(R,w),this.hasPattern){const $=He("line",this.layers,R,this.zoom,r);this.patternFeatures.push($)}else this.addFeature(R,F,j,a,w.positions,r.availableImages);A.insert(e[j].feature,F,j,Z,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,_=a.layout.get("line-cap").value;if(u.kind!=="constant"||_.kind!=="constant")r=!0;else{const v=_.value,w=u.value;if(!w)continue;e.addDash(w,v)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const u of this.layers){const _=u.paint.get("line-dasharray").value,v=u.layout.get("line-cap").value;if(_.kind==="constant"&&v.kind==="constant")continue;let w,A;if(_.kind==="constant"){if(w=_.value,!w)continue}else w=_.evaluate({zoom:a},e);A=v.kind==="constant"?v.value:v.evaluate({zoom:a},e),r.addDash(w,A),e.patterns[u.id]=r.getKey(w,A)}}update(e,r,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,u)}addFeatures(e,r,a,u,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Nh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,u,_,v){const w=this.layers[0].layout,A=w.get("line-join").evaluate(e,{}),C=w.get("line-cap").evaluate(e,{}),R=w.get("line-miter-limit"),F=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const j of r)this.addLine(j,e,A,C,R,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,v,u)}addLine(e,r,a,u,_,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<e.length-1;ye++)this.totalDistance+=e[ye].dist(e[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=od[r.type]==="Polygon";let A=e.length;for(;A>=2&&e[A-1].equals(e[A-2]);)A--;let C=0;for(;C<A-1&&e[C].equals(e[C+1]);)C++;if(A<(w?3:2))return;a==="bevel"&&(_=1.05);const R=this.overscaling<=16?15*Ci/(512*this.overscaling):0,F=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let j,Z,$,J,se;this.e1=this.e2=-1,w&&(j=e[A-2],se=e[C].sub(j)._unit()._perp());for(let ye=C;ye<A;ye++){if($=ye===A-1?w?e[C+1]:void 0:e[ye+1],$&&e[ye].equals($))continue;se&&(J=se),j&&(Z=j),j=e[ye],se=$?$.sub(j)._unit()._perp():J,J=J||se;let Pe=J.add(se);Pe.x===0&&Pe.y===0||Pe._unit();const ve=J.x*se.x+J.y*se.y,ze=Pe.x*se.x+Pe.y*se.y,Ue=ze!==0?1/ze:1/0,Oe=2*Math.sqrt(2-2*ze),ht=ze<jh&&Z&&$,at=J.x*se.y-J.y*se.x>0;if(ht&&ye>C){const mt=j.dist(Z);if(mt>2*R){const It=j.sub(j.sub(Z)._mult(R/mt)._round());this.updateDistance(Z,It),this.addCurrentVertex(It,J,0,0,F),Z=It}}const wt=Z&&$;let Ot=wt?a:w?"butt":u;if(wt&&Ot==="round"&&(Ue<v?Ot="miter":Ue<=2&&(Ot="fakeround")),Ot==="miter"&&Ue>_&&(Ot="bevel"),Ot==="bevel"&&(Ue>2&&(Ot="flipbevel"),Ue<_&&(Ot="miter")),Z&&this.updateDistance(Z,j),Ot==="miter")Pe._mult(Ue),this.addCurrentVertex(j,Pe,0,0,F);else if(Ot==="flipbevel"){if(Ue>100)Pe=se.mult(-1);else{const mt=Ue*J.add(se).mag()/J.sub(se).mag();Pe._perp()._mult(mt*(at?-1:1))}this.addCurrentVertex(j,Pe,0,0,F),this.addCurrentVertex(j,Pe.mult(-1),0,0,F)}else if(Ot==="bevel"||Ot==="fakeround"){const mt=-Math.sqrt(Ue*Ue-1),It=at?mt:0,At=at?0:mt;if(Z&&this.addCurrentVertex(j,J,It,At,F),Ot==="fakeround"){const Dt=Math.round(180*Oe/Math.PI/20);for(let jt=1;jt<Dt;jt++){let yt=jt/Dt;if(yt!==.5){const xi=yt-.5;yt+=yt*xi*(yt-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*xi*xi+(.848013+ve*(.215638*ve-1.06021)))}const ii=se.sub(J)._mult(yt)._add(J)._unit()._mult(at?-1:1);this.addHalfVertex(j,ii.x,ii.y,!1,at,0,F)}}$&&this.addCurrentVertex(j,se,-It,-At,F)}else if(Ot==="butt")this.addCurrentVertex(j,Pe,0,0,F);else if(Ot==="square"){const mt=Z?1:-1;Z||this.addCurrentVertex(j,Pe,mt,mt,F),this.addCurrentVertex(j,Pe,0,0,F),Z&&this.addCurrentVertex(j,Pe,mt,mt,F)}else Ot==="round"&&(Z&&(this.addCurrentVertex(j,J,0,0,F),this.addCurrentVertex(j,J,1,1,F,!0)),$&&(this.addCurrentVertex(j,se,-1,-1,F,!0),this.addCurrentVertex(j,se,0,0,F)));if(ht&&ye<A-1){const mt=j.dist($);if(mt>2*R){const It=j.add($.sub(j)._mult(R/mt)._round());this.updateDistance(j,It),this.addCurrentVertex(It,se,0,0,F),j=It}}}}addCurrentVertex(e,r,a,u,_,v=!1){const w=r.y*u-r.x,A=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,v,!1,a,_),this.addHalfVertex(e,w,A,v,!0,-u,_)}addHalfVertex({x:e,y:r},a,u,_,v,w,A){this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(r<<1)+(v?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const C=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),A.primitiveLength++),v?this.e2=C:this.e1=C}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ft(Au,"LineBucket",{omit:["layers","patternFeatures"]});const ad=new Ee({"line-cap":new ue(lt.layout_line["line-cap"]),"line-join":new ue(lt.layout_line["line-join"]),"line-miter-limit":new Y(lt.layout_line["line-miter-limit"]),"line-round-limit":new Y(lt.layout_line["line-round-limit"]),"line-sort-key":new ue(lt.layout_line["line-sort-key"])});var sd={paint:new Ee({"line-opacity":new ue(lt.paint_line["line-opacity"]),"line-color":new ue(lt.paint_line["line-color"]),"line-translate":new Y(lt.paint_line["line-translate"]),"line-translate-anchor":new Y(lt.paint_line["line-translate-anchor"]),"line-width":new ue(lt.paint_line["line-width"]),"line-gap-width":new ue(lt.paint_line["line-gap-width"]),"line-offset":new ue(lt.paint_line["line-offset"]),"line-blur":new ue(lt.paint_line["line-blur"]),"line-dasharray":new ue(lt.paint_line["line-dasharray"]),"line-pattern":new ue(lt.paint_line["line-pattern"]),"line-gradient":new we(lt.paint_line["line-gradient"]),"line-trim-offset":new Y(lt.paint_line["line-trim-offset"])}),layout:ad};const qh=new class extends ue{possiblyEvaluate(i,e){return e=new B(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,a){return e=Gn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,a)}}(sd.paint.properties["line-width"].specification);function nu(i,e){return e>0?e+2*i:i}qh.useIntegerZoom=!0;const ch=$e([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Mu=$e([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Gh=$e([{name:"a_projected_pos",components:4,type:"Float32"}],4);$e([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wp=$e([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ld=$e([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const cd=$e([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Tp=$e([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$e([{name:"triangle",components:3,type:"Uint16"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),$e([{type:"Float32",name:"offsetX"}]),$e([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var So=24;const $s=128;function Zh(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new B(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=r;let _=0;for(;_<a.length&&a[_]<=i;)_++;_=Math.max(0,_-1);let v=_;for(;v<a.length&&a[v]<i+1;)v++;v=Math.min(a.length-1,v);const w=a[_],A=a[v];return r.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:A,interpolationType:u}:{kind:"camera",minZoom:w,maxZoom:A,minSize:r.evaluate(new B(w)),maxSize:r.evaluate(new B(A)),interpolationType:u}}}function ou(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:u}){return i.kind==="source"?a/$s:i.kind==="composite"?Tr(a/$s,u/$s,r):e}function au(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:_,maxZoom:v}=i,w=u?or(vs.interpolationFactor(u,e,_,v),0,1):0;i.kind==="camera"?a=Tr(i.minSize,i.maxSize,w):r=w}return{uSizeT:r,uSize:a}}var Ep=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:$s,evaluateSizeForFeature:ou,evaluateSizeForZoom:au,getSizeData:Zh});function ud(i,e,r){return i.sections.forEach(a=>{a.text=function(u,_,v){const w=_.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?u=u.toLocaleUpperCase():w==="lowercase"&&(u=u.toLocaleLowerCase()),k.applyArabicShaping&&(u=k.applyArabicShaping(u)),u}(a.text,e,r)}),i}const Rc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Xh(i){return i==="︶"||i==="﹈"||i==="︸"||i==="﹄"||i==="﹂"||i==="︾"||i==="︼"||i==="︺"||i==="︘"||i==="﹀"||i==="︐"||i==="︓"||i==="︔"||i==="｀"||i==="￣"||i==="︑"||i==="︒"}function Sp(i){return i==="︵"||i==="﹇"||i==="︷"||i==="﹃"||i==="﹁"||i==="︽"||i==="︻"||i==="︹"||i==="︗"||i==="︿"}var Ip=Xr,Cu=function(i,e,r,a,u){var _,v,w=8*u-a-1,A=(1<<w)-1,C=A>>1,R=-7,F=r?u-1:0,j=r?-1:1,Z=i[e+F];for(F+=j,_=Z&(1<<-R)-1,Z>>=-R,R+=w;R>0;_=256*_+i[e+F],F+=j,R-=8);for(v=_&(1<<-R)-1,_>>=-R,R+=a;R>0;v=256*v+i[e+F],F+=j,R-=8);if(_===0)_=1-C;else{if(_===A)return v?NaN:1/0*(Z?-1:1);v+=Math.pow(2,a),_-=C}return(Z?-1:1)*v*Math.pow(2,_-a)},Wh=function(i,e,r,a,u,_){var v,w,A,C=8*_-u-1,R=(1<<C)-1,F=R>>1,j=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=a?0:_-1,$=a?1:-1,J=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,v=R):(v=Math.floor(Math.log(e)/Math.LN2),e*(A=Math.pow(2,-v))<1&&(v--,A*=2),(e+=v+F>=1?j/A:j*Math.pow(2,1-F))*A>=2&&(v++,A/=2),v+F>=R?(w=0,v=R):v+F>=1?(w=(e*A-1)*Math.pow(2,u),v+=F):(w=e*Math.pow(2,F-1)*Math.pow(2,u),v=0));u>=8;i[r+Z]=255&w,Z+=$,w/=256,u-=8);for(v=v<<u|w,C+=u;C>0;i[r+Z]=255&v,Z+=$,v/=256,C-=8);i[r+Z-$]|=128*J};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Xr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Xr.Varint=0,Xr.Fixed64=1,Xr.Bytes=2,Xr.Fixed32=5;var Ap=4294967296,Qd=1/Ap,em=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function sc(i){return i.type===Xr.Bytes?i.readVarint()+i.pos:i.pos+1}function uh(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function hd(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var u=r.pos-1;u>=i;u--)r.buf[u+a]=r.buf[u]}function pd(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Hs(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Fr(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function ta(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Ks(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function lc(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function hh(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function $h(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function cc(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Sa(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Yi(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Wr(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Xr.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),u=a>>3,_=this.pos;this.type=7&a,i(u,e,this),this.pos===_&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Sa(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Wr(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Sa(this.buf,this.pos)+Sa(this.buf,this.pos+4)*Ap;return this.pos+=8,i},readSFixed64:function(){var i=Sa(this.buf,this.pos)+Wr(this.buf,this.pos+4)*Ap;return this.pos+=8,i},readFloat:function(){var i=Cu(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Cu(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(u,_,v){var w,A,C=v.buf;if(w=(112&(A=C[v.pos++]))>>4,A<128||(w|=(127&(A=C[v.pos++]))<<3,A<128)||(w|=(127&(A=C[v.pos++]))<<10,A<128)||(w|=(127&(A=C[v.pos++]))<<17,A<128)||(w|=(127&(A=C[v.pos++]))<<24,A<128)||(w|=(1&(A=C[v.pos++]))<<31,A<128))return uh(u,w,_);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&em?function(r,a,u){return em.decode(r.subarray(a,u))}(this.buf,e,i):function(r,a,u){for(var _="",v=a;v<u;){var w,A,C,R=r[v],F=null,j=R>239?4:R>223?3:R>191?2:1;if(v+j>u)break;j===1?R<128&&(F=R):j===2?(192&(w=r[v+1]))==128&&(F=(31&R)<<6|63&w)<=127&&(F=null):j===3?(A=r[v+2],(192&(w=r[v+1]))==128&&(192&A)==128&&((F=(15&R)<<12|(63&w)<<6|63&A)<=2047||F>=55296&&F<=57343)&&(F=null)):j===4&&(A=r[v+2],C=r[v+3],(192&(w=r[v+1]))==128&&(192&A)==128&&(192&C)==128&&((F=(15&R)<<18|(63&w)<<12|(63&A)<<6|63&C)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,j=1):F>65535&&(F-=65536,_+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),_+=String.fromCharCode(F),v+=j}return _}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Xr.Bytes)return i.push(this.readVarint(e));var r=sc(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Xr.Bytes)return i.push(this.readSVarint());var e=sc(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Xr.Bytes)return i.push(this.readBoolean());var e=sc(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Xr.Bytes)return i.push(this.readFloat());var e=sc(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Xr.Bytes)return i.push(this.readDouble());var e=sc(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Xr.Bytes)return i.push(this.readFixed32());var e=sc(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Xr.Bytes)return i.push(this.readSFixed32());var e=sc(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Xr.Bytes)return i.push(this.readFixed64());var e=sc(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Xr.Bytes)return i.push(this.readSFixed64());var e=sc(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Xr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Xr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Xr.Fixed32)this.pos+=4;else{if(e!==Xr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Yi(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Yi(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Yi(this.buf,-1&i,this.pos),Yi(this.buf,Math.floor(i*Qd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Yi(this.buf,-1&i,this.pos),Yi(this.buf,Math.floor(i*Qd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(_,v,w){w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7)}(a,0,r),function(_,v){var w=(7&_)<<4;v.buf[v.pos++]|=w|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))}(u,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,u,_){for(var v,w,A=0;A<u.length;A++){if((v=u.charCodeAt(A))>55295&&v<57344){if(!w){v>56319||A+1===u.length?(a[_++]=239,a[_++]=191,a[_++]=189):w=v;continue}if(v<56320){a[_++]=239,a[_++]=191,a[_++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(a[_++]=239,a[_++]=191,a[_++]=189,w=null);v<128?a[_++]=v:(v<2048?a[_++]=v>>6|192:(v<65536?a[_++]=v>>12|224:(a[_++]=v>>18|240,a[_++]=v>>12&63|128),a[_++]=v>>6&63|128),a[_++]=63&v|128)}return _}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&hd(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Wh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Wh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&hd(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,Xr.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,pd,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Hs,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Ks,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Fr,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,ta,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,lc,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,hh,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,$h,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,cc,e)},writeBytesField:function(i,e){this.writeTag(i,Xr.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Xr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Xr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Xr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Xr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Xr.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Xr.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Xr.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Xr.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Xr.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var ph=_o(Ip);const Hh=3;function ef(i,e,r){e.glyphs=[],i===1&&r.readMessage(tm,e)}function tm(i,e,r){if(i===3){const{id:a,bitmap:u,width:_,height:v,left:w,top:A,advance:C}=r.readMessage(Mp,{});e.glyphs.push({id:a,bitmap:new Nr({width:_+2*Hh,height:v+2*Hh},u),metrics:{width:_,height:v,left:w,top:A,advance:C}})}else i===4?e.ascender=r.readSVarint():i===5&&(e.descender=r.readSVarint())}function Mp(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const tf=Hh;function dd(i){let e=0,r=0;for(const v of i)e+=v.w*v.h,r=Math.max(r,v.w);i.sort((v,w)=>w.h-v.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,_=0;for(const v of i)for(let w=a.length-1;w>=0;w--){const A=a[w];if(!(v.w>A.w||v.h>A.h)){if(v.x=A.x,v.y=A.y,_=Math.max(_,v.y+v.h),u=Math.max(u,v.x+v.w),v.w===A.w&&v.h===A.h){const C=a.pop();w<a.length&&(a[w]=C)}else v.h===A.h?(A.x+=v.w,A.w-=v.w):v.w===A.w?(A.y+=v.h,A.h-=v.h):(a.push({x:A.x+v.w,y:A.y,w:A.w-v.w,h:v.h}),A.y+=v.h,A.h-=v.h);break}}return{w:u,h:_,fill:e/(u*_)||0}}const cs=1;class fd{constructor(e,{pixelRatio:r,version:a,stretchX:u,stretchY:_,content:v}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=_,this.content=v,this.version=a}get tl(){return[this.paddedRect.x+cs,this.paddedRect.y+cs]}get br(){return[this.paddedRect.x+this.paddedRect.w-cs,this.paddedRect.y+this.paddedRect.h-cs]}get displaySize(){return[(this.paddedRect.w-2*cs)/this.pixelRatio,(this.paddedRect.h-2*cs)/this.pixelRatio]}}class rf{constructor(e,r){const a={},u={};this.haveRenderCallbacks=[];const _=[];this.addImages(e,a,_),this.addImages(r,u,_);const{w:v,h:w}=dd(_),A=new Ms({width:v||1,height:w||1});for(const C in e){const R=e[C],F=a[C].paddedRect;Ms.copy(R.data,A,{x:0,y:0},{x:F.x+cs,y:F.y+cs},R.data)}for(const C in r){const R=r[C],F=u[C].paddedRect,j=F.x+cs,Z=F.y+cs,$=R.data.width,J=R.data.height;Ms.copy(R.data,A,{x:0,y:0},{x:j,y:Z},R.data),Ms.copy(R.data,A,{x:0,y:J-1},{x:j,y:Z-1},{width:$,height:1}),Ms.copy(R.data,A,{x:0,y:0},{x:j,y:Z+J},{width:$,height:1}),Ms.copy(R.data,A,{x:$-1,y:0},{x:j-1,y:Z},{width:1,height:J}),Ms.copy(R.data,A,{x:0,y:0},{x:j+$,y:Z},{width:1,height:J})}this.image=A,this.iconPositions=a,this.patternPositions=u}addImages(e,r,a){for(const u in e){const _=e[u],v={x:0,y:0,w:_.data.width+2*cs,h:_.data.height+2*cs};a.push(v),r[u]=new fd(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,_]=e.tl;a.update(r.data,void 0,{x:u,y:_})}}Ft(fd,"ImagePosition"),Ft(rf,"ImageAtlas");const eo={horizontal:1,vertical:2,horizontalOnly:3},Cp=-17;class Kh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new Kh;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new Kh;return r.imageName=e,r}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new zu;for(let u=0;u<e.sections.length;u++){const _=e.sections[u];_.image?a.addImageSection(_):a.addTextSection(_,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,a){let u="";for(let _=0;_<r.length;_++){const v=r.charCodeAt(_+1)||null,w=r.charCodeAt(_-1)||null;u+=!a&&(v&&ic(v)&&!Rc[r[_+1]]||w&&ic(w)&&!Rc[r[_-1]])||!Rc[r[_]]?r[_]:Rc[r[_]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&ku[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&ku[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new zu;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Kh.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Hr("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Kh.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Hr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pu(i,e,r,a,u,_,v,w,A,C,R,F,j,Z,$){const J=zu.fromFeature(i,u);F===eo.vertical&&J.verticalizePunctuation(j);let se=[];const ye=function(Oe,ht,at,wt,Ot,mt){if(!Oe)return[];const It=[],At=function(ii,xi,oi,ar,qt,ki){let sr=0;for(let $r=0;$r<ii.length();$r++){const lr=ii.getSection($r);sr+=Yh(ii.getCharCode($r),lr,ar,qt,xi,ki)}return sr/Math.max(1,Math.ceil(sr/oi))}(Oe,ht,at,wt,Ot,mt),Dt=Oe.text.indexOf("​")>=0;let jt=0;for(let ii=0;ii<Oe.length();ii++){const xi=Oe.getSection(ii),oi=Oe.getCharCode(ii);if(ku[oi]||(jt+=Yh(oi,xi,wt,Ot,ht,mt)),ii<Oe.length()-1){const ar=!((yt=oi)<11904||!($t["Bopomofo Extended"](yt)||$t.Bopomofo(yt)||$t["CJK Compatibility Forms"](yt)||$t["CJK Compatibility Ideographs"](yt)||$t["CJK Compatibility"](yt)||$t["CJK Radicals Supplement"](yt)||$t["CJK Strokes"](yt)||$t["CJK Symbols and Punctuation"](yt)||$t["CJK Unified Ideographs Extension A"](yt)||$t["CJK Unified Ideographs"](yt)||$t["Enclosed CJK Letters and Months"](yt)||$t["Halfwidth and Fullwidth Forms"](yt)||$t.Hiragana(yt)||$t["Ideographic Description Characters"](yt)||$t["Kangxi Radicals"](yt)||$t["Katakana Phonetic Extensions"](yt)||$t.Katakana(yt)||$t["Vertical Forms"](yt)||$t["Yi Radicals"](yt)||$t["Yi Syllables"](yt)));(zp[oi]||ar||xi.imageName)&&It.push(nf(ii+1,jt,At,It,im(oi,Oe.getCharCode(ii+1),ar&&Dt),!1))}}var yt;return of(nf(Oe.length(),jt,At,It,0,!0))}(J,C,_,e,a,Z),{processBidirectionalText:Pe,processStyledBidirectionalText:ve}=k;if(Pe&&J.sections.length===1){const Oe=Pe(J.toString(),ye);for(const ht of Oe){const at=new zu;at.text=ht,at.sections=J.sections;for(let wt=0;wt<ht.length;wt++)at.sectionIndex.push(0);se.push(at)}}else if(ve){const Oe=ve(J.text,J.sectionIndex,ye);for(const ht of Oe){const at=new zu;at.text=ht[0],at.sectionIndex=ht[1],at.sections=J.sections,se.push(at)}}else se=function(Oe,ht){const at=[],wt=Oe.text;let Ot=0;for(const mt of ht)at.push(Oe.substring(Ot,mt)),Ot=mt;return Ot<wt.length&&at.push(Oe.substring(Ot,wt.length)),at}(J,ye);const ze=[],Ue={positionedLines:ze,text:J.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Oe,ht,at,wt,Ot,mt,It,At,Dt,jt,yt,ii){let xi=0,oi=0,ar=0;const qt=At==="right"?1:At==="left"?0:.5;let ki=!1;for(const hr of Ot){const pr=hr.getSections();for(const bn of pr){if(bn.imageName)continue;const Ln=ht[bn.fontStack];if(Ln&&(ki=Ln.ascender!==void 0&&Ln.descender!==void 0,!ki))break}if(!ki)break}let sr=0;for(const hr of Ot){hr.trim();const pr=hr.getMaxScale(),bn=(pr-1)*So,Ln={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[sr]=Ln;const Rn=Ln.positionedGlyphs;let wn=0;if(!hr.length()){oi+=mt,++sr;continue}let lo=0,Io=0;for(let Tn=0;Tn<hr.length();Tn++){const ia=hr.getSection(Tn),Go=hr.getSectionIndex(Tn),mo=hr.getCharCode(Tn);let Qr=ia.scale,Zo=null,Bn=null,Js=null,Xo=So,Va=0;const Ia=!(Dt===eo.horizontal||!yt&&!ul(mo)||yt&&(ku[mo]||($r=mo,$t.Arabic($r)||$t["Arabic Supplement"]($r)||$t["Arabic Extended-A"]($r)||$t["Arabic Presentation Forms-A"]($r)||$t["Arabic Presentation Forms-B"]($r))));if(ia.imageName){const Qs=wt[ia.imageName];if(!Qs)continue;Js=ia.imageName,Oe.iconsInText=Oe.iconsInText||!0,Bn=Qs.paddedRect;const Aa=Qs.displaySize;Qr=Qr*So/ii,Zo={width:Aa[0],height:Aa[1],left:cs,top:-tf,advance:Ia?Aa[1]:Aa[0],localGlyph:!1},Va=ki?-Zo.height*Qr:Cp+pr*So-Aa[1]*Qr,Xo=Zo.advance;const lu=(Ia?Aa[0]:Aa[1])*Qr-So*pr;lu>0&&lu>wn&&(wn=lu)}else{const Qs=at[ia.fontStack];if(!Qs)continue;Qs[mo]&&(Bn=Qs[mo]);const Aa=ht[ia.fontStack];if(!Aa)continue;const lu=Aa.glyphs[mo];if(!lu)continue;if(Zo=lu.metrics,Xo=mo!==8203?So:0,ki){const Ad=Aa.ascender!==void 0?Math.abs(Aa.ascender):0,xf=Aa.descender!==void 0?Math.abs(Aa.descender):0,bf=(Ad+xf)*Qr;lo<bf&&(lo=bf,Io=(Ad-xf)/2*Qr),Va=-Ad*Qr}else Va=Cp+(pr-Qr)*So}Ia?(Oe.verticalizable=!0,Rn.push({glyph:mo,imageName:Js,x:xi,y:oi+Va,vertical:Ia,scale:Qr,localGlyph:Zo.localGlyph,fontStack:ia.fontStack,sectionIndex:Go,metrics:Zo,rect:Bn}),xi+=Xo*Qr+jt):(Rn.push({glyph:mo,imageName:Js,x:xi,y:oi+Va,vertical:Ia,scale:Qr,localGlyph:Zo.localGlyph,fontStack:ia.fontStack,sectionIndex:Go,metrics:Zo,rect:Bn}),xi+=Zo.advance*Qr+jt)}Rn.length!==0&&(ar=Math.max(xi-jt,ar),ki?_d(Rn,qt,wn,Io,mt*pr/2):_d(Rn,qt,wn,0,mt/2)),xi=0;const qo=mt*pr+wn;Ln.lineOffset=Math.max(wn,bn),oi+=qo,++sr}var $r;const lr=oi,{horizontalAlign:Wi,verticalAlign:qn}=md(It);(function(hr,pr,bn,Ln,Rn,wn){const lo=(pr-bn)*Rn,Io=-wn*Ln;for(const qo of hr)for(const Tn of qo.positionedGlyphs)Tn.x+=lo,Tn.y+=Io})(Oe.positionedLines,qt,Wi,qn,ar,lr),Oe.top+=-qn*lr,Oe.bottom=Oe.top+lr,Oe.left+=-Wi*ar,Oe.right=Oe.left+ar,Oe.hasBaseline=ki}(Ue,e,r,a,se,v,w,A,F,C,j,$),!function(Oe){for(const ht of Oe)if(ht.positionedGlyphs.length!==0)return!1;return!0}(ze)&&Ue}const ku={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Yh(i,e,r,a,u,_){if(e.imageName){const v=a[e.imageName];return v?v.displaySize[0]*e.scale*So/_+u:0}{const v=r[e.fontStack],w=v&&v.glyphs[i];return w?w.metrics.advance*e.scale+u:0}}function dh(i,e,r,a){const u=Math.pow(i-e,2);return a?i<e?u/2:2*u:u+Math.abs(r)*r}function im(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function nf(i,e,r,a,u,_){let v=null,w=dh(e,r,u,_);for(const A of a){const C=dh(e-A.x,r,u,_)+A.badness;C<=w&&(v=A,w=C)}return{index:i,x:e,priorBreak:v,badness:w}}function of(i){return i?of(i.priorBreak).concat(i.index):[]}function md(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function _d(i,e,r,a,u){if(!(e||r||a||u))return;const _=i.length-1,v=i[_],w=(v.x+v.metrics.advance*v.scale)*e;for(let A=0;A<=_;A++)i[A].x-=w,i[A].y+=r+a+u}function af(i,e,r){const{horizontalAlign:a,verticalAlign:u}=md(r),_=e[0]-i.displaySize[0]*a,v=e[1]-i.displaySize[1]*u;return{image:i,top:v,bottom:v+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function Bc(i,e,r,a,u,_){const v=i.image;let w;if(v.content){const se=v.content,ye=v.pixelRatio||1;w=[se[0]/ye,se[1]/ye,v.displaySize[0]-se[2]/ye,v.displaySize[1]-se[3]/ye]}const A=e.left*_,C=e.right*_;let R,F,j,Z;r==="width"||r==="both"?(Z=u[0]+A-a[3],F=u[0]+C+a[1]):(Z=u[0]+(A+C-v.displaySize[0])/2,F=Z+v.displaySize[0]);const $=e.top*_,J=e.bottom*_;return r==="height"||r==="both"?(R=u[1]+$-a[0],j=u[1]+J+a[2]):(R=u[1]+($+J-v.displaySize[1])/2,j=R+v.displaySize[1]),{image:v,top:R,right:F,bottom:j,left:Z,collisionPadding:w}}class Fc extends Xt{constructor(e,r,a,u,_){super(e,r),this.angle=u,this.z=a,_!==void 0&&(this.segment=_)}clone(){return new Fc(this.x,this.y,this.z,this.angle,this.segment)}}function gd(i,e,r,a,u){if(e.segment===void 0)return!0;let _=e,v=e.segment+1,w=0;for(;w>-r/2;){if(v--,v<0)return!1;w-=i[v].dist(_),_=i[v]}w+=i[v].dist(i[v+1]),v++;const A=[];let C=0;for(;w<r/2;){const R=i[v],F=i[v+1];if(!F)return!1;let j=i[v-1].angleTo(R)-R.angleTo(F);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:w,angleDelta:j}),C+=j;w-A[0].distance>a;)C-=A.shift().angleDelta;if(C>u)return!1;v++,w+=R.dist(F)}return!0}function yd(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function sf(i,e,r){return i?.6*e*r:0}function rm(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function lf(i,e,r,a,u,_){const v=sf(r,u,_),w=rm(r,a)*_;let A=0;const C=yd(i)/2;for(let R=0;R<i.length-1;R++){const F=i[R],j=i[R+1],Z=F.dist(j);if(A+Z>C){const $=(C-A)/Z,J=Tr(F.x,j.x,$),se=Tr(F.y,j.y,$),ye=new Fc(J,se,0,j.angleTo(F),R);return!v||gd(i,ye,w,v,e)?ye:void 0}A+=Z}}function nm(i,e,r,a,u,_,v,w,A){const C=sf(a,_,v),R=rm(a,u),F=R*v,j=i[0].x===0||i[0].x===A||i[0].y===0||i[0].y===A;return e-F<e/4&&(e=F+e/4),cf(i,j?e/2*w%e:(R/2+2*_)*v*w%e,e,C,r,F,j,!1,A)}function cf(i,e,r,a,u,_,v,w,A){const C=_/2,R=yd(i);let F=0,j=e-r,Z=[];for(let $=0;$<i.length-1;$++){const J=i[$],se=i[$+1],ye=J.dist(se),Pe=se.angleTo(J);for(;j+r<F+ye;){j+=r;const ve=(j-F)/ye,ze=Tr(J.x,se.x,ve),Ue=Tr(J.y,se.y,ve);if(ze>=0&&ze<A&&Ue>=0&&Ue<A&&j-C>=0&&j+C<=R){const Oe=new Fc(ze,Ue,0,Pe,$);Oe._round(),a&&!gd(i,Oe,_,a,u)||Z.push(Oe)}}F+=ye}return w||Z.length||v||(Z=cf(i,F/2,r,a,u,_,v,!0,A)),Z}function vd(i,e,r,a,u){const _=[];for(let v=0;v<i.length;v++){const w=i[v];let A;for(let C=0;C<w.length-1;C++){let R=w[C],F=w[C+1];R.x<e&&F.x<e||(R.x<e?R=new Xt(e,R.y+(e-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x<e&&(F=new Xt(e,R.y+(e-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y<r&&F.y<r||(R.y<r?R=new Xt(R.x+(r-R.y)/(F.y-R.y)*(F.x-R.x),r)._round():F.y<r&&(F=new Xt(R.x+(r-R.y)/(F.y-R.y)*(F.x-R.x),r)._round()),R.x>=a&&F.x>=a||(R.x>=a?R=new Xt(a,R.y+(a-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x>=a&&(F=new Xt(a,R.y+(a-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y>=u&&F.y>=u||(R.y>=u?R=new Xt(R.x+(u-R.y)/(F.y-R.y)*(F.x-R.x),u)._round():F.y>=u&&(F=new Xt(R.x+(u-R.y)/(F.y-R.y)*(F.x-R.x),u)._round()),A&&R.equals(A[A.length-1])||(A=[R],_.push(A)),A.push(F)))))}}return _}Ft(Fc,"Anchor");const Jh=1e20;function Qh(i,e,r,a,u,_,v,w,A){for(let C=e;C<e+a;C++)uf(i,r*_+C,_,u,v,w,A);for(let C=r;C<r+u;C++)uf(i,C*_+e,1,a,v,w,A)}function uf(i,e,r,a,u,_,v){_[0]=0,v[0]=-Jh,v[1]=Jh,u[0]=i[e];for(let w=1,A=0,C=0;w<a;w++){u[w]=i[e+w*r];const R=w*w;do{const F=_[A];C=(u[w]-u[F]+R-F*F)/(w-F)/2}while(C<=v[A]&&--A>-1);A++,_[A]=w,v[A]=C,v[A+1]=Jh}for(let w=0,A=0;w<a;w++){for(;v[A+1]<w;)A++;const C=_[A],R=w-C;i[e+w*r]=u[C]+R*R}}const Ys=2,hf={none:0,ideographs:1,all:2};class fh{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const a=[];for(const u in e)for(const _ of e[u])a.push({stack:u,id:_});hn(a,({stack:u,id:_},v)=>{let w=this.entries[u];w||(w=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=w.glyphs[_];if(A!==void 0)return void v(null,{stack:u,id:_,glyph:A});if(A=this._tinySDF(w,u,_),A)return w.glyphs[_]=A,void v(null,{stack:u,id:_,glyph:A});const C=Math.floor(_/256);if(256*C>65535)return void v(new Error("glyphs > 65535 not supported"));if(w.ranges[C])return void v(null,{stack:u,id:_,glyph:A});let R=w.requests[C];R||(R=w.requests[C]=[],fh.loadGlyphRange(u,C,this.url,this.requestManager,(F,j)=>{if(j){w.ascender=j.ascender,w.descender=j.descender;for(const Z in j.glyphs)this._doesCharSupportLocalGlyph(+Z)||(w.glyphs[+Z]=j.glyphs[+Z]);w.ranges[C]=!0}for(const Z of R)Z(F,j);delete w.requests[C]})),R.push((F,j)=>{F?v(F):j&&v(null,{stack:u,id:_,glyph:j.glyphs[_]||null})})},(u,_)=>{if(u)r(u);else if(_){const v={};for(const{stack:w,id:A,glyph:C}of _)v[w]===void 0&&(v[w]={}),v[w].glyphs===void 0&&(v[w].glyphs={}),v[w].glyphs[A]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;r(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==hf.none&&(this.localGlyphMode===hf.all?!!this.localFontFamily:!!this.localFontFamily&&($t["CJK Unified Ideographs"](e)||$t["Hangul Syllables"](e)||$t.Hiragana(e)||$t.Katakana(e)||$t["CJK Symbols and Punctuation"](e)))}_tinySDF(e,r,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let _=e.tinySDF;if(!_){let J="400";/bold/i.test(r)?J="900":/medium/i.test(r)?J="500":/light/i.test(r)&&(J="200"),_=e.tinySDF=new fh.TinySDF({fontFamily:u,fontWeight:J,fontSize:24*Ys,buffer:3*Ys,radius:8*Ys}),_.fontWeight=J}if(this.localGlyphs[_.fontWeight][a])return this.localGlyphs[_.fontWeight][a];const v=String.fromCharCode(a),{data:w,width:A,height:C,glyphWidth:R,glyphHeight:F,glyphLeft:j,glyphTop:Z,glyphAdvance:$}=_.draw(v);return this.localGlyphs[_.fontWeight][a]={id:a,bitmap:new Nr({width:A,height:C},w),metrics:{width:R/Ys,height:F/Ys,left:j/Ys,top:Z/Ys-27,advance:$/Ys,localGlyph:!0}}}}fh.loadGlyphRange=function(i,e,r,a,u){const _=256*e,v=_+255,w=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${_}-${v}`),Ls.Glyphs);Rs(w,(A,C)=>{if(A)u(A);else if(C){const R={},F=function(j){return new ph(j).readFields(ef,{})}(C);for(const j of F.glyphs)R[j.id]=j;u(null,{glyphs:R,ascender:F.ascender,descender:F.descender})}})},fh.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:_="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const w=this.size=i+4*e,A=this._createCanvas(w),C=this.ctx=A.getContext("2d",{willReadFrequently:!0});C.font=`${v} ${_} ${i}px ${u}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:_}=this.ctx.measureText(i),v=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-u))),A=Math.min(this.size-this.buffer,v+Math.ceil(a)),C=w+2*this.buffer,R=A+2*this.buffer,F=Math.max(C*R,0),j=new Uint8ClampedArray(F),Z={data:j,width:C,height:R,glyphWidth:w,glyphHeight:A,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||A===0)return Z;const{ctx:$,buffer:J,gridInner:se,gridOuter:ye}=this;$.clearRect(J,J,w,A),$.fillText(i,J,J+v);const Pe=$.getImageData(J,J,w,A);ye.fill(Jh,0,F),se.fill(0,0,F);for(let ve=0;ve<A;ve++)for(let ze=0;ze<w;ze++){const Ue=Pe.data[4*(ve*w+ze)+3]/255;if(Ue===0)continue;const Oe=(ve+J)*C+ze+J;if(Ue===1)ye[Oe]=0,se[Oe]=Jh;else{const ht=.5-Ue;ye[Oe]=ht>0?ht*ht:0,se[Oe]=ht<0?ht*ht:0}}Qh(ye,0,0,C,R,C,this.f,this.v,this.z),Qh(se,J,J,w,A,C,this.f,this.v,this.z);for(let ve=0;ve<F;ve++){const ze=Math.sqrt(ye[ve])-Math.sqrt(se[ve]);j[ve]=Math.round(255-255*(ze/this.radius+this.cutoff))}return Z}};const ep=cs;function om(i,e,r,a){const u=[],_=i.image,v=_.pixelRatio,w=_.paddedRect.w-2*ep,A=_.paddedRect.h-2*ep,C=i.right-i.left,R=i.bottom-i.top,F=_.stretchX||[[0,w]],j=_.stretchY||[[0,A]],Z=(mt,It)=>mt+It[1]-It[0],$=F.reduce(Z,0),J=j.reduce(Z,0),se=w-$,ye=A-J;let Pe=0,ve=$,ze=0,Ue=J,Oe=0,ht=se,at=0,wt=ye;if(_.content&&a){const mt=_.content;Pe=xd(F,0,mt[0]),ze=xd(j,0,mt[1]),ve=xd(F,mt[0],mt[2]),Ue=xd(j,mt[1],mt[3]),Oe=mt[0]-Pe,at=mt[1]-ze,ht=mt[2]-mt[0]-ve,wt=mt[3]-mt[1]-Ue}const Ot=(mt,It,At,Dt)=>{const jt=bd(mt.stretch-Pe,ve,C,i.left),yt=wd(mt.fixed-Oe,ht,mt.stretch,$),ii=bd(It.stretch-ze,Ue,R,i.top),xi=wd(It.fixed-at,wt,It.stretch,J),oi=bd(At.stretch-Pe,ve,C,i.left),ar=wd(At.fixed-Oe,ht,At.stretch,$),qt=bd(Dt.stretch-ze,Ue,R,i.top),ki=wd(Dt.fixed-at,wt,Dt.stretch,J),sr=new Xt(jt,ii),$r=new Xt(oi,ii),lr=new Xt(oi,qt),Wi=new Xt(jt,qt),qn=new Xt(yt/v,xi/v),hr=new Xt(ar/v,ki/v),pr=e*Math.PI/180;if(pr){const Rn=Math.sin(pr),wn=Math.cos(pr),lo=[wn,-Rn,Rn,wn];sr._matMult(lo),$r._matMult(lo),Wi._matMult(lo),lr._matMult(lo)}const bn=mt.stretch+mt.fixed,Ln=It.stretch+It.fixed;return{tl:sr,tr:$r,bl:Wi,br:lr,tex:{x:_.paddedRect.x+ep+bn,y:_.paddedRect.y+ep+Ln,w:At.stretch+At.fixed-bn,h:Dt.stretch+Dt.fixed-Ln},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qn,pixelOffsetBR:hr,minFontScaleX:ht/v/C,minFontScaleY:wt/v/R,isSDF:r}};if(a&&(_.stretchX||_.stretchY)){const mt=am(F,se,$),It=am(j,ye,J);for(let At=0;At<mt.length-1;At++){const Dt=mt[At],jt=mt[At+1];for(let yt=0;yt<It.length-1;yt++)u.push(Ot(Dt,It[yt],jt,It[yt+1]))}}else u.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:A+1}));return u}function xd(i,e,r){let a=0;for(const u of i)a+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return a}function am(i,e,r){const a=[{fixed:-ep,stretch:0}];for(const[u,_]of i){const v=a[a.length-1];a.push({fixed:u-v.stretch,stretch:v.stretch}),a.push({fixed:u-v.stretch,stretch:v.stretch+(_-u)})}return a.push({fixed:e+ep,stretch:r}),a}function bd(i,e,r,a){return i/e*r+a}function wd(i,e,r,a){return i-e*r/a}function Mm(i,e,r,a){const u=e+i.positionedLines[a].lineOffset;return a===0?r+u/2:r+(u+(e+i.positionedLines[a-1].lineOffset))/2}class Cm{constructor(e=[],r=zm){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,u=r[e];for(;e>0;){const _=e-1>>1,v=r[_];if(a(u,v)>=0)break;r[e]=v,e=_}r[e]=u}_down(e){const{data:r,compare:a}=this,u=this.length>>1,_=r[e];for(;e<u;){let v=1+(e<<1),w=r[v];const A=v+1;if(A<this.length&&a(r[A],w)<0&&(v=A,w=r[A]),a(w,_)>=0)break;r[e]=w,e=v}r[e]=_}}function zm(i,e){return i<e?-1:i>e?1:0}function Y_(i,e=1,r=!1){let a=1/0,u=1/0,_=-1/0,v=-1/0;const w=i[0];for(let Z=0;Z<w.length;Z++){const $=w[Z];(!Z||$.x<a)&&(a=$.x),(!Z||$.y<u)&&(u=$.y),(!Z||$.x>_)&&(_=$.x),(!Z||$.y>v)&&(v=$.y)}const A=Math.min(_-a,v-u);let C=A/2;const R=new Cm([],J_);if(A===0)return new Xt(a,u);for(let Z=a;Z<_;Z+=A)for(let $=u;$<v;$+=A)R.push(new Td(Z+C,$+C,C,i));let F=function(Z){let $=0,J=0,se=0;const ye=Z[0];for(let Pe=0,ve=ye.length,ze=ve-1;Pe<ve;ze=Pe++){const Ue=ye[Pe],Oe=ye[ze],ht=Ue.x*Oe.y-Oe.x*Ue.y;J+=(Ue.x+Oe.x)*ht,se+=(Ue.y+Oe.y)*ht,$+=3*ht}return new Td(J/$,se/$,0,Z)}(i),j=R.length;for(;R.length;){const Z=R.pop();(Z.d>F.d||!F.d)&&(F=Z,r&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,j)),Z.max-F.d<=e||(C=Z.h/2,R.push(new Td(Z.p.x-C,Z.p.y-C,C,i)),R.push(new Td(Z.p.x+C,Z.p.y-C,C,i)),R.push(new Td(Z.p.x-C,Z.p.y+C,C,i)),R.push(new Td(Z.p.x+C,Z.p.y+C,C,i)),j+=4)}return r&&(console.log(`num probes: ${j}`),console.log(`best distance: ${F.d}`)),F.p}function J_(i,e){return e.max-i.max}class Td{constructor(e,r,a,u){this.p=new Xt(e,r),this.h=a,this.d=function(_,v){let w=!1,A=1/0;for(let C=0;C<v.length;C++){const R=v[C];for(let F=0,j=R.length,Z=j-1;F<j;Z=F++){const $=R[F],J=R[Z];$.y>_.y!=J.y>_.y&&_.x<(J.x-$.x)*(_.y-$.y)/(J.y-$.y)+$.x&&(w=!w),A=Math.min(A,qf(_,$,J))}}return(w?1:-1)*Math.sqrt(A)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Ed=7,Pm=Number.POSITIVE_INFINITY,Q_=Math.sqrt(2);function r_(i,[e,r]){let a=0,u=0;if(r===Pm){e<0&&(e=0);const _=e/Q_;switch(i){case"top-right":case"top-left":u=_-Ed;break;case"bottom-right":case"bottom-left":u=-_+Ed;break;case"bottom":u=-e+Ed;break;case"top":u=e-Ed}switch(i){case"top-right":case"bottom-right":a=-_;break;case"top-left":case"bottom-left":a=_;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),i){case"top-right":case"top-left":case"top":u=r-Ed;break;case"bottom-right":case"bottom-left":case"bottom":u=-r+Ed}switch(i){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function eg(i,e,r,a,u,_,v,w,A,C){i.createArrays(),i.tilePixelRatio=Ci/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const R=i.layers[0].layout,F=i.layers[0]._unevaluatedLayout._values,j={};if(i.textSizeData.kind==="composite"){const{minZoom:J,maxZoom:se}=i.textSizeData;j.compositeTextSizes=[F["text-size"].possiblyEvaluate(new B(J),w),F["text-size"].possiblyEvaluate(new B(se),w)]}if(i.iconSizeData.kind==="composite"){const{minZoom:J,maxZoom:se}=i.iconSizeData;j.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new B(J),w),F["icon-size"].possiblyEvaluate(new B(se),w)]}j.layoutTextSize=F["text-size"].possiblyEvaluate(new B(A+1),w),j.layoutIconSize=F["icon-size"].possiblyEvaluate(new B(A+1),w),j.textMaxSize=F["text-size"].possiblyEvaluate(new B(18),w);const Z=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",$=R.get("text-size");for(const J of i.features){const se=R.get("text-font").evaluate(J,{},w).join(","),ye=$.evaluate(J,{},w),Pe=j.layoutTextSize.evaluate(J,{},w),ve=(j.layoutIconSize.evaluate(J,{},w),{horizontal:{},vertical:void 0}),ze=J.text;let Ue,Oe=[0,0];if(ze){const wt=ze.toString(),Ot=R.get("text-letter-spacing").evaluate(J,{},w)*So,mt=R.get("text-line-height").evaluate(J,{},w)*So,It=tc(wt)?Ot:0,At=R.get("text-anchor").evaluate(J,{},w),Dt=R.get("text-variable-anchor");if(!Dt){const oi=R.get("text-radial-offset").evaluate(J,{},w);Oe=oi?r_(At,[oi*So,Pm]):R.get("text-offset").evaluate(J,{},w).map(ar=>ar*So)}let jt=Z?"center":R.get("text-justify").evaluate(J,{},w);const yt=R.get("symbol-placement")==="point",ii=yt?R.get("text-max-width").evaluate(J,{},w)*So:1/0,xi=oi=>{i.allowVerticalPlacement&&qs(wt)&&(ve.vertical=Pu(ze,e,r,u,se,ii,mt,At,oi,It,Oe,eo.vertical,!0,Pe,ye))};if(!Z&&Dt){const oi=jt==="auto"?Dt.map(qt=>km(qt)):[jt];let ar=!1;for(let qt=0;qt<oi.length;qt++){const ki=oi[qt];if(!ve.horizontal[ki])if(ar)ve.horizontal[ki]=ve.horizontal[0];else{const sr=Pu(ze,e,r,u,se,ii,mt,"center",ki,It,Oe,eo.horizontal,!1,Pe,ye);sr&&(ve.horizontal[ki]=sr,ar=sr.positionedLines.length===1)}}xi("left")}else{if(jt==="auto"&&(jt=km(At)),yt||R.get("text-writing-mode").indexOf("horizontal")>=0||!qs(wt)){const oi=Pu(ze,e,r,u,se,ii,mt,At,jt,It,Oe,eo.horizontal,!1,Pe,ye);oi&&(ve.horizontal[jt]=oi)}xi(yt?"left":jt)}}let ht=!1;if(J.icon&&J.icon.name){const wt=a[J.icon.name];wt&&(Ue=af(u[J.icon.name],R.get("icon-offset").evaluate(J,{},w),R.get("icon-anchor").evaluate(J,{},w)),ht=wt.sdf,i.sdfIcons===void 0?i.sdfIcons=wt.sdf:i.sdfIcons!==wt.sdf&&Hr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(wt.pixelRatio!==i.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const at=o_(ve.horizontal)||ve.vertical;i.iconsInText||(i.iconsInText=!!at&&at.iconsInText),(at||Ue)&&tg(i,J,ve,Ue,a,j,Pe,0,Oe,ht,v,w,C)}_&&i.generateCollisionDebugBuffers(A,i.collisionBoxArray)}function km(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tg(i,e,r,a,u,_,v,w,A,C,R,F,j){let Z=_.textMaxSize.evaluate(e,{},F);Z===void 0&&(Z=v);const $=i.layers[0].layout,J=$.get("icon-offset").evaluate(e,{},F),se=o_(r.horizontal)||r.vertical,ye=j.name==="globe",Pe=So,ve=v/Pe,ze=i.tilePixelRatio*Z/Pe,Ue=(At=i.overscaling,i.zoom>18&&At>2&&(At>>=1),Math.max(Ci/(512*At),1)*$.get("symbol-spacing")),Oe=$.get("text-padding")*i.tilePixelRatio,ht=$.get("icon-padding")*i.tilePixelRatio,at=Ki($.get("text-max-angle")),wt=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Ot=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",mt=$.get("symbol-placement"),It=Ue/2;var At;const Dt=$.get("icon-text-fit");let jt;a&&Dt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(jt=Bc(a,r.vertical,Dt,$.get("icon-text-fit-padding"),J,ve)),se&&(a=Bc(a,se,Dt,$.get("icon-text-fit-padding"),J,ve)));const yt=(ii,xi,oi)=>{if(xi.x<0||xi.x>=Ci||xi.y<0||xi.y>=Ci)return;let ar=null;if(ye){const{x:qt,y:ki,z:sr}=j.projectTilePoint(xi.x,xi.y,oi);ar={anchor:new Fc(qt,ki,sr,0,void 0),up:j.upVector(oi,xi.x,xi.y)}}(function(qt,ki,sr,$r,lr,Wi,qn,hr,pr,bn,Ln,Rn,wn,lo,Io,qo,Tn,ia,Go,mo,Qr,Zo,Bn,Js,Xo){const Va=qt.addToLineVertexArray(ki,$r);let Ia,Qs,Aa,lu,Ad,xf,bf,O_=0,U_=0,V_=0,N_=0,Wm=-1,$m=-1;const Bu={};let j_=Cd("");const Dp=sr?sr.anchor:ki;let Hm=0,Km=0;if(pr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Hm,Km]=pr.layout.get("text-offset").evaluate(Qr,{},Xo).map(Vl=>Vl*So):(Hm=pr.layout.get("text-radial-offset").evaluate(Qr,{},Xo)*So,Km=Pm),qt.allowVerticalPlacement&&lr.vertical){const Vl=lr.vertical;if(Io)xf=Dm(Vl),hr&&(bf=Dm(hr));else{const Nl=pr.layout.get("text-rotate").evaluate(Qr,{},Xo)+90;Aa=sm(bn,Dp,ki,Ln,Rn,wn,Vl,lo,Nl,qo),hr&&(lu=sm(bn,Dp,ki,Ln,Rn,wn,hr,ia,Nl))}}if(Wi){const Vl=pr.layout.get("icon-rotate").evaluate(Qr,{},Xo),Nl=pr.layout.get("icon-text-fit")!=="none",wf=om(Wi,Vl,Bn,Nl),Jm=hr?om(hr,Vl,Bn,Nl):void 0;Qs=sm(bn,Dp,ki,Ln,Rn,wn,Wi,ia,Vl),O_=4*wf.length;const q_=qt.iconSizeData;let Lp=null;q_.kind==="source"?(Lp=[$s*pr.layout.get("icon-size").evaluate(Qr,{},Xo)],Lp[0]>tp&&Hr(`${qt.layerIds[0]}: Value for "icon-size" is >= ${pf}. Reduce your "icon-size".`)):q_.kind==="composite"&&(Lp=[$s*Zo.compositeIconSizes[0].evaluate(Qr,{},Xo),$s*Zo.compositeIconSizes[1].evaluate(Qr,{},Xo)],(Lp[0]>tp||Lp[1]>tp)&&Hr(`${qt.layerIds[0]}: Value for "icon-size" is >= ${pf}. Reduce your "icon-size".`)),qt.addSymbols(qt.icon,wf,Lp,mo,Go,Qr,!1,sr,ki,Va.lineStartIndex,Va.lineLength,-1,Js,Xo),Wm=qt.icon.placedSymbolArray.length-1,Jm&&(U_=4*Jm.length,qt.addSymbols(qt.icon,Jm,Lp,mo,Go,Qr,eo.vertical,sr,ki,Va.lineStartIndex,Va.lineLength,-1,Js,Xo),$m=qt.icon.placedSymbolArray.length-1)}for(const Vl in lr.horizontal){const Nl=lr.horizontal[Vl];Ia||(j_=Cd(Nl.text),Io?Ad=Dm(Nl):Ia=sm(bn,Dp,ki,Ln,Rn,wn,Nl,lo,pr.layout.get("text-rotate").evaluate(Qr,{},Xo),qo));const wf=Nl.positionedLines.length===1;if(V_+=n_(qt,sr,ki,Nl,qn,pr,Io,Qr,qo,Va,lr.vertical?eo.horizontal:eo.horizontalOnly,wf?Object.keys(lr.horizontal):[Vl],Bu,Wm,Zo,Js,Xo),wf)break}lr.vertical&&(N_+=n_(qt,sr,ki,lr.vertical,qn,pr,Io,Qr,qo,Va,eo.vertical,["vertical"],Bu,$m,Zo,Js,Xo));let sp=-1;const Ym=(Vl,Nl)=>Vl?Math.max(Vl,Nl):Nl;sp=Ym(Ad,sp),sp=Ym(xf,sp),sp=Ym(bf,sp);const Cg=sp>-1?1:0;qt.glyphOffsetArray.length>=rp.MAX_GLYPHS&&Hr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qr.sortKey!==void 0&&qt.addToSortKeyRanges(qt.symbolInstances.length,Qr.sortKey),qt.symbolInstances.emplaceBack(Dp.x,Dp.y,Dp.z,ki.x,ki.y,Bu.right>=0?Bu.right:-1,Bu.center>=0?Bu.center:-1,Bu.left>=0?Bu.left:-1,Bu.vertical>=0?Bu.vertical:-1,Wm,$m,j_,Ia!==void 0?Ia:qt.collisionBoxArray.length,Ia!==void 0?Ia+1:qt.collisionBoxArray.length,Aa!==void 0?Aa:qt.collisionBoxArray.length,Aa!==void 0?Aa+1:qt.collisionBoxArray.length,Qs!==void 0?Qs:qt.collisionBoxArray.length,Qs!==void 0?Qs+1:qt.collisionBoxArray.length,lu||qt.collisionBoxArray.length,lu?lu+1:qt.collisionBoxArray.length,Ln,V_,N_,O_,U_,Cg,0,Hm,Km,sp)})(i,xi,ar,ii,r,a,u,jt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Oe,wt,A,0,ht,Ot,J,e,_,C,R,F)};if(mt==="line")for(const ii of vd(e.geometry,0,0,Ci,Ci)){const xi=nm(ii,Ue,at,r.vertical||se,a,Pe,ze,i.overscaling,Ci);for(const oi of xi)se&&ig(i,se.text,It,oi)||yt(ii,oi,F)}else if(mt==="line-center"){for(const ii of e.geometry)if(ii.length>1){const xi=lf(ii,at,r.vertical||se,a,Pe,ze);xi&&yt(ii,xi,F)}}else if(e.type==="Polygon")for(const ii of ke(e.geometry,0)){const xi=Y_(ii,16);yt(ii[0],new Fc(xi.x,xi.y,0,0,void 0),F)}else if(e.type==="LineString")for(const ii of e.geometry)yt(ii,new Fc(ii[0].x,ii[0].y,0,0,void 0),F);else if(e.type==="Point")for(const ii of e.geometry)for(const xi of ii)yt([xi],new Fc(xi.x,xi.y,0,0,void 0),F)}const pf=255,tp=pf*$s;function n_(i,e,r,a,u,_,v,w,A,C,R,F,j,Z,$,J,se){const ye=function(ze,Ue,Oe,ht,at,wt,Ot,mt){const It=[];if(Ue.positionedLines.length===0)return It;const At=ht.layout.get("text-rotate").evaluate(wt,{})*Math.PI/180,Dt=function(oi){const ar=oi[0],qt=oi[1],ki=ar*qt;return ki>0?[ar,-qt]:ki<0?[-ar,qt]:ar===0?[qt,ar]:[qt,-ar]}(Oe);let jt=Math.abs(Ue.top-Ue.bottom);for(const oi of Ue.positionedLines)jt-=oi.lineOffset;const yt=Ue.positionedLines.length,ii=jt/yt;let xi=Ue.top-Oe[1];for(let oi=0;oi<yt;++oi){const ar=Ue.positionedLines[oi];xi=Mm(Ue,ii,xi,oi);for(const qt of ar.positionedGlyphs){if(!qt.rect)continue;const ki=qt.rect||{};let sr=tf+1,$r=!0,lr=1,Wi=0;if(qt.imageName){const Bn=Ot[qt.imageName];if(!Bn)continue;if(Bn.sdf){Hr("SDF images are not supported in formatted text and will be ignored.");continue}$r=!1,lr=Bn.pixelRatio,sr=cs/lr}const qn=(at||mt)&&qt.vertical,hr=qt.metrics.advance*qt.scale/2,pr=qt.metrics,bn=qt.rect;if(bn===null)continue;mt&&Ue.verticalizable&&(Wi=qt.imageName?hr-qt.metrics.width*qt.scale/2:0);const Ln=at?[qt.x+hr,qt.y]:[0,0];let Rn=[0,0],wn=[0,0],lo=!1;at||(qn?(wn=[qt.x+hr+Dt[0],qt.y+Dt[1]-Wi],lo=!0):Rn=[qt.x+hr+Oe[0],qt.y+Oe[1]-Wi]);const Io=bn.w*qt.scale/(lr*(qt.localGlyph?Ys:1)),qo=bn.h*qt.scale/(lr*(qt.localGlyph?Ys:1));let Tn,ia,Go,mo;if(qn){const Bn=qt.y-xi,Js=new Xt(-hr,hr-Bn),Xo=-Math.PI/2,Va=new Xt(...wn);Tn=new Xt(-hr+Rn[0],Rn[1]),Tn._rotateAround(Xo,Js)._add(Va),Tn.x+=-Bn+hr,Tn.y-=(pr.left-sr)*qt.scale;const Ia=qt.imageName?pr.advance*qt.scale:So*qt.scale,Qs=String.fromCharCode(qt.glyph);Xh(Qs)?Tn.x+=(1-sr)*qt.scale:Sp(Qs)?Tn.x+=Ia-pr.height*qt.scale+(-sr-1)*qt.scale:Tn.x+=qt.imageName||pr.width+2*sr===bn.w&&pr.height+2*sr===bn.h?(Ia-qo)/2:(Ia-(pr.height+2*sr)*qt.scale)/2,ia=new Xt(Tn.x,Tn.y-Io),Go=new Xt(Tn.x+qo,Tn.y),mo=new Xt(Tn.x+qo,Tn.y-Io)}else{const Bn=(pr.left-sr)*qt.scale-hr+Rn[0],Js=(-pr.top-sr)*qt.scale+Rn[1],Xo=Bn+Io,Va=Js+qo;Tn=new Xt(Bn,Js),ia=new Xt(Xo,Js),Go=new Xt(Bn,Va),mo=new Xt(Xo,Va)}if(At){let Bn;Bn=at?new Xt(0,0):lo?new Xt(Dt[0],Dt[1]):new Xt(Oe[0],Oe[1]),Tn._rotateAround(At,Bn),ia._rotateAround(At,Bn),Go._rotateAround(At,Bn),mo._rotateAround(At,Bn)}const Qr=new Xt(0,0),Zo=new Xt(0,0);It.push({tl:Tn,tr:ia,bl:Go,br:mo,tex:ki,writingMode:Ue.writingMode,glyphOffset:Ln,sectionIndex:qt.sectionIndex,isSDF:$r,pixelOffsetTL:Qr,pixelOffsetBR:Zo,minFontScaleX:0,minFontScaleY:0})}}return It}(0,a,A,_,v,w,u,i.allowVerticalPlacement),Pe=i.textSizeData;let ve=null;Pe.kind==="source"?(ve=[$s*_.layout.get("text-size").evaluate(w,{},se)],ve[0]>tp&&Hr(`${i.layerIds[0]}: Value for "text-size" is >= ${pf}. Reduce your "text-size".`)):Pe.kind==="composite"&&(ve=[$s*$.compositeTextSizes[0].evaluate(w,{},se),$s*$.compositeTextSizes[1].evaluate(w,{},se)],(ve[0]>tp||ve[1]>tp)&&Hr(`${i.layerIds[0]}: Value for "text-size" is >= ${pf}. Reduce your "text-size".`)),i.addSymbols(i.text,ye,ve,A,v,w,R,e,r,C.lineStartIndex,C.lineLength,Z,J,se);for(const ze of F)j[ze]=i.text.placedSymbolArray.length-1;return 4*ye.length}function o_(i){for(const e in i)return i[e];return null}function sm(i,e,r,a,u,_,v,w,A,C){let R=v.top,F=v.bottom,j=v.left,Z=v.right;const $=v.collisionPadding;if($&&(j-=$[0],R-=$[1],Z+=$[2],F+=$[3]),A){const J=new Xt(j,R),se=new Xt(Z,R),ye=new Xt(j,F),Pe=new Xt(Z,F),ve=Ki(A);let ze=new Xt(0,0);C&&(ze=new Xt(C[0],C[1])),J._rotateAround(ve,ze),se._rotateAround(ve,ze),ye._rotateAround(ve,ze),Pe._rotateAround(ve,ze),j=Math.min(J.x,se.x,ye.x,Pe.x),Z=Math.max(J.x,se.x,ye.x,Pe.x),R=Math.min(J.y,se.y,ye.y,Pe.y),F=Math.max(J.y,se.y,ye.y,Pe.y)}return i.emplaceBack(e.x,e.y,e.z,r.x,r.y,j,R,Z,F,w,a,u,_),i.length-1}function Dm(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function ig(i,e,r,a){const u=i.compareText;if(e in u){const _=u[e];for(let v=_.length-1;v>=0;v--)if(a.dist(_[v])<r)return!0}else u[e]=[];return u[e].push(a),!1}function a_(i,e){const r=i.fovAboveCenter,a=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,u=(i._camera.position[2]*i.worldSize-a)/Math.cos(i._pitch),_=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-i._pitch-r,.01)),v=Math.sin(i._pitch)*_+u;return Math.min(1.01*v,u*(1/i._horizonShift))}function Pp(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const r=Math.pow(2,-i.z),a=i.x*r,u=(i.x+1)*r,_=i.y*r,v=(i.y+1)*r,w=as(a),A=as(u),C=Vo(_),R=Vo(v),F=e.project(w,C),j=e.project(A,C),Z=e.project(A,R),$=e.project(w,R);let J=Math.min(F.x,j.x,Z.x,$.x),se=Math.min(F.y,j.y,Z.y,$.y),ye=Math.max(F.x,j.x,Z.x,$.x),Pe=Math.max(F.y,j.y,Z.y,$.y);const ve=r/16;function ze(Oe,ht,at,wt,Ot,mt){const It=(at+Ot)/2,At=(wt+mt)/2,Dt=e.project(as(It),Vo(At)),jt=Math.max(0,J-Dt.x,se-Dt.y,Dt.x-ye,Dt.y-Pe);J=Math.min(J,Dt.x),ye=Math.max(ye,Dt.x),se=Math.min(se,Dt.y),Pe=Math.max(Pe,Dt.y),jt>ve&&(ze(Oe,Dt,at,wt,It,At),ze(Dt,ht,It,At,Ot,mt))}ze(F,j,a,_,u,_),ze(j,Z,u,_,u,v),ze(Z,$,u,v,a,v),ze($,F,a,v,a,_),J-=ve,se-=ve,ye+=ve,Pe+=ve;const Ue=1/Math.max(ye-J,Pe-se);return{scale:Ue,x:J*Ue,y:se*Ue,x2:ye*Ue,y2:Pe*Ue,projection:e}}const rg=pl(new Float32Array(16));class ip{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new _n(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return Fl(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return a_(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,u){const _=e.horizonLineFromTop(!1),v=new Xt(r,Math.max(_,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(v,u))}pointCoordinate3D(e,r,a){const u=new Xt(r,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const _=this.pointCoordinate(e,u.x,u.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return rg}createTileMatrix(e,r,a){let u,_,v;const w=a.canonical,A=pl(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=Pp(w,this);u=1,_=C.x+a.wrap*C.scale,v=C.y,Qu(A,A,[u/C.scale,u/C.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(w.z),_=(w.x+Math.pow(2,w.z)*a.wrap)*u,v=w.y*u;return pp(A,A,[_,v,0]),Qu(A,A,[u/Ci,u/Ci,1]),A}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class ng extends ip{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Ki(r));this.n=(u+Math.sin(Ki(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:u,r0:_}=this,v=Ki(e-this.center[0]),w=Ki(r),A=Math.sqrt(u-2*a*Math.sin(w))/a;return{x:A*Math.sin(v*a),y:A*Math.cos(v*a)-_,z:0}}unproject(e,r){const{n:a,c:u,r0:_}=this,v=_+r;let w=Math.atan2(e,Math.abs(v))*Math.sign(v);v*a<0&&(w-=Math.PI*Math.sign(e)*Math.sign(v));const A=Ki(this.center[0])*a;w=tn(w,-Math.PI-A,Math.PI-A);const C=or(en(w/a)+this.center[0],-180,180),R=Math.asin(or((u-(e*e+v*v)*a*a)/(2*a),-1,1)),F=or(en(R),-bo,bo);return new _n(C,F)}}const df=1.340264,ff=-.081106,mf=893e-6,_f=.003796,lm=Math.sqrt(3)/2;class og extends ip{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(lm*Math.sin(r)),u=a*a,_=u*u*u;return{x:.5*(e*Math.cos(a)/(lm*(df+3*ff*u+_*(7*mf+9*_f*u)))/Math.PI+.5),y:1-.5*(a*(df+ff*u+_*(mf+_f*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=a*a,_=u*u*u;for(let R,F,j,Z=0;Z<12&&(F=a*(df+ff*u+_*(mf+_f*u))-r,j=df+3*ff*u+_*(7*mf+9*_f*u),R=F/j,a=or(a-R,-Math.PI/3,Math.PI/3),u=a*a,_=u*u*u,!(Math.abs(R)<1e-12));++Z);const v=lm*e*(df+3*ff*u+_*(7*mf+9*_f*u))/Math.cos(a),w=Math.asin(Math.sin(a)/lm),A=or(180*v/Math.PI,-180,180),C=or(180*w/Math.PI,-bo,bo);return new _n(A,C)}}class ag extends ip{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),u=or(360*(.5-r),-bo,bo);return new _n(a,u)}}const Sd=Math.PI/2;function cm(i){return Math.tan((Sd+i)/2)}class sg extends ip{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let u=Ki(r),_=Ki(a);this.southernCenter=u+_<0,this.southernCenter&&(u=-u,_=-_);const v=Math.cos(u),w=cm(u);this.n=u===_?Math.sin(u):Math.log(v/Math.cos(_))/Math.log(cm(_)/w),this.f=v*Math.pow(cm(u),this.n)/this.n}project(e,r){r=Ki(r),this.southernCenter&&(r=-r),e=Ki(e-this.center[0]);const a=1e-6,{n:u,f:_}=this;_>0?r<-Sd+a&&(r=-Sd+a):r>Sd-a&&(r=Sd-a);const v=_/Math.pow(cm(r),u);let w=v*Math.sin(u*e),A=_-v*Math.cos(u*e);return w=.5*(w/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:w,y:this.southernCenter?A:1-A,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:u}=this,_=u-r,v=Math.sign(_),w=Math.sign(a)*Math.sqrt(e*e+_*_);let A=Math.atan2(e,Math.abs(_))*v;_*a<0&&(A-=Math.PI*Math.sign(e)*v);const C=or(en(A/a)+this.center[0],-180,180),R=or(en(2*Math.atan(Math.pow(u/w,1/a))-Sd),-bo,bo);return new _n(C,this.southernCenter?-R:R)}}class s_ extends ip{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:oc(e),y:ml(r),z:0}}unproject(e,r){const a=as(e),u=Vo(r);return new _n(a,u)}}const l_=Ki(bo);class lg extends ip{project(e,r){const a=(r=Ki(r))*r,u=a*a;return{x:.5*((e=Ki(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=25,_=0,v=a*a;do{v=a*a;const C=v*v;_=(a*(1.007226+v*(.015085+C*(.028874*v-.044475-.005916*C)))-r)/(1.007226+v*(.045255+C*(.259866*v-.311325-.005916*11*C))),a=or(a-_,-l_,l_)}while(Math.abs(_)>1e-6&&--u>0);v=a*a;const w=or(en(e/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),A=en(a);return new _n(w,A)}}const c_=Ki(bo);class cg extends ip{project(e,r){r=Ki(r),e=Ki(e);const a=Math.cos(r),u=2/Math.PI,_=Math.acos(a*Math.cos(e/2)),v=Math.sin(_)/_,w=.5*(e*u+2*a*Math.sin(e/2)/v)||0,A=.5*(r+Math.sin(r)/v)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,_=25;const v=1e-6;let w=0,A=0;do{const C=Math.cos(u),R=Math.sin(u),F=2*R*C,j=R*R,Z=C*C,$=Math.cos(a/2),J=Math.sin(a/2),se=2*$*J,ye=J*J,Pe=1-Z*$*$,ve=Pe?1/Pe:0,ze=Pe?Math.acos(C*$)*Math.sqrt(1/Pe):0,Ue=.5*(2*ze*C*J+2*a/Math.PI)-e,Oe=.5*(ze*R+u)-r,ht=.5*ve*(Z*ye+ze*C*$*j)+1/Math.PI,at=ve*(se*F/4-ze*R*J),wt=.125*ve*(F*J-ze*R*Z*se),Ot=.5*ve*(j*$+ze*ye*C)+.5,mt=at*wt-Ot*ht;w=(Oe*at-Ue*Ot)/mt,A=(Ue*wt-Oe*ht)/mt,a=or(a-w,-Math.PI,Math.PI),u=or(u-A,-c_,c_)}while((Math.abs(w)>v||Math.abs(A)>v)&&--_>0);return new _n(en(a),en(u))}}class u_ extends ip{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ki(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:u}=this;return{x:Ki(e)*u*a+.5,y:-Math.sin(Ki(r))/u*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:u}=this,_=-(r-.5)/a,v=or(en((e-.5)/a)/u,-180,180),w=Math.asin(or(_*u,-1,1)),A=or(en(w),-bo,bo);return new _n(v,A)}}class ug extends s_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){const u=nh(e,r,a);return po(u,u,Rh(Is(a))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r){const a=rh(r.lat,r.lng),u=os([],a),_=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;fp(a,a,u,Fl(1,0)*Ci*_);const v=pl(new Float64Array(16));return Oa(v,e.pixelMatrix,e.globeMatrix),po(a,a,v),new Xt(a[0],a[1])}pixelsPerMeter(e,r){return Fl(1,0)*r}pixelSpaceConversion(e,r,a){const u=Fl(1,e)*r,_=Tr(Fl(1,45)*r,u,a);return this.pixelsPerMeter(e,r)/_}createTileMatrix(e,r,a){const u=xu(Is(a.canonical));return Oa(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){const{center:a}=e,u=Rh(Is(r));return Op(u,u,Ki(a.lng)),kd(u,u,Ki(a.lat)),Qu(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,a,u){return kh(e,r,a,!0)||new Oh(0,0)}pointCoordinate3D(e,r,a){const u=this.pointCoordinate(e,r,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!kh(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(u,_){const v=u.cameraToCenterDistance,w=u._centerAltitude*_,A=u._camera,C=u._camera.forward(),R=Qc([],Es([],C,-v),[0,0,w]),F=u.worldSize/(2*Math.PI),j=[0,0,-F],Z=u.width/u.height,$=Math.tan(u.fovAboveCenter),J=Es([],A.up(),$),se=Es([],A.right(),$*Z),ye=os([],Qc([],Qc([],C,J),se)),Pe=[];let ve;if(new Od(R,ye).closestPointOnSphere(j,F,Pe)){const ze=Qc([],Pe,j),Ue=Rl([],ze,R);ve=Math.cos(u.fovAboveCenter)*Ah(Ue)}else{const ze=Rl([],R,j),Ue=Rl([],j,R);os(Ue,Ue);const Oe=Ah(ze)-F;ve=Math.sqrt(Oe*(Oe+2*F));const ht=Math.acos(ve/(F+Oe))-Math.acos(dl(C,Ue));ve*=Math.cos(ht)}return 1.01*ve}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=bu(e.zoom);if(a>0){const u=a_(e,Fl(1,e.center.lat)*e.worldSize),_=e.worldSize/(2*Math.PI),v=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Tr(r,u+_*(1-Math.cos(v)),Math.pow(a,10))}return r}upVector(e,r,a){return nh(r,a,e,1)}upVectorScale(e){return{metersToTile:vu(Lh(Is(e)))}}}function h_(i){const e=i.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new s_(i);case"equirectangular":return new ag(i);case"naturalEarth":return new lg(i);case"equalEarth":return new og(i);case"winkelTripel":return new cg(i);case"albers":return r?new u_(i):new ng(i);case"lambertConformalConic":return r?new u_(i):new sg(i);case"globe":return new ug(i)}throw new Error(`Invalid projection name: ${i.name}`)}const hg=ao.types,pg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function um(i,e,r,a,u,_,v,w,A,C,R,F,j){const Z=w?Math.min(tp,Math.round(w[0])):0,$=w?Math.min(tp,Math.round(w[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),_,v,(Z<<1)+(A?1:0),$,16*C,16*R,256*F,256*j)}function hm(i,e,r,a,u,_,v){i.emplaceBack(e,r,a,u,_,v)}function pm(i,e,r,a,u){i.emplaceBack(e,r,a,u),i.emplaceBack(e,r,a,u),i.emplaceBack(e,r,a,u),i.emplaceBack(e,r,a,u)}function dg(i){for(const e of i.sections)if(Ic(e.text))return!0;return!1}class Lm{constructor(e){this.layoutVertexArray=new Mt,this.indexArray=new wi,this.programConfigurations=e,this.segments=new vo,this.dynamicLayoutVertexArray=new kt,this.opacityVertexArray=new Si,this.placedSymbolArray=new yo,this.globeExtVertexArray=new Ut}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ch.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Gh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,pg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Mu.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ft(Lm,"SymbolBuffers");class Rm{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new vo,this.collisionVertexArray=new ur,this.collisionVertexArrayExt=new yr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,wp.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ld.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ft(Rm,"CollisionBuffers");class rp{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(v=>v.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pl([]),this.placementViewportMatrix=pl([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zh(this.zoom,r["text-size"]),this.iconSizeData=Zh(this.zoom,r["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),_=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(v=>eo[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Lm(new Yc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Lm(new Yc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ns,this.lineVertexArray=new $c,this.symbolInstances=new xn}calculateGlyphDependencies(e,r,a,u,_){for(let v=0;v<e.length;v++)if(r[e.charCodeAt(v)]=!0,u&&_){const w=Rc[e.charAt(v)];w&&(r[w.charCodeAt(0)]=!0)}}populate(e,r,a,u){const _=this.layers[0],v=_.layout,w=this.projection.name==="globe",A=v.get("text-font"),C=v.get("text-field"),R=v.get("icon-image"),F=(C.value.kind!=="constant"||C.value.value instanceof Lo&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),j=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,Z=v.get("symbol-sort-key");if(this.features=[],!F&&!j)return;const $=r.iconDependencies,J=r.glyphDependencies,se=r.availableImages,ye=new B(this.zoom);for(const{feature:Pe,id:ve,index:ze,sourceLayerIndex:Ue}of e){const Oe=_._featureFilter.needGeometry,ht=Su(Pe,Oe);if(!_._featureFilter.filter(ye,ht,a))continue;if(Oe||(ht.geometry=ss(Pe,a,u)),w&&Pe.type!==1&&a.z<=5){const mt=ht.geometry,It=.98078528056,At=(Dt,jt)=>dl(nh(Dt.x,Dt.y,a,1),nh(jt.x,jt.y,a,1))<It;for(let Dt=0;Dt<mt.length;Dt++)mt[Dt]=qd(mt[Dt],At)}let at,wt;if(F){const mt=_.getValueAndResolveTokens("text-field",ht,a,se),It=Lo.factory(mt);dg(It)&&(this.hasRTLText=!0),(!this.hasRTLText||E()==="unavailable"||this.hasRTLText&&k.isParsed())&&(at=ud(It,_,ht))}if(j){const mt=_.getValueAndResolveTokens("icon-image",ht,a,se);wt=mt instanceof aa?mt:aa.fromString(mt)}if(!at&&!wt)continue;const Ot=this.sortFeaturesByKey?Z.evaluate(ht,{},a):void 0;if(this.features.push({id:ve,text:at,icon:wt,index:ze,sourceLayerIndex:Ue,geometry:ht.geometry,properties:Pe.properties,type:hg[Pe.type],sortKey:Ot}),wt&&($[wt.name]=!0),at){const mt=A.evaluate(ht,{},a).join(","),It=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(eo.vertical)>=0;for(const At of at.sections)if(At.image)$[At.image.name]=!0;else{const Dt=qs(at.toString()),jt=At.fontStack||mt,yt=J[jt]=J[jt]||{};this.calculateGlyphDependencies(At.text,yt,It,this.allowVerticalPlacement,Dt)}}}v.get("symbol-placement")==="line"&&(this.features=function(Pe){const ve={},ze={},Ue=[];let Oe=0;function ht(mt){Ue.push(Pe[mt]),Oe++}function at(mt,It,At){const Dt=ze[mt];return delete ze[mt],ze[It]=Dt,Ue[Dt].geometry[0].pop(),Ue[Dt].geometry[0]=Ue[Dt].geometry[0].concat(At[0]),Dt}function wt(mt,It,At){const Dt=ve[It];return delete ve[It],ve[mt]=Dt,Ue[Dt].geometry[0].shift(),Ue[Dt].geometry[0]=At[0].concat(Ue[Dt].geometry[0]),Dt}function Ot(mt,It,At){const Dt=At?It[0][It[0].length-1]:It[0][0];return`${mt}:${Dt.x}:${Dt.y}`}for(let mt=0;mt<Pe.length;mt++){const It=Pe[mt],At=It.geometry,Dt=It.text?It.text.toString():null;if(!Dt){ht(mt);continue}const jt=Ot(Dt,At),yt=Ot(Dt,At,!0);if(jt in ze&&yt in ve&&ze[jt]!==ve[yt]){const ii=wt(jt,yt,At),xi=at(jt,yt,Ue[ii].geometry);delete ve[jt],delete ze[yt],ze[Ot(Dt,Ue[xi].geometry,!0)]=xi,Ue[ii].geometry=null}else jt in ze?at(jt,yt,At):yt in ve?wt(jt,yt,At):(ht(mt),ve[jt]=Oe-1,ze[yt]=Oe-1)}return Ue.filter(mt=>mt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Pe,ve)=>Pe.sortKey-ve.sortKey)}update(e,r,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a,u),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=h_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:_}of r)this.lineVertexArray.emplaceBack(u,_);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,u,_,v,w,A,C,R,F,j,Z,$){const J=e.indexArray,se=e.layoutVertexArray,ye=e.globeExtVertexArray,Pe=e.segments.prepareSegment(4*r.length,se,J,this.canOverlap?v.sortKey:void 0),ve=this.glyphOffsetArray.length,ze=Pe.vertexLength,Ue=this.allowVerticalPlacement&&w===eo.vertical?Math.PI/2:0,Oe=v.text&&v.text.sections;for(let at=0;at<r.length;at++){const{tl:wt,tr:Ot,bl:mt,br:It,tex:At,pixelOffsetTL:Dt,pixelOffsetBR:jt,minFontScaleX:yt,minFontScaleY:ii,glyphOffset:xi,isSDF:oi,sectionIndex:ar}=r[at],qt=Pe.vertexLength,ki=xi[1];if(um(se,C.x,C.y,wt.x,ki+wt.y,At.x,At.y,a,oi,Dt.x,Dt.y,yt,ii),um(se,C.x,C.y,Ot.x,ki+Ot.y,At.x+At.w,At.y,a,oi,jt.x,Dt.y,yt,ii),um(se,C.x,C.y,mt.x,ki+mt.y,At.x,At.y+At.h,a,oi,Dt.x,jt.y,yt,ii),um(se,C.x,C.y,It.x,ki+It.y,At.x+At.w,At.y+At.h,a,oi,jt.x,jt.y,yt,ii),A){const{x:sr,y:$r,z:lr}=A.anchor,[Wi,qn,hr]=A.up;hm(ye,sr,$r,lr,Wi,qn,hr),hm(ye,sr,$r,lr,Wi,qn,hr),hm(ye,sr,$r,lr,Wi,qn,hr),hm(ye,sr,$r,lr,Wi,qn,hr),pm(e.dynamicLayoutVertexArray,sr,$r,lr,Ue)}else pm(e.dynamicLayoutVertexArray,C.x,C.y,C.z,Ue);J.emplaceBack(qt,qt+1,qt+2),J.emplaceBack(qt+1,qt+2,qt+3),Pe.vertexLength+=4,Pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xi[0]),at!==r.length-1&&ar===r[at+1].sectionIndex||e.programConfigurations.populatePaintArrays(se.length,v,v.index,{},Z,$,Oe&&Oe[ar])}const ht=A?A.anchor:C;e.placedSymbolArray.emplaceBack(ht.x,ht.y,ht.z,C.x,C.y,ve,this.glyphOffsetArray.length-ve,ze,R,F,C.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],w,0,!1,0,j,0)}_commitLayoutVertex(e,r,a,u,_,v,w){e.emplaceBack(r,a,u,_,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,r,a,u,_,v,w){const A=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),C=A.vertexLength,R=w.tileAnchorX,F=w.tileAnchorY;for(let Z=0;Z<4;Z++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,u,_,v,R,F,new Xt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,_,v,R,F,new Xt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,_,v,R,F,new Xt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,_,v,R,F,new Xt(e.x1,e.y2)),A.vertexLength+=4;const j=a.indexArray;j.emplaceBack(C,C+1),j.emplaceBack(C+1,C+2),j.emplaceBack(C+2,C+3),j.emplaceBack(C+3,C),A.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,u,_,v){for(let w=u;w<_;w++){const A=a.get(w),C=this.getSymbolInstanceTextSize(e,v,r,w);this._addCollisionDebugVertices(A,C,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(e,r,a,u,_,v){for(let w=u;w<_;w++){const A=a.get(w),C=this.getSymbolInstanceIconSize(e,r,v.placedIconSymbolIndex);this._addCollisionDebugVertices(A,C,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,v)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rm(ui,cd.members,Hn),this.iconCollisionBox=new Rm(ui,cd.members,Hn);const a=au(this.iconSizeData,e),u=au(this.textSizeData,e);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(u,e,r,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(u,e,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(a,e,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(a,e,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,r,a,u){const _=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),v=ou(this.textSizeData,e,_)/So;return this.tilePixelRatio*v}getSymbolInstanceIconSize(e,r,a){const u=this.icon.placedSymbolArray.get(a),_=ou(this.iconSizeData,e,u);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(e,r,a){e.emplaceBack(r,-a,-a),e.emplaceBack(r,a,-a),e.emplaceBack(r,a,a),e.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(e,r,a,u,_,v){for(let w=u;w<_;w++){const A=a.get(w),C=this.getSymbolInstanceTextSize(e,v,r,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,A.padding)}}_updateIconDebugCollisionBoxes(e,r,a,u,_,v){for(let w=u;w<_;w++){const A=a.get(w),C=this.getSymbolInstanceIconSize(e,r,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,A.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=au(this.iconSizeData,e),u=au(this.textSizeData,e);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(u,e,r,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(u,e,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(a,e,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,u,_,v,w,A,C){const R={};if(r<a){const{x1:F,y1:j,x2:Z,y2:$,padding:J,projectedAnchorX:se,projectedAnchorY:ye,projectedAnchorZ:Pe,tileAnchorX:ve,tileAnchorY:ze,featureIndex:Ue}=e.get(r);R.textBox={x1:F,y1:j,x2:Z,y2:$,padding:J,projectedAnchorX:se,projectedAnchorY:ye,projectedAnchorZ:Pe,tileAnchorX:ve,tileAnchorY:ze},R.textFeatureIndex=Ue}if(u<_){const{x1:F,y1:j,x2:Z,y2:$,padding:J,projectedAnchorX:se,projectedAnchorY:ye,projectedAnchorZ:Pe,tileAnchorX:ve,tileAnchorY:ze,featureIndex:Ue}=e.get(u);R.verticalTextBox={x1:F,y1:j,x2:Z,y2:$,padding:J,projectedAnchorX:se,projectedAnchorY:ye,projectedAnchorZ:Pe,tileAnchorX:ve,tileAnchorY:ze},R.verticalTextFeatureIndex=Ue}if(v<w){const{x1:F,y1:j,x2:Z,y2:$,padding:J,projectedAnchorX:se,projectedAnchorY:ye,projectedAnchorZ:Pe,tileAnchorX:ve,tileAnchorY:ze,featureIndex:Ue}=e.get(v);R.iconBox={x1:F,y1:j,x2:Z,y2:$,padding:J,projectedAnchorX:se,projectedAnchorY:ye,projectedAnchorZ:Pe,tileAnchorX:ve,tileAnchorY:ze},R.iconFeatureIndex=Ue}if(A<C){const{x1:F,y1:j,x2:Z,y2:$,padding:J,projectedAnchorX:se,projectedAnchorY:ye,projectedAnchorZ:Pe,tileAnchorX:ve,tileAnchorY:ze,featureIndex:Ue}=e.get(A);R.verticalIconBox={x1:F,y1:j,x2:Z,y2:$,padding:J,projectedAnchorX:se,projectedAnchorY:ye,projectedAnchorZ:Pe,tileAnchorX:ve,tileAnchorY:ze},R.verticalIconFeatureIndex=Ue}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),u=a.vertexStartIndex+4*a.numGlyphs;for(let _=a.vertexStartIndex;_<u;_+=4)e.indexArray.emplaceBack(_,_+1,_+2),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),u=[],_=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const A=this.symbolInstances.get(w);u.push(0|Math.round(r*A.tileAnchorX+a*A.tileAnchorY)),_.push(A.featureIndex)}return v.sort((w,A)=>u[w]-u[A]||_[A]-_[w]),v}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:C}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),_>=0&&_!==u&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&v!==_&&v!==u&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ft(rp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),rp.MAX_GLYPHS=65535,rp.addDynamicAttributes=pm;const fg=new Ee({"symbol-placement":new Y(lt.layout_symbol["symbol-placement"]),"symbol-spacing":new Y(lt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Y(lt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ue(lt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Y(lt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Y(lt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Y(lt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Y(lt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Y(lt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ue(lt.layout_symbol["icon-size"]),"icon-text-fit":new Y(lt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Y(lt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ue(lt.layout_symbol["icon-image"]),"icon-rotate":new ue(lt.layout_symbol["icon-rotate"]),"icon-padding":new Y(lt.layout_symbol["icon-padding"]),"icon-keep-upright":new Y(lt.layout_symbol["icon-keep-upright"]),"icon-offset":new ue(lt.layout_symbol["icon-offset"]),"icon-anchor":new ue(lt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Y(lt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Y(lt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Y(lt.layout_symbol["text-rotation-alignment"]),"text-field":new ue(lt.layout_symbol["text-field"]),"text-font":new ue(lt.layout_symbol["text-font"]),"text-size":new ue(lt.layout_symbol["text-size"]),"text-max-width":new ue(lt.layout_symbol["text-max-width"]),"text-line-height":new ue(lt.layout_symbol["text-line-height"]),"text-letter-spacing":new ue(lt.layout_symbol["text-letter-spacing"]),"text-justify":new ue(lt.layout_symbol["text-justify"]),"text-radial-offset":new ue(lt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Y(lt.layout_symbol["text-variable-anchor"]),"text-anchor":new ue(lt.layout_symbol["text-anchor"]),"text-max-angle":new Y(lt.layout_symbol["text-max-angle"]),"text-writing-mode":new Y(lt.layout_symbol["text-writing-mode"]),"text-rotate":new ue(lt.layout_symbol["text-rotate"]),"text-padding":new Y(lt.layout_symbol["text-padding"]),"text-keep-upright":new Y(lt.layout_symbol["text-keep-upright"]),"text-transform":new ue(lt.layout_symbol["text-transform"]),"text-offset":new ue(lt.layout_symbol["text-offset"]),"text-allow-overlap":new Y(lt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Y(lt.layout_symbol["text-ignore-placement"]),"text-optional":new Y(lt.layout_symbol["text-optional"])});var Bm={paint:new Ee({"icon-opacity":new ue(lt.paint_symbol["icon-opacity"]),"icon-color":new ue(lt.paint_symbol["icon-color"]),"icon-halo-color":new ue(lt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ue(lt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ue(lt.paint_symbol["icon-halo-blur"]),"icon-translate":new Y(lt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Y(lt.paint_symbol["icon-translate-anchor"]),"text-opacity":new ue(lt.paint_symbol["text-opacity"]),"text-color":new ue(lt.paint_symbol["text-color"],{runtimeType:io,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ue(lt.paint_symbol["text-halo-color"]),"text-halo-width":new ue(lt.paint_symbol["text-halo-width"]),"text-halo-blur":new ue(lt.paint_symbol["text-halo-blur"]),"text-translate":new Y(lt.paint_symbol["text-translate"]),"text-translate-anchor":new Y(lt.paint_symbol["text-translate-anchor"])}),layout:fg};class p_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Un,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft(p_,"FormatSectionOverride",{omit:["defaultValue"]});class dm extends Ll{constructor(e){super(e,Bm)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const _ of a)u.indexOf(_)<0&&u.push(_);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,u){const _=this.layout.get(e).evaluate(r,{},a,u),v=this._unevaluatedLayout._values[e];return v.isDataDriven()||cl(v.value)||!_?_:function(w,A){return A.replace(/{([^{}]+)}/g,(C,R)=>R in w?String(w[R]):"")}(r.properties,_)}createBucket(e){return new rp(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Bm.paint.overridableProperties){if(!dm.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new p_(r),u=new Pl(a,r.property.specification);let _=null;_=r.value.kind==="constant"||r.value.kind==="source"?new Bo("source",u):new qr("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new me(r.property,_,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&dm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),u=Bm.paint.properties[r];let _=!1;const v=w=>{for(const A of w)if(u.overrides&&u.overrides.hasOverride(A))return void(_=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Lo)v(a.value.value.sections);else if(a.value.kind==="source"){const w=C=>{_||(C instanceof Fs&&An(C.value)===Ga?v(C.value.sections):C instanceof il?v(C.sections):C.eachChild(w))},A=a.value;A._styleExpression&&w(A._styleExpression.expression)}return _}getProgramConfiguration(e){return new yu(this,e)}}var mg={paint:new Ee({"background-color":new Y(lt.paint_background["background-color"]),"background-pattern":new Y(lt.paint_background["background-pattern"]),"background-opacity":new Y(lt.paint_background["background-opacity"])})},_g={paint:new Ee({"raster-opacity":new Y(lt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Y(lt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Y(lt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Y(lt.paint_raster["raster-brightness-max"]),"raster-saturation":new Y(lt.paint_raster["raster-saturation"]),"raster-contrast":new Y(lt.paint_raster["raster-contrast"]),"raster-resampling":new Y(lt.paint_raster["raster-resampling"]),"raster-fade-duration":new Y(lt.paint_raster["raster-fade-duration"])})};class gg extends Ll{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var yg={paint:new Ee({"sky-type":new Y(lt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Y(lt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Y(lt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Y(lt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Y(lt.paint_sky["sky-gradient-radius"]),"sky-gradient":new we(lt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Y(lt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Y(lt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Y(lt.paint_sky["sky-opacity"])})};function Fm(i,e,r){const a=[0,0,1],u=Fd([]);return Lf(u,u,r?-Ki(i)+Math.PI:Ki(i)),Df(u,u,-Ki(e)),Ch(a,a,u),os(a,a)}const vg={circle:class extends Ll{constructor(i){super(i,Wf)}createBucket(i){return new Gd(i)}queryRadius(i){const e=i;return Uh("circle-radius",this,e)+Uh("circle-stroke-width",this,e)+Qp(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,a,u,_,v,w){const A=Xf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,i.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Zd(i,a,_,v,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,C)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new yu(this,i)}},heatmap:class extends Ll{createBucket(i){return new td(i)}constructor(i){super(i,Hf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=id({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Uh("heatmap-radius",this,i)}queryIntersectsFeature(i,e,r,a,u,_,v,w){const A=this.paint.get("heatmap-radius").evaluate(e,r);return Zd(i,a,_,v,w,!0,!0,new Xt(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new yu(this,i)}},hillshade:class extends Ll{constructor(i){super(i,Kf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ll{constructor(i){super(i,zt)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(i){return new yu(this,i)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new it(i)}queryRadius(){return Qp(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,a,u,_){return!i.queryGeometry.isAboveHorizon&&Yp(Zf(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,i.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Ll{constructor(i){super(i,Qo)}createBucket(i){return new wo(i)}queryRadius(){return Qp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new yu(this,i)}queryIntersectsFeature(i,e,r,a,u,_,v,w,A){const C=Xf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,i.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(e,r),F=this.paint.get("fill-extrusion-base").evaluate(e,r),j=[0,0],Z=w&&_.elevation,$=_.elevation?_.elevation.exaggeration():1,J=i.tile.getBucket(this);if(Z&&J instanceof wo){const ze=J.centroidVertexArray,Ue=A+1;Ue<ze.length&&(j[0]=ze.geta_centroid_pos0(Ue),j[1]=ze.geta_centroid_pos1(Ue))}if(j[0]===0&&j[1]===1)return!1;_.projection.name==="globe"&&(a=Eo([a],[new Xt(0,0),new Xt(Ci,Ci)],i.tileID.canonical).map(ze=>ze.polygon).flat());const se=Z?w:null,[ye,Pe]=function(ze,Ue,Oe,ht,at,wt,Ot,mt,It,At,Dt){return ze.projection.name==="globe"?function(jt,yt,ii,xi,oi,ar,qt,ki,sr,$r,lr){const Wi=[],qn=[],hr=jt.projection.upVectorScale(lr,jt.center.lat,jt.worldSize).metersToTile,pr=[0,0,0,1],bn=[0,0,0,1],Ln=(wn,lo,Io,qo)=>{wn[0]=lo,wn[1]=Io,wn[2]=qo,wn[3]=1},Rn=yn();ii>0&&(ii+=Rn),xi+=Rn;for(const wn of yt){const lo=[],Io=[];for(const qo of wn){const Tn=qo.x+oi.x,ia=qo.y+oi.y,Go=jt.projection.projectTilePoint(Tn,ia,lr),mo=jt.projection.upVector(lr,qo.x,qo.y);let Qr=ii,Zo=xi;if(qt){const Bn=Ul(Tn,ia,ii,xi,qt,ki,sr,$r);Qr+=Bn.base,Zo+=Bn.top}ii!==0?Ln(pr,Go.x+mo[0]*hr*Qr,Go.y+mo[1]*hr*Qr,Go.z+mo[2]*hr*Qr):Ln(pr,Go.x,Go.y,Go.z),Ln(bn,Go.x+mo[0]*hr*Zo,Go.y+mo[1]*hr*Zo,Go.z+mo[2]*hr*Zo),po(pr,pr,ar),po(bn,bn,ar),lo.push(new Qn(pr[0],pr[1],pr[2])),Io.push(new Qn(bn[0],bn[1],bn[2]))}Wi.push(lo),qn.push(Io)}return[Wi,qn]}(ze,Ue,Oe,ht,at,wt,Ot,mt,It,At,Dt):Ot?function(jt,yt,ii,xi,oi,ar,qt,ki,sr){const $r=[],lr=[],Wi=[0,0,0,1];for(const qn of jt){const hr=[],pr=[];for(const bn of qn){const Ln=bn.x+xi.x,Rn=bn.y+xi.y,wn=Ul(Ln,Rn,yt,ii,ar,qt,ki,sr);Wi[0]=Ln,Wi[1]=Rn,Wi[2]=wn.base,Wi[3]=1,Ss(Wi,Wi,oi),Wi[3]=Math.max(Wi[3],1e-5);const lo=new Qn(Wi[0]/Wi[3],Wi[1]/Wi[3],Wi[2]/Wi[3]);Wi[0]=Ln,Wi[1]=Rn,Wi[2]=wn.top,Wi[3]=1,Ss(Wi,Wi,oi),Wi[3]=Math.max(Wi[3],1e-5);const Io=new Qn(Wi[0]/Wi[3],Wi[1]/Wi[3],Wi[2]/Wi[3]);hr.push(lo),pr.push(Io)}$r.push(hr),lr.push(pr)}return[$r,lr]}(Ue,Oe,ht,at,wt,Ot,mt,It,At):function(jt,yt,ii,xi,oi){const ar=[],qt=[],ki=oi[8]*yt,sr=oi[9]*yt,$r=oi[10]*yt,lr=oi[11]*yt,Wi=oi[8]*ii,qn=oi[9]*ii,hr=oi[10]*ii,pr=oi[11]*ii;for(const bn of jt){const Ln=[],Rn=[];for(const wn of bn){const lo=wn.x+xi.x,Io=wn.y+xi.y,qo=oi[0]*lo+oi[4]*Io+oi[12],Tn=oi[1]*lo+oi[5]*Io+oi[13],ia=oi[2]*lo+oi[6]*Io+oi[14],Go=oi[3]*lo+oi[7]*Io+oi[15],mo=qo+ki,Qr=Tn+sr,Zo=ia+$r,Bn=Math.max(Go+lr,1e-5),Js=qo+Wi,Xo=Tn+qn,Va=ia+hr,Ia=Math.max(Go+pr,1e-5);Ln.push(new Qn(mo/Bn,Qr/Bn,Zo/Bn)),Rn.push(new Qn(Js/Ia,Xo/Ia,Va/Ia))}ar.push(Ln),qt.push(Rn)}return[ar,qt]}(Ue,Oe,ht,at,wt)}(_,a,F,R,C,v,se,j,$,_.center.lat,i.tileID.canonical),ve=i.queryGeometry;return function(ze,Ue,Oe){let ht=1/0;Yp(Oe,Ue)&&(ht=ac(Oe,Ue[0]));for(let at=0;at<Ue.length;at++){const wt=Ue[at],Ot=ze[at];for(let mt=0;mt<wt.length-1;mt++){const It=wt[mt],At=[It,wt[mt+1],Ot[mt+1],Ot[mt],It];jf(Oe,At)&&(ht=Math.min(ht,ac(Oe,At)))}}return ht!==1/0&&ht}(ye,Pe,ve.isPointQuery()?ve.screenBounds:ve.screenGeometry)}},line:class extends Ll{constructor(i){super(i,sd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof $l,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=qh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Au(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new yu(this,i)}queryRadius(i){const e=i,r=nu(Uh("line-width",this,e),Uh("line-gap-width",this,e)),a=Uh("line-offset",this,e);return r/2+Math.abs(a)+Qp(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,a,u,_){if(i.queryGeometry.isAboveHorizon)return!1;const v=Zf(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,i.pixelToTileUnitsFactor),w=i.pixelToTileUnitsFactor/2*nu(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),A=this.paint.get("line-offset").evaluate(e,r);return A&&(a=function(C,R){const F=[],j=new Xt(0,0);for(let Z=0;Z<C.length;Z++){const $=C[Z],J=[];for(let se=0;se<$.length;se++){const ye=$[se],Pe=$[se+1],ve=se===0?j:ye.sub($[se-1])._unit()._perp(),ze=se===$.length-1?j:Pe.sub(ye)._unit()._perp(),Ue=ve._add(ze)._unit();Ue._mult(1/(Ue.x*ze.x+Ue.y*ze.y)),J.push(Ue._mult(R)._add(ye))}F.push(J)}return F}(a,A*i.pixelToTileUnitsFactor)),function(C,R,F){for(let j=0;j<R.length;j++){const Z=R[j];if(C.length>=3){for(let $=0;$<Z.length;$++)if(Ol(C,Z[$]))return!0}if(Sm(C,Z,F))return!0}return!1}(v,a,w)}isTileClipped(){return!0}},symbol:dm,background:class extends Ll{constructor(i){super(i,mg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ll{constructor(i){super(i,_g)}getProgramIds(){return["raster"]}},sky:class extends Ll{constructor(i){super(i,yg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=id({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,_=i.style.light,v=_.properties.get("position");return u&&_.properties.get("anchor")==="viewport"&&Hr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Fm(v.azimuthal,90-v.polar,e):Fm(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return Fm(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class gf{constructor(e,r,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,a){const{width:u,height:_}=e,{context:v}=this,{gl:w}=v,{HTMLImageElement:A,HTMLCanvasElement:C,HTMLVideoElement:R,ImageData:F,ImageBitmap:j}=st;if(w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===_){const{x:Z,y:$}=a||{x:0,y:0};e instanceof A||e instanceof C||e instanceof R||e instanceof F||j&&e instanceof j?w.texSubImage2D(w.TEXTURE_2D,0,Z,$,w.RGBA,w.UNSIGNED_BYTE,e):w.texSubImage2D(w.TEXTURE_2D,0,Z,$,u,_,w.RGBA,w.UNSIGNED_BYTE,e.data)}else this.size=[u,_],e instanceof A||e instanceof C||e instanceof R||e instanceof F||j&&e instanceof j?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,e):w.texImage2D(w.TEXTURE_2D,0,this.format,u,_,0,this.format,w.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(e,r){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class xg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class bg{constructor(){this.tasks={},this.taskQueue=[],Fn(["process"],this),this.invoker=new xg(this.process),this.nextId=0}add(e,r){const a=this.nextId++,u=function({type:_,isSymbolTile:v,zoom:w}){return w=w||0,_==="message"?0:_!=="maybePrepare"||v?_!=="parseTile"||v?_==="parseTile"&&v?300-w:_==="maybePrepare"&&v?400-w:500:200-w:100-w}(r);if(u===0){va();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:r,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){va();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const _=this.tasks[this.taskQueue[u]];_.priority<r&&(r=_.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class d_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const wg=["tile","layer","source","sourceLayer","state"];class f_{constructor(e,r,a,u,_){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=u,this.properties=e.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of wg)this[r]!==void 0&&(e[r]=this[r]);return e}}const Oc=32,Du=33,np=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,r=0,a=0,u=0,_=0,v=0,w=0;for(1&e?u=_=v=Oc:r=a=w=Oc;(e>>=1)>1;){const C=r+u>>1,R=a+_>>1;1&e?(u=r,_=a,r=v,a=w):(r=u,a=_,u=v,_=w),v=C,w=R}const A=4*i;np[A+0]=r,np[A+1]=a,np[A+2]=u,np[A+3]=_}const Lu=new Uint16Array(2178),op=new Uint8Array(1089),fm=new Uint16Array(1089);function m_(i){return i===0?-.03125:i===32?.03125:0}var __=$e([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const g_={type:2,extent:Ci,loadGeometry:()=>[[new Xt(0,0),new Xt(Ci+1,0),new Xt(Ci+1,Ci+1),new Xt(0,Ci+1),new Xt(0,0)]]};class Om{constructor(e,r,a,u,_){this.tileID=e,this.uid=_a(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<Ti.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Pp(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,_){const v={};if(!_)return v;for(const w of u){const A=w.layerIds.map(C=>_.getLayer(C)).filter(Boolean);if(A.length!==0){w.layers=A,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(C=>A.filter(R=>R.id===C)[0]));for(const C of A)v[C.id]=w}}return v}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const _=this.buckets[u];if(_ instanceof rp){if(this.hasSymbolBuckets=!0,!a)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const _=this.buckets[u];if(_ instanceof rp&&_.hasRTLText){this.hasRTLText=!0,k.isLoading()||k.isLoaded()||E()!=="deferred"||z();break}}this.queryPadding=0;for(const u in this.buckets){const _=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(u).queryRadius(_))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new fn}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gf(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gf(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new gf(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,u,_,v,w,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:w,transform:v,params:_,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),_=r?r.sourceLayer:"",v=u._geojsonTileLayer||u[_];if(!v)return;const w=d(r&&r.filter),{z:A,x:C,y:R}=this.tileID.canonical,F={z:A,x:C,y:R};for(let j=0;j<v.length;j++){const Z=v.feature(j);if(w.needGeometry){const se=Su(Z,!0);if(!w.filter(new B(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!w.filter(new B(this.tileID.overscaledZ),Z))continue;const $=a.getId(Z,_),J=new f_(Z,A,C,R,$);J.tile=F,e.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=ko(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const _=this.expirationTime-r;_?this.expirationTime=a+Math.max(_,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const a=this.latestFeatureIndex.loadVTLayers(),u=r.style.listImages();for(const _ in this.buckets){if(!r.style.hasLayer(_))continue;const v=this.buckets[_],w=v.layers[0].sourceLayer||"_geojsonTileLayer",A=a[w],C=e[w];if(!A||!C||Object.keys(C).length===0)continue;if(v.update(C,A,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof Au||v instanceof it){const F=r.style._getSourceCache(v.layers[0].source);r._terrain&&r._terrain.enabled&&F&&v.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(F.id,this.tileID)}const R=r&&r.style&&r.style.getLayer(_);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ti.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ti.now()+e}setTexture(e,r){const a=r.context,u=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new gf(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,r){const a={};for(const u of r)a[u]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const u=this.dependencies[a];if(u){for(const _ of r)if(u[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const a=ss(g_,this.tileID.canonical,this.tileTransform)[0],u=new Bt,_=new zn;for(let v=0;v<a.length;v++){const{x:w,y:A}=a[v];u.emplaceBack(w,A),_.emplaceBack(v)}_.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(_),this._tileDebugBuffer=e.createVertexBuffer(u,mp.members),this._tileDebugSegments=vo.simpleSegment(0,0,u.length,_.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const a=ss(g_,this.tileID.canonical,this.tileTransform)[0];let u,_;if(this.isRaster){const v=function(w,A){const C=Pp(w,A),R=Math.pow(2,w.z);for(let se=0;se<Du;se++)for(let ye=0;ye<Du;ye++){const Pe=as((w.x+(ye+m_(ye))/Oc)/R),ve=Vo((w.y+(se+m_(se))/Oc)/R),ze=A.project(Pe,ve),Ue=se*Du+ye;Lu[2*Ue+0]=Math.round((ze.x*C.scale-C.x)*Ci),Lu[2*Ue+1]=Math.round((ze.y*C.scale-C.y)*Ci)}op.fill(0),fm.fill(0);for(let se=2045;se>=0;se--){const ye=4*se,Pe=np[ye+0],ve=np[ye+1],ze=np[ye+2],Ue=np[ye+3],Oe=Pe+ze>>1,ht=ve+Ue>>1,at=Oe+ht-ve,wt=ht+Pe-Oe,Ot=ve*Du+Pe,mt=Ue*Du+ze,It=ht*Du+Oe,At=Math.hypot((Lu[2*Ot+0]+Lu[2*mt+0])/2-Lu[2*It+0],(Lu[2*Ot+1]+Lu[2*mt+1])/2-Lu[2*It+1])>=16;op[It]=op[It]||(At?1:0),se<1022&&(op[It]=op[It]||op[(ve+wt>>1)*Du+(Pe+at>>1)]||op[(Ue+wt>>1)*Du+(ze+at>>1)])}const F=new Tt,j=new wi;let Z=0;function $(se,ye){const Pe=ye*Du+se;return fm[Pe]===0&&(F.emplaceBack(Lu[2*Pe+0],Lu[2*Pe+1],se*Ci/Oc,ye*Ci/Oc),fm[Pe]=++Z),fm[Pe]-1}function J(se,ye,Pe,ve,ze,Ue){const Oe=se+Pe>>1,ht=ye+ve>>1;if(Math.abs(se-ze)+Math.abs(ye-Ue)>1&&op[ht*Du+Oe])J(ze,Ue,se,ye,Oe,ht),J(Pe,ve,ze,Ue,Oe,ht);else{const at=$(se,ye),wt=$(Pe,ve),Ot=$(ze,Ue);j.emplaceBack(at,wt,Ot)}}return J(0,0,Oc,Oc,Oc,0),J(Oc,Oc,0,0,0,Oc),{vertices:F,indices:j}}(this.tileID.canonical,r);u=v.vertices,_=v.indices}else{u=new Tt,_=new wi;for(const{x:w,y:A}of a)u.emplaceBack(w,A,0,0);const v=ie(u.int16,void 0,4);for(let w=0;w<v.length;w+=3)_.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,__.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(_),this._tileBoundsSegments=vo.simpleSegment(0,0,u.length,_.length)}_makeGlobeTileDebugBuffers(e,r){const a=r.projection;if(!a||a.name!=="globe"||r.freezeTileCoverage)return;const u=this.tileID.canonical,_=Rh(_p(u,r)),v=bu(r.zoom);let w;v>0&&(w=Ju(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,r,_,w,v),this._makeGlobeTileDebugTextBuffer(e,u,r,_,w,v)}_globePoint(e,r,a,u,_,v,w){let A=nh(e,r,a);if(v){const C=1<<a.z,R=oc(u.center.lng),F=ml(u.center.lat),j=(a.x+.5)/C-R;let Z=0;j>.5?Z=-1:j<-.5&&(Z=1);let $=(e/Ci+a.x)/C+Z,J=(r/Ci+a.y)/C;$=($-R)*u._pixelsPerMercatorPixel+R,J=(J-F)*u._pixelsPerMercatorPixel+F;const se=[$*u.worldSize,J*u.worldSize,0];po(se,se,v),A=fo(A,se,w)}return po(A,A,_)}_makeGlobeTileDebugBorderBuffer(e,r,a,u,_,v){const w=new Bt,A=new zn,C=new nt,R=(j,Z,$,J,se)=>{const ye=($-j)/(se-1),Pe=(J-Z)/(se-1),ve=w.length;for(let ze=0;ze<se;ze++){const Ue=j+ze*ye,Oe=Z+ze*Pe;w.emplaceBack(Ue,Oe);const ht=this._globePoint(Ue,Oe,r,a,u,_,v);C.emplaceBack(ht[0],ht[1],ht[2]),A.emplaceBack(ve+ze)}},F=Ci;R(0,0,F,0,16),R(F,0,F,F,16),R(F,F,0,F,16),R(0,F,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(A),this._tileDebugBuffer=e.createVertexBuffer(w,mp.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(C,Bf.members),this._tileDebugSegments=vo.simpleSegment(0,0,w.length,A.length)}_makeGlobeTileDebugTextBuffer(e,r,a,u,_,v){const w=Ci/4,A=new Bt,C=new wi,R=new nt,F=25;C.reserve(32),A.reserve(F),R.reserve(F);const j=(Z,$)=>F*Z+$;for(let Z=0;Z<F;Z++){const $=Z*w;for(let J=0;J<F;J++){const se=J*w;A.emplaceBack(se,$);const ye=this._globePoint(se,$,r,a,u,_,v);R.emplaceBack(ye[0],ye[1],ye[2])}}for(let Z=0;Z<4;Z++)for(let $=0;$<4;$++){const J=j(Z,$),se=j(Z,$+1),ye=j(Z+1,$),Pe=j(Z+1,$+1);C.emplaceBack(J,se,ye),C.emplaceBack(ye,se,Pe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(C),this._tileDebugTextBuffer=e.createVertexBuffer(A,mp.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(R,Bf.members),this._tileDebugTextSegments=vo.simpleSegment(0,0,F,32)}}class Tg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const u=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Gn(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const _ in this.state[e])_!==u&&(this.deletedStates[e][_]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const _ in this.state[e][u])a[_]||(this.deletedStates[e][u][_]=null)}else for(const _ in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][_]===null&&delete this.deletedStates[e][u][_]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const u=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),u=Gn({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const _=this.deletedStates[e][r];if(_===null)return{};for(const v in _)delete u[v]}return u}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const _={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),Gn(this.state[u][v],this.stateChanges[u][v]),_[v]=this.state[u][v];a[u]=_}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const _={};if(this.deletedStates[u]===null)for(const v in this.state[u])_[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else if(this.state[u][v])for(const w of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][w];_[v]=this.state[u][v]}a[u]=a[u]||{},Gn(a[u],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in e)e[u].setFeatureState(a,r)}}class y_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function v_(i,e,r,a){let u=0,_=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(a[v])<1e-15){if(r[v]<i[v]||r[v]>e[v])return null}else{const w=1/a[v];let A=(i[v]-r[v])*w,C=(e[v]-r[v])*w;if(A>C){const R=A;A=C,C=R}if(A>u&&(u=A),C<_&&(_=C),u>_)return null}return u}function x_(i,e,r,a,u,_,v,w,A,C,R){const F=a-i,j=u-e,Z=_-r,$=v-i,J=w-e,se=A-r,ye=R[1]*se-R[2]*J,Pe=R[2]*$-R[0]*se,ve=R[0]*J-R[1]*$,ze=F*ye+j*Pe+Z*ve;if(Math.abs(ze)<1e-15)return null;const Ue=1/ze,Oe=C[0]-i,ht=C[1]-e,at=C[2]-r,wt=(Oe*ye+ht*Pe+at*ve)*Ue;if(wt<0||wt>1)return null;const Ot=ht*Z-at*j,mt=at*F-Oe*Z,It=Oe*j-ht*F,At=(R[0]*Ot+R[1]*mt+R[2]*It)*Ue;return At<0||wt+At>1?null:($*Ot+J*mt+se*It)*Ue}function b_(i,e,r){return(i-e)/(r-e)}function w_(i,e,r,a,u,_,v,w,A){const C=1<<r,R=_-a,F=v-u,j=(i+1)/C*R+a,Z=(e+0)/C*F+u,$=(e+1)/C*F+u;w[0]=(i+0)/C*R+a,w[1]=Z,A[0]=j,A[1]=$}class T_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(_){const v=Math.ceil(Math.log2(_.dim/8)),w=[];let A=Math.ceil(Math.pow(2,v));const C=1/A,R=(Z,$,J,se,ye)=>{const Pe=se?1:0,ve=(Z+1)*J-Pe,ze=$*J,Ue=($+1)*J-Pe;ye[0]=Z*J,ye[1]=ze,ye[2]=ve,ye[3]=Ue};let F=new y_(A);const j=[];for(let Z=0;Z<A*A;Z++){R(Z%A,Math.floor(Z/A),C,!1,j);const $=ap(j[0],j[1],_),J=ap(j[2],j[1],_),se=ap(j[2],j[3],_),ye=ap(j[0],j[3],_);F.minimums.push(Math.min($,J,se,ye)),F.maximums.push(Math.max($,J,se,ye)),F.leaves.push(1)}for(w.push(F),A/=2;A>=1;A/=2){const Z=w[w.length-1];F=new y_(A);for(let $=0;$<A*A;$++){R($%A,Math.floor($/A),2,!0,j);const J=Z.getElevation(j[0],j[1]),se=Z.getElevation(j[2],j[1]),ye=Z.getElevation(j[2],j[3]),Pe=Z.getElevation(j[0],j[3]),ve=Z.isLeaf(j[0],j[1]),ze=Z.isLeaf(j[2],j[1]),Ue=Z.isLeaf(j[2],j[3]),Oe=Z.isLeaf(j[0],j[3]),ht=Math.min(J.min,se.min,ye.min,Pe.min),at=Math.max(J.max,se.max,ye.max,Pe.max),wt=ve&&ze&&Ue&&Oe;F.maximums.push(at),F.minimums.push(ht),F.leaves.push(at-ht<=5&&wt?1:0)}w.push(F)}return w}(this.dem),a=r.length-1,u=r[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,u,_,v,w=1){return v_([e,r,-100],[a,u,this.maximums[0]*w],_,v)}raycast(e,r,a,u,_,v,w=1){if(!this.nodeCount)return null;const A=this.raycastRoot(e,r,a,u,_,v,w);if(A==null)return null;const C=[],R=[],F=[],j=[],Z=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;Z.length>0;){const{idx:$,t:J,nodex:se,nodey:ye,depth:Pe}=Z.pop();if(this.leaves[$]){w_(se,ye,Pe,e,r,a,u,F,j);const ze=1<<Pe,Ue=(se+0)/ze,Oe=(se+1)/ze,ht=(ye+0)/ze,at=(ye+1)/ze,wt=ap(Ue,ht,this.dem)*w,Ot=ap(Oe,ht,this.dem)*w,mt=ap(Oe,at,this.dem)*w,It=ap(Ue,at,this.dem)*w,At=x_(F[0],F[1],wt,j[0],F[1],Ot,j[0],j[1],mt,_,v),Dt=x_(j[0],j[1],mt,F[0],j[1],It,F[0],F[1],wt,_,v),jt=Math.min(At!==null?At:Number.MAX_VALUE,Dt!==null?Dt:Number.MAX_VALUE);if(jt!==Number.MAX_VALUE)return jt;{const yt=fp([],_,v,J);if(E_(wt,Ot,It,mt,b_(yt[0],F[0],j[0]),b_(yt[1],F[1],j[1]))>=yt[2])return J}continue}let ve=0;for(let ze=0;ze<this._siblingOffset.length;ze++){w_((se<<1)+this._siblingOffset[ze][0],(ye<<1)+this._siblingOffset[ze][1],Pe+1,e,r,a,u,F,j),F[2]=-100,j[2]=this.maximums[this.childOffsets[$]+ze]*w;const Ue=v_(F,j,_,v);if(Ue!=null){const Oe=Ue;C[ze]=Oe;let ht=!1;for(let at=0;at<ve&&!ht;at++)Oe>=C[R[at]]&&(R.splice(at,0,ze),ht=!0);ht||(R[ve]=ze),ve++}}for(let ze=0;ze<ve;ze++){const Ue=R[ze];Z.push({idx:this.childOffsets[$]+Ue,t:C[Ue],nodex:(se<<1)+this._siblingOffset[Ue][0],nodey:(ye<<1)+this._siblingOffset[Ue][1],depth:Pe+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,u,_){if(e[u].isLeaf(r,a)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const v=u-1,w=e[v];let A=0,C=0;for(let R=0;R<this._siblingOffset.length;R++){const F=2*r+this._siblingOffset[R][0],j=2*a+this._siblingOffset[R][1],Z=w.getElevation(F,j),$=w.isLeaf(F,j),J=this._addNode(Z.min,Z.max,$);$&&(A|=1<<R),C||(C=J)}for(let R=0;R<this._siblingOffset.length;R++)A&1<<R||this._construct(e,2*r+this._siblingOffset[R][0],2*a+this._siblingOffset[R][1],v,C+R)}}function E_(i,e,r,a,u,_){return Tr(Tr(i,r,_),Tr(e,a,_),u)}function ap(i,e,r){const a=r.dim,u=or(i*a-.5,0,a-1),_=or(e*a-.5,0,a-1),v=Math.floor(u),w=Math.floor(_),A=Math.min(v+1,a-1),C=Math.min(w+1,a-1);return E_(r.get(v,w),r.get(A,w),r.get(v,C),r.get(A,C),u-v,_-w)}const S_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Eg(i,e,r){return(256*i*256+256*e+r)/10-1e4}function Sg(i,e,r){return 256*i+e+r/256-32768}class mm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,u=!1,_=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Hr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const v=this.dim=r.height-2,w=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,!u){for(let A=0;A<v;A++)w[this._idx(-1,A)]=w[this._idx(0,A)],w[this._idx(v,A)]=w[this._idx(v-1,A)],w[this._idx(A,-1)]=w[this._idx(A,0)],w[this._idx(A,v)]=w[this._idx(A,v-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(v,-1)]=w[this._idx(v-1,0)],w[this._idx(-1,v)]=w[this._idx(0,v-1)],w[this._idx(v,v)]=w[this._idx(v-1,v-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new T_(this)}get(e,r,a=!1){a&&(e=or(e,-1,this.dim),r=or(r,-1,this.dim));const u=4*this._idx(e,r);return(this.encoding==="terrarium"?Sg:Eg)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return S_[e]}get unpackVector(){return S_[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const a=[0,0,0,0],u=mm.getUnpackVector(r);let _=Math.floor((e+u[3])/u[2]);return a[2]=_%256,_=Math.floor(_/256),a[1]=_%256,_=Math.floor(_/256),a[0]=_,a}getPixels(){return new Ms({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,_=r*this.dim+this.dim,v=a*this.dim,w=a*this.dim+this.dim;switch(r){case-1:u=_-1;break;case 1:_=u+1}switch(a){case-1:v=w-1;break;case 1:w=v+1}const A=-r*this.dim,C=-a*this.dim;for(let R=v;R<w;R++)for(let F=u;F<_;F++){const j=4*this._idx(F,R),Z=4*this._idx(F+A,R+C);this.pixels[j+0]=e.pixels[Z+0],this.pixels[j+1]=e.pixels[Z+1],this.pixels[j+2]=e.pixels[Z+2],this.pixels[j+3]=e.pixels[Z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ft(mm,"DEMData"),Ft(T_,"DemMinMaxQuadTree",{omit:["dem"]});class Ig{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const _={value:r,timeout:void 0};if(a!==void 0&&(_.timeout=setTimeout(()=>{this.remove(e,_)},a)),this.data[u].push(_),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,u=r===void 0?0:this.data[a].indexOf(r),_=this.data[a][u];return this.data[a].splice(u,1),_.timeout&&clearTimeout(_.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(_.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||r.push(u);for(const a of r)this.remove(a.value.tileID,a)}}class Id{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}Id.ReadOnly=!1,Id.ReadWrite=!0,Id.disabled=new Id(519,Id.ReadOnly,[0,1]);const Um=7680;class Vm{constructor(e,r,a,u,_,v){this.test=e,this.ref=r,this.mask=a,this.fail=u,this.depthFail=_,this.pass=v}}Vm.disabled=new Vm({func:519,mask:0},0,0,Um,Um,Um);class Ru{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}Ru.Replace=[1,0],Ru.disabled=new Ru(Ru.Replace,In.transparent,[!1,!1,!1,!1]),Ru.unblended=new Ru(Ru.Replace,In.transparent,[!0,!0,!0,!0]),Ru.alphaBlended=new Ru([1,771],In.transparent,[!0,!0,!0,!0]);const Nm=1029,jm=2305;class su{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}su.disabled=new su(!1,Nm,jm),su.backCCW=new su(!0,Nm,jm),su.backCW=new su(!0,Nm,2304),su.frontCW=new su(!0,1028,2304),su.frontCCW=new su(!0,1028,jm);class kp extends Ei{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new Ig(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Tg,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return zs(this._tiles).map(e=>e.tileID).sort(I_).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&r.push(this._tiles[a]);return e?r.sort((a,u)=>{const _=a.tileID,v=u.tileID,w=new Xt(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),A=new Xt(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-v.overscaledZ||A.y-w.y||A.x-w.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(I_).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new zr(u,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Ti.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ir("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const _=r[u];if(e.neighboringTiles&&e.neighboringTiles[_]){const v=this.getTileByID(_);a(e,v),a(v,e)}}function a(u,_){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let v=_.tileID.canonical.x-u.tileID.canonical.x;const w=_.tileID.canonical.y-u.tileID.canonical.y,A=Math.pow(2,u.tileID.canonical.z),C=_.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+A)===1?v+=A:Math.abs(v-A)===1&&(v-=A)),_.dem&&u.dem&&(u.dem.backfillBorder(_.dem,v,w),u.neighboringTiles&&u.neighboringTiles[C]&&(u.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,u){for(const _ in this._tiles){let v=this._tiles[_];if(u[_]||!v.hasData()||v.tileID.overscaledZ<=r||v.tileID.overscaledZ>a)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>r+1;){const C=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[C.key],v&&v.hasData()&&(w=C)}let A=w;for(;A.overscaledZ>r;)if(A=A.scaledTo(A.overscaledZ-1),e[A.key]){u[w.key]=w;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const u=e.scaledTo(a),_=this._getLoadedTile(u);if(_)return _}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const a=Math.ceil(e.width/r)+1,u=Math.ceil(e.height/r)+1,_=Math.floor(a*u*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const u in this._tiles){const _=this._tiles[u];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),a[_.tileID.key]=_}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,r,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new un(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(u=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(w=>this._source.hasTile(w)))):u=[];const _=this._updateRetainedTiles(u);if(A_(this._source.type)&&u.length!==0){const w={},A={},C=Object.keys(_);for(const F of C){const j=_[F],Z=this._tiles[F];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=Ti.now())continue;const $=this.findLoadedParent(j,Math.max(j.overscaledZ-kp.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),w[$.tileID.key]=$.tileID),A[F]=j}const R=u[u.length-1].overscaledZ;for(const F in this._tiles){const j=this._tiles[F];if(_[F]||!j.hasData())continue;let Z=j.tileID;for(;Z.overscaledZ>R;){Z=Z.scaledTo(Z.overscaledZ-1);const $=this._tiles[Z.key];if($&&$.hasData()&&A[Z.key]){_[F]=j.tileID;break}}}for(const F in w)_[F]||(this._coveredTiles[F]=!0,_[F]=w[F])}for(const w in _)this._tiles[w].clearFadeHold();const v=function(w,A){const C=[];for(const R in w)R in A||C.push(R);return C}(this._tiles,_);for(const w of v){const A=this._tiles[w];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const a={},u=e.reduce((C,R)=>Math.min(C,R.overscaledZ),1/0),_=e[0].overscaledZ,v=Math.max(_-kp.maxOverzooming,this._source.minzoom),w=Math.max(_+kp.maxUnderzooming,this._source.minzoom),A={};for(const C of e){const R=this._addTile(C);r[C.key]=C,R.hasData()||u<this._source.maxzoom&&(A[C.key]=C)}this._retainLoadedChildren(A,u,w,r);for(const C of e){let R=this._tiles[C.key];if(R.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const j=C.children(this._source.maxzoom)[0],Z=this.getTile(j);if(Z&&Z.hasData()){r[j.key]=j;continue}}else{const j=C.children(this._source.maxzoom);if(r[j[0].key]&&r[j[1].key]&&r[j[2].key]&&r[j[3].key])continue}let F=R.wasRequested();for(let j=C.overscaledZ-1;j>=v;--j){const Z=C.scaledTo(j);if(a[Z.key]||(a[Z.key]=!0,R=this.getTile(Z),!R&&F&&(R=this._addTile(Z)),R&&(r[Z.key]=Z,F=R.wasRequested(),R.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}r.push(u.key);const _=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(_),a)break;u=_}for(const _ of r)this._loadedParentTiles[_]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=!!r;if(!a){const u=this.map?this.map.painter:null;r=new Om(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new ir("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,a){const u=[],_=this.transform;if(!_)return u;const v=_.projection.name==="globe",w=oc(_.center.lng);for(const A in this._tiles){const C=this._tiles[A];if(a&&C.clearQueryDebugViz(),C.holdingForFade())continue;let R;if(v){const F=C.tileID.canonical;if(F.z===0){const j=[Math.abs(or(w,...yf(F,-1))-w),Math.abs(or(w,...yf(F,1))-w)];R=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(or(w,...yf(F,-1))-w),Math.abs(or(w,...yf(F,0))-w),Math.abs(or(w,...yf(F,1))-w)];R=[j.indexOf(Math.min(...j))-1]}}else R=[0];for(const F of R){const j=e.containsTile(C,_,r,F);j&&u.push(j)}}return u}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(A_(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=Ti.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const u=this._tiles[e];u&&u.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(e,r))};return void this._source.on("data",w)}const a=new Map,u=Array.isArray(e)?e:[e],_=this.map.painter.terrain,v=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const w of u){const A=w.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of A)a.set(C.key,C);this.usedForTerrain&&w.updateElevation(!1)}hn(Array.from(a.values()),(w,A)=>{const C=new Om(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(C,R=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),A(R,C)})},r)}}function I_(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||a-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function A_(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function yf(i,e){const r=1<<i.z;return[i.x/r+e,(i.x+1)/r+e]}kp.maxOverzooming=10,kp.maxUnderzooming=3;class _m{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const u=a||e.findDEMTileFor(r);if(!u||!u.dem)return;const _=u.dem,v=u.tileID,w=1<<r.canonical.z-v.canonical.z;return new _m(u,u.tileSize/Ci/w,[(r.canonical.x/w-v.canonical.x)*_.dim,(r.canonical.y/w-v.canonical.y)*_.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),_=Math.floor(a);return new Xt(u,_)}getElevationAt(e,r,a,u){const _=e*this._scale+this._offset[0],v=r*this._scale+this._offset[1],w=Math.floor(_),A=Math.floor(v),C=this._dem;return u=!!u,a?Tr(Tr(C.get(w,A,u),C.get(w,A+1,u),v-A),Tr(C.get(w+1,A,u),C.get(w+1,A+1,u),v-A),_-w):C.get(w,A,u)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Fl(1,e)*this._dem.stride}}class M_{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new fr(Ci,16,0),this.featureIndexArray=new Gs,this.promoteId=r}insert(e,r,a,u,_,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,_,v);const A=this.grid;for(let C=0;C<r.length;C++){const R=r[C],F=[1/0,1/0,-1/0,-1/0];for(let j=0;j<R.length;j++){const Z=R[j];F[0]=Math.min(F[0],Z.x),F[1]=Math.min(F[1],Z.y),F[2]=Math.max(F[2],Z.x),F[3]=Math.max(F[3],Z.y)}F[0]<Ci&&F[1]<Ci&&F[2]>=0&&F[3]>=0&&A.insert(w,F[0],F[1],F[2],F[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Jr(new ph(this.rawTileData)).layers,this.sourceLayerCoder=new d_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,u){this.loadVTLayers();const _=e.params||{},v=d(_.filter),w=e.tileResult,A=e.transform,C=w.bufferedTilespaceBounds,R=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,($,J,se,ye)=>Gf(w.bufferedTilespaceGeometry,$,J,se,ye));R.sort(Ag);let F=null;A.elevation&&R.length>0&&(F=_m.create(A.elevation,this.tileID));const j={};let Z;for(let $=0;$<R.length;$++){const J=R[$];if(J===Z)continue;Z=J;const se=this.featureIndexArray.get(J);let ye=null;this.loadMatchingFeature(j,se,v,_.layers,_.availableImages,r,a,u,(Pe,ve,ze,Ue=0)=>(ye||(ye=ss(Pe,this.tileID.canonical,e.tileTransform)),ve.queryIntersectsFeature(w,Pe,ze,ye,this.z,e.transform,e.pixelPosMatrix,F,Ue)))}return j}loadMatchingFeature(e,r,a,u,_,v,w,A,C){const{featureIndex:R,bucketIndex:F,sourceLayerIndex:j,layoutVertexArrayOffset:Z}=r,$=this.bucketLayerIDs[F];if(u&&!function(Pe,ve){for(let ze=0;ze<Pe.length;ze++)if(ve.indexOf(Pe[ze])>=0)return!0;return!1}(u,$))return;const J=this.sourceLayerCoder.decode(j),se=this.vtLayers[J].feature(R);if(a.needGeometry){const Pe=Su(se,!0);if(!a.filter(new B(this.tileID.overscaledZ),Pe,this.tileID.canonical))return}else if(!a.filter(new B(this.tileID.overscaledZ),se))return;const ye=this.getId(se,J);for(let Pe=0;Pe<$.length;Pe++){const ve=$[Pe];if(u&&u.indexOf(ve)<0)continue;const ze=v[ve];if(!ze)continue;let Ue={};ye!==void 0&&A&&(Ue=A.getState(ze.sourceLayer||"_geojsonTileLayer",ye));const Oe=Gn({},w[ve]);Oe.paint=C_(Oe.paint,ze.paint,se,Ue,_),Oe.layout=C_(Oe.layout,ze.layout,se,Ue,_);const ht=!C||C(se,ze,Ue,Z);if(!ht)continue;const at=new f_(se,this.z,this.x,this.y,ye);at.layer=Oe;let wt=e[ve];wt===void 0&&(wt=e[ve]=[]),wt.push({featureIndex:R,feature:at,intersectionZ:ht})}}lookupSymbolFeatures(e,r,a,u,_,v,w,A){const C={};this.loadVTLayers();const R=d(_);for(const F of e)this.loadMatchingFeature(C,{bucketIndex:a,sourceLayerIndex:u,featureIndex:F,layoutVertexArrayOffset:0},R,v,w,A,r);return C}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),_=this.vtFeatures[u];if(_[r])return _[r];const v=this.vtLayers[u].feature(r);return _[r]=v,v}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];u!=null&&(a=e.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function C_(i,e,r,a,u){return cr(i,(_,v)=>{const w=e instanceof de?e.get(v):null;return w&&w.evaluate?w.evaluate(r,a,u):w})}function Ag(i,e){return e-i}Ft(M_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class z_{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Nr({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=ga(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const u=[];let _=e.length%2==1?-e[e.length-1]*a:0,v=e[0]*a,w=!0;u.push({left:_,right:v,isDash:w,zeroLength:e[0]===0});let A=e[0];for(let C=1;C<e.length;C++){w=!w;const R=e[C];_=A*a,A+=R,v=A*a,u.push({left:_,right:v,isDash:w,zeroLength:R===0})}return u}addRoundDash(e,r,a){const u=r/2;for(let _=-a;_<=a;_++){const v=this.width*(this.nextRow+a+_);let w=0,A=e[w];for(let C=0;C<this.width;C++){C/A.right>1&&(A=e[++w]);const R=Math.abs(C-A.left),F=Math.abs(C-A.right),j=Math.min(R,F);let Z;const $=_/a*(u+1);if(A.isDash){const J=u-Math.abs($);Z=Math.sqrt(j*j+J*J)}else Z=u-Math.sqrt(j*j+$*$);this.image.data[v+C]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(e,r){for(let A=e.length-1;A>=0;--A){const C=e[A],R=e[A+1];C.zeroLength?e.splice(A,1):R&&R.isDash===C.isDash&&(R.left=C.left,e.splice(A,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const _=this.width*this.nextRow;let v=0,w=e[v];for(let A=0;A<this.width;A++){A/w.right>1&&(w=e[++v]);const C=Math.abs(A-w.left),R=Math.abs(A-w.right),F=Math.min(C,R);this.image.data[_+A]=Math.max(0,Math.min(255,(w.isDash?F:-F)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const u=r==="round",_=u?7:0,v=2*_+1;if(this.nextRow+v>this.height)return Hr("LineAtlas out of space"),null;e.length===0&&e.push(1);let w=0;for(let R=0;R<e.length;R++)e[R]<0&&(Hr("Negative value is found in line dasharray, replacing values with 0"),e[R]=0),w+=e[R];if(w!==0){const R=this.width/w,F=this.getDashRanges(e,this.width,R);u?this.addRoundDash(F,R,_):this.addRegularDash(F,r==="square"?.5*R:0)}const A=this.nextRow+_;this.nextRow+=v;const C={tl:[A,_],br:[w,0]};return this.positions[a]=C,C}}Ft(z_,"LineAtlas");const P_=1*Ys;class k_{constructor(e){const r={},a=[];for(const w in e){const A=e[w],C=r[w]={};for(const R in A.glyphs){const F=A.glyphs[+R];if(!F||F.bitmap.width===0||F.bitmap.height===0)continue;const j=F.metrics.localGlyph?P_:1,Z={x:0,y:0,w:F.bitmap.width+2*j,h:F.bitmap.height+2*j};a.push(Z),C[R]=Z}}const{w:u,h:_}=dd(a),v=new Nr({width:u||1,height:_||1});for(const w in e){const A=e[w];for(const C in A.glyphs){const R=A.glyphs[+C];if(!R||R.bitmap.width===0||R.bitmap.height===0)continue;const F=r[w][C],j=R.metrics.localGlyph?P_:1;Nr.copy(R.bitmap,v,{x:0,y:0},{x:F.x+j,y:F.y+j},R.bitmap)}}this.image=v,this.positions=r}}Ft(k_,"GlyphAtlas");class Mg{constructor(e){this.tileID=new un(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Pp(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,a,u,_){this.status="parsing",this.data=e,this.collisionBoxArray=new fn;const v=new d_(Object.keys(e.layers).sort()),w=new M_(this.tileID,this.promoteId);w.bucketLayerIDs=[];const A={},C=new z_(256,256),R={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:C,availableImages:a},F=r.familiesBySource[this.source];for(const Ue in F){const Oe=e.layers[Ue];if(!Oe)continue;let ht=!1,at=!1;for(const mt of F[Ue])mt[0].type==="symbol"?ht=!0:at=!0;if(this.isSymbolTile===!0&&!ht||this.isSymbolTile===!1&&!at)continue;Oe.version===1&&Hr(`Vector tile source "${this.source}" layer "${Ue}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wt=v.encode(Ue),Ot=[];for(let mt=0;mt<Oe.length;mt++){const It=Oe.feature(mt),At=w.getId(It,Ue);Ot.push({feature:It,id:At,index:mt,sourceLayerIndex:wt})}for(const mt of F[Ue]){const It=mt[0];this.isSymbolTile!==void 0&&It.type==="symbol"!==this.isSymbolTile||It.minzoom&&this.zoom<Math.floor(It.minzoom)||It.maxzoom&&this.zoom>=It.maxzoom||It.visibility!=="none"&&(qm(mt,this.zoom,a),(A[It.id]=It.createBucket({index:w.bucketLayerIDs.length,layers:mt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(Ot,R,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(mt.map(At=>At.id)))}}let j,Z,$,J;C.trim();const se={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ye=()=>{if(j)return _(j);if(Z&&$&&J){const Ue=new k_(Z),Oe=new rf($,J);for(const ht in A){const at=A[ht];at instanceof rp?(qm(at.layers,this.zoom,a),eg(at,Z,Ue.positions,$,Oe.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):at.hasPattern&&(at instanceof Au||at instanceof it||at instanceof wo)&&(qm(at.layers,this.zoom,a),at.addFeatures(R,this.tileID.canonical,Oe.patternPositions,a,this.tileTransform))}this.status="done",_(null,{buckets:zs(A).filter(ht=>!ht.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ue.image,lineAtlas:C,imageAtlas:Oe,glyphMap:this.returnDependencies?Z:null,iconMap:this.returnDependencies?$:null,glyphPositions:this.returnDependencies?Ue.positions:null})}},Pe=cr(R.glyphDependencies,Ue=>Object.keys(Ue).map(Number));Object.keys(Pe).length?u.send("getGlyphs",{uid:this.uid,stacks:Pe},(Ue,Oe)=>{j||(j=Ue,Z=Oe,ye())},void 0,!1,se):Z={};const ve=Object.keys(R.iconDependencies);ve.length?u.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"icons"},(Ue,Oe)=>{j||(j=Ue,$=Oe,ye())},void 0,!1,se):$={};const ze=Object.keys(R.patternDependencies);ze.length?u.send("getImages",{icons:ze,source:this.source,tileID:this.tileID,type:"patterns"},(Ue,Oe)=>{j||(j=Ue,J=Oe,ye())},void 0,!1,se):J={},ye()}}function qm(i,e,r){const a=new B(e);for(const u of i)u.recalculate(a,r)}class D_{constructor(e){this.entries={},this.scheduler=e}request(e,r,a,u){const _=this.entries[e]=this.entries[e]||{callbacks:[]};if(_.result){const[v,w]=_.result;return this.scheduler?this.scheduler.add(()=>{u(v,w)},r):u(v,w),()=>{}}return _.callbacks.push(u),_.cancel||(_.cancel=a((v,w)=>{_.result=[v,w];for(const A of _.callbacks)this.scheduler?this.scheduler.add(()=>{A(v,w)},r):A(v,w);setTimeout(()=>delete this.entries[e],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(v=>v!==u),_.callbacks.length||(_.cancel(),delete this.entries[e]))}}}function L_(i,e,r){const a=JSON.stringify(i.request);return i.data&&(this.deduped.entries[a]={result:[null,i.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},u=>{const _=Rs(i.request,(v,w,A,C)=>{v?u(v):w&&u(null,{vectorTile:r?void 0:new Jr(new ph(w)),rawData:w,cacheControl:A,expires:C})});return()=>{_.cancel(),u()}},e)}const R_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gm{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const _=R_[15&a];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new Gm(w,v,_,e)}constructor(e,r=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const _=R_.indexOf(this.ArrayType),v=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+A,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+A),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+A,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Zm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:w}=this,A=[0,_.length-1,0],C=[];for(;A.length;){const R=A.pop()||0,F=A.pop()||0,j=A.pop()||0;if(F-j<=w){for(let se=j;se<=F;se++){const ye=v[2*se],Pe=v[2*se+1];ye>=e&&ye<=a&&Pe>=r&&Pe<=u&&C.push(_[se])}continue}const Z=j+F>>1,$=v[2*Z],J=v[2*Z+1];$>=e&&$<=a&&J>=r&&J<=u&&C.push(_[Z]),(R===0?e<=$:r<=J)&&(A.push(j),A.push(Z-1),A.push(1-R)),(R===0?a>=$:u>=J)&&(A.push(Z+1),A.push(F),A.push(1-R))}return C}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:_,nodeSize:v}=this,w=[0,u.length-1,0],A=[],C=a*a;for(;w.length;){const R=w.pop()||0,F=w.pop()||0,j=w.pop()||0;if(F-j<=v){for(let se=j;se<=F;se++)F_(_[2*se],_[2*se+1],e,r)<=C&&A.push(u[se]);continue}const Z=j+F>>1,$=_[2*Z],J=_[2*Z+1];F_($,J,e,r)<=C&&A.push(u[Z]),(R===0?e-a<=$:r-a<=J)&&(w.push(j),w.push(Z-1),w.push(1-R)),(R===0?e+a>=$:r+a>=J)&&(w.push(Z+1),w.push(F),w.push(1-R))}return A}}function Zm(i,e,r,a,u,_){if(u-a<=r)return;const v=a+u>>1;B_(i,e,v,a,u,_),Zm(i,e,r,a,v-1,1-_),Zm(i,e,r,v+1,u,1-_)}function B_(i,e,r,a,u,_){for(;u>a;){if(u-a>600){const C=u-a+1,R=r-a+1,F=Math.log(C),j=.5*Math.exp(2*F/3),Z=.5*Math.sqrt(F*j*(C-j)/C)*(R-C/2<0?-1:1);B_(i,e,r,Math.max(a,Math.floor(r-R*j/C+Z)),Math.min(u,Math.floor(r+(C-R)*j/C+Z)),_)}const v=e[2*r+_];let w=a,A=u;for(vf(i,e,a,r),e[2*u+_]>v&&vf(i,e,a,u);w<A;){for(vf(i,e,w,A),w++,A--;e[2*w+_]<v;)w++;for(;e[2*A+_]>v;)A--}e[2*a+_]===v?vf(i,e,a,A):(A++,vf(i,e,A,u)),A<=r&&(a=A+1),r<=A&&(u=A-1)}}function vf(i,e,r,a){Xm(i,r,a),Xm(e,2*r,2*a),Xm(e,2*r+1,2*a+1)}function Xm(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}function F_(i,e,r,a){const u=i-r,_=e-a;return u*u+_*_}c.ARRAY_TYPE=Zs,c.AUTH_ERR_MSG=De,c.Aabb=Uo,c.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Fn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=va()?i:st,this.scheduler=new bg}send(i,e,r,a,u=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=_,this.callbacks[v]=r);const w=Co(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:i,hasCallback:!!r,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:Fo(e,w)},w),{cancel:()=>{r&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a.cancel()}else if(e.mustQueue||va()){const a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),a&&a.metadata||{type:"message"})}else this.processTask(r,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Lr(e.error)):r(null,Lr(e.data)))}else{const r=Co(this.globalScope)?void 0:[],a=e.hasCallback?(_,v)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?Fo(_):null,data:Fo(v,r)},r)}:_=>{},u=Lr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){const _=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,_[0],u.source)[_[1]](u,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=Ws,c.Color=In,c.ColorMode=Ru,c.CullFaceMode=su,c.DEMData=mm,c.DataConstantProperty=Y,c.DedupedRequest=D_,c.DepthMode=Id,c.EXTENT=Ci,c.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(this.isUsingMockSource()||!e||i.y<0||i.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,u=Math.floor(i.x),_=Math.floor((i.x-u)*a),v=Math.floor(i.y*a),w=this.findDEMTileFor(new un(r,u,r,_,v));return!(!w||!w.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||i.y<0||i.y>1)return e;const u=a.getSource().maxzoom,_=1<<u,v=Math.floor(i.x),w=i.x-v,A=new un(u,v,u,Math.floor(w*_),Math.floor(i.y*_)),C=this.findDEMTileFor(A);if(!C||!C.dem)return e;const R=C.dem,F=1<<C.tileID.canonical.z,j=(w*F-C.tileID.canonical.x)*R.dim,Z=(i.y*F-C.tileID.canonical.y)*R.dim,$=Math.floor(j),J=Math.floor(Z);return(r?this.exaggeration():1)*Tr(Tr(R.get($,J),R.get($,J+1),Z-J),Tr(R.get($+1,J),R.get($+1,J+1),Z-J),j-$)}getAtTileOffset(i,e,r){const a=1<<i.canonical.z;return this.getAtPointOrZero(new Oh(i.wrap+(i.canonical.x+e/Ci)/a,(i.canonical.y+r/Ci)/a))}getAtTileOffsetFunc(i,e,r,a){return u=>{const _=this.getAtTileOffset(i,u.x,u.y),v=a.upVector(i.canonical,u.x,u.y);return Es(v,v,_*a.upVectorScale(i.canonical,e,r).metersToTile),v}}getForTilePoints(i,e,r,a){if(this.isUsingMockSource())return!1;const u=_m.create(this,i,a);return!!u&&(e.forEach(_=>{_[2]=this.exaggeration()*u.getElevationAt(_[0],_[1],r)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,u=1<<i.canonical.z-a.canonical.z;let _=i.canonical.x/u-a.canonical.x,v=i.canonical.y/u-a.canonical.y,w=0;for(let A=0;A<i.canonical.z-a.canonical.z&&!r.leaves[w];A++){_*=2,v*=2;const C=2*Math.floor(v)+Math.floor(_);w=r.childOffsets[w]+C,_%=1,v%=1}return{min:this.exaggeration()*r.minimums[w],max:this.exaggeration()*r.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=zr,c.EvaluationParameters=B,c.Event=ir,c.Evented=Ei,c.FillExtrusionBucket=wo,c.Frustum=zh,c.FrustumCorners=Ud,c.GLOBE_RADIUS=kc,c.GLOBE_SCALE_MATCH_LATITUDE=45,c.GLOBE_ZOOM_THRESHOLD_MAX=qp,c.GLOBE_ZOOM_THRESHOLD_MIN=jp,c.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_fillGridMeshWithLods(i,e){const r=new Bt,a=new wi,u=[],_=i+1+2,v=e[0]+1,w=e[0]+1+(1+e.length),A=(C,R,F)=>{let j=C===_-1?C-2:C===0?C:C-1;return j+=F?24575:0,[j,R]};for(let C=0;C<_;++C)r.emplaceBack(...A(C,0,!0));for(let C=0;C<v;++C)for(let R=0;R<_;++R)r.emplaceBack(...A(R,C,(R===0||R===_-1)&&!0));for(let C=0;C<e.length;++C){const R=e[C];for(let F=0;F<_;++F)r.emplaceBack(...A(F,R,!0))}for(let C=0;C<e.length;++C){const R=a.length,F=e[C]+1+2,j=new wi;for(let J=0;J<F-1;J++){const se=J===F-2,ye=se?_*(w-e.length+C-J):_;for(let Pe=0;Pe<_-1;Pe++){const ve=J*_+Pe;J===0||se||Pe===0||Pe===_-2?(j.emplaceBack(ve+1,ve,ve+ye),j.emplaceBack(ve+ye,ve+ye+1,ve+1)):(a.emplaceBack(ve+1,ve,ve+ye),a.emplaceBack(ve+ye,ve+ye+1,ve+1))}}const Z=vo.simpleSegment(0,R,r.length,a.length-R);for(let J=0;J<j.uint16.length;J+=3)a.emplaceBack(j.uint16[J],j.uint16[J+1],j.uint16[J+2]);const $=vo.simpleSegment(0,R,r.length,a.length-R);u.push({withoutSkirts:Z,withSkirts:$})}return{vertices:r,indices:a,segments:u}}_createGrid(i){const e=this._fillGridMeshWithLods(th,Ph);this._gridSegments=e.segments,this._gridBuffer=i.createVertexBuffer(e.vertices,mp.members),this._gridIndexBuffer=i.createIndexBuffer(e.indices,!0)}_createPoles(i){const e=new wi;for(let u=0;u<=th;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const r=new ln,a=new ln;this._poleSegments=[];for(let u=0,_=0;u<jp;u++){const v=360/(1<<u);r.emplaceBack(0,-kc,0,.5,0),a.emplaceBack(0,-kc,0,.5,1);for(let w=0;w<=th;w++){const A=w/th,C=Tr(0,v,A),[R,F,j]=Dh(Uf,Vf,C,kc);r.emplaceBack(R,F,j,A,0),a.emplaceBack(R,F,j,A,1)}this._poleSegments.push(vo.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(r,Rf,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(a,Rf,!1)}getGridBuffers(i,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const r=new Hn,a=th,u=a+1+2,_=1;this._wireframeSegments=[];for(let v=0,w=0;v<Ph.length;v++){const A=Ph[v];for(let R=_;R<A+_;R++)for(let F=_;F<a+_;F++){const j=R*u+F;r.emplaceBack(j,j+1),r.emplaceBack(j,j+u),r.emplaceBack(j,j+u+1)}const C=A*a*3;this._wireframeSegments.push(vo.simpleSegment(0,w,(A+1)*u,C)),w+=C}this._wireframeIndexBuffer=i.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},c.GlyphManager=fh,c.ImagePosition=fd,c.KDBush=Gm,c.LivePerformanceUtils=ft,c.LngLat=_n,c.LngLatBounds=Jc,c.LocalGlyphMode=hf,c.MAX_MERCATOR_LATITUDE=bo,c.MercatorCoordinate=Oh,c.ONE_EM=So,c.OverscaledTileID=un,c.PerformanceMarkers=Ae,c.Point=Xt,c.Properties=Ee,c.RGBAImage=Ms,c.Ray=Od,c.RequestManager=class{constructor(i,e,r){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",co,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Ze(i))return i;const r=Pt(i);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Ze(i))return i;const r=Pt(i);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(i,e,r,a){if(!Ze(i))return i;const u=Pt(i);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),r&&u.params.push(`language=${r}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(i,e,r,a){const u=Pt(i);return Ze(i)?(u.path=`/styles/v1${u.path}/sprite${e}${r}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${r}`,Et(u))}normalizeTileURL(i,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Ze(i))return i;const a=Pt(i);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&a.authority!=="raster"&&r===512?"@2x":""}${di.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${Gt.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${Gt.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(_){for(const v of _){const w=v.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(a.params)||Gt.ACCESS_TOKEN;return Gt.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(i,e){const r=Pt(i);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return i;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${Gt.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${Gt.TILE_URL_VERSION}/`,"")}`;let u=r.params;return e&&(u=u.filter(_=>!_.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(i,e){const r=!!e&&Ze(e),a=[];for(const u of i.tiles||[])tt(u)?a.push(this.canonicalizeTileURL(u,r)):a.push(u);return a}_makeAPIURL(i,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=Pt(Gt.API_URL);if(i.protocol=a.protocol,i.authority=a.authority,i.protocol==="http"){const u=i.params.indexOf("secure");u>=0&&i.params.splice(u,1)}if(a.path!=="/"&&(i.path=`${a.path}${i.path}`),!Gt.REQUIRE_ACCESS_TOKEN)return Et(i);if(e=e||Gt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return i.params=i.params.filter(u=>u.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Et(i)}},c.ResourceType=Ls,c.SegmentVector=vo,c.SourceCache=kp,c.StencilMode=Vm,c.StructArrayLayout1ui2=zn,c.StructArrayLayout2f1f2i16=Fi,c.StructArrayLayout2i4=Bt,c.StructArrayLayout2ui4=Hn,c.StructArrayLayout3f12=yr,c.StructArrayLayout3ui6=wi,c.StructArrayLayout4i8=Tt,c.StructArrayLayout5f20=ln,c.Texture=gf,c.Tile=Om,c.Transitionable=H,c.Uniform1f=Hu,c.Uniform1i=class extends zc{constructor(i){super(i),this.current=0}set(i,e,r){this.fetchUniformLocation(i,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},c.Uniform2f=class extends zc{constructor(i){super(i),this.current=[0,0]}set(i,e,r){this.fetchUniformLocation(i,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},c.Uniform3f=class extends zc{constructor(i){super(i),this.current=[0,0,0]}set(i,e,r){this.fetchUniformLocation(i,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},c.Uniform4f=cp,c.UniformColor=Th,c.UniformMatrix2f=class extends zc{constructor(i){super(i),this.current=up}set(i,e,r){if(this.fetchUniformLocation(i,e)){for(let a=0;a<4;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},c.UniformMatrix3f=class extends zc{constructor(i){super(i),this.current=Af}set(i,e,r){if(this.fetchUniformLocation(i,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},c.UniformMatrix4f=class extends zc{constructor(i){super(i),this.current=If}set(i,e,r){if(this.fetchUniformLocation(i,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},c.UnwrappedTileID=ea,c.ValidationError=ti,c.VectorTileFeature=ao,c.VectorTileWorkerSource=class extends Ei{constructor(i,e,r,a,u){super(),this.actor=i,this.layerIndex=e,this.availableImages=r,this.loadVectorData=u||L_,this.loading={},this.loaded={},this.deduped=new D_(i.scheduler),this.isSpriteLoaded=a,this.scheduler=i.scheduler}loadTile(i,e){const r=i.uid,a=i&&i.request,u=a&&a.collectResourceTiming,_=this.loading[r]=new Mg(i);_.abort=this.loadVectorData(i,(v,w)=>{const A=!this.loading[r];if(delete this.loading[r],A||v||!w)return _.status="done",A||(this.loaded[r]=_),e(v);const C=w.rawData,R={};w.expires&&(R.expires=w.expires),w.cacheControl&&(R.cacheControl=w.cacheControl),_.vectorTile=w.vectorTile||new Jr(new ph(C));const F=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(j,Z)=>{if(j||!Z)return e(j);const $={};if(u){const J=Wt(a);J.length>0&&($.resourceTiming=JSON.parse(JSON.stringify(J)))}e(null,Gn({rawTileData:C.slice(0)},Z,R,$))})};this.isSpriteLoaded?F():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(F,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):F()}),this.loaded=this.loaded||{},this.loaded[r]=_})}reloadTile(i,e){const r=this.loaded,a=i.uid,u=this;if(r&&r[a]){const _=r[a];_.showCollisionBoxes=i.showCollisionBoxes,_.enableTerrain=!!i.enableTerrain,_.projection=i.projection,_.tileTransform=Pp(i.tileID.canonical,i.projection);const v=(w,A)=>{const C=_.reloadCallback;C&&(delete _.reloadCallback,_.parse(_.vectorTile,u.layerIndex,this.availableImages,u.actor,C)),e(w,A)};_.status==="parsing"?_.reloadCallback=v:_.status==="done"&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(i,e){const r=i.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),e()}removeTile(i,e){const r=this.loaded,a=i.uid;r&&r[a]&&delete r[a],e()}},c.WritingMode=eo,c.ZoomDependentExpression=qr,c.add=Qc,c.addDynamicAttributes=pm,c.adjoint=function(i,e){var r=e[0],a=e[1],u=e[2],_=e[3],v=e[4],w=e[5],A=e[6],C=e[7],R=e[8];return i[0]=v*R-w*C,i[1]=u*C-a*R,i[2]=a*w-u*v,i[3]=w*A-_*R,i[4]=r*R-u*A,i[5]=u*_-r*w,i[6]=_*C-v*A,i[7]=a*A-r*C,i[8]=r*v-a*_,i},c.asyncAll=hn,c.bezier=hs,c.bindAll=Fn,c.boundsAttributes=__,c.bufferConvexPolygon=function(i,e){const r=[];for(let a=0;a<i.length;a++){const u=tn(a-1,-1,i.length-1),_=tn(a+1,-1,i.length-1),v=i[a],w=i[_],A=i[u].sub(v).unit(),C=w.sub(v).unit(),R=C.angleWithSep(A.x,A.y),F=A.add(C).unit().mult(-1*e/Math.sin(R/2));r.push(v.add(F))}return r},c.cacheEntryPossiblyAdded=function(i){ja++,ja>Gl&&(i.getActor().send("enforceCacheSizeLimit",ql),ja=0)},c.calculateGlobeLabelMatrix=function(i,e){const{x:r,y:a}=i.point,u=Bl(r,a,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Oa(u,u,xu(Is(e)))},c.calculateGlobeMatrix=function(i){const{x:e,y:r}=i.point,{lng:a,lat:u}=i._center;return Bl(e,r,i.worldSize,a,u)},c.calculateGlobeMercatorMatrix=function(i){const e=i.pixelsPerMeter,r=e/Fl(1,i.center.lat),a=pl(new Float64Array(16));return pp(a,a,[i.point.x,i.point.y,0]),Qu(a,a,[r,r,e]),Float32Array.from(a)},c.circumferenceAtLatitude=Tu,c.clamp=or,c.clearTileCache=function(i){if(!ds())return;const e=st.caches.delete(ks);i&&e.catch(i).then(()=>i())},c.clipLine=vd,c.clone=function(i){var e=new Zs(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},c.clone$1=Ui,c.collisionCircleLayout=Tp,c.config=Gt,c.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},c.create=function(){var i=new Zs(16);return Zs!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},c.create$1=Yu,c.createExpression=Qa,c.createLayout=$e,c.createStyleLayer=function(i){return i.type==="custom"?new gg(i):new vg[i.type](i)},c.cross=Vp,c.degToRad=Ki,c.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},c.div=function(i,e,r){return i[0]=e[0]/r[0],i[1]=e[1]/r[1],i[2]=e[2]/r[2],i},c.dot=dl,c.earthRadius=Bh,c.ease=gl,c.easeCubicInOut=fa,c.ecefToLatLng=function([i,e,r]){const a=Math.hypot(i,e,r),u=Math.atan2(i,r),_=.5*Math.PI-Math.acos(-e/a);return new _n(en(u),en(_))},c.emitValidationErrors=ji,c.endsWith=ya,c.enforceCacheSizeLimit=function(i){fs(),zo&&zo.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-i;a++)e.delete(r[a])})})},c.evaluateSizeForFeature=ou,c.evaluateSizeForZoom=au,c.evaluateVariableOffset=r_,c.evented=x,c.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},c.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},c.exported=Ti,c.exported$1=di,c.extend=Gn,c.extend$1=dn,c.fillExtrusionHeightLift=yn,c.filterObject=On,c.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},c.fromQuat=function(i,e){var r=e[0],a=e[1],u=e[2],_=e[3],v=r+r,w=a+a,A=u+u,C=r*v,R=a*v,F=a*w,j=u*v,Z=u*w,$=u*A,J=_*v,se=_*w,ye=_*A;return i[0]=1-F-$,i[1]=R+ye,i[2]=j-se,i[3]=0,i[4]=R-ye,i[5]=1-C-$,i[6]=Z+J,i[7]=0,i[8]=j+se,i[9]=Z-J,i[10]=1-C-F,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},c.fromRotation=function(i,e){var r=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=r,i[2]=0,i[3]=-r,i[4]=a,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},c.fromScaling=Ih,c.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return us[e]},c.getAABBPointSquareDist=function(i,e,r){let a=0;for(let u=0;u<2;++u){const _=r?r[u]:0;i[u]>_&&(a+=(i[u]-_)*(i[u]-_)),e[u]<_&&(a+=(_-e[u])*(_-e[u]))}return a},c.getAnchorAlignment=md,c.getAnchorJustification=km,c.getBounds=function(i){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(const _ of i)e=Math.min(e,_.x),r=Math.min(r,_.y),a=Math.max(a,_.x),u=Math.max(u,_.y);return{min:new Xt(e,r),max:new Xt(a,u)}},c.getColumn=xa,c.getDefaultExportFromCjs=_o,c.getGridMatrix=function(i,e,r,a){const u=e.getNorth(),_=e.getSouth(),v=e.getWest(),w=e.getEast(),A=1<<i.z,C=w-v,R=u-_,F=C/th,j=-R/Ph[r],Z=[0,F,0,j,0,0,u,v,0];if(i.z>0){const $=180/a;Cf(Z,Z,[$/C+1,0,0,0,$/R+1,0,-.5*$/F,.5*$/j,1])}return Z[2]=A,Z[5]=i.x,Z[8]=i.y,Z},c.getImage=Ie,c.getJSON=function(i,e){return ms(Gn(i,{type:"json"}),e)},c.getLatitudinalLod=function(i){const e=bo-5;i=or(i,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Ki(i))),3);return Math.round(r*(Ph.length-1))},c.getMapSessionAPI=Re,c.getPerformanceMeasurement=Wt,c.getProjection=h_,c.getRTLTextPluginStatus=E,c.getReferrer=Do,c.getTilePoint=function(i,{x:e,y:r},a=0){return new Xt(((e-a)*i.scale-i.x)*Ci,(r*i.scale-i.y)*Ci)},c.getTileVec3=function(i,e,r=0){return Oo(((e.x-r)*i.scale-i.x)*Ci,(e.y*i.scale-i.y)*Ci,Fh(e.z,e.y))},c.getVideo=function(i,e){const r=st.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<i.length;a++){const u=st.document.createElement("source");yl(i[a])||(r.crossOrigin="Anonymous"),u.src=i[a],r.appendChild(u)}return{cancel:()=>{}}},c.globeCenterToScreenPoint=function(i){const e=[0,0,0],r=pl(new Float64Array(16));return Oa(r,i.pixelMatrix,i.globeMatrix),po(e,e,r),new Xt(e[0],e[1])},c.globeDenormalizeECEF=xu,c.globeECEFOrigin=function(i,e){const r=[0,0,0];return po(r,r,Rh(Is(e.canonical))),po(r,r,i),r},c.globeMetersToEcef=vu,c.globeNormalizeECEF=Rh,c.globePixelsToTileUnits=function(i,e){return Ci/(512*Math.pow(2,i))*Lh(Is(e))},c.globePoleMatrixForTile=function(i,e,r){const a=pl(new Float64Array(16)),u=(e/(1<<i)-.5)*Math.PI*2;return Op(a,r.globeMatrix,u),Float32Array.from(a)},c.globeTileBounds=Is,c.globeTiltAtLngLat=Vd,c.globeToMercatorTransition=bu,c.globeUseCustomAntiAliasing=function(i,e,r){const a=bu(r.zoom),u=i.style.map._antialias,_=!!e.extStandardDerivatives,v=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return a===0&&!u&&!v&&_},c.identity=pl,c.identity$1=Fd,c.invert=Ju,c.isFullscreen=function(){return!!st.document.fullscreenElement||!!st.document.webkitFullscreenElement},c.isLngLatBehindGlobe=Xp,c.isMapAuthenticated=function(i){return Le.has(i)},c.isMapboxURL=Ze,c.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!Co(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},c.latFromMercatorY=Vo,c.latLngToECEF=rh,c.len=Np,c.length=Ah,c.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},c.lngFromMercatorX=as,c.loadVectorTile=L_,c.makeRequest=ms,c.mapValue=function(i,e,r,a,u){return or((i-e)/(r-e)*(u-a)+a,a,u)},c.mercatorScale=Nf,c.mercatorXfromLng=oc,c.mercatorYfromLat=ml,c.mercatorZfromAltitude=Fl,c.mul=zf,c.mul$1=kf,c.multiply=Oa,c.multiply$1=Cf,c.multiply$2=Rd,c.nextPowerOfTwo=ga,c.normalize=os,c.normalize$1=wm,c.normalize$2=Bd,c.number=Tr,c.ortho=function(i,e,r,a,u,_,v){var w=1/(e-r),A=1/(a-u),C=1/(_-v);return i[0]=-2*w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*A,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(e+r)*w,i[13]=(u+a)*A,i[14]=(v+_)*C,i[15]=1,i},c.pbf=Ip,c.perspective=function(i,e,r,a,u){var _,v=1/Math.tan(e/2);return i[0]=v/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+a)*(_=1/(a-u)),i[14]=2*u*a*_):(i[10]=-1,i[14]=-2*a),i},c.pick=function(i,e){const r={};for(let a=0;a<e.length;a++){const u=e[a];u in i&&(r[u]=i[u])}return r},c.plugin=k,c.pointGeometry=ra,c.polesInViewport=function(i){const e=pl(new Float64Array(16));Oa(e,i.pixelMatrix,i.globeMatrix);const r=[0,fl,0],a=[0,Kn,0];return po(r,r,e),po(a,a,e),[r[0]>0&&r[0]<=i.width&&r[1]>0&&r[1]<=i.height&&!Xp(i,new _n(i.center.lat,90)),a[0]>0&&a[0]<=i.width&&a[1]>0&&a[1]<=i.height&&!Xp(i,new _n(i.center.lat,-90))]},c.polygonContainsPoint=Ol,c.polygonIntersectsBox=Gf,c.polygonIntersectsPolygon=jf,c.polygonizeBounds=function(i,e,r=0,a=!0){const u=new Xt(r,r),_=i.sub(u),v=e.add(u),w=[_,new Xt(v.x,_.y),v,new Xt(_.x,v.y)];return a&&w.push(_.clone()),w},c.posAttributes=mp,c.postMapLoadEvent=pe,c.postPerformanceEvent=Be,c.postTurnstileEvent=X,c.potpack=dd,c.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},c.radToDeg=en,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(i){return i({pluginStatus:m,pluginURL:n}),x.on("pluginStateChange",i),i},c.removeAuthState=function(i){Le.delete(i)},c.renderColorRamp=id,c.resample=oh,c.rotateX=kd,c.rotateX$1=Df,c.rotateY=Op,c.rotateY$1=Lf,c.rotateZ=function(i,e,r){var a=Math.sin(r),u=Math.cos(r),_=e[0],v=e[1],w=e[2],A=e[3],C=e[4],R=e[5],F=e[6],j=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*u+C*a,i[1]=v*u+R*a,i[2]=w*u+F*a,i[3]=A*u+j*a,i[4]=C*u-_*a,i[5]=R*u-v*a,i[6]=F*u-w*a,i[7]=j*u-A*a,i},c.rotateZ$1=function(i,e,r){r*=.5;var a=e[0],u=e[1],_=e[2],v=e[3],w=Math.sin(r),A=Math.cos(r);return i[0]=a*A+u*w,i[1]=u*A-a*w,i[2]=_*A+v*w,i[3]=v*A-_*w,i},c.scale=Qu,c.scale$1=mn,c.scale$2=Es,c.scaleAndAdd=fp,c.set=function(i,e,r,a){return i[0]=e,i[1]=r,i[2]=a,i},c.setCacheLimits=function(i,e){ql=i,Gl=e},c.setColumn=function(i,e,r){i[4*e+0]=r[0],i[4*e+1]=r[1],i[4*e+2]=r[2],i[4*e+3]=r[3]},c.setRTLTextPlugin=function(i,e,r=!1){if(m===ws||m===Ba||m===Ac)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=Ti.resolveURL(i),m=ws,Fa=e,g(),r||z()},c.smoothstep=Cs,c.spec=lt,c.squaredLength=function(i){var e=i[0],r=i[1],a=i[2];return e*e+r*r+a*a},c.storeAuthState=function(i,e){e?Le.add(i):Le.delete(i)},c.sub=Rl,c.subtract=Up,c.symbolSize=Ep,c.tileAABB=function(i,e,r,a,u,_,v,w,A){if(A.name==="globe")return As(i,e,new Ws(r,a,u));const C=Pp({z:r,x:a,y:u},A);return new Uo([(_+C.x/C.scale)*e,e*(C.y/C.scale),v],[(_+C.x2/C.scale)*e,e*(C.y2/C.scale),w])},c.tileCornersToBounds=yp,c.tileTransform=Pp,c.transformMat3=function(i,e,r){var a=e[0],u=e[1],_=e[2];return i[0]=a*r[0]+u*r[3]+_*r[6],i[1]=a*r[1]+u*r[4]+_*r[7],i[2]=a*r[2]+u*r[5]+_*r[8],i},c.transformMat4=po,c.transformMat4$1=Ss,c.transformQuat=Ch,c.transitionTileAABBinECEF=_p,c.translate=pp,c.transpose=function(i,e){if(i===e){var r=e[1],a=e[2],u=e[5];i[1]=e[3],i[2]=e[6],i[3]=r,i[5]=e[7],i[6]=a,i[7]=u}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},c.triggerPluginCompletionEvent=l,c.uniqueId=_a,c.updateGlobeVertexNormal=function(i,e,r,a,u){const _=5*e+2;i.float32[_+0]=r,i.float32[_+1]=a,i.float32[_+2]=u},c.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFilter=i=>Pi(Te(i)),c.validateFog=i=>Pi(ei(i)),c.validateLayer=i=>Pi(et(i)),c.validateLight=i=>Pi(Vt(i)),c.validateSource=i=>Pi(gt(i)),c.validateStyle=Ii,c.validateTerrain=i=>Pi(fi(i)),c.values=zs,c.vectorTile=bi,c.version=Kt,c.warnOnce=Hr,c.window=st,c.wrap=tn}),T(["./shared"],function(c){function st(Ce){if(typeof Ce=="number"||typeof Ce=="boolean"||typeof Ce=="string"||Ce==null)return JSON.stringify(Ce);if(Array.isArray(Ce)){let re="[";for(const Ie of Ce)re+=`${st(Ie)},`;return`${re}]`}let te="{";for(const re of Object.keys(Ce).sort())te+=`${re}:${st(Ce[re])},`;return`${te}}`}function Kt(Ce){let te="";for(const re of c.refProperties)te+=`/${st(Ce[re])}`;return te}class Zi{constructor(te){this.keyCache={},te&&this.replace(te)}replace(te){this._layerConfigs={},this._layers={},this.update(te,[])}update(te,re){for(const De of te)this._layerConfigs[De.id]=De,(this._layers[De.id]=c.createStyleLayer(De)).compileFilter(),this.keyCache[De.id]&&delete this.keyCache[De.id];for(const De of re)delete this.keyCache[De],delete this._layerConfigs[De],delete this._layers[De];this.familiesBySource={};const Ie=function(De,Ze){const tt={};for(let Ge=0;Ge<De.length;Ge++){const pt=Ze&&Ze[De[Ge].id]||Kt(De[Ge]);Ze&&(Ze[De[Ge].id]=pt);let vt=tt[pt];vt||(vt=tt[pt]=[]),vt.push(De[Ge])}const Qe=[];for(const Ge in tt)Qe.push(tt[Ge]);return Qe}(c.values(this._layerConfigs),this.keyCache);for(const De of Ie){const Ze=De.map(Pt=>this._layers[Pt.id]),tt=Ze[0];if(tt.visibility==="none")continue;const Qe=tt.source||"";let Ge=this.familiesBySource[Qe];Ge||(Ge=this.familiesBySource[Qe]={});const pt=tt.sourceLayer||"_geojsonTileLayer";let vt=Ge[pt];vt||(vt=Ge[pt]=[]),vt.push(Ze)}}}class Gt{loadTile(te,re){const{uid:Ie,encoding:De,rawImageData:Ze,padding:tt,buildQuadTree:Qe}=te,Ge=c.window.ImageBitmap&&Ze instanceof c.window.ImageBitmap?this.getImageData(Ze,tt):Ze;re(null,new c.DEMData(Ie,Ge,De,tt<1,Qe))}getImageData(te,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const Ie=this.offscreenCanvasContext.getImageData(-re,-re,te.width+2*re,te.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ie}}function di(Ce,te){if(Ce.length!==0){Di(Ce[0],te);for(var re=1;re<Ce.length;re++)Di(Ce[re],!te)}}function Di(Ce,te){for(var re=0,Ie=0,De=0,Ze=Ce.length,tt=Ze-1;De<Ze;tt=De++){var Qe=(Ce[De][0]-Ce[tt][0])*(Ce[tt][1]+Ce[De][1]),Ge=re+Qe;Ie+=Math.abs(re)>=Math.abs(Qe)?re-Ge+Qe:Qe-Ge+re,re=Ge}re+Ie>=0!=!!te&&Ce.reverse()}var nr=c.getDefaultExportFromCjs(function Ce(te,re){var Ie,De=te&&te.type;if(De==="FeatureCollection")for(Ie=0;Ie<te.features.length;Ie++)Ce(te.features[Ie],re);else if(De==="GeometryCollection")for(Ie=0;Ie<te.geometries.length;Ie++)Ce(te.geometries[Ie],re);else if(De==="Feature")Ce(te.geometry,re);else if(De==="Polygon")di(te.coordinates,re);else if(De==="MultiPolygon")for(Ie=0;Ie<te.coordinates.length;Ie++)di(te.coordinates[Ie],re);return te});const tr=c.VectorTileFeature.prototype.toGeoJSON;var Xn={exports:{}},Wn=c.pointGeometry,co=c.vectorTile.VectorTileFeature,_o=Ao;function Ao(Ce,te){this.options=te||{},this.features=Ce,this.length=Ce.length}function to(Ce,te){this.id=typeof Ce.id=="number"?Ce.id:void 0,this.type=Ce.type,this.rawGeometry=Ce.type===1?[Ce.geometry]:Ce.geometry,this.properties=Ce.tags,this.extent=te||4096}Ao.prototype.feature=function(Ce){return new to(this.features[Ce],this.options.extent)},to.prototype.loadGeometry=function(){var Ce=this.rawGeometry;this.geometry=[];for(var te=0;te<Ce.length;te++){for(var re=Ce[te],Ie=[],De=0;De<re.length;De++)Ie.push(new Wn(re[De][0],re[De][1]));this.geometry.push(Ie)}return this.geometry},to.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ce=this.geometry,te=1/0,re=-1/0,Ie=1/0,De=-1/0,Ze=0;Ze<Ce.length;Ze++)for(var tt=Ce[Ze],Qe=0;Qe<tt.length;Qe++){var Ge=tt[Qe];te=Math.min(te,Ge.x),re=Math.max(re,Ge.x),Ie=Math.min(Ie,Ge.y),De=Math.max(De,Ge.y)}return[te,Ie,re,De]},to.prototype.toGeoJSON=co.prototype.toGeoJSON;var Mo=c.pbf,ra=_o;function jr(Ce){var te=new Mo;return function(re,Ie){for(var De in re.layers)Ie.writeMessage(3,Xt,re.layers[De])}(Ce,te),te.finish()}function Xt(Ce,te){var re;te.writeVarintField(15,Ce.version||1),te.writeStringField(1,Ce.name||""),te.writeVarintField(5,Ce.extent||4096);var Ie={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<Ce.length;re++)Ie.feature=Ce.feature(re),te.writeMessage(2,En,Ie);var De=Ie.keys;for(re=0;re<De.length;re++)te.writeStringField(3,De[re]);var Ze=Ie.values;for(re=0;re<Ze.length;re++)te.writeMessage(4,fa,Ze[re])}function En(Ce,te){var re=Ce.feature;re.id!==void 0&&te.writeVarintField(1,re.id),te.writeMessage(2,Wo,Ce),te.writeVarintField(3,re.type),te.writeMessage(4,us,re)}function Wo(Ce,te){var re=Ce.feature,Ie=Ce.keys,De=Ce.values,Ze=Ce.keycache,tt=Ce.valuecache;for(var Qe in re.properties){var Ge=re.properties[Qe],pt=Ze[Qe];if(Ge!==null){pt===void 0&&(Ie.push(Qe),Ze[Qe]=pt=Ie.length-1),te.writeVarint(pt);var vt=typeof Ge;vt!=="string"&&vt!=="boolean"&&vt!=="number"&&(Ge=JSON.stringify(Ge));var Pt=vt+":"+Ge,Et=tt[Pt];Et===void 0&&(De.push(Ge),tt[Pt]=Et=De.length-1),te.writeVarint(Et)}}}function Ki(Ce,te){return(te<<3)+(7&Ce)}function en(Ce){return Ce<<1^Ce>>31}function us(Ce,te){for(var re=Ce.loadGeometry(),Ie=Ce.type,De=0,Ze=0,tt=re.length,Qe=0;Qe<tt;Qe++){var Ge=re[Qe],pt=1;Ie===1&&(pt=Ge.length),te.writeVarint(Ki(1,pt));for(var vt=Ie===3?Ge.length-1:Ge.length,Pt=0;Pt<vt;Pt++){Pt===1&&Ie!==1&&te.writeVarint(Ki(2,vt-1));var Et=Ge[Pt].x-De,mi=Ge[Pt].y-Ze;te.writeVarint(en(Et)),te.writeVarint(en(mi)),De+=Et,Ze+=mi}Ie===3&&te.writeVarint(Ki(7,1))}}function fa(Ce,te){var re=typeof Ce;re==="string"?te.writeStringField(1,Ce):re==="boolean"?te.writeBooleanField(7,Ce):re==="number"&&(Ce%1!=0?te.writeDoubleField(3,Ce):Ce<0?te.writeSVarintField(6,Ce):te.writeVarintField(5,Ce))}Xn.exports=jr,Xn.exports.fromVectorTileJs=jr,Xn.exports.fromGeojsonVt=function(Ce,te){te=te||{};var re={};for(var Ie in Ce)re[Ie]=new ra(Ce[Ie].features,te),re[Ie].name=Ie,re[Ie].version=te.version,re[Ie].extent=te.extent;return jr({layers:re})},Xn.exports.GeoJSONWrapper=ra;var hs=c.getDefaultExportFromCjs(Xn.exports);const gl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},or=Math.fround||(Cs=new Float32Array(1),Ce=>(Cs[0]=+Ce,Cs[0]));var Cs;const tn=3,hn=5,zs=6;class Gn{constructor(te){this.options=Object.assign(Object.create(gl),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:re,minZoom:Ie,maxZoom:De}=this.options;re&&console.time("total time");const Ze=`prepare ${te.length} points`;re&&console.time(Ze),this.points=te;const tt=[];for(let Ge=0;Ge<te.length;Ge++){const pt=te[Ge];if(!pt.geometry)continue;const[vt,Pt]=pt.geometry.coordinates,Et=or(pn(vt)),mi=or(ga(Pt));tt.push(Et,mi,1/0,Ge,-1,1),this.options.reduce&&tt.push(0)}let Qe=this.trees[De+1]=this._createTree(tt);re&&console.timeEnd(Ze);for(let Ge=De;Ge>=Ie;Ge--){const pt=+Date.now();Qe=this.trees[Ge]=this._createTree(this._cluster(Qe,Ge)),re&&console.log("z%d: %d clusters in %dms",Ge,Qe.numItems,+Date.now()-pt)}return re&&console.timeEnd("total time"),this}getClusters(te,re){let Ie=((te[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,te[1]));let Ze=te[2]===180?180:((te[2]+180)%360+360)%360-180;const tt=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)Ie=-180,Ze=180;else if(Ie>Ze){const Pt=this.getClusters([Ie,De,180,tt],re),Et=this.getClusters([-180,De,Ze,tt],re);return Pt.concat(Et)}const Qe=this.trees[this._limitZoom(re)],Ge=Qe.range(pn(Ie),ga(tt),pn(Ze),ga(De)),pt=Qe.data,vt=[];for(const Pt of Ge){const Et=this.stride*Pt;vt.push(pt[Et+hn]>1?ma(pt,Et,this.clusterProps):this.points[pt[Et+tn]])}return vt}getChildren(te){const re=this._getOriginId(te),Ie=this._getOriginZoom(te),De="No cluster with the specified id.",Ze=this.trees[Ie];if(!Ze)throw new Error(De);const tt=Ze.data;if(re*this.stride>=tt.length)throw new Error(De);const Qe=this.options.radius/(this.options.extent*Math.pow(2,Ie-1)),Ge=Ze.within(tt[re*this.stride],tt[re*this.stride+1],Qe),pt=[];for(const vt of Ge){const Pt=vt*this.stride;tt[Pt+4]===te&&pt.push(tt[Pt+hn]>1?ma(tt,Pt,this.clusterProps):this.points[tt[Pt+tn]])}if(pt.length===0)throw new Error(De);return pt}getLeaves(te,re,Ie){const De=[];return this._appendLeaves(De,te,re=re||10,Ie=Ie||0,0),De}getTile(te,re,Ie){const De=this.trees[this._limitZoom(te)],Ze=Math.pow(2,te),{extent:tt,radius:Qe}=this.options,Ge=Qe/tt,pt=(Ie-Ge)/Ze,vt=(Ie+1+Ge)/Ze,Pt={features:[]};return this._addTileFeatures(De.range((re-Ge)/Ze,pt,(re+1+Ge)/Ze,vt),De.data,re,Ie,Ze,Pt),re===0&&this._addTileFeatures(De.range(1-Ge/Ze,pt,1,vt),De.data,Ze,Ie,Ze,Pt),re===Ze-1&&this._addTileFeatures(De.range(0,pt,Ge/Ze,vt),De.data,-1,Ie,Ze,Pt),Pt.features.length?Pt:null}getClusterExpansionZoom(te){let re=this._getOriginZoom(te)-1;for(;re<=this.options.maxZoom;){const Ie=this.getChildren(te);if(re++,Ie.length!==1)break;te=Ie[0].properties.cluster_id}return re}_appendLeaves(te,re,Ie,De,Ze){const tt=this.getChildren(re);for(const Qe of tt){const Ge=Qe.properties;if(Ge&&Ge.cluster?Ze+Ge.point_count<=De?Ze+=Ge.point_count:Ze=this._appendLeaves(te,Ge.cluster_id,Ie,De,Ze):Ze<De?Ze++:te.push(Qe),te.length===Ie)break}return Ze}_createTree(te){const re=new c.KDBush(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ie=0;Ie<te.length;Ie+=this.stride)re.add(te[Ie],te[Ie+1]);return re.finish(),re.data=te,re}_addTileFeatures(te,re,Ie,De,Ze,tt){for(const Qe of te){const Ge=Qe*this.stride,pt=re[Ge+hn]>1;let vt,Pt,Et;if(pt)vt=_a(re,Ge,this.clusterProps),Pt=re[Ge],Et=re[Ge+1];else{const li=this.points[re[Ge+tn]];vt=li.properties;const[V,X]=li.geometry.coordinates;Pt=pn(V),Et=ga(X)}const mi={type:1,geometry:[[Math.round(this.options.extent*(Pt*Ze-Ie)),Math.round(this.options.extent*(Et*Ze-De))]],tags:vt};let Li;Li=pt||this.options.generateId?re[Ge+tn]:this.points[re[Ge+tn]].id,Li!==void 0&&(mi.id=Li),tt.features.push(mi)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,re){const{radius:Ie,extent:De,reduce:Ze,minPoints:tt}=this.options,Qe=Ie/(De*Math.pow(2,re)),Ge=te.data,pt=[],vt=this.stride;for(let Pt=0;Pt<Ge.length;Pt+=vt){if(Ge[Pt+2]<=re)continue;Ge[Pt+2]=re;const Et=Ge[Pt],mi=Ge[Pt+1],Li=te.within(Ge[Pt],Ge[Pt+1],Qe),li=Ge[Pt+hn];let V=li;for(const X of Li){const ee=X*vt;Ge[ee+2]>re&&(V+=Ge[ee+hn])}if(V>li&&V>=tt){let X,ee=Et*li,pe=mi*li,xe=-1;const Be=((Pt/vt|0)<<5)+(re+1)+this.points.length;for(const Xe of Li){const Re=Xe*vt;if(Ge[Re+2]<=re)continue;Ge[Re+2]=re;const Le=Ge[Re+hn];ee+=Ge[Re]*Le,pe+=Ge[Re+1]*Le,Ge[Re+4]=Be,Ze&&(X||(X=this._map(Ge,Pt,!0),xe=this.clusterProps.length,this.clusterProps.push(X)),Ze(X,this._map(Ge,Re)))}Ge[Pt+4]=Be,pt.push(ee/V,pe/V,1/0,Be,-1,V),Ze&&pt.push(xe)}else{for(let X=0;X<vt;X++)pt.push(Ge[Pt+X]);if(V>1)for(const X of Li){const ee=X*vt;if(!(Ge[ee+2]<=re)){Ge[ee+2]=re;for(let pe=0;pe<vt;pe++)pt.push(Ge[ee+pe])}}}}return pt}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,re,Ie){if(te[re+hn]>1){const tt=this.clusterProps[te[re+zs]];return Ie?Object.assign({},tt):tt}const De=this.points[te[re+tn]].properties,Ze=this.options.map(De);return Ie&&Ze===De?Object.assign({},Ze):Ze}}function ma(Ce,te,re){return{type:"Feature",id:Ce[te+tn],properties:_a(Ce,te,re),geometry:{type:"Point",coordinates:[(Ie=Ce[te],360*(Ie-.5)),ps(Ce[te+1])]}};var Ie}function _a(Ce,te,re){const Ie=Ce[te+hn],De=Ie>=1e4?`${Math.round(Ie/1e3)}k`:Ie>=1e3?Math.round(Ie/100)/10+"k":Ie,Ze=Ce[te+zs],tt=Ze===-1?{}:Object.assign({},re[Ze]);return Object.assign(tt,{cluster:!0,cluster_id:Ce[te+tn],point_count:Ie,point_count_abbreviated:De})}function pn(Ce){return Ce/360+.5}function ga(Ce){const te=Math.sin(Ce*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function ps(Ce){const te=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Fn(Ce,te,re,Ie){for(var De,Ze=Ie,tt=re-te>>1,Qe=re-te,Ge=Ce[te],pt=Ce[te+1],vt=Ce[re],Pt=Ce[re+1],Et=te+3;Et<re;Et+=3){var mi=ya(Ce[Et],Ce[Et+1],Ge,pt,vt,Pt);if(mi>Ze)De=Et,Ze=mi;else if(mi===Ze){var Li=Math.abs(Et-tt);Li<Qe&&(De=Et,Qe=Li)}}Ze>Ie&&(De-te>3&&Fn(Ce,te,De,Ie),Ce[De+2]=Ze,re-De>3&&Fn(Ce,De,re,Ie))}function ya(Ce,te,re,Ie,De,Ze){var tt=De-re,Qe=Ze-Ie;if(tt!==0||Qe!==0){var Ge=((Ce-re)*tt+(te-Ie)*Qe)/(tt*tt+Qe*Qe);Ge>1?(re=De,Ie=Ze):Ge>0&&(re+=tt*Ge,Ie+=Qe*Ge)}return(tt=Ce-re)*tt+(Qe=te-Ie)*Qe}function cr(Ce,te,re,Ie){var De={id:Ce===void 0?null:Ce,type:te,geometry:re,tags:Ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ze){var tt=Ze.geometry,Qe=Ze.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")On(Ze,tt);else if(Qe==="Polygon"||Qe==="MultiLineString")for(var Ge=0;Ge<tt.length;Ge++)On(Ze,tt[Ge]);else if(Qe==="MultiPolygon")for(Ge=0;Ge<tt.length;Ge++)for(var pt=0;pt<tt[Ge].length;pt++)On(Ze,tt[Ge][pt])}(De),De}function On(Ce,te){for(var re=0;re<te.length;re+=3)Ce.minX=Math.min(Ce.minX,te[re]),Ce.minY=Math.min(Ce.minY,te[re+1]),Ce.maxX=Math.max(Ce.maxX,te[re]),Ce.maxY=Math.max(Ce.maxY,te[re+1])}function Ui(Ce,te,re,Ie){if(te.geometry){var De=te.geometry.coordinates,Ze=te.geometry.type,tt=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),Qe=[],Ge=te.id;if(re.promoteId?Ge=te.properties[re.promoteId]:re.generateId&&(Ge=Ie||0),Ze==="Point")Ps(De,Qe);else if(Ze==="MultiPoint")for(var pt=0;pt<De.length;pt++)Ps(De[pt],Qe);else if(Ze==="LineString")Hr(De,Qe,tt,!1);else if(Ze==="MultiLineString"){if(re.lineMetrics){for(pt=0;pt<De.length;pt++)Hr(De[pt],Qe=[],tt,!1),Ce.push(cr(Ge,"LineString",Qe,te.properties));return}vn(De,Qe,tt,!1)}else if(Ze==="Polygon")vn(De,Qe,tt,!0);else{if(Ze!=="MultiPolygon"){if(Ze==="GeometryCollection"){for(pt=0;pt<te.geometry.geometries.length;pt++)Ui(Ce,{id:Ge,geometry:te.geometry.geometries[pt],properties:te.properties},re,Ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pt=0;pt<De.length;pt++){var vt=[];vn(De[pt],vt,tt,!0),Qe.push(vt)}}Ce.push(cr(Ge,Ze,Qe,te.properties))}}function Ps(Ce,te){te.push(Ma(Ce[0])),te.push(va(Ce[1])),te.push(0)}function Hr(Ce,te,re,Ie){for(var De,Ze,tt=0,Qe=0;Qe<Ce.length;Qe++){var Ge=Ma(Ce[Qe][0]),pt=va(Ce[Qe][1]);te.push(Ge),te.push(pt),te.push(0),Qe>0&&(tt+=Ie?(De*pt-Ge*Ze)/2:Math.sqrt(Math.pow(Ge-De,2)+Math.pow(pt-Ze,2))),De=Ge,Ze=pt}var vt=te.length-3;te[2]=1,Fn(te,0,vt,re),te[vt+2]=1,te.size=Math.abs(tt),te.start=0,te.end=te.size}function vn(Ce,te,re,Ie){for(var De=0;De<Ce.length;De++){var Ze=[];Hr(Ce[De],Ze,re,Ie),te.push(Ze)}}function Ma(Ce){return Ce/360+.5}function va(Ce){var te=Math.sin(Ce*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function ko(Ce,te,re,Ie,De,Ze,tt,Qe){if(Ie/=te,Ze>=(re/=te)&&tt<Ie)return Ce;if(tt<re||Ze>=Ie)return null;for(var Ge=[],pt=0;pt<Ce.length;pt++){var vt=Ce[pt],Pt=vt.geometry,Et=vt.type,mi=De===0?vt.minX:vt.minY,Li=De===0?vt.maxX:vt.maxY;if(mi>=re&&Li<Ie)Ge.push(vt);else if(!(Li<re||mi>=Ie)){var li=[];if(Et==="Point"||Et==="MultiPoint")na(Pt,li,re,Ie,De);else if(Et==="LineString")Co(Pt,li,re,Ie,De,!1,Qe.lineMetrics);else if(Et==="MultiLineString")xa(Pt,li,re,Ie,De,!1);else if(Et==="Polygon")xa(Pt,li,re,Ie,De,!0);else if(Et==="MultiPolygon")for(var V=0;V<Pt.length;V++){var X=[];xa(Pt[V],X,re,Ie,De,!0),X.length&&li.push(X)}if(li.length){if(Qe.lineMetrics&&Et==="LineString"){for(V=0;V<li.length;V++)Ge.push(cr(vt.id,Et,li[V],vt.tags));continue}Et!=="LineString"&&Et!=="MultiLineString"||(li.length===1?(Et="LineString",li=li[0]):Et="MultiLineString"),Et!=="Point"&&Et!=="MultiPoint"||(Et=li.length===3?"Point":"MultiPoint"),Ge.push(cr(vt.id,Et,li,vt.tags))}}}return Ge.length?Ge:null}function na(Ce,te,re,Ie,De){for(var Ze=0;Ze<Ce.length;Ze+=3){var tt=Ce[Ze+De];tt>=re&&tt<=Ie&&(te.push(Ce[Ze]),te.push(Ce[Ze+1]),te.push(Ce[Ze+2]))}}function Co(Ce,te,re,Ie,De,Ze,tt){for(var Qe,Ge,pt=Na(Ce),vt=De===0?ql:Gl,Pt=Ce.start,Et=0;Et<Ce.length-3;Et+=3){var mi=Ce[Et],Li=Ce[Et+1],li=Ce[Et+2],V=Ce[Et+3],X=Ce[Et+4],ee=De===0?mi:Li,pe=De===0?V:X,xe=!1;tt&&(Qe=Math.sqrt(Math.pow(mi-V,2)+Math.pow(Li-X,2))),ee<re?pe>re&&(Ge=vt(pt,mi,Li,V,X,re),tt&&(pt.start=Pt+Qe*Ge)):ee>Ie?pe<Ie&&(Ge=vt(pt,mi,Li,V,X,Ie),tt&&(pt.start=Pt+Qe*Ge)):ks(pt,mi,Li,li),pe<re&&ee>=re&&(Ge=vt(pt,mi,Li,V,X,re),xe=!0),pe>Ie&&ee<=Ie&&(Ge=vt(pt,mi,Li,V,X,Ie),xe=!0),!Ze&&xe&&(tt&&(pt.end=Pt+Qe*Ge),te.push(pt),pt=Na(Ce)),tt&&(Pt+=Qe)}var Be=Ce.length-3;mi=Ce[Be],Li=Ce[Be+1],li=Ce[Be+2],(ee=De===0?mi:Li)>=re&&ee<=Ie&&ks(pt,mi,Li,li),Be=pt.length-3,Ze&&Be>=3&&(pt[Be]!==pt[0]||pt[Be+1]!==pt[1])&&ks(pt,pt[0],pt[1],pt[2]),pt.length&&te.push(pt)}function Na(Ce){var te=[];return te.size=Ce.size,te.start=Ce.start,te.end=Ce.end,te}function xa(Ce,te,re,Ie,De,Ze){for(var tt=0;tt<Ce.length;tt++)Co(Ce[tt],te,re,Ie,De,Ze,!1)}function ks(Ce,te,re,Ie){Ce.push(te),Ce.push(re),Ce.push(Ie)}function ql(Ce,te,re,Ie,De,Ze){var tt=(Ze-te)/(Ie-te);return Ce.push(Ze),Ce.push(re+(De-re)*tt),Ce.push(1),tt}function Gl(Ce,te,re,Ie,De,Ze){var tt=(Ze-re)/(De-re);return Ce.push(te+(Ie-te)*tt),Ce.push(Ze),Ce.push(1),tt}function zo(Ce,te){for(var re=[],Ie=0;Ie<Ce.length;Ie++){var De,Ze=Ce[Ie],tt=Ze.type;if(tt==="Point"||tt==="MultiPoint"||tt==="LineString")De=Ca(Ze.geometry,te);else if(tt==="MultiLineString"||tt==="Polygon"){De=[];for(var Qe=0;Qe<Ze.geometry.length;Qe++)De.push(Ca(Ze.geometry[Qe],te))}else if(tt==="MultiPolygon")for(De=[],Qe=0;Qe<Ze.geometry.length;Qe++){for(var Ge=[],pt=0;pt<Ze.geometry[Qe].length;pt++)Ge.push(Ca(Ze.geometry[Qe][pt],te));De.push(Ge)}re.push(cr(Ze.id,tt,De,Ze.tags))}return re}function Ca(Ce,te){var re=[];re.size=Ce.size,Ce.start!==void 0&&(re.start=Ce.start,re.end=Ce.end);for(var Ie=0;Ie<Ce.length;Ie+=3)re.push(Ce[Ie]+te,Ce[Ie+1],Ce[Ie+2]);return re}function ds(Ce,te){if(Ce.transformed)return Ce;var re,Ie,De,Ze=1<<Ce.z,tt=Ce.x,Qe=Ce.y;for(re=0;re<Ce.features.length;re++){var Ge=Ce.features[re],pt=Ge.geometry,vt=Ge.type;if(Ge.geometry=[],vt===1)for(Ie=0;Ie<pt.length;Ie+=2)Ge.geometry.push(fs(pt[Ie],pt[Ie+1],te,Ze,tt,Qe));else for(Ie=0;Ie<pt.length;Ie++){var Pt=[];for(De=0;De<pt[Ie].length;De+=2)Pt.push(fs(pt[Ie][De],pt[Ie][De+1],te,Ze,tt,Qe));Ge.geometry.push(Pt)}}return Ce.transformed=!0,Ce}function fs(Ce,te,re,Ie,De,Ze){return[Math.round(re*(Ce*Ie-De)),Math.round(re*(te*Ie-Ze))]}function Ds(Ce,te,re,Ie,De){for(var Ze=te===De.maxZoom?0:De.tolerance/((1<<te)*De.extent),tt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:Ie,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Qe=0;Qe<Ce.length;Qe++){tt.numFeatures++,ja(tt,Ce[Qe],Ze,De);var Ge=Ce[Qe].minX,pt=Ce[Qe].minY,vt=Ce[Qe].maxX,Pt=Ce[Qe].maxY;Ge<tt.minX&&(tt.minX=Ge),pt<tt.minY&&(tt.minY=pt),vt>tt.maxX&&(tt.maxX=vt),Pt>tt.maxY&&(tt.maxY=Pt)}return tt}function ja(Ce,te,re,Ie){var De=te.geometry,Ze=te.type,tt=[];if(Ze==="Point"||Ze==="MultiPoint")for(var Qe=0;Qe<De.length;Qe+=3)tt.push(De[Qe]),tt.push(De[Qe+1]),Ce.numPoints++,Ce.numSimplified++;else if(Ze==="LineString")Ls(tt,De,Ce,re,!1,!1);else if(Ze==="MultiLineString"||Ze==="Polygon")for(Qe=0;Qe<De.length;Qe++)Ls(tt,De[Qe],Ce,re,Ze==="Polygon",Qe===0);else if(Ze==="MultiPolygon")for(var Ge=0;Ge<De.length;Ge++){var pt=De[Ge];for(Qe=0;Qe<pt.length;Qe++)Ls(tt,pt[Qe],Ce,re,!0,Qe===0)}if(tt.length){var vt=te.tags||null;if(Ze==="LineString"&&Ie.lineMetrics){for(var Pt in vt={},te.tags)vt[Pt]=te.tags[Pt];vt.mapbox_clip_start=De.start/De.size,vt.mapbox_clip_end=De.end/De.size}var Et={geometry:tt,type:Ze==="Polygon"||Ze==="MultiPolygon"?3:Ze==="LineString"||Ze==="MultiLineString"?2:1,tags:vt};te.id!==null&&(Et.id=te.id),Ce.features.push(Et)}}function Ls(Ce,te,re,Ie,De,Ze){var tt=Ie*Ie;if(Ie>0&&te.size<(De?tt:Ie))re.numPoints+=te.length/3;else{for(var Qe=[],Ge=0;Ge<te.length;Ge+=3)(Ie===0||te[Ge+2]>tt)&&(re.numSimplified++,Qe.push(te[Ge]),Qe.push(te[Ge+1])),re.numPoints++;De&&function(pt,vt){for(var Pt=0,Et=0,mi=pt.length,Li=mi-2;Et<mi;Li=Et,Et+=2)Pt+=(pt[Et]-pt[Li])*(pt[Et+1]+pt[Li+1]);if(Pt>0===vt)for(Et=0,mi=pt.length;Et<mi/2;Et+=2){var li=pt[Et],V=pt[Et+1];pt[Et]=pt[mi-2-Et],pt[Et+1]=pt[mi-1-Et],pt[mi-2-Et]=li,pt[mi-1-Et]=V}}(Qe,Ze),Ce.push(Qe)}}function qa(Ce,te){var re=(te=this.options=function(De,Ze){for(var tt in Ze)De[tt]=Ze[tt];return De}(Object.create(this.options),te)).debug;if(re&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ie=function(De,Ze){var tt=[];if(De.type==="FeatureCollection")for(var Qe=0;Qe<De.features.length;Qe++)Ui(tt,De.features[Qe],Ze,Qe);else Ui(tt,De.type==="Feature"?De:{geometry:De},Ze);return tt}(Ce,te);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ie=function(De,Ze){var tt=Ze.buffer/Ze.extent,Qe=De,Ge=ko(De,1,-1-tt,tt,0,-1,2,Ze),pt=ko(De,1,1-tt,2+tt,0,-1,2,Ze);return(Ge||pt)&&(Qe=ko(De,1,-tt,1+tt,0,-1,2,Ze)||[],Ge&&(Qe=zo(Ge,1).concat(Qe)),pt&&(Qe=Qe.concat(zo(pt,-1)))),Qe}(Ie,te),Ie.length&&this.splitTile(Ie,0,0,0),re&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Do(Ce,te,re){return 32*((1<<Ce)*re+te)+Ce}function ms(Ce,te){const re=Ce.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);const Ie=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!Ie)return te(null,null);const De=new class{constructor(tt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=tt.length,this._features=tt}feature(tt){return new class{constructor(Qe){this._feature=Qe,this.extent=c.EXTENT,this.type=Qe.type,this.properties=Qe.tags,"id"in Qe&&!isNaN(Qe.id)&&(this.id=parseInt(Qe.id,10))}loadGeometry(){if(this._feature.type===1){const Qe=[];for(const Ge of this._feature.geometry)Qe.push([new c.Point(Ge[0],Ge[1])]);return Qe}{const Qe=[];for(const Ge of this._feature.geometry){const pt=[];for(const vt of Ge)pt.push(new c.Point(vt[0],vt[1]));Qe.push(pt)}return Qe}}toGeoJSON(Qe,Ge,pt){return tr.call(this,Qe,Ge,pt)}}(this._features[tt])}}(Ie.features);let Ze=hs(De);Ze.byteOffset===0&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),te(null,{vectorTile:De,rawData:Ze.buffer})}qa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},qa.prototype.splitTile=function(Ce,te,re,Ie,De,Ze,tt){for(var Qe=[Ce,te,re,Ie],Ge=this.options,pt=Ge.debug;Qe.length;){Ie=Qe.pop(),re=Qe.pop(),te=Qe.pop(),Ce=Qe.pop();var vt=1<<te,Pt=Do(te,re,Ie),Et=this.tiles[Pt];if(!Et&&(pt>1&&console.time("creation"),Et=this.tiles[Pt]=Ds(Ce,te,re,Ie,Ge),this.tileCoords.push({z:te,x:re,y:Ie}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,re,Ie,Et.numFeatures,Et.numPoints,Et.numSimplified),console.timeEnd("creation"));var mi="z"+te;this.stats[mi]=(this.stats[mi]||0)+1,this.total++}if(Et.source=Ce,De){if(te===Ge.maxZoom||te===De)continue;var Li=1<<De-te;if(re!==Math.floor(Ze/Li)||Ie!==Math.floor(tt/Li))continue}else if(te===Ge.indexMaxZoom||Et.numPoints<=Ge.indexMaxPoints)continue;if(Et.source=null,Ce.length!==0){pt>1&&console.time("clipping");var li,V,X,ee,pe,xe,Be=.5*Ge.buffer/Ge.extent,Xe=.5-Be,Re=.5+Be,Le=1+Be;li=V=X=ee=null,pe=ko(Ce,vt,re-Be,re+Re,0,Et.minX,Et.maxX,Ge),xe=ko(Ce,vt,re+Xe,re+Le,0,Et.minX,Et.maxX,Ge),Ce=null,pe&&(li=ko(pe,vt,Ie-Be,Ie+Re,1,Et.minY,Et.maxY,Ge),V=ko(pe,vt,Ie+Xe,Ie+Le,1,Et.minY,Et.maxY,Ge),pe=null),xe&&(X=ko(xe,vt,Ie-Be,Ie+Re,1,Et.minY,Et.maxY,Ge),ee=ko(xe,vt,Ie+Xe,Ie+Le,1,Et.minY,Et.maxY,Ge),xe=null),pt>1&&console.timeEnd("clipping"),Qe.push(li||[],te+1,2*re,2*Ie),Qe.push(V||[],te+1,2*re,2*Ie+1),Qe.push(X||[],te+1,2*re+1,2*Ie),Qe.push(ee||[],te+1,2*re+1,2*Ie+1)}}},qa.prototype.getTile=function(Ce,te,re){var Ie=this.options,De=Ie.extent,Ze=Ie.debug;if(Ce<0||Ce>24)return null;var tt=1<<Ce,Qe=Do(Ce,te=(te%tt+tt)%tt,re);if(this.tiles[Qe])return ds(this.tiles[Qe],De);Ze>1&&console.log("drilling down to z%d-%d-%d",Ce,te,re);for(var Ge,pt=Ce,vt=te,Pt=re;!Ge&&pt>0;)pt--,vt=Math.floor(vt/2),Pt=Math.floor(Pt/2),Ge=this.tiles[Do(pt,vt,Pt)];return Ge&&Ge.source?(Ze>1&&console.log("found parent tile z%d-%d-%d",pt,vt,Pt),Ze>1&&console.time("drilling down"),this.splitTile(Ge.source,pt,vt,Pt,Ce,te,re),Ze>1&&console.timeEnd("drilling down"),this.tiles[Qe]?ds(this.tiles[Qe],De):null):null};class Rs extends c.VectorTileWorkerSource{constructor(te,re,Ie,De,Ze){super(te,re,Ie,De,ms),Ze&&(this.loadGeoJSON=Ze)}loadData(te,re){const Ie=te&&te.request,De=Ie&&Ie.collectResourceTiming;this.loadGeoJSON(te,(Ze,tt)=>{if(Ze||!tt)return re(Ze);if(typeof tt!="object")return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{nr(tt,!0);try{if(te.filter){const Ge=c.createExpression(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));tt={type:"FeatureCollection",features:tt.features.filter(vt=>Ge.value.evaluate({zoom:0},vt))}}this._geoJSONIndex=te.cluster?new Gn(function({superclusterOptions:Ge,clusterProperties:pt}){if(!pt||!Ge)return Ge;const vt={},Pt={},Et={accumulated:null,zoom:0},mi={properties:null},Li=Object.keys(pt);for(const li of Li){const[V,X]=pt[li],ee=c.createExpression(X),pe=c.createExpression(typeof V=="string"?[V,["accumulated"],["get",li]]:V);vt[li]=ee.value,Pt[li]=pe.value}return Ge.map=li=>{mi.properties=li;const V={};for(const X of Li)V[X]=vt[X].evaluate(Et,mi);return V},Ge.reduce=(li,V)=>{mi.properties=V;for(const X of Li)Et.accumulated=li[X],li[X]=Pt[X].evaluate(Et,mi)},Ge}(te)).load(tt.features):function(Ge,pt){return new qa(Ge,pt)}(tt,te.geojsonVtOptions)}catch(Ge){return re(Ge)}this.loaded={};const Qe={};if(De){const Ge=c.getPerformanceMeasurement(Ie);Ge&&(Qe.resourceTiming={},Qe.resourceTiming[te.source]=JSON.parse(JSON.stringify(Ge)))}re(null,Qe)}})}reloadTile(te,re){const Ie=this.loaded;return Ie&&Ie[te.uid]?super.reloadTile(te,re):this.loadTile(te,re)}loadGeoJSON(te,re){if(te.request)c.getJSON(te.request,re);else{if(typeof te.data!="string")return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(te.data))}catch{return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(Ie){re(Ie)}}getClusterChildren(te,re){try{re(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(Ie){re(Ie)}}getClusterLeaves(te,re){try{re(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(Ie){re(Ie)}}}class yl{constructor(te){this.self=te,this.actor=new c.Actor(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:Rs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(re,Ie)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=Ie},this.self.registerRTLTextPlugin=re=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=re.applyArabicShaping,c.plugin.processBidirectionalText=re.processBidirectionalText,c.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(te,re,Ie){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],Ie()}checkIfReady(te,re,Ie){Ie()}setReferrer(te,re){this.referrer=re}spriteLoaded(te,re){this.isSpriteLoaded[te]=re;for(const Ie in this.workerSources[te]){const De=this.workerSources[te][Ie];for(const Ze in De)De[Ze]instanceof c.VectorTileWorkerSource&&(De[Ze].isSpriteLoaded=re,De[Ze].fire(new c.Event("isSpriteLoaded")))}}setImages(te,re,Ie){this.availableImages[te]=re;for(const De in this.workerSources[te]){const Ze=this.workerSources[te][De];for(const tt in Ze)Ze[tt].availableImages=re}Ie()}enableTerrain(te,re,Ie){this.terrain=re,Ie()}setProjection(te,re){this.projections[te]=c.getProjection(re)}setLayers(te,re,Ie){this.getLayerIndex(te).replace(re),Ie()}updateLayers(te,re,Ie){this.getLayerIndex(te).update(re.layers,re.removedIds),Ie()}loadTile(te,re,Ie){const De=this.enableTerrain?c.extend({enableTerrain:this.terrain},re):re;De.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source).loadTile(De,Ie)}loadDEMTile(te,re,Ie){const De=this.enableTerrain?c.extend({buildQuadTree:this.terrain},re):re;this.getDEMWorkerSource(te,re.source).loadTile(De,Ie)}reloadTile(te,re,Ie){const De=this.enableTerrain?c.extend({enableTerrain:this.terrain},re):re;De.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source).reloadTile(De,Ie)}abortTile(te,re,Ie){this.getWorkerSource(te,re.type,re.source).abortTile(re,Ie)}removeTile(te,re,Ie){this.getWorkerSource(te,re.type,re.source).removeTile(re,Ie)}removeSource(te,re,Ie){if(!this.workerSources[te]||!this.workerSources[te][re.type]||!this.workerSources[te][re.type][re.source])return;const De=this.workerSources[te][re.type][re.source];delete this.workerSources[te][re.type][re.source],De.removeSource!==void 0?De.removeSource(re,Ie):Ie()}loadWorkerSource(te,re,Ie){try{this.self.importScripts(re.url),Ie()}catch(De){Ie(De.toString())}}syncRTLPluginState(te,re,Ie){try{c.plugin.setState(re);const De=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&De!=null){this.self.importScripts(De);const Ze=c.plugin.isParsed();Ie(Ze?void 0:new Error(`RTL Text Plugin failed to import scripts from ${De}`),Ze)}}catch(De){Ie(De.toString())}}getAvailableImages(te){let re=this.availableImages[te];return re||(re=[]),re}getLayerIndex(te){let re=this.layerIndexes[te];return re||(re=this.layerIndexes[te]=new Zi),re}getWorkerSource(te,re,Ie){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][re]||(this.workerSources[te][re]={}),!this.workerSources[te][re][Ie]){const De={send:(Ze,tt,Qe,Ge,pt,vt)=>{this.actor.send(Ze,tt,Qe,te,pt,vt)},scheduler:this.actor.scheduler};this.workerSources[te][re][Ie]=new this.workerSourceTypes[re](De,this.getLayerIndex(te),this.getAvailableImages(te),this.isSpriteLoaded[te])}return this.workerSources[te][re][Ie]}getDEMWorkerSource(te,re){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][re]||(this.demWorkerSources[te][re]=new Gt),this.demWorkerSources[te][re]}enforceCacheSizeLimit(te,re){c.enforceCacheSizeLimit(re)}getWorkerPerformanceMetrics(te,re,Ie){Ie(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new yl(self)),yl}),T(["./shared"],function(c){function st(m,n){if(Array.isArray(m)){if(!Array.isArray(n)||m.length!==n.length)return!1;for(let l=0;l<m.length;l++)if(!st(m[l],n[l]))return!1;return!0}if(typeof m=="object"&&m!==null&&n!==null){if(typeof n!="object"||Object.keys(m).length!==Object.keys(n).length)return!1;for(const l in m)if(!st(m[l],n[l]))return!1;return!0}return m===n}var Kt=Zi;function Zi(m){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,E=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(E);try{x=new Worker(z),g=!0}catch{g=!1}return x&&x.terminate(),URL.revokeObjectURL(z),g}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var E=x.getImageData(0,0,1,1);return E&&E.width===g.width}()?(Gt[l=n&&n.failIfMajorPerformanceCaveat]===void 0&&(Gt[l]=function(g){var x,E=function(z){var k=document.createElement("canvas"),B=Object.create(Zi.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=z,k.getContext("webgl",B)||k.getContext("experimental-webgl",B)}(g);if(!E)return!1;try{x=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!x||E.isContextLost())&&(E.shaderSource(x,"void main() {}"),E.compileShader(x),E.getShaderParameter(x,E.COMPILE_STATUS)===!0)}(l)),Gt[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(m)}var Gt={};function di(m,n,l){const g=c.window.document.createElement(m);return n!==void 0&&(g.className=n),l&&l.appendChild(g),g}function Di(m,n,l){const g=c.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(n))g.setAttributeNS(null,x,n[x]);return l&&l.appendChild(g),g}Zi.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const nr=c.window.document&&c.window.document.documentElement.style,tr=nr&&nr.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Xn;function Wn(){nr&&tr&&(Xn=nr[tr],nr[tr]="none")}function co(){nr&&tr&&(nr[tr]=Xn)}function _o(m){m.preventDefault(),m.stopPropagation(),c.window.removeEventListener("click",_o,!0)}function Ao(){c.window.addEventListener("click",_o,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",_o,!0)},0)}function to(m,n){const l=m.getBoundingClientRect();return jr(m,l,n)}function Mo(m,n){const l=m.getBoundingClientRect(),g=[];for(let x=0;x<n.length;x++)g.push(jr(m,l,n[x]));return g}function ra(m){return c.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function jr(m,n,l){const g=m.offsetWidth===n.width?1:m.offsetWidth/n.width;return new c.Point((l.clientX-n.left)*g,(l.clientY-n.top)*g)}function Xt(m,n){var l=n[0],g=n[1],x=n[2],E=n[3],z=l*E-x*g;return z?(m[0]=E*(z=1/z),m[1]=-g*z,m[2]=-x*z,m[3]=l*z,m):null}function En(m){const{userImage:n}=m;return!!(n&&n.render&&n.render())&&(m.data.replace(new Uint8Array(n.data.buffer)),!0)}class Wo extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:l,callback:g}of this.requestors)this._notify(l,g);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,l){this._validate(n,l)&&(this.images[n]=l)}_validate(n,l){let g=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),g=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),g=!1),this._validateContent(l.content,l)||(this.fire(new c.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),g=!1),g}_validateStretch(n,l){if(!n)return!0;let g=0;for(const x of n){if(x[0]<g||x[1]<x[0]||l<x[1])return!1;g=x[1]}return!0}_validateContent(n,l){return!(n&&(n.length!==4||n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,l){l.version=this.images[n].version+1,this.images[n]=l,this.updatedImages[n]=!0}removeImage(n){const l=this.images[n];delete this.images[n],delete this.patterns[n],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,l){let g=!0;if(!this.isLoaded())for(const x of n)this.images[x]||(g=!1);this.isLoaded()||g?this._notify(n,l):this.requestors.push({ids:n,callback:l})}_notify(n,l){const g={};for(const x of n){this.images[x]||this.fire(new c.Event("styleimagemissing",{id:x}));const E=this.images[x];E?g[x]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:c.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,g)}getPixelSize(){const{width:n,height:l}=this.atlasImage;return{width:n,height:l}}getPattern(n){const l=this.patterns[n],g=this.getImage(n);if(!g)return null;if(l&&l.position.version===g.version)return l.position;if(l)l.position.version=g.version;else{const x={w:g.data.width+2,h:g.data.height+2,x:0,y:0},E=new c.ImagePosition(x,g);this.patterns[n]={bin:x,position:E}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const l=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(n,this.atlasImage,l.RGBA),this.atlasTexture&&this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const E in this.patterns)n.push(this.patterns[E].bin);const{w:l,h:g}=c.potpack(n),x=this.atlasImage;x.resize({width:l||1,height:g||1});for(const E in this.patterns){const{bin:z}=this.patterns[E],k=z.x+1,B=z.y+1,q=this.images[E].data,N=q.width,H=q.height;c.RGBAImage.copy(q,x,{x:0,y:0},{x:k,y:B},{width:N,height:H}),c.RGBAImage.copy(q,x,{x:0,y:H-1},{x:k,y:B-1},{width:N,height:1}),c.RGBAImage.copy(q,x,{x:0,y:0},{x:k,y:B+H},{width:N,height:1}),c.RGBAImage.copy(q,x,{x:N-1,y:0},{x:k-1,y:B},{width:1,height:H}),c.RGBAImage.copy(q,x,{x:0,y:0},{x:k+N,y:B},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const l of n){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const g=this.images[l];En(g)&&this.updateImage(l,g)}}}const Ki=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(m,n){return function([l,g,x]){const E=c.degToRad(g+90),z=c.degToRad(x);return{x:l*Math.cos(E)*Math.sin(z),y:l*Math.sin(E)*Math.sin(z),z:l*Math.cos(z),azimuthal:g,polar:x}}(m.expression.evaluate(n))}interpolate(m,n,l){return{x:c.number(m.x,n.x,l),y:c.number(m.y,n.y,l),z:c.number(m.z,n.z,l),azimuthal:c.number(m.azimuthal,n.azimuthal,l),polar:c.number(m.polar,n.polar,l)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)});class en extends c.Evented{constructor(n){super(),this._transitionable=new c.Transitionable(Ki),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l={}){if(!this._validate(c.validateLight,n,l))for(const g in n){const x=n[g];c.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),x):this._transitionable.setValue(g,x)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,g){return(!g||g.validate!==!1)&&c.emitValidationErrors(this,n.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const us=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)});let fa=class extends c.Evented{constructor(m,n){super(),this._transitionable=new c.Transitionable(us),this.set(m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(m){for(const n in m){const l=m[n];c.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),l):this._transitionable.setValue(n,l)}}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}};function hs(m,n,l,g){const x=c.smoothstep(45,65,l),[E,z]=gl(m,g),k=c.length(n);let B=1-Math.min(1,Math.exp((k-E)/(z-E)*-6));return B*=B*B,B=Math.min(1,1.00747*B),B*x*m.alpha}function gl(m,n){const l=.5/Math.tan(.5*n);return[m.range[0]+l,m.range[1]+l]}const or=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"high-color":new c.DataConstantProperty(c.spec.fog["high-color"]),"space-color":new c.DataConstantProperty(c.spec.fog["space-color"]),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"]),"star-intensity":new c.DataConstantProperty(c.spec.fog["star-intensity"])});class Cs extends c.Evented{constructor(n,l){super(),this._transitionable=new c.Transitionable(or),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const n=this._transform,l=n.projection.name==="globe",g=c.globeToMercatorTransition(n.zoom),x=this.properties.get("range"),E=[.5,3];return{range:l?[c.number(E[0],x[0],g),c.number(E[1],x[1],g)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l={}){if(!this._validate(c.validateFog,n,l)){for(const g of Object.keys(c.spec.fog))n&&n[g]===void 0&&(n[g]=c.spec.fog[g].default);for(const g in n){const x=n[g];c.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),x):this._transitionable.setValue(g,x)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:c.smoothstep(45,65,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(g,x,E){const z=c.MercatorCoordinate.fromLngLat(x),k=E.elevation?E.elevation.getAtPointOrZero(z):0,B=[z.x,z.y,k];return c.transformMat4(B,B,E.mercatorFogMatrix),hs(g,B,E.pitch,E._fov)}(this.state,n,l):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?gl(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,g){return(!g||g.validate!==!1)&&c.emitValidationErrors(this,n.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class tn{constructor(n,l){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const g=this.workerPool.acquire(this.id);for(let x=0;x<g.length;x++){const E=new tn.Actor(g[x],l,this.id);E.name=`Worker ${x}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,l,g){c.asyncAll(this.actors,(x,E)=>{x.send(n,l,E)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function hn(m,n,l){return n*(c.EXTENT/(m.tileSize*Math.pow(2,l-m.tileID.overscaledZ)))}tn.Actor=c.Actor;class zs{constructor(n,l,g,x){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(n,l){let g,x;if(n instanceof c.Point||typeof n[0]=="number"){const E=c.Point.convert(n);g=[E],x=l.isPointAboveHorizon(E)}else{const E=c.Point.convert(n[0]),z=c.Point.convert(n[1]);g=[E,z],x=c.polygonizeBounds(E,z).every(k=>l.isPointAboveHorizon(k))}return new zs(g,l.getCameraPoint(),x,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return c.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new c.Point(1,1)):this.screenBounds[1],x=c.polygonizeBounds(l,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(x[3]=this.cameraPoint)),c.bufferConvexPolygon(x,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new c.Point(1,1)):this.screenBounds[1],x=c.polygonizeBounds(l,g,n),E=this.cameraPoint.clone();switch(3*((E.y>l.y)+(E.y>g.y))+((E.x>l.x)+(E.x>g.x))){case 0:x[0]=E,x[4]=E.clone();break;case 1:x.splice(1,0,E);break;case 2:x[1]=E;break;case 3:x.splice(4,0,E);break;case 5:x.splice(2,0,E);break;case 6:x[3]=E;break;case 7:x.splice(3,0,E);break;case 8:x[2]=E}return x}containsTile(n,l,g,x=0){const E=n.queryPadding/l._pixelsPerMercatorPixel+1,z=g?this._bufferedCameraMercator(E,l):this._bufferedScreenMercator(E,l);let k=n.tileID.wrap+(z.unwrapped?x:0);const B=z.polygon.map(de=>c.getTilePoint(n.tileTransform,de,k));if(!c.polygonIntersectsBox(B,0,0,c.EXTENT,c.EXTENT))return;k=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const q=this.screenGeometryMercator.polygon.map(de=>c.getTileVec3(n.tileTransform,de,k)),N=q.map(de=>new c.Point(de[0],de[1])),H=l.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),ne=c.getTileVec3(n.tileTransform,H,k),ce=q.map(de=>{const Y=c.sub(de,de,ne);return c.normalize(Y,Y),new c.Ray(ne,Y)}),fe=hn(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:ce,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(me=c.getBounds(B),me.min.x=c.clamp(me.min.x,0,c.EXTENT),me.min.y=c.clamp(me.min.y,0,c.EXTENT),me.max.x=c.clamp(me.max.x,0,c.EXTENT),me.max.y=c.clamp(me.max.y,0,c.EXTENT),me),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:fe};var me}_bufferedScreenMercator(n,l){const g=_a(n);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let x;return x=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map(E=>l.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(n,l){const g=_a(n);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let x;return x=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map(E=>l.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[g]=x,x}}_projectAndResample(n,l){const g=function(E,z){const k=c.multiply([],z.pixelMatrix,z.globeMatrix),B=[0,-c.GLOBE_RADIUS,0,1],q=[0,c.GLOBE_RADIUS,0,1],N=[0,0,0,1];c.transformMat4$1(B,B,k),c.transformMat4$1(q,q,k),c.transformMat4$1(N,N,k);const H=new c.Point(B[0]/B[3],B[1]/B[3]),ne=new c.Point(q[0]/q[3],q[1]/q[3]),ce=c.polygonContainsPoint(E,H)&&B[3]<N[3],fe=c.polygonContainsPoint(E,ne)&&q[3]<N[3];if(!ce&&!fe)return null;const me=function(je,Ke,$e){for(let ct=1;ct<je.length;ct++){const Bt=ma(Ke.pointCoordinate3D(je[ct-1]).x),nt=ma(Ke.pointCoordinate3D(je[ct]).x);if($e<0){if(Bt<nt)return{idx:ct,t:-Bt/(nt-1-Bt)}}else if(nt<Bt)return{idx:ct,t:(1-Bt)/(nt+1-Bt)}}return null}(E,z,ce?-1:1);if(!me)return null;const{idx:de,t:Y}=me;let ue=de>1?Gn(E.slice(0,de),z):[],we=de<E.length?Gn(E.slice(de),z):[];ue=ue.map(je=>new c.Point(ma(je.x),je.y)),we=we.map(je=>new c.Point(ma(je.x),je.y));const Ee=[...ue];Ee.length===0&&Ee.push(we[we.length-1]);const Fe=c.number(Ee[Ee.length-1].y,(we.length===0?ue[0]:we[0]).y,Y);let qe;return qe=ce?[new c.Point(0,Fe),new c.Point(0,0),new c.Point(1,0),new c.Point(1,Fe)]:[new c.Point(1,Fe),new c.Point(1,1),new c.Point(0,1),new c.Point(0,Fe)],Ee.push(...qe),we.length===0?Ee.push(ue[0]):Ee.push(...we),{polygon:Ee.map(je=>new c.MercatorCoordinate(je.x,je.y)),unwrapped:!1}}(n,l);if(g)return g;const x=function(E,z){let k=!1,B=-1/0,q=0;for(let H=0;H<E.length-1;H++)E[H].x>B&&(B=E[H].x,q=H);for(let H=0;H<E.length-1;H++){const ne=(q+H)%(E.length-1),ce=E[ne],fe=E[ne+1];Math.abs(ce.x-fe.x)>.5&&(ce.x<fe.x?(ce.x+=1,ne===0&&(E[E.length-1].x+=1)):(fe.x+=1,ne+1===E.length-1&&(E[0].x+=1)),k=!0)}const N=c.mercatorXfromLng(z.center.lng);return k&&N<Math.abs(N-1)&&E.forEach(H=>{H.x-=1}),{polygon:E,unwrapped:k}}(Gn(n,l).map(E=>new c.Point(ma(E.x),E.y)),l);return{polygon:x.polygon.map(E=>new c.MercatorCoordinate(E.x,E.y)),unwrapped:x.unwrapped}}}function Gn(m,n){return c.resample(m,l=>{const g=n.pointCoordinate3D(l);l.x=g.x,l.y=g.y},1/256)}function ma(m){return m<0?1+m%1:m%1}function _a(m){return 100*m|0}function pn(m,n,l,g,x){const E=function(z,k){if(z)return x(z);if(k){m.url&&k.tiles&&m.tiles&&delete m.tiles;const B=c.pick(c.extend(k,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(B.vectorLayers=k.vector_layers,B.vectorLayerIds=B.vectorLayers.map(q=>q.id)),B.tiles=n.canonicalizeTileset(B,m.url),x(null,B)}};return m.url?c.getJSON(n.transformRequest(n.normalizeSourceURL(m.url,null,l,g),c.ResourceType.Source),E):c.exported.frame(()=>E(null,m))}class ga{constructor(n,l,g){this.bounds=c.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=g||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),g=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*l),x=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*l),E=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*l),z=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*l);return n.x>=g&&n.x<E&&n.y>=x&&n.y<z}}class ps{constructor(n,l,g){this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ya{constructor(n,l,g,x){this.length=l.length,this.attributes=g,this.itemSize=l.bytesPerElement,this.dynamicDraw=x,this.context=n;const E=n.gl;this.buffer=E.createBuffer(),n.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let g=0;g<this.attributes.length;g++){const x=l.attributes[this.attributes[g].name];x!==void 0&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,l,g){for(let x=0;x<this.attributes.length;x++){const E=this.attributes[x],z=l.attributes[E.name];z!==void 0&&n.vertexAttribPointer(z,E.components,n[Fn[E.type]],!1,this.itemSize,E.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class cr{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class On extends cr{getDefault(){return c.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ui extends cr{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Ps extends cr{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Hr extends cr{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class vn extends cr{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ma extends cr{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class va extends cr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class ko extends cr{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class na extends cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class Co extends cr{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Na extends cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class xa extends cr{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class ks extends cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class ql extends cr{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Gl extends cr{getDefault(){return c.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class zo extends cr{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Ca extends cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class ds extends cr{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class fs extends cr{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Ds,ja=class extends cr{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Ls extends cr{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class qa extends cr{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Do extends cr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class ms extends cr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Rs extends cr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class yl extends cr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Ce extends cr{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class te extends cr{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class re extends cr{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Ie extends cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class De extends cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ze extends cr{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class tt extends Ze{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Qe extends Ze{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ge extends Qe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class pt{constructor(n,l,g,x){this.context=n,this.width=l,this.height=g;const E=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new tt(n,E),x&&(this.depthAttachment=new Qe(n,E))}destroy(){const n=this.context.gl,l=this.colorAttachment.get();if(l&&n.deleteTexture(l),this.depthAttachment){const g=this.depthAttachment.get();g&&n.deleteRenderbuffer(g)}n.deleteFramebuffer(this.framebuffer)}}class vt{constructor(n,l=!1){if(this.gl=n,this.isWebGL2=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),l){const g=n;this.extVertexArrayObject={createVertexArrayOES:g.createVertexArray.bind(n),deleteVertexArrayOES:g.deleteVertexArray.bind(n),bindVertexArrayOES:g.bindVertexArray.bind(n)}}this.clearColor=new On(this),this.clearDepth=new Ui(this),this.clearStencil=new Ps(this),this.colorMask=new Hr(this),this.depthMask=new vn(this),this.stencilMask=new Ma(this),this.stencilFunc=new va(this),this.stencilOp=new ko(this),this.stencilTest=new na(this),this.depthRange=new Co(this),this.depthTest=new Na(this),this.depthFunc=new xa(this),this.blend=new ks(this),this.blendFunc=new ql(this),this.blendColor=new Gl(this),this.blendEquation=new zo(this),this.cullFace=new Ca(this),this.cullFaceSide=new ds(this),this.frontFace=new fs(this),this.program=new ja(this),this.activeTexture=new Ls(this),this.viewport=new qa(this),this.bindFramebuffer=new Do(this),this.bindRenderbuffer=new ms(this),this.bindTexture=new Rs(this),this.bindVertexBuffer=new yl(this),this.bindElementBuffer=new Ce(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new te(this),this.pixelStoreUnpack=new re(this),this.pixelStoreUnpackPremultiplyAlpha=new Ie(this),this.pixelStoreUnpackFlipY=new De(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),l||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(l||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l){return new ps(this,n,l)}createVertexBuffer(n,l,g){return new ya(this,n,l,g)}createRenderbuffer(n,l,g){const x=this.gl,E=x.createRenderbuffer();return this.bindRenderbuffer.set(E),x.renderbufferStorage(x.RENDERBUFFER,n,l,g),this.bindRenderbuffer.set(null),E}createFramebuffer(n,l,g){return new pt(this,n,l,g)}clear({color:n,depth:l,stencil:g}){const x=this.gl;let E=0;n&&(E|=x.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(E|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),g!==void 0&&(E|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(E)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){st(n.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Pt extends c.Evented{constructor(n,l,g,x){if(super(),this.id=n,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(l,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(n){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=pn(this._options,this.map._requestManager,l,g,(x,E)=>{this._tileJSONRequest=null,this._loaded=!0,x?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new c.ErrorEvent(x))):E&&(c.extend(this,E),E.bounds&&(this.tileBounds=new ga(E.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(x)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}loadTile(n,l){const g=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(g,c.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=l:n.request=n.actor.send("reloadTile",x,E.bind(this));else if(n.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",x,E.bind(this),void 0,!0);else{const z=c.loadVectorTile.call({deduped:this._deduped},x,(k,B)=>{k||!B?E.call(this,k):(x.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},n.actor&&n.actor.send("loadTile",x,E.bind(this),void 0,!0))},!0);n.request={cancel:z}}function E(z,k){return delete n.request,n.aborted?l(null):z&&z.status!==404?l(z):(k&&k.resourceTiming&&(n.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&n.setExpiryData(k),n.loadVectorData(k,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Et extends c.Evented{constructor(n,l,g,x){super(),this.id=n,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},l),c.extend(this,c.pick(l,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pn(this._options,this.map._requestManager,null,null,(l,g)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new c.ErrorEvent(l)):g&&(c.extend(this,g),g.bounds&&(this.tileBounds=new ga(g.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(g.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(l)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const g=c.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);n.request=c.getImage(this.map._requestManager.transformRequest(x,c.ResourceType.Tile),(E,z,k,B)=>(delete n.request,n.aborted?(n.state="unloaded",l(null)):E?(n.state="errored",l(E)):z?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:k,expires:B}),n.setTexture(z,this.map.painter),n.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(n,l,g){n.setTexture(l,g)}static unloadTileData(n,l){n.texture&&l.saveTileTexture(n.texture)}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l()}unloadTile(n,l){n.texture&&this.map.painter.saveTileTexture(n.texture),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function mi(m,n,l,g,x,E,z,k){const B=[m,l,x,n,g,E,1,1,1],q=[z,k,1],N=c.adjoint([],B),[H,ne,ce]=c.transformMat3(q,q,c.transpose(N,N));return c.multiply$1(B,[H,0,0,0,ne,0,0,0,ce],B)}class Li extends c.Evented{constructor(n,l,g,x){super(),this.id=n,this.dispatcher=g,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=l,this._dirty=!1}load(n,l){this._loaded=l||!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(g,x)=>{if(this._imageRequest=null,this._loaded=!0,g)this.fire(new c.ErrorEvent(g));else if(x){const{HTMLImageElement:E}=c.window;this.image=x instanceof E?c.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const l=n.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let x=1/0,E=1/0,z=-1/0,k=-1/0;for(const H of g)x=Math.min(x,H.x),E=Math.min(E,H.y),z=Math.max(z,H.x),k=Math.max(k,H.y);const B=Math.max(z-x,k-E),q=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),N=Math.pow(2,q);return new c.CanonicalTileID(q,Math.floor((x+z)/2*N),Math.floor((E+k)/2*N))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const B in this.tiles){const q=this.tiles[B];q.state!=="loaded"&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray)return;const l=c.tileTransform(this.tileID,this.map.transform.projection),[g,x,E,z]=this.coordinates.map(B=>{const q=l.projection.project(B[0],B[1]);return c.getTilePoint(l,q)._round()});this.perspectiveTransform=function(B,q,N,H,ne,ce,fe,me,de,Y){const ue=mi(0,0,B,0,0,q,B,q),we=mi(N,H,ne,ce,fe,me,de,Y);return c.multiply$1(we,c.adjoint(ue,ue),we),[we[6]/we[8]*B/c.EXTENT,we[7]/we[8]*q/c.EXTENT]}(this.width,this.height,g.x,g.y,x.x,x.y,z.x,z.y,E.x,E.y);const k=this._boundsArray=new c.StructArrayLayout4i8;k.emplaceBack(g.x,g.y,0,0),k.emplaceBack(x.x,x.y,c.EXTENT,0),k.emplaceBack(z.x,z.y,0,c.EXTENT),k.emplaceBack(E.x,E.y,c.EXTENT,c.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(k,c.boundsAttributes.members),this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,l=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new c.Texture(n,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,l){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},l(null)):(n.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const li={vector:Pt,raster:Et,"raster-dem":class extends Et{constructor(m,n,l,g){super(m,n,l,g),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(m,n){const l=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,E){x&&(m.state="errored",n(x)),E&&(m.dem=E,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",n(null))}m.request=c.getImage(this.map._requestManager.transformRequest(l,c.ResourceType.Tile),(function(x,E,z,k){if(delete m.request,m.aborted)m.state="unloaded",n(null);else if(x)m.state="errored",n(x);else if(E){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:z,expires:k});const B=c.window.ImageBitmap&&E instanceof c.window.ImageBitmap&&(Ds==null&&(Ds=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&typeof c.window.createImageBitmap=="function"),Ds),q=1-(E.width-c.prevPowerOfTwo(E.width))/2;q<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const N=B?E:c.exported.getImageData(E,q),H={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:N,encoding:this.encoding,padding:q};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",H,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const n=m.canonical,l=Math.pow(2,n.z),g=(n.x-1+l)%l,x=n.x===0?m.wrap-1:m.wrap,E=(n.x+1+l)%l,z=n.x+1===l?m.wrap+1:m.wrap,k={};return k[new c.OverscaledTileID(m.overscaledZ,x,n.z,g,n.y).key]={backfilled:!1},k[new c.OverscaledTileID(m.overscaledZ,z,n.z,E,n.y).key]={backfilled:!1},n.y>0&&(k[new c.OverscaledTileID(m.overscaledZ,x,n.z,g,n.y-1).key]={backfilled:!1},k[new c.OverscaledTileID(m.overscaledZ,m.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},k[new c.OverscaledTileID(m.overscaledZ,z,n.z,E,n.y-1).key]={backfilled:!1}),n.y+1<l&&(k[new c.OverscaledTileID(m.overscaledZ,x,n.z,g,n.y+1).key]={backfilled:!1},k[new c.OverscaledTileID(m.overscaledZ,m.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},k[new c.OverscaledTileID(m.overscaledZ,z,n.z,E,n.y+1).key]={backfilled:!1}),k}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends c.Evented{constructor(m,n,l,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(g),this._data=n.data,this._options=c.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*x,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*x,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},n),this}getClusterChildren(m,n){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},n),this}getClusterLeaves(m,n,l,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:n,offset:l},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=c.extend({},this.workerOptions),n=this._data;typeof n=="string"?(m.request=this.map._requestManager.transformRequest(c.exported.resolveURL(n),c.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(l,g)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new c.ErrorEvent(l));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x.resourceTiming=g.resourceTiming[this.id]),this.fire(new c.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,n){const l=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(l,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,x)=>(delete m.request,m.unloadVectorData(),m.aborted?n(null):g?n(g):(m.loadVectorData(x,this.map.painter,l==="reloadTile"),n(null))),void 0,l==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Li{constructor(m,n,l,g){super(m,n,l,g),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const n of m.urls)this.urls.push(this.map._requestManager.transformRequest(n,c.ResourceType.Source).url);c.getVideo(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new c.ErrorEvent(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const n=this.video.seekable;m<n.start(0)||m>n.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,n=m.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(m,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Li,canvas:class extends Li{constructor(m,n,l,g){super(m,n,l,g),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(E=>typeof E!="number"))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends c.Evented{constructor(m,n,l,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ga(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),c.extend(this,c.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:n,y:l,z:g}=m.canonical;return this._implementation.hasTile({x:n,y:l,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,n){const{x:l,y:g,z:x}=m.tileID.canonical,E=new c.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:l,y:g,z:x},{signal:E.signal})).then((function(z){return delete m.request,m.aborted?(m.state="unloaded",n(null)):z===void 0?(m.state="errored",n(null)):z===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",n(null)):function(k){return k instanceof c.window.ImageData||k instanceof c.window.HTMLCanvasElement||k instanceof c.window.ImageBitmap||k instanceof c.window.HTMLImageElement}(z)?(this.loadTileData(m,z),m.state="loaded",void n(null)):(m.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(z=>{z.code!==20&&(m.state="errored",n(z))}),m.request.cancel=()=>E.abort()}loadTileData(m,n){Et.loadTileData(m,n,this._map.painter)}unloadTileData(m){Et.unloadTileData(m,this._map.painter)}unloadTile(m,n){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:l,y:g,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:l,y:g,z:x})}n()}abortTile(m,n){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}}},V=function(m,n,l,g){const x=new li[n.type](m,n,l,g);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],x),x};function X(m,n){const l=c.identity([]);return c.scale(l,l,[.5*m.width,.5*-m.height,1]),c.translate(l,l,[1,-1,0]),c.multiply(l,l,m.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(l)}function ee(m,n,l,g,x,E,z,k=!1){const B=m.tilesIn(g,z,k);B.sort(xe);const q=[];for(const H of B)q.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(n,l,m._state,H,x,E,X(m.transform,H.tile.tileID),k)});const N=function(H){const ne={},ce={};for(const fe of H){const me=fe.queryResults,de=fe.wrappedTileID,Y=ce[de]=ce[de]||{};for(const ue in me){const we=me[ue],Ee=Y[ue]=Y[ue]||{},Fe=ne[ue]=ne[ue]||[];for(const qe of we)Ee[qe.featureIndex]||(Ee[qe.featureIndex]=!0,Fe.push(qe))}}return ne}(q);for(const H in N)N[H].forEach(ne=>{const ce=ne.feature,fe=ce.layer;fe&&fe.type!=="background"&&fe.type!=="sky"&&(ce.source=fe.source,fe["source-layer"]&&(ce.sourceLayer=fe["source-layer"]),ce.state=ce.id!==void 0?m.getFeatureState(fe["source-layer"],ce.id):{})});return N}function pe(m,n){const l=m.getRenderableIds().map(E=>m.getTileByID(E)),g=[],x={};for(let E=0;E<l.length;E++){const z=l[E],k=z.tileID.canonical.key;x[k]||(x[k]=!0,z.querySourceFeatures(g,n))}return g}function xe(m,n){const l=m.tileID,g=n.tileID;return l.overscaledZ-g.overscaledZ||l.canonical.y-g.canonical.y||l.wrap-g.wrap||l.canonical.x-g.canonical.x}function Be(){return Fa.workerClass!=null?new Fa.workerClass:new c.window.Worker(Fa.workerUrl)}const Xe="mapboxgl_preloaded_worker_pool";class Re{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Re.workerCount;)this.workers.push(new Be);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xe]}numActive(){return Object.keys(this.active).length}}let Le;function Ae(){return Le||(Le=new Re),Le}function ft(m,n){const l={};for(const g in m)g!=="ref"&&(l[g]=m[g]);return c.refProperties.forEach(g=>{g in n&&(l[g]=n[g])}),l}function _t(m){m=m.slice();const n=Object.create(null);for(let l=0;l<m.length;l++)n[m[l].id]=m[l];for(let l=0;l<m.length;l++)"ref"in m[l]&&(m[l]=ft(m[l],n[m[l].ref]));return m}Re.workerCount=2;const rt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Wt(m,n,l){l.push({command:rt.addSource,args:[m,n[m]]})}function Zt(m,n,l){n.push({command:rt.removeSource,args:[m]}),l[m]=!0}function yi(m,n,l,g){Zt(m,l,g),Wt(m,n,l)}function _i(m,n,l){let g;for(g in m[l])if(m[l].hasOwnProperty(g)&&g!=="data"&&!st(m[l][g],n[l][g]))return!1;for(g in n[l])if(n[l].hasOwnProperty(g)&&g!=="data"&&!st(m[l][g],n[l][g]))return!1;return!0}function ri(m,n,l,g,x,E){let z;for(z in n=n||{},m=m||{})m.hasOwnProperty(z)&&(st(m[z],n[z])||l.push({command:E,args:[g,z,n[z],x]}));for(z in n)n.hasOwnProperty(z)&&!m.hasOwnProperty(z)&&(st(m[z],n[z])||l.push({command:E,args:[g,z,n[z],x]}))}function Ti(m){return m.id}function zi(m,n){return m[n.id]=n,m}class Ji{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=c.clamp(n,0,1);let l=1,g=this._distances[l];const x=n*this.paddedLength+this.padding;for(;g<x&&l<this._distances.length;)g=this._distances[++l];const E=l-1,z=this._distances[E],k=g-z,B=k>0?(x-z)/k:0;return this.points[E].mult(1-B).add(this.points[l].mult(B))}}class ir{constructor(n,l,g){const x=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(n/g),this.yCellCount=Math.ceil(l/g);for(let z=0;z<this.xCellCount*this.yCellCount;z++)x.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,g,x,E){this._forEachCell(l,g,x,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(E)}insertCircle(n,l,g,x){this._forEachCell(l-x,g-x,l+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(g),this.circles.push(x)}_insertBoxCell(n,l,g,x,E,z){this.boxCells[E].push(z)}_insertCircleCell(n,l,g,x,E,z){this.circleCells[E].push(z)}_query(n,l,g,x,E,z){if(g<0||n>this.width||x<0||l>this.height)return!E&&[];const k=[];if(n<=0&&l<=0&&this.width<=g&&this.height<=x){if(E)return!0;for(let B=0;B<this.boxKeys.length;B++)k.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const q=this.circles[3*B],N=this.circles[3*B+1],H=this.circles[3*B+2];k.push({key:this.circleKeys[B],x1:q-H,y1:N-H,x2:q+H,y2:N+H})}return z?k.filter(z):k}return this._forEachCell(n,l,g,x,this._queryCell,k,{hitTest:E,seenUids:{box:{},circle:{}}},z),E?k.length>0:k}_queryCircle(n,l,g,x,E){const z=n-g,k=n+g,B=l-g,q=l+g;if(k<0||z>this.width||q<0||B>this.height)return!x&&[];const N=[];return this._forEachCell(z,B,k,q,this._queryCellCircle,N,{hitTest:x,circle:{x:n,y:l,radius:g},seenUids:{box:{},circle:{}}},E),x?N.length>0:N}query(n,l,g,x,E){return this._query(n,l,g,x,!1,E)}hitTest(n,l,g,x,E){return this._query(n,l,g,x,!0,E)}hitTestCircle(n,l,g,x){return this._queryCircle(n,l,g,!0,x)}_queryCell(n,l,g,x,E,z,k,B){const q=k.seenUids,N=this.boxCells[E];if(N!==null){const ne=this.bboxes;for(const ce of N)if(!q.box[ce]){q.box[ce]=!0;const fe=4*ce;if(n<=ne[fe+2]&&l<=ne[fe+3]&&g>=ne[fe+0]&&x>=ne[fe+1]&&(!B||B(this.boxKeys[ce]))){if(k.hitTest)return z.push(!0),!0;z.push({key:this.boxKeys[ce],x1:ne[fe],y1:ne[fe+1],x2:ne[fe+2],y2:ne[fe+3]})}}}const H=this.circleCells[E];if(H!==null){const ne=this.circles;for(const ce of H)if(!q.circle[ce]){q.circle[ce]=!0;const fe=3*ce;if(this._circleAndRectCollide(ne[fe],ne[fe+1],ne[fe+2],n,l,g,x)&&(!B||B(this.circleKeys[ce]))){if(k.hitTest)return z.push(!0),!0;{const me=ne[fe],de=ne[fe+1],Y=ne[fe+2];z.push({key:this.circleKeys[ce],x1:me-Y,y1:de-Y,x2:me+Y,y2:de+Y})}}}}}_queryCellCircle(n,l,g,x,E,z,k,B){const q=k.circle,N=k.seenUids,H=this.boxCells[E];if(H!==null){const ce=this.bboxes;for(const fe of H)if(!N.box[fe]){N.box[fe]=!0;const me=4*fe;if(this._circleAndRectCollide(q.x,q.y,q.radius,ce[me+0],ce[me+1],ce[me+2],ce[me+3])&&(!B||B(this.boxKeys[fe])))return z.push(!0),!0}}const ne=this.circleCells[E];if(ne!==null){const ce=this.circles;for(const fe of ne)if(!N.circle[fe]){N.circle[fe]=!0;const me=3*fe;if(this._circlesCollide(ce[me],ce[me+1],ce[me+2],q.x,q.y,q.radius)&&(!B||B(this.circleKeys[fe])))return z.push(!0),!0}}}_forEachCell(n,l,g,x,E,z,k,B){const q=this._convertToXCellCoord(n),N=this._convertToYCellCoord(l),H=this._convertToXCellCoord(g),ne=this._convertToYCellCoord(x);for(let ce=q;ce<=H;ce++)for(let fe=N;fe<=ne;fe++)if(E.call(this,n,l,g,x,this.xCellCount*fe+ce,z,k,B))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,g,x,E,z){const k=x-n,B=E-l,q=g+z;return q*q>k*k+B*B}_circleAndRectCollide(n,l,g,x,E,z,k){const B=(z-x)/2,q=Math.abs(n-(x+B));if(q>B+g)return!1;const N=(k-E)/2,H=Math.abs(l-(E+N));if(H>N+g)return!1;if(q<=B||H<=N)return!0;const ne=q-B,ce=H-N;return ne*ne+ce*ce<=g*g}}const zr={unknown:0,flipRequired:1,flipNotRequired:2},Ei=Math.tan(85*Math.PI/180);function lt(m,n,l,g,x,E,z){const k=c.create();if(l)if(E.name==="globe"){const B=c.calculateGlobeLabelMatrix(x,n);c.multiply(k,k,B)}else{const B=Xt([],z);k[0]=B[0],k[1]=B[1],k[4]=B[2],k[5]=B[3],g||c.rotateZ(k,k,x.angle)}else c.multiply(k,x.labelPlaneMatrix,m);return k}function dn(m,n,l,g,x,E,z){const k=lt(m,n,l,g,x,E,z);return E.name==="globe"&&l||(k[2]=k[6]=k[10]=k[14]=0),k}function Qi(m,n,l,g,x,E,z){if(l){if(E.name==="globe"){const k=lt(m,n,l,g,x,E,z);return c.invert(k,k),c.multiply(k,m,k),k}{const k=c.clone(m),B=c.identity([]);return B[0]=z[0],B[1]=z[1],B[4]=z[2],B[5]=z[3],c.multiply(k,k,B),g||c.rotateZ(k,k,-x.angle),k}}return x.glCoordMatrix}function _r(m,n,l,g){const x=[m,n,l,1];l?c.transformMat4$1(x,x,g):Xi(x,x,g);const E=x[3];return x[0]/=E,x[1]/=E,x[2]/=E,x}function ba(m,n){return Math.min(.5+m/n*.5,1.5)}function dr(m,n){const l=m[0]/m[3],g=m[1]/m[3];return l>=-n[0]&&l<=n[0]&&g>=-n[1]&&g<=n[1]}function Kr(m,n,l,g,x,E,z,k,B,q){const N=l.transform,H=g?m.textSizeData:m.iconSizeData,ne=c.evaluateSizeForZoom(H,l.transform.zoom),ce=N.projection.name==="globe",fe=[256/l.width*2+1,256/l.height*2+1],me=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;me.clear();let de=null;ce&&(de=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const Y=m.lineVertexArray,ue=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,we=l.transform.width/l.transform.height;let Ee,Fe=!1;for(let qe=0;qe<ue.length;qe++){const je=ue.get(qe),{numGlyphs:Ke,writingMode:$e}=je;if($e!==c.WritingMode.vertical||Fe||Ee===c.WritingMode.horizontal||(Fe=!0),Ee=$e,(je.hidden||$e===c.WritingMode.vertical)&&!Fe){_s(Ke,me);continue}Fe=!1;const ct=new c.Point(je.tileAnchorX,je.tileAnchorY);let{x:Bt,y:nt,z:Tt}=N.projection.projectTilePoint(ct.x,ct.y,q.canonical);if(B){const[Ai,ui,Fi]=B(ct);Bt+=Ai,nt+=ui,Tt+=Fi}const dt=[Bt,nt,Tt,1];if(c.transformMat4$1(dt,dt,n),!dr(dt,fe)){_s(Ke,me);continue}const kt=ba(l.transform.cameraToCenterDistance,dt[3]),ut=c.evaluateSizeForFeature(H,ne,je),xt=z?ut/kt:ut*kt,Lt=_r(Bt,nt,Tt,x);if(Lt[3]<=0){_s(Ke,me);continue}let Mt={};const Ut=z?null:B,Si=Rt(je,xt,!1,k,n,x,E,m.glyphOffsetArray,Y,me,de,Lt,ct,Mt,we,Ut,N.projection,q,z);Fe=Si.useVertical,Ut&&Si.needsFlipping&&(Mt={}),(Si.notEnoughRoom||Fe||Si.needsFlipping&&Rt(je,xt,!0,k,n,x,E,m.glyphOffsetArray,Y,me,de,Lt,ct,Mt,we,Ut,N.projection,q,z).notEnoughRoom)&&_s(Ke,me)}g?(m.text.dynamicLayoutVertexBuffer.updateData(me),de&&m.text.globeExtVertexBuffer.updateData(de)):(m.icon.dynamicLayoutVertexBuffer.updateData(me),de&&m.icon.globeExtVertexBuffer.updateData(de))}function Or(m,n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe,me){const{lineStartIndex:de,glyphStartIndex:Y,segment:ue}=k,we=Y+k.numGlyphs,Ee=de+k.lineLength,Fe=n.getoffsetX(Y),qe=n.getoffsetX(we-1),je=io(m*Fe,l,g,x,E,z,ue,de,Ee,B,q,N,H,ne,!0,ce,fe,me);if(!je)return null;const Ke=io(m*qe,l,g,x,E,z,ue,de,Ee,B,q,N,H,ne,!0,ce,fe,me);return Ke?{first:je,last:Ke}:null}function Un(m,n,l,g){return m===c.WritingMode.horizontal&&Math.abs(g)>Math.abs(l)?{useVertical:!0}:m===c.WritingMode.vertical?g>0?{needsFlipping:!0}:null:n!==zr.unknown&&function(x,E){return x===0||Math.abs(E/x)>Ei}(l,g)?n===zr.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Rt(m,n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe,me,de,Y,ue){const we=n/24,Ee=m.lineOffsetX*we,Fe=m.lineOffsetY*we,{lineStartIndex:qe,glyphStartIndex:je,numGlyphs:Ke,segment:$e,writingMode:ct,flipState:Bt}=m,nt=qe+m.lineLength,Tt=dt=>{if(N){const[Lt,Mt,Ut]=dt.up,Si=q.length;c.updateGlobeVertexNormal(N,Si+0,Lt,Mt,Ut),c.updateGlobeVertexNormal(N,Si+1,Lt,Mt,Ut),c.updateGlobeVertexNormal(N,Si+2,Lt,Mt,Ut),c.updateGlobeVertexNormal(N,Si+3,Lt,Mt,Ut)}const[kt,ut,xt]=dt.point;c.addDynamicAttributes(q,kt,ut,xt,dt.angle)};if(Ke>1){const dt=Or(we,k,Ee,Fe,l,H,ne,m,B,E,ce,me,!1,de,Y,ue);if(!dt)return{notEnoughRoom:!0};if(g&&!l){let[kt,ut,xt]=dt.first.point,[Lt,Mt,Ut]=dt.last.point;[kt,ut]=_r(kt,ut,xt,z),[Lt,Mt]=_r(Lt,Mt,Ut,z);const Si=Un(ct,Bt,(Lt-kt)*fe,Mt-ut);if(m.flipState=Si&&Si.needsFlipping?zr.flipRequired:zr.flipNotRequired,Si)return Si}Tt(dt.first);for(let kt=je+1;kt<je+Ke-1;kt++){const ut=io(we*k.getoffsetX(kt),Ee,Fe,l,H,ne,$e,qe,nt,B,E,ce,me,!1,!1,de,Y,ue);if(!ut)return q.length-=4*(kt-je),{notEnoughRoom:!0};Tt(ut)}Tt(dt.last)}else{if(g&&!l){const kt=_r(ne.x,ne.y,0,x),ut=qe+$e+1,xt=new c.Point(B.getx(ut),B.gety(ut)),Lt=_r(xt.x,xt.y,0,x),Mt=Lt[3]>0?Lt:qi(ne,xt,kt,1,x,void 0,de,Y.canonical),Ut=Un(ct,Bt,(Mt[0]-kt[0])*fe,Mt[1]-kt[1]);if(m.flipState=Ut&&Ut.needsFlipping?zr.flipRequired:zr.flipNotRequired,Ut)return Ut}const dt=io(we*k.getoffsetX(je),Ee,Fe,l,H,ne,$e,qe,nt,B,E,ce,me,!1,!1,de,Y,ue);if(!dt)return{notEnoughRoom:!0};Tt(dt)}return{}}function Bi(m,n,l,g,x){const{x:E,y:z,z:k}=g.projectTilePoint(m.x,m.y,n);if(!x)return _r(E,z,k,l);const[B,q,N]=x(m);return _r(E+B,z+q,k+N,l)}function qi(m,n,l,g,x,E,z,k){const B=Bi(m.sub(n)._unit()._add(m),k,x,z,E);return c.sub(B,l,B),c.normalize(B,B),c.scaleAndAdd(B,l,B,g)}function io(m,n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe,me,de,Y){const ue=g?m-n:m+n;let we=ue>0?1:-1,Ee=0;g&&(we*=-1,Ee=Math.PI),we<0&&(Ee+=Math.PI);let Fe=k+z+(we>0?0:1)|0,qe=x,je=x,Ke=0,$e=0;const ct=Math.abs(ue),Bt=[],nt=[];let Tt=E,dt=Tt;const kt=()=>qi(dt,Tt,je,ct-Ke+1,N,ne,me,de.canonical);for(;Ke+$e<=ct;){if(Fe+=we,Fe<k||Fe>=B)return null;if(je=qe,dt=Tt,Bt.push(je),ce&&nt.push(dt),Tt=new c.Point(q.getx(Fe),q.gety(Fe)),qe=H[Fe],!qe){const Fi=Bi(Tt,de.canonical,N,me,ne);qe=Fi[3]>0?H[Fe]=Fi:kt()}Ke+=$e,$e=c.distance(je,qe)}fe&&ne&&(H[Fe]&&(qe=kt(),$e=c.distance(je,qe)),H[Fe]=qe);const ut=(ct-Ke)/$e,xt=Tt.sub(dt)._mult(ut)._add(dt),Lt=c.sub([],qe,je),Mt=c.scaleAndAdd([],je,Lt,ut);let Ut=[0,0,1],Si=Lt[0],Ai=Lt[1];if(Y&&(Ut=me.upVector(de.canonical,xt.x,xt.y),Ut[0]!==0||Ut[1]!==0||Ut[2]!==1)){const Fi=[Ut[2],0,-Ut[0]],ur=c.cross([],Ut,Fi);c.normalize(Fi,Fi),c.normalize(ur,ur),Si=c.dot(Lt,Fi),Ai=c.dot(Lt,ur)}if(l){const Fi=c.cross([],Ut,Lt);c.normalize(Fi,Fi),c.scaleAndAdd(Mt,Mt,Fi,l*we)}const ui=Ee+Math.atan2(Ai,Si);return Bt.push(Mt),ce&&nt.push(xt),{point:Mt,angle:ui,path:Bt,tilePath:nt,up:Ut}}function _s(m,n){const l=n.length,g=l+4*m;n.resize(g),n.float32.fill(-1/0,4*l,4*g)}function Xi(m,n,l){const g=n[0],x=n[1];return m[0]=l[0]*g+l[4]*x+l[12],m[1]=l[1]*g+l[5]*x+l[13],m[3]=l[3]*g+l[7]*x+l[15],m}const wa=100;class Ga{constructor(n,l,g=new ir(n.width+200,n.height+200,25),x=new ir(n.width+200,n.height+200,25)){this.transform=n,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+wa,this.screenBottomBoundary=n.height+wa,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,g,x,E,z,k,B){let q=g.projectedAnchorX,N=g.projectedAnchorY,H=g.projectedAnchorZ;const ne=g.elevation,ce=g.tileID,fe=n.getProjection();if(ne&&ce){const[qe,je,Ke]=fe.upVector(ce.canonical,g.tileAnchorX,g.tileAnchorY),$e=fe.upVectorScale(ce.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;q+=qe*ne*$e,N+=je*ne*$e,H+=Ke*ne*$e}const me=this.projectAndGetPerspectiveRatio(k,q,N,H,g.tileID,fe.name==="globe"||!!ne||this.transform.pitch>0,fe),de=z*me.perspectiveRatio,Y=(g.x1*l+x.x-g.padding)*de+me.point.x,ue=(g.y1*l+x.y-g.padding)*de+me.point.y,we=(g.x2*l+x.x+g.padding)*de+me.point.x,Ee=(g.y2*l+x.y+g.padding)*de+me.point.y,Fe=me.perspectiveRatio<=.55||me.occluded;return!this.isInsideGrid(Y,ue,we,Ee)||!E&&this.grid.hitTest(Y,ue,we,Ee,B)||Fe?{box:[],offscreen:!1,occluded:me.occluded}:{box:[Y,ue,we,Ee],offscreen:this.isOffscreen(Y,ue,we,Ee),occluded:!1}}placeCollisionCircles(n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe,me){const de=[],Y=this.transform.elevation,ue=n.getProjection(),we=Y?Y.getAtTileOffsetFunc(me,this.transform.center.lat,this.transform.worldSize,ue):null,Ee=new c.Point(g.tileAnchorX,g.tileAnchorY);let{x:Fe,y:qe,z:je}=ue.projectTilePoint(Ee.x,Ee.y,me.canonical);if(we){const[xt,Lt,Mt]=we(Ee);Fe+=xt,qe+=Lt,je+=Mt}const Ke=ue.name==="globe",$e=this.projectAndGetPerspectiveRatio(k,Fe,qe,je,me,Ke||!!Y||this.transform.pitch>0,ue),{perspectiveRatio:ct}=$e,Bt=(H?z/ct:z*ct)/c.ONE_EM,nt=_r(Fe,qe,je,B),Tt=$e.signedDistanceFromCamera>0?Or(Bt,E,g.lineOffsetX*Bt,g.lineOffsetY*Bt,!1,nt,Ee,g,x,B,{},Y&&!H?we:null,H&&!!Y,ue,me,H):null;let dt=!1,kt=!1,ut=!0;if(Tt&&!$e.occluded){const xt=.5*ce*ct+fe,Lt=new c.Point(-100,-100),Mt=new c.Point(this.screenRightBoundary,this.screenBottomBoundary),Ut=new Ji,{first:Si,last:Ai}=Tt,ui=Si.path.length;let Fi=[];for(let wi=ui-1;wi>=1;wi--)Fi.push(Si.path[wi]);for(let wi=1;wi<Ai.path.length;wi++)Fi.push(Ai.path[wi]);const ur=2.5*xt;q&&(Fi=Fi.map(([wi,Gr,sn],nn)=>(we&&!Ke&&(sn=we(nn<ui-1?Si.tilePath[ui-1-nn]:Ai.tilePath[nn-ui+2])[2]),_r(wi,Gr,sn,q))),Fi.some(wi=>wi[3]<=0)&&(Fi=[]));let yr=[];if(Fi.length>0){let wi=1/0,Gr=-1/0,sn=1/0,nn=-1/0;for(const ln of Fi)wi=Math.min(wi,ln[0]),sn=Math.min(sn,ln[1]),Gr=Math.max(Gr,ln[0]),nn=Math.max(nn,ln[1]);Gr>=Lt.x&&wi<=Mt.x&&nn>=Lt.y&&sn<=Mt.y&&(yr=[Fi.map(ln=>new c.Point(ln[0],ln[1]))],(wi<Lt.x||Gr>Mt.x||sn<Lt.y||nn>Mt.y)&&(yr=c.clipLine(yr,Lt.x,Lt.y,Mt.x,Mt.y)))}for(const wi of yr){Ut.reset(wi,.25*xt);let Gr=0;Gr=Ut.length<=.5*xt?1:Math.ceil(Ut.paddedLength/ur)+1;for(let sn=0;sn<Gr;sn++){const nn=sn/Math.max(Gr-1,1),ln=Ut.lerp(nn),Jo=ln.x+wa,Hn=ln.y+wa;de.push(Jo,Hn,xt,0);const zn=Jo-xt,Dl=Hn-xt,Pn=Jo+xt,fn=Hn+xt;if(ut=ut&&this.isOffscreen(zn,Dl,Pn,fn),kt=kt||this.isInsideGrid(zn,Dl,Pn,fn),!l&&this.grid.hitTestCircle(Jo,Hn,xt,ne)&&(dt=!0,!N))return{circles:[],offscreen:!1,collisionDetected:dt,occluded:!1}}}}return{circles:!N&&dt||!kt?[]:de,offscreen:ut,collisionDetected:dt,occluded:$e.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let g=1/0,x=1/0,E=-1/0,z=-1/0;for(const N of n){const H=new c.Point(N.x+wa,N.y+wa);g=Math.min(g,H.x),x=Math.min(x,H.y),E=Math.max(E,H.x),z=Math.max(z,H.y),l.push(H)}const k=this.grid.query(g,x,E,z).concat(this.ignoredGrid.query(g,x,E,z)),B={},q={};for(const N of k){const H=N.key;if(B[H.bucketInstanceId]===void 0&&(B[H.bucketInstanceId]={}),B[H.bucketInstanceId][H.featureIndex])continue;const ne=[new c.Point(N.x1,N.y1),new c.Point(N.x2,N.y1),new c.Point(N.x2,N.y2),new c.Point(N.x1,N.y2)];c.polygonIntersectsPolygon(l,ne)&&(B[H.bucketInstanceId][H.featureIndex]=!0,q[H.bucketInstanceId]===void 0&&(q[H.bucketInstanceId]=[]),q[H.bucketInstanceId].push(H.featureIndex))}return q}insertCollisionBox(n,l,g,x,E){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:E},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,g,x,E){const z=l?this.ignoredGrid:this.grid,k={bucketInstanceId:g,featureIndex:x,collisionGroupID:E};for(let B=0;B<n.length;B+=4)z.insertCircle(k,n[B],n[B+1],n[B+2])}projectAndGetPerspectiveRatio(n,l,g,x,E,z,k){const B=[l,g,x,1];let q=!1;x||this.transform.pitch>0?(c.transformMat4$1(B,B,n),this.fogState&&E&&k.name!=="globe"&&(q=function(ne,ce,fe,me,de,Y){const ue=Y.calculateFogTileMatrix(de),we=[ce,fe,me];return c.transformMat4(we,we,ue),hs(ne,we,Y.pitch,Y._fov)}(this.fogState,l,g,x,E.toUnwrapped(),this.transform)>.9)):Xi(B,B,n);const N=B[3];return{point:new c.Point((B[0]/N+1)/2*this.transform.width+wa,(-B[1]/N+1)/2*this.transform.height+wa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/N*.5,1.5),signedDistanceFromCamera:N,occluded:z&&B[2]>N||q}}isOffscreen(n,l,g,x){return g<wa||n>=this.screenRightBoundary||x<wa||l>this.screenBottomBoundary}isInsideGrid(n,l,g,x){return g>=0&&n<this.gridRightBoundary&&x>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=c.identity([]);return c.translate(n,n,[-100,-100,0]),n}}function Mr(m,n,l){const g=n.createTileMatrix(m,m.worldSize,l.toUnwrapped());return c.multiply(new Float32Array(16),m.projMatrix,g)}function Zn(m,n,l){if(n.projection.name===l.projection.name)return m.projMatrix;const g=l.clone();return g.setProjection(n.projection),Mr(g,n.getProjection(),m)}function on(m,n,l){return n.name===l.projection.name?m.projMatrix:Mr(l,n,m)}class uc{constructor(n,l,g,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):x&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Za{constructor(n,l,g,x,E,z=!1){this.text=new uc(n?n.text:null,l,g,E),this.icon=new uc(n?n.icon:null,l,x,E),this.clipped=z}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xa{constructor(n,l,g,x=!1){this.text=n,this.icon=l,this.skipFade=g,this.clipped=x}}class Wa{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class hc{constructor(n,l,g,x,E){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=E}}class el{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:g=>g.collisionGroupID===l}}return this.collisionGroups[n]}}function Sn(m,n,l,g,x){const{horizontalAlign:E,verticalAlign:z}=c.getAnchorAlignment(m),k=-(E-.5)*n,B=-(z-.5)*l,q=c.evaluateVariableOffset(m,g);return new c.Point(k+q[0]*x,B+q[1]*x)}function gs(m,n,l,g,x){const E=new c.Point(m,n);return l&&E._rotate(g?x:-x),E}class pc{constructor(n,l,g,x,E){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Ga(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new el(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,g,x){const E=g.getBucket(l),z=g.latestFeatureIndex;if(!E||!z||l.id!==E.layerIds[0])return;const k=E.layers[0].layout,B=g.collisionBoxArray,q=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),N=g.tileSize/c.EXTENT,H=g.tileID.toUnwrapped();this.transform.setProjection(E.projection);const ne=(ce=g.tileID,fe=E.getProjection(),me=this.transform,fe.name===this.projection?me.calculateProjMatrix(ce.toUnwrapped()):Mr(me,fe,ce));var ce,fe,me;const de=k.get("text-pitch-alignment")==="map",Y=k.get("text-rotation-alignment")==="map";l.compileFilter();const ue=l.dynamicFilter(),we=l.dynamicFilterNeedsFeature(),Ee=this.transform.calculatePixelsToTileUnitsMatrix(g),Fe=dn(ne,g.tileID.canonical,de,Y,this.transform,E.getProjection(),Ee);let qe=null;if(de){const $e=Qi(ne,g.tileID.canonical,de,Y,this.transform,E.getProjection(),Ee);qe=c.multiply([],this.transform.labelPlaneMatrix,$e)}let je=null;ue&&g.latestFeatureIndex&&(je={unwrappedTileID:H,dynamicFilter:ue,dynamicFilterNeedsFeature:we,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new hc(E.bucketInstanceId,z,E.sourceLayerIndex,E.index,g.tileID);const Ke={bucket:E,layout:k,posMatrix:ne,textLabelPlaneMatrix:Fe,labelToScreenMatrix:qe,clippingData:je,scale:q,textPixelRatio:N,holdingForFade:g.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(x)for(const $e of E.sortKeyRanges){const{sortKey:ct,symbolInstanceStart:Bt,symbolInstanceEnd:nt}=$e;n.push({sortKey:ct,symbolInstanceStart:Bt,symbolInstanceEnd:nt,parameters:Ke})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ke})}attemptAnchorPlacement(n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe,me,de,Y,ue){const{textOffset0:we,textOffset1:Ee,crossTileID:Fe}=ne,qe=[we,Ee],je=Sn(n,g,x,qe,E),Ke=this.collisionIndex.placeCollisionBox(fe,E,l,gs(je.x,je.y,z,k,this.transform.angle),H,B,q,N.predicate);if(de){const $e=fe.getSymbolInstanceIconSize(ue,this.transform.zoom,ne.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(fe,$e,de,gs(je.x,je.y,z,k,this.transform.angle),H,B,q,N.predicate).box.length===0)return}if(Ke.box.length>0){let $e;return this.prevPlacement&&this.prevPlacement.variableOffsets[Fe]&&this.prevPlacement.placements[Fe]&&this.prevPlacement.placements[Fe].text&&($e=this.prevPlacement.variableOffsets[Fe].anchor),this.variableOffsets[Fe]={textOffset:qe,width:g,height:x,anchor:n,textScale:E,prevAnchor:$e},this.markUsedJustification(fe,n,ne,me),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,me,ne),this.placedOrientations[Fe]=me),{shift:je,placedGlyphBoxes:Ke}}}placeLayerBucketPart(n,l,g,x){const{bucket:E,layout:z,posMatrix:k,textLabelPlaneMatrix:B,labelToScreenMatrix:q,clippingData:N,textPixelRatio:H,holdingForFade:ne,collisionBoxArray:ce,partiallyEvaluatedTextSize:fe,partiallyEvaluatedIconSize:me,collisionGroup:de}=n.parameters,Y=z.get("text-optional"),ue=z.get("icon-optional"),we=z.get("text-allow-overlap"),Ee=z.get("icon-allow-overlap"),Fe=z.get("text-rotation-alignment")==="map",qe=z.get("text-pitch-alignment")==="map",je=z.get("icon-text-fit")!=="none",Ke=z.get("symbol-z-order")==="viewport-y";this.transform.setProjection(E.projection);let $e=we&&(Ee||!E.hasIconData()||ue),ct=Ee&&(we||!E.hasTextData()||Y);!E.collisionArrays&&ce&&E.deserializeCollisionBoxes(ce),g&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,ce);const Bt=(nt,Tt,dt)=>{const{crossTileID:kt,numVerticalGlyphVertices:ut}=nt;if(N){const Pn={zoom:this.transform.zoom,pitch:this.transform.pitch};let fn=null;if(N.dynamicFilterNeedsFeature){const Vr=this.retainedQueryData[E.bucketInstanceId];fn=N.featureIndex.loadFeature({featureIndex:nt.featureIndex,bucketIndex:Vr.bucketIndex,sourceLayerIndex:Vr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(Pn,fn,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new c.Point(nt.tileAnchorX,nt.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[kt]=new Xa(!1,!1,!1,!0),void l.add(kt)}if(l.has(kt))return;if(ne)return void(this.placements[kt]=new Xa(!1,!1,!1));let xt=!1,Lt=!1,Mt=!0,Ut=!1,Si=!1,Ai=null,ui={box:null,offscreen:null,occluded:null},Fi={box:null,offscreen:null,occluded:null},ur=null,yr=null,wi=null,Gr=0,sn=0,nn=0;dt.textFeatureIndex?Gr=dt.textFeatureIndex:nt.useRuntimeCollisionCircles&&(Gr=nt.featureIndex),dt.verticalTextFeatureIndex&&(sn=dt.verticalTextFeatureIndex);const ln=Pn=>{Pn.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const fn=this.transform.elevation;(fn||Pn.elevation)&&(Pn.elevation=fn?fn.getAtTileOffset(Pn.tileID,Pn.tileAnchorX,Pn.tileAnchorY):0)},Jo=dt.textBox;if(Jo){ln(Jo);const Pn=Vr=>{let yo=c.WritingMode.horizontal;if(E.allowVerticalPlacement&&!Vr&&this.prevPlacement){const Ea=this.prevPlacement.placedOrientations[kt];Ea&&(this.placedOrientations[kt]=Ea,yo=Ea,this.markUsedOrientation(E,yo,nt))}return yo},fn=(Vr,yo)=>{if(E.allowVerticalPlacement&&ut>0&&dt.verticalTextBox){for(const Ea of E.writingModes)if(Ea===c.WritingMode.vertical?(ui=yo(),Fi=ui):ui=Vr(),ui&&ui.box&&ui.box.length)break}else ui=Vr()};if(z.get("text-variable-anchor")){let Vr=z.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[kt]){const xn=this.prevPlacement.variableOffsets[kt];Vr.indexOf(xn.anchor)>0&&(Vr=Vr.filter(ns=>ns!==xn.anchor),Vr.unshift(xn.anchor))}const yo=(xn,ns,$c)=>{const Mc=E.getSymbolInstanceTextSize(fe,nt,this.transform.zoom,Tt),Gs=(xn.x2-xn.x1)*Mc+2*xn.padding,Ts=(xn.y2-xn.y1)*Mc+2*xn.padding,Cc=je&&!Ee?ns:null;Cc&&ln(Cc);let Hc={box:[],offscreen:!1,occluded:!1};const wh=we?2*Vr.length:Vr.length;for(let Wu=0;Wu<wh;++Wu){const lp=this.attemptAnchorPlacement(Vr[Wu%Vr.length],xn,Gs,Ts,Mc,Fe,qe,H,k,de,Wu>=Vr.length,nt,Tt,E,$c,Cc,fe,me);if(lp&&(Hc=lp.placedGlyphBoxes,Hc&&Hc.box&&Hc.box.length)){xt=!0,Ai=lp.shift;break}}return Hc};fn(()=>yo(Jo,dt.iconBox,c.WritingMode.horizontal),()=>{const xn=dt.verticalTextBox;return xn&&ln(xn),E.allowVerticalPlacement&&!(ui&&ui.box&&ui.box.length)&&ut>0&&xn?yo(xn,dt.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ui&&(xt=ui.box,Mt=ui.offscreen,Ut=ui.occluded);const Ea=Pn(!(!ui||!ui.box));if(!xt&&this.prevPlacement){const xn=this.prevPlacement.variableOffsets[kt];xn&&(this.variableOffsets[kt]=xn,this.markUsedJustification(E,xn.anchor,nt,Ea))}}else{const Vr=(yo,Ea)=>{const xn=E.getSymbolInstanceTextSize(fe,nt,this.transform.zoom,Tt),ns=this.collisionIndex.placeCollisionBox(E,xn,yo,new c.Point(0,0),we,H,k,de.predicate);return ns&&ns.box&&ns.box.length&&(this.markUsedOrientation(E,Ea,nt),this.placedOrientations[kt]=Ea),ns};fn(()=>Vr(Jo,c.WritingMode.horizontal),()=>{const yo=dt.verticalTextBox;return E.allowVerticalPlacement&&ut>0&&yo?(ln(yo),Vr(yo,c.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Pn(!!(ui&&ui.box&&ui.box.length))}}if(ur=ui,xt=ur&&ur.box&&ur.box.length>0,Mt=ur&&ur.offscreen,Ut=ur&&ur.occluded,nt.useRuntimeCollisionCircles){const Pn=E.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex>=0?nt.centerJustifiedTextSymbolIndex:nt.verticalPlacedTextSymbolIndex),fn=c.evaluateSizeForFeature(E.textSizeData,fe,Pn),Vr=z.get("text-padding");yr=this.collisionIndex.placeCollisionCircles(E,we,Pn,E.lineVertexArray,E.glyphOffsetArray,fn,k,B,q,g,qe,de.predicate,nt.collisionCircleDiameter*fn/c.ONE_EM,Vr,this.retainedQueryData[E.bucketInstanceId].tileID),xt=we||yr.circles.length>0&&!yr.collisionDetected,Mt=Mt&&yr.offscreen,Ut=yr.occluded}if(dt.iconFeatureIndex&&(nn=dt.iconFeatureIndex),dt.iconBox){const Pn=fn=>{ln(fn);const Vr=je&&Ai?gs(Ai.x,Ai.y,Fe,qe,this.transform.angle):new c.Point(0,0),yo=E.getSymbolInstanceIconSize(me,this.transform.zoom,nt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,yo,fn,Vr,Ee,H,k,de.predicate)};Fi&&Fi.box&&Fi.box.length&&dt.verticalIconBox?(wi=Pn(dt.verticalIconBox),Lt=wi.box.length>0):(wi=Pn(dt.iconBox),Lt=wi.box.length>0),Mt=Mt&&wi.offscreen,Si=wi.occluded}const Hn=Y||nt.numHorizontalGlyphVertices===0&&ut===0,zn=ue||nt.numIconVertices===0;if(Hn||zn?zn?Hn||(Lt=Lt&&xt):xt=Lt&&xt:Lt=xt=Lt&&xt,xt&&ur&&ur.box&&this.collisionIndex.insertCollisionBox(ur.box,z.get("text-ignore-placement"),E.bucketInstanceId,Fi&&Fi.box&&sn?sn:Gr,de.ID),Lt&&wi&&this.collisionIndex.insertCollisionBox(wi.box,z.get("icon-ignore-placement"),E.bucketInstanceId,nn,de.ID),yr&&(xt&&this.collisionIndex.insertCollisionCircles(yr.circles,z.get("text-ignore-placement"),E.bucketInstanceId,Gr,de.ID),g)){const Pn=E.bucketInstanceId;let fn=this.collisionCircleArrays[Pn];fn===void 0&&(fn=this.collisionCircleArrays[Pn]=new Wa);for(let Vr=0;Vr<yr.circles.length;Vr+=4)fn.circles.push(yr.circles[Vr+0]),fn.circles.push(yr.circles[Vr+1]),fn.circles.push(yr.circles[Vr+2]),fn.circles.push(yr.collisionDetected?1:0)}const Dl=E.projection.name!=="globe";$e=$e&&(Dl||!Ut),ct=ct&&(Dl||!Si),this.placements[kt]=new Xa(xt||$e,Lt||ct,Mt||E.justReloaded),l.add(kt)};if(Ke){const nt=E.getSortedSymbolIndexes(this.transform.angle);for(let Tt=nt.length-1;Tt>=0;--Tt){const dt=nt[Tt];Bt(E.symbolInstances.get(dt),dt,E.collisionArrays[dt])}}else for(let nt=n.symbolInstanceStart;nt<n.symbolInstanceEnd;nt++)Bt(E.symbolInstances.get(nt),nt,E.collisionArrays[nt]);if(g&&E.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[E.bucketInstanceId];c.invert(nt.invProjMatrix,k),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(n,l,g,x){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:z,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:B,crossTileID:q}=g,N=c.getAnchorJustification(l),H=x===c.WritingMode.vertical?B:N==="left"?E:N==="center"?z:N==="right"?k:-1;E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=H>=0&&E!==H?0:q),z>=0&&(n.text.placedSymbolArray.get(z).crossTileID=H>=0&&z!==H?0:q),k>=0&&(n.text.placedSymbolArray.get(k).crossTileID=H>=0&&k!==H?0:q),B>=0&&(n.text.placedSymbolArray.get(B).crossTileID=H>=0&&B!==H?0:q)}markUsedOrientation(n,l,g){const x=l===c.WritingMode.horizontal||l===c.WritingMode.horizontalOnly?l:0,E=l===c.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:z,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:q}=g,N=n.text.placedSymbolArray;z>=0&&(N.get(z).placedOrientation=x),k>=0&&(N.get(k).placedOrientation=x),B>=0&&(N.get(B).placedOrientation=x),q>=0&&(N.get(q).placedOrientation=E)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let g=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const x=l?l.symbolFadeChange(n):1,E=l?l.opacities:{},z=l?l.variableOffsets:{},k=l?l.placedOrientations:{};for(const B in this.placements){const q=this.placements[B],N=E[B];N?(this.opacities[B]=new Za(N,x,q.text,q.icon,null,q.clipped),g=g||q.text!==N.text.placed||q.icon!==N.icon.placed):(this.opacities[B]=new Za(null,x,q.text,q.icon,q.skipFade,q.clipped),g=g||q.text||q.icon)}for(const B in E){const q=E[B];if(!this.opacities[B]){const N=new Za(q,x,!1,!1);N.isHidden()||(this.opacities[B]=N,g=g||q.text.placed||q.icon.placed)}}for(const B in z)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=z[B]);for(const B in k)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=k[B]);g?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l){const g=new Set;for(const x of l){const E=x.getBucket(n);E&&x.latestFeatureIndex&&n.id===E.layerIds[0]&&this.updateBucketOpacities(E,g,x.collisionBoxArray)}}updateBucketOpacities(n,l,g){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const x=n.layers[0].layout,E=!!n.layers[0].dynamicFilter(),z=new Za(null,0,!1,!1,!0),k=x.get("text-allow-overlap"),B=x.get("icon-allow-overlap"),q=x.get("text-variable-anchor"),N=x.get("text-rotation-alignment")==="map",H=x.get("text-pitch-alignment")==="map",ne=x.get("icon-text-fit")!=="none",ce=new Za(null,0,k&&(B||!n.hasIconData()||x.get("icon-optional")),B&&(k||!n.hasTextData()||x.get("text-optional")),!0);!n.collisionArrays&&g&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(g);const fe=(de,Y,ue)=>{for(let we=0;we<Y/4;we++)de.opacityVertexArray.emplaceBack(ue)};let me=0;for(let de=0;de<n.symbolInstances.length;de++){const Y=n.symbolInstances.get(de),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:we,crossTileID:Ee,numIconVertices:Fe}=Y,qe=l.has(Ee);let je=this.opacities[Ee];qe?je=z:je||(je=ce,this.opacities[Ee]=je),l.add(Ee);const Ke=ue>0||we>0,$e=Fe>0,ct=this.placedOrientations[Ee],Bt=ct===c.WritingMode.vertical,nt=ct===c.WritingMode.horizontal||ct===c.WritingMode.horizontalOnly;if(!Ke&&!$e||je.isHidden()||me++,Ke){const Tt=Zl(je.text);fe(n.text,ue,Bt?An:Tt),fe(n.text,we,nt?An:Tt);const dt=je.text.isHidden(),{leftJustifiedTextSymbolIndex:kt,centerJustifiedTextSymbolIndex:ut,rightJustifiedTextSymbolIndex:xt,verticalPlacedTextSymbolIndex:Lt}=Y,Mt=n.text.placedSymbolArray,Ut=dt||Bt?1:0;kt>=0&&(Mt.get(kt).hidden=Ut),ut>=0&&(Mt.get(ut).hidden=Ut),xt>=0&&(Mt.get(xt).hidden=Ut),Lt>=0&&(Mt.get(Lt).hidden=dt||nt?1:0);const Si=this.variableOffsets[Ee];Si&&this.markUsedJustification(n,Si.anchor,Y,ct);const Ai=this.placedOrientations[Ee];Ai&&(this.markUsedJustification(n,"left",Y,Ai),this.markUsedOrientation(n,Ai,Y))}if($e){const Tt=Zl(je.icon),{placedIconSymbolIndex:dt,verticalPlacedIconSymbolIndex:kt}=Y,ut=n.icon.placedSymbolArray,xt=je.icon.isHidden()?1:0;dt>=0&&(fe(n.icon,Fe,Bt?An:Tt),ut.get(dt).hidden=xt),kt>=0&&(fe(n.icon,Y.numVerticalIconVertices,nt?An:Tt),ut.get(kt).hidden=xt)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Tt=n.collisionArrays[de];if(Tt){let dt=new c.Point(0,0),kt=!0;if(Tt.textBox||Tt.verticalTextBox){if(q){const xt=this.variableOffsets[Ee];xt?(dt=Sn(xt.anchor,xt.width,xt.height,xt.textOffset,xt.textScale),N&&dt._rotate(H?this.transform.angle:-this.transform.angle)):kt=!1}E&&(kt=!je.clipped),Tt.textBox&&Bs(n.textCollisionBox.collisionVertexArray,je.text.placed,!kt||Bt,dt.x,dt.y),Tt.verticalTextBox&&Bs(n.textCollisionBox.collisionVertexArray,je.text.placed,!kt||nt,dt.x,dt.y)}const ut=kt&&!!(!nt&&Tt.verticalIconBox);Tt.iconBox&&Bs(n.iconCollisionBox.collisionVertexArray,je.icon.placed,ut,ne?dt.x:0,ne?dt.y:0),Tt.verticalIconBox&&Bs(n.iconCollisionBox.collisionVertexArray,je.icon.placed,!ut,ne?dt.x:0,ne?dt.y:0)}}}if(n.fullyClipped=me===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const de=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=de.invProjMatrix,n.placementViewportMatrix=de.viewportMatrix,n.collisionCircleArray=de.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const g=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*g>n}setStale(){this.stale=!0}}function Bs(m,n,l,g,x){m.emplaceBack(n?1:0,l?1:0,g||0,x||0),m.emplaceBack(n?1:0,l?1:0,g||0,x||0),m.emplaceBack(n?1:0,l?1:0,g||0,x||0),m.emplaceBack(n?1:0,l?1:0,g||0,x||0)}const oa=Math.pow(2,25),In=Math.pow(2,24),tl=Math.pow(2,17),vl=Math.pow(2,16),Lo=Math.pow(2,9),aa=Math.pow(2,8),mh=Math.pow(2,1);function Zl(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const n=m.placed?1:0,l=Math.floor(127*m.opacity);return l*oa+n*In+l*tl+n*vl+l*Lo+n*aa+l*mh+n}const An=0;class $a{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,l,g,x,E){const z=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(z,x,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,z.sort((k,B)=>k.sortKey-B.sortKey));this._currentPartIndex<z.length;){const k=z[this._currentPartIndex];if(l.placeLayerBucketPart(k,this._seenCrossTileIDs,g,k.symbolInstanceStart===0),this._currentPartIndex++,E())return!0}return!1}}class xl{constructor(n,l,g,x,E,z,k,B){this.placement=new pc(n,E,z,k,B),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,l,g){const x=c.exported.now(),E=()=>{const z=c.exported.now()-x;return!this._forceFullPlacement&&z>2};for(;this._currentPlacementIndex>=0;){const z=l[n[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=k)&&(!z.maxzoom||z.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new $a(z)),this._inProgressLayer.continuePlacement(g[z.source],this.placement,this._showCollisionBoxes,z,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Fs=512/c.EXTENT/2;class Po{constructor(n,l,g){this.tileID=n,this.bucketInstanceId=g,this.index=new c.KDBush(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=n.canonical.x*c.EXTENT,E=n.canonical.y*c.EXTENT;for(let z=0;z<l.length;z++){const{key:k,crossTileID:B,tileAnchorX:q,tileAnchorY:N}=l.get(z),H=Math.floor((x+q)*Fs),ne=Math.floor((E+N)*Fs);this.index.add(H,ne),this.keys.push(k),this.crossTileIDs.push(B)}this.index.finish()}findMatches(n,l,g){const x=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),E=Fs/Math.pow(2,l.canonical.z-this.tileID.canonical.z),z=l.canonical.x*c.EXTENT,k=l.canonical.y*c.EXTENT;for(let B=0;B<n.length;B++){const q=n.get(B);if(q.crossTileID)continue;const{key:N,tileAnchorX:H,tileAnchorY:ne}=q,ce=Math.floor((z+H)*E),fe=Math.floor((k+ne)*E),me=this.index.range(ce-x,fe-x,ce+x,fe+x);for(const de of me){const Y=this.crossTileIDs[de];if(this.keys[de]===N&&!g.has(Y)){g.add(Y),q.crossTileID=Y;break}}}}}class Fu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const g in this.indexes){const x=this.indexes[g],E={};for(const z in x){const k=x[z];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+l),E[k.tileID.key]=k}this.indexes[g]=E}this.lng=n}addBucket(n,l,g){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let E=0;E<l.symbolInstances.length;E++)l.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const x=this.usedCrossTileIDs[n.overscaledZ];for(const E in this.indexes){const z=this.indexes[E];if(Number(E)>n.overscaledZ)for(const k in z){const B=z[k];B.tileID.isChildOf(n)&&B.findMatches(l.symbolInstances,n,x)}else{const k=z[n.scaledTo(Number(E)).key];k&&k.findMatches(l.symbolInstances,n,x)}}for(let E=0;E<l.symbolInstances.length;E++){const z=l.symbolInstances.get(E);z.crossTileID||(z.crossTileID=g.generate(),x.add(z.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Po(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const g of l.crossTileIDs)this.usedCrossTileIDs[n].delete(g)}removeStaleBuckets(n){let l=!1;for(const g in this.indexes){const x=this.indexes[g];for(const E in x)n[x[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[E]),delete x[E],l=!0)}return l}}class za{constructor(){this.layerIndexes={},this.crossTileIDs=new Fu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,g,x){let E=this.layerIndexes[n.id];E===void 0&&(E=this.layerIndexes[n.id]=new Xl);let z=!1;const k={};x.name!=="globe"&&E.handleWrapJump(g);for(const B of l){const q=B.getBucket(n);q&&n.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(B.tileID,q,this.crossTileIDs)&&(z=!0),k[q.bucketInstanceId]=!0)}return E.removeStaleBuckets(k)&&(z=!0),z}pruneUnusedLayers(n){const l={};n.forEach(g=>{l[g]=!0});for(const g in this.layerIndexes)l[g]||delete this.layerIndexes[g]}}const il=(m,n)=>c.emitValidationErrors(m,n&&n.filter(l=>l.identifier!=="source.canvas")),ro=c.pick(rt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ou=c.pick(rt,["setCenter","setZoom","setBearing","setPitch"]),Os={version:8,layers:[],sources:{}},Pa={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class $o extends c.Evented{constructor(n,l={}){super(),this.map=n,this.dispatcher=new tn(Ae(),this),this.imageManager=new Wo,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(n._requestManager,l.localFontFamily?c.LocalGlyphMode.all:l.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new za,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const g=this;this._rtlTextPluginCallback=$o.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(E,z)=>{if(c.triggerPluginCompletionEvent(E),z&&z.every(k=>k))for(const k in g._sourceCaches){const B=g._sourceCaches[k],q=B.getSource().type;q!=="vector"&&q!=="geojson"||B.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const E=this.getSource(x.sourceId);if(E&&E.vectorLayerIds)for(const z in this._layers){const k=this._layers[z];k.source===E.id&&this._validateLayer(k)}})}loadURL(n,l={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const g=typeof l.validate=="boolean"?l.validate:!c.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,l.accessToken);const x=this.map._requestManager.transformRequest(n,c.ResourceType.Style);this._request=c.getJSON(x,(E,z)=>{this._request=null,E?this.fire(new c.ErrorEvent(E)):z&&this._load(z,g)})}loadJSON(n,l={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(n,l.validate!==!1)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(Os,!1)}_updateLayerCount(n,l){const g=l?1:-1;n.is3D()&&(this._num3DLayers+=g),n.type==="circle"&&(this._numCircleLayers+=g),n.type==="symbol"&&(this._numSymbolLayers+=g)}_load(n,l){if(l&&il(this,c.validateStyle(n)))return;this._loaded=!0,this.stylesheet=c.clone$1(n),this._updateMapProjection();for(const x in n.sources)this.addSource(x,n.sources[x],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const g=_t(this.stylesheet.layers);this._order=g.map(x=>x.id),this._layers={},this._serializedLayers={};for(const x of g){const E=c.createStyleLayer(x);E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new en(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(l,g,x){let E,z,k;const B=c.exported.devicePixelRatio>1?"@2x":"";let q=c.getJSON(g.transformRequest(g.normalizeSpriteURL(l,B,".json"),c.ResourceType.SpriteJSON),(ne,ce)=>{q=null,k||(k=ne,E=ce,H())}),N=c.getImage(g.transformRequest(g.normalizeSpriteURL(l,B,".png"),c.ResourceType.SpriteImage),(ne,ce)=>{N=null,k||(k=ne,z=ce,H())});function H(){if(k)x(k);else if(E&&z){const ne=c.exported.getImageData(z),ce={};for(const fe in E){const{width:me,height:de,x:Y,y:ue,sdf:we,pixelRatio:Ee,stretchX:Fe,stretchY:qe,content:je}=E[fe],Ke=new c.RGBAImage({width:me,height:de});c.RGBAImage.copy(ne,Ke,{x:Y,y:ue},{x:0,y:0},{width:me,height:de}),ce[fe]={data:Ke,pixelRatio:Ee,sdf:we,stretchX:Fe,stretchY:qe,content:je}}x(null,ce)}}return{cancel(){q&&(q.cancel(),q=null),N&&(N.cancel(),N=null)}}}(n,this.map._requestManager,(l,g)=>{if(this._spriteRequest=null,l)this.fire(new c.ErrorEvent(l));else if(g)for(const x in g)this.imageManager.addImage(x,g[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(n){const l=this.getSource(n.source);if(!l)return;const g=n.sourceLayer;g&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(g)===-1)&&this.fire(new c.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const l=[];for(const g of n){const x=this._layers[g];x.type!=="custom"&&l.push(x.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped():Pa[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const l=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(x.length||E.length)&&this._updateWorkerLayers(x,E);for(const z in this._updatedSources){const k=this._updatedSources[z];k==="reload"?this._reloadSource(z):k==="clear"&&this._clearSource(z)}this._updateTilesForChangedImages();for(const z in this._updatedPaintProps)this._layers[z].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const g={};for(const x in this._sourceCaches){const E=this._sourceCaches[x];g[x]=E.used,E.used=!1}for(const x of this._order){const E=this._layers[x];if(E.recalculate(n,this._availableImages),!E.isHidden(n.zoom)){const k=this._getLayerSourceCache(E);k&&(k.used=!0)}const z=this.map.painter;if(z){const k=E.getProgramIds();if(!k)continue;const B=E.getProgramConfiguration(n.zoom);for(const q of k)z.useProgram(q,B)}}for(const x in g){const E=this._sourceCaches[x];g[x]!==E.used&&E.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),il(this,c.validateStyle(n)))return!1;(n=c.clone$1(n)).layers=_t(n.layers);const l=function(x,E){if(!x)return[{command:rt.setStyle,args:[E]}];let z=[];try{if(!st(x.version,E.version))return[{command:rt.setStyle,args:[E]}];st(x.center,E.center)||z.push({command:rt.setCenter,args:[E.center]}),st(x.zoom,E.zoom)||z.push({command:rt.setZoom,args:[E.zoom]}),st(x.bearing,E.bearing)||z.push({command:rt.setBearing,args:[E.bearing]}),st(x.pitch,E.pitch)||z.push({command:rt.setPitch,args:[E.pitch]}),st(x.sprite,E.sprite)||z.push({command:rt.setSprite,args:[E.sprite]}),st(x.glyphs,E.glyphs)||z.push({command:rt.setGlyphs,args:[E.glyphs]}),st(x.transition,E.transition)||z.push({command:rt.setTransition,args:[E.transition]}),st(x.light,E.light)||z.push({command:rt.setLight,args:[E.light]}),st(x.fog,E.fog)||z.push({command:rt.setFog,args:[E.fog]}),st(x.projection,E.projection)||z.push({command:rt.setProjection,args:[E.projection]});const k={},B=[];(function(H,ne,ce,fe){let me;for(me in ne=ne||{},H=H||{})H.hasOwnProperty(me)&&(ne.hasOwnProperty(me)||Zt(me,ce,fe));for(me in ne){if(!ne.hasOwnProperty(me))continue;const de=ne[me];H.hasOwnProperty(me)?st(H[me],de)||(H[me].type==="geojson"&&de.type==="geojson"&&_i(H,ne,me)?ce.push({command:rt.setGeoJSONSourceData,args:[me,de.data]}):yi(me,ne,ce,fe)):Wt(me,ne,ce)}})(x.sources,E.sources,B,k);const q=[];x.layers&&x.layers.forEach(H=>{H.source&&k[H.source]?z.push({command:rt.removeLayer,args:[H.id]}):q.push(H)});let N=x.terrain;N&&k[N.source]&&(z.push({command:rt.setTerrain,args:[void 0]}),N=void 0),z=z.concat(B),st(N,E.terrain)||z.push({command:rt.setTerrain,args:[E.terrain]}),function(H,ne,ce){ne=ne||[];const fe=(H=H||[]).map(Ti),me=ne.map(Ti),de=H.reduce(zi,{}),Y=ne.reduce(zi,{}),ue=fe.slice(),we=Object.create(null);let Ee,Fe,qe,je,Ke,$e,ct;for(Ee=0,Fe=0;Ee<fe.length;Ee++)qe=fe[Ee],Y.hasOwnProperty(qe)?Fe++:(ce.push({command:rt.removeLayer,args:[qe]}),ue.splice(ue.indexOf(qe,Fe),1));for(Ee=0,Fe=0;Ee<me.length;Ee++)qe=me[me.length-1-Ee],ue[ue.length-1-Ee]!==qe&&(de.hasOwnProperty(qe)?(ce.push({command:rt.removeLayer,args:[qe]}),ue.splice(ue.lastIndexOf(qe,ue.length-Fe),1)):Fe++,$e=ue[ue.length-Ee],ce.push({command:rt.addLayer,args:[Y[qe],$e]}),ue.splice(ue.length-Ee,0,qe),we[qe]=!0);for(Ee=0;Ee<me.length;Ee++)if(qe=me[Ee],je=de[qe],Ke=Y[qe],!we[qe]&&!st(je,Ke))if(st(je.source,Ke.source)&&st(je["source-layer"],Ke["source-layer"])&&st(je.type,Ke.type)){for(ct in ri(je.layout,Ke.layout,ce,qe,null,rt.setLayoutProperty),ri(je.paint,Ke.paint,ce,qe,null,rt.setPaintProperty),st(je.filter,Ke.filter)||ce.push({command:rt.setFilter,args:[qe,Ke.filter]}),st(je.minzoom,Ke.minzoom)&&st(je.maxzoom,Ke.maxzoom)||ce.push({command:rt.setLayerZoomRange,args:[qe,Ke.minzoom,Ke.maxzoom]}),je)je.hasOwnProperty(ct)&&ct!=="layout"&&ct!=="paint"&&ct!=="filter"&&ct!=="metadata"&&ct!=="minzoom"&&ct!=="maxzoom"&&(ct.indexOf("paint.")===0?ri(je[ct],Ke[ct],ce,qe,ct.slice(6),rt.setPaintProperty):st(je[ct],Ke[ct])||ce.push({command:rt.setLayerProperty,args:[qe,ct,Ke[ct]]}));for(ct in Ke)Ke.hasOwnProperty(ct)&&!je.hasOwnProperty(ct)&&ct!=="layout"&&ct!=="paint"&&ct!=="filter"&&ct!=="metadata"&&ct!=="minzoom"&&ct!=="maxzoom"&&(ct.indexOf("paint.")===0?ri(je[ct],Ke[ct],ce,qe,ct.slice(6),rt.setPaintProperty):st(je[ct],Ke[ct])||ce.push({command:rt.setLayerProperty,args:[qe,ct,Ke[ct]]}))}else ce.push({command:rt.removeLayer,args:[qe]}),$e=ue[ue.lastIndexOf(qe)+1],ce.push({command:rt.addLayer,args:[Ke,$e]})}(q,E.layers,z)}catch(k){console.warn("Unable to compute style diff:",k),z=[{command:rt.setStyle,args:[E]}]}return z}(this.serialize(),n).filter(x=>!(x.command in Ou));if(l.length===0)return!1;const g=l.filter(x=>!(x.command in ro));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);return l.forEach(x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,l){return this.getImage(n)?this.fire(new c.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,l),this._afterImageUpdated(n),this)}updateImage(n,l){this.imageManager.updateImage(n,l)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new c.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,l,g={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.validateSource,`sources.${n}`,l,null,g))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const x=V(n,l,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:x.serialize(),sourceId:n}));const E=z=>{const k=(z?"symbol:":"other:")+n,B=this._sourceCaches[k]=new c.SourceCache(k,x,z);(z?this._symbolSourceCaches:this._otherSourceCaches)[n]=B,B.style=this,B.onAdd(this.map)};E(!1),l.type!=="vector"&&l.type!=="geojson"||E(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const l=this.getSource(n);if(!l)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new c.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new c.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(n);for(const x of g)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getSource(n).setData(l),this._changed=!0}getSource(n){const l=this._getSourceCache(n);return l&&l.getSource()}_getSources(){const n=[];for(const l in this._otherSourceCaches){const g=this._getSourceCache(l);g&&n.push(g.getSource())}return n}addLayer(n,l,g={}){this._checkLoaded();const x=n.id;if(this.getLayer(x))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let E;if(n.type==="custom"){if(il(this,c.validateCustomStyleLayer(n)))return;E=c.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(x,n.source),n=c.clone$1(n),n=c.extend(n,{source:x})),this._validate(c.validateLayer,`layers.${x}`,n,{arrayIndex:-1},g))return;E=c.createStyleLayer(n),this._validateLayer(E),E.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const z=l?this._order.indexOf(l):this._order.length;if(l&&z===-1)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(z,0,x),this._layerOrderChanged=!0,this._layers[x]=E;const k=this._getLayerSourceCache(E);if(this._removedLayers[x]&&E.source&&k&&E.type!=="custom"){const B=this._removedLayers[x];delete this._removedLayers[x],B.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",k.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,l){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new c.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===l)return;const g=this._order.indexOf(n);this._order.splice(g,1);const x=l?this._order.indexOf(l):this._order.length;l&&x===-1?this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(x,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const l=this._layers[n];if(!l)return void this.fire(new c.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const g=this._order.indexOf(n);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=l,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,g){this._checkLoaded();const x=this.getLayer(n);x?x.minzoom===l&&x.maxzoom===g||(l!=null&&(x.minzoom=l),g!=null&&(x.maxzoom=g),this._updateLayer(x)):this.fire(new c.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,l,g={}){this._checkLoaded();const x=this.getLayer(n);if(x){if(!st(x.filter,l))return l==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(c.validateFilter,`layers.${x.id}.filter`,l,{layerType:x.type},g)||(x.filter=c.clone$1(l),this._updateLayer(x)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const l=this.getLayer(n);return l&&c.clone$1(l.filter)}setLayoutProperty(n,l,g,x={}){this._checkLoaded();const E=this.getLayer(n);E?st(E.getLayoutProperty(l),g)||(E.setLayoutProperty(l,g,x),this._updateLayer(E)):this.fire(new c.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,l){const g=this.getLayer(n);if(g)return g.getLayoutProperty(l);this.fire(new c.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,l,g,x={}){this._checkLoaded();const E=this.getLayer(n);E?st(E.getPaintProperty(l),g)||(E.setPaintProperty(l,g,x)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,l){const g=this.getLayer(n);return g&&g.getPaintProperty(l)}setFeatureState(n,l){this._checkLoaded();const g=n.source,x=n.sourceLayer,E=this.getSource(g);if(!E)return void this.fire(new c.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const z=E.type;if(z==="geojson"&&x)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(z==="vector"&&!x)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(g);for(const B of k)B.setFeatureState(x,n.id,l)}removeFeatureState(n,l){this._checkLoaded();const g=n.source,x=this.getSource(g);if(!x)return void this.fire(new c.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const E=x.type,z=E==="vector"?n.sourceLayer:void 0;if(E==="vector"&&!z)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(g);for(const B of k)B.removeFeatureState(z,n.id,l)}getFeatureState(n){this._checkLoaded();const l=n.source,g=n.sourceLayer,x=this.getSource(l);if(x){if(x.type!=="vector"||g)return n.id===void 0&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(g,n.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const l in this._sourceCaches){const g=this._sourceCaches[l].getSource();n[g.id]||(n[g.id]=g.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const l=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",l.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=z=>this._layers[z].type==="fill-extrusion",g={},x=[];for(let z=this._order.length-1;z>=0;z--){const k=this._order[z];if(l(k)){g[k]=z;for(const B of n){const q=B[k];if(q)for(const N of q)x.push(N)}}}x.sort((z,k)=>k.intersectionZ-z.intersectionZ);const E=[];for(let z=this._order.length-1;z>=0;z--){const k=this._order[z];if(l(k))for(let B=x.length-1;B>=0;B--){const q=x[B].feature;if(g[q.layer.id]<z)break;E.push(q),x.pop()}else for(const B of n){const q=B[k];if(q)for(const N of q)E.push(N.feature)}}return E}queryRenderedFeatures(n,l,g){l&&l.filter&&this._validate(c.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const x={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const B of l.layers){const q=this._layers[B];if(!q)return this.fire(new c.ErrorEvent(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];x[q.source]=!0}}const E=[];l.availableImages=this._availableImages;const z=l&&l.layers?l.layers.some(B=>{const q=this.getLayer(B);return q&&q.is3D()}):this.has3DLayers(),k=zs.createFromScreenPoints(n,g);for(const B in this._sourceCaches){const q=this._sourceCaches[B].getSource().id;l.layers&&!x[q]||E.push(ee(this._sourceCaches[B],this._layers,this._serializedLayers,k,l,g,z,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(B,q,N,H,ne,ce,fe){const me={},de=ce.queryRenderedSymbols(H),Y=[];for(const ue of Object.keys(de).map(Number))Y.push(fe[ue]);Y.sort(xe);for(const ue of Y){const we=ue.featureIndex.lookupSymbolFeatures(de[ue.bucketInstanceId],q,ue.bucketIndex,ue.sourceLayerIndex,ne.filter,ne.layers,ne.availableImages,B);for(const Ee in we){const Fe=me[Ee]=me[Ee]||[],qe=we[Ee];qe.sort((je,Ke)=>{const $e=ue.featureSortOrder;if($e){const ct=$e.indexOf(je.featureIndex);return $e.indexOf(Ke.featureIndex)-ct}return Ke.featureIndex-je.featureIndex});for(const je of qe)Fe.push(je)}}for(const ue in me)me[ue].forEach(we=>{const Ee=we.feature,Fe=N(B[ue]);if(!Fe)return;const qe=Fe.getFeatureState(Ee.layer["source-layer"],Ee.id);Ee.source=Ee.layer.source,Ee.layer["source-layer"]&&(Ee.sourceLayer=Ee.layer["source-layer"]),Ee.state=qe});return me}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(n,l){l&&l.filter&&this._validate(c.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const g=this._getSourceCaches(n);let x=[];for(const E of g)x=x.concat(pe(E,l));return x}addSourceType(n,l,g){return $o.getSourceType(n)?g(new Error(`A source type called "${n}" already exists.`)):($o.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(n,l={}){this._checkLoaded();const g=this.light.getLight();let x=!1;for(const z in n)if(!st(n[z],g[z])){x=!0;break}if(!x)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,l),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,l=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let g=n;if(l===1){if(typeof g.source=="object"){const x="terrain-dem-src";this.addSource(x,g.source),g=c.clone$1(g),g=c.extend(g,{source:x})}if(this._validate(c.validateTerrain,"terrain",g))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,l)}else{const x=this.terrain,E=x.get();for(const z of Object.keys(c.spec.terrain))!g.hasOwnProperty(z)&&c.spec.terrain[z].default&&(g[z]=c.spec.terrain[z].default);for(const z in g)if(!st(g[z],E[z])){x.set(g),this.stylesheet.terrain=g;const k=this._setTransitionParameters({duration:0});x.updateTransitions(k);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new Cs(n,this.map.transform);this.stylesheet.fog=n;const g=this._setTransitionParameters({duration:0});l.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,g=l.get();Object.keys(n).length===0&&l.set(n);for(const x in n)if(!st(n[x],g[x])){l.set(n),this.stylesheet.fog=n;const E=this._setTransitionParameters({duration:0});l.updateTransitions(E);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:c.exported.now(),transition:c.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(g=>this.isLayerDraped(this._layers[g])),l=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const g=this.terrain=new fa(n,l);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});g.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,g,x,E={}){return(!E||E.validate!==!1)&&il(this,n.call(c.validateStyle,c.extend({key:l,style:this.serialize(),value:g,styleSpec:c.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const l=this._getSourceCaches(n);for(const g of l)g.clearTiles()}_reloadSource(n){const l=this._getSourceCaches(n);for(const g of l)g.resume(),g.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const l in this._sourceCaches)this._sourceCaches[l].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,g,x,E=!1){let z=!1,k=!1;const B={};for(const q of this._order){const N=this._layers[q];if(N.type!=="symbol")continue;if(!B[N.source]){const ne=this._getLayerSourceCache(N);if(!ne)continue;B[N.source]=ne.getRenderableIds(!0).map(ce=>ne.getTileByID(ce)).sort((ce,fe)=>fe.tileID.overscaledZ-ce.tileID.overscaledZ||(ce.tileID.isLessThan(fe.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(N,B[N.source],n.center.lng,n.projection);z=z||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),n.zoom))&&(this.pauseablePlacement=new xl(n,this._order,E,l,g,x,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),k=!0),z&&this.pauseablePlacement.placement.setStale()),k||z)for(const q of this._order){const N=this._layers[q];N.type==="symbol"&&this.placement.updateLayerOpacities(N,B[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,l,g){this.imageManager.getImages(l.icons,g),this._updateTilesForChangedImages();const x=E=>{E&&E.setDependencies(l.tileID.key,l.type,l.icons)};x(this._otherSourceCaches[l.source]),x(this._symbolSourceCaches[l.source])}getGlyphs(n,l,g){this.glyphManager.getGlyphs(l.stacks,g)}getResource(n,l,g){return c.makeRequest(l,g)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this._getSourceCaches(n);return l.length===0?(this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):l.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}$o.getSourceType=function(m){return li[m]},$o.setSourceType=function(m,n){li[m]=n},$o.registerForPluginStateChange=c.registerForPluginStateChange;var rl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,ka="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",sa=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,dc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Us=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let nl={},fc={};const Vc=[];Ha(rl,Vc),Ha(sa,Vc),Ha(dc,Vc),Ha(Us,Vc),nl=wr("",sa),fc=wr(Us,dc);const _h=wr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),cu=rl,Uu=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Vu={background:wr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:wr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:wr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:wr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:wr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:wr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:wr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:wr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:wr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:wr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:wr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:wr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:wr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:wr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:wr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:wr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:wr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:wr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:wr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:wr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:wr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:wr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:wr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:wr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ka),skyboxGradient:wr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ka),skyboxCapture:wr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:wr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:wr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ha(m,n){const l=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of l)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=g.split(" ");for(const E of x)n.includes(E)||n.push(E)}}function wr(m,n){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},E=[...Vc];return Ha(m,E),Ha(n,E),{fragmentSource:m=m.replace(l,(z,k,B,q,N)=>(x[N]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${B} ${q} ${N};
#else
uniform ${B} ${q} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${B} ${q} ${N} = u_${N};
#endif
`)),vertexSource:n=n.replace(l,(z,k,B,q,N)=>{const H=q==="float"?"vec2":"vec4",ne=N.match(/color/)?"color":H;return x[N]?k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${B} ${H} a_${N};
varying ${B} ${q} ${N};
#else
uniform ${B} ${q} u_${N};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${B} ${q} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${ne}(a_${N}, u_${N}_t);
#else
    ${B} ${q} ${N} = u_${N};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${B} ${H} a_${N};
#else
uniform ${B} ${q} u_${N};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${B} ${q} ${N} = a_${N};
#else
    ${B} ${q} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${B} ${q} ${N} = unpack_mix_${ne}(a_${N}, u_${N}_t);
#else
    ${B} ${q} ${N} = u_${N};
#endif
`}),staticAttributes:g,usedDefines:E}}class mc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,g,x,E,z,k){this.context=n;let B=this.boundPaintVertexBuffers.length!==x.length;for(let N=0;!B&&N<x.length;N++)this.boundPaintVertexBuffers[N]!==x[N]&&(B=!0);let q=this.boundDynamicVertexBuffers.length!==k.length;for(let N=0;!q&&N<k.length;N++)this.boundDynamicVertexBuffers[N]!==k[N]&&(q=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==g||B||q||this.boundIndexBuffer!==E||this.boundVertexOffset!==z)this.freshBind(l,g,x,E,z,k);else{n.bindVertexArrayOES.set(this.vao);for(const N of k)N&&N.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(n,l,g,x,E,z){let k;const B=n.numAttributes,q=this.context,N=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=z;else{k=q.currentNumAttributes||0;for(let H=B;H<k;H++)N.disableVertexAttribArray(H)}l.enableAttributes(N,n),l.bind(),l.setVertexAttribPointers(N,n,E);for(const H of g)H.enableAttributes(N,n),H.bind(),H.setVertexAttribPointers(N,n,E);for(const H of z)H&&(H.enableAttributes(N,n),H.bind(),H.setVertexAttribPointers(N,n,E));x&&x.bind(),q.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function an(m,n){const l=Math.pow(2,n.canonical.z),g=n.canonical.y;return[new c.MercatorCoordinate(0,g/l).toLngLat().lat,new c.MercatorCoordinate(0,(g+1)/l).toLngLat().lat]}function Nu(m,n,l,g,x,E,z){const k=m.context,B=k.gl,q=l.fbo;if(!q)return;m.prepareDrawTile();const N=m.useProgram("hillshade");k.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,q.colorAttachment.get());const H=((me,de,Y,ue)=>{const we=Y.paint.get("hillshade-shadow-color"),Ee=Y.paint.get("hillshade-highlight-color"),Fe=Y.paint.get("hillshade-accent-color");let qe=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);Y.paint.get("hillshade-illumination-anchor")==="viewport"&&(qe-=me.transform.angle);const je=!me.options.moving;return{u_matrix:ue||me.transform.calculateProjMatrix(de.tileID.toUnwrapped(),je),u_image:0,u_latrange:an(0,de.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),qe],u_shadow:we,u_highlight:Ee,u_accent:Fe}})(m,l,g,m.terrain?n.projMatrix:null);m.prepareDrawProgram(k,N,n.toUnwrapped());const{tileBoundsBuffer:ne,tileBoundsIndexBuffer:ce,tileBoundsSegments:fe}=m.getTileBoundsBuffers(l);N.draw(k,B.TRIANGLES,x,E,z,c.CullFaceMode.disabled,H,g.id,ne,ce,fe)}function bl(m,n,l){if(!n.needsDEMTextureUpload)return;const g=m.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||m.getTileTexture(l.stride);const E=l.getPixels();n.demTexture?n.demTexture.update(E,{premultiply:!1}):n.demTexture=new c.Texture(g,E,x.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ol(m,n,l,g,x,E){const z=m.context,k=z.gl;if(!n.dem)return;const B=n.dem;if(z.activeTexture.set(k.TEXTURE1),bl(m,n,B),!n.demTexture)return;n.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const q=B.dim;z.activeTexture.set(k.TEXTURE0);let N=n.fbo;if(!N){const fe=new c.Texture(z,{width:q,height:q,data:null},k.RGBA);fe.bind(k.LINEAR,k.CLAMP_TO_EDGE),N=n.fbo=z.createFramebuffer(q,q,!0),N.colorAttachment.set(fe.texture)}z.bindFramebuffer.set(N.framebuffer),z.viewport.set([0,0,q,q]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:ne,tileBoundsSegments:ce}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(z,k.TRIANGLES,g,x,E,c.CullFaceMode.disabled,((fe,me)=>{const de=me.stride,Y=c.create();return c.ortho(Y,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(Y,Y,[0,-c.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[de,de],u_zoom:fe.overscaledZ,u_unpack:me.unpackVector}})(n.tileID,B),l.id,H,ne,ce),n.needsHillshadePrepare=!1}const _c=m=>({u_matrix:new c.UniformMatrix4f(m),u_image0:new c.Uniform1i(m),u_skirt_height:new c.Uniform1f(m)}),Ka=(m,n)=>({u_matrix:m,u_image0:0,u_skirt_height:n}),al=(m,n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:l,u_zoom_transition:x,u_merc_center:E,u_image0:0,u_frustum_tl:z,u_frustum_tr:k,u_frustum_br:B,u_frustum_bl:q,u_globe_pos:N,u_globe_radius:H,u_viewport:ne,u_grid_matrix:fe?Float32Array.from(fe):new Float32Array(9),u_skirt_height:ce});function wl(m,n){return m!=null&&n!=null&&!(!m.hasData()||!n.hasData())&&m.demTexture!=null&&n.demTexture!=null&&m.tileID.key!==n.tileID.key}const Ya=new class{constructor(){this.operations={}}newMorphing(m,n,l,g,x){if(m in this.operations){const E=this.operations[m];E.to.tileID.key!==l.tileID.key&&(E.queued=l)}else this.operations[m]={startTime:g,phase:0,duration:x,from:n,to:l,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const n=this.operations[m];return{from:n.from,to:n.to,phase:n.phase}}update(m){for(const n in this.operations){const l=this.operations[n];for(l.phase=(m-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,m)){delete this.operations[n];break}}}_nextOp(m,n){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=n,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Pr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Wl(m){return 6*Math.pow(1.5,22-m)}function gh(m,n){const l=1<<m.z;return!n&&(m.x===0||m.x===l-1)||m.y===0||m.y===l-1}const Vs=m=>({u_matrix:m});function ju(m,n,l,g,x){if(x>0){const E=c.exported.now(),z=(E-m.timeAdded)/x,k=n?(E-n.timeAdded)/x:-1,B=l.getSource(),q=g.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),N=!n||Math.abs(n.tileID.overscaledZ-q)>Math.abs(m.tileID.overscaledZ-q),H=N&&m.refreshedUponExpiration?1:c.clamp(N?z:1-k,0,1);return m.refreshedUponExpiration&&z>=1&&(m.refreshedUponExpiration=!1),n?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class Nc extends c.SourceCache{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},g=new tn(Ae(),null),x=V("mock-dem",l,g,n.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class gc extends c.SourceCache{constructor(n){const l=V("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new tn(Ae(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,g){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,z)=>{if(E[z.key]="",!this._tiles[z.key]){const k=new c.Tile(z,this._source.tileSize*z.overscaleFactor(),n.tileZoom);k.state="loaded",this._tiles[z.key]=k}return E},{});for(const E in this._tiles)E in x||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const g=Object.values(l);this.renderCachePool.push(...g),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class uu extends c.OverscaledTileID{constructor(n,l,g){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=g}}class $l extends c.Elevation{constructor(n,l){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,E]=function(B){const q=new c.StructArrayLayout2i4,N=new c.StructArrayLayout3ui6,H=131;q.reserve(17161),N.reserve(33800);const ne=c.EXTENT/128,ce=c.EXTENT+ne/2,fe=ce+ne;for(let de=-ne;de<fe;de+=ne)for(let Y=-ne;Y<fe;Y+=ne){const ue=Y<0||Y>ce||de<0||de>ce?24575:0,we=c.clamp(Math.round(Y),0,c.EXTENT),Ee=c.clamp(Math.round(de),0,c.EXTENT);q.emplaceBack(we+ue,Ee)}const me=(de,Y)=>{const ue=Y*H+de;N.emplaceBack(ue+1,ue,ue+H),N.emplaceBack(ue+H,ue+H+1,ue+1)};for(let de=1;de<129;de++)for(let Y=1;Y<129;Y++)me(Y,de);return[0,129].forEach(de=>{for(let Y=0;Y<130;Y++)me(Y,de),me(de,Y)}),[q,N,32768]}(),z=n.context;this.gridBuffer=z.createVertexBuffer(g,c.posAttributes.members),this.gridIndexBuffer=z.createIndexBuffer(x),this.gridSegments=c.SegmentVector.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,g.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new gc(l.map),this.orthoMatrix=c.create(),c.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,c.EXTENT,0,c.EXTENT,0,1);const k=z.gl;this._overlapStencilMode=new c.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Nc(l.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,l,g){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const x=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const E=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.getScaledDemTileSize();this.sourceCache.update(l,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),l.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&c.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=l.getIds().map(B=>{const q=l.getTileByID(B).tileID;return q.projMatrix=g.calculateProjMatrix(q.toUnwrapped()),q});(function(B,q){const N=q.transform.pointCoordinate(q.transform.getCameraPoint()),H=new c.Point(N.x,N.y);B.sort((ne,ce)=>{if(ce.overscaledZ-ne.overscaledZ)return ce.overscaledZ-ne.overscaledZ;const fe=new c.Point(ne.canonical.x+(1<<ne.canonical.z)*ne.wrap,ne.canonical.y),me=new c.Point(ce.canonical.x+(1<<ce.canonical.z)*ce.wrap,ce.canonical.y),de=H.mult(1<<ne.canonical.z);return de.x-=.5,de.y-=.5,de.distSqr(fe)-de.distSqr(me)})})(x,this.painter),this._previousZoom=g.zoom;const E=this.proxyToSource||{};this.proxyToSource={},x.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const z=this._style._sourceCaches;for(const B in z){const q=z[B];if(!q.used||(q!==this.sourceCache&&this.resetTileLookupCache(q.id),this._setupProxiedCoordsForOrtho(q,n[B],E),q.usedForTerrain))continue;const N=n[B];q.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[l.id]=x.map(B=>new uu(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const k={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const q=this.terrainTileForTile[B.key];if(!q)continue;const N=q.tileID.key;N in k||(this._visibleDemTiles.push(q),k[N]=N)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const g=this._findTileCoveringTileID(l,this.sourceCache);g&&(this.terrainTileForTile[l.key]=g)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],E=x.dem;!E||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),bl(this.painter,x,E))}}_prepareDemTileUniforms(n,l,g,x){if(!l||l.demTexture==null)return!1;const E=n.tileID.canonical,z=Math.pow(2,l.tileID.canonical.z-E.z),k=x||"";return g[`u_dem_tl${k}`]=[E.x*z%1,E.y*z%1],g[`u_dem_scale${k}`]=z,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,l=n.gl;if(!this._emptyDepthBufferTexture){const g=new c.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new c.Texture(n,g,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const l=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const E=x.dem.tree.minimums[0];return E>0&&n++,g+E},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const g=this._getLoadedAreaMinimum(),x=new c.RGBAImage({width:1,height:1},new Uint8Array(c.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(x,{premultiply:!1}):E=this._emptyDEMTexture=new c.Texture(n,x,l.RGBA,{premultiply:!1}),E}setupElevationDraw(n,l,g){const x=this.painter.context,E=x.gl,z=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var k;z.u_dem_size=this.sourceCache.getSource().tileSize,z.u_exaggeration=this.exaggeration();let B=null,q=null,N=1;if(g&&g.morphing&&this._useVertexMorphing){const H=g.morphing.srcDemTile,ne=g.morphing.dstDemTile;N=g.morphing.phase,H&&ne&&(this._prepareDemTileUniforms(n,H,z,"_prev")&&(q=H),this._prepareDemTileUniforms(n,ne,z)&&(B=ne))}if(q&&B?(x.activeTexture.set(E.TEXTURE2),B.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),x.activeTexture.set(E.TEXTURE4),q.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),z.u_dem_lerp=N):(B=this.terrainTileForTile[n.tileID.key],x.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(n,B,z)?B.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),x.activeTexture.set(E.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(z.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),z.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&B){const H=(1<<B.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;z.u_meter_to_dem=H}if(g&&g.labelPlaneMatrixInv&&(z.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),l.setTerrainUniformValues(x,z),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,n.tileID.canonical,g&&g.useDenormalizedUpVectorScale);l.setGlobeUniformValues(x,H)}}globeUniformValues(n,l,g){const x=n.projection;return{u_tile_tl_up:x.upVector(l,0,0),u_tile_tr_up:x.upVector(l,c.EXTENT,0),u_tile_br_up:x.upVector(l,c.EXTENT,c.EXTENT),u_tile_bl_up:x.upVector(l,0,c.EXTENT),u_tile_up_scale:g?c.globeMetersToEcef(1):x.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,g=this.painter.context;n.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,E,z,k,B){if(x.transform.projection.name==="globe")(function(q,N,H,ne,ce){const fe=q.context,me=fe.gl;let de,Y;const ue=q.options.showTerrainWireframe?2:0,we=q.transform,Ee=c.globeUseCustomAntiAliasing(q,fe,we),Fe=(kt,ut)=>{if(Y===kt)return;const xt=[Pr[kt],"PROJECTION_GLOBE_VIEW"];Ee&&xt.push("CUSTOM_ANTIALIASING"),ut&&xt.push(Pr[ue]),de=q.useProgram("globeRaster",null,xt),Y=kt},qe=q.colorModeForRenderPass(),je=new c.DepthMode(me.LEQUAL,c.DepthMode.ReadWrite,q.depthRangeFor3D);Ya.update(ce);const Ke=c.calculateGlobeMercatorMatrix(we),$e=[c.mercatorXfromLng(we.center.lng),c.mercatorYfromLat(we.center.lat)],ct=ue?[!1,!0]:[!1],Bt=q.globeSharedBuffers,nt=[we.width*c.exported.devicePixelRatio,we.height*c.exported.devicePixelRatio],Tt=Float32Array.from(we.globeMatrix),dt={useDenormalizedUpVectorScale:!0};if(ct.forEach(kt=>{const ut=q.transform,xt=Wl(ut.zoom)*N.exaggeration();Y=-1;const Lt=kt?me.LINES:me.TRIANGLES;for(const Mt of ne){const Ut=H.getTile(Mt),Si=c.StencilMode.disabled,Ai=N.prevTerrainTileForTile[Mt.key],ui=N.terrainTileForTile[Mt.key];wl(Ai,ui)&&Ya.newMorphing(Mt.key,Ai,ui,ce,250),fe.activeTexture.set(me.TEXTURE0),Ut.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE);const Fi=Ya.getMorphValuesForProxy(Mt.key),ur=Fi?1:0;Fi&&c.extend$1(dt,{morphing:{srcDemTile:Fi.from,dstDemTile:Fi.to,phase:c.easeCubicInOut(Fi.phase)}});const yr=c.tileCornersToBounds(Mt.canonical),wi=c.getLatitudinalLod(yr.getCenter().lat),Gr=c.getGridMatrix(Mt.canonical,yr,wi,ut.worldSize/ut._pixelsPerMercatorPixel),sn=c.globeNormalizeECEF(c.globeTileBounds(Mt.canonical)),nn=al(ut.projMatrix,Tt,Ke,sn,c.globeToMercatorTransition(ut.zoom),$e,ut.frustumCorners.TL,ut.frustumCorners.TR,ut.frustumCorners.BR,ut.frustumCorners.BL,ut.globeCenterInViewSpace,ut.globeRadius,nt,xt,Gr);if(Fe(ur,kt),N.setupElevationDraw(Ut,de,dt),q.prepareDrawProgram(fe,de,Mt.toUnwrapped()),Bt){const[ln,Jo,Hn]=kt?Bt.getWirefameBuffers(q.context,wi):Bt.getGridBuffers(wi,xt!==0);de.draw(fe,Lt,je,Si,qe,c.CullFaceMode.backCCW,nn,"globe_raster",ln,Jo,Hn)}}}),Bt){const kt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ee&&kt.push("CUSTOM_ANTIALIASING"),de=q.useProgram("globeRaster",null,kt);for(const ut of ne){const{x:xt,y:Lt,z:Mt}=ut.canonical,Ut=Lt===0,Si=Lt===(1<<Mt)-1,[Ai,ui,Fi,ur]=Bt.getPoleBuffers(Mt);if(ur&&(Ut||Si)){const yr=H.getTile(ut);fe.activeTexture.set(me.TEXTURE0),yr.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE);let wi=c.globePoleMatrixForTile(Mt,xt,we);const Gr=c.globeNormalizeECEF(c.globeTileBounds(ut.canonical)),sn=(nn,ln)=>nn.draw(fe,me.TRIANGLES,je,c.StencilMode.disabled,qe,c.CullFaceMode.disabled,al(we.projMatrix,wi,wi,Gr,0,$e,we.frustumCorners.TL,we.frustumCorners.TR,we.frustumCorners.BR,we.frustumCorners.BL,we.globeCenterInViewSpace,we.globeRadius,nt,0),"globe_pole_raster",ln,Fi,ur);N.setupElevationDraw(yr,de,dt),q.prepareDrawProgram(fe,de,ut.toUnwrapped()),Ut&&sn(de,Ai),Si&&(wi=c.scale(c.create(),wi,[1,-1,1]),sn(de,ui))}}}})(x,E,z,k,B);else{const q=x.context,N=q.gl;let H,ne;const ce=x.options.showTerrainWireframe?2:0,fe=(we,Ee)=>{if(ne===we)return;const Fe=[Pr[we]];Ee&&Fe.push(Pr[ce]),H=x.useProgram("terrainRaster",null,Fe),ne=we},me=x.colorModeForRenderPass(),de=new c.DepthMode(N.LEQUAL,c.DepthMode.ReadWrite,x.depthRangeFor3D);Ya.update(B);const Y=x.transform,ue=Wl(Y.zoom)*E.exaggeration();(ce?[!1,!0]:[!1]).forEach(we=>{ne=-1;const Ee=we?N.LINES:N.TRIANGLES,[Fe,qe]=we?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const je of k){const Ke=z.getTile(je),$e=c.StencilMode.disabled,ct=E.prevTerrainTileForTile[je.key],Bt=E.terrainTileForTile[je.key];wl(ct,Bt)&&Ya.newMorphing(je.key,ct,Bt,B,250),q.activeTexture.set(N.TEXTURE0),Ke.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST);const nt=Ya.getMorphValuesForProxy(je.key),Tt=nt?1:0;let dt;nt&&(dt={morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:c.easeCubicInOut(nt.phase)}});const kt=Ka(je.projMatrix,gh(je.canonical,Y.renderWorldCopies)?ue/10:ue);fe(Tt,we),E.setupElevationDraw(Ke,H,dt),x.prepareDrawProgram(q,H,je.toUnwrapped()),H.draw(q,Ee,de,$e,me,c.CullFaceMode.backCCW,kt,"terrain_raster",E.gridBuffer,Fe,qe)}})}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,g=this.painter.context,x=this.proxySourceCache,E=this.proxiedCoords[x.id],z=this._drapedRenderBatches.shift(),k=[],B=l.style.order;let q=0;for(const N of E){const H=x.getTileByID(N.proxyTileKey),ne=x.proxyCachedFBO[N.key]?x.proxyCachedFBO[N.key][n]:void 0,ce=ne!==void 0?x.renderCache[ne]:this.pool[q++],fe=ne!==void 0;if(H.texture=ce.tex,fe&&!ce.dirty){k.push(H.tileID);continue}let me;g.bindFramebuffer.set(ce.fb.framebuffer),this.renderedToTile=!1,ce.dirty&&(g.clear({color:c.Color.transparent,stencil:0}),ce.dirty=!1);for(let de=z.start;de<=z.end;++de){const Y=l.style._layers[B[de]];if(Y.isHidden(l.transform.zoom))continue;const ue=l.style._getLayerSourceCache(Y),we=ue?this.proxyToSource[N.key][ue.id]:[N];if(!we)continue;const Ee=we;g.viewport.set([0,0,ce.fb.width,ce.fb.height]),me!==(ue?ue.id:null)&&(this._setupStencil(ce,we,Y,ue),me=ue?ue.id:null),l.renderLayer(l,ue,Y,Ee)}this.renderedToTile?(ce.dirty=!0,k.push(H.tileID)):fe||--q,q===5&&(q=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,l.width,l.height]),z.end+1}postRender(){}renderCacheEfficiency(n){const l=n.order.length;if(l===0)return{efficiency:100};let g,x=0,E=0,z=!1;for(let k=0;k<l;++k){const B=n._layers[n.order[k]];this._style.isLayerDraped(B)?(z&&++x,++E):z||(z=!0,g=B.id)}return E===0?{efficiency:100}:{efficiency:100*(1-x/E),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,l,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const z=E.tileID,k=1<<z.overscaledZ,{x:B,y:q}=z.canonical,N=B/k,H=(B+1)/k,ne=q/k,ce=(q+1)/k;return{minx:N,miny:ne,maxx:H,maxy:ce,t:E.dem.tree.raycastRoot(N,ne,H,ce,n,l,g),tile:E}});x.sort((E,z)=>(E.t!==null?E.t:Number.MAX_VALUE)-(z.t!==null?z.t:Number.MAX_VALUE));for(const E of x){if(E.t==null)return null;const z=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,n,l,g);if(z!=null)return z}return null}_createFBO(){const n=this.painter.context,l=n.gl,g=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const x=new c.Texture(n,{width:g[0],height:g[1],data:null},l.RGBA);x.bind(l.LINEAR,l.CLAMP_TO_EDGE);const E=n.createFramebuffer(g[0],g[1],!1);return E.colorAttachment.set(x.texture),E.depthAttachment=new Ge(n,E.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:E,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._layers[n],g=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!g&&l.shouldRedrape():!g&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const g of this._style._getSources())if(g instanceof Pt){n=!0;break}if(!n)return;const l={};for(let g=0;g<this._style.order.length;++g){const x=this._style._layers[this._style.order[g]],E=this._style._getLayerSourceCache(x);if(E&&!l[E.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof c.ZoomDependentExpression){l[E.id]=!0;for(const z of this.proxyCoords){const k=this.proxyToSource[z.key][E.id];if(k)for(const B of k)this._clearRenderCacheForTile(E.id,B)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const g in this._style._sourceCaches)if(this._style._sourceCaches[g]._source instanceof Et){n=!0;break}if(!n)return;const l={};for(let g=0;g<this._style.order.length;++g){const x=this._style._layers[this._style.order[g]],E=this._style._getLayerSourceCache(x);if(!E||l[E.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const z=x.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const B=this.proxyToSource[k.key][E.id];if(B)for(const q of B){const N=ju(E.getTile(q),E.findLoadedParent(q,0),E,this.painter.transform,z);(N.opacity!==1||N.mix!==0)&&this._clearRenderCacheForTile(E.id,q)}}}}_setupDrapedRenderBatches(){const n=this._style.order,l=n.length;if(l===0)return;const g=[];let x,E=0,z=this._style._layers[n[E]];for(;!this._style.isLayerDraped(z)&&z.isHidden(this.painter.transform.zoom)&&++E<l;)z=this._style._layers[n[E]];for(;E<l;++E){const k=this._style._layers[n[E]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?x===void 0&&(x=E):x!==void 0&&(g.push({start:x,end:E-1}),x=void 0))}x!==void 0&&g.push({start:x,end:E-1}),this._drapedRenderBatches=g}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const z=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let k=0;k<z.length;++k){const B=Object.values(z[k]);l.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let z=g.length-1;z>=0;z--){const k=g[z];if(l.getTileByID(k.key),l.proxyCachedFBO[k.key]!==void 0){const B=n[k.key],q=this.proxyToSource[k.key];let N=0;for(const H in q){const ne=q[H],ce=B[H];if(!ce||ce.length!==ne.length||ne.some((fe,me)=>fe!==ce[me]||x[H]&&x[H].hasOwnProperty(fe.key))){N=-1;break}++N}for(const H in l.proxyCachedFBO[k.key])l.renderCache[l.proxyCachedFBO[k.key][H]].dirty=N<0||N!==Object.values(B).length}}const E=[...this._drapedRenderBatches];E.sort((z,k)=>k.end-k.start-(z.end-z.start));for(const z of E)for(const k of g){if(l.proxyCachedFBO[k.key])continue;let B=l.renderCachePool.pop();B===void 0&&l.renderCache.length<50&&(B=l.renderCache.length,l.renderCache.push(this._createFBO())),B!==void 0&&(l.proxyCachedFBO[k.key]={},l.proxyCachedFBO[k.key][z.start]=B,l.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,z=E.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let k;if(g.isTileClipped())k=l.length,this._overlapStencilMode.test={func:z.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:z.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(n,l){const g=this.painter,x=this.painter.context,E=x.gl;g._tileClippingMaskIDs={},x.setColorMode(c.ColorMode.disabled),x.setDepthMode(c.DepthMode.disabled);const z=g.useProgram("clippingMask");for(const k of n){const B=g._tileClippingMaskIDs[k.key]=--l;z.draw(x,E.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:E.ALWAYS,mask:0},B,255,E.KEEP,E.KEEP,E.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Vs(k.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const g=[n.x,n.y,1,1];c.transformMat4$1(g,g,l.pixelMatrixInverse),c.scale$1(g,g,1/g[3]),g[0]/=l.worldSize,g[1]/=l.worldSize;const x=l._camera.position,E=c.mercatorZfromAltitude(1,l.center.lat),z=[x[0],x[1],x[2]/E,0],k=c.subtract([],g.slice(0,3),z);c.normalize(k,k);const B=this.raycast(z,k,this._exaggeration);return B!==null&&B?(c.scaleAndAdd(z,z,k,B),z[3]=z[2],z[2]*=E,z):null}drawDepth(){const n=this.painter,l=n.context,g=this.proxySourceCache,x=Math.ceil(n.width),E=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const z=l.gl,k=l.createFramebuffer(x,E,!0);l.activeTexture.set(z.TEXTURE0);const B=new c.Texture(l,{width:x,height:E,data:null},z.RGBA);B.bind(z.NEAREST,z.CLAMP_TO_EDGE),k.colorAttachment.set(B.texture);const q=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,x,E);k.depthAttachment.set(q),this._depthFBO=k,this._depthTexture=B}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,x,E]),function(z,k,B,q){if(z.transform.projection.name==="globe")return;const N=z.context,H=N.gl;N.clear({depth:1});const ne=z.useProgram("terrainDepth"),ce=new c.DepthMode(H.LESS,c.DepthMode.ReadWrite,z.depthRangeFor3D);for(const fe of q){const me=B.getTile(fe),de=Ka(fe.projMatrix,0);k.setupElevationDraw(me,ne),ne.draw(N,H.TRIANGLES,ce,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,de,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(n,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,l,g){if(n.getSource()instanceof Li)return this._setupProxiedCoordsForImageSource(n,l,g);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],E=this.proxyCoords;for(let k=0;k<E.length;k++){const B=E[k],q=this._findTileCoveringTileID(B,n);if(q){const N=this._createProxiedId(B,q,g[B.key]&&g[B.key][n.id]);x.push(N),this.proxyToSource[B.key][n.id]=[N]}}let z=!1;for(let k=0;k<l.length;k++){const B=n.getTile(l[k]);if(!B||!B.hasData())continue;const q=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(q&&q.tileID.canonical.z!==B.tileID.canonical.z){const N=this.proxyToSource[q.tileID.key][n.id],H=this._createProxiedId(q.tileID,B,g[q.tileID.key]&&g[q.tileID.key][n.id]);N?N.splice(N.length-1,0,H):this.proxyToSource[q.tileID.key][n.id]=[H],x.push(H),z=!0}}this._sourceTilesOverlap[n.id]=z}_setupProxiedCoordsForImageSource(n,l,g){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],E=this.proxyCoords,z=n.getSource(),k=new c.Point(z.tileID.x,z.tileID.y)._div(1<<z.tileID.z),B=z.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((N,H)=>(N.min.x=Math.min(N.min.x,H.x-k.x),N.min.y=Math.min(N.min.y,H.y-k.y),N.max.x=Math.max(N.max.x,H.x-k.x),N.max.y=Math.max(N.max.y,H.y-k.y),N),{min:new c.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),q=(N,H)=>{const ne=N.wrap+N.canonical.x/(1<<N.canonical.z),ce=N.canonical.y/(1<<N.canonical.z),fe=c.EXTENT/(1<<N.canonical.z),me=H.wrap+H.canonical.x/(1<<H.canonical.z),de=H.canonical.y/(1<<H.canonical.z);return ne+fe<me+B.min.x||ne>me+B.max.x||ce+fe<de+B.min.y||ce>de+B.max.y};for(let N=0;N<E.length;N++){const H=E[N];for(let ne=0;ne<l.length;ne++){const ce=n.getTile(l[ne]);if(!ce||!ce.hasData()||q(H,ce.tileID))continue;const fe=this._createProxiedId(H,ce,g[H.key]&&g[H.key][n.id]),me=this.proxyToSource[H.key][n.id];me?me.push(fe):this.proxyToSource[H.key][n.id]=[fe],x.push(fe)}}}_createProxiedId(n,l,g){let x=this.orthoMatrix;if(g){const E=g.find(z=>z.key===l.tileID.key);if(E)return E}if(l.tileID.key!==n.key){const E=n.canonical.z-l.tileID.canonical.z;let z,k,B;x=c.create();const q=l.tileID.wrap-n.wrap<<n.overscaledZ;E>0?(z=c.EXTENT>>E,k=z*((l.tileID.canonical.x<<E)-n.canonical.x+q),B=z*((l.tileID.canonical.y<<E)-n.canonical.y)):(z=c.EXTENT<<-E,k=c.EXTENT*(l.tileID.canonical.x-(n.canonical.x+q<<-E)),B=c.EXTENT*(l.tileID.canonical.y-(n.canonical.y<<-E))),c.ortho(x,0,z,0,z,0,1),c.translate(x,x,[k,B,0])}return new uu(l.tileID,n.key,x)}_findTileCoveringTileID(n,l){let g=l.getTile(n);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[l.id],E=x[n.key];if(g=E?l.getTileByID(E):null,g&&g.hasData()||E===null)return g;let z=g?g.tileID:n,k=z.overscaledZ;const B=l.getSource().minzoom,q=[];if(!E){const H=l.getSource().maxzoom;if(n.canonical.z>=H){const ne=n.canonical.z-H;l.getSource().reparseOverscaled?(k=Math.max(n.canonical.z+2,l.transform.tileZoom),z=new c.OverscaledTileID(k,n.wrap,H,n.canonical.x>>ne,n.canonical.y>>ne)):ne!==0&&(k=H,z=new c.OverscaledTileID(k,n.wrap,H,n.canonical.x>>ne,n.canonical.y>>ne))}z.key!==n.key&&(q.push(z.key),g=l.getTile(z))}const N=H=>{q.forEach(ne=>{x[ne]=H}),q.length=0};for(k-=1;k>=B&&(!g||!g.hasData());k--){g&&N(g.tileID.key);const H=z.calculateScaledKey(k);if(g=l.getTileByID(H),g&&g.hasData())break;const ne=x[H];if(ne===null)break;ne===void 0?q.push(H):g=l.getTileByID(ne)}return N(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let g=this._tilesDirty[n];g||(g=this._tilesDirty[n]={}),g[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(l){let g=0;const x=new c.StructArrayLayout2ui4,E=131;for(let z=1;z<129;z++){for(let k=1;k<129;k++)g=z*E+k,x.emplaceBack(g,g+1),x.emplaceBack(g,g+E),x.emplaceBack(g+1,g+E),z===128&&x.emplaceBack(g+E,g+E+1);x.emplaceBack(g+1,g+1+E)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Tr{static cacheKey(n,l,g,x){let E=`${l}${x?x.cacheKey:""}`;for(const z of g)n.usedDefines.includes(z)&&(E+=`/${z}`);return E}constructor(n,l,g,x,E,z){const k=n.gl;this.program=k.createProgram();const B=function(Y){const ue=[];for(let we=0;we<Y.length;we++){if(Y[we]===null)continue;const Ee=Y[we].split(" ");ue.push(Ee.pop())}return ue}(g.staticAttributes),q=x?x.getBinderAttributes():[],N=B.concat(q);let H=x?x.defines():[];H=H.concat(z.map(Y=>`#define ${Y}`));const ne=n.isWebGL2?`#version 300 es
`:"",ce=ne+H.concat(n.extStandardDerivatives&&ne.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Uu):Uu,Uu,cu,_h.fragmentSource,fc.fragmentSource,g.fragmentSource).join(`
`),fe=ne+H.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,cu,_h.vertexSource,fc.vertexSource,nl.vertexSource,g.vertexSource).join(`
`),me=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(me,ce),k.compileShader(me),k.attachShader(this.program,me);const de=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(de,fe),k.compileShader(de),k.attachShader(this.program,de),this.attributes={},this.numAttributes=N.length;for(let Y=0;Y<this.numAttributes;Y++)N[Y]&&(k.bindAttribLocation(this.program,Y,N[Y]),this.attributes[N[Y]]=Y);k.linkProgram(this.program),k.deleteShader(de),k.deleteShader(me),this.fixedUniforms=E(n),this.binderUniforms=x?x.getUniforms(n):[],z.includes("TERRAIN")&&(this.terrainUniforms=(Y=>({u_dem:new c.Uniform1i(Y),u_dem_prev:new c.Uniform1i(Y),u_dem_unpack:new c.Uniform4f(Y),u_dem_tl:new c.Uniform2f(Y),u_dem_scale:new c.Uniform1f(Y),u_dem_tl_prev:new c.Uniform2f(Y),u_dem_scale_prev:new c.Uniform1f(Y),u_dem_size:new c.Uniform1f(Y),u_dem_lerp:new c.Uniform1f(Y),u_exaggeration:new c.Uniform1f(Y),u_depth:new c.Uniform1i(Y),u_depth_size_inv:new c.Uniform2f(Y),u_meter_to_dem:new c.Uniform1f(Y),u_label_plane_matrix_inv:new c.UniformMatrix4f(Y)}))(n)),z.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new c.Uniform3f(Y),u_tile_tr_up:new c.Uniform3f(Y),u_tile_br_up:new c.Uniform3f(Y),u_tile_bl_up:new c.Uniform3f(Y),u_tile_up_scale:new c.Uniform1f(Y)}))(n)),z.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new c.UniformMatrix4f(Y),u_fog_range:new c.Uniform2f(Y),u_fog_color:new c.Uniform4f(Y),u_fog_horizon_blend:new c.Uniform1f(Y),u_fog_temporal_offset:new c.Uniform1f(Y),u_frustum_tl:new c.Uniform3f(Y),u_frustum_tr:new c.Uniform3f(Y),u_frustum_br:new c.Uniform3f(Y),u_frustum_bl:new c.Uniform3f(Y),u_globe_pos:new c.Uniform3f(Y),u_globe_radius:new c.Uniform1f(Y),u_globe_transition:new c.Uniform1f(Y),u_is_globe:new c.Uniform1i(Y),u_viewport:new c.Uniform2f(Y)}))(n))}}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in l)g[x]&&g[x].set(this.program,x,l[x])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in l)g[x]&&g[x].set(this.program,x,l[x])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in l)g[x].set(this.program,x,l[x])}}draw(n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe,me){const de=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(g),n.setStencilMode(x),n.setColorMode(E),n.setCullFace(z);for(const ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,k[ue]);fe&&fe.setUniforms(this.program,n,this.binderUniforms,ne,{zoom:ce});const Y={[de.LINES]:2,[de.TRIANGLES]:3,[de.LINE_STRIP]:1}[l];for(const ue of H.get()){const we=ue.vaos||(ue.vaos={});(we[B]||(we[B]=new mc)).bind(n,this,q,fe?fe.getPaintVertexBuffers():[],N,ue.vertexOffset,me||[]),de.drawElements(l,ue.primitiveLength*Y,de.UNSIGNED_SHORT,ue.primitiveOffset*Y*2)}}}function Tl(m,n){const l=Math.pow(2,n.tileID.overscaledZ),g=n.tileSize*Math.pow(2,m.transform.tileZoom)/l,x=g*(n.tileID.canonical.x+n.tileID.wrap*l),E=g*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/hn(n,1,m.transform.tileZoom),u_pixel_coord_upper:[x>>16,E>>16],u_pixel_coord_lower:[65535&x,65535&E]}}const yc=c.create(),Ns=(m,n,l,g,x,E,z,k,B,q,N)=>{const H=n.style.light,ne=H.properties.get("position"),ce=[ne.x,ne.y,ne.z],fe=c.create$1();H.properties.get("anchor")==="viewport"&&(c.fromRotation(fe,-n.transform.angle),c.transformMat3(ce,ce,fe));const me=H.properties.get("color"),de=n.transform,Y={u_matrix:m,u_lightpos:ce,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_vertical_gradient:+l,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:E};return de.projection.name==="globe"&&(Y.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],Y.u_zoom_transition=B,Y.u_inv_rot_matrix=N,Y.u_merc_center=q,Y.u_up_dir=de.projection.upVector(new c.CanonicalTileID(0,0,0),q[0]*c.EXTENT,q[1]*c.EXTENT),Y.u_height_lift=k),Y},qu=(m,n,l,g,x,E,z,k,B,q,N,H)=>{const ne=Ns(m,n,l,g,x,E,z,B,q,N,H),ce={u_height_factor:-Math.pow(2,z.overscaledZ)/k.tileSize/8};return c.extend(ne,Tl(n,k),ce)},ys=m=>({u_matrix:m}),Da=(m,n,l)=>c.extend(ys(m),Tl(n,l)),Gu=(m,n)=>({u_matrix:m,u_world:n}),Zu=(m,n,l,g)=>c.extend(Da(m,n,l),{u_world:g}),yh=c.create(),El=(m,n,l,g,x,E)=>{const z=m.transform,k=z.projection.name==="globe";let B;if(E.paint.get("circle-pitch-alignment")==="map")if(k){const N=c.globePixelsToTileUnits(z.zoom,n.canonical)*z._pixelsPerMercatorPixel;B=Float32Array.from([N,0,0,N])}else B=z.calculatePixelsToTileUnitsMatrix(l);else B=new Float32Array([z.pixelsToGLUnits[0],0,0,z.pixelsToGLUnits[1]]);const q={u_camera_to_center_distance:z.cameraToCenterDistance,u_matrix:m.translatePosMatrix(n.projMatrix,l,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:B,u_inv_rot_matrix:yh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){q.u_inv_rot_matrix=g,q.u_merc_center=x,q.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],q.u_zoom_transition=c.globeToMercatorTransition(z.zoom);const N=x[0]*c.EXTENT,H=x[1]*c.EXTENT;q.u_up_dir=z.projection.upVector(new c.CanonicalTileID(0,0,0),N,H)}return q},Hl=m=>{const n=[];return m.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},vc=(m,n,l,g)=>{const x=c.EXTENT/l.tileSize;return{u_matrix:m,u_camera_to_center_distance:n.getCameraToCenterDistance(g),u_extrude_scale:[n.pixelsToGLUnits[0]/x,n.pixelsToGLUnits[1]/x]}},hu=(m,n,l=1)=>({u_matrix:m,u_color:n,u_overlay:0,u_overlay_scale:l}),jc=c.create(),vh=(m,n,l,g,x,E,z)=>{const k=m.transform,B=k.projection.name==="globe",q=B?c.globePixelsToTileUnits(k.zoom,n.canonical)*k._pixelsPerMercatorPixel:hn(l,1,E),N={u_matrix:n.projMatrix,u_extrude_scale:q,u_intensity:z,u_inv_rot_matrix:jc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){N.u_inv_rot_matrix=g,N.u_merc_center=x,N.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],N.u_zoom_transition=c.globeToMercatorTransition(k.zoom);const H=x[0]*c.EXTENT,ne=x[1]*c.EXTENT;N.u_up_dir=k.projection.upVector(new c.CanonicalTileID(0,0,0),H,ne)}return N},pu=(m,n,l,g,x,E,z)=>{const k=m.transform,B=k.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:du(m,n,l,g),u_pixels_to_tile_units:B,u_device_pixel_ratio:E,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:Al(l)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Il(n,m.transform),u_alpha_discard_threshold:0,u_trim_offset:z}},Sl=(m,n,l,g,x)=>{const E=m.transform;return{u_matrix:du(m,n,l,g),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Il(n,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Il(m,n){return 1/hn(m,1,n.tileZoom)}function du(m,n,l,g){return m.translatePosMatrix(g||n.tileID.projMatrix,n,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Al(m){const n=m.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const qc=(m,n,l,g,x,E)=>{return{u_matrix:m,u_tl_parent:n,u_scale_parent:l,u_fade_t:g.mix,u_opacity:g.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(k=x.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(z=x.paint.get("raster-contrast"),z>0?1/(1-z):1+z),u_spin_weights:vs(x.paint.get("raster-hue-rotate")),u_perspective_transform:E};var z,k};function vs(m){m*=Math.PI/180;const n=Math.sin(m),l=Math.cos(m);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const xc=c.create(),Gc=(m,n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe,me)=>{const de=x.transform,Y={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:de.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:de.width/de.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:z,u_coord_matrix:k,u_is_text:+B,u_pitch_with_map:+g,u_texsize:q,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xc,u_up_vector:[0,-1,0]};return me.name==="globe"&&(Y.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],Y.u_zoom_transition=H,Y.u_inv_rot_matrix=ce,Y.u_merc_center=ne,Y.u_camera_forward=de._camera.forward(),Y.u_ecef_origin=c.globeECEFOrigin(de.globeMatrix,N.toUnwrapped()),Y.u_tile_matrix=Float32Array.from(de.globeMatrix),Y.u_up_vector=fe),Y},bc=(m,n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe,me,de)=>c.extend(Gc(m,n,l,g,x,E,z,k,B,q,H,ne,ce,fe,me,de),{u_gamma_scale:g?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+N}),sl=(m,n,l,g,x,E,z,k,B,q,N,H,ne,ce,fe,me)=>c.extend(bc(m,n,l,g,x,E,z,k,!0,B,!0,N,H,ne,ce,fe,me),{u_texsize_icon:q,u_texture_icon:1}),fu=(m,n,l)=>({u_matrix:m,u_opacity:n,u_color:l}),xh=(m,n,l,g,x)=>c.extend(function(E,z,k){const B=z.imageManager.getPattern(E.toString()),{width:q,height:N}=z.imageManager.getPixelSize(),H=Math.pow(2,k.tileID.overscaledZ),ne=k.tileSize*Math.pow(2,z.transform.tileZoom)/H,ce=ne*(k.tileID.canonical.x+k.tileID.wrap*H),fe=ne*k.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[q,N],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/hn(k,1,z.transform.tileZoom),u_pixel_coord_upper:[ce>>16,fe>>16],u_pixel_coord_lower:[65535&ce,65535&fe]}}(g,l,x),{u_matrix:m,u_opacity:n}),mu={fillExtrusion:m=>({u_matrix:new c.UniformMatrix4f(m),u_lightpos:new c.Uniform3f(m),u_lightintensity:new c.Uniform1f(m),u_lightcolor:new c.Uniform3f(m),u_vertical_gradient:new c.Uniform1f(m),u_opacity:new c.Uniform1f(m),u_edge_radius:new c.Uniform1f(m),u_ao:new c.Uniform2f(m),u_tile_id:new c.Uniform3f(m),u_zoom_transition:new c.Uniform1f(m),u_inv_rot_matrix:new c.UniformMatrix4f(m),u_merc_center:new c.Uniform2f(m),u_up_dir:new c.Uniform3f(m),u_height_lift:new c.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new c.UniformMatrix4f(m),u_lightpos:new c.Uniform3f(m),u_lightintensity:new c.Uniform1f(m),u_lightcolor:new c.Uniform3f(m),u_vertical_gradient:new c.Uniform1f(m),u_height_factor:new c.Uniform1f(m),u_edge_radius:new c.Uniform1f(m),u_ao:new c.Uniform2f(m),u_tile_id:new c.Uniform3f(m),u_zoom_transition:new c.Uniform1f(m),u_inv_rot_matrix:new c.UniformMatrix4f(m),u_merc_center:new c.Uniform2f(m),u_up_dir:new c.Uniform3f(m),u_height_lift:new c.Uniform1f(m),u_image:new c.Uniform1i(m),u_texsize:new c.Uniform2f(m),u_pixel_coord_upper:new c.Uniform2f(m),u_pixel_coord_lower:new c.Uniform2f(m),u_tile_units_to_pixels:new c.Uniform1f(m),u_opacity:new c.Uniform1f(m)}),fill:m=>({u_matrix:new c.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new c.UniformMatrix4f(m),u_image:new c.Uniform1i(m),u_texsize:new c.Uniform2f(m),u_pixel_coord_upper:new c.Uniform2f(m),u_pixel_coord_lower:new c.Uniform2f(m),u_tile_units_to_pixels:new c.Uniform1f(m)}),fillOutline:m=>({u_matrix:new c.UniformMatrix4f(m),u_world:new c.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new c.UniformMatrix4f(m),u_world:new c.Uniform2f(m),u_image:new c.Uniform1i(m),u_texsize:new c.Uniform2f(m),u_pixel_coord_upper:new c.Uniform2f(m),u_pixel_coord_lower:new c.Uniform2f(m),u_tile_units_to_pixels:new c.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new c.Uniform1f(m),u_extrude_scale:new c.UniformMatrix2f(m),u_device_pixel_ratio:new c.Uniform1f(m),u_matrix:new c.UniformMatrix4f(m),u_inv_rot_matrix:new c.UniformMatrix4f(m),u_merc_center:new c.Uniform2f(m),u_tile_id:new c.Uniform3f(m),u_zoom_transition:new c.Uniform1f(m),u_up_dir:new c.Uniform3f(m)}),collisionBox:m=>({u_matrix:new c.UniformMatrix4f(m),u_camera_to_center_distance:new c.Uniform1f(m),u_extrude_scale:new c.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new c.UniformMatrix4f(m),u_inv_matrix:new c.UniformMatrix4f(m),u_camera_to_center_distance:new c.Uniform1f(m),u_viewport_size:new c.Uniform2f(m)}),debug:m=>({u_color:new c.UniformColor(m),u_matrix:new c.UniformMatrix4f(m),u_overlay:new c.Uniform1i(m),u_overlay_scale:new c.Uniform1f(m)}),clippingMask:m=>({u_matrix:new c.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new c.Uniform1f(m),u_intensity:new c.Uniform1f(m),u_matrix:new c.UniformMatrix4f(m),u_inv_rot_matrix:new c.UniformMatrix4f(m),u_merc_center:new c.Uniform2f(m),u_tile_id:new c.Uniform3f(m),u_zoom_transition:new c.Uniform1f(m),u_up_dir:new c.Uniform3f(m)}),heatmapTexture:m=>({u_image:new c.Uniform1i(m),u_color_ramp:new c.Uniform1i(m),u_opacity:new c.Uniform1f(m)}),hillshade:m=>({u_matrix:new c.UniformMatrix4f(m),u_image:new c.Uniform1i(m),u_latrange:new c.Uniform2f(m),u_light:new c.Uniform2f(m),u_shadow:new c.UniformColor(m),u_highlight:new c.UniformColor(m),u_accent:new c.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new c.UniformMatrix4f(m),u_image:new c.Uniform1i(m),u_dimension:new c.Uniform2f(m),u_zoom:new c.Uniform1f(m),u_unpack:new c.Uniform4f(m)}),line:m=>({u_matrix:new c.UniformMatrix4f(m),u_pixels_to_tile_units:new c.UniformMatrix2f(m),u_device_pixel_ratio:new c.Uniform1f(m),u_units_to_pixels:new c.Uniform2f(m),u_dash_image:new c.Uniform1i(m),u_gradient_image:new c.Uniform1i(m),u_image_height:new c.Uniform1f(m),u_texsize:new c.Uniform2f(m),u_tile_units_to_pixels:new c.Uniform1f(m),u_alpha_discard_threshold:new c.Uniform1f(m),u_trim_offset:new c.Uniform2f(m)}),linePattern:m=>({u_matrix:new c.UniformMatrix4f(m),u_texsize:new c.Uniform2f(m),u_pixels_to_tile_units:new c.UniformMatrix2f(m),u_device_pixel_ratio:new c.Uniform1f(m),u_image:new c.Uniform1i(m),u_units_to_pixels:new c.Uniform2f(m),u_tile_units_to_pixels:new c.Uniform1f(m),u_alpha_discard_threshold:new c.Uniform1f(m)}),raster:m=>({u_matrix:new c.UniformMatrix4f(m),u_tl_parent:new c.Uniform2f(m),u_scale_parent:new c.Uniform1f(m),u_fade_t:new c.Uniform1f(m),u_opacity:new c.Uniform1f(m),u_image0:new c.Uniform1i(m),u_image1:new c.Uniform1i(m),u_brightness_low:new c.Uniform1f(m),u_brightness_high:new c.Uniform1f(m),u_saturation_factor:new c.Uniform1f(m),u_contrast_factor:new c.Uniform1f(m),u_spin_weights:new c.Uniform3f(m),u_perspective_transform:new c.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new c.Uniform1i(m),u_is_size_feature_constant:new c.Uniform1i(m),u_size_t:new c.Uniform1f(m),u_size:new c.Uniform1f(m),u_camera_to_center_distance:new c.Uniform1f(m),u_rotate_symbol:new c.Uniform1i(m),u_aspect_ratio:new c.Uniform1f(m),u_fade_change:new c.Uniform1f(m),u_matrix:new c.UniformMatrix4f(m),u_label_plane_matrix:new c.UniformMatrix4f(m),u_coord_matrix:new c.UniformMatrix4f(m),u_is_text:new c.Uniform1i(m),u_pitch_with_map:new c.Uniform1i(m),u_texsize:new c.Uniform2f(m),u_tile_id:new c.Uniform3f(m),u_zoom_transition:new c.Uniform1f(m),u_inv_rot_matrix:new c.UniformMatrix4f(m),u_merc_center:new c.Uniform2f(m),u_camera_forward:new c.Uniform3f(m),u_tile_matrix:new c.UniformMatrix4f(m),u_up_vector:new c.Uniform3f(m),u_ecef_origin:new c.Uniform3f(m),u_texture:new c.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new c.Uniform1i(m),u_is_size_feature_constant:new c.Uniform1i(m),u_size_t:new c.Uniform1f(m),u_size:new c.Uniform1f(m),u_camera_to_center_distance:new c.Uniform1f(m),u_rotate_symbol:new c.Uniform1i(m),u_aspect_ratio:new c.Uniform1f(m),u_fade_change:new c.Uniform1f(m),u_matrix:new c.UniformMatrix4f(m),u_label_plane_matrix:new c.UniformMatrix4f(m),u_coord_matrix:new c.UniformMatrix4f(m),u_is_text:new c.Uniform1i(m),u_pitch_with_map:new c.Uniform1i(m),u_texsize:new c.Uniform2f(m),u_texture:new c.Uniform1i(m),u_gamma_scale:new c.Uniform1f(m),u_device_pixel_ratio:new c.Uniform1f(m),u_tile_id:new c.Uniform3f(m),u_zoom_transition:new c.Uniform1f(m),u_inv_rot_matrix:new c.UniformMatrix4f(m),u_merc_center:new c.Uniform2f(m),u_camera_forward:new c.Uniform3f(m),u_tile_matrix:new c.UniformMatrix4f(m),u_up_vector:new c.Uniform3f(m),u_ecef_origin:new c.Uniform3f(m),u_is_halo:new c.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new c.Uniform1i(m),u_is_size_feature_constant:new c.Uniform1i(m),u_size_t:new c.Uniform1f(m),u_size:new c.Uniform1f(m),u_camera_to_center_distance:new c.Uniform1f(m),u_rotate_symbol:new c.Uniform1i(m),u_aspect_ratio:new c.Uniform1f(m),u_fade_change:new c.Uniform1f(m),u_matrix:new c.UniformMatrix4f(m),u_label_plane_matrix:new c.UniformMatrix4f(m),u_coord_matrix:new c.UniformMatrix4f(m),u_is_text:new c.Uniform1i(m),u_pitch_with_map:new c.Uniform1i(m),u_texsize:new c.Uniform2f(m),u_texsize_icon:new c.Uniform2f(m),u_texture:new c.Uniform1i(m),u_texture_icon:new c.Uniform1i(m),u_gamma_scale:new c.Uniform1f(m),u_device_pixel_ratio:new c.Uniform1f(m),u_is_halo:new c.Uniform1i(m)}),background:m=>({u_matrix:new c.UniformMatrix4f(m),u_opacity:new c.Uniform1f(m),u_color:new c.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new c.UniformMatrix4f(m),u_opacity:new c.Uniform1f(m),u_image:new c.Uniform1i(m),u_pattern_tl:new c.Uniform2f(m),u_pattern_br:new c.Uniform2f(m),u_texsize:new c.Uniform2f(m),u_pattern_size:new c.Uniform2f(m),u_pixel_coord_upper:new c.Uniform2f(m),u_pixel_coord_lower:new c.Uniform2f(m),u_tile_units_to_pixels:new c.Uniform1f(m)}),terrainRaster:_c,terrainDepth:_c,skybox:m=>({u_matrix:new c.UniformMatrix4f(m),u_sun_direction:new c.Uniform3f(m),u_cubemap:new c.Uniform1i(m),u_opacity:new c.Uniform1f(m),u_temporal_offset:new c.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new c.UniformMatrix4f(m),u_color_ramp:new c.Uniform1i(m),u_center_direction:new c.Uniform3f(m),u_radius:new c.Uniform1f(m),u_opacity:new c.Uniform1f(m),u_temporal_offset:new c.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new c.UniformMatrix3f(m),u_sun_direction:new c.Uniform3f(m),u_sun_intensity:new c.Uniform1f(m),u_color_tint_r:new c.Uniform4f(m),u_color_tint_m:new c.Uniform4f(m),u_luminance:new c.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new c.UniformMatrix4f(m),u_globe_matrix:new c.UniformMatrix4f(m),u_normalize_matrix:new c.UniformMatrix4f(m),u_merc_matrix:new c.UniformMatrix4f(m),u_zoom_transition:new c.Uniform1f(m),u_merc_center:new c.Uniform2f(m),u_image0:new c.Uniform1i(m),u_grid_matrix:new c.UniformMatrix3f(m),u_skirt_height:new c.Uniform1f(m),u_frustum_tl:new c.Uniform3f(m),u_frustum_tr:new c.Uniform3f(m),u_frustum_br:new c.Uniform3f(m),u_frustum_bl:new c.Uniform3f(m),u_globe_pos:new c.Uniform3f(m),u_globe_radius:new c.Uniform1f(m),u_viewport:new c.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new c.Uniform3f(m),u_frustum_tr:new c.Uniform3f(m),u_frustum_br:new c.Uniform3f(m),u_frustum_bl:new c.Uniform3f(m),u_horizon:new c.Uniform1f(m),u_transition:new c.Uniform1f(m),u_fadeout_range:new c.Uniform1f(m),u_color:new c.Uniform4f(m),u_high_color:new c.Uniform4f(m),u_space_color:new c.Uniform4f(m),u_star_intensity:new c.Uniform1f(m),u_star_density:new c.Uniform1f(m),u_star_size:new c.Uniform1f(m),u_temporal_offset:new c.Uniform1f(m),u_horizon_angle:new c.Uniform1f(m),u_rotation_matrix:new c.UniformMatrix4f(m)})};let Zc;function la(m,n,l,g,x,E,z){const k=m.context,B=k.gl,q=m.transform,N=m.useProgram("collisionBox"),H=[];let ne=0,ce=0;for(let Ee=0;Ee<g.length;Ee++){const Fe=g[Ee],qe=n.getTile(Fe),je=qe.getBucket(l);if(!je)continue;const Ke=Zn(Fe,je,q);let $e=Ke;x[0]===0&&x[1]===0||($e=m.translatePosMatrix(Ke,qe,x,E));const ct=z?je.textCollisionBox:je.iconCollisionBox,Bt=je.collisionCircleArray;if(Bt.length>0){const nt=c.create(),Tt=$e;c.mul(nt,je.placementInvProjMatrix,q.glCoordMatrix),c.mul(nt,nt,je.placementViewportMatrix),H.push({circleArray:Bt,circleOffset:ce,transform:Tt,invTransform:nt,projection:je.getProjection()}),ne+=Bt.length/4,ce=ne}ct&&(m.terrain&&m.terrain.setupElevationDraw(qe,N),N.draw(k,B.LINES,c.DepthMode.disabled,c.StencilMode.disabled,m.colorModeForRenderPass(),c.CullFaceMode.disabled,vc($e,q,qe,je.getProjection()),l.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,null,q.zoom,null,[ct.collisionVertexBuffer,ct.collisionVertexBufferExt]))}if(!z||!H.length)return;const fe=m.useProgram("collisionCircle"),me=new c.StructArrayLayout2f1f2i16;me.resize(4*ne),me._trim();let de=0;for(const Ee of H)for(let Fe=0;Fe<Ee.circleArray.length/4;Fe++){const qe=4*Fe,je=Ee.circleArray[qe+0],Ke=Ee.circleArray[qe+1],$e=Ee.circleArray[qe+2],ct=Ee.circleArray[qe+3];me.emplace(de++,je,Ke,$e,ct,0),me.emplace(de++,je,Ke,$e,ct,1),me.emplace(de++,je,Ke,$e,ct,2),me.emplace(de++,je,Ke,$e,ct,3)}(!Zc||Zc.length<2*ne)&&(Zc=function(Ee){const Fe=2*Ee,qe=new c.StructArrayLayout3ui6;qe.resize(Fe),qe._trim();for(let je=0;je<Fe;je++){const Ke=6*je;qe.uint16[Ke+0]=4*je+0,qe.uint16[Ke+1]=4*je+1,qe.uint16[Ke+2]=4*je+2,qe.uint16[Ke+3]=4*je+2,qe.uint16[Ke+4]=4*je+3,qe.uint16[Ke+5]=4*je+0}return qe}(ne));const Y=k.createIndexBuffer(Zc,!0),ue=k.createVertexBuffer(me,c.collisionCircleLayout.members,!0);for(const Ee of H){const Fe={u_matrix:Ee.transform,u_inv_matrix:Ee.invTransform,u_camera_to_center_distance:(we=q).getCameraToCenterDistance(Ee.projection),u_viewport_size:[we.width,we.height]};fe.draw(k,B.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,m.colorModeForRenderPass(),c.CullFaceMode.disabled,Fe,l.id,ue,Y,c.SegmentVector.simpleSegment(0,2*Ee.circleOffset,Ee.circleArray.length,Ee.circleArray.length/2),null,q.zoom)}var we;ue.destroy(),Y.destroy()}const Xu=c.create();function Ur({width:m,height:n,anchor:l,textOffset:g,textScale:x},E){const{horizontalAlign:z,verticalAlign:k}=c.getAnchorAlignment(l),B=-(z-.5)*m,q=-(k-.5)*n,N=c.evaluateVariableOffset(l,g);return new c.Point((B/x+N[0])*E,(q/x+N[1])*E)}function _u(m,n,l,g,x,E,z,k,B,q,N){const H=m.text.placedSymbolArray,ne=m.text.dynamicLayoutVertexArray,ce=m.icon.dynamicLayoutVertexArray,fe={},me=m.getProjection(),de=on(k,me,E),Y=E.elevation,ue=me.upVectorScale(k.canonical,E.center.lat,E.worldSize).metersToTile;ne.clear();for(let we=0;we<H.length;we++){const Ee=H.get(we),{tileAnchorX:Fe,tileAnchorY:qe,numGlyphs:je}=Ee,Ke=Ee.hidden||!Ee.crossTileID||m.allowVerticalPlacement&&!Ee.placedOrientation?null:g[Ee.crossTileID];if(Ke){let $e=0,ct=0,Bt=0;if(Y){const Ut=Y?Y.getAtTileOffset(k,Fe,qe):0,[Si,Ai,ui]=me.upVector(k.canonical,Fe,qe);$e=Ut*Si*ue,ct=Ut*Ai*ue,Bt=Ut*ui*ue}let[nt,Tt,dt,kt]=_r(Ee.projectedAnchorX+$e,Ee.projectedAnchorY+ct,Ee.projectedAnchorZ+Bt,l?de:z);const ut=ba(E.getCameraToCenterDistance(me),kt);let xt=x.evaluateSizeForFeature(m.textSizeData,q,Ee)*ut/c.ONE_EM;l&&(xt*=m.tilePixelRatio/B);const Lt=Ur(Ke,xt);l?({x:nt,y:Tt,z:dt}=me.projectTilePoint(Fe+Lt.x,qe+Lt.y,k.canonical),[nt,Tt,dt]=_r(nt+$e,Tt+ct,dt+Bt,z)):(n&&Lt._rotate(-E.angle),nt+=Lt.x,Tt+=Lt.y,dt=0);const Mt=m.allowVerticalPlacement&&Ee.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let Ut=0;Ut<je;Ut++)c.addDynamicAttributes(ne,nt,Tt,dt,Mt);N&&Ee.associatedIconIndex>=0&&(fe[Ee.associatedIconIndex]={x:nt,y:Tt,z:dt,angle:Mt})}else _s(je,ne)}if(N){ce.clear();const we=m.icon.placedSymbolArray;for(let Ee=0;Ee<we.length;Ee++){const Fe=we.get(Ee),{numGlyphs:qe}=Fe,je=fe[Ee];if(Fe.hidden||!je)_s(qe,ce);else{const{x:Ke,y:$e,z:ct,angle:Bt}=je;for(let nt=0;nt<qe;nt++)c.addDynamicAttributes(ce,Ke,$e,ct,Bt)}}m.icon.dynamicLayoutVertexBuffer.updateData(ce)}m.text.dynamicLayoutVertexBuffer.updateData(ne)}function La(m,n,l){return l.iconsInText&&n?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function kr(m,n,l,g,x,E,z,k,B,q,N,H){const ne=m.context,ce=ne.gl,fe=m.transform,me=k==="map",de=B==="map",Y=me&&l.layout.get("symbol-placement")!=="point",ue=me&&!de&&!Y,we=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ee=!1;const Fe=m.depthModeForSublayer(0,c.DepthMode.ReadOnly),qe=[c.mercatorXfromLng(fe.center.lng),c.mercatorYfromLat(fe.center.lat)],je=l.layout.get("text-variable-anchor"),Ke=fe.projection.name==="globe",$e=[],ct=[0,-1,0];let Bt=ct;!Ke&&!fe.mercatorFromTransition||me||(Bt=function(nt){const Tt=nt._camera.getWorldToCamera(nt.worldSize,1),dt=c.multiply([],Tt,nt.globeMatrix);c.invert(dt,dt);const kt=[0,0,0],ut=[0,1,0,0];return c.transformMat4$1(ut,ut,dt),kt[0]=ut[0],kt[1]=ut[1],kt[2]=ut[2],c.normalize(kt,kt),kt}(fe));for(const nt of g){const Tt=n.getTile(nt),dt=Tt.getBucket(l);if(!dt||dt.projection.name==="mercator"&&Ke)continue;const kt=x?dt.text:dt.icon;if(!kt||dt.fullyClipped||!kt.segments.get().length)continue;const ut=kt.programConfigurations.get(l.id),xt=x||dt.sdfIcons,Lt=x?dt.textSizeData:dt.iconSizeData,Mt=de||fe.pitch!==0,Ut=c.evaluateSizeForZoom(Lt,fe.zoom);let Si,Ai,ui,Fi,ur=[0,0],yr=null;if(x)Ai=Tt.glyphAtlasTexture,ui=ce.LINEAR,Si=Tt.glyphAtlasTexture.size,dt.iconsInText&&(ur=Tt.imageAtlasTexture.size,yr=Tt.imageAtlasTexture,Fi=Mt||m.options.rotating||m.options.zooming||Lt.kind==="composite"||Lt.kind==="camera"?ce.LINEAR:ce.NEAREST);else{const Ts=l.layout.get("icon-size").constantOr(0)!==1||dt.iconsNeedLinear;Ai=Tt.imageAtlasTexture,ui=xt||m.options.rotating||m.options.zooming||Ts||Mt?ce.LINEAR:ce.NEAREST,Si=Tt.imageAtlasTexture.size}const wi=dt.projection.name==="globe",Gr=wi?Bt:ct,sn=wi?c.globeToMercatorTransition(fe.zoom):0,nn=on(nt,dt.getProjection(),fe),ln=fe.calculatePixelsToTileUnitsMatrix(Tt),Jo=lt(nn,Tt.tileID.canonical,de,me,fe,dt.getProjection(),ln),Hn=m.terrain&&de&&Y?c.invert(c.create(),Jo):Xu,zn=Qi(nn,Tt.tileID.canonical,de,me,fe,dt.getProjection(),ln),Dl=je&&dt.hasTextData(),Pn=l.layout.get("icon-text-fit")!=="none"&&Dl&&dt.hasIconData();if(Y){const Ts=fe.elevation,Cc=Ts?Ts.getAtTileOffsetFunc(nt,fe.center.lat,fe.worldSize,dt.getProjection()):null,Hc=dn(nn,Tt.tileID.canonical,de,me,fe,dt.getProjection(),ln);Kr(dt,nn,m,x,Hc,zn,de,q,Cc,nt)}const fn=Y||x&&je||Pn,Vr=m.translatePosMatrix(nn,Tt,E,z),yo=fn?Xu:Jo,Ea=m.translatePosMatrix(zn,Tt,E,z,!0),xn=dt.getProjection().createInversionMatrix(fe,nt.canonical),ns=[];m.terrainRenderModeElevated()&&de&&ns.push("PITCH_WITH_MAP_TERRAIN"),wi&&ns.push("PROJECTION_GLOBE_VIEW"),fn&&ns.push("PROJECTED_POS_ON_VIEWPORT");const $c=xt&&l.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mc;Mc=xt?dt.iconsInText?sl(Lt.kind,Ut,ue,de,m,Vr,yo,Ea,Si,ur,nt,sn,qe,xn,Gr,dt.getProjection()):bc(Lt.kind,Ut,ue,de,m,Vr,yo,Ea,x,Si,!0,nt,sn,qe,xn,Gr,dt.getProjection()):Gc(Lt.kind,Ut,ue,de,m,Vr,yo,Ea,x,Si,nt,sn,qe,xn,Gr,dt.getProjection());const Gs={program:m.useProgram(La(xt,x,dt),ut,ns),buffers:kt,uniformValues:Mc,atlasTexture:Ai,atlasTextureIcon:yr,atlasInterpolation:ui,atlasInterpolationIcon:Fi,isSDF:xt,hasHalo:$c,tile:Tt,labelPlaneMatrixInv:Hn};if(we&&dt.canOverlap){Ee=!0;const Ts=kt.segments.get();for(const Cc of Ts)$e.push({segments:new c.SegmentVector([Cc]),sortKey:Cc.sortKey,state:Gs})}else $e.push({segments:kt.segments,sortKey:0,state:Gs})}Ee&&$e.sort((nt,Tt)=>nt.sortKey-Tt.sortKey);for(const nt of $e){const Tt=nt.state;if(m.terrain&&m.terrain.setupElevationDraw(Tt.tile,Tt.program,{useDepthForOcclusion:!Ke,labelPlaneMatrixInv:Tt.labelPlaneMatrixInv}),ne.activeTexture.set(ce.TEXTURE0),Tt.atlasTexture.bind(Tt.atlasInterpolation,ce.CLAMP_TO_EDGE),Tt.atlasTextureIcon&&(ne.activeTexture.set(ce.TEXTURE1),Tt.atlasTextureIcon&&Tt.atlasTextureIcon.bind(Tt.atlasInterpolationIcon,ce.CLAMP_TO_EDGE)),Tt.isSDF){const dt=Tt.uniformValues;Tt.hasHalo&&(dt.u_is_halo=1,rn(Tt.buffers,nt.segments,l,m,Tt.program,Fe,N,H,dt)),dt.u_is_halo=0}rn(Tt.buffers,nt.segments,l,m,Tt.program,Fe,N,H,Tt.uniformValues)}}function rn(m,n,l,g,x,E,z,k,B){const q=g.context,N=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];x.draw(q,q.gl.TRIANGLES,E,z,k,c.CullFaceMode.disabled,B,l.id,m.layoutVertexBuffer,m.indexBuffer,n,l.paint,g.transform.zoom,m.programConfigurations.get(l.id),N)}function Ml(m,n,l,g,x,E,z){const k=m.context.gl,B=l.paint.get("fill-pattern"),q=B&&B.constantOr(1);let N,H,ne,ce,fe;z?(H=q&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=k.LINES):(H=q?"fillPattern":"fill",N=k.TRIANGLES);for(const me of g){const de=n.getTile(me);if(q&&!de.patternsLoaded())continue;const Y=de.getBucket(l);if(!Y)continue;m.prepareDrawTile();const ue=Y.programConfigurations.get(l.id),we=m.useProgram(H,ue);q&&(m.context.activeTexture.set(k.TEXTURE0),de.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ue.updatePaintBuffers());const Ee=B.constantOr(null);if(Ee&&de.imageAtlas){const qe=de.imageAtlas.patternPositions[Ee.toString()];qe&&ue.setConstantPatternPositions(qe)}const Fe=m.translatePosMatrix(me.projMatrix,de,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(z){ce=Y.indexBuffer2,fe=Y.segments2;const qe=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];ne=H==="fillOutlinePattern"&&q?Zu(Fe,m,de,qe):Gu(Fe,qe)}else ce=Y.indexBuffer,fe=Y.segments,ne=q?Da(Fe,m,de):ys(Fe);m.prepareDrawProgram(m.context,we,me.toUnwrapped()),we.draw(m.context,N,x,m.stencilModeForClipping(me),E,c.CullFaceMode.disabled,ne,l.id,Y.layoutVertexBuffer,ce,fe,l.paint,m.transform.zoom,ue)}}function ca(m,n,l,g,x,E,z){const k=m.context,B=k.gl,q=m.transform,N=l.paint.get("fill-extrusion-pattern"),H=N.constantOr(1),ne=l.paint.get("fill-extrusion-opacity"),ce=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],fe=l.layout.get("fill-extrusion-edge-radius"),me=fe>0&&!l.paint.get("fill-extrusion-rounded-roof"),de=me?0:fe,Y=q.projection.name==="globe"?c.fillExtrusionHeightLift():0,ue=q.projection.name==="globe",we=ue?c.globeToMercatorTransition(q.zoom):0,Ee=[c.mercatorXfromLng(q.center.lng),c.mercatorYfromLat(q.center.lat)],Fe=[];ue&&Fe.push("PROJECTION_GLOBE_VIEW"),ce[0]>0&&Fe.push("FAUX_AO"),me&&Fe.push("ZERO_ROOF_RADIUS");for(const qe of g){const je=n.getTile(qe),Ke=je.getBucket(l);if(!Ke||Ke.projection.name!==q.projection.name)continue;const $e=Ke.programConfigurations.get(l.id),ct=m.useProgram(H?"fillExtrusionPattern":"fillExtrusion",$e,Fe);if(m.terrain){const xt=m.terrain;if(m.style.terrainSetForDrapingOnly())xt.setupElevationDraw(je,ct,{useMeterToDem:!0});else{if(!Ke.enableTerrain)continue;if(xt.setupElevationDraw(je,ct,{useMeterToDem:!0}),wc(k,n,qe,Ke,l,xt),!Ke.centroidVertexBuffer){const Lt=ct.attributes.a_centroid_pos;Lt!==void 0&&B.vertexAttrib2f(Lt,0,0)}}}H&&(m.context.activeTexture.set(B.TEXTURE0),je.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),$e.updatePaintBuffers());const Bt=N.constantOr(null);if(Bt&&je.imageAtlas){const xt=je.imageAtlas.patternPositions[Bt.toString()];xt&&$e.setConstantPatternPositions(xt)}const nt=m.translatePosMatrix(qe.projMatrix,je,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Tt=q.projection.createInversionMatrix(q,qe.canonical),dt=l.paint.get("fill-extrusion-vertical-gradient"),kt=H?qu(nt,m,dt,ne,ce,de,qe,je,Y,we,Ee,Tt):Ns(nt,m,dt,ne,ce,de,qe,Y,we,Ee,Tt);m.prepareDrawProgram(k,ct,qe.toUnwrapped());const ut=[];m.terrain&&ut.push(Ke.centroidVertexBuffer),ue&&ut.push(Ke.layoutVertexExtBuffer),ct.draw(k,k.gl.TRIANGLES,x,E,z,c.CullFaceMode.backCCW,kt,l.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,l.paint,m.transform.zoom,$e,ut)}}function wc(m,n,l,g,x,E){const z=[Y=>{let ue=Y.canonical.x-1,we=Y.wrap;return ue<0&&(ue=(1<<Y.canonical.z)-1,we--),new c.OverscaledTileID(Y.overscaledZ,we,Y.canonical.z,ue,Y.canonical.y)},Y=>{let ue=Y.canonical.x+1,we=Y.wrap;return ue===1<<Y.canonical.z&&(ue=0,we++),new c.OverscaledTileID(Y.overscaledZ,we,Y.canonical.z,ue,Y.canonical.y)},Y=>new c.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(Y.canonical.y===0?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new c.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],k=Y=>{const ue=n.getSource().minzoom,we=Fe=>{const qe=n.getTileByID(Fe);if(qe&&qe.hasData())return qe.getBucket(x)},Ee=[0,-1,1];for(const Fe of Ee){if(Y.overscaledZ+Fe<ue)continue;const qe=we(Y.calculateScaledKey(Y.overscaledZ+Fe));if(qe)return qe}},B=[0,0,0],q=(Y,ue)=>(B[0]=Math.min(Y.min.y,ue.min.y),B[1]=Math.max(Y.max.y,ue.max.y),B[2]=c.EXTENT-ue.min.x>Y.max.x?ue.min.x-c.EXTENT:Y.max.x,B),N=(Y,ue)=>(B[0]=Math.min(Y.min.x,ue.min.x),B[1]=Math.max(Y.max.x,ue.max.x),B[2]=c.EXTENT-ue.min.y>Y.max.y?ue.min.y-c.EXTENT:Y.max.y,B),H=[(Y,ue)=>q(Y,ue),(Y,ue)=>q(ue,Y),(Y,ue)=>N(Y,ue),(Y,ue)=>N(ue,Y)],ne=new c.Point(0,0);let ce,fe,me;const de=(Y,ue,we,Ee,Fe)=>{const qe=[[Ee?we:Y,Ee?Y:we,0],[Ee?we:ue,Ee?ue:we,0]],je=Fe<0?c.EXTENT+Fe:Fe,Ke=[Ee?je:(Y+ue)/2,Ee?(Y+ue)/2:je,0];return we===0&&Fe<0||we!==0&&Fe>0?E.getForTilePoints(me,[Ke],!0,fe):qe.push(Ke),E.getForTilePoints(l,qe,!0,ce),Math.max(qe[0][2],qe[1][2],Ke[2])/E.exaggeration()};for(let Y=0;Y<4;Y++){const ue=(Y<2?1:5)-Y,we=g.borders[Y];if(we.length===0)continue;const Ee=me=z[Y](l),Fe=k(Ee);if(!(Fe&&Fe instanceof c.FillExtrusionBucket&&Fe.enableTerrain)||g.borderDoneWithNeighborZ[Y]===Fe.canonical.z&&Fe.borderDoneWithNeighborZ[ue]===g.canonical.z||(fe=E.findDEMTileFor(Ee),!fe||!fe.dem))continue;if(!ce){const $e=E.findDEMTileFor(l);if(!$e||!$e.dem)return;ce=$e}const qe=Fe.borders[ue];let je=0;const Ke=Fe.borderDoneWithNeighborZ[ue]!==g.canonical.z;if(g.canonical.z===Fe.canonical.z){for(let $e=0;$e<we.length;$e++){const ct=g.featuresOnBorder[we[$e]],Bt=ct.borders[Y];let nt;for(;je<qe.length&&(nt=Fe.featuresOnBorder[qe[je]],!(nt.borders[ue][1]>Bt[0]+3));)Ke&&Fe.encodeCentroid(void 0,nt,!1),je++;if(nt&&je<qe.length){const Tt=je;let dt=0;for(;!(nt.borders[ue][0]>Bt[1]-3)&&(dt++,++je!==qe.length);)nt=Fe.featuresOnBorder[qe[je]];if(nt=Fe.featuresOnBorder[qe[Tt]],ct.intersectsCount()>1||nt.intersectsCount()>1||dt!==1){dt!==1&&(je=Tt),g.encodeCentroid(void 0,ct,!1),Ke&&Fe.encodeCentroid(void 0,nt,!1);continue}const kt=H[Y](ct,nt),ut=Y%2?c.EXTENT-1:0;ne.x=de(kt[0],Math.min(c.EXTENT-1,kt[1]),ut,Y<2,kt[2]),ne.y=0,g.encodeCentroid(ne,ct,!1),Ke&&Fe.encodeCentroid(ne,nt,!1)}else g.encodeCentroid(void 0,ct,!1)}g.borderDoneWithNeighborZ[Y]=Fe.canonical.z,g.needsCentroidUpdate=!0,Ke&&(Fe.borderDoneWithNeighborZ[ue]=g.canonical.z,Fe.needsCentroidUpdate=!0)}else{for(const $e of we)g.encodeCentroid(void 0,g.featuresOnBorder[$e],!1);if(Ke){for(const $e of qe)Fe.encodeCentroid(void 0,Fe.featuresOnBorder[$e],!1);Fe.borderDoneWithNeighborZ[ue]=g.canonical.z,Fe.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[Y]=Fe.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const xs=new c.Color(1,0,0,1),uo=new c.Color(0,1,0,1),ho=new c.Color(0,0,1,1),bh=new c.Color(1,0,1,1),Ro=new c.Color(0,1,1,1);function Tc(m,n,l){const g=m.context,x=m.transform,E=g.gl,z=x.projection.name==="globe",k=z?["PROJECTION_GLOBE_VIEW"]:null;let B=l.projMatrix;if(z&&c.globeToMercatorTransition(x.zoom)>0){const ct=c.transitionTileAABBinECEF(l.canonical,x),Bt=c.globeDenormalizeECEF(ct);B=c.multiply(new Float32Array(16),x.globeMatrix,Bt),c.multiply(B,x.projMatrix,B)}const q=m.useProgram("debug",null,k),N=n.getTileByID(l.key);m.terrain&&m.terrain.setupElevationDraw(N,q);const H=c.DepthMode.disabled,ne=c.StencilMode.disabled,ce=m.colorModeForRenderPass(),fe="$debug";g.activeTexture.set(E.TEXTURE0),m.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),z?N._makeGlobeTileDebugBuffers(m.context,x):N._makeDebugTileBoundsBuffers(m.context,x.projection);const me=N._tileDebugBuffer||m.debugBuffer,de=N._tileDebugIndexBuffer||m.debugIndexBuffer,Y=N._tileDebugSegments||m.debugSegments;q.draw(g,E.LINE_STRIP,H,ne,ce,c.CullFaceMode.disabled,hu(B,c.Color.red),fe,me,de,Y,null,null,null,[N._globeTileDebugBorderBuffer]);const ue=N.latestRawTileData,we=Math.floor((ue&&ue.byteLength||0)/1024),Ee=n.getTile(l).tileSize,Fe=512/Math.min(Ee,512)*(l.overscaledZ/x.zoom)*.5;let qe=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(qe+=` => ${l.overscaledZ}`),qe+=` ${we}kb`,function(ct,Bt){ct.initDebugOverlayCanvas();const nt=ct.debugOverlayCanvas,Tt=ct.context.gl,dt=ct.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,nt.width,nt.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(Bt,5,5),dt.strokeText(Bt,5,5),ct.debugOverlayTexture.update(nt),ct.debugOverlayTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE)}(m,qe);const je=N._tileDebugTextBuffer||m.debugBuffer,Ke=N._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,$e=N._tileDebugTextSegments||m.debugSegments;q.draw(g,E.TRIANGLES,H,ne,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,hu(B,c.Color.transparent,Fe),fe,je,Ke,$e,null,null,null,[N._globeTileDebugTextBuffer])}function Jt(m,n,l,g){Kl(m,0,n+l/2,m.transform.width,l,g)}function js(m,n,l,g){Kl(m,n-l/2,0,l,m.transform.height,g)}function Kl(m,n,l,g,x,E){const z=m.context,k=z.gl;k.enable(k.SCISSOR_TEST),k.scissor(n*c.exported.devicePixelRatio,l*c.exported.devicePixelRatio,g*c.exported.devicePixelRatio,x*c.exported.devicePixelRatio),z.clear({color:E}),k.disable(k.SCISSOR_TEST)}const Ja=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ec}=Ja;function Mn(m,n,l,g){m.emplaceBack(n,l,g)}class Yl{constructor(n){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,Mn(this.vertexArray,-1,-1,1),Mn(this.vertexArray,1,-1,1),Mn(this.vertexArray,-1,1,1),Mn(this.vertexArray,1,1,1),Mn(this.vertexArray,-1,-1,-1),Mn(this.vertexArray,1,-1,-1),Mn(this.vertexArray,-1,1,-1),Mn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Ec),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function Yt(m,n,l,g,x,E){const z=m.gl,k=n.paint.get("sky-atmosphere-color"),B=n.paint.get("sky-atmosphere-halo-color"),q=n.paint.get("sky-atmosphere-sun-intensity"),N=((H,ne,ce,fe,me)=>({u_matrix_3f:H,u_sun_direction:ne,u_sun_intensity:ce,u_color_tint_r:[fe.r,fe.g,fe.b,fe.a],u_color_tint_m:[me.r,me.g,me.b,me.a],u_luminance:5e-5}))(c.fromMat4(c.create$1(),g),x,q,k,B);z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_CUBE_MAP_POSITIVE_X+E,n.skyboxTexture,0),l.draw(m,z.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,N,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const ua=c.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Cl{constructor(n){const l=new c.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const g=new c.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,ua.members),this.indexBuffer=n.createIndexBuffer(g),this.segments=c.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ra={symbol:function(m,n,l,g,x){if(m.renderPass!=="translucent")return;const E=c.StencilMode.disabled,z=m.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(k,B,q,N,H,ne,ce){const fe=B.transform,me=H==="map",de=ne==="map";for(const Y of k){const ue=N.getTile(Y),we=ue.getBucket(q);if(!we||!we.text||!we.text.segments.get().length)continue;const Ee=c.evaluateSizeForZoom(we.textSizeData,fe.zoom),Fe=on(Y,we.getProjection(),fe),qe=fe.calculatePixelsToTileUnitsMatrix(ue),je=lt(Fe,ue.tileID.canonical,de,me,fe,we.getProjection(),qe),Ke=q.layout.get("icon-text-fit")!=="none"&&we.hasIconData();if(Ee){const $e=Math.pow(2,fe.zoom-ue.tileID.overscaledZ);_u(we,me,de,ce,c.symbolSize,fe,je,Y,$e,Ee,Ke)}}}(g,m,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),x),l.paint.get("icon-opacity").constantOr(1)!==0&&kr(m,n,l,g,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),E,z),l.paint.get("text-opacity").constantOr(1)!==0&&kr(m,n,l,g,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),E,z),n.map.showCollisionBoxes&&(la(m,n,l,g,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),la(m,n,l,g,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(m,n,l,g){if(m.renderPass!=="translucent")return;const x=l.paint.get("circle-opacity"),E=l.paint.get("circle-stroke-width"),z=l.paint.get("circle-stroke-opacity"),k=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(E.constantOr(1)===0||z.constantOr(1)===0))return;const B=m.context,q=B.gl,N=m.transform,H=m.depthModeForSublayer(0,c.DepthMode.ReadOnly),ne=c.StencilMode.disabled,ce=m.colorModeForRenderPass(),fe=N.projection.name==="globe",me=[c.mercatorXfromLng(N.center.lng),c.mercatorYfromLat(N.center.lat)],de=[];for(let ue=0;ue<g.length;ue++){const we=g[ue],Ee=n.getTile(we),Fe=Ee.getBucket(l);if(!Fe||Fe.projection.name!==N.projection.name)continue;const qe=Fe.programConfigurations.get(l.id),je=Hl(l);fe&&je.push("PROJECTION_GLOBE_VIEW");const Ke=m.useProgram("circle",qe,je),$e=Fe.layoutVertexBuffer,ct=Fe.globeExtVertexBuffer,Bt=Fe.indexBuffer,nt=N.projection.createInversionMatrix(N,we.canonical),Tt={programConfiguration:qe,program:Ke,layoutVertexBuffer:$e,globeExtVertexBuffer:ct,indexBuffer:Bt,uniformValues:El(m,we,Ee,nt,me,l),tile:Ee};if(k){const dt=Fe.segments.get();for(const kt of dt)de.push({segments:new c.SegmentVector([kt]),sortKey:kt.sortKey,state:Tt})}else de.push({segments:Fe.segments,sortKey:0,state:Tt})}k&&de.sort((ue,we)=>ue.sortKey-we.sortKey);const Y={useDepthForOcclusion:!fe};for(const ue of de){const{programConfiguration:we,program:Ee,layoutVertexBuffer:Fe,globeExtVertexBuffer:qe,indexBuffer:je,uniformValues:Ke,tile:$e}=ue.state,ct=ue.segments;m.terrain&&m.terrain.setupElevationDraw($e,Ee,Y),m.prepareDrawProgram(B,Ee,$e.tileID.toUnwrapped()),Ee.draw(B,q.TRIANGLES,H,ne,ce,c.CullFaceMode.disabled,Ke,l.id,Fe,je,ct,l.paint,N.zoom,we,[qe])}},heatmap:function(m,n,l,g){if(l.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,E=x.gl,z=c.StencilMode.disabled,k=new c.ColorMode([E.ONE,E.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(ce,fe,me,de){const Y=ce.gl,ue=fe.width*de,we=fe.height*de;ce.activeTexture.set(Y.TEXTURE1),ce.viewport.set([0,0,ue,we]);let Ee=me.heatmapFbo;if(!Ee||Ee&&(Ee.width!==ue||Ee.height!==we)){Ee&&Ee.destroy();const Fe=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,Fe),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),Ee=me.heatmapFbo=ce.createFramebuffer(ue,we,!1),function(qe,je,Ke,$e,ct,Bt){const nt=qe.gl;nt.texImage2D(nt.TEXTURE_2D,0,qe.isWebGL2&&qe.extRenderToTextureHalfFloat?nt.RGBA16F:nt.RGBA,ct,Bt,0,nt.RGBA,qe.extRenderToTextureHalfFloat?qe.isWebGL2?nt.HALF_FLOAT:qe.extTextureHalfFloat.HALF_FLOAT_OES:nt.UNSIGNED_BYTE,null),$e.colorAttachment.set(Ke)}(ce,0,Fe,Ee,ue,we)}else Y.bindTexture(Y.TEXTURE_2D,Ee.colorAttachment.get()),ce.bindFramebuffer.set(Ee.framebuffer)})(x,m,l,m.transform.projection.name==="globe"?.5:.25),x.clear({color:c.Color.transparent});const B=m.transform,q=B.projection.name==="globe",N=q?["PROJECTION_GLOBE_VIEW"]:null,H=q?c.CullFaceMode.frontCCW:c.CullFaceMode.disabled,ne=[c.mercatorXfromLng(B.center.lng),c.mercatorYfromLat(B.center.lat)];for(let ce=0;ce<g.length;ce++){const fe=g[ce];if(n.hasRenderableParent(fe))continue;const me=n.getTile(fe),de=me.getBucket(l);if(!de||de.projection.name!==B.projection.name)continue;const Y=de.programConfigurations.get(l.id),ue=m.useProgram("heatmap",Y,N),{zoom:we}=m.transform;m.terrain&&m.terrain.setupElevationDraw(me,ue),m.prepareDrawProgram(x,ue,fe.toUnwrapped());const Ee=B.projection.createInversionMatrix(B,fe.canonical);ue.draw(x,E.TRIANGLES,c.DepthMode.disabled,z,k,H,vh(m,fe,me,Ee,ne,we,l.paint.get("heatmap-intensity")),l.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,l.paint,m.transform.zoom,Y,q?[de.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,E){const z=x.context,k=z.gl,B=E.heatmapFbo;if(!B)return;z.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,B.colorAttachment.get()),z.activeTexture.set(k.TEXTURE1);let q=E.colorRampTexture;q||(q=E.colorRampTexture=new c.Texture(z,E.colorRamp,k.RGBA)),q.bind(k.LINEAR,k.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(z,k.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,x.colorModeForRenderPass(),c.CullFaceMode.disabled,((N,H,ne,ce)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,E),E.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,E.paint,x.transform.zoom)}(m,l))},line:function(m,n,l,g){if(m.renderPass!=="translucent")return;const x=l.paint.get("line-opacity"),E=l.paint.get("line-width");if(x.constantOr(1)===0||E.constantOr(1)===0)return;const z=m.depthModeForSublayer(0,c.DepthMode.ReadOnly),k=m.colorModeForRenderPass(),B=m.terrain&&m.terrain.renderingToTexture?1:c.exported.devicePixelRatio,q=l.paint.get("line-dasharray"),N=q.constantOr(1),H=l.layout.get("line-cap"),ne=l.paint.get("line-pattern"),ce=ne.constantOr(1),fe=l.paint.get("line-gradient"),me=ce?"linePattern":"line",de=m.context,Y=de.gl,ue=(Ee=>{const Fe=[];Al(Ee)&&Fe.push("RENDER_LINE_DASH"),Ee.paint.get("line-gradient")&&Fe.push("RENDER_LINE_GRADIENT");const qe=Ee.paint.get("line-trim-offset");qe[0]===0&&qe[1]===0||Fe.push("RENDER_LINE_TRIM_OFFSET");const je=Ee.paint.get("line-pattern").constantOr(1),Ke=Ee.paint.get("line-opacity").constantOr(1)!==1;return!je&&Ke&&Fe.push("RENDER_LINE_ALPHA_DISCARD"),Fe})(l);let we=ue.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(we=!1);for(const Ee of g){const Fe=n.getTile(Ee);if(ce&&!Fe.patternsLoaded())continue;const qe=Fe.getBucket(l);if(!qe)continue;m.prepareDrawTile();const je=qe.programConfigurations.get(l.id),Ke=m.useProgram(me,je,ue),$e=ne.constantOr(null);if($e&&Fe.imageAtlas){const xt=Fe.imageAtlas.patternPositions[$e.toString()];xt&&je.setConstantPatternPositions(xt)}const ct=q.constantOr(null),Bt=H.constantOr(null);if(!ce&&ct&&Bt&&Fe.lineAtlas){const xt=Fe.lineAtlas.getDash(ct,Bt);xt&&je.setConstantPatternPositions(xt)}let[nt,Tt]=l.paint.get("line-trim-offset");(Bt==="round"||Bt==="square")&&nt!==Tt&&(nt===0&&(nt-=1),Tt===1&&(Tt+=1));const dt=m.terrain?Ee.projMatrix:null,kt=ce?Sl(m,Fe,l,dt,B):pu(m,Fe,l,dt,qe.lineClipsArray.length,B,[nt,Tt]);if(fe){const xt=qe.gradients[l.id];let Lt=xt.texture;if(l.gradientVersion!==xt.version){let Mt=256;if(l.stepInterpolant){const Ut=n.getSource().maxzoom,Si=Ee.canonical.z===Ut?Math.ceil(1<<m.transform.maxZoom-Ee.canonical.z):1;Mt=c.clamp(c.nextPowerOfTwo(qe.maxLineLength/c.EXTENT*1024*Si),256,de.maxTextureSize)}xt.gradient=c.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Mt,image:xt.gradient||void 0,clips:qe.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new c.Texture(de,xt.gradient,Y.RGBA),xt.version=l.gradientVersion,Lt=xt.texture}de.activeTexture.set(Y.TEXTURE1),Lt.bind(l.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}N&&(de.activeTexture.set(Y.TEXTURE0),Fe.lineAtlasTexture.bind(Y.LINEAR,Y.REPEAT),je.updatePaintBuffers()),ce&&(de.activeTexture.set(Y.TEXTURE0),Fe.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),je.updatePaintBuffers()),m.prepareDrawProgram(de,Ke,Ee.toUnwrapped());const ut=xt=>{Ke.draw(de,Y.TRIANGLES,z,xt,k,c.CullFaceMode.disabled,kt,l.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,l.paint,m.transform.zoom,je,[qe.layoutVertexBuffer2])};if(we){const xt=m.stencilModeForClipping(Ee).ref;xt===0&&m.terrain&&de.clear({stencil:0});const Lt={func:Y.EQUAL,mask:255};kt.u_alpha_discard_threshold=.8,ut(new c.StencilMode(Lt,xt,255,Y.KEEP,Y.KEEP,Y.INVERT)),kt.u_alpha_discard_threshold=0,ut(new c.StencilMode(Lt,xt,255,Y.KEEP,Y.KEEP,Y.KEEP))}else ut(m.stencilModeForClipping(Ee))}we&&(m.resetStencilClippingMasks(),m.terrain&&de.clear({stencil:0}))},fill:function(m,n,l,g){const x=l.paint.get("fill-color"),E=l.paint.get("fill-opacity");if(E.constantOr(1)===0)return;const z=m.colorModeForRenderPass(),k=l.paint.get("fill-pattern"),B=m.opaquePassEnabledForLayer()&&!k.constantOr(1)&&x.constantOr(c.Color.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===B){const q=m.depthModeForSublayer(1,m.renderPass==="opaque"?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);Ml(m,n,l,g,q,z,!1)}if(m.renderPass==="translucent"&&l.paint.get("fill-antialias")){const q=m.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);Ml(m,n,l,g,q,z,!0)}},"fill-extrusion":function(m,n,l,g){const x=l.paint.get("fill-extrusion-opacity");if(x!==0&&m.renderPass==="translucent"){const E=new c.DepthMode(m.context.gl.LEQUAL,c.DepthMode.ReadWrite,m.depthRangeFor3D);if(x!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))ca(m,n,l,g,E,c.StencilMode.disabled,c.ColorMode.disabled),ca(m,n,l,g,E,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const z=m.colorModeForRenderPass();ca(m,n,l,g,E,c.StencilMode.disabled,z)}}},hillshade:function(m,n,l,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const x=m.context,E=m.depthModeForSublayer(0,c.DepthMode.ReadOnly),z=m.colorModeForRenderPass(),k=m.terrain&&m.terrain.renderingToTexture,[B,q]=m.renderPass!=="translucent"||k?[{},g]:m.stencilConfigForOverlap(g);for(const N of q){const H=n.getTile(N);if(H.needsHillshadePrepare&&m.renderPass==="offscreen")ol(m,H,l,E,c.StencilMode.disabled,z);else if(m.renderPass==="translucent"){const ne=k&&m.terrain?m.terrain.stencilModeForRTTOverlap(N):B[N.overscaledZ];Nu(m,N,H,l,E,ne,z)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,n,l,g,x,E){if(m.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!g.length)return;const z=m.context,k=z.gl,B=n.getSource(),q=m.useProgram("raster"),N=m.colorModeForRenderPass(),H=m.terrain&&m.terrain.renderingToTexture,[ne,ce]=B instanceof Li||H?[{},g]:m.stencilConfigForOverlap(g),fe=ce[ce.length-1].overscaledZ,me=!m.options.moving;for(const de of ce){const Y=H?c.DepthMode.disabled:m.depthModeForSublayer(de.overscaledZ-fe,l.paint.get("raster-opacity")===1?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,k.LESS),ue=de.toUnwrapped(),we=n.getTile(de);if(H&&(!we||!we.hasData()))continue;const Ee=H?de.projMatrix:m.transform.calculateProjMatrix(ue,me),Fe=m.terrain&&H?m.terrain.stencilModeForRTTOverlap(de):ne[de.overscaledZ],qe=E?0:l.paint.get("raster-fade-duration");we.registerFadeDuration(qe);const je=n.findLoadedParent(de,0),Ke=ju(we,je,n,m.transform,qe);let $e,ct;m.terrain&&m.terrain.prepareDrawTile();const Bt=l.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;z.activeTexture.set(k.TEXTURE0),we.texture.bind(Bt,k.CLAMP_TO_EDGE),z.activeTexture.set(k.TEXTURE1),je?(je.texture.bind(Bt,k.CLAMP_TO_EDGE),$e=Math.pow(2,je.tileID.overscaledZ-we.tileID.overscaledZ),ct=[we.tileID.canonical.x*$e%1,we.tileID.canonical.y*$e%1]):we.texture.bind(Bt,k.CLAMP_TO_EDGE),we.texture.useMipmap&&z.extTextureFilterAnisotropic&&m.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const nt=qc(Ee,ct||[0,0],$e||1,Ke,l,B instanceof Li?B.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(z,q,ue),B instanceof Li)B.boundsBuffer&&B.boundsSegments&&q.draw(z,k.TRIANGLES,Y,c.StencilMode.disabled,N,c.CullFaceMode.disabled,nt,l.id,B.boundsBuffer,m.quadTriangleIndexBuffer,B.boundsSegments);else{const{tileBoundsBuffer:Tt,tileBoundsIndexBuffer:dt,tileBoundsSegments:kt}=m.getTileBoundsBuffers(we);q.draw(z,k.TRIANGLES,Y,Fe,N,c.CullFaceMode.disabled,nt,l.id,Tt,dt,kt)}}m.resetStencilClippingMasks()},background:function(m,n,l,g){const x=l.paint.get("background-color"),E=l.paint.get("background-opacity");if(E===0)return;const z=m.context,k=z.gl,B=m.transform,q=B.tileSize,N=l.paint.get("background-pattern");if(m.isPatternMissing(N))return;const H=!N&&x.a===1&&E===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==H)return;const ne=c.StencilMode.disabled,ce=m.depthModeForSublayer(0,H==="opaque"?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),fe=m.colorModeForRenderPass(),me=m.useProgram(N?"backgroundPattern":"background");let de,Y=g;Y||(de=m.getBackgroundTiles(),Y=Object.values(de).map(ue=>ue.tileID)),N&&(z.activeTexture.set(k.TEXTURE0),m.imageManager.bind(m.context));for(const ue of Y){const we=ue.toUnwrapped(),Ee=g?ue.projMatrix:m.transform.calculateProjMatrix(we);m.prepareDrawTile();const Fe=n?n.getTile(ue):de?de[ue.key]:new c.Tile(ue,q,B.zoom,m),qe=N?xh(Ee,E,m,N,{tileID:ue,tileSize:q}):fu(Ee,E,x);m.prepareDrawProgram(z,me,we);const{tileBoundsBuffer:je,tileBoundsIndexBuffer:Ke,tileBoundsSegments:$e}=m.getTileBoundsBuffers(Fe);me.draw(z,k.TRIANGLES,ce,ne,fe,c.CullFaceMode.disabled,qe,l.id,je,Ke,$e)}},sky:function(m,n,l){const g=m.transform,x=g.projection.name==="mercator"||g.projection.name==="globe"?1:c.smoothstep(7,8,g.zoom),E=l.paint.get("sky-opacity")*x;if(E===0)return;const z=m.context,k=l.paint.get("sky-type"),B=new c.DepthMode(z.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),q=m.frameCounter/1e3%1;k==="atmosphere"?m.renderPass==="offscreen"?l.needsSkyboxCapture(m)&&(function(N,H,ne,ce){const fe=N.context,me=fe.gl;let de=H.skyboxFbo;if(!de){de=H.skyboxFbo=fe.createFramebuffer(32,32,!1),H.skyboxGeometry=new Yl(fe),H.skyboxTexture=fe.gl.createTexture(),me.bindTexture(me.TEXTURE_CUBE_MAP,H.skyboxTexture),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_MAG_FILTER,me.LINEAR);for(let Ee=0;Ee<6;++Ee)me.texImage2D(me.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,me.RGBA,32,32,0,me.RGBA,me.UNSIGNED_BYTE,null)}fe.bindFramebuffer.set(de.framebuffer),fe.viewport.set([0,0,32,32]);const Y=H.getCenter(N,!0),ue=N.useProgram("skyboxCapture"),we=new Float64Array(16);c.identity(we),c.rotateY(we,we,.5*-Math.PI),Yt(fe,H,ue,we,Y,0),c.identity(we),c.rotateY(we,we,.5*Math.PI),Yt(fe,H,ue,we,Y,1),c.identity(we),c.rotateX(we,we,.5*-Math.PI),Yt(fe,H,ue,we,Y,2),c.identity(we),c.rotateX(we,we,.5*Math.PI),Yt(fe,H,ue,we,Y,3),c.identity(we),Yt(fe,H,ue,we,Y,4),c.identity(we),c.rotateY(we,we,Math.PI),Yt(fe,H,ue,we,Y,5),fe.viewport.set([0,0,N.width,N.height])}(m,l),l.markSkyboxValid(m)):m.renderPass==="sky"&&function(N,H,ne,ce,fe){const me=N.context,de=me.gl,Y=N.transform,ue=N.useProgram("skybox");me.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_CUBE_MAP,H.skyboxTexture);const we=((Ee,Fe,qe,je,Ke)=>({u_matrix:Ee,u_sun_direction:Fe,u_cubemap:0,u_opacity:je,u_temporal_offset:Ke}))(Y.skyboxMatrix,H.getCenter(N,!1),0,ce,fe);N.prepareDrawProgram(me,ue),ue.draw(me,de.TRIANGLES,ne,c.StencilMode.disabled,N.colorModeForRenderPass(),c.CullFaceMode.backCW,we,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,l,B,E,q):k==="gradient"&&m.renderPass==="sky"&&function(N,H,ne,ce,fe){const me=N.context,de=me.gl,Y=N.transform,ue=N.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new Yl(me)),me.activeTexture.set(de.TEXTURE0);let we=H.colorRampTexture;we||(we=H.colorRampTexture=new c.Texture(me,H.colorRamp,de.RGBA)),we.bind(de.LINEAR,de.CLAMP_TO_EDGE);const Ee=((Fe,qe,je,Ke,$e)=>({u_matrix:Fe,u_color_ramp:0,u_center_direction:qe,u_radius:c.degToRad(je),u_opacity:Ke,u_temporal_offset:$e}))(Y.skyboxMatrix,H.getCenter(N,!1),H.paint.get("sky-gradient-radius"),ce,fe);N.prepareDrawProgram(me,ue),ue.draw(me,de.TRIANGLES,ne,c.StencilMode.disabled,N.colorModeForRenderPass(),c.CullFaceMode.backCW,Ee,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,l,B,E,q)},debug:function(m,n,l){for(let g=0;g<l.length;g++)Tc(m,n,l[g])},custom:function(m,n,l,g){const x=m.context,E=l.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&l.isLayerDraped()){if(m.renderPass==="offscreen"){const z=E.prerender;if(z){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const k=m.transform.pointMerc;z.call(E,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),c.globeToMercatorTransition(m.transform.zoom),[k.x,k.y],m.transform.pixelsPerMeterRatio)}else z.call(E,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const k=E.renderToTile;if(k){const B=g[0].canonical,q=new c.MercatorCoordinate(B.x+g[0].wrap*(1<<B.z),B.y,B.z);x.setDepthMode(c.DepthMode.disabled),x.setStencilMode(c.StencilMode.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),k.call(E,x.gl,q),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(c.StencilMode.disabled);const z=E.renderingMode==="3d"?new c.DepthMode(m.context.gl.LEQUAL,c.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,c.DepthMode.ReadOnly);if(x.setDepthMode(z),m.transform.projection.name==="globe"){const k=m.transform.pointMerc;E.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),c.globeToMercatorTransition(m.transform.zoom),[k.x,k.y],m.transform.pixelsPerMeterRatio)}else E.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else c.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Jl{constructor(n,l,g=!1){this.context=new vt(n,g),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,l){const g=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new $l(this,n));const x=this._terrain;this.transform.elevation=g?x:null,x.update(n,this.transform,l)}_updateFog(n){const l=n.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=l.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const E=g+.78*(x-g);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,l){if(this.width=n*c.exported.devicePixelRatio,this.height=l*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const n=this.context,l=new c.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(c.EXTENT,0),l.emplaceBack(0,c.EXTENT),l.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(l,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const g=new c.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(c.EXTENT,0),g.emplaceBack(0,c.EXTENT),g.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=n.createVertexBuffer(g,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const x=new c.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const E=new c.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(c.EXTENT,0,c.EXTENT,0),E.emplaceBack(0,c.EXTENT,0,c.EXTENT),E.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(E,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const z=new c.StructArrayLayout3ui6;z.emplaceBack(0,1,2),z.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(z);const k=new c.StructArrayLayout1ui2;for(const q of[0,1,3,2,0])k.emplaceBack(q);this.debugIndexBuffer=n.createIndexBuffer(k),this.emptyTexture=new c.Texture(n,new c.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=c.create();const B=this.context.gl;this.stencilClearMode=new c.StencilMode({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(c.window.performance.now()),this.atmosphereBuffer=new Cl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,l=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,l.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,Vs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,g){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const B of g)if(this._tileClippingMaskIDs[B.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=l.id;const x=this.context,E=x.gl;this.nextStencilID+g.length>256&&this.clearStencil(),x.setColorMode(c.ColorMode.disabled),x.setDepthMode(c.DepthMode.disabled);const z=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of g){const B=l.getTile(k),q=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:H,tileBoundsSegments:ne}=this.getTileBoundsBuffers(B);z.draw(x,E.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:E.ALWAYS,mask:0},q,255,E.KEEP,E.KEEP,E.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Vs(k.projMatrix),"$clipping",N,H,ne)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new c.StencilMode({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new c.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,g=n.sort((z,k)=>k.overscaledZ-z.overscaledZ),x=g[g.length-1].overscaledZ,E=g[0].overscaledZ-x+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const z={};for(let k=0;k<E;k++)z[k+x]=new c.StencilMode({func:l.GEQUAL,mask:255},k+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=E,[z,g]}return[{[x]:c.StencilMode.disabled},g]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new c.ColorMode([n.CONSTANT_COLOR,n.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(n,l,g){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new c.DepthMode(g||this.context.gl.LEQUAL,l,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,l){this.style=n,this.options=l,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const g=this.style.order,x=this.style._sourceCaches;for(const q in x){const N=x[q];N.used&&N.prepare(this.context)}const E={},z={},k={};for(const q in x){const N=x[q];E[q]=N.getVisibleCoordinates(),z[q]=E[q].slice().reverse(),k[q]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let q=0;q<g.length;q++)if(this.style._layers[g[q]].is3D()){this.opaquePassCutoff=q;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new c.GlobeSharedBuffers(this.context)),!c.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const q of g){const N=this.style._layers[q],H=n._getLayerSourceCache(N);if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const ne=H?z[H.id]:void 0;(N.type==="custom"||N.isSky()||ne&&ne.length)&&this.renderLayer(this,H,N,ne)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const B=this.terrain;if(B&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&B.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const q=this.style._layers[g[this.currentLayer]],N=n._getLayerSourceCache(q);if(q.isSky())continue;const H=N?z[N.id]:void 0;this._renderTileClippingMasks(q,N,H),this.renderLayer(this,N,q,H)}if(this.style.fog&&this.transform.projection.supportsFog&&function(q,N){const H=q.context,ne=H.gl,ce=q.transform,fe=new c.DepthMode(ne.LEQUAL,c.DepthMode.ReadOnly,[0,1]),me=q.useProgram("globeAtmosphere",null,ce.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),de=c.globeToMercatorTransition(ce.zoom),Y=N.properties.get("color").toArray01(),ue=N.properties.get("high-color").toArray01(),we=N.properties.get("space-color").toArray01PremultipliedAlpha(),Ee=c.identity$1([]);c.rotateY$1(Ee,Ee,-c.degToRad(ce._center.lng)),c.rotateX$1(Ee,Ee,c.degToRad(ce._center.lat)),c.rotateZ$1(Ee,Ee,ce.angle),c.rotateX$1(Ee,Ee,-ce._pitch);const Fe=c.fromQuat(new Float32Array(16),Ee),qe=c.mapValue(N.properties.get("star-intensity"),0,1,0,.25),je=5e-4,Ke=c.mapValue(N.properties.get("horizon-blend"),0,1,je,.25),$e=c.globeUseCustomAntiAliasing(q,H,ce)&&Ke===je?ce.worldSize/(2*Math.PI*1.025)-1:ce.globeRadius,ct=q.frameCounter/1e3%1,Bt=c.length(ce.globeCenterInViewSpace),nt=Math.sqrt(Math.pow(Bt,2)-Math.pow($e,2)),Tt=Math.acos(nt/Bt),dt=((ut,xt,Lt,Mt,Ut,Si,Ai,ui,Fi,ur,yr,wi,Gr,sn)=>({u_frustum_tl:ut,u_frustum_tr:xt,u_frustum_br:Lt,u_frustum_bl:Mt,u_horizon:Ut,u_transition:Si,u_fadeout_range:Ai,u_color:ui,u_high_color:Fi,u_space_color:ur,u_star_intensity:yr,u_star_size:5*c.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:wi,u_horizon_angle:Gr,u_rotation_matrix:sn}))(ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.frustumCorners.horizon,de,Ke,Y,ue,we,qe,ct,Tt,Fe);q.prepareDrawProgram(H,me);const kt=q.atmosphereBuffer;kt&&me.draw(H,ne.TRIANGLES,fe,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.backCW,dt,"skybox",kt.vertexBuffer,kt.indexBuffer,kt.segments)}(this,this.style.fog),this.renderPass="sky",(c.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const q=this.style._layers[g[this.currentLayer]],N=n._getLayerSourceCache(q);q.isSky()&&this.renderLayer(this,N,q,N?z[N.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const q=this.style._layers[g[this.currentLayer]],N=n._getLayerSourceCache(q);if(q.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(q)){if(q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const H=N?(q.type==="symbol"?k:z)[N.id]:void 0;this._renderTileClippingMasks(q,N,N?E[N.id]:void 0),this.renderLayer(this,N,q,H),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let q=null;c.values(this.style._layers).forEach(N=>{const H=n._getLayerSourceCache(N);H&&!N.isHidden(this.transform.zoom)&&(!q||q.getSource().maxzoom<H.getSource().maxzoom)&&(q=H)}),q&&this.options.showTileBoundaries&&Ra.debug(this,q,q.getVisibleCoordinates())}this.options.showPadding&&function(q){const N=q.transform.padding;Jt(q,q.transform.height-(N.top||0),3,xs),Jt(q,N.bottom||0,3,uo),js(q,N.left||0,3,ho),js(q,q.transform.width-(N.right||0),3,bh);const H=q.transform.centerPoint;(function(ne,ce,fe,me){Kl(ne,ce-1,fe-10,2,20,me),Kl(ne,ce-10,fe-1,20,2,me)})(q,H.x,q.transform.height-H.y,Ro)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,l,g,x){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(g.type)||n.terrain&&g.type==="custom")&&Ra[g.type](n,l,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let g=this.gpuTimers[n.id];g||(g=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),g.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),n.beginQueryEXT(n.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const g in n){const x=n[g],E=this.context.extTimerQuery,z=E.getQueryObjectEXT(x.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(x.query),l[g]=z}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let g=0;for(const x of n)g+=l.getQueryObjectEXT(x,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(x);return g}translatePosMatrix(n,l,g,x,E){if(!g[0]&&!g[1])return n;const z=E?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(z){const q=Math.sin(z),N=Math.cos(z);g=[g[0]*N-g[1]*q,g[0]*q+g[1]*N]}const k=[E?g[0]:hn(l,g[0],this.transform.zoom),E?g[1]:hn(l,g[1],this.transform.zoom),0],B=new Float32Array(16);return c.translate(B,n,k),B}saveTileTexture(n){const l=this._tileTextures[n.size[0]];l?l.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}isPatternMissing(n){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&this.terrain.exaggeration()===0,g=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),this.transform.projection.name==="globe"&&x.push("GLOBE"),l&&x.push("ZERO_EXAGGERATION"),g&&!n&&g.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),n&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(n,l,g){this.cache=this.cache||{};const x=g||[],E=this.currentGlobalDefines().concat(x),z=Tr.cacheKey(Vu[n],n,E,l);return this.cache[z]||(this.cache[z]=new Tr(this.context,n,Vu[n],l,mu[n],E)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,l,g){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const E=x.getOpacity(this.transform.pitch),z=((k,B,q,N,H,ne,ce,fe,me,de,Y)=>{const ue=k.transform,we=B.properties.get("color").toArray01();we[3]=N;const Ee=k.frameCounter/1e3%1;return{u_fog_matrix:q?ue.calculateFogTileMatrix(q):k.identityMat,u_fog_range:B.getFovAdjustedRange(ue._fov),u_fog_color:we,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_temporal_offset:Ee,u_frustum_tl:H,u_frustum_tr:ne,u_frustum_br:ce,u_frustum_bl:fe,u_globe_pos:me,u_globe_radius:de,u_viewport:Y,u_globe_transition:c.globeToMercatorTransition(ue.zoom),u_is_globe:+(ue.projection.name==="globe")}})(this,x,g,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.exported.devicePixelRatio,this.transform.height*c.exported.devicePixelRatio]);l.setFogUniformValues(n,z)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const x of g)l[x.key]=n[x.key]||new c.Tile(x,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Ql{constructor(n=0,l=0,g=0,x=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=g,this.right=x}interpolate(n,l,g){return l.top!=null&&n.top!=null&&(this.top=c.number(n.top,l.top,g)),l.bottom!=null&&n.bottom!=null&&(this.bottom=c.number(n.bottom,l.bottom,g)),l.left!=null&&n.left!=null&&(this.left=c.number(n.left,l.left,g)),l.right!=null&&n.right!=null&&(this.right=c.number(n.right,l.right,g)),this}getCenter(n,l){const g=c.clamp((this.left+n-this.right)/2,0,n),x=c.clamp((this.top+l-this.bottom)/2,0,l);return new c.Point(g,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Ql(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function gu(m,n){const l=c.getColumn(m,3);c.fromQuat(m,n),c.setColumn(m,3,l)}function vr(m,n){const l=c.identity$1([]);return c.rotateZ$1(l,l,-n),c.rotateX$1(l,l,-m),l}function Ta(m,n){const l=[m[0],m[1],0],g=[n[0],n[1],0];if(c.length(l)>=1e-15){const z=c.normalize([],l);c.scale$2(g,z,c.dot(g,z)),n[0]=g[0],n[1]=g[1]}const x=c.cross([],n,m);if(c.len(x)<1e-15)return null;const E=Math.atan2(-x[1],x[0]);return vr(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),E)}class ll{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof c.MercatorCoordinate?n:new c.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=c.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const g=this.position,x=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(n)):0,E=c.MercatorCoordinate.fromLngLat(n,x),z=[E.x-g.x,E.y-g.y,E.z-g.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Ta(z,l)}setPitchBearing(n,l){this.orientation=vr(c.degToRad(n),c.degToRad(-l))}}class Sc{constructor(n,l){this._transform=c.identity([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new c.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=c.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&c.setColumn(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||c.identity$1([]),n&&gu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=vr(n,l),gu(this._transform,this._orientation)}forward(){const n=c.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=c.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=c.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const g=new Float64Array(16);return c.invert(g,this.getWorldToCamera(n,l)),g}getWorldToCameraPosition(n,l,g){const x=this.position;c.scale$2(x,x,-n);const E=new Float64Array(16);return c.fromScaling(E,[g,g,g]),c.translate(E,E,x),E[10]*=l,E}getWorldToCamera(n,l){const g=new Float64Array(16),x=new Float64Array(4),E=this.position;return c.conjugate(x,this._orientation),c.scale$2(E,E,-n),c.fromQuat(g,x),c.translate(g,g,E),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=l,g[9]*=l,g[10]*=l,g[11]*=l,g}getCameraToClipPerspective(n,l,g,x){const E=new Float64Array(16);return c.perspective(E,n,l,g,x),E}getDistanceToElevation(n,l=!1){const g=n===0?0:c.mercatorZfromAltitude(n,l?c.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(g-this.position[2])/x[2]}clone(){return new Sc([...this.position],[...this.orientation])}}function zl(m,n){const l=bs(m.projection,m.zoom,m.width,m.height),g=function(E,z,k,B,q){const N=new c.LngLat(k.lng-180*Ko,k.lat),H=new c.LngLat(k.lng+180*Ko,k.lat),ne=E.project(N.lng,N.lat),ce=E.project(H.lng,H.lat),fe=-Math.atan2(ce.y-ne.y,ce.x-ne.x),me=c.MercatorCoordinate.fromLngLat(k);me.y=c.clamp(me.y,-1+Ko,1-Ko);const de=me.toLngLat(),Y=E.project(de.lng,de.lat),ue=c.MercatorCoordinate.fromLngLat(de);ue.x+=Ko;const we=ue.toLngLat(),Ee=E.project(we.lng,we.lat),Fe=Pl(Ee.x-Y.x,Ee.y-Y.y,fe),qe=c.MercatorCoordinate.fromLngLat(de);qe.y+=Ko;const je=qe.toLngLat(),Ke=E.project(je.lng,je.lat),$e=Pl(Ke.x-Y.x,Ke.y-Y.y,fe),ct=Math.abs(Fe.x)/Math.abs($e.y),Bt=c.identity([]);c.rotateZ(Bt,Bt,-fe*(1-(q?0:B)));const nt=c.identity([]);return c.scale(nt,nt,[1,1-(1-ct)*B,1]),nt[4]=-$e.x/$e.y*B,c.rotateZ(nt,nt,fe),c.multiply(nt,Bt,nt),nt}(m.projection,0,m.center,l,n),x=Ho(m);return c.scale(g,g,[x,x,1]),g}function Ho(m){const n=m.projection,l=bs(m.projection,m.zoom,m.width,m.height),g=Xc(n,m.center),x=Xc(n,c.LngLat.convert(n.center));return Math.pow(2,g*l+(1-l)*x)}function bs(m,n,l,g,x=1/0){const E=m.range;if(!E)return 0;const z=Math.min(x,Math.max(l,g)),k=Math.log(z/1024)/Math.LN2;return c.smoothstep(E[0]+k,E[1]+k,n)}const Ko=1/4e4;function Xc(m,n){const l=c.clamp(n.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),g=new c.LngLat(n.lng-180*Ko,l),x=new c.LngLat(n.lng+180*Ko,l),E=m.project(g.lng,l),z=m.project(x.lng,l),k=c.MercatorCoordinate.fromLngLat(g),B=c.MercatorCoordinate.fromLngLat(x),q=z.x-E.x,N=z.y-E.y,H=B.x-k.x,ne=B.y-k.y,ce=Math.sqrt((H*H+ne*ne)/(q*q+N*N));return Math.log(ce)/Math.LN2}function Pl(m,n,l){const g=Math.cos(l),x=Math.sin(l);return{x:m*g-n*x,y:m*x+n*g}}class cl{constructor(n,l,g,x,E,z,k){this.tileSize=512,this._renderWorldCopies=E===void 0||E,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=g??0,this._maxPitch=x??60,this.setProjection(z),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ql,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Sc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new cl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,l=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(n||g)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=c.getProjection(this.projectionOptions);const g=!st(l,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.getProjection({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.Point(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;var g;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(g=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),function(x,E,z){var k=E[0],B=E[1],q=E[2],N=E[3],H=Math.sin(z),ne=Math.cos(z);x[0]=k*ne+q*H,x[1]=B*ne+N*H,x[2]=k*-H+q*ne,x[3]=B*-H+N*ne}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=c.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=c.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,E=0;for(let z=0;z<l.length;z++){const k=new c.Point(l[z][0]*this.width,g+l[z][1]*(this.height-g)),B=n.pointCoordinate(k);if(!B)continue;const q=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);x+=B[3]*q,E+=q}return E===0?NaN:x/E}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*l,x=this._mercatorZfromZoom(n),E=this._mercatorZfromZoom(this._maxZoom),z=Math.max(x-g,E);this._setZoom(this._zoomFromMercatorZ(z))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let g;g=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const x=c.length(c.sub([],this._camera.position,g));return c.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!c.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const g=[n.position.x,n.position.y,n.position.z];c.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new ll;return l.position=new c.MercatorCoordinate(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!c.length$1(n))return!1;c.normalize$1(n,n);const l=c.transformQuat([],[0,0,-1],n),g=c.transformQuat([],[0,-1,0],n);if(g[2]<0)return!1;const x=Ta(l,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=c.clamp(n[2],x/g,x/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,g){this._unmodified=!1,this._edgeInsets.interpolate(n,l,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new c.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const g=this.pointCoordinate(new c.Point(0,0)),x=this.pointCoordinate(new c.Point(this.width,0)),E=this.pointCoordinate(new c.Point(this.width,this.height)),z=this.pointCoordinate(new c.Point(0,this.height)),k=Math.floor(Math.min(g.x,x.x,E.x,z.x)),B=Math.floor(Math.max(g.x,x.x,E.x,z.x)),q=1;for(let N=k-q;N<=B+q;N++)N!==0&&l.push(new c.UnwrappedTileID(N,n))}return l}coveringTiles(n){let l=this.coveringZoomLevel(n);const g=l,x=this.elevation&&!n.isTerrainDEM,E=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const z=this.locationCoordinate(this.center),k=this.center.lat,B=1<<l,q=[B*z.x,B*z.y,0],N=this.projection.name==="globe",H=!N,ne=c.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,H),ce=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),fe=B*c.mercatorZfromAltitude(1,this.center.lat),me=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),de=[B*ce.x,B*ce.y,me*(H?1:fe)],Y=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ue=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,we=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ee=n.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,Fe=this.projection.isReprojectedInTileSpace?Ho(this):1,qe=ut=>{const Lt=new c.MercatorCoordinate(ut.x+25e-6,ut.y,ut.z),Mt=new c.MercatorCoordinate(ut.x,ut.y+25e-6,ut.z),Ut=ut.toLngLat(),Si=Lt.toLngLat(),Ai=Mt.toLngLat(),ui=this.locationCoordinate(Ut),Fi=this.locationCoordinate(Si),ur=this.locationCoordinate(Ai),yr=Math.hypot(Fi.x-ui.x,Fi.y-ui.y),wi=Math.hypot(ur.x-ui.x,ur.y-ui.y);return Math.sqrt(yr*wi)*Fe/25e-6},je=ut=>{const xt=we,Lt=Ee;return{aabb:c.tileAABB(this,B,0,0,0,ut,Lt,xt,this.projection),zoom:0,x:0,y:0,minZ:Lt,maxZ:xt,wrap:ut,fullyVisible:!1}},Ke=[];let $e=[];const ct=l,Bt=n.reparseOverscaled?g:l,nt=ut=>ut*ut,Tt=nt((me-this._centerAltitude)*fe),dt=ut=>{if(!this._elevation||!ut.tileID||!E)return;const xt=this._elevation.getMinMaxForTile(ut.tileID),Lt=ut.aabb;xt?(Lt.min[2]=xt.min,Lt.max[2]=xt.max,Lt.center[2]=(Lt.min[2]+Lt.max[2])/2):(ut.shouldSplit=kt(ut),ut.shouldSplit||(Lt.min[2]=Lt.max[2]=Lt.center[2]=this._centerAltitude))},kt=ut=>{if(ut.zoom<ue)return!0;if(ut.zoom===ct)return!1;if(ut.shouldSplit!=null)return ut.shouldSplit;const xt=ut.aabb.distanceX(de),Lt=ut.aabb.distanceY(de);let Mt=Tt,Ut=1;if(N){Mt=nt(ut.aabb.distanceZ(de));const ui=Math.pow(2,ut.zoom),Fi=c.latFromMercatorY((ut.y+1)/ui),ur=c.latFromMercatorY(ut.y/ui),yr=Math.min(Math.max(k,Fi),ur),wi=c.circumferenceAtLatitude(yr)/c.circumferenceAtLatitude(k);if(Ut=yr===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,wi/this._mercatorScaleRatio),this.zoom<=c.GLOBE_ZOOM_THRESHOLD_MIN&&ut.zoom===ct-1&&wi>=.9)return!0}else if(x&&(Mt=nt(ut.aabb.distanceZ(de)*fe)),this.projection.isReprojectedInTileSpace&&g<=5){const ui=Math.pow(2,ut.zoom),Fi=qe(new c.MercatorCoordinate((ut.x+.5)/ui,(ut.y+.5)/ui));Ut=Fi>.85?1:Fi}const Si=xt*xt+Lt*Lt+Mt,Ai=nt((1<<ct-ut.zoom)*Y*Ut*((ui,Fi)=>{if(Fi*nt(.707)<ui)return 1;const ur=Math.sqrt(Fi/ui);return ur/(1.4144271570014144+(Math.pow(1.1,ur-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Mt,Tt),Si));return Si<Ai};if(this.renderWorldCopies)for(let ut=1;ut<=3;ut++)Ke.push(je(-ut)),Ke.push(je(ut));for(Ke.push(je(0));Ke.length>0;){const ut=Ke.pop(),xt=ut.x,Lt=ut.y;let Mt=ut.fullyVisible;if(!Mt){const Ut=ut.aabb.intersects(ne);if(Ut===0)continue;Mt=Ut===2}if(ut.zoom!==ct&&kt(ut))for(let Ut=0;Ut<4;Ut++){const Si=(xt<<1)+Ut%2,Ai=(Lt<<1)+(Ut>>1),ui={aabb:E?ut.aabb.quadrant(Ut):c.tileAABB(this,B,ut.zoom+1,Si,Ai,ut.wrap,ut.minZ,ut.maxZ,this.projection),zoom:ut.zoom+1,x:Si,y:Ai,wrap:ut.wrap,fullyVisible:Mt,tileID:void 0,shouldSplit:void 0,minZ:ut.minZ,maxZ:ut.maxZ};x&&!N&&(ui.tileID=new c.OverscaledTileID(ut.zoom+1===ct?Bt:ut.zoom+1,ut.wrap,ut.zoom+1,Si,Ai),dt(ui)),Ke.push(ui)}else{const Ut=ut.zoom===ct?Bt:ut.zoom;if(n.minzoom&&n.minzoom>Ut)continue;const Si=q[0]-(.5+xt+(ut.wrap<<ut.zoom))*(1<<l-ut.zoom),Ai=q[1]-.5-Lt,ui=ut.tileID?ut.tileID:new c.OverscaledTileID(Ut,ut.wrap,ut.zoom,xt,Lt);$e.push({tileID:ui,distanceSq:Si*Si+Ai*Ai})}}if(this.fogCullDistSq){const ut=this.fogCullDistSq,xt=this.horizonLineFromTop();$e=$e.filter(Lt=>{const Mt=[0,0,0,1],Ut=[c.EXTENT,c.EXTENT,0,1],Si=this.calculateFogTileMatrix(Lt.tileID.toUnwrapped());c.transformMat4$1(Mt,Mt,Si),c.transformMat4$1(Ut,Ut,Si);const Ai=c.getAABBPointSquareDist(Mt,Ut);if(Ai===0)return!0;let ui=!1;const Fi=this._elevation;if(Fi&&Ai>ut&&xt!==0){const ur=this.calculateProjMatrix(Lt.tileID.toUnwrapped());let yr;n.isTerrainDEM||(yr=Fi.getMinMaxForTile(Lt.tileID)),yr||(yr={min:Ee,max:we});const wi=c.furthestTileCorner(this.rotation),Gr=[wi[0]*c.EXTENT,wi[1]*c.EXTENT,yr.max];c.transformMat4(Gr,Gr,ur),ui=(1-Gr[1])*this.height*.5<xt}return Ai<ut||ui})}return $e.sort((ut,xt)=>ut.distanceSq-xt.distanceSq).map(ut=>ut.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=c.clamp(n.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),g=this.projection.project(n.lng,l);return new c.Point(g.x*this.worldSize,g.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/c.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,l){let g,x;const E=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;g=(l.x-E.x)/k,x=(l.y-E.y)/k}else{const k=this.pointCoordinate(l),B=this.pointCoordinate(E);g=k.x-B.x,x=k.y-B.y}const z=this.locationCoordinate(n);this.setLocation(new c.MercatorCoordinate(z.x-g,z.y-x))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,l){const g=l?c.mercatorZfromAltitude(l,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new c.MercatorCoordinate(x.x,x.y,g)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const g=l??this._centerAltitude,x=[n.x,n.y,0,1],E=[n.x,n.y,1,1];c.transformMat4$1(x,x,this.pixelMatrixInverse),c.transformMat4$1(E,E,this.pixelMatrixInverse);const z=E[3];c.scale$1(x,x,1/x[3]),c.scale$1(E,E,1/z);const k=x[2],B=E[2];return{p0:x,p1:E,t:k===B?0:(g-k)/(B-k)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],g=[n.x,n.y,1,1];return c.transformMat4$1(l,l,this.pixelMatrixInverse),c.transformMat4$1(g,g,this.pixelMatrixInverse),c.scale$1(l,l,1/l[3]),c.scale$1(g,g,1/g[3]),l[2]=c.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,g[2]=c.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,c.scale$1(l,l,1/this.worldSize),c.scale$1(g,g,1/this.worldSize),new c.Ray([l[0],l[1],l[2]],c.normalize([],c.sub([],g,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:g,t:x}=n,E=c.mercatorZfromAltitude(l[2],this._center.lat),z=c.mercatorZfromAltitude(g[2],this._center.lat);return new c.MercatorCoordinate(c.number(l[0],g[0],x)/this.worldSize,c.number(l[1],g[1],x)/this.worldSize,c.number(E,z,x))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let l=this.projection.pointCoordinate3D(this,n.x,n.y);if(l)return new c.MercatorCoordinate(l[0],l[1],l[2]);let g=0,x=this.horizonLineFromTop();if(n.y>x)return this.pointCoordinate(n);const E=.02*x,z=n.clone();for(let k=0;k<10&&x-g>E;k++){z.y=c.number(g,x,.66);const B=this.projection.pointCoordinate3D(this,z.x,z.y);B?(x=z.y,l=B):g=z.y}return l?new c.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const l=this.pointCoordinate(n);return l.y>=0&&l.y<=1}_coordinatePoint(n,l){const g=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,g+n.toAltitude(),1];return c.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new c.Point(x[0]/x[3],x[1]/x[3]):new c.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:l}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,E=this.pointLocation3D(new c.Point(l,n)),z=this.pointLocation3D(new c.Point(x,n)),k=this.pointLocation3D(new c.Point(x,g)),B=this.pointLocation3D(new c.Point(l,g));let q=Math.min(E.lng,z.lng,k.lng,B.lng),N=Math.max(E.lng,z.lng,k.lng,B.lng),H=Math.min(E.lat,z.lat,k.lat,B.lat),ne=Math.max(E.lat,z.lat,k.lat,B.lat);const ce=Math.pow(2,-this.zoom)/16*270,fe=this.projection.name==="globe"?1:4,me=(de,Y,ue,we,Ee)=>{const Fe=(de+ue)/2,qe=(Y+we)/2,je=new c.Point(Fe,qe),{lng:Ke,lat:$e}=this.pointLocation3D(je),ct=Math.max(0,q-Ke,H-$e,Ke-N,$e-ne);q=Math.min(q,Ke),N=Math.max(N,Ke),H=Math.min(H,$e),ne=Math.max(ne,$e),(Ee<fe||ct>ce)&&(me(de,Y,Fe,qe,Ee+1),me(Fe,qe,ue,we,Ee+1))};if(me(l,n,x,n,1),me(x,n,x,g,1),me(x,g,l,g,1),me(l,g,l,n,1),this.projection.name==="globe"){const[de,Y]=c.polesInViewport(this);de?(ne=90,N=180,q=-180):Y&&(H=-90,N=180,q=-180)}return new c.LngLatBounds(new c.LngLat(q,H),new c.LngLat(N,ne))}_getBoundsRectangular(n,l){const{top:g,left:x}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,z=this.width-this._edgeInsets.right,k=new c.Point(x,g),B=new c.Point(z,g),q=new c.Point(z,E),N=new c.Point(x,E);let H=this.pointCoordinate(k,n),ne=this.pointCoordinate(B,n);const ce=this.pointCoordinate(q,l),fe=this.pointCoordinate(N,l),me=(de,Y)=>(Y.y-de.y)/(Y.x-de.x);return H.y>1&&ne.y>=0?H=new c.MercatorCoordinate((1-fe.y)/me(fe,H)+fe.x,1):H.y<0&&ne.y<=1&&(H=new c.MercatorCoordinate(-fe.y/me(fe,H)+fe.x,0)),ne.y>1&&H.y>=0?ne=new c.MercatorCoordinate((1-ce.y)/me(ce,ne)+ce.x,1):ne.y<0&&H.y<=1&&(ne=new c.MercatorCoordinate(-ce.y/me(ce,ne)+ce.x,0)),new c.LngLatBounds().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(ce))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=n.visibleDemTiles.reduce((g,x)=>{if(x.dem){const E=x.dem.tree;g.min=Math.min(g.min,E.minimums[0]),g.max=Math.max(g.max,E.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,g=this._distanceTileDataCache;if(g[l])return g[l];const x=n.canonical,E=1/this.height,z=this.cameraWorldSize,k=z/this.zoomScale(x.z),B=(x.x+Math.pow(2,x.z)*n.wrap)*k,q=x.y*k,N=this.point;N.x*=z/this.worldSize,N.y*=z/this.worldSize;const H=this.angle,ne=Math.sin(-H),ce=-Math.cos(-H);return g[l]={bearing:[ne,ce],center:[(N.x-B)*E,(N.y-q)*E],scale:k/c.EXTENT*E},g[l]}calculateFogTileMatrix(n){const l=n.key,g=this._fogTileMatrixCache;if(g[l])return g[l];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return c.multiply(x,this.worldToFogMatrix,x),g[l]=new Float32Array(x),g[l]}calculateProjMatrix(n,l=!1){const g=n.key,x=l?this._alignedProjMatrixCache:this._projMatrixCache;if(x[g])return x[g];const E=this.calculatePosMatrix(n,this.worldSize);return c.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,E),x[g]=new Float32Array(E),x[g]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,g=this._pixelsToTileUnitsCache;if(g[l])return g[l];const x=function(E,z){const{scale:k}=E.tileTransform,B=k*c.EXTENT/(E.tileSize*Math.pow(2,z.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return q=new Float32Array(4),ne=(N=z.inverseAdjustmentMatrix)[1],ce=N[2],fe=N[3],de=(H=[B,B])[1],q[0]=N[0]*(me=H[0]),q[1]=ne*me,q[2]=ce*de,q[3]=fe*de,q;var q,N,H,ne,ce,fe,me,de}(n,this);return g[l]=x,g[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,l=c.fromScaling([],[n,n,n]);return c.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const l=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(l),x=this._camera.forward(),E=c.mercatorZfromAltitude(1,this._center.lat);g[2]/=E,x[2]/=E,c.normalize(x,x);const z=n.raycast(g,x,n.exaggeration());if(z){const k=c.scaleAndAdd([],g,x,z),B=new c.MercatorCoordinate(k[0],k[1],c.mercatorZfromAltitude(k[2],c.latFromMercatorY(k[1]))),q=(B.z+c.length([B.x-g[0],B.y-g[1],B.z-g[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(q),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const l=this._elevation,g=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(g),E=l.getAtPointOrZero(new c.MercatorCoordinate(...x)),z=this.pixelsPerMeter/this.worldSize*E,k=this._minimumHeightOverTerrain(),B=x[2]-z;if(B<=k)if(B<0||n){const q=this.locationCoordinate(this._center,this._centerAltitude),N=[x[0],x[1],q.z-x[2]],H=c.length(N);N[2]-=(k-B)/this._pixelsPerMercatorPixel;const ne=c.length(N);if(ne===0)return;c.scale$2(N,N,H/ne*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],q.z*this._pixelsPerMercatorPixel-N[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const ne=this.center;return ne.lat=c.clamp(ne.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(ne.lng=c.clamp(ne.lng,this.minLng,this.maxLng)),this.center=ne,void(this._constraining=!1)}const l=this._unmodified,{x:g,y:x}=this.point;let E=0,z=g,k=x;const B=this.width/2,q=this.height/2,N=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(x-q<N&&(k=N+q),x+q>H&&(k=H-q),H-N<this.height&&(E=Math.max(E,this.height/(H-N)),k=(H+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ne=this.worldMinX*this.scale,ce=this.worldMaxX*this.scale,fe=this.worldSize/2-(ne+ce)/2;z=(g+fe+this.worldSize)%this.worldSize-fe,z-B<ne&&(z=ne+B),z+B>ce&&(z=ce-B),ce-ne<this.width&&(E=Math.max(E,this.width/(ce-ne)),z=(ce+ne)/2)}z===g&&k===x||(this.center=this.unproject(new c.Point(z,k))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=c.mercatorZfromAltitude(1,this.center.lat)/c.mercatorZfromAltitude(1,c.GLOBE_SCALE_MATCH_LATITUDE));const g=bs(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?l:1,E=this._camera.getWorldToCamera(this.worldSize,x),z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);z[8]=2*-n.x/this.width,z[9]=2*n.y/this.height;let k=c.mul([],z,E);if(this.projection.isReprojectedInTileSpace){const qe=this.locationCoordinate(this.center),je=c.identity([]);c.translate(je,je,[qe.x*this.worldSize,qe.y*this.worldSize,0]),c.multiply(je,je,zl(this)),c.translate(je,je,[-qe.x*this.worldSize,-qe.y*this.worldSize,0]),c.multiply(k,k,je),this.inverseAdjustmentMatrix=function(Ke){const $e=zl(Ke,!0);return Xt([],[$e[0],$e[1],$e[4],$e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale([],k,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=k,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const B=c.invert([],z);this.frustumCorners=c.FrustumCorners.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height);const q=new Float32Array(16);c.identity(q),c.scale(q,q,[1,-1,1]),c.rotateX(q,q,this._pitch),c.rotateZ(q,q,this.angle);const N=c.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-n.x/this.width,N[9]=2*(n.y+H)/this.height,this.skyboxMatrix=c.multiply(q,N,q);const ne=this.point,ce=ne.x,fe=ne.y,me=this.width%2/2,de=this.height%2/2,Y=Math.cos(this.angle),ue=Math.sin(this.angle),we=ce-Math.round(ce)+Y*me+ue*de,Ee=fe-Math.round(fe)+Y*de+ue*me,Fe=new Float64Array(k);if(c.translate(Fe,Fe,[we>.5?we-1:we,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=Fe,k=c.create(),c.scale(k,k,[this.width/2,-this.height/2,1]),c.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=c.create(),c.scale(k,k,[1,-1,1]),c.translate(k,k,[-1,-1,0]),c.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},k=c.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=c.calculateGlobeMatrix(this);const qe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.transformMat4(qe,qe,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,E=[n,n,l];c.scale$2(E,E,x),c.scale$2(g,g,-1),c.multiply$2(g,g,E);const z=c.create();c.translate(z,z,g),c.scale(z,z,E),this.mercatorFogMatrix=z,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,x)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),x=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-g[0]*E,x.y/this.worldSize-g[1]*E,n/this.worldSize*this._centerAltitude-g[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],x=n[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(E=Math.min((l-g)/x,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,n,E),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),E=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,z=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),k=Math.max((n[2]-E)/Math.cos(g),z),B=this._zoomFromMercatorZ(k);c.scaleAndAdd(n,n,l,k),this._pitch=c.clamp(g,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(x,-Math.PI,Math.PI),this._setZoom(c.clamp(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let l=0,g=c.GLOBE_ZOOM_THRESHOLD_MAX,x=0,E=1/0;for(;g-l>1e-6&&g>l;){const z=l+.5*(g-l),k=this.tileSize*Math.pow(2,z),B=this.getCameraToCenterDistance(this.projection,z,k),q=this.scaleZoom(B/(n*this.tileSize)),N=Math.abs(z-q);N<E&&(E=N,x=z),z<q?l=z:g=z}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const g=Math.min(n.x,l.x),x=Math.max(n.x,l.x),E=Math.min(n.y,l.y),z=Math.max(n.y,l.y);if(E<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new c.Point(g,E),new c.Point(x,z),new c.Point(g,z),new c.Point(x,E)],B=this.renderWorldCopies?-3:0,q=this.renderWorldCopies?4:1;for(const N of k){const H=this.pointRayIntersection(N);if(H.t<0)return!0;const ne=this.rayIntersectionCoordinate(H);if(ne.x<B||ne.y<0||ne.x>q||ne.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.Point(0,0),new c.Point(this.width,this.height))}zoomDeltaToMovement(n,l){const g=c.length(c.sub([],this._camera.position,n)),x=this._zoomFromMercatorZ(g)+l;return g-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([l,g,x],E){const z=[l,g,x,1];c.transformMat4$1(z,z,E);const k=z[3]=Math.max(z[3],1e-6);return z[0]/=k,z[1]/=k,z[2]/=k,z}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.Point(0,n))}}getCameraToCenterDistance(n,l=this.zoom,g=this.worldSize){const x=bs(n,l,this.width,this.height,1024),E=n.pixelSpaceConversion(this.center.lat,g,x);return .5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&c.multiply(n,n,this.globeMatrix),n}}function Qa(m,n){let l=!1,g=null;const x=()=>{g=null,l&&(m(),g=setTimeout(x,n),l=!1)};return()=>(l=!0,g||x(),g)}class Bo{constructor(n){this._hashName=n&&encodeURIComponent(n),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Qa(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,c.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),c.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=qr(n);if(this._hashName){const g=this._hashName;let x=!1;const E=c.window.location.hash.slice(1).split("&").map(z=>{const k=z.split("=")[0];return k===g?(x=!0,`${k}=${l}`):z}).filter(z=>z);return x||E.push(`${g}=${l}`),`#${E.join("&")}`}return`#${l}`}_getCurrentHash(){const n=c.window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(l=g)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(g=>isNaN(g))){const g=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:g,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,n)}}function qr(m,n){const l=m.getCenter(),g=Math.round(100*m.getZoom())/100,x=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,x),z=Math.round(l.lng*E)/E,k=Math.round(l.lat*E)/E,B=m.getBearing(),q=m.getPitch();let N=n?`/${z}/${k}/${g}`:`${g}/${k}/${z}`;return(B||q)&&(N+="/"+Math.round(10*B)/10),q&&(N+=`/${Math.round(q)}`),N}const es={linearity:.3,easing:c.bezier(0,0,.3,1)},ts=c.extend({deceleration:2500,maxSpeed:1400},es),is=c.extend({deceleration:20,maxSpeed:1400},es),ti=c.extend({deceleration:1e3,maxSpeed:360},es),go=c.extend({deceleration:1e3,maxSpeed:90},es);class ec{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=c.exported.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new c.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)l.zoom+=E.zoomDelta||0,l.bearing+=E.bearingDelta||0,l.pitch+=E.pitchDelta||0,E.panDelta&&l.pan._add(E.panDelta),E.around&&(l.around=E.around),E.pinchAround&&(l.pinchAround=E.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(l.pan.mag()){const E=Yo(l.pan.mag(),g,c.extend({},ts,n||{}));x.offset=l.pan.mult(E.amount/l.pan.mag()),x.center=this._map.transform.center,$n(x,E)}if(l.zoom){const E=Yo(l.zoom,g,is);x.zoom=this._map.transform.zoom+E.amount,$n(x,E)}if(l.bearing){const E=Yo(l.bearing,g,ti);x.bearing=this._map.transform.bearing+c.clamp(E.amount,-179,179),$n(x,E)}if(l.pitch){const E=Yo(l.pitch,g,go);x.pitch=this._map.transform.pitch+E.amount,$n(x,E)}if(x.zoom||x.bearing){const E=l.pinchAround===void 0?l.around:l.pinchAround;x.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function $n(m,n){(!m.duration||m.duration<n.duration)&&(m.duration=n.duration,m.easing=n.easing)}function Yo(m,n,l){const{maxSpeed:g,linearity:x,deceleration:E}=l,z=c.clamp(m*x/(n/1e3),-g,g),k=Math.abs(z)/(E*x);return{easing:l.easing,duration:1e3*k,amount:z*(k/2)}}class ai extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,g,x={}){const E=to(l.getCanvasContainer(),g),z=l.unproject(E);super(n,c.extend({point:E,lngLat:z,originalEvent:g},x)),this._defaultPrevented=!1,this.target=l}}class Mi extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,g){const x=n==="touchend"?g.changedTouches:g.touches,E=Mo(l.getCanvasContainer(),x),z=E.map(B=>l.unproject(B)),k=E.reduce((B,q,N,H)=>B.add(q.div(H.length)),new c.Point(0,0));super(n,{points:E,point:k,lngLats:z,lngLat:l.unproject(k),originalEvent:g}),this._defaultPrevented=!1}}class kl extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,g){super(n,{originalEvent:g}),this._defaultPrevented=!1}}class h{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new kl(n.type,this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new ai(n.type,this._map,n))}mouseup(n){this._map.fire(new ai(n.type,this._map,n))}preclick(n){const l=c.extend({},n);l.type="preclick",this._map.fire(new ai(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new ai(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new ai(n.type,this._map,n))}mouseover(n){this._map.fire(new ai(n.type,this._map,n))}mouseout(n){this._map.fire(new ai(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Mi(n.type,this._map,n))}touchmove(n){this._map.fire(new Mi(n.type,this._map,n))}touchend(n){this._map.fire(new Mi(n.type,this._map,n))}touchcancel(n){this._map.fire(new Mi(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class d{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new ai(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ai("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new ai(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class p{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(Wn(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const g=l,x=this._startPos,E=this._lastPos;if(!x||!E||E.equals(g)||!this._box&&g.dist(x)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=di("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const z=Math.min(x.x,g.x),k=Math.max(x.x,g.x),B=Math.min(x.y,g.y),q=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${z}px,${B}px)`,this._box.style.width=k-z+"px",this._box.style.height=q-B+"px")})}mouseupWindow(n,l){if(!this._active)return;const g=this._startPos,x=l;if(g&&n.button===0){if(this.reset(),Ao(),g.x!==x.x||g.y!==x.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:E=>E.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),co(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new c.Event(n,{originalEvent:l}))}}function y(m,n){const l={};for(let g=0;g<m.length;g++)l[m[g].identifier]=n[g];return l}class I{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const E=new c.Point(0,0);for(const z of x)E._add(z);return E.div(x.length)}(l),this.touches=y(g,l)))}touchmove(n,l,g){if(this.aborted||!this.centroid)return;const x=y(g,l);for(const E in this.touches){const z=x[E];(!z||z.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(n,l,g){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class P{constructor(n){this.singleTap=new I(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,g){this.singleTap.touchstart(n,l,g)}touchmove(n,l,g){this.singleTap.touchmove(n,l,g)}touchend(n,l,g){const x=this.singleTap.touchend(n,l,g);if(x){const E=n.timeStamp-this.lastTime<500,z=!this.lastTap||this.lastTap.dist(x)<30;if(E&&z||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class D{constructor(){this._zoomIn=new P({numTouches:1,numTaps:2}),this._zoomOut=new P({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,g){this._zoomIn.touchstart(n,l,g),this._zoomOut.touchstart(n,l,g)}touchmove(n,l,g){this._zoomIn.touchmove(n,l,g),this._zoomOut.touchmove(n,l,g)}touchend(n,l,g){const x=this._zoomIn.touchend(n,l,g),E=this._zoomOut.touchend(n,l,g);return x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:z.getZoom()+1,around:z.unproject(x)},{originalEvent:n})}):E?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:z.getZoom()-1,around:z.unproject(E)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const O={0:1,2:2};class G{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const g=ra(n);this._correctButton(n,g)&&(this._lastPoint=l,this._eventButton=g)}mousemoveWindow(n,l){const g=this._lastPoint;if(g){if(n.preventDefault(),this._eventButton!=null&&function(x,E){const z=O[E];return x.buttons===void 0||(x.buttons&z)!==z}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(g,l)}}mouseupWindow(n){this._lastPoint&&ra(n)===this._eventButton&&(this._moved&&Ao(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Q extends G{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class oe extends G{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const g=.8*(l.x-n.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(n){n.preventDefault()}}class _e extends G{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const g=-.5*(l.y-n.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(n){n.preventDefault()}}class Se{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.Point(0,0)}touchstart(n,l,g){return this._calculateTransform(n,l,g)}touchmove(n,l,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!c.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,g)}}touchend(n,l,g){this._calculateTransform(n,l,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,g){g.length>0&&(this._active=!0);const x=y(g,l),E=new c.Point(0,0),z=new c.Point(0,0);let k=0;for(const q in x){const N=x[q],H=this._touches[q];H&&(E._add(N),z._add(N.sub(H)),k++,x[q]=N)}if(this._touches=x,k<this._minTouches||!z.mag())return;const B=z.div(k);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(k),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=di("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Te{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,g){return{}}touchstart(n,l,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,g){const x=this._firstTwoTouches;if(!x)return;n.preventDefault();const[E,z]=x,k=ge(g,l,E),B=ge(g,l,z);if(!k||!B)return;const q=this._aroundCenter?null:k.add(B).div(2);return this._move([k,B],q,n)}touchend(n,l,g){if(!this._firstTwoTouches)return;const[x,E]=this._firstTwoTouches,z=ge(g,l,x),k=ge(g,l,E);z&&k||(this._active&&Ao(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ge(m,n,l){for(let g=0;g<m.length;g++)if(m[g].identifier===l)return n[g]}function be(m,n){return Math.log(m/n)/Math.LN2}class We extends Te{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const g=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(be(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:be(this._distance,g),pinchAround:l}}}function Ne(m,n){return 180*m.angleWith(n)/Math.PI}class et extends Te{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const g=this._vector;if(this._vector=n[0].sub(n[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ne(this._vector,g),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const x=Ne(n,g);return Math.abs(x)<l}}function Je(m){return Math.abs(m.y)>Math.abs(m.x)}class ot extends Te{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Je(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,g){const x=this._lastPoints;if(!x)return;const E=n[0].sub(x[0]),z=n[1].sub(x[1]);return this._map._cooperativeGestures&&!c.isFullscreen()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(E,z,g.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(E.y+z.y)/2*-.5})}gestureBeginsVertically(n,l,g){if(this._valid!==void 0)return this._valid;const x=n.mag()>=2,E=l.mag()>=2;if(!x&&!E)return;if(!x||!E)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const z=n.y>0==l.y>0;return Je(n)&&Je(l)&&z}}const gt={panStep:100,bearingStep:15,pitchStep:10};class Ct{constructor(){const n=gt;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,g=0,x=0,E=0,z=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?g=-1:(n.preventDefault(),E=-1);break;case 39:n.shiftKey?g=1:(n.preventDefault(),E=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),z=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),z=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:k=>{const B=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Vt,zoom:l?Math.round(B)+l*(n.shiftKey?2:1):B,bearing:k.getBearing()+g*this._bearingStep,pitch:k.getPitch()+x*this._pitchStep,offset:[-E*this._panStep,-z*this._panStep],center:k.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Vt(m){return m*(2-m)}const fi=4.000244140625;class ei{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||c.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const g=c.exported.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,l!==0&&l%fi==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=to(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>fi?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&q!==0&&(q=1/q);const N=l(),H=Math.pow(2,N),ne=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(ne*q))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:l(),x=this._startZoom,E=this._easing;let z,k=!1;if(this._type==="wheel"&&x&&E){const B=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),q=E(B);z=c.number(x,g,q),B<1?this._frameId||(this._frameId=!0):k=!0}else z=g,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:z-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=c.ease;if(this._prevEase){const g=this._prevEase,x=(c.exported.now()-g.start)/g.duration,E=g.easing(x+.01)-g.easing(x),z=.27/Math.sqrt(E*E+1e-4)*.01,k=Math.sqrt(.0729-z*z);l=c.bezier(z,k,.25,1)}return this._prevEase={start:c.exported.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=di("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class ni{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nt{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(n.shiftKey?-1:1),around:g.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hi{constructor(){this._tap=new P({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,g){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=l[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(n,l,g))}touchmove(n,l,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=l[0],E=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(n,l,g)}touchend(n,l,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(n,l,g)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ii{constructor(n,l,g){this._el=n,this._mousePan=l,this._touchPan=g}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vi{constructor(n,l,g){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ni{constructor(n,l,g,x){this._el=n,this._touchZoom=l,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Pi=m=>m.zoom||m.drag||m.pitch||m.rotate;class ji extends c.Event{}class Dr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const g=c.sub([],l,n);this.radius=c.length(g[2]<0?c.div([],g,this.constants):[g[0],g[1],0])}projectRay(n){c.div(n,n,this.constants),c.normalize(n,n),c.mul$1(n,n,this.constants);const l=c.scale$2([],n,this.radius);if(l[2]>0){const g=c.scale$2([],[0,0,1],c.dot(l,[0,0,1])),x=c.scale$2([],c.normalize([],[l[0],l[1],0]),this.radius),E=c.add([],l,c.scale$2([],c.sub([],c.add([],x,g),l),2));l[0]=E[0],l[1]=E[1]}return l}}function Ri(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class gr{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ec(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Dr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),c.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[x,E,z]of this._listeners)x.addEventListener(E,x===c.window.document?this.handleWindowEvent:this.handleEvent,z)}destroy(){for(const[n,l,g]of this._listeners)n.removeEventListener(l,n===c.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(n){const l=this._map,g=l.getCanvasContainer();this._add("mapEvent",new h(l,n));const x=l.boxZoom=new p(l,n);this._add("boxZoom",x);const E=new D,z=new Nt;l.doubleClickZoom=new ni(z,E),this._add("tapZoom",E),this._add("clickZoom",z);const k=new Hi;this._add("tapDragZoom",k);const B=l.touchPitch=new ot(l);this._add("touchPitch",B);const q=new oe(n),N=new _e(n);l.dragRotate=new Vi(n,q,N),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const H=new Q(n),ne=new Se(l,n);l.dragPan=new Ii(g,H,ne),this._add("mousePan",H),this._add("touchPan",ne,["touchZoom","touchRotate"]);const ce=new et,fe=new We;l.touchZoomRotate=new Ni(g,fe,ce,k),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",fe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new d(l));const me=l.scrollZoom=new ei(l,this);this._add("scrollZoom",me,["mousePan"]);const de=l.keyboard=new Ct;this._add("keyboard",de);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[Y]&&l[Y].enable(n[Y])}_add(n,l,g){this._handlers.push({handlerName:n,handler:l,allowed:g}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Pi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,l,g){for(const x in n)if(x!==g&&(!l||l.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const g of n)this._el.contains(g.target)&&l.push(g);return l}handleEvent(n,l){this._updatingCamera=!0;const g=n.type==="renderFrame",x=g?void 0:n,E={needsRenderFrame:!1},z={},k={},B=n.touches?this._getMapTouches(n.touches):void 0,q=B?Mo(this._el,B):g?void 0:to(this._el,n);for(const{handlerName:ne,handler:ce,allowed:fe}of this._handlers){if(!ce.isEnabled())continue;let me;this._blockedByActive(k,fe,ne)?ce.reset():ce[l||n.type]&&(me=ce[l||n.type](n,q,B),this.mergeHandlerResult(E,z,me,ne,x),me&&me.needsRenderFrame&&this._triggerRenderFrame()),(me||ce.isActive())&&(k[ne]=ce)}const N={};for(const ne in this._previousActiveHandlers)k[ne]||(N[ne]=x);this._previousActiveHandlers=k,(Object.keys(N).length||Ri(E))&&(this._changes.push([E,z,N]),this._triggerRenderFrame()),(Object.keys(k).length||Ri(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=E;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(n,l,g,x,E){if(!g)return;c.extend(n,g);const z={handlerName:x,originalEvent:g.originalEvent||E};g.zoomDelta!==void 0&&(l.zoom=z),g.panDelta!==void 0&&(l.drag=z),g.pitchDelta!==void 0&&(l.pitch=z),g.bearingDelta!==void 0&&(l.rotate=z)}_applyChanges(){const n={},l={},g={};for(const[x,E,z]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new c.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(n.around=x.around),x.aroundCoord!==void 0&&(n.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),c.extend(l,E),c.extend(g,z);this._updateMapTransform(n,l,g),this._changes=[]}_updateMapTransform(n,l,g){const x=this._map,E=x.transform,z=ue=>[ue.x,ue.y,ue.z];if((ue=>{const we=this._eventsInProgress.drag;return we&&!this._handlersById[we.handlerName].isActive()})()&&!Ri(n)){const ue=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",ue!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&x._stop(!0),!Ri(n))return void this._fireEvents(l,g,!0);let{panDelta:k,zoomDelta:B,bearingDelta:q,pitchDelta:N,around:H,aroundCoord:ne,pinchAround:ce}=n;E._isCameraConstrained&&(B>0&&(B=0),E._isCameraConstrained=!1),ce!==void 0&&(H=ce),(B||(ue=>l[ue]&&!this._eventsInProgress[ue])("drag"))&&H&&(this._dragOrigin=z(E.pointCoordinate3D(H)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",x._stop(!0),H=H||x.transform.centerPoint,q&&(E.bearing+=q),N&&(E.pitch+=N),E._updateCameraState();const fe=[0,0,0];if(k)if(E.projection.name==="mercator"){const ue=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H).dir),we=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H.sub(k)).dir);fe[0]=we[0]-ue[0],fe[1]=we[1]-ue[1]}else{const ue=E.pointCoordinate(H);if(E.projection.name==="globe"){k=k.rotate(-E.angle);const we=E._pixelsPerMercatorPixel/E.worldSize;fe[0]=-k.x*c.mercatorScale(c.latFromMercatorY(ue.y))*we,fe[1]=-k.y*c.mercatorScale(E.center.lat)*we}else{const we=E.pointCoordinate(H.sub(k));ue&&we&&(fe[0]=we.x-ue.x,fe[1]=we.y-ue.y)}}const me=E.zoom,de=[0,0,0];if(B){const ue=z(ne||E.pointCoordinate3D(H)),we={dir:c.normalize([],c.sub([],ue,E._camera.position))};if(we.dir[2]<0){const Ee=E.zoomDeltaToMovement(ue,B);c.scale$2(de,we.dir,Ee)}}const Y=c.add(fe,fe,de);E._translateCameraConstrained(Y),B&&Math.abs(E.zoom-me)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,g,!0)}_fireEvents(n,l,g){const x=Pi(this._eventsInProgress),E=Pi(n),z={};for(const N in n){const{originalEvent:H}=n[N];this._eventsInProgress[N]||(z[`${N}start`]=H),this._eventsInProgress[N]=n[N]}!x&&E&&this._fireEvent("movestart",E.originalEvent);for(const N in z)this._fireEvent(N,z[N]);E&&this._fireEvent("move",E.originalEvent);for(const N in n){const{originalEvent:H}=n[N];this._fireEvent(N,H)}const k={};let B;for(const N in this._eventsInProgress){const{handlerName:H,originalEvent:ne}=this._eventsInProgress[N];this._handlersById[H].isActive()||(delete this._eventsInProgress[N],B=l[H]||ne,k[`${N}end`]=B)}for(const N in k)this._fireEvent(N,k[N]);const q=Pi(this._eventsInProgress);if(g&&(x||E)&&!q){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=ne=>ne!==0&&-this._bearingSnap<ne&&ne<this._bearingSnap;N?(H(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:B})):(this._map.fire(new c.Event("moveend",{originalEvent:B})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new c.Event(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new ji("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const fr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class xr extends c.Evented{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,g){return n=c.Point.convert(n).mult(-1),this.panTo(this.transform.center,c.extend({offset:n},l),g)}panTo(n,l,g){return this.easeTo(c.extend({center:n},l),g)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,g){return this.easeTo(c.extend({zoom:n},l),g)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,g){return this.easeTo(c.extend({bearing:n},l),g)}resetNorth(n,l){return this.rotateTo(0,c.extend({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=c.LngLatBounds.convert(n);const g=l&&l.bearing||0,x=l&&l.pitch||0,E=n.getNorthWest(),z=n.getSouthEast();return this._cameraForBounds(this.transform,E,z,g,x,l)}_extendCameraOptions(n){const l={top:0,bottom:0,right:0,left:0};if(typeof(n=c.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const g=n.padding;n.padding={top:g,bottom:g,right:g,left:g}}return n.padding=c.extend(l,n.padding),n}_minimumAABBFrustumDistance(n,l){const g=l.max[0]-l.min[0],x=l.max[1]-l.min[1];return g/x>n.aspect?g/(2*Math.tan(.5*n.fovX)*n.aspect):x/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,g,x,E,z){const k=n.clone(),B=this._extendCameraOptions(z);k.bearing=x,k.pitch=E;const q=c.LngLat.convert(l),N=c.LngLat.convert(g),H=.5*(q.lat+N.lat),ne=.5*(q.lng+N.lng),ce=c.latLngToECEF(H,ne),fe=c.normalize([],ce),me=c.normalize([],c.cross([],fe,[0,1,0])),de=c.cross([],me,fe),Y=[me[0],me[1],me[2],0,de[0],de[1],de[2],0,fe[0],fe[1],fe[2],0,0,0,0,1],ue=[ce,c.latLngToECEF(q.lat,q.lng),c.latLngToECEF(N.lat,q.lng),c.latLngToECEF(N.lat,N.lng),c.latLngToECEF(q.lat,N.lng),c.latLngToECEF(H,q.lng),c.latLngToECEF(H,N.lng),c.latLngToECEF(q.lat,ne),c.latLngToECEF(N.lat,ne)];let we=c.Aabb.fromPoints(ue.map(Mt=>[c.dot(me,Mt),c.dot(de,Mt),c.dot(fe,Mt)]));const Ee=c.transformMat4([],we.center,Y);c.squaredLength(Ee)===0&&c.set(Ee,0,0,1),c.normalize(Ee,Ee),c.scale$2(Ee,Ee,c.GLOBE_RADIUS),k.center=c.ecefToLatLng(Ee);const Fe=k.getWorldToCameraMatrix(),qe=c.invert(new Float64Array(16),Fe);we=c.Aabb.applyTransform(we,c.multiply([],Fe,Y)),c.transformMat4(Ee,Ee,Fe);const je=.5*(we.max[2]-we.min[2]),Ke=this._minimumAABBFrustumDistance(k,we),$e=c.scale$2([],[0,0,1],je),ct=c.add($e,Ee,$e),Bt=Ke+(k.pitch===0?0:c.distance(Ee,ct)),nt=k.globeCenterInViewSpace,Tt=c.sub([],Ee,[nt[0],nt[1],nt[2]]);c.normalize(Tt,Tt),c.scale$2(Tt,Tt,Bt);const dt=c.add([],Ee,Tt);c.transformMat4(dt,dt,qe);const kt=c.earthRadius/c.GLOBE_RADIUS,ut=c.length(dt),xt=c.mercatorZfromAltitude(Math.max(ut*kt-c.earthRadius,Number.EPSILON),0),Lt=Math.min(k.zoomFromMercatorZAdjusted(xt),B.maxZoom);return Lt>.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"mercator"}),k.zoom=Lt,this._cameraForBounds(k,l,g,x,E,z)):{center:k.center,zoom:Lt,bearing:x,pitch:E}}queryTerrainElevation(n,l){const g=this.transform.elevation;return g?(l=c.extend({},{exaggerated:!0},l),g.getAtPoint(c.MercatorCoordinate.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,g,x,E,z){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,l,g,x,E,z);const k=n.clone(),B=this._extendCameraOptions(z),q=k.padding;k.bearing=x,k.pitch=E;const N=c.LngLat.convert(l),H=c.LngLat.convert(g),ne=new c.LngLat(N.lng,H.lat),ce=new c.LngLat(H.lng,N.lat),fe=k.project(N),me=k.project(H),de=this.queryTerrainElevation(N),Y=this.queryTerrainElevation(H),ue=this.queryTerrainElevation(ne),we=this.queryTerrainElevation(ce),Ee=[[fe.x,fe.y,Math.min(de||0,Y||0,ue||0,we||0)],[me.x,me.y,Math.max(de||0,Y||0,ue||0,we||0)]];let Fe=c.Aabb.fromPoints(Ee);const qe=k.getWorldToCameraMatrix(),je=c.invert(new Float64Array(16),qe);Fe=c.Aabb.applyTransform(Fe,qe);const Ke=c.sub([],Fe.max,Fe.min),$e=q.left||0,ct=q.right||0,Bt=q.bottom||0,nt=q.top||0,{left:Tt,right:dt,top:kt,bottom:ut}=B.padding,xt=.5*($e+ct),Lt=.5*(nt+Bt),Mt=Math.min(k.scaleZoom(k.scale*Math.min((k.width-($e+ct+Tt+dt))/Ke[0],(k.height-(Bt+nt+ut+kt))/Ke[1])),B.maxZoom),Ut=k.scale/k.zoomScale(Mt);Fe=new c.Aabb([Fe.min[0]-(Tt+xt)*Ut,Fe.min[1]-(ut+Lt)*Ut,Fe.min[2]],[Fe.max[0]+(dt+xt)*Ut,Fe.max[1]+(kt+Lt)*Ut,Fe.max[2]]);const Si=.5*Ke[2],Ai=this._minimumAABBFrustumDistance(k,Fe),ui=[0,0,1,0];c.transformMat4$1(ui,ui,qe),c.normalize$2(ui,ui);const Fi=c.scale$2([],ui,Ai+Si),ur=c.add([],Fe.center,Fi),yr=(typeof B.offset.x=="number"&&typeof B.offset.y=="number"?new c.Point(B.offset.x,B.offset.y):c.Point.convert(B.offset)).rotate(-c.degToRad(x));Fe.center[0]-=yr.x*Ut,Fe.center[1]+=yr.y*Ut,c.transformMat4(Fe.center,Fe.center,je),c.transformMat4(ur,ur,je);const wi=[Fe.center[0],Fe.center[1],ur[2]*k.pixelsPerMeter];c.scale$2(wi,wi,1/k.worldSize);const Gr=c.lngFromMercatorX(wi[0]),sn=c.latFromMercatorY(wi[1]),nn=Math.min(k._zoomFromMercatorZ(wi[2]),B.maxZoom),ln=new c.LngLat(Gr,sn);return k.mercatorFromTransition&&nn<.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"globe"}),k.zoom=nn,this._cameraForBounds(k,l,g,x,E,z)):{center:ln,zoom:nn,bearing:x,pitch:E}}fitBounds(n,l,g){const x=this.cameraForBounds(n,l);return this._fitInternal(x,l,g)}fitScreenCoordinates(n,l,g,x,E){const z=c.Point.convert(n),k=c.Point.convert(l),B=new c.Point(Math.min(z.x,k.x),Math.min(z.y,k.y)),q=new c.Point(Math.max(z.x,k.x),Math.max(z.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(z,k))return this;const N=this.transform.pointLocation3D(B),H=this.transform.pointLocation3D(q),ne=this.transform.pointLocation3D(new c.Point(B.x,q.y)),ce=this.transform.pointLocation3D(new c.Point(q.x,B.y)),fe=[Math.min(N.lng,H.lng,ne.lng,ce.lng),Math.min(N.lat,H.lat,ne.lat,ce.lat)],me=[Math.max(N.lng,H.lng,ne.lng,ce.lng),Math.max(N.lat,H.lat,ne.lat,ce.lat)],de=x&&x.pitch?x.pitch:this.getPitch(),Y=this._cameraForBounds(this.transform,fe,me,g,de,x);return this._fitInternal(Y,x,E)}_fitInternal(n,l,g){return n?(delete(l=c.extend(n,l)).padding,l.linear?this.easeTo(l,g):this.flyTo(l,g)):this}jumpTo(n,l){this.stop();const g=n.preloadOnly?this.transform.clone():this.transform;let x=!1,E=!1,z=!1;return"zoom"in n&&g.zoom!==+n.zoom&&(x=!0,g.zoom=+n.zoom),n.center!==void 0&&(g.center=c.LngLat.convert(n.center)),"bearing"in n&&g.bearing!==+n.bearing&&(E=!0,g.bearing=+n.bearing),"pitch"in n&&g.pitch!==+n.pitch&&(z=!0,g.pitch=+n.pitch),n.padding==null||g.isPaddingEqual(n.padding)||(g.padding=n.padding),n.preloadOnly?(this._preloadTiles(g),this):(this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),x&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),E&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),z&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.warnOnce(fr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const g=this.transform;if(!g.projection.supportsFreeCamera)return c.warnOnce(fr),this;this.stop();const x=g.zoom,E=g.pitch,z=g.bearing;g.setFreeCameraOptions(n);const k=x!==g.zoom,B=E!==g.pitch,q=z!==g.bearing;return this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),k&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),q&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),B&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=c.extend({offset:[0,0],duration:500,easing:c.ease},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const g=this.transform,x=this.getZoom(),E=this.getBearing(),z=this.getPitch(),k=this.getPadding(),B="zoom"in n?+n.zoom:x,q="bearing"in n?this._normalizeBearing(n.bearing,E):E,N="pitch"in n?+n.pitch:z,H="padding"in n?n.padding:g.padding,ne=c.Point.convert(n.offset);let ce,fe,me;if(g.projection.name==="globe"){const $e=c.MercatorCoordinate.fromLngLat(g.center),ct=ne.rotate(-g.angle);$e.x+=ct.x/g.worldSize,$e.y+=ct.y/g.worldSize;const Bt=$e.toLngLat(),nt=c.LngLat.convert(n.center||Bt);this._normalizeCenter(nt),ce=g.centerPoint.add(ct),fe=new c.Point($e.x,$e.y).mult(g.worldSize),me=new c.Point(c.mercatorXfromLng(nt.lng),c.mercatorYfromLat(nt.lat)).mult(g.worldSize).sub(fe)}else{ce=g.centerPoint.add(ne);const $e=g.pointLocation(ce),ct=c.LngLat.convert(n.center||$e);this._normalizeCenter(ct),fe=g.project($e),me=g.project(ct).sub(fe)}const de=g.zoomScale(B-x);let Y,ue;n.around&&(Y=c.LngLat.convert(n.around),ue=g.locationPoint(Y));const we=this._zooming||B!==x,Ee=this._rotating||E!==q,Fe=this._pitching||N!==z,qe=!g.isPaddingEqual(H),je=$e=>ct=>{if(we&&($e.zoom=c.number(x,B,ct)),Ee&&($e.bearing=c.number(E,q,ct)),Fe&&($e.pitch=c.number(z,N,ct)),qe&&($e.interpolatePadding(k,H,ct),ce=$e.centerPoint.add(ne)),Y)$e.setLocationAtPoint(Y,ue);else{const Bt=$e.zoomScale($e.zoom-x),nt=B>x?Math.min(2,de):Math.max(.5,de),Tt=Math.pow(nt,1-ct),dt=$e.unproject(fe.add(me.mult(ct*Tt)).mult(Bt));$e.setLocationAtPoint($e.renderWorldCopies?dt.wrap():dt,ce)}return n.preloadOnly||this._fireMoveEvents(l),$e};if(n.preloadOnly){const $e=this._emulate(je,n.duration,g);return this._preloadTiles($e),this}const Ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=we,this._rotating=Ee,this._pitching=Fe,this._padding=qe,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,Ke),this._ease(je(g),$e=>{g.recenterOnTerrain(),this._afterEase(l,$e)},n),this}_prepareEase(n,l,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||g.moving||this.fire(new c.Event("movestart",n)),this._zooming&&!g.zooming&&this.fire(new c.Event("zoomstart",n)),this._rotating&&!g.rotating&&this.fire(new c.Event("rotatestart",n)),this._pitching&&!g.pitching&&this.fire(new c.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new c.Event("move",n)),this._zooming&&this.fire(new c.Event("zoom",n)),this._rotating&&this.fire(new c.Event("rotate",n)),this._pitching&&this.fire(new c.Event("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new c.Event("zoomend",n)),x&&this.fire(new c.Event("rotateend",n)),E&&this.fire(new c.Event("pitchend",n)),this.fire(new c.Event("moveend",n))}flyTo(n,l){if(this._prefersReducedMotion(n)){const Mt=c.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Mt,l)}this.stop(),n=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},n);const g=this.transform,x=this.getZoom(),E=this.getBearing(),z=this.getPitch(),k=this.getPadding(),B="zoom"in n?c.clamp(+n.zoom,g.minZoom,g.maxZoom):x,q="bearing"in n?this._normalizeBearing(n.bearing,E):E,N="pitch"in n?+n.pitch:z,H="padding"in n?n.padding:g.padding,ne=g.zoomScale(B-x),ce=c.Point.convert(n.offset);let fe=g.centerPoint.add(ce);const me=g.pointLocation(fe),de=c.LngLat.convert(n.center||me);this._normalizeCenter(de);const Y=g.project(me),ue=g.project(de).sub(Y);let we=n.curve;const Ee=Math.max(g.width,g.height),Fe=Ee/ne,qe=ue.mag();if("minZoom"in n){const Mt=c.clamp(Math.min(n.minZoom,x,B),g.minZoom,g.maxZoom),Ut=Ee/g.zoomScale(Mt-x);we=Math.sqrt(Ut/qe*2)}const je=we*we;function Ke(Mt){const Ut=(Fe*Fe-Ee*Ee+(Mt?-1:1)*je*je*qe*qe)/(2*(Mt?Fe:Ee)*je*qe);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function $e(Mt){return(Math.exp(Mt)-Math.exp(-Mt))/2}function ct(Mt){return(Math.exp(Mt)+Math.exp(-Mt))/2}const Bt=Ke(0);let nt=function(Mt){return ct(Bt)/ct(Bt+we*Mt)},Tt=function(Mt){return Ee*((ct(Bt)*($e(Ut=Bt+we*Mt)/ct(Ut))-$e(Bt))/je)/qe;var Ut},dt=(Ke(1)-Bt)/we;if(Math.abs(qe)<1e-6||!isFinite(dt)){if(Math.abs(Ee-Fe)<1e-6)return this.easeTo(n,l);const Mt=Fe<Ee?-1:1;dt=Math.abs(Math.log(Fe/Ee))/we,Tt=function(){return 0},nt=function(Ut){return Math.exp(Mt*we*Ut)}}n.duration="duration"in n?+n.duration:1e3*dt/("screenSpeed"in n?+n.screenSpeed/we:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const kt=E!==q,ut=N!==z,xt=!g.isPaddingEqual(H),Lt=Mt=>Ut=>{const Si=Ut*dt,Ai=1/nt(Si);Mt.zoom=Ut===1?B:x+Mt.scaleZoom(Ai),kt&&(Mt.bearing=c.number(E,q,Ut)),ut&&(Mt.pitch=c.number(z,N,Ut)),xt&&(Mt.interpolatePadding(k,H,Ut),fe=Mt.centerPoint.add(ce));const ui=Ut===1?de:Mt.unproject(Y.add(ue.mult(Tt(Si))).mult(Ai));return Mt.setLocationAtPoint(Mt.renderWorldCopies?ui.wrap():ui,fe),Mt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),Mt};if(n.preloadOnly){const Mt=this._emulate(Lt,n.duration,g);return this._preloadTiles(Mt),this}return this._zooming=!0,this._rotating=kt,this._pitching=ut,this._padding=xt,this._prepareEase(l,!1),this._ease(Lt(g),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,l)}if(!n){const g=this.handlers;g&&g.stop(!1)}return this}_ease(n,l,g){g.animate===!1||g.duration===0?(n(1),l()):(this._easeStart=c.exported.now(),this._easeOptions=g,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=c.wrap(n,-180,180);const g=Math.abs(n-l);return Math.abs(n-360-l)<g&&(n-=360),Math.abs(n+360-l)<g&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const g=n.lng-l.center.lng;n.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&c.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,l,g){const x=Math.ceil(15*l/1e3),E=[],z=n(g.clone());for(let k=0;k<=x;k++){const B=z(k/x);E.push(B.clone())}return E}}class Ft{constructor(n={}){this.options=n,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact;return this._map=n,this._container=di("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=di("button","mapboxgl-ctrl-attrib-button",this._container),di("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=di("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,l){const g=this._map._getUIString(`AttributionControl.${l}`);n.setAttribute("aria-label",g),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(n){const g=l.reduce((x,E,z)=>(E.value&&(x+=`${E.key}=${E.value}${z<l.length-1?"&":""}`),x),"?");n.href=`${c.config.FEEDBACK_URL}/${g}#${qr(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const l=this._map.style._sourceCaches;for(const x in l){const E=l[x];if(E.used){const z=E.getSource();z.attribution&&n.indexOf(z.attribution)<0&&n.push(z.attribution)}}n.sort((x,E)=>x.length-E.length),n=n.filter((x,E)=>{for(let z=E+1;z<n.length;z++)if(n[z].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const g=n.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,n.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Vn{constructor(){c.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=di("div","mapboxgl-ctrl");const l=di("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const g=n[l].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Cn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,g=l?this._queue.concat(l):this._queue;for(const x of g)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const g of l)if(!g.cancelled&&(g.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fo(m,n,l){if(m=new c.LngLat(m.lng,m.lat),n){const g=new c.LngLat(m.lng-360,m.lat),x=new c.LngLat(m.lng+360,m.lat),E=360*Math.ceil(Math.abs(m.lng-l.center.lng)/360),z=l.locationPoint(m).distSqr(n),k=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint(g).distSqr(n)<z&&(k||Math.abs(g.lng-l.center.lng)<E)?m=g:l.locationPoint(x).distSqr(n)<z&&(k||Math.abs(x.lng-l.center.lng)<E)&&(m=x)}for(;Math.abs(m.lng-l.center.lng)>180;){const g=l.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=l.width&&g.y<=l.height)break;m.lng>l.center.lng?m.lng-=360:m.lng+=360}return m}const Lr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class $t extends c.Evented{constructor(n,l){if(super(),(n instanceof c.window.HTMLElement||l)&&(n=c.extend({element:n},l)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=c.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=di("div");const x=41,E=27,z=Di("svg",{display:"block",height:x*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${x}`},this._element),k=Di("radialGradient",{id:"shadowGradient"},Di("defs",{},z));Di("stop",{offset:"10%","stop-opacity":.4},k),Di("stop",{offset:"100%","stop-opacity":.05},k),Di("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},z),Di("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},z),Di("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},z),Di("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},z),this._offset=c.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const g=this._element.classList;for(const x in Lr)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=c.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,g=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,g=this._element;this._popup&&(l===g||g.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const g=n.unproject(l),x=n.getFreeCameraOptions();if(!x.position)return!1;const E=x.position.toLngLat();return E.distanceTo(g)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const g=n.unproject(l);let x;n._showingGlobe()&&c.isLngLatBehindGlobe(n.transform,this._lngLat)?x=0:(x=1-n._queryFogOpacity(g),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Lr[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const n=this._pos,l=this._map,g=this.getPitchAlignment();if(!l||!n||g!=="map")return"";if(!l._showingGlobe()){const B=l.getPitch();return B?`rotateX(${B}deg)`:""}const x=c.radToDeg(c.globeTiltAtLngLat(l.transform,this._lngLat)),E=n.sub(c.globeCenterToScreenPoint(l.transform)),z=Math.abs(E.x)+Math.abs(E.y);if(z===0)return"";const k=x/z;return`rotateX(${-E.y*k}deg) rotateY(${E.x*k}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let g=0;const x=this.getRotationAlignment();if(x==="map")if(l._showingGlobe()){const E=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),z=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);g=c.radToDeg(Math.atan2(z.y,z.x))-90}else g=-l.getBearing();else if(x==="horizon"){const E=c.smoothstep(4,6,l.getZoom()),z=c.globeCenterToScreenPoint(l.transform);z.y+=E*l.transform.height;const k=n.sub(z),B=c.radToDeg(Math.atan2(k.y,k.x));g=(B>90?B-270:B+90)*(1-E)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(n){c.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Fo(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),n===!0?this._updateFrameId=c.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=c.Point.convert(n),this._update(),this}_onMove(n){const l=this._map;if(!l)return;const g=this._pointerdownPos,x=this._positionDelta;if(g&&x){if(!this._isDragging){const E=this._clickTolerance||l._clickTolerance;if(n.point.dist(g)<E)return;this._isDragging=!0}this._pos=n.point.sub(x),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,g=this._pos;l&&g&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(g),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const qs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},tc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ha(m=new c.Point(0,0),n="bottom"){if(typeof m=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(n){case"top":return new c.Point(0,m);case"top-left":return new c.Point(l,l);case"top-right":return new c.Point(-l,l);case"bottom":return new c.Point(0,-m);case"bottom-left":return new c.Point(l,-l);case"bottom-right":return new c.Point(-l,-l);case"left":return new c.Point(m,0);case"right":return new c.Point(-m,0)}return new c.Point(0,0)}return m instanceof c.Point||Array.isArray(m)?c.Point.convert(m):c.Point.convert(m[n]||[0,0])}class ul{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=c.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,g){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+g}}const ic={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},rs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Wc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ic{constructor(n,l,g=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new oe({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,g&&(this.mousePitch=new _e({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),Wn()}move(n,l){const g=this.map,x=this.mouseRotate.mousemoveWindow(n,l),E=x&&x.bearingDelta;if(E&&g.setBearing(g.getBearing()+E),this.mousePitch){const z=this.mousePitch.mousemoveWindow(n,l),k=z&&z.pitchDelta;k&&g.setPitch(g.getPitch()+k)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){co(),c.window.removeEventListener("mousemove",this.mousemove),c.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(c.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),to(this.element,n)),c.window.addEventListener("mousemove",this.mousemove),c.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,to(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Mo(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Mo(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ws={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ba={maxWidth:100,unit:"metric"},Ac={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Fa={version:c.version,supported:Kt,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends xr{constructor(m){if(c.LivePerformanceUtils.mark(c.PerformanceMarkers.create),(m=c.extend({},rs,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&c.isSafariWithAntialiasingBug(c.window)&&(m.antialias=!1,c.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new cl(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Cn,this._domRenderTaskQueue=new Cn,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.uniqueId(),this._locale=c.extend({},ic,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ul(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new c.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=c.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof c.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&c.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),c.window!==void 0&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new gr(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new Bo(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,c.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Ft({customAttribution:m.customAttribution})),this._logoControl=new Vn,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new c.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new c.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(m,n){if(n===void 0&&(n=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[n];return n.indexOf("bottom")!==-1?g.insertBefore(l,g.firstChild):g.appendChild(l),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(m);return n>-1&&this._controls.splice(n,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new c.Event("movestart",m)).fire(new c.Event("move",m)),this.fire(new c.Event("resize",m)),n&&this.fire(new c.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(c.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?c.window.navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(n=>n==="auto"?c.window.navigator.language:n):m}setLanguage(m){const n=this._parseLanguage(m);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,n=m.projection.name;let l;n==="globe"&&m.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),l=!0):n==="mercator"&&m.zoom<c.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,n){return this._updateProjection(m||n||{name:"mercator"})}_updateProjection(m){let n;if(n=m.name==="globe"&&this.transform.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(c.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(c.Point.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,n,l){if(m==="mouseenter"||m==="mouseover"){let g=!1;const x=z=>{const k=n.filter(q=>this.getLayer(q)),B=k.length?this.queryRenderedFeatures(z.point,{layers:k}):[];B.length?g||(g=!0,l.call(this,new ai(m,this,z.originalEvent,{features:B}))):g=!1},E=()=>{g=!1};return{layers:new Set(n),listener:l,delegates:{mousemove:x,mouseout:E}}}if(m==="mouseleave"||m==="mouseout"){let g=!1;const x=z=>{const k=n.filter(B=>this.getLayer(B));(k.length?this.queryRenderedFeatures(z.point,{layers:k}):[]).length?g=!0:g&&(g=!1,l.call(this,new ai(m,this,z.originalEvent)))},E=z=>{g&&(g=!1,l.call(this,new ai(m,this,z.originalEvent)))};return{layers:new Set(n),listener:l,delegates:{mousemove:x,mouseout:E}}}{const g=x=>{const E=n.filter(k=>this.getLayer(k)),z=E.length?this.queryRenderedFeatures(x.point,{layers:E}):[];z.length&&(x.features=z,l.call(this,x),delete x.features)};return{layers:new Set(n),listener:l,delegates:{[m]:g}}}}on(m,n,l){if(l===void 0)return super.on(m,n);Array.isArray(n)||(n=[n]);const g=this._createDelegatedListener(m,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(m,n,l){if(l===void 0)return super.once(m,n);Array.isArray(n)||(n=[n]);const g=this._createDelegatedListener(m,n,l);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(m,n,l){if(l===void 0)return super.off(m,n);n=new Set(Array.isArray(n)?n:[n]);const g=(E,z)=>{if(E.size!==z.size)return!1;for(const k of E)if(!z.has(k))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[m]:void 0;return x&&(E=>{for(let z=0;z<E.length;z++){const k=E[z];if(k.listener===l&&g(k.layers,n)){for(const B in k.delegates)this.off(B,k.delegates[B]);return E.splice(z,1),this}}})(x),this}queryRenderedFeatures(m,n){return this.style?(n!==void 0||m===void 0||m instanceof c.Point||Array.isArray(m)||(n=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(m,n){return this.style.querySourceFeatures(m,n)}isPointOnSurface(m){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&c.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(c.Point.convert(m))}setStyle(m,n){return(n=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(m,n))}_getUIString(m){const n=this._locale[m];if(n==null)throw new Error(`Missing UI string '${m}'`);return n}_updateStyle(m,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new $o(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new $o(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,n){if(typeof m=="string"){const l=this._requestManager.normalizeStyleURL(m),g=this._requestManager.transformRequest(l,c.ResourceType.Style);c.getJSON(g,(x,E)=>{x?this.fire(new c.ErrorEvent(x)):E&&this._updateDiff(E,n)})}else typeof m=="object"&&this._updateDiff(m,n)}_updateDiff(m,n){try{this.style.setState(m)&&this._update(!0)}catch(l){c.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(m,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.warnOnce("There is no style added to the map."),!1)}addSource(m,n){return this._lazyInitEmptyStyle(),this.style.addSource(m,n),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const n in m){const l=m[n]._tiles;for(const g in l){const x=l[g];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(m,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(m,n,l)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,n,{pixelRatio:l=1,sdf:g=!1,stretchX:x,stretchY:E,content:z}={}){if(this._lazyInitEmptyStyle(),n instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&n instanceof c.window.ImageBitmap){const{width:k,height:B,data:q}=c.exported.getImageData(n);this.style.addImage(m,{data:new c.RGBAImage({width:k,height:B},q),pixelRatio:l,stretchX:x,stretchY:E,content:z,sdf:g,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:B}=n,q=n;this.style.addImage(m,{data:new c.RGBAImage({width:k,height:B},new Uint8Array(q.data)),pixelRatio:l,stretchX:x,stretchY:E,content:z,sdf:g,version:0,userImage:q}),q.onAdd&&q.onAdd(this,m)}}updateImage(m,n){const l=this.style.getImage(m);if(!l)return void this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=n instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&n instanceof c.window.ImageBitmap?c.exported.getImageData(n):n,{width:x,height:E}=g;x!==void 0&&E!==void 0?x===l.data.width&&E===l.data.height?(l.data.replace(g.data,!(n instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&n instanceof c.window.ImageBitmap)),this.style.updateImage(m,l)):this.fire(new c.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${E})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,n){c.getImage(this._requestManager.transformRequest(m,c.ResourceType.Image),(l,g)=>{n(l,g instanceof c.window.HTMLImageElement?c.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(m,n){return this._lazyInitEmptyStyle(),this.style.addLayer(m,n),this._update(!0)}moveLayer(m,n){return this.style.moveLayer(m,n),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,n,l){return this.style.setLayerZoomRange(m,n,l),this._update(!0)}setFilter(m,n,l={}){return this.style.setFilter(m,n,l),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,n,l,g={}){return this.style.setPaintProperty(m,n,l,g),this._update(!0)}getPaintProperty(m,n){return this.style.getPaintProperty(m,n)}setLayoutProperty(m,n,l,g={}){return this.style.setLayoutProperty(m,n,l,g),this._update(!0)}getLayoutProperty(m,n){return this.style.getLayoutProperty(m,n)}setLight(m,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(m),this.transform):0}setFeatureState(m,n){return this.style.setFeatureState(m,n),this._update()}removeFeatureState(m,n){return this.style.removeFeatureState(m,n),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,g,x,E=this._container;for(;E&&(!g||!x);){const z=c.window.getComputedStyle(E).transform;z&&z!=="none"&&(l=z.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(g=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(x=l[3])),E=E.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=x?Math.abs(n/x):n}_detectMissingCSS(){c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=di("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=di("div","mapboxgl-canvas-container",m);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=di("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=di("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=di("div",`mapboxgl-ctrl-${x}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,n){const l=c.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(m),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${n}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const n=this._markers.indexOf(m);n!==-1&&this._markers.splice(n,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const n=this._popups.indexOf(m);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const m=c.extend({},Kt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",m),l=n||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);l?(this._useWebGL2&&!n&&c.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),c.storeAuthState(l,!0),this.painter=new Jl(l,this.transform,!!n),this.on("data",g=>{g.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(l)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let n;const l=this.painter.context.extTimerQuery,g=c.exported.now();if(this.listens("gpu-timing-frame")&&(n=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],c.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],c.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,B=this.transform.pitch,q=c.exported.now(),N=new c.EvaluationParameters(k,{now:q,fadeDuration:x,pitch:B,transition:this.style.getTransition()});this.style.update(N)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const k=c.exported.now()-g;l.endQueryEXT(l.TIME_ELAPSED_EXT,n),setTimeout(()=>{const B=l.getQueryObjectEXT(n,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(n),this.fire(new c.Event("gpu-timing-frame",{cpuTime:k,gpuTime:B})),c.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:B}})},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(k);this.fire(new c.Event("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(k);this.fire(new c.Event("gpu-timing-deferred-render",{gpuTime:B}))},50)}const z=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(z||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,c.LivePerformanceUtils.mark(c.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&c.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const n of this._markers)m&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!m||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(m,n=!1){const l=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((n||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const g=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;const z=Math.abs(g-x);if(z>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(x),l(x);this._averageElevation.easeTo(x,m,300)}else if(z>1e-4)return this._averageElevation.jumpTo(x),l(x)}return!!this._averageElevation.isEasing(m)&&l(this._averageElevation.getValue(m))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===c.AUTH_ERR_MSG||m.status===401)){const n=this.painter.context.gl;c.storeAuthState(n,!1),this._logoControl instanceof Vn&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,g=l.createFramebuffer();function x(E){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,E,0);const z=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,z),z}return l.bindFramebuffer(l.FRAMEBUFFER,g),this._canvasPixelComparison(x(m),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(m,n,l){let g=l[1]-l[0];const x=m.length/4;for(let E=0;E<n.length;E++){const z=n[E];let k=0;for(let B=0;B<z.length;B+=4)z[B]===m[B]&&z[B+1]===m[B+1]&&z[B+2]===m[B+2]&&z[B+3]===m[B+3]&&(k+=1);g+=(l[E+2]-l[E+1])*(1-k/x)}return g}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),c.window!==void 0&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1),c.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=c.exported.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(m){const n=this.style?Object.values(this.style._sourceCaches):[];return c.asyncAll(n,(l,g)=>l._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){c.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,n){c.setCacheLimits(m,n)}get version(){return c.version}},NavigationControl:class{constructor(m){this.options=c.extend({},Wc,m),this._container=di("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),di("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),di("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))}),this._compassIcon=di("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const n=m.getZoom(),l=n===m.getMaxZoom(),g=n===m.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ic(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,n){const l=di("button",m,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(m,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);m.setAttribute("aria-label",l),m.firstElementChild&&m.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends c.Evented{constructor(m){super(),this.options=c.extend({geolocation:c.window.navigator.geolocation},ws,m),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Qa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=di("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,m(l)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):c.window.navigator.permissions!==void 0?c.window.navigator.permissions.query({name:"geolocation"}).then(l=>n(l.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(m){const n=this._map.getMaxBounds(),l=m.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",m)),this._finish()}}_updateCamera(m){const n=new c.LngLat(m.coords.longitude,m.coords.latitude),l=m.coords.accuracy,g=this._map.getBearing(),x=c.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),x,{geolocateSource:!0})}_updateMarker(m){if(m){const n=new c.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,n=c.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=di("button","mapboxgl-ctrl-geolocate",this._container),di("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=di("div","mapboxgl-user-location"),this._dotElement.appendChild(di("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(di("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $t({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=di("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $t({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};c.window.DeviceMotionEvent!==void 0&&typeof c.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientation),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ft,ScaleControl:class{constructor(m){this.options=c.extend({},Ba,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),c.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,g=n._containerWidth/2-m/2,x=n.unproject([g,l]),E=n.unproject([g+m,l]),z=x.distanceTo(E);if(this.options.unit==="imperial"){const k=3.2808*z;k>5280?this._setScale(m,k/5280,"mile"):this._setScale(m,k,"foot")}else this.options.unit==="nautical"?this._setScale(m,z/1852,"nautical-mile"):z>=1e3?this._setScale(m,z/1e3,"kilometer"):this._setScale(m,z,"meter")}_setScale(m,n,l){this._map._requestDomTask(()=>{const g=function(E){const z=Math.pow(10,`${Math.floor(E)}`.length-1);let k=E/z;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(B){const q=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*q)/q}(k),z*k}(n),x=g/n;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(g):`${g}&nbsp;${Ac[l]}`,this._container.style.width=m*x+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=di("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof c.window.HTMLElement?this._container=m.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=di("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=di("button","mapboxgl-ctrl-fullscreen",this._controlContainer);di("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(m){super(),this.options=c.extend(Object.create(qs),m),c.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=c.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(c.window.document.createTextNode(m))}setHTML(m){const n=c.window.document.createDocumentFragment(),l=c.window.document.createElement("body");let g;for(l.innerHTML=m;g=l.firstChild,g;)n.appendChild(g);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=di("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(m),this.options.closeButton){const l=this._closeButton=di("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let n;return this._classList.delete(m)?n=!1:(this._classList.add(m),n=!0),this._updateClassList(),n}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,g=this._pos;if(!n||!l||!g)return"bottom";const x=l.offsetWidth,E=l.offsetHeight,z=g.x<x/2,k=g.x>n.transform.width-x/2;if(g.y+m<E)return z?"top-left":k?"top-right":"top";if(g.y>n.transform.height-E){if(z)return"bottom-left";if(k)return"bottom-right"}return z?"left":k?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),m.className=n.join(" ")}_update(m){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let g=this._container;if(g||(g=this._container=di("div","mapboxgl-popup",n.getContainer()),this._tip=di("div","mapboxgl-popup-tip",g),g.appendChild(l)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fo(this._lngLat,this._pos,n.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m?m:n.project(this._lngLat),E=ha(this.options.offset),z=this._anchor=this._getAnchor(E.y),k=ha(this.options.offset,z),B=x.add(k).round();n._requestDomTask(()=>{this._container&&z&&(this._container.style.transform=`${Lr[z]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&n._showingGlobe()){const x=c.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(tc);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:$t,Style:$o,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.Point,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:ll,Evented:c.Evented,config:c.config,prewarm:function(){Ae().acquire(Xe)},clearPrewarmedResources:function(){const m=Le;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Xe),Le=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(m){c.config.ACCESS_TOKEN=m},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(m){c.config.API_URL=m},get workerCount(){return Re.workerCount},set workerCount(m){Re.workerCount=m},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){c.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){c.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return Fa});var Gi=rr;return Gi})})($_);var Vg=$_.exports;const iy=W_(Vg);var K_={exports:{}};(function(Ar,gi){(function(Oi,$i){Ar.exports=$i()})(X_,function(){var Oi,$i,ci;function rr(T,Gi){if(!Oi)Oi=Gi;else if(!$i)$i=Gi;else{var c="var sharedChunk = {}; ("+Oi+")(sharedChunk); ("+$i+")(sharedChunk);",st={};Oi(st),ci=Gi(st),ci.workerUrl=window.URL.createObjectURL(new Blob([c],{type:"text/javascript"}))}}return rr(["exports"],function(T){function Gi(t,o){return t(o={exports:{}},o.exports),o.exports}var c=st;function st(t,o,s,f){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=f,this.p2x=s,this.p2y=f}st.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},st.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},st.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},st.prototype.solveCurveX=function(t,o){var s,f,b,S,M;for(o===void 0&&(o=1e-6),b=t,M=0;M<8;M++){if(S=this.sampleCurveX(b)-t,Math.abs(S)<o)return b;var L=this.sampleCurveDerivativeX(b);if(Math.abs(L)<1e-6)break;b-=S/L}if((b=t)<(s=0))return s;if(b>(f=1))return f;for(;s<f;){if(S=this.sampleCurveX(b),Math.abs(S-t)<o)return b;t>S?s=b:f=b,b=.5*(f-s)+s}return b},st.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var Kt=Zi;function Zi(t,o){this.x=t,this.y=o}function Gt(t,o,s,f){var b=new c(t,o,s,f);return function(S){return b.solve(S)}}Zi.prototype={clone:function(){return new Zi(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,s=t.y-this.y;return o*o+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[0]*this.x+t[1]*this.y,s=t[2]*this.x+t[3]*this.y;return this.x=o,this.y=s,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),s=Math.sin(t),f=o*this.x-s*this.y,b=s*this.x+o*this.y;return this.x=f,this.y=b,this},_rotateAround:function(t,o){var s=Math.cos(t),f=Math.sin(t),b=o.x+s*(this.x-o.x)-f*(this.y-o.y),S=o.y+f*(this.x-o.x)+s*(this.y-o.y);return this.x=b,this.y=S,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Zi.convert=function(t){return t instanceof Zi?t:Array.isArray(t)?new Zi(t[0],t[1]):t};var di=Gt(.25,.1,.25,1);function Di(t,o,s){return Math.min(s,Math.max(o,t))}function nr(t,o,s){var f=s-o,b=((t-o)%f+f)%f+o;return b===o?s:b}function tr(t){for(var o=[],s=arguments.length-1;s-- >0;)o[s]=arguments[s+1];for(var f=0,b=o;f<b.length;f+=1){var S=b[f];for(var M in S)t[M]=S[M]}return t}var Xn=1;function Wn(){return Xn++}function co(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function _o(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ao(t,o){t.forEach(function(s){o[s]&&(o[s]=o[s].bind(o))})}function to(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Mo(t,o,s){var f={};for(var b in t)f[b]=o.call(s||this,t[b],b,t);return f}function ra(t,o,s){var f={};for(var b in t)o.call(s||this,t[b],b,t)&&(f[b]=t[b]);return f}function jr(t){return Array.isArray(t)?t.map(jr):typeof t=="object"&&t?Mo(t,jr):t}var Xt={};function En(t){Xt[t]||(typeof console<"u"&&console.warn(t),Xt[t]=!0)}function Wo(t,o,s){return(s.y-t.y)*(o.x-t.x)>(o.y-t.y)*(s.x-t.x)}function Ki(t){for(var o=0,s=0,f=t.length,b=f-1,S=void 0,M=void 0;s<f;b=s++)S=t[s],o+=((M=t[b]).x-S.x)*(S.y+M.y);return o}function en(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function us(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,b,S,M){var L=S||M;return o[b]=!L||L.toLowerCase(),""}),o["max-age"]){var s=parseInt(o["max-age"],10);isNaN(s)?delete o["max-age"]:o["max-age"]=s}return o}var fa=null;function hs(t){if(fa==null){var o=t.navigator?t.navigator.userAgent:null;fa=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return fa}function gl(t){try{var o=self[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}var or,Cs,tn,hn,zs=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),Gn=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,ma=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,_a={now:zs,frame:function(t){var o=Gn(t);return{cancel:function(){return ma(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var s=self.document.createElement("canvas"),f=s.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return s.width=t.width,s.height=t.height,f.drawImage(t,0,0,t.width,t.height),f.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return or||(or=self.document.createElement("a")),or.href=t,or.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio},get prefersReducedMotion(){return!!self.matchMedia&&(Cs==null&&(Cs=self.matchMedia("(prefers-reduced-motion: reduce)")),Cs.matches)}},pn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ga={supported:!1,testSupport:function(t){ps||!hn||(Fn?ya(t):tn=t)}},ps=!1,Fn=!1;function ya(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,hn),t.isContextLost())return;ga.supported=!0}catch{}t.deleteTexture(o),ps=!0}self.document&&((hn=self.document.createElement("img")).onload=function(){tn&&ya(tn),tn=null,Fn=!0},hn.onerror=function(){ps=!0,tn=null},hn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var cr="01",On=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Ui(t){return t.indexOf("mapbox:")===0}On.prototype._createSkuToken=function(){var t=function(){for(var o="",s=0;s<10;s++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",cr,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},On.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},On.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},On.prototype.normalizeStyleURL=function(t,o){if(!Ui(t))return t;var s=Ma(t);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||o)},On.prototype.normalizeGlyphsURL=function(t,o){if(!Ui(t))return t;var s=Ma(t);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||o)},On.prototype.normalizeSourceURL=function(t,o){if(!Ui(t))return t;var s=Ma(t);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||o)},On.prototype.normalizeSpriteURL=function(t,o,s,f){var b=Ma(t);return Ui(t)?(b.path="/styles/v1"+b.path+"/sprite"+o+s,this._makeAPIURL(b,this._customAccessToken||f)):(b.path+=""+o+s,va(b))},On.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ui(t))return t;var s=Ma(t),f=_a.devicePixelRatio>=2||o===512?"@2x":"",b=ga.supported?".webp":"$1";s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,""+f+b),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var S=this._customAccessToken||function(M){for(var L=0,U=M;L<U.length;L+=1){var W=U[L].match(/^access_token=(.*)$/);if(W)return W[1]}return null}(s.params)||pn.ACCESS_TOKEN;return pn.REQUIRE_ACCESS_TOKEN&&S&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,S)},On.prototype.canonicalizeTileURL=function(t,o){var s=Ma(t);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return t;var f="mapbox://tiles/";f+=s.path.replace("/v4/","");var b=s.params;return o&&(b=b.filter(function(S){return!S.match(/^access_token=/)})),b.length&&(f+="?"+b.join("&")),f},On.prototype.canonicalizeTileset=function(t,o){for(var s=!!o&&Ui(o),f=[],b=0,S=t.tiles||[];b<S.length;b+=1){var M=S[b];Hr(M)?f.push(this.canonicalizeTileURL(M,s)):f.push(M)}return f},On.prototype._makeAPIURL=function(t,o){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=Ma(pn.API_URL);if(t.protocol=f.protocol,t.authority=f.authority,f.path!=="/"&&(t.path=""+f.path+t.path),!pn.REQUIRE_ACCESS_TOKEN)return va(t);if(!(o=o||pn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),va(t)};var Ps=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Hr(t){return Ps.test(t)}var vn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ma(t){var o=t.match(vn);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function va(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function ko(t){if(!t)return null;var o,s=t.split(".");if(!s||s.length!==3)return null;try{return JSON.parse((o=s[1],decodeURIComponent(self.atob(o).split("").map(function(f){return"%"+("00"+f.charCodeAt(0).toString(16)).slice(-2)}).join(""))))}catch{return null}}var na=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};na.prototype.getStorageKey=function(t){var o,s=ko(pn.ACCESS_TOKEN),f="";return s&&s.u?(o=s.u,f=self.btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,function(b,S){return String.fromCharCode(+("0x"+S))}))):f=pn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+f:"mapbox.eventData:"+f},na.prototype.fetchEventData=function(){var t=gl("localStorage"),o=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{var f=self.localStorage.getItem(o);f&&(this.eventData=JSON.parse(f));var b=self.localStorage.getItem(s);b&&(this.anonId=b)}catch{En("Unable to read from LocalStorage")}},na.prototype.saveEventData=function(){var t=gl("localStorage"),o=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{self.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&self.localStorage.setItem(o,JSON.stringify(this.eventData))}catch{En("Unable to write to LocalStorage")}},na.prototype.processRequests=function(t){},na.prototype.postEvent=function(t,o,s,f){var b=this;if(pn.EVENTS_URL){var S=Ma(pn.EVENTS_URL);S.params.push("access_token="+(f||pn.ACCESS_TOKEN||""));var M={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.8.0",skuId:cr,userId:this.anonId},L=o?tr(M,o):M,U={url:va(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=tt(U,function(W){b.pendingRequest=null,s(W),b.saveEventData(),b.processRequests(f)})}},na.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Co,Na,xa=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.postMapLoadEvent=function(s,f,b,S){this.skuToken=b,(pn.EVENTS_URL&&S||pn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(M){return Ui(M)||Hr(M)}))&&this.queueRequest({id:f,timestamp:Date.now()},S)},o.prototype.processRequests=function(s){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var b=this.queue.shift(),S=b.id,M=b.timestamp;S&&this.success[S]||(this.anonId||this.fetchEventData(),_o(this.anonId)||(this.anonId=co()),this.postEvent(M,{skuToken:this.skuToken},function(L){L||S&&(f.success[S]=!0)},s))}},o}(na),ks=new(function(t){function o(s){t.call(this,"appUserTurnstile"),this._customAccessToken=s}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.postTurnstileEvent=function(s,f){pn.EVENTS_URL&&pn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(b){return Ui(b)||Hr(b)})&&this.queueRequest(Date.now(),f)},o.prototype.processRequests=function(s){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var b=ko(pn.ACCESS_TOKEN),S=b?b.u:pn.ACCESS_TOKEN,M=S!==this.eventData.tokenU;_o(this.anonId)||(this.anonId=co(),M=!0);var L=this.queue.shift();if(this.eventData.lastSuccess){var U=new Date(this.eventData.lastSuccess),W=new Date(L),K=(L-this.eventData.lastSuccess)/864e5;M=M||K>=1||K<-1||U.getDate()!==W.getDate()}else M=!0;if(!M)return this.processRequests();this.postEvent(L,{"enabled.telemetry":!1},function(ie){ie||(f.eventData.lastSuccess=L,f.eventData.tokenU=S)},s)}},o}(na)),ql=ks.postTurnstileEvent.bind(ks),Gl=new xa,zo=Gl.postMapLoadEvent.bind(Gl),Ca="mapbox-tiles",ds=500,fs=50,Ds=42e4;function ja(){self.caches&&!Co&&(Co=self.caches.open(Ca))}function Ls(t,o,s){if(ja(),Co){var f={status:o.status,statusText:o.statusText,headers:new self.Headers};o.headers.forEach(function(S,M){return f.headers.set(M,S)});var b=us(o.headers.get("Cache-Control")||"");b["no-store"]||(b["max-age"]&&f.headers.set("Expires",new Date(s+1e3*b["max-age"]).toUTCString()),new Date(f.headers.get("Expires")).getTime()-s<Ds||function(S,M){if(Na===void 0)try{new Response(new ReadableStream),Na=!0}catch{Na=!1}Na?M(S.body):S.blob().then(M)}(o,function(S){var M=new self.Response(S,f);ja(),Co&&Co.then(function(L){return L.put(qa(t.url),M)}).catch(function(L){return En(L.message)})}))}}function qa(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}function Do(t,o){if(ja(),!Co)return o(null);var s=qa(t.url);Co.then(function(f){f.match(s).then(function(b){var S=function(M){if(!M)return!1;var L=new Date(M.headers.get("Expires")||0),U=us(M.headers.get("Cache-Control")||"");return L>Date.now()&&!U["no-cache"]}(b);f.delete(s),S&&f.put(s,b.clone()),o(null,b,S)}).catch(o)}).catch(o)}var ms,Rs=1/0;function yl(){return ms==null&&(ms=self.OffscreenCanvas&&new self.OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ms}var Ce={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ce);var te=function(t){function o(s,f,b){f===401&&Hr(b)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,s),this.status=f,this.url=b,this.name=this.constructor.name,this.message=s}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),re=en()?function(){return self.worker&&self.worker.referrer}:function(){return(self.location.protocol==="blob:"?self.parent:self).location.href};function Ie(t,o){var s,f=new self.AbortController,b=new self.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:re(),signal:f.signal}),S=!1,M=!1,L=(s=b.url).indexOf("sku=")>0&&Hr(s);t.type==="json"&&b.headers.set("Accept","application/json");var U=function(K,ie,le){if(!M){if(K&&K.message!=="SecurityError"&&En(K),ie&&le)return W(ie);var ae=Date.now();self.fetch(b).then(function(he){if(he.ok){var Me=L?he.clone():null;return W(he,Me,ae)}return o(new te(he.statusText,he.status,t.url))}).catch(function(he){he.code!==20&&o(new Error(he.message))})}},W=function(K,ie,le){(t.type==="arrayBuffer"?K.arrayBuffer():t.type==="json"?K.json():K.text()).then(function(ae){M||(ie&&le&&Ls(b,ie,le),S=!0,o(null,ae,K.headers.get("Cache-Control"),K.headers.get("Expires")))}).catch(function(ae){M||o(new Error(ae.message))})};return L?Do(b,U):U(null,null),{cancel:function(){M=!0,S||f.abort()}}}var De=function(t,o){if(s=t.url,!(/^file:/.test(s)||/^file:/.test(re())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&self.Request.prototype.hasOwnProperty("signal"))return Ie(t,o);if(en()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var s;return function(f,b){var S=new self.XMLHttpRequest;for(var M in S.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(S.responseType="arraybuffer"),f.headers)S.setRequestHeader(M,f.headers[M]);return f.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=f.credentials==="include",S.onerror=function(){b(new Error(S.statusText))},S.onload=function(){if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){var L=S.response;if(f.type==="json")try{L=JSON.parse(S.response)}catch(U){return b(U)}b(null,L,S.getResponseHeader("Cache-Control"),S.getResponseHeader("Expires"))}else b(new te(S.statusText,S.status,f.url))},S.send(f.body),{cancel:function(){return S.abort()}}}(t,o)},Ze=function(t,o){return De(tr(t,{type:"arrayBuffer"}),o)},tt=function(t,o){return De(tr(t,{method:"POST"}),o)},Qe,Ge,pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Qe=[],Ge=0;var vt=function(t,o){if(ga.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ge>=pn.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return Qe.push(s),s}Ge++;var f=!1,b=function(){if(!f)for(f=!0,Ge--;Qe.length&&Ge<pn.MAX_PARALLEL_IMAGE_REQUESTS;){var M=Qe.shift(),L=M.requestParameters,U=M.callback;M.cancelled||(M.cancel=vt(L,U).cancel)}},S=Ze(t,function(M,L,U,W){b(),M?o(M):L&&(yl()?function(K,ie){var le=new self.Blob([new Uint8Array(K)],{type:"image/png"});self.createImageBitmap(le).then(function(ae){ie(null,ae)}).catch(function(ae){ie(new Error("Could not load image because of "+ae.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(L,o):function(K,ie,le,ae){var he=new self.Image,Me=self.URL;he.onload=function(){ie(null,he),Me.revokeObjectURL(he.src)},he.onerror=function(){return ie(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ke=new self.Blob([new Uint8Array(K)],{type:"image/png"});he.cacheControl=le,he.expires=ae,he.src=K.byteLength?Me.createObjectURL(ke):pt}(L,o,U,W))});return{cancel:function(){S.cancel(),b()}}};function Pt(t,o,s){s[t]&&s[t].indexOf(o)!==-1||(s[t]=s[t]||[],s[t].push(o))}function Et(t,o,s){if(s&&s[t]){var f=s[t].indexOf(o);f!==-1&&s[t].splice(f,1)}}var mi=function(t,o){o===void 0&&(o={}),tr(this,o),this.type=t},Li=function(t){function o(s,f){f===void 0&&(f={}),t.call(this,"error",tr({error:s},f))}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(mi),li=function(){};li.prototype.on=function(t,o){return this._listeners=this._listeners||{},Pt(t,o,this._listeners),this},li.prototype.off=function(t,o){return Et(t,o,this._listeners),Et(t,o,this._oneTimeListeners),this},li.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},Pt(t,o,this._oneTimeListeners),this},li.prototype.fire=function(t,o){typeof t=="string"&&(t=new mi(t,o||{}));var s=t.type;if(this.listens(s)){t.target=this;for(var f=0,b=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];f<b.length;f+=1)b[f].call(this,t);for(var S=0,M=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];S<M.length;S+=1){var L=M[S];Et(s,L,this._oneTimeListeners),L.call(this,t)}var U=this._eventedParent;U&&(tr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),U.fire(t))}else t instanceof Li&&console.error(t.error);return this},li.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},li.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var V={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},X=function(t,o,s,f){this.message=(t?t+": ":"")+s,f&&(this.identifier=f),o!=null&&o.__line__&&(this.line=o.__line__)};function ee(t){var o=t.key,s=t.value;return s?[new X(o,s,"constants have been deprecated as of v8")]:[]}function pe(t){for(var o=[],s=arguments.length-1;s-- >0;)o[s]=arguments[s+1];for(var f=0,b=o;f<b.length;f+=1){var S=b[f];for(var M in S)t[M]=S[M]}return t}function xe(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Be(t){if(Array.isArray(t))return t.map(Be);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var s in t)o[s]=Be(t[s]);return o}return xe(t)}var Xe=function(t){function o(s,f){t.call(this,f),this.message=f,this.key=s}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(Error),Re=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var s=0,f=o;s<f.length;s+=1){var b=f[s],S=b[0],M=b[1];this.bindings[S]=M}};Re.prototype.concat=function(t){return new Re(this,t)},Re.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Re.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Le={kind:"null"},Ae={kind:"number"},ft={kind:"string"},_t={kind:"boolean"},rt={kind:"color"},Wt={kind:"object"},Zt={kind:"value"},yi={kind:"collator"},_i={kind:"formatted"},ri={kind:"resolvedImage"};function Ti(t,o){return{kind:"array",itemType:t,N:o}}function zi(t){if(t.kind==="array"){var o=zi(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var Ji=[Le,Ae,ft,_t,rt,_i,Wt,Ti(Zt),ri];function ir(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!ir(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var s=0,f=Ji;s<f.length;s+=1)if(!ir(f[s],o))return null}}return"Expected "+zi(t)+" but found "+zi(o)+" instead."}var zr=Gi(function(t,o){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(U){return(U=Math.round(U))<0?0:U>255?255:U}function b(U){return U<0?0:U>1?1:U}function S(U){return U[U.length-1]==="%"?f(parseFloat(U)/100*255):f(parseInt(U))}function M(U){return U[U.length-1]==="%"?b(parseFloat(U)/100):b(parseFloat(U))}function L(U,W,K){return K<0?K+=1:K>1&&(K-=1),6*K<1?U+(W-U)*K*6:2*K<1?W:3*K<2?U+(W-U)*(2/3-K)*6:U}try{o.parseCSSColor=function(U){var W,K=U.replace(/ /g,"").toLowerCase();if(K in s)return s[K].slice();if(K[0]==="#")return K.length===4?(W=parseInt(K.substr(1),16))>=0&&W<=4095?[(3840&W)>>4|(3840&W)>>8,240&W|(240&W)>>4,15&W|(15&W)<<4,1]:null:K.length===7&&(W=parseInt(K.substr(1),16))>=0&&W<=16777215?[(16711680&W)>>16,(65280&W)>>8,255&W,1]:null;var ie=K.indexOf("("),le=K.indexOf(")");if(ie!==-1&&le+1===K.length){var ae=K.substr(0,ie),he=K.substr(ie+1,le-(ie+1)).split(","),Me=1;switch(ae){case"rgba":if(he.length!==4)return null;Me=M(he.pop());case"rgb":return he.length!==3?null:[S(he[0]),S(he[1]),S(he[2]),Me];case"hsla":if(he.length!==4)return null;Me=M(he.pop());case"hsl":if(he.length!==3)return null;var ke=(parseFloat(he[0])%360+360)%360/360,Ve=M(he[1]),Ye=M(he[2]),He=Ye<=.5?Ye*(Ve+1):Ye+Ve-Ye*Ve,it=2*Ye-He;return[f(255*L(it,He,ke+1/3)),f(255*L(it,He,ke)),f(255*L(it,He,ke-1/3)),Me];default:return null}}return null}}catch{}}).parseCSSColor,Ei=function(t,o,s,f){f===void 0&&(f=1),this.r=t,this.g=o,this.b=s,this.a=f};Ei.parse=function(t){if(t){if(t instanceof Ei)return t;if(typeof t=="string"){var o=zr(t);if(o)return new Ei(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Ei.prototype.toString=function(){var t=this.toArray(),o=t[0],s=t[1],f=t[2],b=t[3];return"rgba("+Math.round(o)+","+Math.round(s)+","+Math.round(f)+","+b+")"},Ei.prototype.toArray=function(){var t=this.r,o=this.g,s=this.b,f=this.a;return f===0?[0,0,0,0]:[255*t/f,255*o/f,255*s/f,f]},Ei.black=new Ei(0,0,0,1),Ei.white=new Ei(1,1,1,1),Ei.transparent=new Ei(0,0,0,0),Ei.red=new Ei(1,0,0,1);var lt=function(t,o,s){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};lt.prototype.compare=function(t,o){return this.collator.compare(t,o)},lt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var dn=function(t,o,s,f,b){this.text=t,this.image=o,this.scale=s,this.fontStack=f,this.textColor=b},Qi=function(t){this.sections=t};Qi.fromString=function(t){return new Qi([new dn(t,null,null,null,null)])},Qi.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Qi.factory=function(t){return t instanceof Qi?t:Qi.fromString(t)},Qi.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Qi.prototype.serialize=function(){for(var t=["format"],o=0,s=this.sections;o<s.length;o+=1){var f=s[o];if(f.image)t.push(["image",f.image.name]);else{t.push(f.text);var b={};f.fontStack&&(b["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(b["font-scale"]=f.scale),f.textColor&&(b["text-color"]=["rgba"].concat(f.textColor.toArray())),t.push(b)}}return t};var _r=function(t){this.name=t.name,this.available=t.available};function ba(t,o,s,f){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof s=="number"&&s>=0&&s<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[t,o,s,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[t,o,s,f]:[t,o,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function dr(t){if(t===null)return Le;if(typeof t=="string")return ft;if(typeof t=="boolean")return _t;if(typeof t=="number")return Ae;if(t instanceof Ei)return rt;if(t instanceof lt)return yi;if(t instanceof Qi)return _i;if(t instanceof _r)return ri;if(Array.isArray(t)){for(var o,s=t.length,f=0,b=t;f<b.length;f+=1){var S=dr(b[f]);if(o){if(o===S)continue;o=Zt;break}o=S}return Ti(o||Zt,s)}return Wt}function Kr(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Ei||t instanceof Qi||t instanceof _r?t.toString():JSON.stringify(t)}_r.prototype.toString=function(){return this.name},_r.fromString=function(t){return new _r({name:t,available:!1})},_r.prototype.serialize=function(){return["image",this.name]};var Or=function(t,o){this.type=t,this.value=o};Or.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function S(M){if(M===null||typeof M=="string"||typeof M=="boolean"||typeof M=="number"||M instanceof Ei||M instanceof lt||M instanceof Qi||M instanceof _r)return!0;if(Array.isArray(M)){for(var L=0,U=M;L<U.length;L+=1)if(!S(U[L]))return!1;return!0}if(typeof M=="object"){for(var W in M)if(!S(M[W]))return!1;return!0}return!1}(t[1]))return o.error("invalid value");var s=t[1],f=dr(s),b=o.expectedType;return f.kind!=="array"||f.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(f=b),new Or(f,s)},Or.prototype.evaluate=function(){return this.value},Or.prototype.eachChild=function(){},Or.prototype.possibleOutputs=function(){return[this.value]},Or.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ei?["rgba"].concat(this.value.toArray()):this.value instanceof Qi?this.value.serialize():this.value};var Un=function(t){this.name="ExpressionEvaluationError",this.message=t};Un.prototype.toJSON=function(){return this.message};var Rt={string:ft,number:Ae,boolean:_t,object:Wt},Bi=function(t,o){this.type=t,this.args=o};Bi.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var s,f=1,b=t[0];if(b==="array"){var S,M;if(t.length>2){var L=t[1];if(typeof L!="string"||!(L in Rt)||L==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);S=Rt[L],f++}else S=Zt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);M=t[2],f++}s=Ti(S,M)}else s=Rt[b];for(var U=[];f<t.length;f++){var W=o.parse(t[f],f,Zt);if(!W)return null;U.push(W)}return new Bi(s,U)},Bi.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var s=this.args[o].evaluate(t);if(!ir(this.type,dr(s)))return s;if(o===this.args.length-1)throw new Un("Expected value to be of type "+zi(this.type)+", but found "+zi(dr(s))+" instead.")}return null},Bi.prototype.eachChild=function(t){this.args.forEach(t)},Bi.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(o){return o.possibleOutputs()}))},Bi.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){o.push(s.kind);var f=t.N;(typeof f=="number"||this.args.length>1)&&o.push(f)}}return o.concat(this.args.map(function(b){return b.serialize()}))};var qi=function(t){this.type=_i,this.sections=t};qi.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var s=t[1];if(!Array.isArray(s)&&typeof s=="object")return o.error("First argument must be an image or text section.");for(var f=[],b=!1,S=1;S<=t.length-1;++S){var M=t[S];if(b&&typeof M=="object"&&!Array.isArray(M)){b=!1;var L=null;if(M["font-scale"]&&!(L=o.parse(M["font-scale"],1,Ae)))return null;var U=null;if(M["text-font"]&&!(U=o.parse(M["text-font"],1,Ti(ft))))return null;var W=null;if(M["text-color"]&&!(W=o.parse(M["text-color"],1,rt)))return null;var K=f[f.length-1];K.scale=L,K.font=U,K.textColor=W}else{var ie=o.parse(t[S],1,Zt);if(!ie)return null;var le=ie.type.kind;if(le!=="string"&&le!=="value"&&le!=="null"&&le!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,f.push({content:ie,scale:null,font:null,textColor:null})}}return new qi(f)},qi.prototype.evaluate=function(t){return new Qi(this.sections.map(function(o){var s=o.content.evaluate(t);return dr(s)===ri?new dn("",s,null,null,null):new dn(Kr(s),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},qi.prototype.eachChild=function(t){for(var o=0,s=this.sections;o<s.length;o+=1){var f=s[o];t(f.content),f.scale&&t(f.scale),f.font&&t(f.font),f.textColor&&t(f.textColor)}},qi.prototype.possibleOutputs=function(){return[void 0]},qi.prototype.serialize=function(){for(var t=["format"],o=0,s=this.sections;o<s.length;o+=1){var f=s[o];t.push(f.content.serialize());var b={};f.scale&&(b["font-scale"]=f.scale.serialize()),f.font&&(b["text-font"]=f.font.serialize()),f.textColor&&(b["text-color"]=f.textColor.serialize()),t.push(b)}return t};var io=function(t){this.type=ri,this.input=t};io.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var s=o.parse(t[1],1,ft);return s?new io(s):o.error("No image name provided.")},io.prototype.evaluate=function(t){var o=this.input.evaluate(t),s=!1;return t.availableImages&&t.availableImages.indexOf(o)>-1&&(s=!0),new _r({name:o,available:s})},io.prototype.eachChild=function(t){t(this.input)},io.prototype.possibleOutputs=function(){return[void 0]},io.prototype.serialize=function(){return["image",this.input.serialize()]};var _s={"to-boolean":_t,"to-color":rt,"to-number":Ae,"to-string":ft},Xi=function(t,o){this.type=t,this.args=o};Xi.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var f=_s[s],b=[],S=1;S<t.length;S++){var M=o.parse(t[S],S,Zt);if(!M)return null;b.push(M)}return new Xi(f,b)},Xi.prototype.evaluate=function(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){for(var o,s,f=0,b=this.args;f<b.length;f+=1){if(s=null,(o=b[f].evaluate(t))instanceof Ei)return o;if(typeof o=="string"){var S=t.parseColor(o);if(S)return S}else if(Array.isArray(o)&&!(s=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":ba(o[0],o[1],o[2],o[3])))return new Ei(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Un(s||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var M=null,L=0,U=this.args;L<U.length;L+=1){if((M=U[L].evaluate(t))===null)return 0;var W=Number(M);if(!isNaN(W))return W}throw new Un("Could not convert "+JSON.stringify(M)+" to number.")}return this.type.kind==="formatted"?Qi.fromString(Kr(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?_r.fromString(Kr(this.args[0].evaluate(t))):Kr(this.args[0].evaluate(t))},Xi.prototype.eachChild=function(t){this.args.forEach(t)},Xi.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(o){return o.possibleOutputs()}))},Xi.prototype.serialize=function(){if(this.type.kind==="formatted")return new qi([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new io(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var wa=["Unknown","Point","LineString","Polygon"],Ga=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null};Ga.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ga.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?wa[this.feature.type]:this.feature.type:null},Ga.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ga.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Ei.parse(t)),o};var Mr=function(t,o,s,f){this.name=t,this.type=o,this._evaluate=s,this.args=f};Mr.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Mr.prototype.eachChild=function(t){this.args.forEach(t)},Mr.prototype.possibleOutputs=function(){return[void 0]},Mr.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Mr.parse=function(t,o){var s,f=t[0],b=Mr.definitions[f];if(!b)return o.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var S=Array.isArray(b)?b[0]:b.type,M=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,L=M.filter(function(bi){var pi=bi[0];return!Array.isArray(pi)||pi.length===t.length-1}),U=null,W=0,K=L;W<K.length;W+=1){var ie=K[W],le=ie[0],ae=ie[1];U=new Wa(o.registry,o.path,null,o.scope);for(var he=[],Me=!1,ke=1;ke<t.length;ke++){var Ve=t[ke],Ye=Array.isArray(le)?le[ke-1]:le.type,He=U.parse(Ve,1+he.length,Ye);if(!He){Me=!0;break}he.push(He)}if(!Me)if(Array.isArray(le)&&le.length!==he.length)U.error("Expected "+le.length+" arguments, but found "+he.length+" instead.");else{for(var it=0;it<he.length;it++){var bt=Array.isArray(le)?le[it]:le.type,zt=he[it];U.concat(it+1).checkSubtype(bt,zt.type)}if(U.errors.length===0)return new Mr(f,S,ae,he)}}if(L.length===1)(s=o.errors).push.apply(s,U.errors);else{for(var St=(L.length?L:M).map(function(bi){var pi,si=bi[0];return pi=si,Array.isArray(pi)?"("+pi.map(zi).join(", ")+")":"("+zi(pi.type)+"...)"}).join(" | "),Ht=[],vi=1;vi<t.length;vi++){var hi=o.parse(t[vi],1+Ht.length);if(!hi)return null;Ht.push(zi(hi.type))}o.error("Expected arguments of type "+St+", but found ("+Ht.join(", ")+") instead.")}return null},Mr.register=function(t,o){for(var s in Mr.definitions=o,o)t[s]=Mr};var Zn=function(t,o,s){this.type=yi,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=o};function on(t){if(t instanceof Mr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name)))return!1;var o=!0;return t.eachChild(function(s){o&&!on(s)&&(o=!1)}),o}function uc(t){if(t instanceof Mr&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(s){o&&!uc(s)&&(o=!1)}),o}function Za(t,o){if(t instanceof Mr&&o.indexOf(t.name)>=0)return!1;var s=!0;return t.eachChild(function(f){s&&!Za(f,o)&&(s=!1)}),s}Zn.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var s=t[1];if(typeof s!="object"||Array.isArray(s))return o.error("Collator options argument must be an object.");var f=o.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,_t);if(!f)return null;var b=o.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,_t);if(!b)return null;var S=null;return s.locale&&!(S=o.parse(s.locale,1,ft))?null:new Zn(f,b,S)},Zn.prototype.evaluate=function(t){return new lt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Zn.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Zn.prototype.possibleOutputs=function(){return[void 0]},Zn.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Xa=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};Xa.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var s=t[1];return o.scope.has(s)?new Xa(s,o.scope.get(s)):o.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},Xa.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Xa.prototype.eachChild=function(){},Xa.prototype.possibleOutputs=function(){return[void 0]},Xa.prototype.serialize=function(){return["var",this.name]};var Wa=function(t,o,s,f,b){o===void 0&&(o=[]),f===void 0&&(f=new Re),b===void 0&&(b=[]),this.registry=t,this.path=o,this.key=o.map(function(S){return"["+S+"]"}).join(""),this.scope=f,this.errors=b,this.expectedType=s};function hc(t,o){for(var s,f,b=t.length-1,S=0,M=b,L=0;S<=M;)if(s=t[L=Math.floor((S+M)/2)],f=t[L+1],s<=o){if(L===b||o<f)return L;S=L+1}else{if(!(s>o))throw new Un("Input is not a number.");M=L-1}return 0}Wa.prototype.parse=function(t,o,s,f,b){return b===void 0&&(b={}),o?this.concat(o,s,f)._parse(t,b):this._parse(t,b)},Wa.prototype._parse=function(t,o){function s(W,K,ie){return ie==="assert"?new Bi(K,[W]):ie==="coerce"?new Xi(K,[W]):W}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=t[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var b=this.registry[f];if(b){var S=b.parse(t,this);if(!S)return null;if(this.expectedType){var M=this.expectedType,L=S.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||L.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string"){if(this.checkSubtype(M,L))return null}else S=s(S,M,o.typeAnnotation||"coerce");else S=s(S,M,o.typeAnnotation||"assert")}if(!(S instanceof Or)&&S.type.kind!=="resolvedImage"&&function W(K){if(K instanceof Xa)return W(K.boundExpression);if(K instanceof Mr&&K.name==="error"||K instanceof Zn)return!1;var ie=K instanceof Xi||K instanceof Bi,le=!0;return K.eachChild(function(ae){le=ie?le&&W(ae):le&&ae instanceof Or}),le?on(K)&&Za(K,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]):!1}(S)){var U=new Ga;try{S=new Or(S.type,S.evaluate(U))}catch(W){return this.error(W.message),null}}return S}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return t===void 0?this.error("'undefined' value invalid. Use null instead."):typeof t=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},Wa.prototype.concat=function(t,o,s){var f=typeof t=="number"?this.path.concat(t):this.path,b=s?this.scope.concat(s):this.scope;return new Wa(this.registry,f,o||null,b,this.errors)},Wa.prototype.error=function(t){for(var o=[],s=arguments.length-1;s-- >0;)o[s]=arguments[s+1];var f=""+this.key+o.map(function(b){return"["+b+"]"}).join("");this.errors.push(new Xe(f,t))},Wa.prototype.checkSubtype=function(t,o){var s=ir(t,o);return s&&this.error(s),s};var el=function(t,o,s){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var f=0,b=s;f<b.length;f+=1){var S=b[f],M=S[0],L=S[1];this.labels.push(M),this.outputs.push(L)}};function Sn(t,o,s){return t*(1-s)+o*s}el.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var s=o.parse(t[1],1,Ae);if(!s)return null;var f=[],b=null;o.expectedType&&o.expectedType.kind!=="value"&&(b=o.expectedType);for(var S=1;S<t.length;S+=2){var M=S===1?-1/0:t[S],L=t[S+1],U=S,W=S+1;if(typeof M!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(f.length&&f[f.length-1][0]>=M)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);var K=o.parse(L,W,b);if(!K)return null;b=b||K.type,f.push([M,K])}return new el(b,s,f)},el.prototype.evaluate=function(t){var o=this.labels,s=this.outputs;if(o.length===1)return s[0].evaluate(t);var f=this.input.evaluate(t);if(f<=o[0])return s[0].evaluate(t);var b=o.length;return f>=o[b-1]?s[b-1].evaluate(t):s[hc(o,f)].evaluate(t)},el.prototype.eachChild=function(t){t(this.input);for(var o=0,s=this.outputs;o<s.length;o+=1)t(s[o])},el.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(o){return o.possibleOutputs()}))},el.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var gs=Object.freeze({__proto__:null,number:Sn,color:function(t,o,s){return new Ei(Sn(t.r,o.r,s),Sn(t.g,o.g,s),Sn(t.b,o.b,s),Sn(t.a,o.a,s))},array:function(t,o,s){return t.map(function(f,b){return Sn(f,o[b],s)})}}),pc=.95047,Bs=1,oa=1.08883,In=4/29,tl=6/29,vl=3*tl*tl,Lo=tl*tl*tl,aa=Math.PI/180,mh=180/Math.PI;function Zl(t){return t>Lo?Math.pow(t,1/3):t/vl+In}function An(t){return t>tl?t*t*t:vl*(t-In)}function $a(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function xl(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Fs(t){var o=xl(t.r),s=xl(t.g),f=xl(t.b),b=Zl((.4124564*o+.3575761*s+.1804375*f)/pc),S=Zl((.2126729*o+.7151522*s+.072175*f)/Bs);return{l:116*S-16,a:500*(b-S),b:200*(S-Zl((.0193339*o+.119192*s+.9503041*f)/oa)),alpha:t.a}}function Po(t){var o=(t.l+16)/116,s=isNaN(t.a)?o:o+t.a/500,f=isNaN(t.b)?o:o-t.b/200;return o=Bs*An(o),s=pc*An(s),f=oa*An(f),new Ei($a(3.2404542*s-1.5371385*o-.4985314*f),$a(-.969266*s+1.8760108*o+.041556*f),$a(.0556434*s-.2040259*o+1.0572252*f),t.alpha)}function Fu(t,o,s){var f=o-t;return t+s*(f>180||f<-180?f-360*Math.round(f/360):f)}var Xl={forward:Fs,reverse:Po,interpolate:function(t,o,s){return{l:Sn(t.l,o.l,s),a:Sn(t.a,o.a,s),b:Sn(t.b,o.b,s),alpha:Sn(t.alpha,o.alpha,s)}}},za={forward:function(t){var o=Fs(t),s=o.l,f=o.a,b=o.b,S=Math.atan2(b,f)*mh;return{h:S<0?S+360:S,c:Math.sqrt(f*f+b*b),l:s,alpha:t.a}},reverse:function(t){var o=t.h*aa,s=t.c;return Po({l:t.l,a:Math.cos(o)*s,b:Math.sin(o)*s,alpha:t.alpha})},interpolate:function(t,o,s){return{h:Fu(t.h,o.h,s),c:Sn(t.c,o.c,s),l:Sn(t.l,o.l,s),alpha:Sn(t.alpha,o.alpha,s)}}},il=Object.freeze({__proto__:null,lab:Xl,hcl:za}),ro=function(t,o,s,f,b){this.type=t,this.operator=o,this.interpolation=s,this.input=f,this.labels=[],this.outputs=[];for(var S=0,M=b;S<M.length;S+=1){var L=M[S],U=L[0],W=L[1];this.labels.push(U),this.outputs.push(W)}};function Ou(t,o,s,f){var b=f-s,S=t-s;return b===0?0:o===1?S/b:(Math.pow(o,S)-1)/(Math.pow(o,b)-1)}ro.interpolationFactor=function(t,o,s,f){var b=0;if(t.name==="exponential")b=Ou(o,t.base,s,f);else if(t.name==="linear")b=Ou(o,1,s,f);else if(t.name==="cubic-bezier"){var S=t.controlPoints;b=new c(S[0],S[1],S[2],S[3]).solve(Ou(o,1,s,f))}return b},ro.parse=function(t,o){var s=t[0],f=t[1],b=t[2],S=t.slice(3);if(!Array.isArray(f)||f.length===0)return o.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var M=f[1];if(typeof M!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:M}}else{if(f[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(f[0]),1,0);var L=f.slice(1);if(L.length!==4||L.some(function(ke){return typeof ke!="number"||ke<0||ke>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:L}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(b=o.parse(b,2,Ae)))return null;var U=[],W=null;s==="interpolate-hcl"||s==="interpolate-lab"?W=rt:o.expectedType&&o.expectedType.kind!=="value"&&(W=o.expectedType);for(var K=0;K<S.length;K+=2){var ie=S[K],le=S[K+1],ae=K+3,he=K+4;if(typeof ie!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ae);if(U.length&&U[U.length-1][0]>=ie)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ae);var Me=o.parse(le,he,W);if(!Me)return null;W=W||Me.type,U.push([ie,Me])}return W.kind==="number"||W.kind==="color"||W.kind==="array"&&W.itemType.kind==="number"&&typeof W.N=="number"?new ro(W,s,f,b,U):o.error("Type "+zi(W)+" is not interpolatable.")},ro.prototype.evaluate=function(t){var o=this.labels,s=this.outputs;if(o.length===1)return s[0].evaluate(t);var f=this.input.evaluate(t);if(f<=o[0])return s[0].evaluate(t);var b=o.length;if(f>=o[b-1])return s[b-1].evaluate(t);var S=hc(o,f),M=o[S],L=o[S+1],U=ro.interpolationFactor(this.interpolation,f,M,L),W=s[S].evaluate(t),K=s[S+1].evaluate(t);return this.operator==="interpolate"?gs[this.type.kind.toLowerCase()](W,K,U):this.operator==="interpolate-hcl"?za.reverse(za.interpolate(za.forward(W),za.forward(K),U)):Xl.reverse(Xl.interpolate(Xl.forward(W),Xl.forward(K),U))},ro.prototype.eachChild=function(t){t(this.input);for(var o=0,s=this.outputs;o<s.length;o+=1)t(s[o])},ro.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(o){return o.possibleOutputs()}))},ro.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],s=0;s<this.labels.length;s++)o.push(this.labels[s],this.outputs[s].serialize());return o};var Os=function(t,o){this.type=t,this.args=o};Os.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var s=null,f=o.expectedType;f&&f.kind!=="value"&&(s=f);for(var b=[],S=0,M=t.slice(1);S<M.length;S+=1){var L=M[S],U=o.parse(L,1+b.length,s,void 0,{typeAnnotation:"omit"});if(!U)return null;s=s||U.type,b.push(U)}var W=f&&b.some(function(K){return ir(f,K.type)});return new Os(W?Zt:s,b)},Os.prototype.evaluate=function(t){for(var o,s=null,f=0,b=0,S=this.args;b<S.length&&(f++,(s=S[b].evaluate(t))&&s instanceof _r&&!s.available&&(o||(o=s.name),s=null,f===this.args.length&&(s=o)),s===null);b+=1);return s},Os.prototype.eachChild=function(t){this.args.forEach(t)},Os.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(o){return o.possibleOutputs()}))},Os.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Pa=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};Pa.prototype.evaluate=function(t){return this.result.evaluate(t)},Pa.prototype.eachChild=function(t){for(var o=0,s=this.bindings;o<s.length;o+=1)t(s[o][1]);t(this.result)},Pa.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var s=[],f=1;f<t.length-1;f+=2){var b=t[f];if(typeof b!="string")return o.error("Expected string, but found "+typeof b+" instead.",f);if(/[^a-zA-Z0-9_]/.test(b))return o.error("Variable names must contain only alphanumeric characters or '_'.",f);var S=o.parse(t[f+1],f+1);if(!S)return null;s.push([b,S])}var M=o.parse(t[t.length-1],t.length-1,o.expectedType,s);return M?new Pa(s,M):null},Pa.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},Pa.prototype.serialize=function(){for(var t=["let"],o=0,s=this.bindings;o<s.length;o+=1){var f=s[o],b=f[0],S=f[1];t.push(b,S.serialize())}return t.push(this.result.serialize()),t};var $o=function(t,o,s){this.type=t,this.index=o,this.input=s};$o.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=o.parse(t[1],1,Ae),f=o.parse(t[2],2,Ti(o.expectedType||Zt));if(!s||!f)return null;var b=f.type;return new $o(b.itemType,s,f)},$o.prototype.evaluate=function(t){var o=this.index.evaluate(t),s=this.input.evaluate(t);if(o<0)throw new Un("Array index out of bounds: "+o+" < 0.");if(o>=s.length)throw new Un("Array index out of bounds: "+o+" > "+(s.length-1)+".");if(o!==Math.floor(o))throw new Un("Array index must be an integer, but found "+o+" instead.");return s[o]},$o.prototype.eachChild=function(t){t(this.index),t(this.input)},$o.prototype.possibleOutputs=function(){return[void 0]},$o.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var rl=function(t,o){this.type=_t,this.needle=t,this.haystack=o};rl.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s,f=o.parse(t[1],1,Zt),b=o.parse(t[2],2,Zt);return f&&b?(s=f.type).kind!=="boolean"&&s.kind!=="string"&&s.kind!=="number"&&s.kind!=="null"&&s.kind!=="value"?o.error("Expected first argument to be of type boolean, string, number or null, but found "+zi(f.type)+" instead"):new rl(f,b):null},rl.prototype.evaluate=function(t){var o=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!o||!s)return!1;if(!function(f){return typeof f=="boolean"||typeof f=="string"||typeof f=="number"}(o))throw new Un("Expected first argument to be of type boolean, string or number, but found "+zi(dr(o))+" instead.");if(!function(f){return Array.isArray(f)||typeof f=="string"}(s))throw new Un("Expected second argument to be of type array or string, but found "+zi(dr(s))+" instead.");return s.indexOf(o)>=0},rl.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},rl.prototype.possibleOutputs=function(){return[!0,!1]},rl.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ka=function(t,o,s,f,b,S){this.inputType=t,this.type=o,this.input=s,this.cases=f,this.outputs=b,this.otherwise=S};ka.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var s,f;o.expectedType&&o.expectedType.kind!=="value"&&(f=o.expectedType);for(var b={},S=[],M=2;M<t.length-1;M+=2){var L=t[M],U=t[M+1];Array.isArray(L)||(L=[L]);var W=o.concat(M);if(L.length===0)return W.error("Expected at least one branch label.");for(var K=0,ie=L;K<ie.length;K+=1){var le=ie[K];if(typeof le!="number"&&typeof le!="string")return W.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return W.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof le=="number"&&Math.floor(le)!==le)return W.error("Numeric branch labels must be integer values.");if(s){if(W.checkSubtype(s,dr(le)))return null}else s=dr(le);if(b[String(le)]!==void 0)return W.error("Branch labels must be unique.");b[String(le)]=S.length}var ae=o.parse(U,M,f);if(!ae)return null;f=f||ae.type,S.push(ae)}var he=o.parse(t[1],1,Zt);if(!he)return null;var Me=o.parse(t[t.length-1],t.length-1,f);return Me?he.type.kind!=="value"&&o.concat(1).checkSubtype(s,he.type)?null:new ka(s,f,he,b,S,Me):null},ka.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(dr(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ka.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ka.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(o){return o.possibleOutputs()})).concat(this.otherwise.possibleOutputs())},ka.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],s=[],f={},b=0,S=Object.keys(this.cases).sort();b<S.length;b+=1){var M=S[b];(ie=f[this.cases[M]])===void 0?(f[this.cases[M]]=s.length,s.push([this.cases[M],[M]])):s[ie][1].push(M)}for(var L=function(ae){return t.inputType.kind==="number"?Number(ae):ae},U=0,W=s;U<W.length;U+=1){var K=W[U],ie=K[0],le=K[1];le.length===1?o.push(L(le[0])):o.push(le.map(L)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var sa=function(t,o,s){this.type=t,this.branches=o,this.otherwise=s};function dc(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Us(t,o,s,f){return f.compare(o,s)===0}function nl(t,o,s){var f=t!=="=="&&t!=="!=";return function(){function b(S,M,L){this.type=_t,this.lhs=S,this.rhs=M,this.collator=L,this.hasUntypedArgument=S.type.kind==="value"||M.type.kind==="value"}return b.parse=function(S,M){if(S.length!==3&&S.length!==4)return M.error("Expected two or three arguments.");var L=S[0],U=M.parse(S[1],1,Zt);if(!U)return null;if(!dc(L,U.type))return M.concat(1).error('"'+L+`" comparisons are not supported for type '`+zi(U.type)+"'.");var W=M.parse(S[2],2,Zt);if(!W)return null;if(!dc(L,W.type))return M.concat(2).error('"'+L+`" comparisons are not supported for type '`+zi(W.type)+"'.");if(U.type.kind!==W.type.kind&&U.type.kind!=="value"&&W.type.kind!=="value")return M.error("Cannot compare types '"+zi(U.type)+"' and '"+zi(W.type)+"'.");f&&(U.type.kind==="value"&&W.type.kind!=="value"?U=new Bi(W.type,[U]):U.type.kind!=="value"&&W.type.kind==="value"&&(W=new Bi(U.type,[W])));var K=null;if(S.length===4){if(U.type.kind!=="string"&&W.type.kind!=="string"&&U.type.kind!=="value"&&W.type.kind!=="value")return M.error("Cannot use collator to compare non-string types.");if(!(K=M.parse(S[3],3,yi)))return null}return new b(U,W,K)},b.prototype.evaluate=function(S){var M=this.lhs.evaluate(S),L=this.rhs.evaluate(S);if(f&&this.hasUntypedArgument){var U=dr(M),W=dr(L);if(U.kind!==W.kind||U.kind!=="string"&&U.kind!=="number")throw new Un('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+U.kind+", "+W.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var K=dr(M),ie=dr(L);if(K.kind!=="string"||ie.kind!=="string")return o(S,M,L)}return this.collator?s(S,M,L,this.collator.evaluate(S)):o(S,M,L)},b.prototype.eachChild=function(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)},b.prototype.possibleOutputs=function(){return[!0,!1]},b.prototype.serialize=function(){var S=[t];return this.eachChild(function(M){S.push(M.serialize())}),S},b}()}sa.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var s;o.expectedType&&o.expectedType.kind!=="value"&&(s=o.expectedType);for(var f=[],b=1;b<t.length-1;b+=2){var S=o.parse(t[b],b,_t);if(!S)return null;var M=o.parse(t[b+1],b+1,s);if(!M)return null;f.push([S,M]),s=s||M.type}var L=o.parse(t[t.length-1],t.length-1,s);return L?new sa(s,f,L):null},sa.prototype.evaluate=function(t){for(var o=0,s=this.branches;o<s.length;o+=1){var f=s[o],b=f[0],S=f[1];if(b.evaluate(t))return S.evaluate(t)}return this.otherwise.evaluate(t)},sa.prototype.eachChild=function(t){for(var o=0,s=this.branches;o<s.length;o+=1){var f=s[o],b=f[0],S=f[1];t(b),t(S)}t(this.otherwise)},sa.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.branches.map(function(o){return o[0],o[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs())},sa.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var fc=nl("==",function(t,o,s){return o===s},Us),Vc=nl("!=",function(t,o,s){return o!==s},function(t,o,s,f){return!Us(0,o,s,f)}),_h=nl("<",function(t,o,s){return o<s},function(t,o,s,f){return f.compare(o,s)<0}),cu=nl(">",function(t,o,s){return o>s},function(t,o,s,f){return f.compare(o,s)>0}),Uu=nl("<=",function(t,o,s){return o<=s},function(t,o,s,f){return f.compare(o,s)<=0}),Vu=nl(">=",function(t,o,s){return o>=s},function(t,o,s,f){return f.compare(o,s)>=0}),Ha=function(t,o,s,f,b){this.type=ft,this.number=t,this.locale=o,this.currency=s,this.minFractionDigits=f,this.maxFractionDigits=b};Ha.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var s=o.parse(t[1],1,Ae);if(!s)return null;var f=t[2];if(typeof f!="object"||Array.isArray(f))return o.error("NumberFormat options argument must be an object.");var b=null;if(f.locale&&!(b=o.parse(f.locale,1,ft)))return null;var S=null;if(f.currency&&!(S=o.parse(f.currency,1,ft)))return null;var M=null;if(f["min-fraction-digits"]&&!(M=o.parse(f["min-fraction-digits"],1,Ae)))return null;var L=null;return f["max-fraction-digits"]&&!(L=o.parse(f["max-fraction-digits"],1,Ae))?null:new Ha(s,b,S,M,L)},Ha.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Ha.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Ha.prototype.possibleOutputs=function(){return[void 0]},Ha.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var wr=function(t){this.type=Ae,this.input=t};wr.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var s=o.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+zi(s.type)+" instead."):new wr(s):null},wr.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Un("Expected value to be of type string or array, but found "+zi(dr(o))+" instead.")},wr.prototype.eachChild=function(t){t(this.input)},wr.prototype.possibleOutputs=function(){return[void 0]},wr.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var mc={"==":fc,"!=":Vc,">":cu,"<":_h,">=":Vu,"<=":Uu,array:Bi,at:$o,boolean:Bi,case:sa,coalesce:Os,collator:Zn,format:qi,image:io,in:rl,interpolate:ro,"interpolate-hcl":ro,"interpolate-lab":ro,length:wr,let:Pa,literal:Or,match:ka,number:Bi,"number-format":Ha,object:Bi,step:el,string:Bi,"to-boolean":Xi,"to-color":Xi,"to-number":Xi,"to-string":Xi,var:Xa};function an(t,o){var s=o[0],f=o[1],b=o[2],S=o[3];s=s.evaluate(t),f=f.evaluate(t),b=b.evaluate(t);var M=S?S.evaluate(t):1,L=ba(s,f,b,M);if(L)throw new Un(L);return new Ei(s/255*M,f/255*M,b/255*M,M)}function Nu(t,o){return t in o}function bl(t,o){var s=o[t];return s===void 0?null:s}function ol(t){return{type:t}}function _c(t){return{result:"success",value:t}}function Ka(t){return{result:"error",value:t}}function al(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function wl(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ya(t){return!!t.expression&&t.expression.interpolated}function Pr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Wl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function gh(t){return t}function Vs(t,o,s){return t!==void 0?t:o!==void 0?o:s!==void 0?s:void 0}function ju(t,o,s,f,b){return Vs(typeof s===b?f[s]:void 0,t.default,o.default)}function Nc(t,o,s){if(Pr(s)!=="number")return Vs(t.default,o.default);var f=t.stops.length;if(f===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[f-1][0])return t.stops[f-1][1];var b=hc(t.stops.map(function(S){return S[0]}),s);return t.stops[b][1]}function gc(t,o,s){var f=t.base!==void 0?t.base:1;if(Pr(s)!=="number")return Vs(t.default,o.default);var b=t.stops.length;if(b===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[b-1][0])return t.stops[b-1][1];var S=hc(t.stops.map(function(ie){return ie[0]}),s),M=function(ie,le,ae,he){var Me=he-ae,ke=ie-ae;return Me===0?0:le===1?ke/Me:(Math.pow(le,ke)-1)/(Math.pow(le,Me)-1)}(s,f,t.stops[S][0],t.stops[S+1][0]),L=t.stops[S][1],U=t.stops[S+1][1],W=gs[o.type]||gh;if(t.colorSpace&&t.colorSpace!=="rgb"){var K=il[t.colorSpace];W=function(ie,le){return K.reverse(K.interpolate(K.forward(ie),K.forward(le),M))}}return typeof L.evaluate=="function"?{evaluate:function(){for(var ie=[],le=arguments.length;le--;)ie[le]=arguments[le];var ae=L.evaluate.apply(void 0,ie),he=U.evaluate.apply(void 0,ie);if(ae!==void 0&&he!==void 0)return W(ae,he,M)}}:W(L,U,M)}function uu(t,o,s){return o.type==="color"?s=Ei.parse(s):o.type==="formatted"?s=Qi.fromString(s.toString()):o.type==="resolvedImage"?s=_r.fromString(s.toString()):Pr(s)===o.type||o.type==="enum"&&o.values[s]||(s=void 0),Vs(s,t.default,o.default)}Mr.register(mc,{error:[{kind:"error"},[ft],function(t,o){var s=o[0];throw new Un(s.evaluate(t))}],typeof:[ft,[Zt],function(t,o){return zi(dr(o[0].evaluate(t)))}],"to-rgba":[Ti(Ae,4),[rt],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[rt,[Ae,Ae,Ae],an],rgba:[rt,[Ae,Ae,Ae,Ae],an],has:{type:_t,overloads:[[[ft],function(t,o){return Nu(o[0].evaluate(t),t.properties())}],[[ft,Wt],function(t,o){var s=o[0],f=o[1];return Nu(s.evaluate(t),f.evaluate(t))}]]},get:{type:Zt,overloads:[[[ft],function(t,o){return bl(o[0].evaluate(t),t.properties())}],[[ft,Wt],function(t,o){var s=o[0],f=o[1];return bl(s.evaluate(t),f.evaluate(t))}]]},"feature-state":[Zt,[ft],function(t,o){return bl(o[0].evaluate(t),t.featureState||{})}],properties:[Wt,[],function(t){return t.properties()}],"geometry-type":[ft,[],function(t){return t.geometryType()}],id:[Zt,[],function(t){return t.id()}],zoom:[Ae,[],function(t){return t.globals.zoom}],"heatmap-density":[Ae,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ae,[],function(t){return t.globals.lineProgress||0}],accumulated:[Zt,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Ae,ol(Ae),function(t,o){for(var s=0,f=0,b=o;f<b.length;f+=1)s+=b[f].evaluate(t);return s}],"*":[Ae,ol(Ae),function(t,o){for(var s=1,f=0,b=o;f<b.length;f+=1)s*=b[f].evaluate(t);return s}],"-":{type:Ae,overloads:[[[Ae,Ae],function(t,o){var s=o[0],f=o[1];return s.evaluate(t)-f.evaluate(t)}],[[Ae],function(t,o){return-o[0].evaluate(t)}]]},"/":[Ae,[Ae,Ae],function(t,o){var s=o[0],f=o[1];return s.evaluate(t)/f.evaluate(t)}],"%":[Ae,[Ae,Ae],function(t,o){var s=o[0],f=o[1];return s.evaluate(t)%f.evaluate(t)}],ln2:[Ae,[],function(){return Math.LN2}],pi:[Ae,[],function(){return Math.PI}],e:[Ae,[],function(){return Math.E}],"^":[Ae,[Ae,Ae],function(t,o){var s=o[0],f=o[1];return Math.pow(s.evaluate(t),f.evaluate(t))}],sqrt:[Ae,[Ae],function(t,o){var s=o[0];return Math.sqrt(s.evaluate(t))}],log10:[Ae,[Ae],function(t,o){var s=o[0];return Math.log(s.evaluate(t))/Math.LN10}],ln:[Ae,[Ae],function(t,o){var s=o[0];return Math.log(s.evaluate(t))}],log2:[Ae,[Ae],function(t,o){var s=o[0];return Math.log(s.evaluate(t))/Math.LN2}],sin:[Ae,[Ae],function(t,o){var s=o[0];return Math.sin(s.evaluate(t))}],cos:[Ae,[Ae],function(t,o){var s=o[0];return Math.cos(s.evaluate(t))}],tan:[Ae,[Ae],function(t,o){var s=o[0];return Math.tan(s.evaluate(t))}],asin:[Ae,[Ae],function(t,o){var s=o[0];return Math.asin(s.evaluate(t))}],acos:[Ae,[Ae],function(t,o){var s=o[0];return Math.acos(s.evaluate(t))}],atan:[Ae,[Ae],function(t,o){var s=o[0];return Math.atan(s.evaluate(t))}],min:[Ae,ol(Ae),function(t,o){return Math.min.apply(Math,o.map(function(s){return s.evaluate(t)}))}],max:[Ae,ol(Ae),function(t,o){return Math.max.apply(Math,o.map(function(s){return s.evaluate(t)}))}],abs:[Ae,[Ae],function(t,o){var s=o[0];return Math.abs(s.evaluate(t))}],round:[Ae,[Ae],function(t,o){var s=o[0].evaluate(t);return s<0?-Math.round(-s):Math.round(s)}],floor:[Ae,[Ae],function(t,o){var s=o[0];return Math.floor(s.evaluate(t))}],ceil:[Ae,[Ae],function(t,o){var s=o[0];return Math.ceil(s.evaluate(t))}],"filter-==":[_t,[ft,Zt],function(t,o){var s=o[0],f=o[1];return t.properties()[s.value]===f.value}],"filter-id-==":[_t,[Zt],function(t,o){var s=o[0];return t.id()===s.value}],"filter-type-==":[_t,[ft],function(t,o){var s=o[0];return t.geometryType()===s.value}],"filter-<":[_t,[ft,Zt],function(t,o){var s=o[0],f=o[1],b=t.properties()[s.value],S=f.value;return typeof b==typeof S&&b<S}],"filter-id-<":[_t,[Zt],function(t,o){var s=o[0],f=t.id(),b=s.value;return typeof f==typeof b&&f<b}],"filter->":[_t,[ft,Zt],function(t,o){var s=o[0],f=o[1],b=t.properties()[s.value],S=f.value;return typeof b==typeof S&&b>S}],"filter-id->":[_t,[Zt],function(t,o){var s=o[0],f=t.id(),b=s.value;return typeof f==typeof b&&f>b}],"filter-<=":[_t,[ft,Zt],function(t,o){var s=o[0],f=o[1],b=t.properties()[s.value],S=f.value;return typeof b==typeof S&&b<=S}],"filter-id-<=":[_t,[Zt],function(t,o){var s=o[0],f=t.id(),b=s.value;return typeof f==typeof b&&f<=b}],"filter->=":[_t,[ft,Zt],function(t,o){var s=o[0],f=o[1],b=t.properties()[s.value],S=f.value;return typeof b==typeof S&&b>=S}],"filter-id->=":[_t,[Zt],function(t,o){var s=o[0],f=t.id(),b=s.value;return typeof f==typeof b&&f>=b}],"filter-has":[_t,[Zt],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[_t,[],function(t){return t.id()!==null}],"filter-type-in":[_t,[Ti(ft)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[_t,[Ti(Zt)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[_t,[ft,Ti(Zt)],function(t,o){var s=o[0];return o[1].value.indexOf(t.properties()[s.value])>=0}],"filter-in-large":[_t,[ft,Ti(Zt)],function(t,o){var s=o[0],f=o[1];return function(b,S,M,L){for(;M<=L;){var U=M+L>>1;if(S[U]===b)return!0;S[U]>b?L=U-1:M=U+1}return!1}(t.properties()[s.value],f.value,0,f.value.length-1)}],all:{type:_t,overloads:[[[_t,_t],function(t,o){var s=o[0],f=o[1];return s.evaluate(t)&&f.evaluate(t)}],[ol(_t),function(t,o){for(var s=0,f=o;s<f.length;s+=1)if(!f[s].evaluate(t))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],function(t,o){var s=o[0],f=o[1];return s.evaluate(t)||f.evaluate(t)}],[ol(_t),function(t,o){for(var s=0,f=o;s<f.length;s+=1)if(f[s].evaluate(t))return!0;return!1}]]},"!":[_t,[_t],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[_t,[ft],function(t,o){var s=o[0],f=t.globals&&t.globals.isSupportedScript;return!f||f(s.evaluate(t))}],upcase:[ft,[ft],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[ft,[ft],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[ft,ol(Zt),function(t,o){return o.map(function(s){return Kr(s.evaluate(t))}).join("")}],"resolved-locale":[ft,[yi],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var $l=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new Ga,this._defaultValue=o?function(s){return s.type==="color"&&Wl(s.default)?new Ei(0,0,0,0):s.type==="color"?Ei.parse(s.default)||null:s.default===void 0?null:s.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function Tr(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in mc}function Tl(t,o){var s=new Wa(mc,[],o?function(b){var S={color:rt,string:ft,number:Ae,enum:ft,boolean:_t,formatted:_i,resolvedImage:ri};return b.type==="array"?Ti(S[b.value]||Zt,b.length):S[b.type]}(o):void 0),f=s.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?_c(new $l(f,o)):Ka(s.errors)}$l.prototype.evaluateWithoutErrorHandling=function(t,o,s,f,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=s,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},$l.prototype.evaluate=function(t,o,s,f,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=s||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Un("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}};var yc=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!uc(o.expression)};yc.prototype.evaluateWithoutErrorHandling=function(t,o,s,f,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,s,f,b)},yc.prototype.evaluate=function(t,o,s,f,b){return this._styleExpression.evaluate(t,o,s,f,b)};var Ns=function(t,o,s,f){this.kind=t,this.zoomStops=s,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!uc(o.expression),this.interpolationType=f};function qu(t,o){if((t=Tl(t,o)).result==="error")return t;var s=t.value.expression,f=on(s);if(!f&&!al(o))return Ka([new Xe("","data expressions not supported")]);var b=Za(s,["zoom"]);if(!b&&!wl(o))return Ka([new Xe("","zoom expressions not supported")]);var S=function L(U){var W=null;if(U instanceof Pa)W=L(U.result);else if(U instanceof Os)for(var K=0,ie=U.args;K<ie.length;K+=1){var le=ie[K];if(W=L(le))break}else(U instanceof el||U instanceof ro)&&U.input instanceof Mr&&U.input.name==="zoom"&&(W=U);return W instanceof Xe||U.eachChild(function(ae){var he=L(ae);he instanceof Xe?W=he:!W&&he?W=new Xe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):W&&he&&W!==he&&(W=new Xe("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),W}(s);if(!S&&!b)return Ka([new Xe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(S instanceof Xe)return Ka([S]);if(S instanceof ro&&!Ya(o))return Ka([new Xe("",'"interpolate" expressions cannot be used with this property')]);if(!S)return _c(new yc(f?"constant":"source",t.value));var M=S instanceof ro?S.interpolation:void 0;return _c(new Ns(f?"camera":"composite",t.value,S.labels,M))}Ns.prototype.evaluateWithoutErrorHandling=function(t,o,s,f,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,s,f,b)},Ns.prototype.evaluate=function(t,o,s,f,b){return this._styleExpression.evaluate(t,o,s,f,b)},Ns.prototype.interpolationFactor=function(t,o,s){return this.interpolationType?ro.interpolationFactor(this.interpolationType,t,o,s):0};var ys=function(t,o){this._parameters=t,this._specification=o,pe(this,function s(f,b){var S,M,L,U=b.type==="color",W=f.stops&&typeof f.stops[0][0]=="object",K=W||f.property!==void 0,ie=W||!K,le=f.type||(Ya(b)?"exponential":"interval");if(U&&((f=pe({},f)).stops&&(f.stops=f.stops.map(function(bi){return[bi[0],Ei.parse(bi[1])]})),f.default?f.default=Ei.parse(f.default):f.default=Ei.parse(b.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!il[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(le==="exponential")S=gc;else if(le==="interval")S=Nc;else if(le==="categorical"){S=ju,M=Object.create(null);for(var ae=0,he=f.stops;ae<he.length;ae+=1){var Me=he[ae];M[Me[0]]=Me[1]}L=typeof f.stops[0][0]}else{if(le!=="identity")throw new Error('Unknown function type "'+le+'"');S=uu}if(W){for(var ke={},Ve=[],Ye=0;Ye<f.stops.length;Ye++){var He=f.stops[Ye],it=He[0].zoom;ke[it]===void 0&&(ke[it]={zoom:it,type:f.type,property:f.property,default:f.default,stops:[]},Ve.push(it)),ke[it].stops.push([He[0].value,He[1]])}for(var bt=[],zt=0,St=Ve;zt<St.length;zt+=1){var Ht=St[zt];bt.push([ke[Ht].zoom,s(ke[Ht],b)])}var vi={name:"linear"};return{kind:"composite",interpolationType:vi,interpolationFactor:ro.interpolationFactor.bind(void 0,vi),zoomStops:bt.map(function(bi){return bi[0]}),evaluate:function(bi,pi){var si=bi.zoom;return gc({stops:bt,base:f.base},b,si).evaluate(si,pi)}}}if(ie){var hi=le==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:hi,interpolationFactor:ro.interpolationFactor.bind(void 0,hi),zoomStops:f.stops.map(function(bi){return bi[0]}),evaluate:function(bi){var pi=bi.zoom;return S(f,b,pi,M,L)}}}return{kind:"source",evaluate:function(bi,pi){var si=pi&&pi.properties?pi.properties[f.property]:void 0;return si===void 0?Vs(f.default,b.default):S(f,b,si,M,L)}}}(this._parameters,this._specification))};function Da(t){var o=t.key,s=t.value,f=t.valueSpec||{},b=t.objectElementValidators||{},S=t.style,M=t.styleSpec,L=[],U=Pr(s);if(U!=="object")return[new X(o,s,"object expected, "+U+" found")];for(var W in s){var K=W.split(".")[0],ie=f[K]||f["*"],le=void 0;if(b[K])le=b[K];else if(f[K])le=la;else if(b["*"])le=b["*"];else{if(!f["*"]){L.push(new X(o,s[W],'unknown property "'+W+'"'));continue}le=la}L=L.concat(le({key:(o&&o+".")+W,value:s[W],valueSpec:ie,style:S,styleSpec:M,object:s,objectKey:W},s))}for(var ae in f)b[ae]||f[ae].required&&f[ae].default===void 0&&s[ae]===void 0&&L.push(new X(o,s,'missing required property "'+ae+'"'));return L}function Gu(t){var o=t.value,s=t.valueSpec,f=t.style,b=t.styleSpec,S=t.key,M=t.arrayElementValidator||la;if(Pr(o)!=="array")return[new X(S,o,"array expected, "+Pr(o)+" found")];if(s.length&&o.length!==s.length)return[new X(S,o,"array length "+s.length+" expected, length "+o.length+" found")];if(s["min-length"]&&o.length<s["min-length"])return[new X(S,o,"array length at least "+s["min-length"]+" expected, length "+o.length+" found")];var L={type:s.value,values:s.values};b.$version<7&&(L.function=s.function),Pr(s.value)==="object"&&(L=s.value);for(var U=[],W=0;W<o.length;W++)U=U.concat(M({array:o,arrayIndex:W,value:o[W],valueSpec:L,style:f,styleSpec:b,key:S+"["+W+"]"}));return U}function Zu(t){var o=t.key,s=t.value,f=t.valueSpec,b=Pr(s);return b==="number"&&s!=s&&(b="NaN"),b!=="number"?[new X(o,s,"number expected, "+b+" found")]:"minimum"in f&&s<f.minimum?[new X(o,s,s+" is less than the minimum value "+f.minimum)]:"maximum"in f&&s>f.maximum?[new X(o,s,s+" is greater than the maximum value "+f.maximum)]:[]}function yh(t){var o,s,f,b=t.valueSpec,S=xe(t.value.type),M={},L=S!=="categorical"&&t.value.property===void 0,U=!L,W=Pr(t.value.stops)==="array"&&Pr(t.value.stops[0])==="array"&&Pr(t.value.stops[0][0])==="object",K=Da({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ae){if(S==="identity")return[new X(ae.key,ae.value,'identity function may not have a "stops" property')];var he=[],Me=ae.value;return he=he.concat(Gu({key:ae.key,value:Me,valueSpec:ae.valueSpec,style:ae.style,styleSpec:ae.styleSpec,arrayElementValidator:ie})),Pr(Me)==="array"&&Me.length===0&&he.push(new X(ae.key,Me,"array must have at least one stop")),he},default:function(ae){return la({key:ae.key,value:ae.value,valueSpec:b,style:ae.style,styleSpec:ae.styleSpec})}}});return S==="identity"&&L&&K.push(new X(t.key,t.value,'missing required property "property"')),S==="identity"||t.value.stops||K.push(new X(t.key,t.value,'missing required property "stops"')),S==="exponential"&&t.valueSpec.expression&&!Ya(t.valueSpec)&&K.push(new X(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(U&&!al(t.valueSpec)?K.push(new X(t.key,t.value,"property functions not supported")):L&&!wl(t.valueSpec)&&K.push(new X(t.key,t.value,"zoom functions not supported"))),S!=="categorical"&&!W||t.value.property!==void 0||K.push(new X(t.key,t.value,'"property" property is required')),K;function ie(ae){var he=[],Me=ae.value,ke=ae.key;if(Pr(Me)!=="array")return[new X(ke,Me,"array expected, "+Pr(Me)+" found")];if(Me.length!==2)return[new X(ke,Me,"array length 2 expected, length "+Me.length+" found")];if(W){if(Pr(Me[0])!=="object")return[new X(ke,Me,"object expected, "+Pr(Me[0])+" found")];if(Me[0].zoom===void 0)return[new X(ke,Me,"object stop key must have zoom")];if(Me[0].value===void 0)return[new X(ke,Me,"object stop key must have value")];if(f&&f>xe(Me[0].zoom))return[new X(ke,Me[0].zoom,"stop zoom values must appear in ascending order")];xe(Me[0].zoom)!==f&&(f=xe(Me[0].zoom),s=void 0,M={}),he=he.concat(Da({key:ke+"[0]",value:Me[0],valueSpec:{zoom:{}},style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{zoom:Zu,value:le}}))}else he=he.concat(le({key:ke+"[0]",value:Me[0],valueSpec:{},style:ae.style,styleSpec:ae.styleSpec},Me));return Tr(Be(Me[1]))?he.concat([new X(ke+"[1]",Me[1],"expressions are not allowed in function stops.")]):he.concat(la({key:ke+"[1]",value:Me[1],valueSpec:b,style:ae.style,styleSpec:ae.styleSpec}))}function le(ae,he){var Me=Pr(ae.value),ke=xe(ae.value),Ve=ae.value!==null?ae.value:he;if(o){if(Me!==o)return[new X(ae.key,Ve,Me+" stop domain type must match previous stop domain type "+o)]}else o=Me;if(Me!=="number"&&Me!=="string"&&Me!=="boolean")return[new X(ae.key,Ve,"stop domain value must be a number, string, or boolean")];if(Me!=="number"&&S!=="categorical"){var Ye="number expected, "+Me+" found";return al(b)&&S===void 0&&(Ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new X(ae.key,Ve,Ye)]}return S!=="categorical"||Me!=="number"||isFinite(ke)&&Math.floor(ke)===ke?S!=="categorical"&&Me==="number"&&s!==void 0&&ke<s?[new X(ae.key,Ve,"stop domain values must appear in ascending order")]:(s=ke,S==="categorical"&&ke in M?[new X(ae.key,Ve,"stop domain values must be unique")]:(M[ke]=!0,[])):[new X(ae.key,Ve,"integer expected, found "+ke)]}}function El(t){var o=(t.expressionContext==="property"?qu:Tl)(Be(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(f){return new X(""+t.key+f.key,t.value,f.message)});var s=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&s.possibleOutputs().indexOf(void 0)!==-1)return[new X(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!uc(s))return[new X(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!uc(s))return[new X(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Za(s,["zoom","feature-state"]))return[new X(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!on(s))return[new X(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hl(t){var o=t.key,s=t.value,f=t.valueSpec,b=[];return Array.isArray(f.values)?f.values.indexOf(xe(s))===-1&&b.push(new X(o,s,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(f.values).indexOf(xe(s))===-1&&b.push(new X(o,s,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(s)+" found")),b}function vc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&Array.isArray(t[2]);case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,s=t.slice(1);o<s.length;o+=1){var f=s[o];if(!vc(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}ys.deserialize=function(t){return new ys(t._parameters,t._specification)},ys.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var hu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function jc(t){if(t==null)return function(){return!0};vc(t)||(t=pu(t));var o=Tl(t,hu);if(o.result==="error")throw new Error(o.value.map(function(s){return s.key+": "+s.message}).join(", "));return function(s,f){return o.value.evaluate(s,f)}}function vh(t,o){return t<o?-1:t>o?1:0}function pu(t){if(!t)return!0;var o,s=t[0];return t.length<=1?s!=="any":s==="=="?Sl(t[1],t[2],"=="):s==="!="?Al(Sl(t[1],t[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Sl(t[1],t[2],s):s==="any"?(o=t.slice(1),["any"].concat(o.map(pu))):s==="all"?["all"].concat(t.slice(1).map(pu)):s==="none"?["all"].concat(t.slice(1).map(pu).map(Al)):s==="in"?Il(t[1],t.slice(2)):s==="!in"?Al(Il(t[1],t.slice(2))):s==="has"?du(t[1]):s!=="!has"||Al(du(t[1]))}function Sl(t,o,s){switch(t){case"$type":return["filter-type-"+s,o];case"$id":return["filter-id-"+s,o];default:return["filter-"+s,t,o]}}function Il(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(s){return typeof s!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(vh)]]:["filter-in-small",t,["literal",o]]}}function du(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Al(t){return["!",t]}function qc(t){return vc(Be(t.value))?El(pe({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(s){var f=s.value,b=s.key;if(Pr(f)!=="array")return[new X(b,f,"array expected, "+Pr(f)+" found")];var S=s.styleSpec,M,L=[];if(f.length<1)return[new X(b,f,"filter array must have at least 1 element")];switch(L=L.concat(Hl({key:b+"[0]",value:f[0],valueSpec:S.filter_operator,style:s.style,styleSpec:s.styleSpec})),xe(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&xe(f[1])==="$type"&&L.push(new X(b,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&L.push(new X(b,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(M=Pr(f[1]))!=="string"&&L.push(new X(b+"[1]",f[1],"string expected, "+M+" found"));for(var U=2;U<f.length;U++)M=Pr(f[U]),xe(f[1])==="$type"?L=L.concat(Hl({key:b+"["+U+"]",value:f[U],valueSpec:S.geometry_type,style:s.style,styleSpec:s.styleSpec})):M!=="string"&&M!=="number"&&M!=="boolean"&&L.push(new X(b+"["+U+"]",f[U],"string, number, or boolean expected, "+M+" found"));break;case"any":case"all":case"none":for(var W=1;W<f.length;W++)L=L.concat(o({key:b+"["+W+"]",value:f[W],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":M=Pr(f[1]),f.length!==2?L.push(new X(b,f,'filter array for "'+f[0]+'" operator must have 2 elements')):M!=="string"&&L.push(new X(b+"[1]",f[1],"string expected, "+M+" found"))}return L}(t)}function vs(t,o){var s=t.key,f=t.style,b=t.styleSpec,S=t.value,M=t.objectKey,L=b[o+"_"+t.layerType];if(!L)return[];var U=M.match(/^(.*)-transition$/);if(o==="paint"&&U&&L[U[1]]&&L[U[1]].transition)return la({key:s,value:S,valueSpec:b.transition,style:f,styleSpec:b});var W,K=t.valueSpec||L[M];if(!K)return[new X(s,S,'unknown property "'+M+'"')];if(Pr(S)==="string"&&al(K)&&!K.tokens&&(W=/^{([^}]+)}$/.exec(S)))return[new X(s,S,'"'+M+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(W[1])+" }`.")];var ie=[];return t.layerType==="symbol"&&(M==="text-field"&&f&&!f.glyphs&&ie.push(new X(s,S,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&Wl(Be(S))&&xe(S.type)==="identity"&&ie.push(new X(s,S,'"text-font" does not support identity functions'))),ie.concat(la({key:t.key,value:S,valueSpec:K,style:f,styleSpec:b,expressionContext:"property",propertyType:o,propertyKey:M}))}function xc(t){return vs(t,"paint")}function Gc(t){return vs(t,"layout")}function bc(t){var o=[],s=t.value,f=t.key,b=t.style,S=t.styleSpec;s.type||s.ref||o.push(new X(f,s,'either "type" or "ref" is required'));var M,L=xe(s.type),U=xe(s.ref);if(s.id)for(var W=xe(s.id),K=0;K<t.arrayIndex;K++){var ie=b.layers[K];xe(ie.id)===W&&o.push(new X(f,s.id,'duplicate layer id "'+s.id+'", previously used at line '+ie.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(he){he in s&&o.push(new X(f,s[he],'"'+he+'" is prohibited for ref layers'))}),b.layers.forEach(function(he){xe(he.id)===U&&(M=he)}),M?M.ref?o.push(new X(f,s.ref,"ref cannot reference another ref layer")):L=xe(M.type):o.push(new X(f,s.ref,'ref layer "'+U+'" not found'));else if(L!=="background")if(s.source){var le=b.sources&&b.sources[s.source],ae=le&&xe(le.type);le?ae==="vector"&&L==="raster"?o.push(new X(f,s.source,'layer "'+s.id+'" requires a raster source')):ae==="raster"&&L!=="raster"?o.push(new X(f,s.source,'layer "'+s.id+'" requires a vector source')):ae!=="vector"||s["source-layer"]?ae==="raster-dem"&&L!=="hillshade"?o.push(new X(f,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="line"||!s.paint||!s.paint["line-gradient"]||ae==="geojson"&&le.lineMetrics||o.push(new X(f,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new X(f,s,'layer "'+s.id+'" must specify a "source-layer"')):o.push(new X(f,s.source,'source "'+s.source+'" not found'))}else o.push(new X(f,s,'missing required property "source"'));return o=o.concat(Da({key:f,value:s,valueSpec:S.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return la({key:f+".type",value:s.type,valueSpec:S.layer.type,style:t.style,styleSpec:t.styleSpec,object:s,objectKey:"type"})},filter:qc,layout:function(he){return Da({layer:s,key:he.key,value:he.value,style:he.style,styleSpec:he.styleSpec,objectElementValidators:{"*":function(Me){return Gc(pe({layerType:L},Me))}}})},paint:function(he){return Da({layer:s,key:he.key,value:he.value,style:he.style,styleSpec:he.styleSpec,objectElementValidators:{"*":function(Me){return xc(pe({layerType:L},Me))}}})}}}))}function sl(t){var o=t.value,s=t.key,f=Pr(o);return f!=="string"?[new X(s,o,"string expected, "+f+" found")]:[]}var fu={promoteId:function(t){var o=t.key,s=t.value;if(Pr(s)==="string")return sl({key:o,value:s});var f=[];for(var b in s)f.push.apply(f,sl({key:o+"."+b,value:s[b]}));return f}};function xh(t){var o=t.value,s=t.key,f=t.styleSpec,b=t.style;if(!o.type)return[new X(s,o,'"type" is required')];var S,M=xe(o.type);switch(M){case"vector":case"raster":case"raster-dem":return S=Da({key:s,value:o,valueSpec:f["source_"+M.replace("-","_")],style:t.style,styleSpec:f,objectElementValidators:fu});case"geojson":if(S=Da({key:s,value:o,valueSpec:f.source_geojson,style:b,styleSpec:f,objectElementValidators:fu}),o.cluster)for(var L in o.clusterProperties){var U=o.clusterProperties[L],W=U[0],K=U[1],ie=typeof W=="string"?[W,["accumulated"],["get",L]]:W;S.push.apply(S,El({key:s+"."+L+".map",value:K,expressionContext:"cluster-map"})),S.push.apply(S,El({key:s+"."+L+".reduce",value:ie,expressionContext:"cluster-reduce"}))}return S;case"video":return Da({key:s,value:o,valueSpec:f.source_video,style:b,styleSpec:f});case"image":return Da({key:s,value:o,valueSpec:f.source_image,style:b,styleSpec:f});case"canvas":return[new X(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hl({key:s+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,styleSpec:f})}}function mu(t){var o=t.value,s=t.styleSpec,f=s.light,b=t.style,S=[],M=Pr(o);if(o===void 0)return S;if(M!=="object")return S=S.concat([new X("light",o,"object expected, "+M+" found")]);for(var L in o){var U=L.match(/^(.*)-transition$/);S=U&&f[U[1]]&&f[U[1]].transition?S.concat(la({key:L,value:o[L],valueSpec:s.transition,style:b,styleSpec:s})):f[L]?S.concat(la({key:L,value:o[L],valueSpec:f[L],style:b,styleSpec:s})):S.concat([new X(L,o[L],'unknown property "'+L+'"')])}return S}var Zc={"*":function(){return[]},array:Gu,boolean:function(t){var o=t.value,s=t.key,f=Pr(o);return f!=="boolean"?[new X(s,o,"boolean expected, "+f+" found")]:[]},number:Zu,color:function(t){var o=t.key,s=t.value,f=Pr(s);return f!=="string"?[new X(o,s,"color expected, "+f+" found")]:zr(s)===null?[new X(o,s,'color expected, "'+s+'" found')]:[]},constants:ee,enum:Hl,filter:qc,function:yh,layer:bc,object:Da,source:xh,light:mu,string:sl,formatted:function(t){return sl(t).length===0?[]:El(t)},resolvedImage:function(t){return sl(t).length===0?[]:El(t)}};function la(t){var o=t.value,s=t.valueSpec,f=t.styleSpec;return s.expression&&Wl(xe(o))?yh(t):s.expression&&Tr(Be(o))?El(t):s.type&&Zc[s.type]?Zc[s.type](t):Da(pe({},t,{valueSpec:s.type?f[s.type]:s}))}function Xu(t){var o=t.value,s=t.key,f=sl(t);return f.length||(o.indexOf("{fontstack}")===-1&&f.push(new X(s,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&f.push(new X(s,o,'"glyphs" url must include a "{range}" token'))),f}function Ur(t,o){o===void 0&&(o=V);var s=[];return s=s.concat(la({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Xu,"*":function(){return[]}}})),t.constants&&(s=s.concat(ee({key:"constants",value:t.constants,style:t,styleSpec:o}))),_u(s)}function _u(t){return[].concat(t).sort(function(o,s){return o.line-s.line})}function La(t){return function(){for(var o=[],s=arguments.length;s--;)o[s]=arguments[s];return _u(t.apply(this,o))}}Ur.source=La(xh),Ur.light=La(mu),Ur.layer=La(bc),Ur.filter=La(qc),Ur.paintProperty=La(xc),Ur.layoutProperty=La(Gc);var kr=Ur,rn=kr.light,Ml=kr.paintProperty,ca=kr.layoutProperty;function wc(t,o){var s=!1;if(o&&o.length)for(var f=0,b=o;f<b.length;f+=1){var S=b[f];t.fire(new Li(new Error(S.message))),s=!0}return s}var xs=ho,uo=3;function ho(t,o,s){var f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var b=new Int32Array(this.arrayBuffer);t=b[0],o=b[1],s=b[2],this.d=o+2*s;for(var S=0;S<this.d*this.d;S++){var M=b[uo+S],L=b[uo+S+1];f.push(M===L?null:b.subarray(M,L))}var U=b[uo+f.length],W=b[uo+f.length+1];this.keys=b.subarray(U,W),this.bboxes=b.subarray(W),this.insert=this._insertReadonly}else{this.d=o+2*s;for(var K=0;K<this.d*this.d;K++)f.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=s,this.scale=o/t,this.uid=0;var ie=s/o*t;this.min=-ie,this.max=t+ie}ho.prototype.insert=function(t,o,s,f,b){this._forEachCell(o,s,f,b,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(f),this.bboxes.push(b)},ho.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ho.prototype._insertCell=function(t,o,s,f,b,S){this.cells[b].push(S)},ho.prototype.query=function(t,o,s,f,b){var S=this.min,M=this.max;if(t<=S&&o<=S&&M<=s&&M<=f&&!b)return Array.prototype.slice.call(this.keys);var L=[];return this._forEachCell(t,o,s,f,this._queryCell,L,{},b),L},ho.prototype._queryCell=function(t,o,s,f,b,S,M,L){var U=this.cells[b];if(U!==null)for(var W=this.keys,K=this.bboxes,ie=0;ie<U.length;ie++){var le=U[ie];if(M[le]===void 0){var ae=4*le;(L?L(K[ae+0],K[ae+1],K[ae+2],K[ae+3]):t<=K[ae+2]&&o<=K[ae+3]&&s>=K[ae+0]&&f>=K[ae+1])?(M[le]=!0,S.push(W[le])):M[le]=!1}}},ho.prototype._forEachCell=function(t,o,s,f,b,S,M,L){for(var U=this._convertToCellCoord(t),W=this._convertToCellCoord(o),K=this._convertToCellCoord(s),ie=this._convertToCellCoord(f),le=U;le<=K;le++)for(var ae=W;ae<=ie;ae++){var he=this.d*ae+le;if((!L||L(this._convertFromCellCoord(le),this._convertFromCellCoord(ae),this._convertFromCellCoord(le+1),this._convertFromCellCoord(ae+1)))&&b.call(this,t,o,s,f,he,S,M,L))return}},ho.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ho.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ho.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=uo+this.cells.length+1+1,s=0,f=0;f<this.cells.length;f++)s+=this.cells[f].length;var b=new Int32Array(o+s+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var S=o,M=0;M<t.length;M++){var L=t[M];b[uo+M]=S,b.set(L,S),S+=L.length}return b[uo+t.length]=S,b.set(this.keys,S),S+=this.keys.length,b[uo+t.length+1]=S,b.set(this.bboxes,S),S+=this.bboxes.length,b.buffer};var bh=self.ImageData,Ro=self.ImageBitmap,Tc={};function Jt(t,o,s){s===void 0&&(s={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),Tc[t]={klass:o,omit:s.omit||[],shallow:s.shallow||[]}}for(var js in Jt("Object",Object),xs.serialize=function(t,o){var s=t.toArrayBuffer();return o&&o.push(s),{buffer:s}},xs.deserialize=function(t){return new xs(t.buffer)},Jt("Grid",xs),Jt("Color",Ei),Jt("Error",Error),Jt("ResolvedImage",_r),Jt("StylePropertyFunction",ys),Jt("StyleExpression",$l,{omit:["_evaluator"]}),Jt("ZoomDependentExpression",Ns),Jt("ZoomConstantExpression",yc),Jt("CompoundExpression",Mr,{omit:["_evaluate"]}),mc)mc[js]._classRegistryKey||Jt("Expression_"+js,mc[js]);function Kl(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Ja(t){return Ro&&t instanceof Ro}function Ec(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Kl(t)||Ja(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var s=t;return o&&o.push(s.buffer),s}if(t instanceof bh)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var f=[],b=0,S=t;b<S.length;b+=1){var M=S[b];f.push(Ec(M,o))}return f}if(typeof t=="object"){var L=t.constructor,U=L._classRegistryKey;if(!U)throw new Error("can't serialize object of unregistered class");var W=L.serialize?L.serialize(t,o):{};if(!L.serialize){for(var K in t)if(t.hasOwnProperty(K)&&!(Tc[U].omit.indexOf(K)>=0)){var ie=t[K];W[K]=Tc[U].shallow.indexOf(K)>=0?ie:Ec(ie,o)}t instanceof Error&&(W.message=t.message)}if(W.$name)throw new Error("$name property is reserved for worker serialization logic.");return U!=="Object"&&(W.$name=U),W}throw new Error("can't serialize object of type "+typeof t)}function Mn(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Kl(t)||Ja(t)||ArrayBuffer.isView(t)||t instanceof bh)return t;if(Array.isArray(t))return t.map(Mn);if(typeof t=="object"){var o=t.$name||"Object",s=Tc[o].klass;if(!s)throw new Error("can't deserialize unregistered class "+o);if(s.deserialize)return s.deserialize(t);for(var f=Object.create(s.prototype),b=0,S=Object.keys(t);b<S.length;b+=1){var M=S[b];if(M!=="$name"){var L=t[M];f[M]=Tc[o].shallow.indexOf(M)>=0?L:Mn(L)}}return f}throw new Error("can't deserialize object of type "+typeof t)}var Yl=function(){this.first=!0};Yl.prototype.update=function(t,o){var s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))};var Yt={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function ua(t){for(var o=0,s=t;o<s.length;o+=1)if(Ra(s[o].charCodeAt(0)))return!0;return!1}function Cl(t){return!Yt.Arabic(t)&&!Yt["Arabic Supplement"](t)&&!Yt["Arabic Extended-A"](t)&&!Yt["Arabic Presentation Forms-A"](t)&&!Yt["Arabic Presentation Forms-B"](t)}function Ra(t){return t===746||t===747||!(t<4352)&&(!!Yt["Bopomofo Extended"](t)||!!Yt.Bopomofo(t)||!(!Yt["CJK Compatibility Forms"](t)||t>=65097&&t<=65103)||!!Yt["CJK Compatibility Ideographs"](t)||!!Yt["CJK Compatibility"](t)||!!Yt["CJK Radicals Supplement"](t)||!!Yt["CJK Strokes"](t)||!(!Yt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||!!Yt["CJK Unified Ideographs Extension A"](t)||!!Yt["CJK Unified Ideographs"](t)||!!Yt["Enclosed CJK Letters and Months"](t)||!!Yt["Hangul Compatibility Jamo"](t)||!!Yt["Hangul Jamo Extended-A"](t)||!!Yt["Hangul Jamo Extended-B"](t)||!!Yt["Hangul Jamo"](t)||!!Yt["Hangul Syllables"](t)||!!Yt.Hiragana(t)||!!Yt["Ideographic Description Characters"](t)||!!Yt.Kanbun(t)||!!Yt["Kangxi Radicals"](t)||!!Yt["Katakana Phonetic Extensions"](t)||!(!Yt.Katakana(t)||t===12540)||!(!Yt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Yt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||!!Yt["Unified Canadian Aboriginal Syllabics"](t)||!!Yt["Unified Canadian Aboriginal Syllabics Extended"](t)||!!Yt["Vertical Forms"](t)||!!Yt["Yijing Hexagram Symbols"](t)||!!Yt["Yi Syllables"](t)||!!Yt["Yi Radicals"](t))}function Jl(t){return!(Ra(t)||function(o){return!(!Yt["Latin-1 Supplement"](o)||o!==167&&o!==169&&o!==174&&o!==177&&o!==188&&o!==189&&o!==190&&o!==215&&o!==247)||!(!Yt["General Punctuation"](o)||o!==8214&&o!==8224&&o!==8225&&o!==8240&&o!==8241&&o!==8251&&o!==8252&&o!==8258&&o!==8263&&o!==8264&&o!==8265&&o!==8273)||!!Yt["Letterlike Symbols"](o)||!!Yt["Number Forms"](o)||!(!Yt["Miscellaneous Technical"](o)||!(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215))||!(!Yt["Control Pictures"](o)||o===9251)||!!Yt["Optical Character Recognition"](o)||!!Yt["Enclosed Alphanumerics"](o)||!!Yt["Geometric Shapes"](o)||!(!Yt["Miscellaneous Symbols"](o)||o>=9754&&o<=9759)||!(!Yt["Miscellaneous Symbols and Arrows"](o)||!(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243))||!!Yt["CJK Symbols and Punctuation"](o)||!!Yt.Katakana(o)||!!Yt["Private Use Area"](o)||!!Yt["CJK Compatibility Forms"](o)||!!Yt["Small Form Variants"](o)||!!Yt["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533}(t))}function Ql(t){return t>=1424&&t<=2303||Yt["Arabic Presentation Forms-A"](t)||Yt["Arabic Presentation Forms-B"](t)}function gu(t,o){return!(!o&&Ql(t))&&!(t>=2304&&t<=3583||t>=3840&&t<=4255||Yt.Khmer(t))}function vr(t){for(var o=0,s=t;o<s.length;o+=1)if(Ql(s[o].charCodeAt(0)))return!0;return!1}var Ta="deferred",ll="loading",Sc="loaded",zl=null,Ho="unavailable",bs=null,Ko=function(t){zl&&zl(t)};function Xc(){Pl.fire(new mi("pluginStateChange",{pluginStatus:Ho,pluginURL:bs}))}var Pl=new li,cl=function(){return Ho},Qa=function(){if(Ho!==Ta||!bs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ho=ll,Xc(),bs&&Ze({url:bs},function(t){t?Ko(t):(Ho=Sc,Xc())})},Bo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ho===Sc||Bo.applyArabicShaping!=null},isLoading:function(){return Ho===ll},setState:function(t){Ho=t.pluginStatus,bs=t.pluginURL},isParsed:function(){return Bo.applyArabicShaping!=null&&Bo.processBidirectionalText!=null&&Bo.processStyledBidirectionalText!=null},getPluginURL:function(){return bs}},qr=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yl,this.transition={})};qr.prototype.isSupportedScript=function(t){return function(o,s){for(var f=0,b=o;f<b.length;f+=1)if(!gu(b[f].charCodeAt(0),s))return!1;return!0}(t,Bo.isLoaded())},qr.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},qr.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*o}};var es=function(t,o){this.property=t,this.value=o,this.expression=function(s,f){if(Wl(s))return new ys(s,f);if(Tr(s)){var b=qu(s,f);if(b.result==="error")throw new Error(b.value.map(function(M){return M.key+": "+M.message}).join(", "));return b.value}var S=s;return typeof s=="string"&&f.type==="color"&&(S=Ei.parse(s)),{kind:"constant",evaluate:function(){return S}}}(o===void 0?t.specification.default:o,t.specification)};es.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},es.prototype.possiblyEvaluate=function(t,o){return this.property.possiblyEvaluate(this,t,o)};var ts=function(t){this.property=t,this.value=new es(t,void 0)};ts.prototype.transitioned=function(t,o){return new ti(this.property,this.value,o,tr({},t.transition,this.transition),t.now)},ts.prototype.untransitioned=function(){return new ti(this.property,this.value,null,{},0)};var is=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};is.prototype.getValue=function(t){return jr(this._values[t].value.value)},is.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ts(this._values[t].property)),this._values[t].value=new es(this._values[t].property,o===null?void 0:jr(o))},is.prototype.getTransition=function(t){return jr(this._values[t].transition)},is.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ts(this._values[t].property)),this._values[t].transition=jr(o)||void 0},is.prototype.serialize=function(){for(var t={},o=0,s=Object.keys(this._values);o<s.length;o+=1){var f=s[o],b=this.getValue(f);b!==void 0&&(t[f]=b);var S=this.getTransition(f);S!==void 0&&(t[f+"-transition"]=S)}return t},is.prototype.transitioned=function(t,o){for(var s=new go(this._properties),f=0,b=Object.keys(this._values);f<b.length;f+=1){var S=b[f];s._values[S]=this._values[S].transitioned(t,o._values[S])}return s},is.prototype.untransitioned=function(){for(var t=new go(this._properties),o=0,s=Object.keys(this._values);o<s.length;o+=1){var f=s[o];t._values[f]=this._values[f].untransitioned()}return t};var ti=function(t,o,s,f,b){this.property=t,this.value=o,this.begin=b+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=s)};ti.prototype.possiblyEvaluate=function(t,o){var s=t.now||0,f=this.value.possiblyEvaluate(t,o),b=this.prior;if(b){if(s>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(s<this.begin)return b.possiblyEvaluate(t,o);var S=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o),f,function(M){if(M<=0)return 0;if(M>=1)return 1;var L=M*M,U=L*M;return 4*(M<.5?U:3*(M-L)+U-.75)}(S))}return f};var go=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};go.prototype.possiblyEvaluate=function(t,o){for(var s=new Yo(this._properties),f=0,b=Object.keys(this._values);f<b.length;f+=1){var S=b[f];s._values[S]=this._values[S].possiblyEvaluate(t,o)}return s},go.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1){var s=o[t];if(this._values[s].prior)return!0}return!1};var ec=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};ec.prototype.getValue=function(t){return jr(this._values[t].value)},ec.prototype.setValue=function(t,o){this._values[t]=new es(this._values[t].property,o===null?void 0:jr(o))},ec.prototype.serialize=function(){for(var t={},o=0,s=Object.keys(this._values);o<s.length;o+=1){var f=s[o],b=this.getValue(f);b!==void 0&&(t[f]=b)}return t},ec.prototype.possiblyEvaluate=function(t,o){for(var s=new Yo(this._properties),f=0,b=Object.keys(this._values);f<b.length;f+=1){var S=b[f];s._values[S]=this._values[S].possiblyEvaluate(t,o)}return s};var $n=function(t,o,s){this.property=t,this.value=o,this.parameters=s};$n.prototype.isConstant=function(){return this.value.kind==="constant"},$n.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},$n.prototype.evaluate=function(t,o,s){return this.property.evaluate(this.value,this.parameters,t,o,s)};var Yo=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Yo.prototype.get=function(t){return this._values[t]};var ai=function(t){this.specification=t};ai.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},ai.prototype.interpolate=function(t,o,s){var f=gs[this.specification.type];return f?f(t,o,s):t};var Mi=function(t,o){this.specification=t,this.overrides=o};Mi.prototype.possiblyEvaluate=function(t,o,s){return t.expression.kind==="constant"||t.expression.kind==="camera"?new $n(this,{kind:"constant",value:t.expression.evaluate(o,null,{},s)},o):new $n(this,t.expression,o)},Mi.prototype.interpolate=function(t,o,s){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new $n(this,{kind:"constant",value:void 0},t.parameters);var f=gs[this.specification.type];return f?new $n(this,{kind:"constant",value:f(t.value.value,o.value.value,s)},t.parameters):t},Mi.prototype.evaluate=function(t,o,s,f,b){return t.kind==="constant"?t.value:t.evaluate(o,s,f,b)};var kl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.possiblyEvaluate=function(s,f,b){if(s.value===void 0)return new $n(this,{kind:"constant",value:void 0},f);if(s.expression.kind==="constant"){var S=s.expression.evaluate(f,null,{},b),M=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,L=this._calculate(M,M,M,f);return new $n(this,{kind:"constant",value:L},f)}if(s.expression.kind==="camera"){var U=this._calculate(s.expression.evaluate({zoom:f.zoom-1}),s.expression.evaluate({zoom:f.zoom}),s.expression.evaluate({zoom:f.zoom+1}),f);return new $n(this,{kind:"constant",value:U},f)}return new $n(this,s.expression,f)},o.prototype.evaluate=function(s,f,b,S,M){if(s.kind==="source"){var L=s.evaluate(f,b,S,M);return this._calculate(L,L,L,f)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(f.zoom)-1},b,S),s.evaluate({zoom:Math.floor(f.zoom)},b,S),s.evaluate({zoom:Math.floor(f.zoom)+1},b,S),f):s.value},o.prototype._calculate=function(s,f,b,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:s,to:f}:{from:b,to:f}},o.prototype.interpolate=function(s){return s},o}(Mi),h=function(t){this.specification=t};h.prototype.possiblyEvaluate=function(t,o,s){if(t.value!==void 0){if(t.expression.kind==="constant"){var f=t.expression.evaluate(o,null,{},s);return this._calculate(f,f,f,o)}return this._calculate(t.expression.evaluate(new qr(Math.floor(o.zoom-1),o)),t.expression.evaluate(new qr(Math.floor(o.zoom),o)),t.expression.evaluate(new qr(Math.floor(o.zoom+1),o)),o)}},h.prototype._calculate=function(t,o,s,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:s,to:o}},h.prototype.interpolate=function(t){return t};var d=function(t){this.specification=t};d.prototype.possiblyEvaluate=function(t,o,s){return!!t.expression.evaluate(o,null,{},s)},d.prototype.interpolate=function(){return!1};var p=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var s=t[o];s.specification.overridable&&this.overridableProperties.push(o);var f=this.defaultPropertyValues[o]=new es(s,void 0),b=this.defaultTransitionablePropertyValues[o]=new ts(s);this.defaultTransitioningPropertyValues[o]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=f.possiblyEvaluate({})}};Jt("DataDrivenProperty",Mi),Jt("DataConstantProperty",ai),Jt("CrossFadedDataDrivenProperty",kl),Jt("CrossFadedProperty",h),Jt("ColorRampProperty",d);var y=function(t){function o(s,f){if(t.call(this),this.id=s.id,this.type=s.type,this._featureFilter=function(){return!0},s.type!=="custom"&&(s=s,this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),f.layout&&(this._unevaluatedLayout=new ec(f.layout)),f.paint)){for(var b in this._transitionablePaint=new is(f.paint),s.paint)this.setPaintProperty(b,s.paint[b],{validate:!1});for(var S in s.layout)this.setLayoutProperty(S,s.layout[S],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},o.prototype.setLayoutProperty=function(s,f,b){if(b===void 0&&(b={}),f!=null){var S="layers."+this.id+".layout."+s;if(this._validate(ca,S,s,f,b))return}s!=="visibility"?this._unevaluatedLayout.setValue(s,f):this.visibility=f},o.prototype.getPaintProperty=function(s){return to(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)},o.prototype.setPaintProperty=function(s,f,b){if(b===void 0&&(b={}),f!=null){var S="layers."+this.id+".paint."+s;if(this._validate(Ml,S,s,f,b))return!1}if(to(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-11),f||void 0),!1;var M=this._transitionablePaint._values[s],L=M.property.specification["property-type"]==="cross-faded-data-driven",U=M.value.isDataDriven(),W=M.value;this._transitionablePaint.setValue(s,f),this._handleSpecialPaintPropertyUpdate(s);var K=this._transitionablePaint._values[s].value;return K.isDataDriven()||U||L||this._handleOverridablePaintPropertyUpdate(s,W,K)},o.prototype._handleSpecialPaintPropertyUpdate=function(s){},o.prototype._handleOverridablePaintPropertyUpdate=function(s,f,b){return!1},o.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(s,f){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,f)),this.paint=this._transitioningPaint.possiblyEvaluate(s,f)},o.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),ra(s,function(f,b){return!(f===void 0||b==="layout"&&!Object.keys(f).length||b==="paint"&&!Object.keys(f).length)})},o.prototype._validate=function(s,f,b,S,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&wc(this,s.call(kr,{key:f,layerType:this.type,objectKey:b,value:S,styleSpec:V,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var s in this.paint._values){var f=this.paint.get(s);if(f instanceof $n&&al(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},o}(li),I={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},P=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},D=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function O(t,o){o===void 0&&(o=1);var s=0,f=0;return{members:t.map(function(b){var S,M=(S=b.type,I[S].BYTES_PER_ELEMENT),L=s=G(s,Math.max(o,M)),U=b.components||1;return f=Math.max(f,M),s+=M*U,{name:b.name,type:b.type,components:U,offset:L}}),size:G(s,Math.max(f,o)),alignment:o}}function G(t,o){return Math.ceil(t/o)*o}D.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},D.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},D.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},D.prototype.clear=function(){this.length=0},D.prototype.resize=function(t){this.reserve(t),this.length=t},D.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},D.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Q=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f){var b=this.length;return this.resize(b+1),this.emplace(b,s,f)},o.prototype.emplace=function(s,f,b){var S=2*s;return this.int16[S+0]=f,this.int16[S+1]=b,s},o}(D);Q.prototype.bytesPerElement=4,Jt("StructArrayLayout2i4",Q);var oe=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S){var M=this.length;return this.resize(M+1),this.emplace(M,s,f,b,S)},o.prototype.emplace=function(s,f,b,S,M){var L=4*s;return this.int16[L+0]=f,this.int16[L+1]=b,this.int16[L+2]=S,this.int16[L+3]=M,s},o}(D);oe.prototype.bytesPerElement=8,Jt("StructArrayLayout4i8",oe);var _e=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S,M,L){var U=this.length;return this.resize(U+1),this.emplace(U,s,f,b,S,M,L)},o.prototype.emplace=function(s,f,b,S,M,L,U){var W=6*s;return this.int16[W+0]=f,this.int16[W+1]=b,this.int16[W+2]=S,this.int16[W+3]=M,this.int16[W+4]=L,this.int16[W+5]=U,s},o}(D);_e.prototype.bytesPerElement=12,Jt("StructArrayLayout2i4i12",_e);var Se=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S,M,L){var U=this.length;return this.resize(U+1),this.emplace(U,s,f,b,S,M,L)},o.prototype.emplace=function(s,f,b,S,M,L,U){var W=4*s,K=8*s;return this.int16[W+0]=f,this.int16[W+1]=b,this.uint8[K+4]=S,this.uint8[K+5]=M,this.uint8[K+6]=L,this.uint8[K+7]=U,s},o}(D);Se.prototype.bytesPerElement=8,Jt("StructArrayLayout2i4ub8",Se);var Te=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S,M,L,U,W){var K=this.length;return this.resize(K+1),this.emplace(K,s,f,b,S,M,L,U,W)},o.prototype.emplace=function(s,f,b,S,M,L,U,W,K){var ie=8*s;return this.uint16[ie+0]=f,this.uint16[ie+1]=b,this.uint16[ie+2]=S,this.uint16[ie+3]=M,this.uint16[ie+4]=L,this.uint16[ie+5]=U,this.uint16[ie+6]=W,this.uint16[ie+7]=K,s},o}(D);Te.prototype.bytesPerElement=16,Jt("StructArrayLayout8ui16",Te);var ge=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S,M,L,U,W,K,ie,le,ae){var he=this.length;return this.resize(he+1),this.emplace(he,s,f,b,S,M,L,U,W,K,ie,le,ae)},o.prototype.emplace=function(s,f,b,S,M,L,U,W,K,ie,le,ae,he){var Me=12*s;return this.int16[Me+0]=f,this.int16[Me+1]=b,this.int16[Me+2]=S,this.int16[Me+3]=M,this.uint16[Me+4]=L,this.uint16[Me+5]=U,this.uint16[Me+6]=W,this.uint16[Me+7]=K,this.int16[Me+8]=ie,this.int16[Me+9]=le,this.int16[Me+10]=ae,this.int16[Me+11]=he,s},o}(D);ge.prototype.bytesPerElement=24,Jt("StructArrayLayout4i4ui4i24",ge);var be=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b){var S=this.length;return this.resize(S+1),this.emplace(S,s,f,b)},o.prototype.emplace=function(s,f,b,S){var M=3*s;return this.float32[M+0]=f,this.float32[M+1]=b,this.float32[M+2]=S,s},o}(D);be.prototype.bytesPerElement=12,Jt("StructArrayLayout3f12",be);var We=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s){var f=this.length;return this.resize(f+1),this.emplace(f,s)},o.prototype.emplace=function(s,f){var b=1*s;return this.uint32[b+0]=f,s},o}(D);We.prototype.bytesPerElement=4,Jt("StructArrayLayout1ul4",We);var Ne=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S,M,L,U,W,K,ie,le){var ae=this.length;return this.resize(ae+1),this.emplace(ae,s,f,b,S,M,L,U,W,K,ie,le)},o.prototype.emplace=function(s,f,b,S,M,L,U,W,K,ie,le,ae){var he=12*s,Me=6*s;return this.int16[he+0]=f,this.int16[he+1]=b,this.int16[he+2]=S,this.int16[he+3]=M,this.int16[he+4]=L,this.int16[he+5]=U,this.uint32[Me+3]=W,this.uint16[he+8]=K,this.uint16[he+9]=ie,this.int16[he+10]=le,this.int16[he+11]=ae,s},o}(D);Ne.prototype.bytesPerElement=24,Jt("StructArrayLayout6i1ul2ui2i24",Ne);var et=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S,M,L){var U=this.length;return this.resize(U+1),this.emplace(U,s,f,b,S,M,L)},o.prototype.emplace=function(s,f,b,S,M,L,U){var W=6*s;return this.int16[W+0]=f,this.int16[W+1]=b,this.int16[W+2]=S,this.int16[W+3]=M,this.int16[W+4]=L,this.int16[W+5]=U,s},o}(D);et.prototype.bytesPerElement=12,Jt("StructArrayLayout2i2i2i12",et);var Je=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S){var M=this.length;return this.resize(M+1),this.emplace(M,s,f,b,S)},o.prototype.emplace=function(s,f,b,S,M){var L=12*s,U=3*s;return this.uint8[L+0]=f,this.uint8[L+1]=b,this.float32[U+1]=S,this.float32[U+2]=M,s},o}(D);Je.prototype.bytesPerElement=12,Jt("StructArrayLayout2ub2f12",Je);var ot=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S,M,L,U,W,K,ie,le,ae,he,Me,ke,Ve,Ye){var He=this.length;return this.resize(He+1),this.emplace(He,s,f,b,S,M,L,U,W,K,ie,le,ae,he,Me,ke,Ve,Ye)},o.prototype.emplace=function(s,f,b,S,M,L,U,W,K,ie,le,ae,he,Me,ke,Ve,Ye,He){var it=24*s,bt=12*s,zt=48*s;return this.int16[it+0]=f,this.int16[it+1]=b,this.uint16[it+2]=S,this.uint16[it+3]=M,this.uint32[bt+2]=L,this.uint32[bt+3]=U,this.uint32[bt+4]=W,this.uint16[it+10]=K,this.uint16[it+11]=ie,this.uint16[it+12]=le,this.float32[bt+7]=ae,this.float32[bt+8]=he,this.uint8[zt+36]=Me,this.uint8[zt+37]=ke,this.uint8[zt+38]=Ve,this.uint32[bt+10]=Ye,this.int16[it+22]=He,s},o}(D);ot.prototype.bytesPerElement=48,Jt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ot);var gt=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S,M,L,U,W,K,ie,le,ae,he,Me,ke,Ve,Ye,He,it,bt,zt,St,Ht,vi,hi,bi){var pi=this.length;return this.resize(pi+1),this.emplace(pi,s,f,b,S,M,L,U,W,K,ie,le,ae,he,Me,ke,Ve,Ye,He,it,bt,zt,St,Ht,vi,hi,bi)},o.prototype.emplace=function(s,f,b,S,M,L,U,W,K,ie,le,ae,he,Me,ke,Ve,Ye,He,it,bt,zt,St,Ht,vi,hi,bi,pi){var si=30*s,Qt=15*s;return this.int16[si+0]=f,this.int16[si+1]=b,this.int16[si+2]=S,this.int16[si+3]=M,this.int16[si+4]=L,this.int16[si+5]=U,this.int16[si+6]=W,this.int16[si+7]=K,this.uint16[si+8]=ie,this.uint16[si+9]=le,this.uint16[si+10]=ae,this.uint16[si+11]=he,this.uint16[si+12]=Me,this.uint16[si+13]=ke,this.uint16[si+14]=Ve,this.uint16[si+15]=Ye,this.uint16[si+16]=He,this.uint16[si+17]=it,this.uint16[si+18]=bt,this.uint16[si+19]=zt,this.uint16[si+20]=St,this.uint16[si+21]=Ht,this.uint32[Qt+11]=vi,this.float32[Qt+12]=hi,this.float32[Qt+13]=bi,this.float32[Qt+14]=pi,s},o}(D);gt.prototype.bytesPerElement=60,Jt("StructArrayLayout8i14ui1ul3f60",gt);var Ct=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s){var f=this.length;return this.resize(f+1),this.emplace(f,s)},o.prototype.emplace=function(s,f){var b=1*s;return this.float32[b+0]=f,s},o}(D);Ct.prototype.bytesPerElement=4,Jt("StructArrayLayout1f4",Ct);var Vt=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b){var S=this.length;return this.resize(S+1),this.emplace(S,s,f,b)},o.prototype.emplace=function(s,f,b,S){var M=3*s;return this.int16[M+0]=f,this.int16[M+1]=b,this.int16[M+2]=S,s},o}(D);Vt.prototype.bytesPerElement=6,Jt("StructArrayLayout3i6",Vt);var fi=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b){var S=this.length;return this.resize(S+1),this.emplace(S,s,f,b)},o.prototype.emplace=function(s,f,b,S){var M=2*s,L=4*s;return this.uint32[M+0]=f,this.uint16[L+2]=b,this.uint16[L+3]=S,s},o}(D);fi.prototype.bytesPerElement=8,Jt("StructArrayLayout1ul2ui8",fi);var ei=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b){var S=this.length;return this.resize(S+1),this.emplace(S,s,f,b)},o.prototype.emplace=function(s,f,b,S){var M=3*s;return this.uint16[M+0]=f,this.uint16[M+1]=b,this.uint16[M+2]=S,s},o}(D);ei.prototype.bytesPerElement=6,Jt("StructArrayLayout3ui6",ei);var ni=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f){var b=this.length;return this.resize(b+1),this.emplace(b,s,f)},o.prototype.emplace=function(s,f,b){var S=2*s;return this.uint16[S+0]=f,this.uint16[S+1]=b,s},o}(D);ni.prototype.bytesPerElement=4,Jt("StructArrayLayout2ui4",ni);var Nt=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s){var f=this.length;return this.resize(f+1),this.emplace(f,s)},o.prototype.emplace=function(s,f){var b=1*s;return this.uint16[b+0]=f,s},o}(D);Nt.prototype.bytesPerElement=2,Jt("StructArrayLayout1ui2",Nt);var Hi=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f){var b=this.length;return this.resize(b+1),this.emplace(b,s,f)},o.prototype.emplace=function(s,f,b){var S=2*s;return this.float32[S+0]=f,this.float32[S+1]=b,s},o}(D);Hi.prototype.bytesPerElement=8,Jt("StructArrayLayout2f8",Hi);var Ii=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,f,b,S){var M=this.length;return this.resize(M+1),this.emplace(M,s,f,b,S)},o.prototype.emplace=function(s,f,b,S,M){var L=4*s;return this.float32[L+0]=f,this.float32[L+1]=b,this.float32[L+2]=S,this.float32[L+3]=M,s},o}(D);Ii.prototype.bytesPerElement=16,Jt("StructArrayLayout4f16",Ii);var Vi=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointX.set=function(f){this._structArray.int16[this._pos2+0]=f},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.anchorPointY.set=function(f){this._structArray.int16[this._pos2+1]=f},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.x1.set=function(f){this._structArray.int16[this._pos2+2]=f},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.y1.set=function(f){this._structArray.int16[this._pos2+3]=f},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.x2.set=function(f){this._structArray.int16[this._pos2+4]=f},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.y2.set=function(f){this._structArray.int16[this._pos2+5]=f},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.featureIndex.set=function(f){this._structArray.uint32[this._pos4+3]=f},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.sourceLayerIndex.set=function(f){this._structArray.uint16[this._pos2+8]=f},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.bucketIndex.set=function(f){this._structArray.uint16[this._pos2+9]=f},s.radius.get=function(){return this._structArray.int16[this._pos2+10]},s.radius.set=function(f){this._structArray.int16[this._pos2+10]=f},s.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},s.signedDistanceFromAnchor.set=function(f){this._structArray.int16[this._pos2+11]=f},s.anchorPoint.get=function(){return new Kt(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,s),o}(P);Vi.prototype.size=24;var Ni=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.get=function(s){return new Vi(this,s)},o}(Ne);Jt("CollisionBoxArray",Ni);var Pi=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorX.set=function(f){this._structArray.int16[this._pos2+0]=f},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.anchorY.set=function(f){this._structArray.int16[this._pos2+1]=f},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.glyphStartIndex.set=function(f){this._structArray.uint16[this._pos2+2]=f},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.numGlyphs.set=function(f){this._structArray.uint16[this._pos2+3]=f},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.vertexStartIndex.set=function(f){this._structArray.uint32[this._pos4+2]=f},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineStartIndex.set=function(f){this._structArray.uint32[this._pos4+3]=f},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.lineLength.set=function(f){this._structArray.uint32[this._pos4+4]=f},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.segment.set=function(f){this._structArray.uint16[this._pos2+10]=f},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.lowerSize.set=function(f){this._structArray.uint16[this._pos2+11]=f},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.upperSize.set=function(f){this._structArray.uint16[this._pos2+12]=f},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetX.set=function(f){this._structArray.float32[this._pos4+7]=f},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.lineOffsetY.set=function(f){this._structArray.float32[this._pos4+8]=f},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.writingMode.set=function(f){this._structArray.uint8[this._pos1+36]=f},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},s.associatedIconIndex.set=function(f){this._structArray.int16[this._pos2+22]=f},Object.defineProperties(o.prototype,s),o}(P);Pi.prototype.size=48;var ji=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.get=function(s){return new Pi(this,s)},o}(ot);Jt("PlacedSymbolArray",ji);var Dr=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorX.set=function(f){this._structArray.int16[this._pos2+0]=f},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.anchorY.set=function(f){this._structArray.int16[this._pos2+1]=f},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.rightJustifiedTextSymbolIndex.set=function(f){this._structArray.int16[this._pos2+2]=f},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.centerJustifiedTextSymbolIndex.set=function(f){this._structArray.int16[this._pos2+3]=f},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.leftJustifiedTextSymbolIndex.set=function(f){this._structArray.int16[this._pos2+4]=f},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.verticalPlacedTextSymbolIndex.set=function(f){this._structArray.int16[this._pos2+5]=f},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.placedIconSymbolIndex.set=function(f){this._structArray.int16[this._pos2+6]=f},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.verticalPlacedIconSymbolIndex.set=function(f){this._structArray.int16[this._pos2+7]=f},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.key.set=function(f){this._structArray.uint16[this._pos2+8]=f},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxStartIndex.set=function(f){this._structArray.uint16[this._pos2+9]=f},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.textBoxEndIndex.set=function(f){this._structArray.uint16[this._pos2+10]=f},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxStartIndex.set=function(f){this._structArray.uint16[this._pos2+11]=f},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.verticalTextBoxEndIndex.set=function(f){this._structArray.uint16[this._pos2+12]=f},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxStartIndex.set=function(f){this._structArray.uint16[this._pos2+13]=f},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.iconBoxEndIndex.set=function(f){this._structArray.uint16[this._pos2+14]=f},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxStartIndex.set=function(f){this._structArray.uint16[this._pos2+15]=f},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.verticalIconBoxEndIndex.set=function(f){this._structArray.uint16[this._pos2+16]=f},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.featureIndex.set=function(f){this._structArray.uint16[this._pos2+17]=f},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numHorizontalGlyphVertices.set=function(f){this._structArray.uint16[this._pos2+18]=f},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numVerticalGlyphVertices.set=function(f){this._structArray.uint16[this._pos2+19]=f},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numIconVertices.set=function(f){this._structArray.uint16[this._pos2+20]=f},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.numVerticalIconVertices.set=function(f){this._structArray.uint16[this._pos2+21]=f},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+11]},s.crossTileID.set=function(f){this._structArray.uint32[this._pos4+11]=f},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+12]},s.textBoxScale.set=function(f){this._structArray.float32[this._pos4+12]=f},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.set=function(f){this._structArray.float32[this._pos4+13]=f},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.set=function(f){this._structArray.float32[this._pos4+14]=f},Object.defineProperties(o.prototype,s),o}(P);Dr.prototype.size=60;var Ri=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.get=function(s){return new Dr(this,s)},o}(gt);Jt("SymbolInstanceArray",Ri);var gr=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o;var s={offsetX:{configurable:!0}};return s.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},s.offsetX.set=function(f){this._structArray.float32[this._pos4+0]=f},Object.defineProperties(o.prototype,s),o}(P);gr.prototype.size=4;var fr=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.getoffsetX=function(s){return this.float32[1*s+0]},o.prototype.get=function(s){return new gr(this,s)},o}(Ct);Jt("GlyphOffsetArray",fr);var xr=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o;var s={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return s.x.get=function(){return this._structArray.int16[this._pos2+0]},s.x.set=function(f){this._structArray.int16[this._pos2+0]=f},s.y.get=function(){return this._structArray.int16[this._pos2+1]},s.y.set=function(f){this._structArray.int16[this._pos2+1]=f},s.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},s.tileUnitDistanceFromAnchor.set=function(f){this._structArray.int16[this._pos2+2]=f},Object.defineProperties(o.prototype,s),o}(P);xr.prototype.size=6;var Ft=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.getx=function(s){return this.int16[3*s+0]},o.prototype.gety=function(s){return this.int16[3*s+1]},o.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},o.prototype.get=function(s){return new xr(this,s)},o}(Vt);Jt("SymbolLineVertexArray",Ft);var Vn=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.featureIndex.set=function(f){this._structArray.uint32[this._pos4+0]=f},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.sourceLayerIndex.set=function(f){this._structArray.uint16[this._pos2+2]=f},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},s.bucketIndex.set=function(f){this._structArray.uint16[this._pos2+3]=f},Object.defineProperties(o.prototype,s),o}(P);Vn.prototype.size=8;var Cn=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.get=function(s){return new Vn(this,s)},o}(fi);Jt("FeatureIndexArray",Cn);var Fo=O([{name:"a_pos",components:2,type:"Int16"}],4).members,Lr=function(t){t===void 0&&(t=[]),this.segments=t};function $t(t,o){return 256*(t=Di(Math.floor(t),0,255))+(o=Di(Math.floor(o),0,255))}Lr.prototype.prepareSegment=function(t,o,s,f){var b=this.segments[this.segments.length-1];return t>Lr.MAX_VERTEX_ARRAY_LENGTH&&En("Max vertices per segment is "+Lr.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!b||b.vertexLength+t>Lr.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==f)&&(b={vertexOffset:o.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},f!==void 0&&(b.sortKey=f),this.segments.push(b)),b},Lr.prototype.get=function(){return this.segments},Lr.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var s=o[t];for(var f in s.vaos)s.vaos[f].destroy()}},Lr.simpleSegment=function(t,o,s,f){return new Lr([{vertexOffset:t,primitiveOffset:o,vertexLength:s,primitiveLength:f,vaos:{},sortKey:0}])},Lr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jt("SegmentVector",Lr);var qs=Gi(function(t){t.exports=function(o,s){var f,b,S,M,L,U,W,K;for(f=3&o.length,b=o.length-f,S=s,L=3432918353,U=461845907,K=0;K<b;)W=255&o.charCodeAt(K)|(255&o.charCodeAt(++K))<<8|(255&o.charCodeAt(++K))<<16|(255&o.charCodeAt(++K))<<24,++K,S=27492+(65535&(M=5*(65535&(S=(S^=W=(65535&(W=(W=(65535&W)*L+(((W>>>16)*L&65535)<<16)&4294967295)<<15|W>>>17))*U+(((W>>>16)*U&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(W=0,f){case 3:W^=(255&o.charCodeAt(K+2))<<16;case 2:W^=(255&o.charCodeAt(K+1))<<8;case 1:S^=W=(65535&(W=(W=(65535&(W^=255&o.charCodeAt(K)))*L+(((W>>>16)*L&65535)<<16)&4294967295)<<15|W>>>17))*U+(((W>>>16)*U&65535)<<16)&4294967295}return S^=o.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}}),tc=Gi(function(t){t.exports=function(o,s){for(var f,b=o.length,S=s^b,M=0;b>=4;)f=1540483477*(65535&(f=255&o.charCodeAt(M)|(255&o.charCodeAt(++M))<<8|(255&o.charCodeAt(++M))<<16|(255&o.charCodeAt(++M))<<24))+((1540483477*(f>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),b-=4,++M;switch(b){case 3:S^=(255&o.charCodeAt(M+2))<<16;case 2:S^=(255&o.charCodeAt(M+1))<<8;case 1:S=1540483477*(65535&(S^=255&o.charCodeAt(M)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}}),ha=qs,ul=qs,ic=tc;ha.murmur3=ul,ha.murmur2=ic;var rs=function(){this.ids=[],this.positions=[],this.indexed=!1};rs.prototype.add=function(t,o,s,f){this.ids.push(Ic(t)),this.positions.push(o,s,f)},rs.prototype.getPositions=function(t){for(var o=Ic(t),s=0,f=this.ids.length-1;s<f;){var b=s+f>>1;this.ids[b]>=o?f=b:s=b+1}for(var S=[];this.ids[s]===o;){var M=this.positions[3*s],L=this.positions[3*s+1],U=this.positions[3*s+2];S.push({index:M,start:L,end:U}),s++}return S},rs.serialize=function(t,o){var s=new Float64Array(t.ids),f=new Uint32Array(t.positions);return function b(S,M,L,U){if(!(L>=U)){for(var W=S[L+U>>1],K=L-1,ie=U+1;;){do K++;while(S[K]<W);do ie--;while(S[ie]>W);if(K>=ie)break;ws(S,K,ie),ws(M,3*K,3*ie),ws(M,3*K+1,3*ie+1),ws(M,3*K+2,3*ie+2)}b(S,M,L,ie),b(S,M,ie+1,U)}}(s,f,0,s.length-1),o&&o.push(s.buffer,f.buffer),{ids:s,positions:f}},rs.deserialize=function(t){var o=new rs;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var Wc=Math.pow(2,53)-1;function Ic(t){var o=+t;return!isNaN(o)&&o<=Wc?o:ha(String(t))}function ws(t,o,s){var f=t[o];t[o]=t[s],t[s]=f}Jt("FeaturePositionMap",rs);var Ba=function(t,o){this.gl=t.gl,this.location=o},Ac=function(t){function o(s,f){t.call(this,s,f),this.current=0}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},o}(Ba),Fa=function(t){function o(s,f){t.call(this,s,f),this.current=0}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},o}(Ba),m=function(t){function o(s,f){t.call(this,s,f),this.current=[0,0]}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},o}(Ba),n=function(t){function o(s,f){t.call(this,s,f),this.current=[0,0,0]}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},o}(Ba),l=function(t){function o(s,f){t.call(this,s,f),this.current=[0,0,0,0]}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},o}(Ba),g=function(t){function o(s,f){t.call(this,s,f),this.current=Ei.transparent}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},o}(Ba),x=new Float32Array(16),E=function(t){function o(s,f){t.call(this,s,f),this.current=x}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var f=1;f<16;f++)if(s[f]!==this.current[f]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},o}(Ba);function z(t){return[$t(255*t.r,255*t.g),$t(255*t.b,255*t.a)]}var k=function(t,o,s){this.value=t,this.uniformNames=o.map(function(f){return"u_"+f}),this.type=s};k.prototype.setUniform=function(t,o,s){t.set(s.constantOr(this.value))},k.prototype.getBinding=function(t,o){return this.type==="color"?new g(t,o):new Fa(t,o)};var B=function(t,o){this.uniformNames=o.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null};B.prototype.setConstantPatternPositions=function(t,o){this.patternTo=t.tlbr,this.patternFrom=o.tlbr},B.prototype.setUniform=function(t,o,s,f){var b=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:null;b&&t.set(b)},B.prototype.getBinding=function(t,o){return new l(t,o)};var q=function(t,o,s,f){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=o.map(function(b){return{name:"a_"+b,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new f};q.prototype.populatePaintArray=function(t,o,s,f){var b=this.paintVertexArray.length,S=this.expression.evaluate(new qr(0),o,{},[],f);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},q.prototype.updatePaintArray=function(t,o,s,f){var b=this.expression.evaluate({zoom:0},s,f);this._setPaintValue(t,o,b)},q.prototype._setPaintValue=function(t,o,s){if(this.type==="color")for(var f=z(s),b=t;b<o;b++)this.paintVertexArray.emplace(b,f[0],f[1]);else{for(var S=t;S<o;S++)this.paintVertexArray.emplace(S,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},q.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},q.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var N=function(t,o,s,f,b,S){this.expression=t,this.uniformNames=o.map(function(M){return"u_"+M+"_t"}),this.type=s,this.useIntegerZoom=f,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=o.map(function(M){return{name:"a_"+M,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new S};N.prototype.populatePaintArray=function(t,o,s,f){var b=this.expression.evaluate(new qr(this.zoom),o,{},[],f),S=this.expression.evaluate(new qr(this.zoom+1),o,{},[],f),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,b,S)},N.prototype.updatePaintArray=function(t,o,s,f){var b=this.expression.evaluate({zoom:this.zoom},s,f),S=this.expression.evaluate({zoom:this.zoom+1},s,f);this._setPaintValue(t,o,b,S)},N.prototype._setPaintValue=function(t,o,s,f){if(this.type==="color")for(var b=z(s),S=z(f),M=t;M<o;M++)this.paintVertexArray.emplace(M,b[0],b[1],S[0],S[1]);else{for(var L=t;L<o;L++)this.paintVertexArray.emplace(L,s,f);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(f))}},N.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},N.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},N.prototype.setUniform=function(t,o){var s=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,f=Di(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(f)},N.prototype.getBinding=function(t,o){return new Fa(t,o)};var H=function(t,o,s,f,b,S,M){this.expression=t,this.type=s,this.useIntegerZoom=f,this.zoom=b,this.layerId=M,this.paintVertexAttributes=o.map(function(L){return{name:"a_"+L,type:"Uint16",components:4,offset:0}}),this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S};H.prototype.populatePaintArray=function(t,o,s){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,o.patterns&&o.patterns[this.layerId],s)},H.prototype.updatePaintArray=function(t,o,s,f,b){this._setPaintValues(t,o,s.patterns&&s.patterns[this.layerId],b)},H.prototype._setPaintValues=function(t,o,s,f){if(f&&s){var b=s.min,S=s.mid,M=s.max,L=f[b],U=f[S],W=f[M];if(L&&U&&W)for(var K=t;K<o;K++)this.zoomInPaintVertexArray.emplace(K,U.tl[0],U.tl[1],U.br[0],U.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1]),this.zoomOutPaintVertexArray.emplace(K,U.tl[0],U.tl[1],U.br[0],U.br[1],W.tl[0],W.tl[1],W.br[0],W.br[1])}},H.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},H.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ne=function(t,o,s,f){this.binders={},this.layoutAttributes=f,this._buffers=[];var b=[];for(var S in t.paint._values)if(s(S)){var M=t.paint.get(S);if(M instanceof $n&&al(M.property.specification)){var L=fe(S,t.type),U=M.value,W=M.property.specification.type,K=M.property.useIntegerZoom,ie=M.property.specification["property-type"],le=ie==="cross-faded"||ie==="cross-faded-data-driven";if(U.kind==="constant")this.binders[S]=le?new B(U.value,L):new k(U.value,L,W),b.push("/u_"+S);else if(U.kind==="source"||le){var ae=me(S,W,"source");this.binders[S]=le?new H(U,L,W,K,o,ae,t.id):new q(U,L,W,ae),b.push("/a_"+S)}else{var he=me(S,W,"composite");this.binders[S]=new N(U,L,W,K,o,he),b.push("/z_"+S)}}}this.cacheKey=b.sort().join("")};ne.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof q||o instanceof N?o.maxValue:0},ne.prototype.populatePaintArrays=function(t,o,s,f){for(var b in this.binders){var S=this.binders[b];(S instanceof q||S instanceof N||S instanceof H)&&S.populatePaintArray(t,o,s,f)}},ne.prototype.setConstantPatternPositions=function(t,o){for(var s in this.binders){var f=this.binders[s];f instanceof B&&f.setConstantPatternPositions(t,o)}},ne.prototype.updatePaintArrays=function(t,o,s,f,b){var S=!1;for(var M in t)for(var L=0,U=o.getPositions(M);L<U.length;L+=1){var W=U[L],K=s.feature(W.index);for(var ie in this.binders){var le=this.binders[ie];if((le instanceof q||le instanceof N||le instanceof H)&&le.expression.isStateDependent===!0){var ae=f.paint.get(ie);le.expression=ae.value,le.updatePaintArray(W.start,W.end,K,t[M],b),S=!0}}}return S},ne.prototype.defines=function(){var t=[];for(var o in this.binders){var s=this.binders[o];(s instanceof k||s instanceof B)&&t.push.apply(t,s.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return t},ne.prototype.getPaintVertexBuffers=function(){return this._buffers},ne.prototype.getUniforms=function(t,o){var s=[];for(var f in this.binders){var b=this.binders[f];if(b instanceof k||b instanceof B||b instanceof N)for(var S=0,M=b.uniformNames;S<M.length;S+=1){var L=M[S];if(o[L]){var U=b.getBinding(t,o[L]);s.push({name:L,property:f,binding:U})}}}return s},ne.prototype.setUniforms=function(t,o,s,f){for(var b=0,S=o;b<S.length;b+=1){var M=S[b],L=M.name,U=M.property,W=M.binding;this.binders[U].setUniform(W,f,s.get(U),L)}},ne.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var s=this.binders[o];if(t&&s instanceof H){var f=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(s instanceof q||s instanceof N)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},ne.prototype.upload=function(t){for(var o in this.binders){var s=this.binders[o];(s instanceof q||s instanceof N||s instanceof H)&&s.upload(t)}this.updatePaintBuffers()},ne.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof q||o instanceof N||o instanceof H)&&o.destroy()}};var ce=function(t,o,s,f){f===void 0&&(f=function(){return!0}),this.programConfigurations={};for(var b=0,S=o;b<S.length;b+=1){var M=S[b];this.programConfigurations[M.id]=new ne(M,s,f,t)}this.needsUpload=!1,this._featureMap=new rs,this._bufferOffset=0};function fe(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from"],"fill-pattern":["pattern_to","pattern_from"],"fill-extrusion-pattern":["pattern_to","pattern_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function me(t,o,s){var f={color:{source:Hi,composite:Ii},number:{source:Ct,composite:Hi}},b=function(S){return{"line-pattern":{source:Te,composite:Te},"fill-pattern":{source:Te,composite:Te},"fill-extrusion-pattern":{source:Te,composite:Te}}[S]}(t);return b&&b[s]||f[o][s]}ce.prototype.populatePaintArrays=function(t,o,s,f,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,f,b);o.id!==void 0&&this._featureMap.add(o.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},ce.prototype.updatePaintArrays=function(t,o,s,f){for(var b=0,S=s;b<S.length;b+=1){var M=S[b];this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(t,this._featureMap,o,M,f)||this.needsUpload}},ce.prototype.get=function(t){return this.programConfigurations[t]},ce.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},ce.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Jt("ConstantBinder",k),Jt("CrossFadedConstantBinder",B),Jt("SourceExpressionBinder",q),Jt("CrossFadedCompositeBinder",H),Jt("CompositeExpressionBinder",N),Jt("ProgramConfiguration",ne,{omit:["_buffers"]}),Jt("ProgramConfigurationSet",ce);var de=8192,Y,ue=(Y=15,{min:-1*Math.pow(2,Y-1),max:Math.pow(2,Y-1)-1});function we(t){for(var o=de/t.extent,s=t.loadGeometry(),f=0;f<s.length;f++)for(var b=s[f],S=0;S<b.length;S++){var M=b[S];M.x=Math.round(M.x*o),M.y=Math.round(M.y*o),(M.x<ue.min||M.x>ue.max||M.y<ue.min||M.y>ue.max)&&(En("Geometry exceeds allowed extent, reduce your vector tile buffer size"),M.x=Di(M.x,ue.min,ue.max),M.y=Di(M.y,ue.min,ue.max))}return s}function Ee(t,o,s,f,b){t.emplaceBack(2*o+(f+1)/2,2*s+(b+1)/2)}var Fe=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Q,this.indexArray=new ei,this.segments=new Lr,this.programConfigurations=new ce(Fo,t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function qe(t,o){for(var s=0;s<t.length;s++)if(kt(o,t[s]))return!0;for(var f=0;f<o.length;f++)if(kt(t,o[f]))return!0;return!!ct(t,o)}function je(t,o,s){return!!kt(t,o)||!!nt(o,t,s)}function Ke(t,o){if(t.length===1)return dt(o,t[0]);for(var s=0;s<o.length;s++)for(var f=o[s],b=0;b<f.length;b++)if(kt(t,f[b]))return!0;for(var S=0;S<t.length;S++)if(dt(o,t[S]))return!0;for(var M=0;M<o.length;M++)if(ct(t,o[M]))return!0;return!1}function $e(t,o,s){if(t.length>1){if(ct(t,o))return!0;for(var f=0;f<o.length;f++)if(nt(o[f],t,s))return!0}for(var b=0;b<t.length;b++)if(nt(t[b],o,s))return!0;return!1}function ct(t,o){if(t.length===0||o.length===0)return!1;for(var s=0;s<t.length-1;s++)for(var f=t[s],b=t[s+1],S=0;S<o.length-1;S++)if(Bt(f,b,o[S],o[S+1]))return!0;return!1}function Bt(t,o,s,f){return Wo(t,s,f)!==Wo(o,s,f)&&Wo(t,o,s)!==Wo(t,o,f)}function nt(t,o,s){var f=s*s;if(o.length===1)return t.distSqr(o[0])<f;for(var b=1;b<o.length;b++)if(Tt(t,o[b-1],o[b])<f)return!0;return!1}function Tt(t,o,s){var f=o.distSqr(s);if(f===0)return t.distSqr(o);var b=((t.x-o.x)*(s.x-o.x)+(t.y-o.y)*(s.y-o.y))/f;return b<0?t.distSqr(o):b>1?t.distSqr(s):t.distSqr(s.sub(o)._mult(b)._add(o))}function dt(t,o){for(var s,f,b,S=!1,M=0;M<t.length;M++)for(var L=0,U=(s=t[M]).length-1;L<s.length;U=L++)f=s[L],b=s[U],f.y>o.y!=b.y>o.y&&o.x<(b.x-f.x)*(o.y-f.y)/(b.y-f.y)+f.x&&(S=!S);return S}function kt(t,o){for(var s=!1,f=0,b=t.length-1;f<t.length;b=f++){var S=t[f],M=t[b];S.y>o.y!=M.y>o.y&&o.x<(M.x-S.x)*(o.y-S.y)/(M.y-S.y)+S.x&&(s=!s)}return s}function ut(t,o,s){var f=s[0],b=s[2];if(t.x<f.x&&o.x<f.x||t.x>b.x&&o.x>b.x||t.y<f.y&&o.y<f.y||t.y>b.y&&o.y>b.y)return!1;var S=Wo(t,o,s[0]);return S!==Wo(t,o,s[1])||S!==Wo(t,o,s[2])||S!==Wo(t,o,s[3])}function xt(t,o,s){var f=o.paint.get(t).value;return f.kind==="constant"?f.value:s.programConfigurations.get(o.id).getMaxValue(t)}function Lt(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Mt(t,o,s,f,b){if(!o[0]&&!o[1])return t;var S=Kt.convert(o)._mult(b);s==="viewport"&&S._rotate(-f);for(var M=[],L=0;L<t.length;L++){var U=t[L];M.push(U.sub(S))}return M}Fe.prototype.populate=function(t,o){var s=this.layers[0],f=[],b=null;s.type==="circle"&&(b=s.layout.get("circle-sort-key"));for(var S=0,M=t;S<M.length;S+=1){var L=M[S],U=L.feature,W=L.id,K=L.index,ie=L.sourceLayerIndex;if(this.layers[0]._featureFilter(new qr(this.zoom),U)){var le=we(U),ae=b?b.evaluate(U,{}):void 0,he={id:W,properties:U.properties,type:U.type,sourceLayerIndex:ie,index:K,geometry:le,patterns:{},sortKey:ae};f.push(he)}}b&&f.sort(function(St,Ht){return St.sortKey-Ht.sortKey});for(var Me=0,ke=f;Me<ke.length;Me+=1){var Ve=ke[Me],Ye=Ve,He=Ye.geometry,it=Ye.index,bt=Ye.sourceLayerIndex,zt=t[it].feature;this.addFeature(Ve,He,it),o.featureIndex.insert(zt,He,it,bt,this.index)}},Fe.prototype.update=function(t,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,s)},Fe.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Fe.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Fe.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Fe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Fe.prototype.addFeature=function(t,o,s){for(var f=0,b=o;f<b.length;f+=1)for(var S=0,M=b[f];S<M.length;S+=1){var L=M[S],U=L.x,W=L.y;if(!(U<0||U>=de||W<0||W>=de)){var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ie=K.vertexLength;Ee(this.layoutVertexArray,U,W,-1,-1),Ee(this.layoutVertexArray,U,W,1,-1),Ee(this.layoutVertexArray,U,W,1,1),Ee(this.layoutVertexArray,U,W,-1,1),this.indexArray.emplaceBack(ie,ie+1,ie+2),this.indexArray.emplaceBack(ie,ie+3,ie+2),K.vertexLength+=4,K.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{})},Jt("CircleBucket",Fe,{omit:["layers"]});var Ut=new p({"circle-sort-key":new Mi(V.layout_circle["circle-sort-key"])}),Si={paint:new p({"circle-radius":new Mi(V.paint_circle["circle-radius"]),"circle-color":new Mi(V.paint_circle["circle-color"]),"circle-blur":new Mi(V.paint_circle["circle-blur"]),"circle-opacity":new Mi(V.paint_circle["circle-opacity"]),"circle-translate":new ai(V.paint_circle["circle-translate"]),"circle-translate-anchor":new ai(V.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ai(V.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ai(V.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mi(V.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mi(V.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mi(V.paint_circle["circle-stroke-opacity"])}),layout:Ut},Ai=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,s=arguments.length;s--;)o+=t[s]*t[s];return Math.sqrt(o)});var ui,Fi=function(t,o,s){return t[0]=o[0]-s[0],t[1]=o[1]-s[1],t[2]=o[2]-s[2],t};ui=new Ai(3),Ai!=Float32Array&&(ui[0]=0,ui[1]=0,ui[2]=0);function ur(t,o,s){var f=o[0],b=o[1],S=o[2],M=o[3];return t[0]=s[0]*f+s[4]*b+s[8]*S+s[12]*M,t[1]=s[1]*f+s[5]*b+s[9]*S+s[13]*M,t[2]=s[2]*f+s[6]*b+s[10]*S+s[14]*M,t[3]=s[3]*f+s[7]*b+s[11]*S+s[15]*M,t}(function(){(function(){var t=new Ai(4);return Ai!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t})()})();var yr=function(t){var o=t[0],s=t[1];return o*o+s*s},wi=(function(){(function(){var t=new Ai(2);return Ai!=Float32Array&&(t[0]=0,t[1]=0),t})()}(),function(t){function o(s){t.call(this,s,Si)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.createBucket=function(s){return new Fe(s)},o.prototype.queryRadius=function(s){var f=s;return xt("circle-radius",this,f)+xt("circle-stroke-width",this,f)+Lt(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(s,f,b,S,M,L,U,W){for(var K=Mt(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),L.angle,U),ie=this.paint.get("circle-radius").evaluate(f,b)+this.paint.get("circle-stroke-width").evaluate(f,b),le=this.paint.get("circle-pitch-alignment")==="map",ae=le?K:function(St,Ht){return St.map(function(vi){return Gr(vi,Ht)})}(K,W),he=le?ie*U:ie,Me=0,ke=S;Me<ke.length;Me+=1)for(var Ve=0,Ye=ke[Me];Ve<Ye.length;Ve+=1){var He=Ye[Ve],it=le?He:Gr(He,W),bt=he,zt=ur([],[He.x,He.y,0,1],W);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?bt*=zt[3]/L.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(bt*=L.cameraToCenterDistance/zt[3]),je(ae,it,bt))return!0}return!1},o}(y));function Gr(t,o){var s=ur([],[t.x,t.y,0,1],o);return new Kt(s[0]/s[3],s[1]/s[3])}var sn=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(Fe);function nn(t,o,s,f){var b=o.width,S=o.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==b*S*s)throw new RangeError("mismatched image size")}else f=new Uint8Array(b*S*s);return t.width=b,t.height=S,t.data=f,t}function ln(t,o,s){var f=o.width,b=o.height;if(f!==t.width||b!==t.height){var S=nn({},{width:f,height:b},s);Jo(t,S,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,f),height:Math.min(t.height,b)},s),t.width=f,t.height=b,t.data=S.data}}function Jo(t,o,s,f,b,S){if(b.width===0||b.height===0)return o;if(b.width>t.width||b.height>t.height||s.x>t.width-b.width||s.y>t.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>o.width||b.height>o.height||f.x>o.width-b.width||f.y>o.height-b.height)throw new RangeError("out of range destination coordinates for image copy");for(var M=t.data,L=o.data,U=0;U<b.height;U++)for(var W=((s.y+U)*t.width+s.x)*S,K=((f.y+U)*o.width+f.x)*S,ie=0;ie<b.width*S;ie++)L[K+ie]=M[W+ie];return o}Jt("HeatmapBucket",sn,{omit:["layers"]});var Hn=function(t,o){nn(this,t,1,o)};Hn.prototype.resize=function(t){ln(this,t,1)},Hn.prototype.clone=function(){return new Hn({width:this.width,height:this.height},new Uint8Array(this.data))},Hn.copy=function(t,o,s,f,b){Jo(t,o,s,f,b,1)};var zn=function(t,o){nn(this,t,4,o)};zn.prototype.resize=function(t){ln(this,t,4)},zn.prototype.replace=function(t,o){o?this.data.set(t):t instanceof Uint8ClampedArray?this.data=new Uint8Array(t.buffer):this.data=t},zn.prototype.clone=function(){return new zn({width:this.width,height:this.height},new Uint8Array(this.data))},zn.copy=function(t,o,s,f,b){Jo(t,o,s,f,b,4)},Jt("AlphaImage",Hn),Jt("RGBAImage",zn);var Dl={paint:new p({"heatmap-radius":new Mi(V.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mi(V.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ai(V.paint_heatmap["heatmap-intensity"]),"heatmap-color":new d(V.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ai(V.paint_heatmap["heatmap-opacity"])})};function Pn(t,o){for(var s=new Uint8Array(1024),f={},b=0,S=0;b<256;b++,S+=4){f[o]=b/255;var M=t.evaluate(f);s[S+0]=Math.floor(255*M.r/M.a),s[S+1]=Math.floor(255*M.g/M.a),s[S+2]=Math.floor(255*M.b/M.a),s[S+3]=Math.floor(255*M.a)}return new zn({width:256,height:1},s)}var fn=function(t){function o(s){t.call(this,s,Dl),this._updateColorRamp()}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.createBucket=function(s){return new sn(s)},o.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){var s=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Pn(s,"heatmapDensity"),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(y),Vr={paint:new p({"hillshade-illumination-direction":new ai(V.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ai(V.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ai(V.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ai(V.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ai(V.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ai(V.paint_hillshade["hillshade-accent-color"])})},yo=function(t){function o(s){t.call(this,s,Vr)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(y),Ea=O([{name:"a_pos",components:2,type:"Int16"}],4).members,xn=$c,ns=$c;function $c(t,o,s){s=s||2;var f,b,S,M,L,U,W,K=o&&o.length,ie=K?o[0]*s:t.length,le=Mc(t,0,ie,s,!0),ae=[];if(!le||le.next===le.prev)return ae;if(K&&(le=function(Me,ke,Ve,Ye){var He,it,bt,zt,St,Ht=[];for(He=0,it=ke.length;He<it;He++)bt=ke[He]*Ye,zt=He<it-1?ke[He+1]*Ye:Me.length,(St=Mc(Me,bt,zt,Ye,!1))===St.next&&(St.steiner=!0),Ht.push(Cd(St));for(Ht.sort(lp),He=0;He<Ht.length;He++)Tf(Ht[He],Ve),Ve=Gs(Ve,Ve.next);return Ve}(t,o,le,s)),t.length>80*s){f=S=t[0],b=M=t[1];for(var he=s;he<ie;he+=s)(L=t[he])<f&&(f=L),(U=t[he+1])<b&&(b=U),L>S&&(S=L),U>M&&(M=U);W=(W=Math.max(S-f,M-b))!==0?1/W:0}return Ts(le,ae,s,f,b,W),ae}function Mc(t,o,s,f,b){var S,M;if(b===Ku(t,o,s,f)>0)for(S=o;S<s;S+=f)M=Af(S,t[S],t[S+1],M);else for(S=s-f;S>=o;S-=f)M=Af(S,t[S],t[S+1],M);return M&&$u(M,M.next)&&(up(M),M=M.next),M}function Gs(t,o){if(!t)return t;o||(o=t);var s,f=t;do if(s=!1,f.steiner||!$u(f,f.next)&&no(f.prev,f,f.next)!==0)f=f.next;else{if(up(f),(f=o=f.prev)===f.next)break;s=!0}while(s||f!==o);return o}function Ts(t,o,s,f,b,S,M){if(t){!M&&S&&function(K,ie,le,ae){var he=K;do he.z===null&&(he.z=Md(he.x,he.y,ie,le,ae)),he.prevZ=he.prev,he.nextZ=he.next,he=he.next;while(he!==K);he.prevZ.nextZ=null,he.prevZ=null,function(Me){var ke,Ve,Ye,He,it,bt,zt,St,Ht=1;do{for(Ve=Me,Me=null,it=null,bt=0;Ve;){for(bt++,Ye=Ve,zt=0,ke=0;ke<Ht&&(zt++,Ye=Ye.nextZ);ke++);for(St=Ht;zt>0||St>0&&Ye;)zt!==0&&(St===0||!Ye||Ve.z<=Ye.z)?(He=Ve,Ve=Ve.nextZ,zt--):(He=Ye,Ye=Ye.nextZ,St--),it?it.nextZ=He:Me=He,He.prevZ=it,it=He;Ve=Ye}it.nextZ=null,Ht*=2}while(bt>1)}(he)}(t,f,b,S);for(var L,U,W=t;t.prev!==t.next;)if(L=t.prev,U=t.next,S?Hc(t,f,b,S):Cc(t))o.push(L.i/s),o.push(t.i/s),o.push(U.i/s),up(t),t=U.next,W=U.next;else if((t=U)===W){M?M===1?Ts(t=wh(Gs(t),o,s),o,s,f,b,S,2):M===2&&Wu(t,o,s,f,b,S):Ts(Gs(t),o,s,f,b,S,1);break}}}function Cc(t){var o=t.prev,s=t,f=t.next;if(no(o,s,f)>=0)return!1;for(var b=t.next.next;b!==t.prev;){if(Kc(o.x,o.y,s.x,s.y,f.x,f.y,b.x,b.y)&&no(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function Hc(t,o,s,f){var b=t.prev,S=t,M=t.next;if(no(b,S,M)>=0)return!1;for(var L=b.x<S.x?b.x<M.x?b.x:M.x:S.x<M.x?S.x:M.x,U=b.y<S.y?b.y<M.y?b.y:M.y:S.y<M.y?S.y:M.y,W=b.x>S.x?b.x>M.x?b.x:M.x:S.x>M.x?S.x:M.x,K=b.y>S.y?b.y>M.y?b.y:M.y:S.y>M.y?S.y:M.y,ie=Md(L,U,o,s,f),le=Md(W,K,o,s,f),ae=t.prevZ,he=t.nextZ;ae&&ae.z>=ie&&he&&he.z<=le;){if(ae!==t.prev&&ae!==t.next&&Kc(b.x,b.y,S.x,S.y,M.x,M.y,ae.x,ae.y)&&no(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,he!==t.prev&&he!==t.next&&Kc(b.x,b.y,S.x,S.y,M.x,M.y,he.x,he.y)&&no(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ae&&ae.z>=ie;){if(ae!==t.prev&&ae!==t.next&&Kc(b.x,b.y,S.x,S.y,M.x,M.y,ae.x,ae.y)&&no(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;he&&he.z<=le;){if(he!==t.prev&&he!==t.next&&Kc(b.x,b.y,S.x,S.y,M.x,M.y,he.x,he.y)&&no(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function wh(t,o,s){var f=t;do{var b=f.prev,S=f.next.next;!$u(b,S)&&zc(b,f,f.next,S)&&Th(b,S)&&Th(S,b)&&(o.push(b.i/s),o.push(f.i/s),o.push(S.i/s),up(f),up(f.next),f=t=S),f=f.next}while(f!==t);return Gs(f)}function Wu(t,o,s,f,b,S){var M=t;do{for(var L=M.next.next;L!==M.prev;){if(M.i!==L.i&&Sf(M,L)){var U=If(M,L);return M=Gs(M,M.next),U=Gs(U,U.next),Ts(M,o,s,f,b,S),void Ts(U,o,s,f,b,S)}L=L.next}M=M.next}while(M!==t)}function lp(t,o){return t.x-o.x}function Tf(t,o){if(o=function(f,b){var S,M=b,L=f.x,U=f.y,W=-1/0;do{if(U<=M.y&&U>=M.next.y&&M.next.y!==M.y){var K=M.x+(U-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(K<=L&&K>W){if(W=K,K===L){if(U===M.y)return M;if(U===M.next.y)return M.next}S=M.x<M.next.x?M:M.next}}M=M.next}while(M!==b);if(!S)return null;if(L===W)return S;var ie,le=S,ae=S.x,he=S.y,Me=1/0;M=S;do L>=M.x&&M.x>=ae&&L!==M.x&&Kc(U<he?L:W,U,ae,he,U<he?W:L,U,M.x,M.y)&&(ie=Math.abs(U-M.y)/(L-M.x),Th(M,f)&&(ie<Me||ie===Me&&(M.x>S.x||M.x===S.x&&Ef(S,M)))&&(S=M,Me=ie)),M=M.next;while(M!==le);return S}(t,o)){var s=If(o,t);Gs(o,o.next),Gs(s,s.next)}}function Ef(t,o){return no(t.prev,t,o.prev)<0&&no(o.next,t,t.next)<0}function Md(t,o,s,f,b){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*b)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-f)*b)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Cd(t){var o=t,s=t;do(o.x<s.x||o.x===s.x&&o.y<s.y)&&(s=o),o=o.next;while(o!==t);return s}function Kc(t,o,s,f,b,S,M,L){return(b-M)*(o-L)-(t-M)*(S-L)>=0&&(t-M)*(f-L)-(s-M)*(o-L)>=0&&(s-M)*(S-L)-(b-M)*(f-L)>=0}function Sf(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(s,f){var b=s;do{if(b.i!==s.i&&b.next.i!==s.i&&b.i!==f.i&&b.next.i!==f.i&&zc(b,b.next,s,f))return!0;b=b.next}while(b!==s);return!1}(t,o)&&(Th(t,o)&&Th(o,t)&&function(s,f){var b=s,S=!1,M=(s.x+f.x)/2,L=(s.y+f.y)/2;do b.y>L!=b.next.y>L&&b.next.y!==b.y&&M<(b.next.x-b.x)*(L-b.y)/(b.next.y-b.y)+b.x&&(S=!S),b=b.next;while(b!==s);return S}(t,o)&&(no(t.prev,t,o.prev)||no(t,o.prev,o))||$u(t,o)&&no(t.prev,t,t.next)>0&&no(o.prev,o,o.next)>0)}function no(t,o,s){return(o.y-t.y)*(s.x-o.x)-(o.x-t.x)*(s.y-o.y)}function $u(t,o){return t.x===o.x&&t.y===o.y}function zc(t,o,s,f){var b=cp(no(t,o,s)),S=cp(no(t,o,f)),M=cp(no(s,f,t)),L=cp(no(s,f,o));return b!==S&&M!==L||!(b!==0||!Hu(t,s,o))||!(S!==0||!Hu(t,f,o))||!(M!==0||!Hu(s,t,f))||!(L!==0||!Hu(s,o,f))}function Hu(t,o,s){return o.x<=Math.max(t.x,s.x)&&o.x>=Math.min(t.x,s.x)&&o.y<=Math.max(t.y,s.y)&&o.y>=Math.min(t.y,s.y)}function cp(t){return t>0?1:t<0?-1:0}function Th(t,o){return no(t.prev,t,t.next)<0?no(t,o,t.next)>=0&&no(t,t.prev,o)>=0:no(t,o,t.prev)<0||no(t,t.next,o)<0}function If(t,o){var s=new hp(t.i,t.x,t.y),f=new hp(o.i,o.x,o.y),b=t.next,S=o.prev;return t.next=o,o.prev=t,s.next=b,b.prev=s,f.next=s,s.prev=f,S.next=f,f.prev=S,f}function Af(t,o,s,f){var b=new hp(t,o,s);return f?(b.next=f.next,b.prev=f,f.next.prev=b,f.next=b):(b.prev=b,b.next=b),b}function up(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function hp(t,o,s){this.i=t,this.x=o,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ku(t,o,s,f){for(var b=0,S=o,M=s-f;S<s;S+=f)b+=(t[M]-t[S])*(t[S+1]+t[M+1]),M=S;return b}function Eh(t,o,s,f,b){(function S(M,L,U,W,K){for(;W>U;){if(W-U>600){var ie=W-U+1,le=L-U+1,ae=Math.log(ie),he=.5*Math.exp(2*ae/3),Me=.5*Math.sqrt(ae*he*(ie-he)/ie)*(le-ie/2<0?-1:1),ke=Math.max(U,Math.floor(L-le*he/ie+Me)),Ve=Math.min(W,Math.floor(L+(ie-le)*he/ie+Me));S(M,L,ke,Ve,K)}var Ye=M[L],He=U,it=W;for(hl(M,U,L),K(M[W],Ye)>0&&hl(M,U,W);He<it;){for(hl(M,He,it),He++,it--;K(M[He],Ye)<0;)He++;for(;K(M[it],Ye)>0;)it--}K(M[U],Ye)===0?hl(M,U,it):hl(M,++it,W),it<=L&&(U=it+1),L<=it&&(W=it-1)}})(t,o,s||0,f||t.length-1,b||rc)}function hl(t,o,s){var f=t[o];t[o]=t[s],t[s]=f}function rc(t,o){return t<o?-1:t>o?1:0}function Pc(t,o){var s=t.length;if(s<=1)return[t];for(var f,b,S=[],M=0;M<s;M++){var L=Ki(t[M]);L!==0&&(t[M].area=Math.abs(L),b===void 0&&(b=L<0),b===L<0?(f&&S.push(f),f=[t[M]]):f.push(t[M]))}if(f&&S.push(f),o>1)for(var U=0;U<S.length;U++)S[U].length<=o||(Eh(S[U],o,1,S[U].length-1,yu),S[U]=S[U].slice(0,o));return S}function yu(t,o){return o.area-t.area}function Yc(t,o,s){for(var f=s.patternDependencies,b=!1,S=0,M=o;S<M.length;S+=1){var L=M[S].paint.get(t+"-pattern");L.isConstant()||(b=!0);var U=L.constantOr(null);U&&(b=!0,f[U.to]=!0,f[U.from]=!0)}return b}function zd(t,o,s,f,b){for(var S=b.patternDependencies,M=0,L=o;M<L.length;M+=1){var U=L[M],W=U.paint.get(t+"-pattern").value;if(W.kind!=="constant"){var K=W.evaluate({zoom:f-1},s,{},b.availableImages),ie=W.evaluate({zoom:f},s,{},b.availableImages),le=W.evaluate({zoom:f+1},s,{},b.availableImages);K=K&&K.name?K.name:K,ie=ie&&ie.name?ie.name:ie,le=le&&le.name?le.name:le,S[K]=!0,S[ie]=!0,S[le]=!0,s.patterns[U.id]={min:K,mid:ie,max:le}}}return s}$c.deviation=function(t,o,s,f){var b=o&&o.length,S=b?o[0]*s:t.length,M=Math.abs(Ku(t,0,S,s));if(b)for(var L=0,U=o.length;L<U;L++){var W=o[L]*s,K=L<U-1?o[L+1]*s:t.length;M-=Math.abs(Ku(t,W,K,s))}var ie=0;for(L=0;L<f.length;L+=3){var le=f[L]*s,ae=f[L+1]*s,he=f[L+2]*s;ie+=Math.abs((t[le]-t[he])*(t[ae+1]-t[le+1])-(t[le]-t[ae])*(t[he+1]-t[le+1]))}return M===0&&ie===0?0:Math.abs((ie-M)/M)},$c.flatten=function(t){for(var o=t[0][0].length,s={vertices:[],holes:[],dimensions:o},f=0,b=0;b<t.length;b++){for(var S=0;S<t[b].length;S++)for(var M=0;M<o;M++)s.vertices.push(t[b][S][M]);b>0&&(f+=t[b-1].length,s.holes.push(f))}return s},xn.default=ns;var nc=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Q,this.indexArray=new ei,this.indexArray2=new ni,this.programConfigurations=new ce(Ea,t.layers,t.zoom),this.segments=new Lr,this.segments2=new Lr,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};nc.prototype.populate=function(t,o){this.hasPattern=Yc("fill",this.layers,o);for(var s=this.layers[0].layout.get("fill-sort-key"),f=[],b=0,S=t;b<S.length;b+=1){var M=S[b],L=M.feature,U=M.id,W=M.index,K=M.sourceLayerIndex;if(this.layers[0]._featureFilter(new qr(this.zoom),L)){var ie=we(L),le=s?s.evaluate(L,{},o.availableImages):void 0,ae={id:U,properties:L.properties,type:L.type,sourceLayerIndex:K,index:W,geometry:ie,patterns:{},sortKey:le};f.push(ae)}}s&&f.sort(function(St,Ht){return St.sortKey-Ht.sortKey});for(var he=0,Me=f;he<Me.length;he+=1){var ke=Me[he],Ve=ke,Ye=Ve.geometry,He=Ve.index,it=Ve.sourceLayerIndex;if(this.hasPattern){var bt=zd("fill",this.layers,ke,this.zoom,o);this.patternFeatures.push(bt)}else this.addFeature(ke,Ye,He,{});var zt=t[He].feature;o.featureIndex.insert(zt,Ye,He,it,this.index)}},nc.prototype.update=function(t,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,s)},nc.prototype.addFeatures=function(t,o){for(var s=0,f=this.patternFeatures;s<f.length;s+=1){var b=f[s];this.addFeature(b,b.geometry,b.index,o)}},nc.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},nc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},nc.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ea),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},nc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},nc.prototype.addFeature=function(t,o,s,f){for(var b=0,S=Pc(o,500);b<S.length;b+=1){for(var M=S[b],L=0,U=0,W=M;U<W.length;U+=1)L+=W[U].length;for(var K=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),ie=K.vertexLength,le=[],ae=[],he=0,Me=M;he<Me.length;he+=1){var ke=Me[he];if(ke.length!==0){ke!==M[0]&&ae.push(le.length/2);var Ve=this.segments2.prepareSegment(ke.length,this.layoutVertexArray,this.indexArray2),Ye=Ve.vertexLength;this.layoutVertexArray.emplaceBack(ke[0].x,ke[0].y),this.indexArray2.emplaceBack(Ye+ke.length-1,Ye),le.push(ke[0].x),le.push(ke[0].y);for(var He=1;He<ke.length;He++)this.layoutVertexArray.emplaceBack(ke[He].x,ke[He].y),this.indexArray2.emplaceBack(Ye+He-1,Ye+He),le.push(ke[He].x),le.push(ke[He].y);Ve.vertexLength+=ke.length,Ve.primitiveLength+=ke.length}}for(var it=xn(le,ae),bt=0;bt<it.length;bt+=3)this.indexArray.emplaceBack(ie+it[bt],ie+it[bt+1],ie+it[bt+2]);K.vertexLength+=L,K.primitiveLength+=it.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f)},Jt("FillBucket",nc,{omit:["layers","patternFeatures"]});var vm=new p({"fill-sort-key":new Mi(V.layout_fill["fill-sort-key"])}),xm={paint:new p({"fill-antialias":new ai(V.paint_fill["fill-antialias"]),"fill-opacity":new Mi(V.paint_fill["fill-opacity"]),"fill-color":new Mi(V.paint_fill["fill-color"]),"fill-outline-color":new Mi(V.paint_fill["fill-outline-color"]),"fill-translate":new ai(V.paint_fill["fill-translate"]),"fill-translate-anchor":new ai(V.paint_fill["fill-translate-anchor"]),"fill-pattern":new kl(V.paint_fill["fill-pattern"])}),layout:vm},Mf=function(t){function o(s){t.call(this,s,xm)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.recalculate=function(s,f){t.prototype.recalculate.call(this,s,f);var b=this.paint._values["fill-outline-color"];b.value.kind==="constant"&&b.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(s){return new nc(s)},o.prototype.queryRadius=function(){return Lt(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(s,f,b,S,M,L,U){return Ke(Mt(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),L.angle,U),S)},o.prototype.isTileClipped=function(){return!0},o}(y),Pd=O([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Ll=Sh;function Sh(t,o,s,f,b){this.properties={},this.extent=s,this.type=0,this._pbf=t,this._geometry=-1,this._keys=f,this._values=b,t.readFields(bm,this,o)}function bm(t,o,s){t==1?o.id=s.readVarint():t==2?function(f,b){for(var S=f.readVarint()+f.pos;f.pos<S;){var M=b._keys[f.readVarint()],L=b._values[f.readVarint()];b.properties[M]=L}}(s,o):t==3?o.type=s.readVarint():t==4&&(o._geometry=s.pos)}function vo(t){for(var o,s,f=0,b=0,S=t.length,M=S-1;b<S;M=b++)o=t[b],f+=((s=t[M]).x-o.x)*(o.y+s.y);return f}Sh.types=["Unknown","Point","LineString","Polygon"],Sh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,s=t.readVarint()+t.pos,f=1,b=0,S=0,M=0,L=[];t.pos<s;){if(b<=0){var U=t.readVarint();f=7&U,b=U>>3}if(b--,f===1||f===2)S+=t.readSVarint(),M+=t.readSVarint(),f===1&&(o&&L.push(o),o=[]),o.push(new Kt(S,M));else{if(f!==7)throw new Error("unknown command "+f);o&&o.push(o[0].clone())}}return o&&L.push(o),L},Sh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,s=1,f=0,b=0,S=0,M=1/0,L=-1/0,U=1/0,W=-1/0;t.pos<o;){if(f<=0){var K=t.readVarint();s=7&K,f=K>>3}if(f--,s===1||s===2)(b+=t.readSVarint())<M&&(M=b),b>L&&(L=b),(S+=t.readSVarint())<U&&(U=S),S>W&&(W=S);else if(s!==7)throw new Error("unknown command "+s)}return[M,U,L,W]},Sh.prototype.toGeoJSON=function(t,o,s){var f,b,S=this.extent*Math.pow(2,s),M=this.extent*t,L=this.extent*o,U=this.loadGeometry(),W=Sh.types[this.type];function K(ae){for(var he=0;he<ae.length;he++){var Me=ae[he],ke=180-360*(Me.y+L)/S;ae[he]=[360*(Me.x+M)/S-180,360/Math.PI*Math.atan(Math.exp(ke*Math.PI/180))-90]}}switch(this.type){case 1:var ie=[];for(f=0;f<U.length;f++)ie[f]=U[f][0];K(U=ie);break;case 2:for(f=0;f<U.length;f++)K(U[f]);break;case 3:for(U=function(ae){var he=ae.length;if(he<=1)return[ae];for(var Me,ke,Ve=[],Ye=0;Ye<he;Ye++){var He=vo(ae[Ye]);He!==0&&(ke===void 0&&(ke=He<0),ke===He<0?(Me&&Ve.push(Me),Me=[ae[Ye]]):Me.push(ae[Ye]))}return Me&&Ve.push(Me),Ve}(U),f=0;f<U.length;f++)for(b=0;b<U[f].length;b++)K(U[f][b])}U.length===1?U=U[0]:W="Multi"+W;var le={type:"Feature",geometry:{type:W,coordinates:U},properties:this.properties};return"id"in this&&(le.id=this.id),le};var Ci=Jc;function Jc(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Fp,this,o),this.length=this._features.length}function Fp(t,o,s){t===15?o.version=s.readVarint():t===1?o.name=s.readString():t===5?o.extent=s.readVarint():t===2?o._features.push(s.pos):t===3?o._keys.push(s.readString()):t===4&&o._values.push(function(f){for(var b=null,S=f.readVarint()+f.pos;f.pos<S;){var M=f.readVarint()>>3;b=M===1?f.readString():M===2?f.readFloat():M===3?f.readDouble():M===4?f.readVarint64():M===5?f.readVarint():M===6?f.readSVarint():M===7?f.readBoolean():null}return b}(s))}function Zs(t,o,s){if(t===3){var f=new Ci(s,s.readVarint()+s.pos);f.length&&(o[f.name]=f)}}Jc.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Ll(this._pbf,o,this.extent,this._keys,this._values)};var Yu={VectorTile:function(t,o){this.layers=t.readFields(Zs,{},o)},VectorTileFeature:Ll,VectorTileLayer:Ci},Cf=Yu.VectorTileFeature.types,pl=Math.pow(2,13);function Ju(t,o,s,f,b,S,M,L){t.emplaceBack(o,s,2*Math.floor(f*pl)+M,b*pl*2,S*pl*2,Math.round(L))}var Oa=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new _e,this.indexArray=new ei,this.programConfigurations=new ce(Pd,t.layers,t.zoom),this.segments=new Lr,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function pp(t,o){return t.x===o.x&&(t.x<0||t.x>de)||t.y===o.y&&(t.y<0||t.y>de)}function Qu(t){return t.every(function(o){return o.x<0})||t.every(function(o){return o.x>de})||t.every(function(o){return o.y<0})||t.every(function(o){return o.y>de})}Oa.prototype.populate=function(t,o){this.features=[],this.hasPattern=Yc("fill-extrusion",this.layers,o);for(var s=0,f=t;s<f.length;s+=1){var b=f[s],S=b.feature,M=b.id,L=b.index,U=b.sourceLayerIndex;if(this.layers[0]._featureFilter(new qr(this.zoom),S)){var W=we(S),K={id:M,sourceLayerIndex:U,index:L,geometry:W,properties:S.properties,type:S.type,patterns:{}};S.id!==void 0&&(K.id=S.id),this.hasPattern?this.features.push(zd("fill-extrusion",this.layers,K,this.zoom,o)):this.addFeature(K,W,L,{}),o.featureIndex.insert(S,W,L,U,this.index,!0)}}},Oa.prototype.addFeatures=function(t,o){for(var s=0,f=this.features;s<f.length;s+=1){var b=f[s],S=b.geometry;this.addFeature(b,S,b.index,o)}},Oa.prototype.update=function(t,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,s)},Oa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Oa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Oa.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Pd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Oa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Oa.prototype.addFeature=function(t,o,s,f){for(var b=0,S=Pc(o,500);b<S.length;b+=1){for(var M=S[b],L=0,U=0,W=M;U<W.length;U+=1)L+=W[U].length;for(var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ie=0,le=M;ie<le.length;ie+=1){var ae=le[ie];if(ae.length!==0&&!Qu(ae))for(var he=0,Me=0;Me<ae.length;Me++){var ke=ae[Me];if(Me>=1){var Ve=ae[Me-1];if(!pp(ke,Ve)){K.vertexLength+4>Lr.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ye=ke.sub(Ve)._perp()._unit(),He=Ve.dist(ke);he+He>32768&&(he=0),Ju(this.layoutVertexArray,ke.x,ke.y,Ye.x,Ye.y,0,0,he),Ju(this.layoutVertexArray,ke.x,ke.y,Ye.x,Ye.y,0,1,he),he+=He,Ju(this.layoutVertexArray,Ve.x,Ve.y,Ye.x,Ye.y,0,0,he),Ju(this.layoutVertexArray,Ve.x,Ve.y,Ye.x,Ye.y,0,1,he);var it=K.vertexLength;this.indexArray.emplaceBack(it,it+2,it+1),this.indexArray.emplaceBack(it+1,it+2,it+3),K.vertexLength+=4,K.primitiveLength+=2}}}}if(K.vertexLength+L>Lr.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),Cf[t.type]==="Polygon"){for(var bt=[],zt=[],St=K.vertexLength,Ht=0,vi=M;Ht<vi.length;Ht+=1){var hi=vi[Ht];if(hi.length!==0){hi!==M[0]&&zt.push(bt.length/2);for(var bi=0;bi<hi.length;bi++){var pi=hi[bi];Ju(this.layoutVertexArray,pi.x,pi.y,0,0,1,1,0),bt.push(pi.x),bt.push(pi.y)}}}for(var si=xn(bt,zt),Qt=0;Qt<si.length;Qt+=3)this.indexArray.emplaceBack(St+si[Qt],St+si[Qt+2],St+si[Qt+1]);K.primitiveLength+=si.length/3,K.vertexLength+=L}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f)},Jt("FillExtrusionBucket",Oa,{omit:["layers","features"]});var kd={paint:new p({"fill-extrusion-opacity":new ai(V["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mi(V["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ai(V["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ai(V["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kl(V["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mi(V["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mi(V["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ai(V["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Op=function(t){function o(s){t.call(this,s,kd)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.createBucket=function(s){return new Oa(s)},o.prototype.queryRadius=function(){return Lt(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(s,f,b,S,M,L,U,W){var K=Mt(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),L.angle,U),ie=this.paint.get("fill-extrusion-height").evaluate(f,b),le=this.paint.get("fill-extrusion-base").evaluate(f,b),ae=function(Me,ke,Ve,Ye){for(var He=[],it=0,bt=Me;it<bt.length;it+=1){var zt=bt[it],St=[zt.x,zt.y,Ye,1];ur(St,St,ke),He.push(new Kt(St[0]/St[3],St[1]/St[3]))}return He}(K,W,0,0),he=function(Me,ke,Ve,Ye){for(var He=[],it=[],bt=Ye[8]*ke,zt=Ye[9]*ke,St=Ye[10]*ke,Ht=Ye[11]*ke,vi=Ye[8]*Ve,hi=Ye[9]*Ve,bi=Ye[10]*Ve,pi=Ye[11]*Ve,si=0,Qt=Me;si<Qt.length;si+=1){for(var br=Qt[si],Br=[],Sr=[],er=0,Yr=br;er<Yr.length;er+=1){var Cr=Yr[er],mr=Cr.x,Ir=Cr.y,Jr=Ye[0]*mr+Ye[4]*Ir+Ye[12],ao=Ye[1]*mr+Ye[5]*Ir+Ye[13],Yn=Ye[2]*mr+Ye[6]*Ir+Ye[14],pa=Ye[3]*mr+Ye[7]*Ir+Ye[15],da=Yn+St,Nn=pa+Ht,so=Jr+vi,jo=ao+hi,wo=Yn+bi,To=pa+pi,Dn=new Kt((Jr+bt)/Nn,(ao+zt)/Nn);Dn.z=da/Nn,Br.push(Dn);var Jn=new Kt(so/To,jo/To);Jn.z=wo/To,Sr.push(Jn)}He.push(Br),it.push(Sr)}return[He,it]}(S,le,ie,W);return function(Me,ke,Ve){var Ye=1/0;Ke(Ve,ke)&&(Ye=Dd(Ve,ke[0]));for(var He=0;He<ke.length;He++)for(var it=ke[He],bt=Me[He],zt=0;zt<it.length-1;zt++){var St=it[zt],Ht=it[zt+1],vi=bt[zt],hi=bt[zt+1],bi=[St,Ht,hi,vi,St];qe(Ve,bi)&&(Ye=Math.min(Ye,Dd(Ve,bi)))}return Ye!==1/0&&Ye}(he[0],he[1],ae)},o}(y);function Ih(t,o){return t.x*o.x+t.y*o.y}function Dd(t,o){if(t.length===1){for(var s,f,b=0,S=o[b++];!s||S.equals(s);)if(!(s=o[b++]))return 1/0;for(;!f||S.equals(f)||s.equals(f);)if(!(f=o[b++]))return 1/0;var M=t[0],L=s.sub(S),U=f.sub(S),W=M.sub(S),K=Ih(L,L),ie=Ih(L,U),le=Ih(U,U),ae=Ih(W,L),he=Ih(W,U),Me=K*le-ie*ie,ke=(le*ae-ie*he)/Me,Ve=(K*he-ie*ae)/Me,Ye=1-ke-Ve;return S.z*Ye+s.z*ke+f.z*Ve}for(var He=1/0,it=0,bt=o;it<bt.length;it+=1){var zt=bt[it];He=Math.min(He,zt.z)}return He}var zf=O([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ld=Yu.VectorTileFeature.types,Pf=Math.cos(Math.PI/180*37.5),Ah=Math.pow(2,14)/.5,Oo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Se,this.indexArray=new ei,this.programConfigurations=new ce(zf,t.layers,t.zoom),this.segments=new Lr,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Oo.prototype.populate=function(t,o){this.hasPattern=Yc("line",this.layers,o);for(var s=this.layers[0].layout.get("line-sort-key"),f=[],b=0,S=t;b<S.length;b+=1){var M=S[b],L=M.feature,U=M.id,W=M.index,K=M.sourceLayerIndex;if(this.layers[0]._featureFilter(new qr(this.zoom),L)){var ie=we(L),le=s?s.evaluate(L,{}):void 0,ae={id:U,properties:L.properties,type:L.type,sourceLayerIndex:K,index:W,geometry:ie,patterns:{},sortKey:le};f.push(ae)}}s&&f.sort(function(St,Ht){return St.sortKey-Ht.sortKey});for(var he=0,Me=f;he<Me.length;he+=1){var ke=Me[he],Ve=ke,Ye=Ve.geometry,He=Ve.index,it=Ve.sourceLayerIndex;if(this.hasPattern){var bt=zd("line",this.layers,ke,this.zoom,o);this.patternFeatures.push(bt)}else this.addFeature(ke,Ye,He,{});var zt=t[He].feature;o.featureIndex.insert(zt,Ye,He,it,this.index)}},Oo.prototype.update=function(t,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,s)},Oo.prototype.addFeatures=function(t,o){for(var s=0,f=this.patternFeatures;s<f.length;s+=1){var b=f[s];this.addFeature(b,b.geometry,b.index,o)}},Oo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Oo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Oo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Oo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Oo.prototype.addFeature=function(t,o,s,f){for(var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),M=b.get("line-cap"),L=b.get("line-miter-limit"),U=b.get("line-round-limit"),W=0,K=o;W<K.length;W+=1){var ie=K[W];this.addLine(ie,t,S,M,L,U,s,f)}},Oo.prototype.addLine=function(t,o,s,f,b,S,M,L){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end")){this.clipStart=+o.properties.mapbox_clip_start,this.clipEnd=+o.properties.mapbox_clip_end;for(var U=0;U<t.length-1;U++)this.totalDistance+=t[U].dist(t[U+1]);this.updateScaledDistance()}for(var W=Ld[o.type]==="Polygon",K=t.length;K>=2&&t[K-1].equals(t[K-2]);)K--;for(var ie=0;ie<K-1&&t[ie].equals(t[ie+1]);)ie++;if(!(K<(W?3:2))){s==="bevel"&&(b=1.05);var le,ae=this.overscaling<=16?15*de/(512*this.overscaling):0,he=this.segments.prepareSegment(10*K,this.layoutVertexArray,this.indexArray),Me=void 0,ke=void 0,Ve=void 0,Ye=void 0;this.e1=this.e2=-1,W&&(le=t[K-2],Ye=t[ie].sub(le)._unit()._perp());for(var He=ie;He<K;He++)if(!(ke=He===K-1?W?t[ie+1]:void 0:t[He+1])||!t[He].equals(ke)){Ye&&(Ve=Ye),le&&(Me=le),le=t[He],Ye=ke?ke.sub(le)._unit()._perp():Ve;var it=(Ve=Ve||Ye).add(Ye);it.x===0&&it.y===0||it._unit();var bt=Ve.x*Ye.x+Ve.y*Ye.y,zt=it.x*Ye.x+it.y*Ye.y,St=zt!==0?1/zt:1/0,Ht=2*Math.sqrt(2-2*zt),vi=zt<Pf&&Me&&ke,hi=Ve.x*Ye.y-Ve.y*Ye.x>0;if(vi&&He>ie){var bi=le.dist(Me);if(bi>2*ae){var pi=le.sub(le.sub(Me)._mult(ae/bi)._round());this.updateDistance(Me,pi),this.addCurrentVertex(pi,Ve,0,0,he),Me=pi}}var si=Me&&ke,Qt=si?s:W?"butt":f;if(si&&Qt==="round"&&(St<S?Qt="miter":St<=2&&(Qt="fakeround")),Qt==="miter"&&St>b&&(Qt="bevel"),Qt==="bevel"&&(St>2&&(Qt="flipbevel"),St<b&&(Qt="miter")),Me&&this.updateDistance(Me,le),Qt==="miter")it._mult(St),this.addCurrentVertex(le,it,0,0,he);else if(Qt==="flipbevel"){if(St>100)it=Ye.mult(-1);else{var br=St*Ve.add(Ye).mag()/Ve.sub(Ye).mag();it._perp()._mult(br*(hi?-1:1))}this.addCurrentVertex(le,it,0,0,he),this.addCurrentVertex(le,it.mult(-1),0,0,he)}else if(Qt==="bevel"||Qt==="fakeround"){var Br=-Math.sqrt(St*St-1),Sr=hi?Br:0,er=hi?0:Br;if(Me&&this.addCurrentVertex(le,Ve,Sr,er,he),Qt==="fakeround")for(var Yr=Math.round(180*Ht/Math.PI/20),Cr=1;Cr<Yr;Cr++){var mr=Cr/Yr;if(mr!==.5){var Ir=mr-.5;mr+=mr*Ir*(mr-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*Ir*Ir+(.848013+bt*(.215638*bt-1.06021)))}var Jr=Ye.sub(Ve)._mult(mr)._add(Ve)._unit()._mult(hi?-1:1);this.addHalfVertex(le,Jr.x,Jr.y,!1,hi,0,he)}ke&&this.addCurrentVertex(le,Ye,-Sr,-er,he)}else if(Qt==="butt")this.addCurrentVertex(le,it,0,0,he);else if(Qt==="square"){var ao=Me?1:-1;this.addCurrentVertex(le,it,ao,ao,he)}else Qt==="round"&&(Me&&(this.addCurrentVertex(le,Ve,0,0,he),this.addCurrentVertex(le,Ve,1,1,he,!0)),ke&&(this.addCurrentVertex(le,Ye,-1,-1,he,!0),this.addCurrentVertex(le,Ye,0,0,he)));if(vi&&He<K-1){var Yn=le.dist(ke);if(Yn>2*ae){var pa=le.add(ke.sub(le)._mult(ae/Yn)._round());this.updateDistance(le,pa),this.addCurrentVertex(pa,Ye,0,0,he),le=pa}}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,M,L)}},Oo.prototype.addCurrentVertex=function(t,o,s,f,b,S){S===void 0&&(S=!1);var M=o.x+o.y*s,L=o.y-o.x*s,U=-o.x+o.y*f,W=-o.y-o.x*f;this.addHalfVertex(t,M,L,S,!1,s,b),this.addHalfVertex(t,U,W,S,!0,-f,b),this.distance>Ah/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,s,f,b,S))},Oo.prototype.addHalfVertex=function(t,o,s,f,b,S,M){var L=t.x,U=t.y,W=.5*this.scaledDistance;this.layoutVertexArray.emplaceBack((L<<1)+(f?1:0),(U<<1)+(b?1:0),Math.round(63*o)+128,Math.round(63*s)+128,1+(S===0?0:S<0?-1:1)|(63&W)<<2,W>>6);var K=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,K),M.primitiveLength++),b?this.e2=K:this.e1=K},Oo.prototype.updateScaledDistance=function(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Ah-1):this.distance},Oo.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},Jt("LineBucket",Oo,{omit:["layers","patternFeatures"]});var Qc=new p({"line-cap":new ai(V.layout_line["line-cap"]),"line-join":new Mi(V.layout_line["line-join"]),"line-miter-limit":new ai(V.layout_line["line-miter-limit"]),"line-round-limit":new ai(V.layout_line["line-round-limit"]),"line-sort-key":new Mi(V.layout_line["line-sort-key"])}),Up={paint:new p({"line-opacity":new Mi(V.paint_line["line-opacity"]),"line-color":new Mi(V.paint_line["line-color"]),"line-translate":new ai(V.paint_line["line-translate"]),"line-translate-anchor":new ai(V.paint_line["line-translate-anchor"]),"line-width":new Mi(V.paint_line["line-width"]),"line-gap-width":new Mi(V.paint_line["line-gap-width"]),"line-offset":new Mi(V.paint_line["line-offset"]),"line-blur":new Mi(V.paint_line["line-blur"]),"line-dasharray":new h(V.paint_line["line-dasharray"]),"line-pattern":new kl(V.paint_line["line-pattern"]),"line-gradient":new d(V.paint_line["line-gradient"])}),layout:Qc},Rd=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.possiblyEvaluate=function(s,f){return f=new qr(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),t.prototype.possiblyEvaluate.call(this,s,f)},o.prototype.evaluate=function(s,f,b,S){return f=tr({},f,{zoom:Math.floor(f.zoom)}),t.prototype.evaluate.call(this,s,f,b,S)},o}(Mi))(Up.paint.properties["line-width"].specification);Rd.useIntegerZoom=!0;var dp=function(t){function o(s){t.call(this,s,Up)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&this._updateGradient()},o.prototype._updateGradient=function(){var s=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=Pn(s,"lineProgress"),this.gradientTexture=null},o.prototype.recalculate=function(s,f){t.prototype.recalculate.call(this,s,f),this.paint._values["line-floorwidth"]=Rd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},o.prototype.createBucket=function(s){return new Oo(s)},o.prototype.queryRadius=function(s){var f=s,b=Mh(xt("line-width",this,f),xt("line-gap-width",this,f)),S=xt("line-offset",this,f);return b/2+Math.abs(S)+Lt(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(s,f,b,S,M,L,U){var W=Mt(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),L.angle,U),K=U/2*Mh(this.paint.get("line-width").evaluate(f,b),this.paint.get("line-gap-width").evaluate(f,b)),ie=this.paint.get("line-offset").evaluate(f,b);return ie&&(S=function(le,ae){for(var he=[],Me=new Kt(0,0),ke=0;ke<le.length;ke++){for(var Ve=le[ke],Ye=[],He=0;He<Ve.length;He++){var it=Ve[He-1],bt=Ve[He],zt=Ve[He+1],St=He===0?Me:bt.sub(it)._unit()._perp(),Ht=He===Ve.length-1?Me:zt.sub(bt)._unit()._perp(),vi=St._add(Ht)._unit(),hi=vi.x*Ht.x+vi.y*Ht.y;vi._mult(1/hi),Ye.push(vi._mult(ae)._add(bt))}he.push(Ye)}return he}(S,ie*U)),function(le,ae,he){for(var Me=0;Me<ae.length;Me++){var ke=ae[Me];if(le.length>=3){for(var Ve=0;Ve<ke.length;Ve++)if(kt(le,ke[Ve]))return!0}if($e(le,ke,he))return!0}return!1}(W,S,K)},o.prototype.isTileClipped=function(){return!0},o}(y);function Mh(t,o){return o>0?o+2*t:t}var Es=O([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fp=O([{name:"a_projected_pos",components:3,type:"Float32"}],4),os=(O([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),O([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),dl=(O([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),O([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Vp=O([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);O([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),O([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"}]),O([{type:"Float32",name:"offsetX"}]),O([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);function po(t,o,s){return t.sections.forEach(function(f){f.text=function(b,S,M){var L=S.layout.get("text-transform").evaluate(M,{});return L==="uppercase"?b=b.toLocaleUpperCase():L==="lowercase"&&(b=b.toLocaleLowerCase()),Bo.applyArabicShaping&&(b=Bo.applyArabicShaping(b)),b}(f.text,o,s)}),t}var Ch={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},xo=24,Rl=function(t,o,s,f,b){var S,M,L=8*b-f-1,U=(1<<L)-1,W=U>>1,K=-7,ie=s?b-1:0,le=s?-1:1,ae=t[o+ie];for(ie+=le,S=ae&(1<<-K)-1,ae>>=-K,K+=L;K>0;S=256*S+t[o+ie],ie+=le,K-=8);for(M=S&(1<<-K)-1,S>>=-K,K+=f;K>0;M=256*M+t[o+ie],ie+=le,K-=8);if(S===0)S=1-W;else{if(S===U)return M?NaN:1/0*(ae?-1:1);M+=Math.pow(2,f),S-=W}return(ae?-1:1)*M*Math.pow(2,S-f)},kf=function(t,o,s,f,b,S){var M,L,U,W=8*S-b-1,K=(1<<W)-1,ie=K>>1,le=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,ae=f?0:S-1,he=f?1:-1,Me=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(L=isNaN(o)?1:0,M=K):(M=Math.floor(Math.log(o)/Math.LN2),o*(U=Math.pow(2,-M))<1&&(M--,U*=2),(o+=M+ie>=1?le/U:le*Math.pow(2,1-ie))*U>=2&&(M++,U/=2),M+ie>=K?(L=0,M=K):M+ie>=1?(L=(o*U-1)*Math.pow(2,b),M+=ie):(L=o*Math.pow(2,ie-1)*Math.pow(2,b),M=0));b>=8;t[s+ae]=255&L,ae+=he,L/=256,b-=8);for(M=M<<b|L,W+=b;W>0;t[s+ae]=255&M,ae+=he,M/=256,W-=8);t[s+ae-he]|=128*Me},Np=mn;function mn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}mn.Varint=0,mn.Fixed64=1,mn.Bytes=2,mn.Fixed32=5;var Bd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ss(t){return t.type===mn.Bytes?t.readVarint()+t.pos:t.pos+1}function eh(t,o,s){return s?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function Fd(t,o,s){var f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));s.realloc(f);for(var b=s.pos-1;b>=t;b--)s.buf[b+f]=s.buf[b]}function Df(t,o){for(var s=0;s<t.length;s++)o.writeVarint(t[s])}function Lf(t,o){for(var s=0;s<t.length;s++)o.writeSVarint(t[s])}function wm(t,o){for(var s=0;s<t.length;s++)o.writeFloat(t[s])}function Tm(t,o){for(var s=0;s<t.length;s++)o.writeDouble(t[s])}function Rf(t,o){for(var s=0;s<t.length;s++)o.writeBoolean(t[s])}function Bf(t,o){for(var s=0;s<t.length;s++)o.writeFixed32(t[s])}function mp(t,o){for(var s=0;s<t.length;s++)o.writeSFixed32(t[s])}function Od(t,o){for(var s=0;s<t.length;s++)o.writeFixed64(t[s])}function Ud(t,o){for(var s=0;s<t.length;s++)o.writeSFixed64(t[s])}function zh(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function Uo(t,o,s){t[s]=o,t[s+1]=o>>>8,t[s+2]=o>>>16,t[s+3]=o>>>24}function jp(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}mn.prototype={destroy:function(){this.buf=null},readFields:function(t,o,s){for(s=s||this.length;this.pos<s;){var f=this.readVarint(),b=f>>3,S=this.pos;this.type=7&f,t(b,o,this),this.pos===S&&this.skip(f)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=zh(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=jp(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=zh(this.buf,this.pos)+4294967296*zh(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=zh(this.buf,this.pos)+4294967296*jp(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Rl(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Rl(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,s,f=this.buf;return o=127&(s=f[this.pos++]),s<128?o:(o|=(127&(s=f[this.pos++]))<<7,s<128?o:(o|=(127&(s=f[this.pos++]))<<14,s<128?o:(o|=(127&(s=f[this.pos++]))<<21,s<128?o:function(b,S,M){var L,U,W=M.buf;if(U=W[M.pos++],L=(112&U)>>4,U<128||(U=W[M.pos++],L|=(127&U)<<3,U<128)||(U=W[M.pos++],L|=(127&U)<<10,U<128)||(U=W[M.pos++],L|=(127&U)<<17,U<128)||(U=W[M.pos++],L|=(127&U)<<24,U<128)||(U=W[M.pos++],L|=(1&U)<<31,U<128))return eh(b,L,S);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(s=f[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&Bd?function(s,f,b){return Bd.decode(s.subarray(f,b))}(this.buf,o,t):function(s,f,b){for(var S="",M=f;M<b;){var L,U,W,K=s[M],ie=null,le=K>239?4:K>223?3:K>191?2:1;if(M+le>b)break;le===1?K<128&&(ie=K):le===2?(192&(L=s[M+1]))==128&&(ie=(31&K)<<6|63&L)<=127&&(ie=null):le===3?(L=s[M+1],U=s[M+2],(192&L)==128&&(192&U)==128&&((ie=(15&K)<<12|(63&L)<<6|63&U)<=2047||ie>=55296&&ie<=57343)&&(ie=null)):le===4&&(L=s[M+1],U=s[M+2],W=s[M+3],(192&L)==128&&(192&U)==128&&(192&W)==128&&((ie=(15&K)<<18|(63&L)<<12|(63&U)<<6|63&W)<=65535||ie>=1114112)&&(ie=null)),ie===null?(ie=65533,le=1):ie>65535&&(ie-=65536,S+=String.fromCharCode(ie>>>10&1023|55296),ie=56320|1023&ie),S+=String.fromCharCode(ie),M+=le}return S}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==mn.Bytes)return t.push(this.readVarint(o));var s=Ss(this);for(t=t||[];this.pos<s;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==mn.Bytes)return t.push(this.readSVarint());var o=Ss(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==mn.Bytes)return t.push(this.readBoolean());var o=Ss(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==mn.Bytes)return t.push(this.readFloat());var o=Ss(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==mn.Bytes)return t.push(this.readDouble());var o=Ss(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==mn.Bytes)return t.push(this.readFixed32());var o=Ss(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==mn.Bytes)return t.push(this.readSFixed32());var o=Ss(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==mn.Bytes)return t.push(this.readFixed64());var o=Ss(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==mn.Bytes)return t.push(this.readSFixed64());var o=Ss(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===mn.Varint)for(;this.buf[this.pos++]>127;);else if(o===mn.Bytes)this.pos=this.readVarint()+this.pos;else if(o===mn.Fixed32)this.pos+=4;else{if(o!==mn.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var s=new Uint8Array(o);s.set(this.buf),this.buf=s,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Uo(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Uo(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Uo(this.buf,-1&t,this.pos),Uo(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Uo(this.buf,-1&t,this.pos),Uo(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,s){var f,b;if(o>=0?(f=o%4294967296|0,b=o/4294967296|0):(b=~(-o/4294967296),4294967295^(f=~(-o%4294967296))?f=f+1|0:(f=0,b=b+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(S,M,L){L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos]=127&S}(f,0,s),function(S,M){var L=(7&S)<<4;M.buf[M.pos++]|=L|((S>>>=3)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S)))))}(b,s)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(f,b,S){for(var M,L,U=0;U<b.length;U++){if((M=b.charCodeAt(U))>55295&&M<57344){if(!L){M>56319||U+1===b.length?(f[S++]=239,f[S++]=191,f[S++]=189):L=M;continue}if(M<56320){f[S++]=239,f[S++]=191,f[S++]=189,L=M;continue}M=L-55296<<10|M-56320|65536,L=null}else L&&(f[S++]=239,f[S++]=191,f[S++]=189,L=null);M<128?f[S++]=M:(M<2048?f[S++]=M>>6|192:(M<65536?f[S++]=M>>12|224:(f[S++]=M>>18|240,f[S++]=M>>12&63|128),f[S++]=M>>6&63|128),f[S++]=63&M|128)}return S}(this.buf,t,this.pos);var s=this.pos-o;s>=128&&Fd(o,s,this),this.pos=o-1,this.writeVarint(s),this.pos+=s},writeFloat:function(t){this.realloc(4),kf(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),kf(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var s=0;s<o;s++)this.buf[this.pos++]=t[s]},writeRawMessage:function(t,o){this.pos++;var s=this.pos;t(o,this);var f=this.pos-s;f>=128&&Fd(s,f,this),this.pos=s-1,this.writeVarint(f),this.pos+=f},writeMessage:function(t,o,s){this.writeTag(t,mn.Bytes),this.writeRawMessage(o,s)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Df,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,Lf,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Rf,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,wm,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Tm,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,Bf,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,mp,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,Od,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,Ud,o)},writeBytesField:function(t,o){this.writeTag(t,mn.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,mn.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,mn.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,mn.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,mn.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,mn.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,mn.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,mn.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,mn.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,mn.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,!!o)}};var qp=3;function kc(t,o,s){t===1&&s.readMessage(Em,o)}function Em(t,o,s){if(t===3){var f=s.readMessage(th,{}),b=f.id,S=f.bitmap,M=f.width,L=f.height,U=f.left,W=f.top,K=f.advance;o.push({id:b,bitmap:new Hn({width:M+2*qp,height:L+2*qp},S),metrics:{width:M,height:L,left:U,top:W,advance:K}})}}function th(t,o,s){t===1?o.id=s.readVarint():t===2?o.bitmap=s.readBytes():t===3?o.width=s.readVarint():t===4?o.height=s.readVarint():t===5?o.left=s.readSVarint():t===6?o.top=s.readSVarint():t===7&&(o.advance=s.readVarint())}var Ph=qp;function fl(t){for(var o=0,s=0,f=0,b=t;f<b.length;f+=1){var S=b[f];o+=S.w*S.h,s=Math.max(s,S.w)}t.sort(function(Me,ke){return ke.h-Me.h});for(var M=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),s),h:1/0}],L=0,U=0,W=0,K=t;W<K.length;W+=1)for(var ie=K[W],le=M.length-1;le>=0;le--){var ae=M[le];if(!(ie.w>ae.w||ie.h>ae.h)){if(ie.x=ae.x,ie.y=ae.y,U=Math.max(U,ie.y+ie.h),L=Math.max(L,ie.x+ie.w),ie.w===ae.w&&ie.h===ae.h){var he=M.pop();le<M.length&&(M[le]=he)}else ie.h===ae.h?(ae.x+=ie.w,ae.w-=ie.w):ie.w===ae.w?(ae.y+=ie.h,ae.h-=ie.h):(M.push({x:ae.x+ie.w,y:ae.y,w:ae.w-ie.w,h:ie.h}),ae.y+=ie.h,ae.h-=ie.h);break}}return{w:L,h:U,fill:o/(L*U)||0}}var Kn=1,Gp=function(t,o){var s=o.pixelRatio,f=o.version,b=o.stretchX,S=o.stretchY,M=o.content;this.paddedRect=t,this.pixelRatio=s,this.stretchX=b,this.stretchY=S,this.content=M,this.version=f},vu={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};vu.tl.get=function(){return[this.paddedRect.x+Kn,this.paddedRect.y+Kn]},vu.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-Kn,this.paddedRect.y+this.paddedRect.h-Kn]},vu.tlbr.get=function(){return this.tl.concat(this.br)},vu.displaySize.get=function(){return[(this.paddedRect.w-2*Kn)/this.pixelRatio,(this.paddedRect.h-2*Kn)/this.pixelRatio]},Object.defineProperties(Gp.prototype,vu);var kh=function(t,o){var s={},f={};this.haveRenderCallbacks=[];var b=[];this.addImages(t,s,b),this.addImages(o,f,b);var S=fl(b),M=S.w,L=S.h,U=new zn({width:M||1,height:L||1});for(var W in t){var K=t[W],ie=s[W].paddedRect;zn.copy(K.data,U,{x:0,y:0},{x:ie.x+Kn,y:ie.y+Kn},K.data)}for(var le in o){var ae=o[le],he=f[le].paddedRect,Me=he.x+Kn,ke=he.y+Kn,Ve=ae.data.width,Ye=ae.data.height;zn.copy(ae.data,U,{x:0,y:0},{x:Me,y:ke},ae.data),zn.copy(ae.data,U,{x:0,y:Ye-1},{x:Me,y:ke-1},{width:Ve,height:1}),zn.copy(ae.data,U,{x:0,y:0},{x:Me,y:ke+Ye},{width:Ve,height:1}),zn.copy(ae.data,U,{x:Ve-1,y:0},{x:Me-1,y:ke},{width:1,height:Ye}),zn.copy(ae.data,U,{x:0,y:0},{x:Me+Ve,y:ke},{width:1,height:Ye})}this.image=U,this.iconPositions=s,this.patternPositions=f};kh.prototype.addImages=function(t,o,s){for(var f in t){var b=t[f],S={x:0,y:0,w:b.data.width+2*Kn,h:b.data.height+2*Kn};s.push(S),o[f]=new Gp(S,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},kh.prototype.patchUpdatedImages=function(t,o){for(var s in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),o),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),o)},kh.prototype.patchUpdatedImage=function(t,o,s){if(t&&o&&t.version!==o.version){t.version=o.version;var f=t.tl,b=f[0],S=f[1];s.update(o.data,void 0,{x:b,y:S})}},Jt("ImagePosition",Gp),Jt("ImageAtlas",kh);var Xs={horizontal:1,vertical:2,horizontalOnly:3},ih=-17,Is=function(){this.scale=1,this.fontStack="",this.imageName=null};Is.forText=function(t,o){var s=new Is;return s.scale=t||1,s.fontStack=o,s},Is.forImage=function(t){var o=new Is;return o.imageName=t,o};var fo=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function _p(t,o,s,f,b,S,M,L,U,W,K,ie,le,ae,he,Me){var ke,Ve=fo.fromFeature(t,b);ie===Xs.vertical&&Ve.verticalizePunctuation();var Ye=Bo.processBidirectionalText,He=Bo.processStyledBidirectionalText;if(Ye&&Ve.sections.length===1){ke=[];for(var it=0,bt=Ye(Ve.toString(),nh(Ve,W,S,o,f,ae,he));it<bt.length;it+=1){var zt=bt[it],St=new fo;St.text=zt,St.sections=Ve.sections;for(var Ht=0;Ht<zt.length;Ht++)St.sectionIndex.push(0);ke.push(St)}}else if(He){ke=[];for(var vi=0,hi=He(Ve.text,Ve.sectionIndex,nh(Ve,W,S,o,f,ae,he));vi<hi.length;vi+=1){var bi=hi[vi],pi=new fo;pi.text=bi[0],pi.sectionIndex=bi[1],pi.sections=Ve.sections,ke.push(pi)}}else ke=function(br,Br){for(var Sr=[],er=br.text,Yr=0,Cr=0,mr=Br;Cr<mr.length;Cr+=1){var Ir=mr[Cr];Sr.push(br.substring(Yr,Ir)),Yr=Ir}return Yr<er.length&&Sr.push(br.substring(Yr,er.length)),Sr}(Ve,nh(Ve,W,S,o,f,ae,he));var si=[],Qt={positionedLines:si,text:Ve.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:ie,iconsInText:!1,verticalizable:!1};return function(br,Br,Sr,er,Yr,Cr,mr,Ir,Jr,ao,Yn,pa){for(var da=0,Nn=ih,so=0,jo=0,wo=Ir==="right"?1:Ir==="left"?0:.5,To=0,Dn=0,Jn=Yr;Dn<Jn.length;Dn+=1){var Er=Jn[Dn];Er.trim();var Zr=Er.getMaxScale(),gn=(Zr-1)*xo,yn={positionedGlyphs:[],lineOffset:0};br.positionedLines[To]=yn;var Eo=yn.positionedGlyphs,cn=0;if(Er.length()){for(var Qo=0;Qo<Er.length();Qo++){var jn=Er.getSection(Qo),Ws=Er.getSectionIndex(Qo),ea=Er.getCharCode(Qo),un=0,Ua=null,Qn=null,ls=null,ac=xo,Ul=!(Jr===Xs.horizontal||!Yn&&!Ra(ea)||Yn&&(gp[ea]||(nu=ea,Yt.Arabic(nu)||Yt["Arabic Supplement"](nu)||Yt["Arabic Extended-A"](nu)||Yt["Arabic Presentation Forms-A"](nu)||Yt["Arabic Presentation Forms-B"](nu))));if(jn.imageName){var bp=er[jn.imageName];if(!bp)continue;ls=jn.imageName,br.iconsInText=br.iconsInText||!0,Qn=bp.paddedRect;var Lc=bp.displaySize;jn.scale=jn.scale*xo/pa,Ua={width:Lc[0],height:Lc[1],left:Kn,top:-Ph,advance:Ul?Lc[1]:Lc[0]};var Jd=xo-Lc[1]*jn.scale;un=gn+Jd,ac=Ua.advance;var Nh=Ul?Lc[0]*jn.scale-xo*Zr:Lc[1]*jn.scale-xo*Zr;Nh>0&&Nh>cn&&(cn=Nh)}else{var od=Sr[jn.fontStack],jh=od&&od[ea];if(jh&&jh.rect)Qn=jh.rect,Ua=jh.metrics;else{var Au=Br[jn.fontStack],ad=Au&&Au[ea];if(!ad)continue;Ua=ad.metrics}un=(Zr-jn.scale)*xo}Ul?(br.verticalizable=!0,Eo.push({glyph:ea,imageName:ls,x:da,y:Nn+un,vertical:Ul,scale:jn.scale,fontStack:jn.fontStack,sectionIndex:Ws,metrics:Ua,rect:Qn}),da+=ac*jn.scale+ao):(Eo.push({glyph:ea,imageName:ls,x:da,y:Nn+un,vertical:Ul,scale:jn.scale,fontStack:jn.fontStack,sectionIndex:Ws,metrics:Ua,rect:Qn}),da+=Ua.advance*jn.scale+ao)}if(Eo.length!==0){var sd=da-ao;so=Math.max(sd,so),Ff(Eo,0,Eo.length-1,wo,cn)}da=0;var qh=Cr*Zr+cn;yn.lineOffset=Math.max(cn,gn),Nn+=qh,jo=Math.max(qh,jo),++To}else Nn+=Cr,++To}var nu,ch=Nn-ih,Mu=Lh(mr),Gh=Mu.horizontalAlign,wp=Mu.verticalAlign;(function(ld,cd,Tp,So,$s,Zh,ou,au,Ep){var ud=(cd-Tp)*$s,Rc=0;Rc=Zh!==ou?-au*So-ih:(-So*Ep+.5)*ou;for(var Xh=0,Sp=ld;Xh<Sp.length;Xh+=1)for(var Ip=Sp[Xh],Cu=0,Wh=Ip.positionedGlyphs;Cu<Wh.length;Cu+=1){var Xr=Wh[Cu];Xr.x+=ud,Xr.y+=Rc}})(br.positionedLines,wo,Gh,wp,so,jo,Cr,ch,Yr.length),br.top+=-wp*ch,br.bottom=br.top+ch,br.left+=-Gh*so,br.right=br.left+so}(Qt,o,s,f,ke,M,L,U,ie,W,le,Me),!function(br){for(var Br=0,Sr=br;Br<Sr.length;Br+=1)if(Sr[Br].positionedGlyphs.length!==0)return!1;return!0}(si)&&Qt}fo.fromFeature=function(t,o){for(var s=new fo,f=0;f<t.sections.length;f++){var b=t.sections[f];b.image?s.addImageSection(b):s.addTextSection(b,o)}return s},fo.prototype.length=function(){return this.text.length},fo.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},fo.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},fo.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},fo.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",s=0;s<t.length;s++){var f=t.charCodeAt(s+1)||null,b=t.charCodeAt(s-1)||null;(!f||!Jl(f)||Ch[t[s+1]])&&(!b||!Jl(b)||Ch[t[s-1]])&&Ch[t[s]]?o+=Ch[t[s]]:o+=t[s]}return o}(this.text)},fo.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&gp[this.text.charCodeAt(o)];o++)t++;for(var s=this.text.length,f=this.text.length-1;f>=0&&f>=t&&gp[this.text.charCodeAt(f)];f--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)},fo.prototype.substring=function(t,o){var s=new fo;return s.text=this.text.substring(t,o),s.sectionIndex=this.sectionIndex.slice(t,o),s.sections=this.sections,s},fo.prototype.toString=function(){return this.text},fo.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,s){return Math.max(o,t.sections[s].scale)},0)},fo.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(Is.forText(t.scale,t.fontStack||o));for(var s=this.sections.length-1,f=0;f<t.text.length;++f)this.sectionIndex.push(s)},fo.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Is.forImage(o)),this.sectionIndex.push(this.sections.length-1)):En("Reached maximum number of images 6401")}else En("Can't add FormattedSection with an empty image.")},fo.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var gp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},As={};function yp(t,o,s,f,b,S){if(o.imageName){var M=f[o.imageName];return M?M.displaySize[0]*o.scale*xo/S+b:0}var L=s[o.fontStack],U=L&&L[t];return U?U.metrics.advance*o.scale+b:0}function Zp(t,o,s,f){var b=Math.pow(t-o,2);return f?t<o?b/2:2*b:b+Math.abs(s)*s}function Dh(t,o,s){var f=0;return t===10&&(f-=1e4),s&&(f+=150),t!==40&&t!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function rh(t,o,s,f,b,S){for(var M=null,L=Zp(o,s,b,S),U=0,W=f;U<W.length;U+=1){var K=W[U],ie=Zp(o-K.x,s,b,S)+K.badness;ie<=L&&(M=K,L=ie)}return{index:t,x:o,priorBreak:M,badness:L}}function nh(t,o,s,f,b,S,M){if(S!=="point")return[];if(!t)return[];for(var L,U=[],W=function(ke,Ve,Ye,He,it,bt){for(var zt=0,St=0;St<ke.length();St++){var Ht=ke.getSection(St);zt+=yp(ke.getCharCode(St),Ht,He,it,Ve,bt)}return zt/Math.max(1,Math.ceil(zt/Ye))}(t,o,s,f,b,M),K=t.text.indexOf("​")>=0,ie=0,le=0;le<t.length();le++){var ae=t.getSection(le),he=t.getCharCode(le);if(gp[he]||(ie+=yp(he,ae,f,b,o,M)),le<t.length()-1){var Me=!!(!((L=he)<11904)&&(Yt["Bopomofo Extended"](L)||Yt.Bopomofo(L)||Yt["CJK Compatibility Forms"](L)||Yt["CJK Compatibility Ideographs"](L)||Yt["CJK Compatibility"](L)||Yt["CJK Radicals Supplement"](L)||Yt["CJK Strokes"](L)||Yt["CJK Symbols and Punctuation"](L)||Yt["CJK Unified Ideographs Extension A"](L)||Yt["CJK Unified Ideographs"](L)||Yt["Enclosed CJK Letters and Months"](L)||Yt["Halfwidth and Fullwidth Forms"](L)||Yt.Hiragana(L)||Yt["Ideographic Description Characters"](L)||Yt["Kangxi Radicals"](L)||Yt["Katakana Phonetic Extensions"](L)||Yt.Katakana(L)||Yt["Vertical Forms"](L)||Yt["Yi Radicals"](L)||Yt["Yi Syllables"](L)));(As[he]||Me||ae.imageName)&&U.push(rh(le+1,ie,W,U,Dh(he,t.getCharCode(le+1),Me&&K),!1))}}return function ke(Ve){return Ve?ke(Ve.priorBreak).concat(Ve.index):[]}(rh(t.length(),ie,W,U,0,!0))}function Lh(t){var o=.5,s=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:o,verticalAlign:s}}function Ff(t,o,s,f,b){if(f||b)for(var S=t[s],M=S.metrics.advance*S.scale,L=(t[s].x+M)*f,U=o;U<=s;U++)t[U].x-=L,t[U].y+=b}function Rh(t,o,s,f,b,S){var M,L=t.image;if(L.content){var U=L.content,W=L.pixelRatio||1;M=[U[0]/W,U[1]/W,L.displaySize[0]-U[2]/W,L.displaySize[1]-U[3]/W]}var K,ie,le,ae,he=o.left*S,Me=o.right*S;s==="width"||s==="both"?(ae=b[0]+he-f[3],ie=b[0]+Me+f[1]):ie=(ae=b[0]+(he+Me-L.displaySize[0])/2)+L.displaySize[0];var ke=o.top*S,Ve=o.bottom*S;return s==="height"||s==="both"?(K=b[1]+ke-f[0],le=b[1]+Ve+f[2]):le=(K=b[1]+(ke+Ve-L.displaySize[1])/2)+L.displaySize[1],{image:L,top:K,right:ie,bottom:le,left:ae,collisionPadding:M}}As[10]=!0,As[32]=!0,As[38]=!0,As[40]=!0,As[41]=!0,As[43]=!0,As[45]=!0,As[47]=!0,As[173]=!0,As[183]=!0,As[8203]=!0,As[8208]=!0,As[8211]=!0,As[8231]=!0;var xu=function(t){function o(s,f,b,S){t.call(this,s,f),this.angle=b,S!==void 0&&(this.segment=S)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(Kt);Jt("Anchor",xu);var Bl=128;function bu(t,o){var s=o.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new qr(t+1))};if(s.kind==="source")return{kind:"source"};for(var f=s.zoomStops,b=s.interpolationType,S=0;S<f.length&&f[S]<=t;)S++;for(var M=S=Math.max(0,S-1);M<f.length&&f[M]<t+1;)M++;M=Math.min(f.length-1,M);var L=f[S],U=f[M];return s.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:U,interpolationType:b}:{kind:"camera",minZoom:L,maxZoom:U,minSize:s.evaluate(new qr(L)),maxSize:s.evaluate(new qr(U)),interpolationType:b}}function Vd(t,o,s){var f=o.uSize,b=o.uSizeT,S=s.lowerSize,M=s.upperSize;return t.kind==="source"?S/Bl:t.kind==="composite"?Sn(S/Bl,M/Bl,b):f}function Xp(t,o){var s=0,f=0;if(t.kind==="constant")f=t.layoutSize;else if(t.kind!=="source"){var b=t.interpolationType,S=t.minZoom,M=t.maxZoom,L=b?Di(ro.interpolationFactor(b,o,S,M),0,1):0;t.kind==="camera"?f=Sn(t.minSize,t.maxSize,L):s=L}return{uSizeT:s,uSize:f}}var Of=Object.freeze({__proto__:null,getSizeData:bu,evaluateSizeForFeature:Vd,evaluateSizeForZoom:Xp,SIZE_PACK_FACTOR:Bl});function Uf(t,o,s,f,b){if(o.segment===void 0)return!0;for(var S=o,M=o.segment+1,L=0;L>-s/2;){if(--M<0)return!1;L-=t[M].dist(S),S=t[M]}L+=t[M].dist(t[M+1]),M++;for(var U=[],W=0;L<s/2;){var K=t[M-1],ie=t[M],le=t[M+1];if(!le)return!1;var ae=K.angleTo(ie)-ie.angleTo(le);for(ae=Math.abs((ae+3*Math.PI)%(2*Math.PI)-Math.PI),U.push({distance:L,angleDelta:ae}),W+=ae;L-U[0].distance>f;)W-=U.shift().angleDelta;if(W>b)return!1;M++,L+=ie.dist(le)}return!0}function Vf(t){for(var o=0,s=0;s<t.length-1;s++)o+=t[s].dist(t[s+1]);return o}function Bh(t,o,s){return t?.6*o*s:0}function Nd(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function wu(t,o,s,f,b,S){for(var M=Bh(s,b,S),L=Nd(s,f)*S,U=0,W=Vf(t)/2,K=0;K<t.length-1;K++){var ie=t[K],le=t[K+1],ae=ie.dist(le);if(U+ae>W){var he=(W-U)/ae,Me=Sn(ie.x,le.x,he),ke=Sn(ie.y,le.y,he),Ve=new xu(Me,ke,le.angleTo(ie),K);return Ve._round(),!M||Uf(t,Ve,L,M,o)?Ve:void 0}U+=ae}}function _n(t,o,s,f,b,S,M,L,U){var W=Bh(f,S,M),K=Nd(f,b),ie=K*M,le=t[0].x===0||t[0].x===U||t[0].y===0||t[0].y===U;return o-ie<o/4&&(o=ie+o/4),function ae(he,Me,ke,Ve,Ye,He,it,bt,zt){for(var St=He/2,Ht=Vf(he),vi=0,hi=Me-ke,bi=[],pi=0;pi<he.length-1;pi++){for(var si=he[pi],Qt=he[pi+1],br=si.dist(Qt),Br=Qt.angleTo(si);hi+ke<vi+br;){var Sr=((hi+=ke)-vi)/br,er=Sn(si.x,Qt.x,Sr),Yr=Sn(si.y,Qt.y,Sr);if(er>=0&&er<zt&&Yr>=0&&Yr<zt&&hi-St>=0&&hi+St<=Ht){var Cr=new xu(er,Yr,Br,pi);Cr._round(),Ve&&!Uf(he,Cr,He,Ve,Ye)||bi.push(Cr)}}vi+=br}return bt||bi.length||it||(bi=ae(he,vi/2,ke,Ve,Ye,He,it,!0,zt)),bi}(t,le?o/2*L%o:(K/2+2*S)*M*L%o,o,W,s,ie,le,!1,U)}var Tu=Kn;function oc(t,o,s,f){var b=[],S=t.image,M=S.pixelRatio,L=S.paddedRect.w-2*Tu,U=S.paddedRect.h-2*Tu,W=t.right-t.left,K=t.bottom-t.top,ie=S.stretchX||[[0,L]],le=S.stretchY||[[0,U]],ae=function(Cr,mr){return Cr+mr[1]-mr[0]},he=ie.reduce(ae,0),Me=le.reduce(ae,0),ke=L-he,Ve=U-Me,Ye=0,He=he,it=0,bt=Me,zt=0,St=ke,Ht=0,vi=Ve;if(S.content&&f){var hi=S.content;Ye=ml(ie,0,hi[0]),it=ml(le,0,hi[1]),He=ml(ie,hi[0],hi[2]),bt=ml(le,hi[1],hi[3]),zt=hi[0]-Ye,Ht=hi[1]-it,St=hi[2]-hi[0]-He,vi=hi[3]-hi[1]-bt}var bi=function(Cr,mr,Ir,Jr){var ao=as(Cr.stretch-Ye,He,W,t.left),Yn=Vo(Cr.fixed-zt,St,Cr.stretch,he),pa=as(mr.stretch-it,bt,K,t.top),da=Vo(mr.fixed-Ht,vi,mr.stretch,Me),Nn=as(Ir.stretch-Ye,He,W,t.left),so=Vo(Ir.fixed-zt,St,Ir.stretch,he),jo=as(Jr.stretch-it,bt,K,t.top),wo=Vo(Jr.fixed-Ht,vi,Jr.stretch,Me),To=new Kt(ao,pa),Dn=new Kt(Nn,pa),Jn=new Kt(Nn,jo),Er=new Kt(ao,jo),Zr=new Kt(Yn/M,da/M),gn=new Kt(so/M,wo/M),yn=o*Math.PI/180;if(yn){var Eo=Math.sin(yn),cn=Math.cos(yn),Qo=[cn,-Eo,Eo,cn];To._matMult(Qo),Dn._matMult(Qo),Er._matMult(Qo),Jn._matMult(Qo)}var jn=Cr.stretch+Cr.fixed,Ws=Ir.stretch+Ir.fixed,ea=mr.stretch+mr.fixed,un=Jr.stretch+Jr.fixed;return{tl:To,tr:Dn,bl:Er,br:Jn,tex:{x:S.paddedRect.x+Tu+jn,y:S.paddedRect.y+Tu+ea,w:Ws-jn,h:un-ea},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zr,pixelOffsetBR:gn,minFontScaleX:St/M/W,minFontScaleY:vi/M/K,isSDF:s}};if(f&&(S.stretchX||S.stretchY))for(var pi=Fl(ie,ke,he),si=Fl(le,Ve,Me),Qt=0;Qt<pi.length-1;Qt++)for(var br=pi[Qt],Br=pi[Qt+1],Sr=0;Sr<si.length-1;Sr++){var er=si[Sr],Yr=si[Sr+1];b.push(bi(br,er,Br,Yr))}else b.push(bi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:U+1}));return b}function ml(t,o,s){for(var f=0,b=0,S=t;b<S.length;b+=1){var M=S[b];f+=Math.max(o,Math.min(s,M[1]))-Math.max(o,Math.min(s,M[0]))}return f}function Fl(t,o,s){for(var f=[{fixed:-Tu,stretch:0}],b=0,S=t;b<S.length;b+=1){var M=S[b],L=M[0],U=M[1],W=f[f.length-1];f.push({fixed:L-W.stretch,stretch:W.stretch}),f.push({fixed:L-W.stretch,stretch:W.stretch+(U-L)})}return f.push({fixed:o+Tu,stretch:s}),f}function as(t,o,s,f){return t/o*s+f}function Vo(t,o,s,f){return t-o*s/f}var Fh=function(t,o,s,f,b,S,M,L,U,W,K,ie){var le=M.top*L-U,ae=M.bottom*L+U,he=M.left*L-U,Me=M.right*L+U,ke=M.collisionPadding;if(ke&&(he-=ke[0]*L,le-=ke[1]*L,Me+=ke[2]*L,ae+=ke[3]*L),this.boxStartIndex=t.length,W){var Ve=ae-le,Ye=Me-he;Ve>0&&(Ve=Math.max(10*L,Ve),this._addLineCollisionCircles(t,o,s,s.segment,Ye,Ve,f,b,S,K))}else{if(ie){var He=new Kt(he,le),it=new Kt(Me,le),bt=new Kt(he,ae),zt=new Kt(Me,ae),St=ie*Math.PI/180;He._rotate(St),it._rotate(St),bt._rotate(St),zt._rotate(St),he=Math.min(He.x,it.x,bt.x,zt.x),Me=Math.max(He.x,it.x,bt.x,zt.x),le=Math.min(He.y,it.y,bt.y,zt.y),ae=Math.max(He.y,it.y,bt.y,zt.y)}t.emplaceBack(s.x,s.y,he,le,Me,ae,f,b,S,0,0)}this.boxEndIndex=t.length};Fh.prototype._addLineCollisionCircles=function(t,o,s,f,b,S,M,L,U,W){var K=S/2,ie=Math.floor(b/K)||1,le=1+.4*Math.log(W)/Math.LN2,ae=Math.floor(ie*le/2),he=-S/2,Me=s,ke=f+1,Ve=he,Ye=-b/2,He=Ye-b/4;do{if(--ke<0){if(Ve>Ye)return;ke=0;break}Ve-=o[ke].dist(Me),Me=o[ke]}while(Ve>He);for(var it=o[ke].dist(o[ke+1]),bt=-ae;bt<ie+ae;bt++){var zt=bt*K,St=Ye+zt;if(zt<0&&(St+=zt),zt>b&&(St+=zt-b),!(St<Ve)){for(;Ve+it<St;){if(Ve+=it,++ke+1>=o.length)return;it=o[ke].dist(o[ke+1])}var Ht=St-Ve,vi=o[ke],hi=o[ke+1].sub(vi)._unit()._mult(Ht)._add(vi)._round(),bi=Math.abs(St-he)<K?0:.8*(St-he);t.emplaceBack(hi.x,hi.y,-S/2,-S/2,S/2,S/2,M,L,U,S/2,bi)}}};var bo=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=Nf),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function Nf(t,o){return t<o?-1:t>o?1:0}function Oh(t,o,s){o===void 0&&(o=1),s===void 0&&(s=!1);for(var f=1/0,b=1/0,S=-1/0,M=-1/0,L=t[0],U=0;U<L.length;U++){var W=L[U];(!U||W.x<f)&&(f=W.x),(!U||W.y<b)&&(b=W.y),(!U||W.x>S)&&(S=W.x),(!U||W.y>M)&&(M=W.y)}var K=S-f,ie=M-b,le=Math.min(K,ie),ae=le/2,he=new bo([],jd);if(le===0)return new Kt(f,b);for(var Me=f;Me<S;Me+=le)for(var ke=b;ke<M;ke+=le)he.push(new oh(Me+ae,ke+ae,ae,t));for(var Ve=function(it){for(var bt=0,zt=0,St=0,Ht=it[0],vi=0,hi=Ht.length,bi=hi-1;vi<hi;bi=vi++){var pi=Ht[vi],si=Ht[bi],Qt=pi.x*si.y-si.x*pi.y;zt+=(pi.x+si.x)*Qt,St+=(pi.y+si.y)*Qt,bt+=3*Qt}return new oh(zt/bt,St/bt,0,it)}(t),Ye=he.length;he.length;){var He=he.pop();(He.d>Ve.d||!Ve.d)&&(Ve=He,s&&console.log("found best %d after %d probes",Math.round(1e4*He.d)/1e4,Ye)),He.max-Ve.d<=o||(ae=He.h/2,he.push(new oh(He.p.x-ae,He.p.y-ae,ae,t)),he.push(new oh(He.p.x+ae,He.p.y-ae,ae,t)),he.push(new oh(He.p.x-ae,He.p.y+ae,ae,t)),he.push(new oh(He.p.x+ae,He.p.y+ae,ae,t)),Ye+=4)}return s&&(console.log("num probes: "+Ye),console.log("best distance: "+Ve.d)),Ve.p}function jd(t,o){return o.max-t.max}function oh(t,o,s,f){this.p=new Kt(t,o),this.h=s,this.d=function(b,S){for(var M=!1,L=1/0,U=0;U<S.length;U++)for(var W=S[U],K=0,ie=W.length,le=ie-1;K<ie;le=K++){var ae=W[K],he=W[le];ae.y>b.y!=he.y>b.y&&b.x<(he.x-ae.x)*(b.y-ae.y)/(he.y-ae.y)+ae.x&&(M=!M),L=Math.min(L,Tt(b,ae,he))}return(M?1:-1)*Math.sqrt(L)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}bo.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},bo.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},bo.prototype.peek=function(){return this.data[0]},bo.prototype._up=function(t){for(var o=this.data,s=this.compare,f=o[t];t>0;){var b=t-1>>1,S=o[b];if(s(f,S)>=0)break;o[t]=S,t=b}o[t]=f},bo.prototype._down=function(t){for(var o=this.data,s=this.compare,f=this.length>>1,b=o[t];t<f;){var S=1+(t<<1),M=o[S],L=S+1;if(L<this.length&&s(o[L],M)<0&&(S=L,M=o[L]),s(M,b)>=0)break;o[t]=M,t=S}o[t]=b};var Eu=7,qd=Number.POSITIVE_INFINITY;function Wp(t,o){return o[1]!==qd?function(s,f,b){var S=0,M=0;switch(f=Math.abs(f),b=Math.abs(b),s){case"top-right":case"top-left":case"top":M=b-Eu;break;case"bottom-right":case"bottom-left":case"bottom":M=-b+Eu}switch(s){case"top-right":case"bottom-right":case"right":S=-f;break;case"top-left":case"bottom-left":case"left":S=f}return[S,M]}(t,o[0],o[1]):function(s,f){var b=0,S=0;f<0&&(f=0);var M=f/Math.sqrt(2);switch(s){case"top-right":case"top-left":S=M-Eu;break;case"bottom-right":case"bottom-left":S=-M+Eu;break;case"bottom":S=-f+Eu;break;case"top":S=f-Eu}switch(s){case"top-right":case"bottom-right":b=-M;break;case"top-left":case"bottom-left":b=M;break;case"left":b=f;break;case"right":b=-f}return[b,S]}(t,o[0])}function $p(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}var vp=255,ss=vp*Bl;function Su(t,o,s,f,b,S,M,L,U,W,K,ie,le,ae){var he=function(He,it,bt,zt,St,Ht,vi,hi){for(var bi=zt.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,pi=[],si=0,Qt=it.positionedLines;si<Qt.length;si+=1)for(var br=Qt[si],Br=0,Sr=br.positionedGlyphs;Br<Sr.length;Br+=1){var er=Sr[Br];if(er.rect){var Yr=er.rect||{},Cr=Ph+1,mr=!0,Ir=1,Jr=0,ao=(St||hi)&&er.vertical,Yn=er.metrics.advance*er.scale/2;if(hi&&it.verticalizable){var pa=(er.scale-1)*xo,da=(xo-er.metrics.width*er.scale)/2;Jr=br.lineOffset/2-(er.imageName?-da:pa)}if(er.imageName){var Nn=vi[er.imageName];mr=Nn.sdf,Ir=Nn.pixelRatio,Cr=Kn/Ir}var so=St?[er.x+Yn,er.y]:[0,0],jo=St?[0,0]:[er.x+Yn+bt[0],er.y+bt[1]-Jr],wo=[0,0];ao&&(wo=jo,jo=[0,0]);var To=(er.metrics.left-Cr)*er.scale-Yn+jo[0],Dn=(-er.metrics.top-Cr)*er.scale+jo[1],Jn=To+Yr.w*er.scale/Ir,Er=Dn+Yr.h*er.scale/Ir,Zr=new Kt(To,Dn),gn=new Kt(Jn,Dn),yn=new Kt(To,Er),Eo=new Kt(Jn,Er);if(ao){var cn=new Kt(-Yn,Yn-ih),Qo=-Math.PI/2,jn=xo/2-Yn,Ws=er.imageName?jn:0,ea=new Kt(5-ih-jn,-Ws),un=new(Function.prototype.bind.apply(Kt,[null].concat(wo)));Zr._rotateAround(Qo,cn)._add(ea)._add(un),gn._rotateAround(Qo,cn)._add(ea)._add(un),yn._rotateAround(Qo,cn)._add(ea)._add(un),Eo._rotateAround(Qo,cn)._add(ea)._add(un)}if(bi){var Ua=Math.sin(bi),Qn=Math.cos(bi),ls=[Qn,-Ua,Ua,Qn];Zr._matMult(ls),gn._matMult(ls),yn._matMult(ls),Eo._matMult(ls)}var ac=new Kt(0,0),Ul=new Kt(0,0);pi.push({tl:Zr,tr:gn,bl:yn,br:Eo,tex:Yr,writingMode:it.writingMode,glyphOffset:so,sectionIndex:er.sectionIndex,isSDF:mr,pixelOffsetTL:ac,pixelOffsetBR:Ul,minFontScaleX:0,minFontScaleY:0})}}return pi}(0,s,L,b,S,M,f,t.allowVerticalPlacement),Me=t.textSizeData,ke=null;Me.kind==="source"?(ke=[Bl*b.layout.get("text-size").evaluate(M,{})])[0]>ss&&En(t.layerIds[0]+': Value for "text-size" is >= '+vp+'. Reduce your "text-size".'):Me.kind==="composite"&&((ke=[Bl*ae.compositeTextSizes[0].evaluate(M,{}),Bl*ae.compositeTextSizes[1].evaluate(M,{})])[0]>ss||ke[1]>ss)&&En(t.layerIds[0]+': Value for "text-size" is >= '+vp+'. Reduce your "text-size".'),t.addSymbols(t.text,he,ke,L,S,M,W,o,U.lineStartIndex,U.lineLength,le);for(var Ve=0,Ye=K;Ve<Ye.length;Ve+=1)ie[Ye[Ve]]=t.text.placedSymbolArray.length-1;return 4*he.length}function xp(t){for(var o in t)return t[o];return null}function Hp(t,o,s,f){var b=t.compareText;if(o in b){for(var S=b[o],M=S.length-1;M>=0;M--)if(f.dist(S[M])<s)return!0}else b[o]=[];return b[o].push(f),!1}var Gd=Yu.VectorTileFeature.types,jf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kp(t,o,s,f,b,S,M,L,U,W,K,ie,le){var ae=L?Math.min(ss,Math.round(L[0])):0,he=L?Math.min(ss,Math.round(L[1])):0;t.emplaceBack(o,s,Math.round(32*f),Math.round(32*b),S,M,(ae<<1)+(U?1:0),he,16*W,16*K,256*ie,256*le)}function Yp(t,o,s){t.emplaceBack(o.x,o.y,s),t.emplaceBack(o.x,o.y,s),t.emplaceBack(o.x,o.y,s),t.emplaceBack(o.x,o.y,s)}function Sm(t){for(var o=0,s=t.sections;o<s.length;o+=1)if(vr(s[o].text))return!0;return!1}var Iu=function(t){this.layoutVertexArray=new ge,this.indexArray=new ei,this.programConfigurations=t,this.segments=new Lr,this.dynamicLayoutVertexArray=new be,this.opacityVertexArray=new We,this.placedSymbolArray=new ji};Iu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Iu.prototype.upload=function(t,o,s,f){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Es.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,fp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,jf,!0),this.opacityVertexBuffer.itemSize=1),(s||f)&&this.programConfigurations.upload(t))},Iu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Jt("SymbolBuffers",Iu);var ah=function(t,o,s){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new s,this.segments=new Lr,this.collisionVertexArray=new Je};ah.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,os.members,!0)},ah.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Jt("CollisionBuffers",ah);var Rr=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(M){return M.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[];var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bu(this.zoom,o["text-size"]),this.iconSizeData=bu(this.zoom,o["icon-size"]);var s=this.layers[0].layout,f=s.get("symbol-sort-key"),b=s.get("symbol-z-order");this.sortFeaturesByKey=b!=="viewport-y"&&f.constantOr(1)!==void 0;var S=b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey;this.sortFeaturesByY=S&&(s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement")),s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(M){return Xs[M]})),this.stateDependentLayerIds=this.layers.filter(function(M){return M.isStateDependent()}).map(function(M){return M.id}),this.sourceID=t.sourceID};Rr.prototype.createArrays=function(){this.text=new Iu(new ce(Es.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Iu(new ce(Es.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new fr,this.lineVertexArray=new Ft,this.symbolInstances=new Ri},Rr.prototype.calculateGlyphDependencies=function(t,o,s,f,b){for(var S=0;S<t.length;S++)if(o[t.charCodeAt(S)]=!0,(s||f)&&b){var M=Ch[t.charAt(S)];M&&(o[M.charCodeAt(0)]=!0)}},Rr.prototype.populate=function(t,o){var s=this.layers[0],f=s.layout,b=f.get("text-font"),S=f.get("text-field"),M=f.get("icon-image"),L=(S.value.kind!=="constant"||S.value.value instanceof Qi&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),U=(M.value.kind!=="constant"||!!M.value.value)&&Object.keys(M.parameters).length>0,W=f.get("symbol-sort-key");if(this.features=[],L||U){for(var K=o.iconDependencies,ie=o.glyphDependencies,le=o.availableImages,ae=new qr(this.zoom),he=0,Me=t;he<Me.length;he+=1){var ke=Me[he],Ve=ke.feature,Ye=ke.id,He=ke.index,it=ke.sourceLayerIndex;if(s._featureFilter(ae,Ve)){var bt=void 0;if(L){var zt=s.getValueAndResolveTokens("text-field",Ve,le),St=Qi.factory(zt);Sm(St)&&(this.hasRTLText=!0),(!this.hasRTLText||cl()==="unavailable"||this.hasRTLText&&Bo.isParsed())&&(bt=po(St,s,Ve))}var Ht=void 0;if(U){var vi=s.getValueAndResolveTokens("icon-image",Ve,le);Ht=vi instanceof _r?vi:_r.fromString(vi)}if(bt||Ht){var hi=this.sortFeaturesByKey?W.evaluate(Ve,{}):void 0,bi={id:Ye,text:bt,icon:Ht,index:He,sourceLayerIndex:it,geometry:we(Ve),properties:Ve.properties,type:Gd[Ve.type],sortKey:hi};if(this.features.push(bi),Ht&&(K[Ht.name]=!0),bt){var pi=b.evaluate(Ve,{}).join(","),si=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xs.vertical)>=0;for(var Qt=0,br=bt.sections;Qt<br.length;Qt+=1){var Br=br[Qt];if(Br.image)K[Br.image.name]=!0;else{var Sr=ua(bt.toString()),er=Br.fontStack||pi,Yr=ie[er]=ie[er]||{};this.calculateGlyphDependencies(Br.text,Yr,si,this.allowVerticalPlacement,Sr)}}}}}}f.get("symbol-placement")==="line"&&(this.features=function(Cr){var mr={},Ir={},Jr=[],ao=0;function Yn(gn){Jr.push(Cr[gn]),ao++}function pa(gn,yn,Eo){var cn=Ir[gn];return delete Ir[gn],Ir[yn]=cn,Jr[cn].geometry[0].pop(),Jr[cn].geometry[0]=Jr[cn].geometry[0].concat(Eo[0]),cn}function da(gn,yn,Eo){var cn=mr[yn];return delete mr[yn],mr[gn]=cn,Jr[cn].geometry[0].shift(),Jr[cn].geometry[0]=Eo[0].concat(Jr[cn].geometry[0]),cn}function Nn(gn,yn,Eo){var cn=Eo?yn[0][yn[0].length-1]:yn[0][0];return gn+":"+cn.x+":"+cn.y}for(var so=0;so<Cr.length;so++){var jo=Cr[so],wo=jo.geometry,To=jo.text?jo.text.toString():null;if(To){var Dn=Nn(To,wo),Jn=Nn(To,wo,!0);if(Dn in Ir&&Jn in mr&&Ir[Dn]!==mr[Jn]){var Er=da(Dn,Jn,wo),Zr=pa(Dn,Jn,Jr[Er].geometry);delete mr[Dn],delete Ir[Jn],Ir[Nn(To,Jr[Zr].geometry,!0)]=Zr,Jr[Er].geometry=null}else Dn in Ir?pa(Dn,Jn,wo):Jn in mr?da(Dn,Jn,wo):(Yn(so),mr[Dn]=ao-1,Ir[Jn]=ao-1)}else Yn(so)}return Jr.filter(function(gn){return gn.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Cr,mr){return Cr.sortKey-mr.sortKey})}},Rr.prototype.update=function(t,o,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,s))},Rr.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Rr.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Rr.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t),this.textCollisionCircle.upload(t),this.iconCollisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Rr.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy(),this.textCollisionCircle.destroy(),this.iconCollisionCircle.destroy()},Rr.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Rr.prototype.addToLineVertexArray=function(t,o){var s=this.lineVertexArray.length;if(t.segment!==void 0){for(var f=t.dist(o[t.segment+1]),b=t.dist(o[t.segment]),S={},M=t.segment+1;M<o.length;M++)S[M]={x:o[M].x,y:o[M].y,tileUnitDistanceFromAnchor:f},M<o.length-1&&(f+=o[M+1].dist(o[M]));for(var L=t.segment||0;L>=0;L--)S[L]={x:o[L].x,y:o[L].y,tileUnitDistanceFromAnchor:b},L>0&&(b+=o[L-1].dist(o[L]));for(var U=0;U<o.length;U++){var W=S[U];this.lineVertexArray.emplaceBack(W.x,W.y,W.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},Rr.prototype.addSymbols=function(t,o,s,f,b,S,M,L,U,W,K){for(var ie=t.indexArray,le=t.layoutVertexArray,ae=t.segments.prepareSegment(4*o.length,le,ie,S.sortKey),he=this.glyphOffsetArray.length,Me=ae.vertexLength,ke=this.allowVerticalPlacement&&M===Xs.vertical?Math.PI/2:0,Ve=S.text&&S.text.sections,Ye=0;Ye<o.length;Ye++){var He=o[Ye],it=He.tl,bt=He.tr,zt=He.bl,St=He.br,Ht=He.tex,vi=He.pixelOffsetTL,hi=He.pixelOffsetBR,bi=He.minFontScaleX,pi=He.minFontScaleY,si=He.glyphOffset,Qt=He.isSDF,br=He.sectionIndex,Br=ae.vertexLength,Sr=si[1];Kp(le,L.x,L.y,it.x,Sr+it.y,Ht.x,Ht.y,s,Qt,vi.x,vi.y,bi,pi),Kp(le,L.x,L.y,bt.x,Sr+bt.y,Ht.x+Ht.w,Ht.y,s,Qt,hi.x,vi.y,bi,pi),Kp(le,L.x,L.y,zt.x,Sr+zt.y,Ht.x,Ht.y+Ht.h,s,Qt,vi.x,hi.y,bi,pi),Kp(le,L.x,L.y,St.x,Sr+St.y,Ht.x+Ht.w,Ht.y+Ht.h,s,Qt,hi.x,hi.y,bi,pi),Yp(t.dynamicLayoutVertexArray,L,ke),ie.emplaceBack(Br,Br+1,Br+2),ie.emplaceBack(Br+1,Br+2,Br+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(si[0]),Ye!==o.length-1&&br===o[Ye+1].sectionIndex||t.programConfigurations.populatePaintArrays(le.length,S,S.index,{},Ve&&Ve[br])}t.placedSymbolArray.emplaceBack(L.x,L.y,he,this.glyphOffsetArray.length-he,Me,U,W,L.segment,s?s[0]:0,s?s[1]:0,f[0],f[1],M,0,!1,0,K)},Rr.prototype._addCollisionDebugVertex=function(t,o,s,f,b,S){return o.emplaceBack(0,0),t.emplaceBack(s.x,s.y,f,b,Math.round(S.x),Math.round(S.y))},Rr.prototype.addCollisionDebugVertices=function(t,o,s,f,b,S,M,L){var U=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),W=U.vertexLength,K=b.layoutVertexArray,ie=b.collisionVertexArray,le=M.anchorX,ae=M.anchorY;if(this._addCollisionDebugVertex(K,ie,S,le,ae,new Kt(t,o)),this._addCollisionDebugVertex(K,ie,S,le,ae,new Kt(s,o)),this._addCollisionDebugVertex(K,ie,S,le,ae,new Kt(s,f)),this._addCollisionDebugVertex(K,ie,S,le,ae,new Kt(t,f)),U.vertexLength+=4,L){var he=b.indexArray;he.emplaceBack(W,W+1,W+2),he.emplaceBack(W,W+2,W+3),U.primitiveLength+=2}else{var Me=b.indexArray;Me.emplaceBack(W,W+1),Me.emplaceBack(W+1,W+2),Me.emplaceBack(W+2,W+3),Me.emplaceBack(W+3,W),U.primitiveLength+=4}},Rr.prototype.addDebugCollisionBoxes=function(t,o,s,f){for(var b=t;b<o;b++){var S=this.collisionBoxArray.get(b),M=S.x1,L=S.y1,U=S.x2,W=S.y2,K=S.radius>0;this.addCollisionDebugVertices(M,L,U,W,K?f?this.textCollisionCircle:this.iconCollisionCircle:f?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,s,K)}},Rr.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ah(et,dl.members,ni),this.iconCollisionBox=new ah(et,dl.members,ni),this.textCollisionCircle=new ah(et,Vp.members,ei),this.iconCollisionCircle=new ah(et,Vp.members,ei);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Rr.prototype._deserializeCollisionBoxesForSymbol=function(t,o,s,f,b,S,M,L,U){for(var W={},K=o;K<s;K++){var ie=t.get(K);if(ie.radius===0){W.textBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},W.textFeatureIndex=ie.featureIndex;break}W.textCircles||(W.textCircles=[],W.textFeatureIndex=ie.featureIndex),W.textCircles.push(ie.anchorPointX,ie.anchorPointY,ie.radius,ie.signedDistanceFromAnchor,1)}for(var le=f;le<b;le++){var ae=t.get(le);if(ae.radius===0){W.verticalTextBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},W.verticalTextFeatureIndex=ae.featureIndex;break}}for(var he=S;he<M;he++){var Me=t.get(he);if(Me.radius===0){W.iconBox={x1:Me.x1,y1:Me.y1,x2:Me.x2,y2:Me.y2,anchorPointX:Me.anchorPointX,anchorPointY:Me.anchorPointY},W.iconFeatureIndex=Me.featureIndex;break}}for(var ke=L;ke<U;ke++){var Ve=t.get(ke);if(Ve.radius===0){W.verticalIconBox={x1:Ve.x1,y1:Ve.y1,x2:Ve.x2,y2:Ve.y2,anchorPointX:Ve.anchorPointX,anchorPointY:Ve.anchorPointY},W.verticalIconFeatureIndex=Ve.featureIndex;break}}return W},Rr.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var s=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},Rr.prototype.hasTextData=function(){return this.text.segments.get().length>0},Rr.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Rr.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox&&this.textCollisionCircle&&this.iconCollisionCircle},Rr.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Rr.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Rr.prototype.hasTextCollisionCircleData=function(){return this.hasDebugData()&&this.textCollisionCircle.segments.get().length>0},Rr.prototype.hasIconCollisionCircleData=function(){return this.hasDebugData()&&this.iconCollisionCircle.segments.get().length>0},Rr.prototype.addIndicesForPlacedSymbol=function(t,o){for(var s=t.placedSymbolArray.get(o),f=s.vertexStartIndex+4*s.numGlyphs,b=s.vertexStartIndex;b<f;b+=4)t.indexArray.emplaceBack(b,b+1,b+2),t.indexArray.emplaceBack(b+1,b+2,b+3)},Rr.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),s=Math.cos(t),f=[],b=[],S=[],M=0;M<this.symbolInstances.length;++M){S.push(M);var L=this.symbolInstances.get(M);f.push(0|Math.round(o*L.anchorX+s*L.anchorY)),b.push(L.featureIndex)}return S.sort(function(U,W){return f[U]-f[W]||b[W]-b[U]}),S},Rr.prototype.addToSortKeyRanges=function(t,o){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===o?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Rr.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,f=this.symbolInstanceIndexes;s<f.length;s+=1){var b=f[s],S=this.symbolInstances.get(b);this.featureSortOrder.push(S.featureIndex),[S.rightJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.leftJustifiedTextSymbolIndex].forEach(function(M,L,U){M>=0&&U.indexOf(M)===L&&o.addIndicesForPlacedSymbol(o.text,M)}),S.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,S.verticalPlacedTextSymbolIndex),S.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,S.placedIconSymbolIndex),S.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,S.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Jt("SymbolBucket",Rr,{omit:["layers","collisionBoxArray","features","compareText"]}),Rr.MAX_GLYPHS=65535,Rr.addDynamicAttributes=Yp;var qf=new p({"symbol-placement":new ai(V.layout_symbol["symbol-placement"]),"symbol-spacing":new ai(V.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ai(V.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mi(V.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ai(V.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ai(V.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ai(V.layout_symbol["icon-ignore-placement"]),"icon-optional":new ai(V.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ai(V.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mi(V.layout_symbol["icon-size"]),"icon-text-fit":new ai(V.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ai(V.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mi(V.layout_symbol["icon-image"]),"icon-rotate":new Mi(V.layout_symbol["icon-rotate"]),"icon-padding":new ai(V.layout_symbol["icon-padding"]),"icon-keep-upright":new ai(V.layout_symbol["icon-keep-upright"]),"icon-offset":new Mi(V.layout_symbol["icon-offset"]),"icon-anchor":new Mi(V.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ai(V.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ai(V.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ai(V.layout_symbol["text-rotation-alignment"]),"text-field":new Mi(V.layout_symbol["text-field"]),"text-font":new Mi(V.layout_symbol["text-font"]),"text-size":new Mi(V.layout_symbol["text-size"]),"text-max-width":new Mi(V.layout_symbol["text-max-width"]),"text-line-height":new ai(V.layout_symbol["text-line-height"]),"text-letter-spacing":new Mi(V.layout_symbol["text-letter-spacing"]),"text-justify":new Mi(V.layout_symbol["text-justify"]),"text-radial-offset":new Mi(V.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ai(V.layout_symbol["text-variable-anchor"]),"text-anchor":new Mi(V.layout_symbol["text-anchor"]),"text-max-angle":new ai(V.layout_symbol["text-max-angle"]),"text-writing-mode":new ai(V.layout_symbol["text-writing-mode"]),"text-rotate":new Mi(V.layout_symbol["text-rotate"]),"text-padding":new ai(V.layout_symbol["text-padding"]),"text-keep-upright":new ai(V.layout_symbol["text-keep-upright"]),"text-transform":new Mi(V.layout_symbol["text-transform"]),"text-offset":new Mi(V.layout_symbol["text-offset"]),"text-allow-overlap":new ai(V.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ai(V.layout_symbol["text-ignore-placement"]),"text-optional":new ai(V.layout_symbol["text-optional"])}),Jp={paint:new p({"icon-opacity":new Mi(V.paint_symbol["icon-opacity"]),"icon-color":new Mi(V.paint_symbol["icon-color"]),"icon-halo-color":new Mi(V.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mi(V.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mi(V.paint_symbol["icon-halo-blur"]),"icon-translate":new ai(V.paint_symbol["icon-translate"]),"icon-translate-anchor":new ai(V.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mi(V.paint_symbol["text-opacity"]),"text-color":new Mi(V.paint_symbol["text-color"],{runtimeType:rt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Mi(V.paint_symbol["text-halo-color"]),"text-halo-width":new Mi(V.paint_symbol["text-halo-width"]),"text-halo-blur":new Mi(V.paint_symbol["text-halo-blur"]),"text-translate":new ai(V.paint_symbol["text-translate"]),"text-translate-anchor":new ai(V.paint_symbol["text-translate-anchor"])}),layout:qf},Ol=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Le,this.defaultValue=t};Ol.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ol.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ol.prototype.possibleOutputs=function(){return[void 0]},Ol.prototype.serialize=function(){return null},Jt("FormatSectionOverride",Ol,{omit:["defaultValue"]});var Gf=function(t){function o(s){t.call(this,s,Jp)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.recalculate=function(s,f){if(t.prototype.recalculate.call(this,s,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var b=this.layout.get("text-writing-mode");if(b){for(var S=[],M=0,L=b;M<L.length;M+=1){var U=L[M];S.indexOf(U)<0&&S.push(U)}this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(s,f,b){var S=this.layout.get(s).evaluate(f,{},b),M=this._unevaluatedLayout._values[s];return M.isDataDriven()||Tr(M.value)||!S?S:function(L,U){return U.replace(/{([^{}]+)}/g,function(W,K){return K in L?String(L[K]):""})}(f.properties,S)},o.prototype.createBucket=function(s){return new Rr(s)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var s=0,f=Jp.paint.overridableProperties;s<f.length;s+=1){var b=f[s];if(o.hasPaintOverride(this.layout,b)){var S=this.paint.get(b),M=new Ol(S),L=new $l(M,S.property.specification),U=null;U=S.value.kind==="constant"||S.value.kind==="source"?new yc("source",L):new Ns("composite",L,S.value.zoomStops,S.value._interpolationType),this.paint._values[b]=new $n(S.property,U,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(s,f,b){return!(!this.layout||f.isDataDriven()||b.isDataDriven())&&o.hasPaintOverride(this.layout,s)},o.hasPaintOverride=function(s,f){var b=s.get("text-field"),S=Jp.paint.properties[f],M=!1,L=function(K){for(var ie=0,le=K;ie<le.length;ie+=1){var ae=le[ie];if(S.overrides&&S.overrides.hasOverride(ae))return void(M=!0)}};if(b.value.kind==="constant"&&b.value.value instanceof Qi)L(b.value.value.sections);else if(b.value.kind==="source"){var U=function(K){if(!M)if(K instanceof Or&&dr(K.value)===_i){var ie=K.value;L(ie.sections)}else K instanceof qi?L(K.sections):K.eachChild(U)},W=b.value;W._styleExpression&&U(W._styleExpression.expression)}return M},o}(y),Im={paint:new p({"background-color":new ai(V.paint_background["background-color"]),"background-pattern":new h(V.paint_background["background-pattern"]),"background-opacity":new ai(V.paint_background["background-opacity"])})},Uh=function(t){function o(s){t.call(this,s,Im)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(y),Qp={paint:new p({"raster-opacity":new ai(V.paint_raster["raster-opacity"]),"raster-hue-rotate":new ai(V.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ai(V.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ai(V.paint_raster["raster-brightness-max"]),"raster-saturation":new ai(V.paint_raster["raster-saturation"]),"raster-contrast":new ai(V.paint_raster["raster-contrast"]),"raster-resampling":new ai(V.paint_raster["raster-resampling"]),"raster-fade-duration":new ai(V.paint_raster["raster-fade-duration"])})},Zf=function(t){function o(s){t.call(this,s,Qp)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(y),Xf=function(t){function o(s){t.call(this,s,{}),this.implementation=s}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},o.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},o}(y),Am={circle:wi,heatmap:fn,hillshade:yo,fill:Mf,"fill-extrusion":Op,line:dp,symbol:Gf,background:Uh,raster:Zf},Wf=self.HTMLImageElement,Zd=self.HTMLCanvasElement,$f=self.HTMLVideoElement,Xd=self.ImageData,ed=self.ImageBitmap,sh=function(t,o,s,f){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(o,f)};sh.prototype.update=function(t,o,s){var f=t.width,b=t.height,S=!(this.size&&this.size[0]===f&&this.size[1]===b||s),M=this.context,L=M.gl;if(this.useMipmap=!!(o&&o.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!o||o.premultiply!==!1)),S)this.size=[f,b],t instanceof Wf||t instanceof Zd||t instanceof $f||t instanceof Xd||ed&&t instanceof ed?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,t):L.texImage2D(L.TEXTURE_2D,0,this.format,f,b,0,this.format,L.UNSIGNED_BYTE,t.data);else{var U=s||{x:0,y:0},W=U.x,K=U.y;t instanceof Wf||t instanceof Zd||t instanceof $f||t instanceof Xd||ed&&t instanceof ed?L.texSubImage2D(L.TEXTURE_2D,0,W,K,L.RGBA,L.UNSIGNED_BYTE,t):L.texSubImage2D(L.TEXTURE_2D,0,W,K,f,b,L.RGBA,L.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)},sh.prototype.bind=function(t,o,s){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),s!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,s||t),this.filter=t),o!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrap=o)},sh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},sh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var td=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};td.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},td.prototype.remove=function(){delete this._channel,this._callback=function(){}};var lh=function(t,o,s){this.target=t,this.parent=o,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ao(["receive","process"],this),this.invoker=new td(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=en()?t:self};function Wd(t,o,s){var f=2*Math.PI*6378137/256/Math.pow(2,s);return[t*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}lh.prototype.send=function(t,o,s,f,b){var S=this;b===void 0&&(b=!1);var M=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[M]=s);var L=hs(this.globalScope)?void 0:[];return this.target.postMessage({id:M,type:t,hasCallback:!!s,targetMapId:f,mustQueue:b,sourceMapId:this.mapId,data:Ec(o,L)},L),{cancel:function(){s&&delete S.callbacks[M],S.target.postMessage({id:M,type:"<cancel>",targetMapId:f,sourceMapId:S.mapId})}}},lh.prototype.receive=function(t){var o=t.data,s=o.id;if(s&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[s];var f=this.cancelCallbacks[s];delete this.cancelCallbacks[s],f&&f()}else en()||o.mustQueue?(this.tasks[s]=o,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,o)},lh.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},lh.prototype.processTask=function(t,o){var s=this;if(o.type==="<response>"){var f=this.callbacks[t];delete this.callbacks[t],f&&(o.error?f(Mn(o.error)):f(null,Mn(o.data)))}else{var b=!1,S=hs(this.globalScope)?void 0:[],M=o.hasCallback?function(K,ie){b=!0,delete s.cancelCallbacks[t],s.target.postMessage({id:t,type:"<response>",sourceMapId:s.mapId,error:K?Ec(K):null,data:Ec(ie,S)},S)}:function(K){b=!0},L=null,U=Mn(o.data);if(this.parent[o.type])L=this.parent[o.type](o.sourceMapId,U,M);else if(this.parent.getWorkerSource){var W=o.type.split(".");L=this.parent.getWorkerSource(o.sourceMapId,W[0],U.source)[W[1]](U,M)}else M(new Error("Could not find function "+o.type));!b&&L&&L.cancel&&(this.cancelCallbacks[t]=L.cancel)}},lh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var oo=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};oo.prototype.setNorthEast=function(t){return this._ne=t instanceof Nr?new Nr(t.lng,t.lat):Nr.convert(t),this},oo.prototype.setSouthWest=function(t){return this._sw=t instanceof Nr?new Nr(t.lng,t.lat):Nr.convert(t),this},oo.prototype.extend=function(t){var o,s,f=this._sw,b=this._ne;if(t instanceof Nr)o=t,s=t;else{if(!(t instanceof oo))return Array.isArray(t)?t.every(Array.isArray)?this.extend(oo.convert(t)):this.extend(Nr.convert(t)):this;if(o=t._sw,s=t._ne,!o||!s)return this}return f||b?(f.lng=Math.min(o.lng,f.lng),f.lat=Math.min(o.lat,f.lat),b.lng=Math.max(s.lng,b.lng),b.lat=Math.max(s.lat,b.lat)):(this._sw=new Nr(o.lng,o.lat),this._ne=new Nr(s.lng,s.lat)),this},oo.prototype.getCenter=function(){return new Nr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},oo.prototype.getSouthWest=function(){return this._sw},oo.prototype.getNorthEast=function(){return this._ne},oo.prototype.getNorthWest=function(){return new Nr(this.getWest(),this.getNorth())},oo.prototype.getSouthEast=function(){return new Nr(this.getEast(),this.getSouth())},oo.prototype.getWest=function(){return this._sw.lng},oo.prototype.getSouth=function(){return this._sw.lat},oo.prototype.getEast=function(){return this._ne.lng},oo.prototype.getNorth=function(){return this._ne.lat},oo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},oo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},oo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},oo.prototype.contains=function(t){var o=Nr.convert(t),s=o.lng,f=o.lat,b=this._sw.lat<=f&&f<=this._ne.lat,S=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(S=this._sw.lng>=s&&s>=this._ne.lng),b&&S},oo.convert=function(t){return!t||t instanceof oo?t:new oo(t)};var Nr=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Nr.prototype.wrap=function(){return new Nr(nr(this.lng,-180,180),this.lat)},Nr.prototype.toArray=function(){return[this.lng,this.lat]},Nr.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Nr.prototype.distanceTo=function(t){var o=Math.PI/180,s=this.lat*o,f=t.lat*o,b=Math.sin(s)*Math.sin(f)+Math.cos(s)*Math.cos(f)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(b,1))},Nr.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,s=o/Math.cos(Math.PI/180*this.lat);return new oo(new Nr(this.lng-s,this.lat-o),new Nr(this.lng+s,this.lat+o))},Nr.convert=function(t){if(t instanceof Nr)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Nr(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Nr(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ms=2*Math.PI*63710088e-1;function Hf(t){return Ms*Math.cos(t*Math.PI/180)}function id(t){return(180+t)/360}function Kf(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Yf(t,o){return t/Hf(o)}function $d(t){var o=180-360*t;return 360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90}var eu=function(t,o,s){s===void 0&&(s=0),this.x=+t,this.y=+o,this.z=+s};eu.fromLngLat=function(t,o){o===void 0&&(o=0);var s=Nr.convert(t);return new eu(id(s.lng),Kf(s.lat),Yf(o,s.lat))},eu.prototype.toLngLat=function(){return new Nr(360*this.x-180,$d(this.y))},eu.prototype.toAltitude=function(){return t=this.z,o=this.y,t*Hf($d(o));var t,o},eu.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ms*(t=$d(this.y),1/Math.cos(t*Math.PI/180));var t};var Dc=function(t,o,s){this.z=t,this.x=o,this.y=s,this.key=tu(0,t,t,o,s)};Dc.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Dc.prototype.url=function(t,o){var s,f,b,S,M,L=(s=this.x,f=this.y,b=this.z,S=Wd(256*s,256*(f=Math.pow(2,b)-f-1),b),M=Wd(256*(s+1),256*(f+1),b),S[0]+","+S[1]+","+M[0]+","+M[1]),U=function(W,K,ie){for(var le,ae="",he=W;he>0;he--)ae+=(K&(le=1<<he-1)?1:0)+(ie&le?2:0);return ae}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",U).replace("{bbox-epsg-3857}",L)},Dc.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new Kt((t.x*o-this.x)*de,(t.y*o-this.y)*de)},Dc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Hd=function(t,o){this.wrap=t,this.canonical=o,this.key=tu(t,o.z,o.z,o.x,o.y)},kn=function(t,o,s,f,b){this.overscaledZ=t,this.wrap=o,this.canonical=new Dc(s,+f,+b),this.key=tu(o,t,s,f,b)};function tu(t,o,s,f,b){(t*=2)<0&&(t=-1*t-1);var S=1<<s;return(S*S*t+S*b+f).toString(36)+s.toString(36)+o.toString(36)}kn.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},kn.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new kn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new kn(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},kn.prototype.calculateScaledKey=function(t,o){var s=this.canonical.z-t;return t>this.canonical.z?tu(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):tu(this.wrap*+o,t,t,this.canonical.x>>s,this.canonical.y>>s)},kn.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},kn.prototype.children=function(t){if(this.overscaledZ>=t)return[new kn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,s=2*this.canonical.x,f=2*this.canonical.y;return[new kn(o,this.wrap,o,s,f),new kn(o,this.wrap,o,s+1,f),new kn(o,this.wrap,o,s,f+1),new kn(o,this.wrap,o,s+1,f+1)]},kn.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},kn.prototype.wrapped=function(){return new kn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},kn.prototype.unwrapTo=function(t){return new kn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},kn.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},kn.prototype.toUnwrapped=function(){return new Hd(this.wrap,this.canonical)},kn.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},kn.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new eu(t.x-this.wrap,t.y))},Jt("CanonicalTileID",Dc),Jt("OverscaledTileID",kn,{omit:["posMatrix"]});var iu=function(t,o,s){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return En('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var f=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=s||"mapbox";for(var b=0;b<f;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(f,b)]=this.data[this._idx(f-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,f)]=this.data[this._idx(b,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};iu.prototype.get=function(t,o){var s=new Uint8Array(this.data.buffer),f=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[f],s[f+1],s[f+2])},iu.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},iu.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},iu.prototype._unpackMapbox=function(t,o,s){return(256*t*256+256*o+s)/10-1e4},iu.prototype._unpackTerrarium=function(t,o,s){return 256*t+o+s/256-32768},iu.prototype.getPixels=function(){return new zn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},iu.prototype.backfillBorder=function(t,o,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var f=o*this.dim,b=o*this.dim+this.dim,S=s*this.dim,M=s*this.dim+this.dim;switch(o){case-1:f=b-1;break;case 1:b=f+1}switch(s){case-1:S=M-1;break;case 1:M=S+1}for(var L=-o*this.dim,U=-s*this.dim,W=S;W<M;W++)for(var K=f;K<b;K++)this.data[this._idx(K,W)]=t.data[this._idx(K+L,W+U)]},Jt("DEMData",iu);var rd=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var s=t[o];this._stringToNumber[s]=o,this._numberToString[o]=s}};rd.prototype.encode=function(t){return this._stringToNumber[t]},rd.prototype.decode=function(t){return this._numberToString[t]};var nd=function(t,o,s,f,b){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=s,t._y=f,this.properties=t.properties,this.id=b},Kd={geometry:{configurable:!0}};Kd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Kd.geometry.set=function(t){this._geometry=t},nd.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(nd.prototype,Kd);var Vh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Vh.prototype.updateState=function(t,o,s){var f=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},tr(this.stateChanges[t][f],s),this.deletedStates[t]===null)for(var b in this.deletedStates[t]={},this.state[t])b!==f&&(this.deletedStates[t][b]=null);else if(this.deletedStates[t]&&this.deletedStates[t][f]===null)for(var S in this.deletedStates[t][f]={},this.state[t][f])s[S]||(this.deletedStates[t][f][S]=null);else for(var M in s)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][M]===null&&delete this.deletedStates[t][f][M]},Vh.prototype.removeFeatureState=function(t,o,s){if(this.deletedStates[t]!==null){var f=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&o!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][s]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(s in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][s]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}},Vh.prototype.getState=function(t,o){var s=String(o),f=this.state[t]||{},b=this.stateChanges[t]||{},S=tr({},f[s],b[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var M=this.deletedStates[t][o];if(M===null)return{};for(var L in M)delete S[L]}return S},Vh.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},Vh.prototype.coalesceChanges=function(t,o){var s={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var b={};for(var S in this.stateChanges[f])this.state[f][S]||(this.state[f][S]={}),tr(this.state[f][S],this.stateChanges[f][S]),b[S]=this.state[f][S];s[f]=b}for(var M in this.deletedStates){this.state[M]=this.state[M]||{};var L={};if(this.deletedStates[M]===null)for(var U in this.state[M])L[U]={},this.state[M][U]={};else for(var W in this.deletedStates[M]){if(this.deletedStates[M][W]===null)this.state[M][W]={};else for(var K=0,ie=Object.keys(this.deletedStates[M][W]);K<ie.length;K+=1){var le=ie[K];delete this.state[M][W][le]}L[W]=this.state[M][W]}s[M]=s[M]||{},tr(s[M],L)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var ae in t)t[ae].setFeatureState(s,o)};var ru=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xs(de,16,0),this.grid3D=new xs(de,16,0),this.featureIndexArray=new Cn,this.promoteId=o};function Jf(t){for(var o=1/0,s=1/0,f=-1/0,b=-1/0,S=0,M=t;S<M.length;S+=1){var L=M[S];o=Math.min(o,L.x),s=Math.min(s,L.y),f=Math.max(f,L.x),b=Math.max(b,L.y)}return{minX:o,minY:s,maxX:f,maxY:b}}function Yd(t,o){return o-t}ru.prototype.insert=function(t,o,s,f,b,S){var M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,f,b);for(var L=S?this.grid3D:this.grid,U=0;U<o.length;U++){for(var W=o[U],K=[1/0,1/0,-1/0,-1/0],ie=0;ie<W.length;ie++){var le=W[ie];K[0]=Math.min(K[0],le.x),K[1]=Math.min(K[1],le.y),K[2]=Math.max(K[2],le.x),K[3]=Math.max(K[3],le.y)}K[0]<de&&K[1]<de&&K[2]>=0&&K[3]>=0&&L.insert(M,K[0],K[1],K[2],K[3])}},ru.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Yu.VectorTile(new Np(this.rawTileData)).layers,this.sourceLayerCoder=new rd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ru.prototype.query=function(t,o,s){var f=this;this.loadVTLayers();for(var b=t.params||{},S=de/t.tileSize/t.scale,M=jc(b.filter),L=t.queryGeometry,U=t.queryPadding*S,W=Jf(L),K=this.grid.query(W.minX-U,W.minY-U,W.maxX+U,W.maxY+U),ie=Jf(t.cameraQueryGeometry),le=this.grid3D.query(ie.minX-U,ie.minY-U,ie.maxX+U,ie.maxY+U,function(it,bt,zt,St){return function(Ht,vi,hi,bi,pi){for(var si=0,Qt=Ht;si<Qt.length;si+=1){var br=Qt[si];if(vi<=br.x&&hi<=br.y&&bi>=br.x&&pi>=br.y)return!0}var Br=[new Kt(vi,hi),new Kt(vi,pi),new Kt(bi,pi),new Kt(bi,hi)];if(Ht.length>2){for(var Sr=0,er=Br;Sr<er.length;Sr+=1)if(kt(Ht,er[Sr]))return!0}for(var Yr=0;Yr<Ht.length-1;Yr++)if(ut(Ht[Yr],Ht[Yr+1],Br))return!0;return!1}(t.cameraQueryGeometry,it-U,bt-U,zt+U,St+U)}),ae=0,he=le;ae<he.length;ae+=1){var Me=he[ae];K.push(Me)}K.sort(Yd);for(var ke,Ve={},Ye=function(it){var bt=K[it];if(bt!==ke){ke=bt;var zt=f.featureIndexArray.get(bt),St=null;f.loadMatchingFeature(Ve,zt.bucketIndex,zt.sourceLayerIndex,zt.featureIndex,M,b.layers,o,function(Ht,vi,hi){St||(St=we(Ht));var bi={};return hi!==void 0&&(bi=s.getState(vi.sourceLayer||"_geojsonTileLayer",hi)),vi.queryIntersectsFeature(L,Ht,bi,St,f.z,t.transform,S,t.pixelPosMatrix)})}},He=0;He<K.length;He++)Ye(He);return Ve},ru.prototype.loadMatchingFeature=function(t,o,s,f,b,S,M,L){var U=this.bucketLayerIDs[o];if(!S||function(Ye,He){for(var it=0;it<Ye.length;it++)if(He.indexOf(Ye[it])>=0)return!0;return!1}(S,U)){var W=this.sourceLayerCoder.decode(s),K=this.vtLayers[W].feature(f);if(b(new qr(this.tileID.overscaledZ),K))for(var ie=this.getId(K,W),le=0;le<U.length;le++){var ae=U[le];if(!(S&&S.indexOf(ae)<0)){var he=M[ae];if(he){var Me=!L||L(K,he,ie);if(Me){var ke=new nd(K,this.z,this.x,this.y,ie);ke.layer=he.serialize();var Ve=t[ae];Ve===void 0&&(Ve=t[ae]=[]),Ve.push({featureIndex:f,feature:ke,intersectionZ:Me})}}}}}},ru.prototype.lookupSymbolFeatures=function(t,o,s,f,b,S){var M={};this.loadVTLayers();for(var L=jc(f),U=0,W=t;U<W.length;U+=1){var K=W[U];this.loadMatchingFeature(M,o,s,K,L,b,S)}return M},ru.prototype.hasLayer=function(t){for(var o=0,s=this.bucketLayerIDs;o<s.length;o+=1)for(var f=0,b=s[o];f<b.length;f+=1)if(t===b[f])return!0;return!1},ru.prototype.getId=function(t,o){var s=t.id;if(this.promoteId){var f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];typeof(s=t.properties[f])=="boolean"&&(s=Number(s))}return s},Jt("FeatureIndex",ru,{omit:["rawTileData","sourceLayerCoder"]});var No=function(t,o){this.tileID=t,this.uid=Wn(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};No.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<_a.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},No.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},No.prototype.loadVectorData=function(t,o,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var f in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(W,K){var ie={};if(!K)return ie;for(var le=function(){var Me=he[ae],ke=Me.layerIds.map(function(it){return K.getLayer(it)}).filter(Boolean);if(ke.length!==0){Me.layers=ke,Me.stateDependentLayerIds&&(Me.stateDependentLayers=Me.stateDependentLayerIds.map(function(it){return ke.filter(function(bt){return bt.id===it})[0]}));for(var Ve=0,Ye=ke;Ve<Ye.length;Ve+=1){var He=Ye[Ve];ie[He.id]=Me}}},ae=0,he=W;ae<he.length;ae+=1)le();return ie}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var b=this.buckets[f];if(b instanceof Rr){if(this.hasSymbolBuckets=!0,!s)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var S in this.buckets){var M=this.buckets[S];if(M instanceof Rr&&M.hasRTLText){this.hasRTLText=!0,Bo.isLoading()||Bo.isLoaded()||cl()!=="deferred"||Qa();break}}for(var L in this.queryPadding=0,this.buckets){var U=this.buckets[L];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(L).queryRadius(U))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Ni},No.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},No.prototype.getBucket=function(t){return this.buckets[t.id]},No.prototype.upload=function(t){for(var o in this.buckets){var s=this.buckets[o];s.uploadPending()&&s.upload(t)}var f=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new sh(t,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new sh(t,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},No.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},No.prototype.queryRenderedFeatures=function(t,o,s,f,b,S,M,L,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:s,cameraQueryGeometry:f,scale:b,tileSize:this.tileSize,pixelPosMatrix:U,transform:M,params:S,queryPadding:this.queryPadding*L},t,o):{}},No.prototype.querySourceFeatures=function(t,o){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var f=s.loadVTLayers(),b=o?o.sourceLayer:"",S=f._geojsonTileLayer||f[b];if(S)for(var M=jc(o&&o.filter),L=this.tileID.canonical,U=L.z,W=L.x,K=L.y,ie={z:U,x:W,y:K},le=0;le<S.length;le++){var ae=S.feature(le);if(M(new qr(this.tileID.overscaledZ),ae)){var he=s.getId(ae,b),Me=new nd(ae,U,W,K,he);Me.tile=ie,t.push(Me)}}}},No.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},No.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},No.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var s=us(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var f=Date.now(),b=!1;if(this.expirationTime>f)b=!1;else if(o)if(this.expirationTime<o)b=!0;else{var S=this.expirationTime-o;S?this.expirationTime=f+Math.max(S,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},No.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},No.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets){var b=this.buckets[f],S=b.layers[0].sourceLayer||"_geojsonTileLayer",M=s[S],L=t[S];M&&L&&Object.keys(L).length!==0&&(b.update(L,M,this.imageAtlas&&this.imageAtlas.patternPositions||{}),o&&o.style&&(this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(f).queryRadius(b))))}}},No.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},No.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_a.now()},No.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},No.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=_a.now()+t},No.prototype.setDependencies=function(t,o){for(var s={},f=0,b=o;f<b.length;f+=1)s[b[f]]=!0;this.dependencies[t]=s},No.prototype.hasDependency=function(t,o){for(var s=0,f=t;s<f.length;s+=1){var b=f[s],S=this.dependencies[b];if(S){for(var M=0,L=o;M<L.length;M+=1)if(S[L[M]])return!0}}return!1};var _l=self.performance,Qf=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},_l.mark(this._marks.start)};Qf.prototype.finish=function(){_l.mark(this._marks.end);var t=_l.getEntriesByName(this._marks.measure);return t.length===0&&(_l.measure(this._marks.measure,this._marks.start,this._marks.end),t=_l.getEntriesByName(this._marks.measure),_l.clearMarks(this._marks.start),_l.clearMarks(this._marks.end),_l.clearMeasures(this._marks.measure)),t},T.Actor=lh,T.AlphaImage=Hn,T.CanonicalTileID=Dc,T.CollisionBoxArray=Ni,T.Color=Ei,T.DEMData=iu,T.DataConstantProperty=ai,T.DictionaryCoder=rd,T.EXTENT=de,T.ErrorEvent=Li,T.EvaluationParameters=qr,T.Event=mi,T.Evented=li,T.FeatureIndex=ru,T.FillBucket=nc,T.FillExtrusionBucket=Oa,T.ImageAtlas=kh,T.ImagePosition=Gp,T.LineBucket=Oo,T.LngLat=Nr,T.LngLatBounds=oo,T.MercatorCoordinate=eu,T.ONE_EM=xo,T.OverscaledTileID=kn,T.Point=Kt,T.Point$1=Kt,T.Properties=p,T.Protobuf=Np,T.RGBAImage=zn,T.RequestManager=On,T.RequestPerformance=Qf,T.ResourceType=Ce,T.SegmentVector=Lr,T.SourceFeatureState=Vh,T.StructArrayLayout1ui2=Nt,T.StructArrayLayout2i4=Q,T.StructArrayLayout2ui4=ni,T.StructArrayLayout3ui6=ei,T.StructArrayLayout4i8=oe,T.SymbolBucket=Rr,T.Texture=sh,T.Tile=No,T.Transitionable=is,T.Uniform1f=Fa,T.Uniform1i=Ac,T.Uniform2f=m,T.Uniform3f=n,T.Uniform4f=l,T.UniformColor=g,T.UniformMatrix4f=E,T.UnwrappedTileID=Hd,T.ValidationError=X,T.WritingMode=Xs,T.ZoomHistory=Yl,T.add=function(t,o,s){return t[0]=o[0]+s[0],t[1]=o[1]+s[1],t[2]=o[2]+s[2],t},T.addDynamicAttributes=Yp,T.asyncAll=function(t,o,s){if(!t.length)return s(null,[]);var f=t.length,b=new Array(t.length),S=null;t.forEach(function(M,L){o(M,function(U,W){U&&(S=U),b[L]=W,--f==0&&s(S,b)})})},T.bezier=Gt,T.bindAll=Ao,T.browser=_a,T.cacheEntryPossiblyAdded=function(t){++Rs>fs&&(t.getActor().send("enforceCacheSizeLimit",ds),Rs=0)},T.clamp=Di,T.clearTileCache=function(t){var o=self.caches.delete(Ca);t&&o.catch(t).then(function(){return t()})},T.clone=function(t){var o=new Ai(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},T.clone$1=jr,T.clone$2=function(t){var o=new Ai(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},T.config=pn,T.create=function(){var t=new Ai(16);return Ai!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},T.create$1=function(){var t=new Ai(9);return Ai!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},T.create$2=function(){var t=new Ai(4);return Ai!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},T.createCommonjsModule=Gi,T.createExpression=Tl,T.createLayout=O,T.createStyleLayer=function(t){return t.type==="custom"?new Xf(t):new Am[t.type](t)},T.cross=function(t,o,s){var f=o[0],b=o[1],S=o[2],M=s[0],L=s[1],U=s[2];return t[0]=b*U-S*L,t[1]=S*M-f*U,t[2]=f*L-b*M,t},T.deepEqual=function t(o,s){if(Array.isArray(o)){if(!Array.isArray(s)||o.length!==s.length)return!1;for(var f=0;f<o.length;f++)if(!t(o[f],s[f]))return!1;return!0}if(typeof o=="object"&&o!==null&&s!==null){if(typeof s!="object"||Object.keys(o).length!==Object.keys(s).length)return!1;for(var b in o)if(!t(o[b],s[b]))return!1;return!0}return o===s},T.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},T.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},T.ease=di,T.emitValidationErrors=wc,T.endsWith=to,T.enforceCacheSizeLimit=function(t){ja(),Co&&Co.then(function(o){o.keys().then(function(s){for(var f=0;f<s.length-t;f++)o.delete(s[f])})})},T.evaluateSizeForFeature=Vd,T.evaluateSizeForZoom=Xp,T.evaluateVariableOffset=Wp,T.evented=Pl,T.extend=tr,T.featureFilter=jc,T.filterObject=ra,T.fromRotation=function(t,o){var s=Math.sin(o),f=Math.cos(o);return t[0]=f,t[1]=s,t[2]=0,t[3]=-s,t[4]=f,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},T.getAnchorAlignment=Lh,T.getAnchorJustification=$p,T.getArrayBuffer=Ze,T.getImage=vt,T.getJSON=function(t,o){return De(tr(t,{type:"json"}),o)},T.getRTLTextPluginStatus=cl,T.getReferrer=re,T.getVideo=function(t,o){var s,f,b=self.document.createElement("video");b.muted=!0,b.onloadstart=function(){o(null,b)};for(var S=0;S<t.length;S++){var M=self.document.createElement("source");s=t[S],f=void 0,(f=self.document.createElement("a")).href=s,(f.protocol!==self.document.location.protocol||f.host!==self.document.location.host)&&(b.crossOrigin="Anonymous"),M.src=t[S],b.appendChild(M)}return{cancel:function(){}}},T.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},T.invert=function(t,o){var s=o[0],f=o[1],b=o[2],S=o[3],M=o[4],L=o[5],U=o[6],W=o[7],K=o[8],ie=o[9],le=o[10],ae=o[11],he=o[12],Me=o[13],ke=o[14],Ve=o[15],Ye=s*L-f*M,He=s*U-b*M,it=s*W-S*M,bt=f*U-b*L,zt=f*W-S*L,St=b*W-S*U,Ht=K*Me-ie*he,vi=K*ke-le*he,hi=K*Ve-ae*he,bi=ie*ke-le*Me,pi=ie*Ve-ae*Me,si=le*Ve-ae*ke,Qt=Ye*si-He*pi+it*bi+bt*hi-zt*vi+St*Ht;return Qt?(Qt=1/Qt,t[0]=(L*si-U*pi+W*bi)*Qt,t[1]=(b*pi-f*si-S*bi)*Qt,t[2]=(Me*St-ke*zt+Ve*bt)*Qt,t[3]=(le*zt-ie*St-ae*bt)*Qt,t[4]=(U*hi-M*si-W*vi)*Qt,t[5]=(s*si-b*hi+S*vi)*Qt,t[6]=(ke*it-he*St-Ve*He)*Qt,t[7]=(K*St-le*it+ae*He)*Qt,t[8]=(M*pi-L*hi+W*Ht)*Qt,t[9]=(f*hi-s*pi-S*Ht)*Qt,t[10]=(he*zt-Me*it+Ve*Ye)*Qt,t[11]=(ie*it-K*zt-ae*Ye)*Qt,t[12]=(L*vi-M*bi-U*Ht)*Qt,t[13]=(s*bi-f*vi+b*Ht)*Qt,t[14]=(Me*He-he*bt-ke*Ye)*Qt,t[15]=(K*bt-ie*He+le*Ye)*Qt,t):null},T.isChar=Yt,T.isMapboxURL=Ui,T.keysDifference=function(t,o){var s=[];for(var f in t)f in o||s.push(f);return s},T.makeRequest=De,T.mapObject=Mo,T.mercatorXfromLng=id,T.mercatorYfromLat=Kf,T.mercatorZfromAltitude=Yf,T.multiply=function(t,o,s){var f=o[0],b=o[1],S=o[2],M=o[3],L=o[4],U=o[5],W=o[6],K=o[7],ie=o[8],le=o[9],ae=o[10],he=o[11],Me=o[12],ke=o[13],Ve=o[14],Ye=o[15],He=s[0],it=s[1],bt=s[2],zt=s[3];return t[0]=He*f+it*L+bt*ie+zt*Me,t[1]=He*b+it*U+bt*le+zt*ke,t[2]=He*S+it*W+bt*ae+zt*Ve,t[3]=He*M+it*K+bt*he+zt*Ye,He=s[4],it=s[5],bt=s[6],zt=s[7],t[4]=He*f+it*L+bt*ie+zt*Me,t[5]=He*b+it*U+bt*le+zt*ke,t[6]=He*S+it*W+bt*ae+zt*Ve,t[7]=He*M+it*K+bt*he+zt*Ye,He=s[8],it=s[9],bt=s[10],zt=s[11],t[8]=He*f+it*L+bt*ie+zt*Me,t[9]=He*b+it*U+bt*le+zt*ke,t[10]=He*S+it*W+bt*ae+zt*Ve,t[11]=He*M+it*K+bt*he+zt*Ye,He=s[12],it=s[13],bt=s[14],zt=s[15],t[12]=He*f+it*L+bt*ie+zt*Me,t[13]=He*b+it*U+bt*le+zt*ke,t[14]=He*S+it*W+bt*ae+zt*Ve,t[15]=He*M+it*K+bt*he+zt*Ye,t},T.mvt=Yu,T.normalize=function(t,o){var s=o[0],f=o[1],b=o[2],S=s*s+f*f+b*b;return S>0&&(S=1/Math.sqrt(S)),t[0]=o[0]*S,t[1]=o[1]*S,t[2]=o[2]*S,t},T.number=Sn,T.offscreenCanvasSupported=yl,T.ortho=function(t,o,s,f,b,S,M){var L=1/(o-s),U=1/(f-b),W=1/(S-M);return t[0]=-2*L,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*U,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*W,t[11]=0,t[12]=(o+s)*L,t[13]=(b+f)*U,t[14]=(M+S)*W,t[15]=1,t},T.parseGlyphPBF=function(t){return new Np(t).readFields(kc,[])},T.pbf=Np,T.performSymbolLayout=function(t,o,s,f,b,S){t.createArrays();var M=512*t.overscaling;t.tilePixelRatio=de/M,t.compareText={},t.iconsNeedLinear=!1;var L=t.layers[0].layout,U=t.layers[0]._unevaluatedLayout._values,W={};if(t.textSizeData.kind==="composite"){var K=t.textSizeData,ie=K.minZoom,le=K.maxZoom;W.compositeTextSizes=[U["text-size"].possiblyEvaluate(new qr(ie)),U["text-size"].possiblyEvaluate(new qr(le))]}if(t.iconSizeData.kind==="composite"){var ae=t.iconSizeData,he=ae.minZoom,Me=ae.maxZoom;W.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new qr(he)),U["icon-size"].possiblyEvaluate(new qr(Me))]}W.layoutTextSize=U["text-size"].possiblyEvaluate(new qr(t.zoom+1)),W.layoutIconSize=U["icon-size"].possiblyEvaluate(new qr(t.zoom+1)),W.textMaxSize=U["text-size"].possiblyEvaluate(new qr(18));for(var ke=L.get("text-line-height")*xo,Ve=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ye=L.get("text-keep-upright"),He=L.get("text-size"),it=function(){var St=zt[bt],Ht=L.get("text-font").evaluate(St,{}).join(","),vi=He.evaluate(St,{}),hi=W.layoutTextSize.evaluate(St,{}),bi=W.layoutIconSize.evaluate(St,{}),pi={horizontal:{},vertical:void 0},si=St.text,Qt=[0,0];if(si){var br=si.toString(),Br=L.get("text-letter-spacing").evaluate(St,{})*xo,Sr=function(Er){for(var Zr=0,gn=Er;Zr<gn.length;Zr+=1)if(!Cl(gn[Zr].charCodeAt(0)))return!1;return!0}(br)?Br:0,er=L.get("text-anchor").evaluate(St,{}),Yr=L.get("text-variable-anchor");if(!Yr){var Cr=L.get("text-radial-offset").evaluate(St,{});Qt=Cr?Wp(er,[Cr*xo,qd]):L.get("text-offset").evaluate(St,{}).map(function(Er){return Er*xo})}var mr=Ve?"center":L.get("text-justify").evaluate(St,{}),Ir=L.get("symbol-placement"),Jr=Ir==="point"?L.get("text-max-width").evaluate(St,{})*xo:0,ao=function(){t.allowVerticalPlacement&&ua(br)&&(pi.vertical=_p(si,o,s,b,Ht,Jr,ke,er,"left",Sr,Qt,Xs.vertical,!0,Ir,hi,vi))};if(!Ve&&Yr){for(var Yn=mr==="auto"?Yr.map(function(Er){return $p(Er)}):[mr],pa=!1,da=0;da<Yn.length;da++){var Nn=Yn[da];if(!pi.horizontal[Nn])if(pa)pi.horizontal[Nn]=pi.horizontal[0];else{var so=_p(si,o,s,b,Ht,Jr,ke,"center",Nn,Sr,Qt,Xs.horizontal,!1,Ir,hi,vi);so&&(pi.horizontal[Nn]=so,pa=so.positionedLines.length===1)}}ao()}else{mr==="auto"&&(mr=$p(er));var jo=_p(si,o,s,b,Ht,Jr,ke,er,mr,Sr,Qt,Xs.horizontal,!1,Ir,hi,vi);jo&&(pi.horizontal[mr]=jo),ao(),ua(br)&&Ve&&Ye&&(pi.vertical=_p(si,o,s,b,Ht,Jr,ke,er,mr,Sr,Qt,Xs.vertical,!1,Ir,hi,vi))}}var wo=void 0,To=!1;if(St.icon&&St.icon.name){var Dn=f[St.icon.name];Dn&&(wo=function(Er,Zr,gn){var yn=Lh(gn),Eo=yn.horizontalAlign,cn=yn.verticalAlign,Qo=Zr[0],jn=Zr[1],Ws=Qo-Er.displaySize[0]*Eo,ea=Ws+Er.displaySize[0],un=jn-Er.displaySize[1]*cn;return{image:Er,top:un,bottom:un+Er.displaySize[1],left:Ws,right:ea}}(b[St.icon.name],L.get("icon-offset").evaluate(St,{}),L.get("icon-anchor").evaluate(St,{})),To=Dn.sdf,t.sdfIcons===void 0?t.sdfIcons=Dn.sdf:t.sdfIcons!==Dn.sdf&&En("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Dn.pixelRatio!==t.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var Jn=xp(pi.horizontal)||pi.vertical;t.iconsInText=!!Jn&&Jn.iconsInText,(Jn||wo)&&function(Er,Zr,gn,yn,Eo,cn,Qo,jn,Ws,ea){var un=cn.textMaxSize.evaluate(Zr,{});un===void 0&&(un=Qo);var Ua,Qn=Er.layers[0].layout,ls=Qn.get("icon-offset").evaluate(Zr,{}),ac=xp(gn.horizontal),Ul=Qo/24,bp=Er.tilePixelRatio*Ul,Lc=Er.tilePixelRatio*un/24,Jd=Er.tilePixelRatio*jn,Nh=Er.tilePixelRatio*Qn.get("symbol-spacing"),od=Qn.get("text-padding")*Er.tilePixelRatio,jh=Qn.get("icon-padding")*Er.tilePixelRatio,Au=Qn.get("text-max-angle")/180*Math.PI,ad=Qn.get("text-rotation-alignment")==="map"&&Qn.get("symbol-placement")!=="point",sd=Qn.get("icon-rotation-alignment")==="map"&&Qn.get("symbol-placement")!=="point",qh=Qn.get("symbol-placement"),nu=Nh/2,ch=Qn.get("icon-text-fit");yn&&ch!=="none"&&(Er.allowVerticalPlacement&&gn.vertical&&(Ua=Rh(yn,gn.vertical,ch,Qn.get("icon-text-fit-padding"),ls,Ul)),ac&&(yn=Rh(yn,ac,ch,Qn.get("icon-text-fit-padding"),ls,Ul)));var Mu=function(pd,Hs){Hs.x<0||Hs.x>=de||Hs.y<0||Hs.y>=de||function(Fr,ta,Ks,lc,hh,$h,cc,Sa,Yi,Wr,ph,Hh,ef,tm,Mp,tf,dd,cs,fd,rf,eo,Cp,Kh){var zu,Pu,ku,zp,Yh,dh=Fr.addToLineVertexArray(ta,Ks),im=0,nf=0,of=0,md=0,_d=-1,af=-1,Bc={},Fc=ha(""),gd=0,yd=0;if(Sa._unevaluatedLayout.getValue("text-radial-offset")===void 0?(zu=Sa.layout.get("text-offset").evaluate(eo,{}).map(function(zm){return zm*xo}),gd=zu[0],yd=zu[1]):(gd=Sa.layout.get("text-radial-offset").evaluate(eo,{})*xo,yd=qd),Fr.allowVerticalPlacement&&lc.vertical){var sf=Sa.layout.get("text-rotate").evaluate(eo,{})+90,rm=lc.vertical;zp=new Fh(Yi,Ks,ta,Wr,ph,Hh,rm,ef,tm,Mp,Fr.overscaling,sf),cc&&(Yh=new Fh(Yi,Ks,ta,Wr,ph,Hh,cc,dd,cs,Mp,Fr.overscaling,sf))}if(hh){var lf=Sa.layout.get("icon-rotate").evaluate(eo,{}),nm=Sa.layout.get("icon-text-fit")!=="none",cf=oc(hh,lf,Kh,nm),vd=cc?oc(cc,lf,Kh,nm):void 0;ku=new Fh(Yi,Ks,ta,Wr,ph,Hh,hh,dd,cs,!1,Fr.overscaling,lf),im=4*cf.length;var Jh=Fr.iconSizeData,Qh=null;Jh.kind==="source"?(Qh=[Bl*Sa.layout.get("icon-size").evaluate(eo,{})])[0]>ss&&En(Fr.layerIds[0]+': Value for "icon-size" is >= '+vp+'. Reduce your "icon-size".'):Jh.kind==="composite"&&((Qh=[Bl*Cp.compositeIconSizes[0].evaluate(eo,{}),Bl*Cp.compositeIconSizes[1].evaluate(eo,{})])[0]>ss||Qh[1]>ss)&&En(Fr.layerIds[0]+': Value for "icon-size" is >= '+vp+'. Reduce your "icon-size".'),Fr.addSymbols(Fr.icon,cf,Qh,rf,fd,eo,!1,ta,dh.lineStartIndex,dh.lineLength,-1),_d=Fr.icon.placedSymbolArray.length-1,vd&&(nf=4*vd.length,Fr.addSymbols(Fr.icon,vd,Qh,rf,fd,eo,Xs.vertical,ta,dh.lineStartIndex,dh.lineLength,-1),af=Fr.icon.placedSymbolArray.length-1)}for(var uf in lc.horizontal){var Ys=lc.horizontal[uf];if(!Pu){Fc=ha(Ys.text);var hf=Sa.layout.get("text-rotate").evaluate(eo,{});Pu=new Fh(Yi,Ks,ta,Wr,ph,Hh,Ys,ef,tm,Mp,Fr.overscaling,hf)}var fh=Ys.positionedLines.length===1;if(of+=Su(Fr,ta,Ys,$h,Sa,Mp,eo,tf,dh,lc.vertical?Xs.horizontal:Xs.horizontalOnly,fh?Object.keys(lc.horizontal):[uf],Bc,_d,Cp),fh)break}lc.vertical&&(md+=Su(Fr,ta,lc.vertical,$h,Sa,Mp,eo,tf,dh,Xs.vertical,["vertical"],Bc,af,Cp));var ep=Pu?Pu.boxStartIndex:Fr.collisionBoxArray.length,om=Pu?Pu.boxEndIndex:Fr.collisionBoxArray.length,xd=zp?zp.boxStartIndex:Fr.collisionBoxArray.length,am=zp?zp.boxEndIndex:Fr.collisionBoxArray.length,bd=ku?ku.boxStartIndex:Fr.collisionBoxArray.length,wd=ku?ku.boxEndIndex:Fr.collisionBoxArray.length,Mm=Yh?Yh.boxStartIndex:Fr.collisionBoxArray.length,Cm=Yh?Yh.boxEndIndex:Fr.collisionBoxArray.length;Fr.glyphOffsetArray.length>=Rr.MAX_GLYPHS&&En("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),eo.sortKey!==void 0&&Fr.addToSortKeyRanges(Fr.symbolInstances.length,eo.sortKey),Fr.symbolInstances.emplaceBack(ta.x,ta.y,Bc.right>=0?Bc.right:-1,Bc.center>=0?Bc.center:-1,Bc.left>=0?Bc.left:-1,Bc.vertical||-1,_d,af,Fc,ep,om,xd,am,bd,wd,Mm,Cm,Wr,of,md,im,nf,0,ef,gd,yd)}(Er,Hs,pd,gn,yn,Eo,Ua,Er.layers[0],Er.collisionBoxArray,Zr.index,Zr.sourceLayerIndex,Er.index,bp,od,ad,Ws,Jd,jh,sd,ls,Zr,cn,ea)};if(qh==="line")for(var Gh=0,wp=function(pd,Hs,Fr,ta,Ks){for(var lc=[],hh=0;hh<pd.length;hh++)for(var $h=pd[hh],cc=void 0,Sa=0;Sa<$h.length-1;Sa++){var Yi=$h[Sa],Wr=$h[Sa+1];Yi.x<Hs&&Wr.x<Hs||(Yi.x<Hs?Yi=new Kt(Hs,Yi.y+(Wr.y-Yi.y)*((Hs-Yi.x)/(Wr.x-Yi.x)))._round():Wr.x<Hs&&(Wr=new Kt(Hs,Yi.y+(Wr.y-Yi.y)*((Hs-Yi.x)/(Wr.x-Yi.x)))._round()),Yi.y<Fr&&Wr.y<Fr||(Yi.y<Fr?Yi=new Kt(Yi.x+(Wr.x-Yi.x)*((Fr-Yi.y)/(Wr.y-Yi.y)),Fr)._round():Wr.y<Fr&&(Wr=new Kt(Yi.x+(Wr.x-Yi.x)*((Fr-Yi.y)/(Wr.y-Yi.y)),Fr)._round()),Yi.x>=ta&&Wr.x>=ta||(Yi.x>=ta?Yi=new Kt(ta,Yi.y+(Wr.y-Yi.y)*((ta-Yi.x)/(Wr.x-Yi.x)))._round():Wr.x>=ta&&(Wr=new Kt(ta,Yi.y+(Wr.y-Yi.y)*((ta-Yi.x)/(Wr.x-Yi.x)))._round()),Yi.y>=Ks&&Wr.y>=Ks||(Yi.y>=Ks?Yi=new Kt(Yi.x+(Wr.x-Yi.x)*((Ks-Yi.y)/(Wr.y-Yi.y)),Ks)._round():Wr.y>=Ks&&(Wr=new Kt(Yi.x+(Wr.x-Yi.x)*((Ks-Yi.y)/(Wr.y-Yi.y)),Ks)._round()),cc&&Yi.equals(cc[cc.length-1])||(cc=[Yi],lc.push(cc)),cc.push(Wr)))))}return lc}(Zr.geometry,0,0,de,de);Gh<wp.length;Gh+=1)for(var ld=wp[Gh],cd=_n(ld,Nh,Au,gn.vertical||ac,yn,24,Lc,Er.overscaling,de),Tp=0,So=cd;Tp<So.length;Tp+=1){var $s=So[Tp],Zh=ac;Zh&&Hp(Er,Zh.text,nu,$s)||Mu(ld,$s)}else if(qh==="line-center")for(var ou=0,au=Zr.geometry;ou<au.length;ou+=1){var Ep=au[ou];if(Ep.length>1){var ud=wu(Ep,Au,gn.vertical||ac,yn,24,Lc);ud&&Mu(Ep,ud)}}else if(Zr.type==="Polygon")for(var Rc=0,Xh=Pc(Zr.geometry,0);Rc<Xh.length;Rc+=1){var Sp=Xh[Rc],Ip=Oh(Sp,16);Mu(Sp[0],new xu(Ip.x,Ip.y,0))}else if(Zr.type==="LineString")for(var Cu=0,Wh=Zr.geometry;Cu<Wh.length;Cu+=1){var Xr=Wh[Cu];Mu(Xr,new xu(Xr[0].x,Xr[0].y,0))}else if(Zr.type==="Point")for(var Ap=0,Qd=Zr.geometry;Ap<Qd.length;Ap+=1)for(var em=Qd[Ap],sc=0,uh=em;sc<uh.length;sc+=1){var hd=uh[sc];Mu([hd],new xu(hd.x,hd.y,0))}}(t,St,pi,wo,f,W,hi,bi,Qt,To)},bt=0,zt=t.features;bt<zt.length;bt+=1)it();S&&t.generateCollisionDebugBuffers()},T.perspective=function(t,o,s,f,b){var S,M=1/Math.tan(o/2);return t[0]=M/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=M,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,b!=null&&b!==1/0?(S=1/(f-b),t[10]=(b+f)*S,t[14]=2*b*f*S):(t[10]=-1,t[14]=-2*f),t},T.pick=function(t,o){for(var s={},f=0;f<o.length;f++){var b=o[f];b in t&&(s[b]=t[b])}return s},T.plugin=Bo,T.polygonIntersectsPolygon=qe,T.postMapLoadEvent=zo,T.postTurnstileEvent=ql,T.potpack=fl,T.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],T.register=Jt,T.registerForPluginStateChange=function(t){return t({pluginStatus:Ho,pluginURL:bs}),Pl.on("pluginStateChange",t),t},T.rotate=function(t,o,s){var f=o[0],b=o[1],S=o[2],M=o[3],L=Math.sin(s),U=Math.cos(s);return t[0]=f*U+S*L,t[1]=b*U+M*L,t[2]=f*-L+S*U,t[3]=b*-L+M*U,t},T.rotateX=function(t,o,s){var f=Math.sin(s),b=Math.cos(s),S=o[4],M=o[5],L=o[6],U=o[7],W=o[8],K=o[9],ie=o[10],le=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=S*b+W*f,t[5]=M*b+K*f,t[6]=L*b+ie*f,t[7]=U*b+le*f,t[8]=W*b-S*f,t[9]=K*b-M*f,t[10]=ie*b-L*f,t[11]=le*b-U*f,t},T.rotateZ=function(t,o,s){var f=Math.sin(s),b=Math.cos(s),S=o[0],M=o[1],L=o[2],U=o[3],W=o[4],K=o[5],ie=o[6],le=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=S*b+W*f,t[1]=M*b+K*f,t[2]=L*b+ie*f,t[3]=U*b+le*f,t[4]=W*b-S*f,t[5]=K*b-M*f,t[6]=ie*b-L*f,t[7]=le*b-U*f,t},T.scale=function(t,o,s){var f=s[0],b=s[1],S=s[2];return t[0]=o[0]*f,t[1]=o[1]*f,t[2]=o[2]*f,t[3]=o[3]*f,t[4]=o[4]*b,t[5]=o[5]*b,t[6]=o[6]*b,t[7]=o[7]*b,t[8]=o[8]*S,t[9]=o[9]*S,t[10]=o[10]*S,t[11]=o[11]*S,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},T.scale$1=function(t,o,s){return t[0]=o[0]*s,t[1]=o[1]*s,t[2]=o[2]*s,t[3]=o[3]*s,t},T.scale$2=function(t,o,s){return t[0]=o[0]*s,t[1]=o[1]*s,t[2]=o[2]*s,t},T.setCacheLimits=function(t,o){ds=t,fs=o},T.setRTLTextPlugin=function(t,o,s){if(s===void 0&&(s=!1),Ho===Ta||Ho===ll||Ho===Sc)throw new Error("setRTLTextPlugin cannot be called multiple times.");bs=_a.resolveURL(t),Ho=Ta,zl=o,Xc(),s||Qa()},T.sphericalToCartesian=function(t){var o=t[0],s=t[1],f=t[2];return s+=90,s*=Math.PI/180,f*=Math.PI/180,{x:o*Math.cos(s)*Math.sin(f),y:o*Math.sin(s)*Math.sin(f),z:o*Math.cos(f)}},T.sqrLen=yr,T.styleSpec=V,T.sub=Fi,T.symbolSize=Of,T.transformMat3=function(t,o,s){var f=o[0],b=o[1],S=o[2];return t[0]=f*s[0]+b*s[3]+S*s[6],t[1]=f*s[1]+b*s[4]+S*s[7],t[2]=f*s[2]+b*s[5]+S*s[8],t},T.transformMat4=ur,T.translate=function(t,o,s){var f,b,S,M,L,U,W,K,ie,le,ae,he,Me=s[0],ke=s[1],Ve=s[2];return o===t?(t[12]=o[0]*Me+o[4]*ke+o[8]*Ve+o[12],t[13]=o[1]*Me+o[5]*ke+o[9]*Ve+o[13],t[14]=o[2]*Me+o[6]*ke+o[10]*Ve+o[14],t[15]=o[3]*Me+o[7]*ke+o[11]*Ve+o[15]):(f=o[0],b=o[1],S=o[2],M=o[3],L=o[4],U=o[5],W=o[6],K=o[7],ie=o[8],le=o[9],ae=o[10],he=o[11],t[0]=f,t[1]=b,t[2]=S,t[3]=M,t[4]=L,t[5]=U,t[6]=W,t[7]=K,t[8]=ie,t[9]=le,t[10]=ae,t[11]=he,t[12]=f*Me+L*ke+ie*Ve+o[12],t[13]=b*Me+U*ke+le*Ve+o[13],t[14]=S*Me+W*ke+ae*Ve+o[14],t[15]=M*Me+K*ke+he*Ve+o[15]),t},T.triggerPluginCompletionEvent=Ko,T.uniqueId=Wn,T.validateCustomStyleLayer=function(t){var o=[],s=t.id;return s===void 0&&o.push({message:"layers."+s+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+s+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),o},T.validateLight=rn,T.validateStyle=kr,T.values=function(t){var o=[];for(var s in t)o.push(t[s]);return o},T.vectorTile=Yu,T.version="1.8.0",T.warnOnce=En,T.webpSupported=ga,T.window=self,T.wrap=nr}),rr(["./shared"],function(T){function Gi(V){var X=typeof V;if(X==="number"||X==="boolean"||X==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var ee="[",pe=0,xe=V;pe<xe.length;pe+=1)ee+=Gi(xe[pe])+",";return ee+"]"}for(var Be=Object.keys(V).sort(),Xe="{",Re=0;Re<Be.length;Re++)Xe+=JSON.stringify(Be[Re])+":"+Gi(V[Be[Re]])+",";return Xe+"}"}function c(V){for(var X="",ee=0,pe=T.refProperties;ee<pe.length;ee+=1)X+="/"+Gi(V[pe[ee]]);return X}var st=function(V){this.keyCache={},V&&this.replace(V)};st.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},st.prototype.update=function(V,X){for(var ee=this,pe=0,xe=V;pe<xe.length;pe+=1){var Be=xe[pe];this._layerConfigs[Be.id]=Be;var Xe=this._layers[Be.id]=T.createStyleLayer(Be);Xe._featureFilter=T.featureFilter(Xe.filter),this.keyCache[Be.id]&&delete this.keyCache[Be.id]}for(var Re=0,Le=X;Re<Le.length;Re+=1){var Ae=Le[Re];delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae]}this.familiesBySource={};for(var ft=0,_t=function(Ti,zi){for(var Ji={},ir=0;ir<Ti.length;ir++){var zr=zi&&zi[Ti[ir].id]||c(Ti[ir]);zi&&(zi[Ti[ir].id]=zr);var Ei=Ji[zr];Ei||(Ei=Ji[zr]=[]),Ei.push(Ti[ir])}var lt=[];for(var dn in Ji)lt.push(Ji[dn]);return lt}(T.values(this._layerConfigs),this.keyCache);ft<_t.length;ft+=1){var rt=_t[ft].map(function(Ti){return ee._layers[Ti.id]}),Wt=rt[0];if(Wt.visibility!=="none"){var Zt=Wt.source||"",yi=this.familiesBySource[Zt];yi||(yi=this.familiesBySource[Zt]={});var _i=Wt.sourceLayer||"_geojsonTileLayer",ri=yi[_i];ri||(ri=yi[_i]=[]),ri.push(rt)}}};var Kt=function(V){var X={},ee=[];for(var pe in V){var xe=V[pe],Be=X[pe]={};for(var Xe in xe){var Re=xe[+Xe];if(Re&&Re.bitmap.width!==0&&Re.bitmap.height!==0){var Le={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};ee.push(Le),Be[Xe]={rect:Le,metrics:Re.metrics}}}}var Ae=T.potpack(ee),ft=Ae.w,_t=Ae.h,rt=new T.AlphaImage({width:ft||1,height:_t||1});for(var Wt in V){var Zt=V[Wt];for(var yi in Zt){var _i=Zt[+yi];if(_i&&_i.bitmap.width!==0&&_i.bitmap.height!==0){var ri=X[Wt][yi].rect;T.AlphaImage.copy(_i.bitmap,rt,{x:0,y:0},{x:ri.x+1,y:ri.y+1},_i.bitmap)}}}this.image=rt,this.positions=X};T.register("GlyphAtlas",Kt);var Zi=function(V){this.tileID=new T.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function Gt(V,X,ee){for(var pe=new T.EvaluationParameters(X),xe=0,Be=V;xe<Be.length;xe+=1)Be[xe].recalculate(pe,ee)}function di(V,X){var ee=T.getArrayBuffer(V.request,function(pe,xe,Be,Xe){pe?X(pe):xe&&X(null,{vectorTile:new T.vectorTile.VectorTile(new T.pbf(xe)),rawData:xe,cacheControl:Be,expires:Xe})});return function(){ee.cancel(),X()}}Zi.prototype.parse=function(V,X,ee,pe,xe){var Be=this;this.status="parsing",this.data=V,this.collisionBoxArray=new T.CollisionBoxArray;var Xe=new T.DictionaryCoder(Object.keys(V.layers).sort()),Re=new T.FeatureIndex(this.tileID,this.promoteId);Re.bucketLayerIDs=[];var Le,Ae,ft,_t,rt={},Wt={featureIndex:Re,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},Zt=X.familiesBySource[this.source];for(var yi in Zt){var _i=V.layers[yi];if(_i){_i.version===1&&T.warnOnce('Vector tile source "'+this.source+'" layer "'+yi+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var ri=Xe.encode(yi),Ti=[],zi=0;zi<_i.length;zi++){var Ji=_i.feature(zi),ir=Re.getId(Ji,yi);Ti.push({feature:Ji,id:ir,index:zi,sourceLayerIndex:ri})}for(var zr=0,Ei=Zt[yi];zr<Ei.length;zr+=1){var lt=Ei[zr],dn=lt[0];dn.minzoom&&this.zoom<Math.floor(dn.minzoom)||dn.maxzoom&&this.zoom>=dn.maxzoom||dn.visibility!=="none"&&(Gt(lt,this.zoom,ee),(rt[dn.id]=dn.createBucket({index:Re.bucketLayerIDs.length,layers:lt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source})).populate(Ti,Wt),Re.bucketLayerIDs.push(lt.map(function(Kr){return Kr.id})))}}}var Qi=T.mapObject(Wt.glyphDependencies,function(Kr){return Object.keys(Kr).map(Number)});Object.keys(Qi).length?pe.send("getGlyphs",{uid:this.uid,stacks:Qi},function(Kr,Or){Le||(Le=Kr,Ae=Or,dr.call(Be))}):Ae={};var _r=Object.keys(Wt.iconDependencies);_r.length?pe.send("getImages",{icons:_r,source:this.source,tileID:this.tileID,type:"icons"},function(Kr,Or){Le||(Le=Kr,ft=Or,dr.call(Be))}):ft={};var ba=Object.keys(Wt.patternDependencies);function dr(){if(Le)return xe(Le);if(Ae&&ft&&_t){var Kr=new Kt(Ae),Or=new T.ImageAtlas(ft,_t);for(var Un in rt){var Rt=rt[Un];Rt instanceof T.SymbolBucket?(Gt(Rt.layers,this.zoom,ee),T.performSymbolLayout(Rt,Ae,Kr.positions,ft,Or.iconPositions,this.showCollisionBoxes)):Rt.hasPattern&&(Rt instanceof T.LineBucket||Rt instanceof T.FillBucket||Rt instanceof T.FillExtrusionBucket)&&(Gt(Rt.layers,this.zoom,ee),Rt.addFeatures(Wt,Or.patternPositions))}this.status="done",xe(null,{buckets:T.values(rt).filter(function(Bi){return!Bi.isEmpty()}),featureIndex:Re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Kr.image,imageAtlas:Or,glyphMap:this.returnDependencies?Ae:null,iconMap:this.returnDependencies?ft:null,glyphPositions:this.returnDependencies?Kr.positions:null})}}ba.length?pe.send("getImages",{icons:ba,source:this.source,tileID:this.tileID,type:"patterns"},function(Kr,Or){Le||(Le=Kr,_t=Or,dr.call(Be))}):_t={},dr.call(this)};var Di=function(V,X,ee,pe){this.actor=V,this.layerIndex=X,this.availableImages=ee,this.loadVectorData=pe||di,this.loading={},this.loaded={}};Di.prototype.loadTile=function(V,X){var ee=this,pe=V.uid;this.loading||(this.loading={});var xe=!!(V&&V.request&&V.request.collectResourceTiming)&&new T.RequestPerformance(V.request),Be=this.loading[pe]=new Zi(V);Be.abort=this.loadVectorData(V,function(Xe,Re){if(delete ee.loading[pe],Xe||!Re)return Be.status="done",ee.loaded[pe]=Be,X(Xe);var Le=Re.rawData,Ae={};Re.expires&&(Ae.expires=Re.expires),Re.cacheControl&&(Ae.cacheControl=Re.cacheControl);var ft={};if(xe){var _t=xe.finish();_t&&(ft.resourceTiming=JSON.parse(JSON.stringify(_t)))}Be.vectorTile=Re.vectorTile,Be.parse(Re.vectorTile,ee.layerIndex,ee.availableImages,ee.actor,function(rt,Wt){if(rt||!Wt)return X(rt);X(null,T.extend({rawTileData:Le.slice(0)},Wt,Ae,ft))}),ee.loaded=ee.loaded||{},ee.loaded[pe]=Be})},Di.prototype.reloadTile=function(V,X){var ee=this,pe=this.loaded,xe=V.uid,Be=this;if(pe&&pe[xe]){var Xe=pe[xe];Xe.showCollisionBoxes=V.showCollisionBoxes;var Re=function(Le,Ae){var ft=Xe.reloadCallback;ft&&(delete Xe.reloadCallback,Xe.parse(Xe.vectorTile,Be.layerIndex,ee.availableImages,Be.actor,ft)),X(Le,Ae)};Xe.status==="parsing"?Xe.reloadCallback=Re:Xe.status==="done"&&(Xe.vectorTile?Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor,Re):Re())}},Di.prototype.abortTile=function(V,X){var ee=this.loading,pe=V.uid;ee&&ee[pe]&&ee[pe].abort&&(ee[pe].abort(),delete ee[pe]),X()},Di.prototype.removeTile=function(V,X){var ee=this.loaded,pe=V.uid;ee&&ee[pe]&&delete ee[pe],X()};var nr=T.window.ImageBitmap,tr=function(){this.loaded={}};tr.prototype.loadTile=function(V,X){var ee=V.uid,pe=V.encoding,xe=V.rawImageData,Be=nr&&xe instanceof nr?this.getImageData(xe):xe,Xe=new T.DEMData(ee,Be,pe);this.loaded=this.loaded||{},this.loaded[ee]=Xe,X(null,Xe)},tr.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var X=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new T.RGBAImage({width:X.width,height:X.height},X.data)},tr.prototype.removeTile=function(V){var X=this.loaded,ee=V.uid;X&&X[ee]&&delete X[ee]};var Xn={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4};function Wn(V){var X=0;if(V&&V.length>0){X+=Math.abs(co(V[0]));for(var ee=1;ee<V.length;ee++)X-=Math.abs(co(V[ee]))}return X}function co(V){var X,ee,pe,xe,Be,Xe,Re=0,Le=V.length;if(Le>2){for(Xe=0;Xe<Le;Xe++)Xe===Le-2?(pe=Le-2,xe=Le-1,Be=0):Xe===Le-1?(pe=Le-1,xe=0,Be=1):(pe=Xe,xe=Xe+1,Be=Xe+2),X=V[pe],ee=V[xe],Re+=(_o(V[Be][0])-_o(X[0]))*Math.sin(_o(ee[1]));Re=Re*Xn.RADIUS*Xn.RADIUS/2}return Re}function _o(V){return V*Math.PI/180}var Ao={geometry:function V(X){var ee,pe=0;switch(X.type){case"Polygon":return Wn(X.coordinates);case"MultiPolygon":for(ee=0;ee<X.coordinates.length;ee++)pe+=Wn(X.coordinates[ee]);return pe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ee=0;ee<X.geometries.length;ee++)pe+=V(X.geometries[ee]);return pe}},ring:co},to=function V(X,ee){switch(X&&X.type||null){case"FeatureCollection":return X.features=X.features.map(Mo(V,ee)),X;case"GeometryCollection":return X.geometries=X.geometries.map(Mo(V,ee)),X;case"Feature":return X.geometry=V(X.geometry,ee),X;case"Polygon":case"MultiPolygon":return function(pe,xe){return pe.type==="Polygon"?pe.coordinates=ra(pe.coordinates,xe):pe.type==="MultiPolygon"&&(pe.coordinates=pe.coordinates.map(Mo(ra,xe))),pe}(X,ee);default:return X}};function Mo(V,X){return function(ee){return V(ee,X)}}function ra(V,X){X=!!X,V[0]=jr(V[0],X);for(var ee=1;ee<V.length;ee++)V[ee]=jr(V[ee],!X);return V}function jr(V,X){return function(ee){return Ao.ring(ee)>=0}(V)===X?V:V.reverse()}var Xt=T.vectorTile.VectorTileFeature.prototype.toGeoJSON,En=function(V){this._feature=V,this.extent=T.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};En.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],X=0,ee=this._feature.geometry;X<ee.length;X+=1){var pe=ee[X];V.push([new T.Point$1(pe[0],pe[1])])}return V}for(var xe=[],Be=0,Xe=this._feature.geometry;Be<Xe.length;Be+=1){for(var Re=[],Le=0,Ae=Xe[Be];Le<Ae.length;Le+=1){var ft=Ae[Le];Re.push(new T.Point$1(ft[0],ft[1]))}xe.push(Re)}return xe},En.prototype.toGeoJSON=function(V,X,ee){return Xt.call(this,V,X,ee)};var Wo=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=T.EXTENT,this.length=V.length,this._features=V};Wo.prototype.feature=function(V){return new En(this._features[V])};var Ki=T.vectorTile.VectorTileFeature,en=us;function us(V,X){this.options=X||{},this.features=V,this.length=V.length}function fa(V,X){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=X||4096}us.prototype.feature=function(V){return new fa(this.features[V],this.options.extent)},fa.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var X=0;X<V.length;X++){for(var ee=V[X],pe=[],xe=0;xe<ee.length;xe++)pe.push(new T.Point$1(ee[xe][0],ee[xe][1]));this.geometry.push(pe)}return this.geometry},fa.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,X=1/0,ee=-1/0,pe=1/0,xe=-1/0,Be=0;Be<V.length;Be++)for(var Xe=V[Be],Re=0;Re<Xe.length;Re++){var Le=Xe[Re];X=Math.min(X,Le.x),ee=Math.max(ee,Le.x),pe=Math.min(pe,Le.y),xe=Math.max(xe,Le.y)}return[X,pe,ee,xe]},fa.prototype.toGeoJSON=Ki.prototype.toGeoJSON;var hs=tn,gl=tn,or=function(V,X){X=X||{};var ee={};for(var pe in V)ee[pe]=new en(V[pe].features,X),ee[pe].name=pe,ee[pe].version=X.version,ee[pe].extent=X.extent;return tn({layers:ee})},Cs=en;function tn(V){var X=new T.pbf;return function(ee,pe){for(var xe in ee.layers)pe.writeMessage(3,hn,ee.layers[xe])}(V,X),X.finish()}function hn(V,X){var ee;X.writeVarintField(15,V.version||1),X.writeStringField(1,V.name||""),X.writeVarintField(5,V.extent||4096);var pe={keys:[],values:[],keycache:{},valuecache:{}};for(ee=0;ee<V.length;ee++)pe.feature=V.feature(ee),X.writeMessage(2,zs,pe);var xe=pe.keys;for(ee=0;ee<xe.length;ee++)X.writeStringField(3,xe[ee]);var Be=pe.values;for(ee=0;ee<Be.length;ee++)X.writeMessage(4,ga,Be[ee])}function zs(V,X){var ee=V.feature;ee.id!==void 0&&X.writeVarintField(1,ee.id),X.writeMessage(2,Gn,V),X.writeVarintField(3,ee.type),X.writeMessage(4,pn,ee)}function Gn(V,X){var ee=V.feature,pe=V.keys,xe=V.values,Be=V.keycache,Xe=V.valuecache;for(var Re in ee.properties){var Le=Be[Re];Le===void 0&&(pe.push(Re),Le=pe.length-1,Be[Re]=Le),X.writeVarint(Le);var Ae=ee.properties[Re],ft=typeof Ae;ft!=="string"&&ft!=="boolean"&&ft!=="number"&&(Ae=JSON.stringify(Ae));var _t=ft+":"+Ae,rt=Xe[_t];rt===void 0&&(xe.push(Ae),rt=xe.length-1,Xe[_t]=rt),X.writeVarint(rt)}}function ma(V,X){return(X<<3)+(7&V)}function _a(V){return V<<1^V>>31}function pn(V,X){for(var ee=V.loadGeometry(),pe=V.type,xe=0,Be=0,Xe=ee.length,Re=0;Re<Xe;Re++){var Le=ee[Re],Ae=1;pe===1&&(Ae=Le.length),X.writeVarint(ma(1,Ae));for(var ft=pe===3?Le.length-1:Le.length,_t=0;_t<ft;_t++){_t===1&&pe!==1&&X.writeVarint(ma(2,ft-1));var rt=Le[_t].x-xe,Wt=Le[_t].y-Be;X.writeVarint(_a(rt)),X.writeVarint(_a(Wt)),xe+=rt,Be+=Wt}pe===3&&X.writeVarint(ma(7,1))}}function ga(V,X){var ee=typeof V;ee==="string"?X.writeStringField(1,V):ee==="boolean"?X.writeBooleanField(7,V):ee==="number"&&(V%1!=0?X.writeDoubleField(3,V):V<0?X.writeSVarintField(6,V):X.writeVarintField(5,V))}function ps(V,X,ee,pe,xe,Be){if(!(xe-pe<=ee)){var Xe=pe+xe>>1;(function Re(Le,Ae,ft,_t,rt,Wt){for(;rt>_t;){if(rt-_t>600){var Zt=rt-_t+1,yi=ft-_t+1,_i=Math.log(Zt),ri=.5*Math.exp(2*_i/3),Ti=.5*Math.sqrt(_i*ri*(Zt-ri)/Zt)*(yi-Zt/2<0?-1:1),zi=Math.max(_t,Math.floor(ft-yi*ri/Zt+Ti)),Ji=Math.min(rt,Math.floor(ft+(Zt-yi)*ri/Zt+Ti));Re(Le,Ae,ft,zi,Ji,Wt)}var ir=Ae[2*ft+Wt],zr=_t,Ei=rt;for(Fn(Le,Ae,_t,ft),Ae[2*rt+Wt]>ir&&Fn(Le,Ae,_t,rt);zr<Ei;){for(Fn(Le,Ae,zr,Ei),zr++,Ei--;Ae[2*zr+Wt]<ir;)zr++;for(;Ae[2*Ei+Wt]>ir;)Ei--}Ae[2*_t+Wt]===ir?Fn(Le,Ae,_t,Ei):Fn(Le,Ae,++Ei,rt),Ei<=ft&&(_t=Ei+1),ft<=Ei&&(rt=Ei-1)}})(V,X,Xe,pe,xe,Be%2),ps(V,X,ee,pe,Xe-1,Be+1),ps(V,X,ee,Xe+1,xe,Be+1)}}function Fn(V,X,ee,pe){ya(V,ee,pe),ya(X,2*ee,2*pe),ya(X,2*ee+1,2*pe+1)}function ya(V,X,ee){var pe=V[X];V[X]=V[ee],V[ee]=pe}function cr(V,X,ee,pe){var xe=V-ee,Be=X-pe;return xe*xe+Be*Be}hs.fromVectorTileJs=gl,hs.fromGeojsonVt=or,hs.GeoJSONWrapper=Cs;var On=function(V){return V[0]},Ui=function(V){return V[1]},Ps=function(V,X,ee,pe,xe){X===void 0&&(X=On),ee===void 0&&(ee=Ui),pe===void 0&&(pe=64),xe===void 0&&(xe=Float64Array),this.nodeSize=pe,this.points=V;for(var Be=V.length<65536?Uint16Array:Uint32Array,Xe=this.ids=new Be(V.length),Re=this.coords=new xe(2*V.length),Le=0;Le<V.length;Le++)Xe[Le]=Le,Re[2*Le]=X(V[Le]),Re[2*Le+1]=ee(V[Le]);ps(Xe,Re,pe,0,Xe.length-1,0)};Ps.prototype.range=function(V,X,ee,pe){return function(xe,Be,Xe,Re,Le,Ae,ft){for(var _t,rt,Wt=[0,xe.length-1,0],Zt=[];Wt.length;){var yi=Wt.pop(),_i=Wt.pop(),ri=Wt.pop();if(_i-ri<=ft)for(var Ti=ri;Ti<=_i;Ti++)_t=Be[2*Ti],rt=Be[2*Ti+1],_t>=Xe&&_t<=Le&&rt>=Re&&rt<=Ae&&Zt.push(xe[Ti]);else{var zi=Math.floor((ri+_i)/2);_t=Be[2*zi],rt=Be[2*zi+1],_t>=Xe&&_t<=Le&&rt>=Re&&rt<=Ae&&Zt.push(xe[zi]);var Ji=(yi+1)%2;(yi===0?Xe<=_t:Re<=rt)&&(Wt.push(ri),Wt.push(zi-1),Wt.push(Ji)),(yi===0?Le>=_t:Ae>=rt)&&(Wt.push(zi+1),Wt.push(_i),Wt.push(Ji))}}return Zt}(this.ids,this.coords,V,X,ee,pe,this.nodeSize)},Ps.prototype.within=function(V,X,ee){return function(pe,xe,Be,Xe,Re,Le){for(var Ae=[0,pe.length-1,0],ft=[],_t=Re*Re;Ae.length;){var rt=Ae.pop(),Wt=Ae.pop(),Zt=Ae.pop();if(Wt-Zt<=Le)for(var yi=Zt;yi<=Wt;yi++)cr(xe[2*yi],xe[2*yi+1],Be,Xe)<=_t&&ft.push(pe[yi]);else{var _i=Math.floor((Zt+Wt)/2),ri=xe[2*_i],Ti=xe[2*_i+1];cr(ri,Ti,Be,Xe)<=_t&&ft.push(pe[_i]);var zi=(rt+1)%2;(rt===0?Be-Re<=ri:Xe-Re<=Ti)&&(Ae.push(Zt),Ae.push(_i-1),Ae.push(zi)),(rt===0?Be+Re>=ri:Xe+Re>=Ti)&&(Ae.push(_i+1),Ae.push(Wt),Ae.push(zi))}}return ft}(this.ids,this.coords,V,X,ee,this.nodeSize)};var Hr={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},vn=function(V){this.options=xa(Object.create(Hr),V),this.trees=new Array(this.options.maxZoom+1)};function Ma(V,X,ee,pe,xe){return{x:V,y:X,zoom:1/0,id:ee,parentId:-1,numPoints:pe,properties:xe}}function va(V,X){var ee=V.geometry.coordinates,pe=ee[0],xe=ee[1];return{x:Co(pe),y:Na(xe),zoom:1/0,index:X,parentId:-1}}function ko(V){return{type:"Feature",id:V.id,properties:na(V),geometry:{type:"Point",coordinates:[(pe=V.x,360*(pe-.5)),(X=V.y,ee=(180-360*X)*Math.PI/180,360*Math.atan(Math.exp(ee))/Math.PI-90)]}};var X,ee,pe}function na(V){var X=V.numPoints,ee=X>=1e4?Math.round(X/1e3)+"k":X>=1e3?Math.round(X/100)/10+"k":X;return xa(xa({},V.properties),{cluster:!0,cluster_id:V.id,point_count:X,point_count_abbreviated:ee})}function Co(V){return V/360+.5}function Na(V){var X=Math.sin(V*Math.PI/180),ee=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ee<0?0:ee>1?1:ee}function xa(V,X){for(var ee in X)V[ee]=X[ee];return V}function ks(V){return V.x}function ql(V){return V.y}function Gl(V,X,ee,pe,xe,Be){var Xe=xe-ee,Re=Be-pe;if(Xe!==0||Re!==0){var Le=((V-ee)*Xe+(X-pe)*Re)/(Xe*Xe+Re*Re);Le>1?(ee=xe,pe=Be):Le>0&&(ee+=Xe*Le,pe+=Re*Le)}return(Xe=V-ee)*Xe+(Re=X-pe)*Re}function zo(V,X,ee,pe){var xe={id:V===void 0?null:V,type:X,geometry:ee,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Be){var Xe=Be.geometry,Re=Be.type;if(Re==="Point"||Re==="MultiPoint"||Re==="LineString")Ca(Be,Xe);else if(Re==="Polygon"||Re==="MultiLineString")for(var Le=0;Le<Xe.length;Le++)Ca(Be,Xe[Le]);else if(Re==="MultiPolygon")for(Le=0;Le<Xe.length;Le++)for(var Ae=0;Ae<Xe[Le].length;Ae++)Ca(Be,Xe[Le][Ae])}(xe),xe}function Ca(V,X){for(var ee=0;ee<X.length;ee+=3)V.minX=Math.min(V.minX,X[ee]),V.minY=Math.min(V.minY,X[ee+1]),V.maxX=Math.max(V.maxX,X[ee]),V.maxY=Math.max(V.maxY,X[ee+1])}function ds(V,X,ee,pe){if(X.geometry){var xe=X.geometry.coordinates,Be=X.geometry.type,Xe=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2),Re=[],Le=X.id;if(ee.promoteId?Le=X.properties[ee.promoteId]:ee.generateId&&(Le=pe||0),Be==="Point")fs(xe,Re);else if(Be==="MultiPoint")for(var Ae=0;Ae<xe.length;Ae++)fs(xe[Ae],Re);else if(Be==="LineString")Ds(xe,Re,Xe,!1);else if(Be==="MultiLineString"){if(ee.lineMetrics){for(Ae=0;Ae<xe.length;Ae++)Re=[],Ds(xe[Ae],Re,Xe,!1),V.push(zo(Le,"LineString",Re,X.properties));return}ja(xe,Re,Xe,!1)}else if(Be==="Polygon")ja(xe,Re,Xe,!0);else{if(Be!=="MultiPolygon"){if(Be==="GeometryCollection"){for(Ae=0;Ae<X.geometry.geometries.length;Ae++)ds(V,{id:Le,geometry:X.geometry.geometries[Ae],properties:X.properties},ee,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ae=0;Ae<xe.length;Ae++){var ft=[];ja(xe[Ae],ft,Xe,!0),Re.push(ft)}}V.push(zo(Le,Be,Re,X.properties))}}function fs(V,X){X.push(Ls(V[0])),X.push(qa(V[1])),X.push(0)}function Ds(V,X,ee,pe){for(var xe,Be,Xe=0,Re=0;Re<V.length;Re++){var Le=Ls(V[Re][0]),Ae=qa(V[Re][1]);X.push(Le),X.push(Ae),X.push(0),Re>0&&(Xe+=pe?(xe*Ae-Le*Be)/2:Math.sqrt(Math.pow(Le-xe,2)+Math.pow(Ae-Be,2))),xe=Le,Be=Ae}var ft=X.length-3;X[2]=1,function _t(rt,Wt,Zt,yi){for(var _i,ri=yi,Ti=Zt-Wt>>1,zi=Zt-Wt,Ji=rt[Wt],ir=rt[Wt+1],zr=rt[Zt],Ei=rt[Zt+1],lt=Wt+3;lt<Zt;lt+=3){var dn=Gl(rt[lt],rt[lt+1],Ji,ir,zr,Ei);if(dn>ri)_i=lt,ri=dn;else if(dn===ri){var Qi=Math.abs(lt-Ti);Qi<zi&&(_i=lt,zi=Qi)}}ri>yi&&(_i-Wt>3&&_t(rt,Wt,_i,yi),rt[_i+2]=ri,Zt-_i>3&&_t(rt,_i,Zt,yi))}(X,0,ft,ee),X[ft+2]=1,X.size=Math.abs(Xe),X.start=0,X.end=X.size}function ja(V,X,ee,pe){for(var xe=0;xe<V.length;xe++){var Be=[];Ds(V[xe],Be,ee,pe),X.push(Be)}}function Ls(V){return V/360+.5}function qa(V){var X=Math.sin(V*Math.PI/180),ee=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ee<0?0:ee>1?1:ee}function Do(V,X,ee,pe,xe,Be,Xe,Re){if(pe/=X,Be>=(ee/=X)&&Xe<pe)return V;if(Xe<ee||Be>=pe)return null;for(var Le=[],Ae=0;Ae<V.length;Ae++){var ft=V[Ae],_t=ft.geometry,rt=ft.type,Wt=xe===0?ft.minX:ft.minY,Zt=xe===0?ft.maxX:ft.maxY;if(Wt>=ee&&Zt<pe)Le.push(ft);else if(!(Zt<ee||Wt>=pe)){var yi=[];if(rt==="Point"||rt==="MultiPoint")ms(_t,yi,ee,pe,xe);else if(rt==="LineString")Rs(_t,yi,ee,pe,xe,!1,Re.lineMetrics);else if(rt==="MultiLineString")Ce(_t,yi,ee,pe,xe,!1);else if(rt==="Polygon")Ce(_t,yi,ee,pe,xe,!0);else if(rt==="MultiPolygon")for(var _i=0;_i<_t.length;_i++){var ri=[];Ce(_t[_i],ri,ee,pe,xe,!0),ri.length&&yi.push(ri)}if(yi.length){if(Re.lineMetrics&&rt==="LineString"){for(_i=0;_i<yi.length;_i++)Le.push(zo(ft.id,rt,yi[_i],ft.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(yi.length===1?(rt="LineString",yi=yi[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=yi.length===3?"Point":"MultiPoint"),Le.push(zo(ft.id,rt,yi,ft.tags))}}}return Le.length?Le:null}function ms(V,X,ee,pe,xe){for(var Be=0;Be<V.length;Be+=3){var Xe=V[Be+xe];Xe>=ee&&Xe<=pe&&(X.push(V[Be]),X.push(V[Be+1]),X.push(V[Be+2]))}}function Rs(V,X,ee,pe,xe,Be,Xe){for(var Re,Le,Ae=yl(V),ft=xe===0?re:Ie,_t=V.start,rt=0;rt<V.length-3;rt+=3){var Wt=V[rt],Zt=V[rt+1],yi=V[rt+2],_i=V[rt+3],ri=V[rt+4],Ti=xe===0?Wt:Zt,zi=xe===0?_i:ri,Ji=!1;Xe&&(Re=Math.sqrt(Math.pow(Wt-_i,2)+Math.pow(Zt-ri,2))),Ti<ee?zi>ee&&(Le=ft(Ae,Wt,Zt,_i,ri,ee),Xe&&(Ae.start=_t+Re*Le)):Ti>pe?zi<pe&&(Le=ft(Ae,Wt,Zt,_i,ri,pe),Xe&&(Ae.start=_t+Re*Le)):te(Ae,Wt,Zt,yi),zi<ee&&Ti>=ee&&(Le=ft(Ae,Wt,Zt,_i,ri,ee),Ji=!0),zi>pe&&Ti<=pe&&(Le=ft(Ae,Wt,Zt,_i,ri,pe),Ji=!0),!Be&&Ji&&(Xe&&(Ae.end=_t+Re*Le),X.push(Ae),Ae=yl(V)),Xe&&(_t+=Re)}var ir=V.length-3;Wt=V[ir],Zt=V[ir+1],yi=V[ir+2],(Ti=xe===0?Wt:Zt)>=ee&&Ti<=pe&&te(Ae,Wt,Zt,yi),ir=Ae.length-3,Be&&ir>=3&&(Ae[ir]!==Ae[0]||Ae[ir+1]!==Ae[1])&&te(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&X.push(Ae)}function yl(V){var X=[];return X.size=V.size,X.start=V.start,X.end=V.end,X}function Ce(V,X,ee,pe,xe,Be){for(var Xe=0;Xe<V.length;Xe++)Rs(V[Xe],X,ee,pe,xe,Be,!1)}function te(V,X,ee,pe){V.push(X),V.push(ee),V.push(pe)}function re(V,X,ee,pe,xe,Be){var Xe=(Be-X)/(pe-X);return V.push(Be),V.push(ee+(xe-ee)*Xe),V.push(1),Xe}function Ie(V,X,ee,pe,xe,Be){var Xe=(Be-ee)/(xe-ee);return V.push(X+(pe-X)*Xe),V.push(Be),V.push(1),Xe}function De(V,X){for(var ee=[],pe=0;pe<V.length;pe++){var xe,Be=V[pe],Xe=Be.type;if(Xe==="Point"||Xe==="MultiPoint"||Xe==="LineString")xe=Ze(Be.geometry,X);else if(Xe==="MultiLineString"||Xe==="Polygon"){xe=[];for(var Re=0;Re<Be.geometry.length;Re++)xe.push(Ze(Be.geometry[Re],X))}else if(Xe==="MultiPolygon")for(xe=[],Re=0;Re<Be.geometry.length;Re++){for(var Le=[],Ae=0;Ae<Be.geometry[Re].length;Ae++)Le.push(Ze(Be.geometry[Re][Ae],X));xe.push(Le)}ee.push(zo(Be.id,Xe,xe,Be.tags))}return ee}function Ze(V,X){var ee=[];ee.size=V.size,V.start!==void 0&&(ee.start=V.start,ee.end=V.end);for(var pe=0;pe<V.length;pe+=3)ee.push(V[pe]+X,V[pe+1],V[pe+2]);return ee}function tt(V,X){if(V.transformed)return V;var ee,pe,xe,Be=1<<V.z,Xe=V.x,Re=V.y;for(ee=0;ee<V.features.length;ee++){var Le=V.features[ee],Ae=Le.geometry,ft=Le.type;if(Le.geometry=[],ft===1)for(pe=0;pe<Ae.length;pe+=2)Le.geometry.push(Qe(Ae[pe],Ae[pe+1],X,Be,Xe,Re));else for(pe=0;pe<Ae.length;pe++){var _t=[];for(xe=0;xe<Ae[pe].length;xe+=2)_t.push(Qe(Ae[pe][xe],Ae[pe][xe+1],X,Be,Xe,Re));Le.geometry.push(_t)}}return V.transformed=!0,V}function Qe(V,X,ee,pe,xe,Be){return[Math.round(ee*(V*pe-xe)),Math.round(ee*(X*pe-Be))]}function Ge(V,X,ee,pe,xe){for(var Be=X===xe.maxZoom?0:xe.tolerance/((1<<X)*xe.extent),Xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ee,y:pe,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Re=0;Re<V.length;Re++){Xe.numFeatures++,pt(Xe,V[Re],Be,xe);var Le=V[Re].minX,Ae=V[Re].minY,ft=V[Re].maxX,_t=V[Re].maxY;Le<Xe.minX&&(Xe.minX=Le),Ae<Xe.minY&&(Xe.minY=Ae),ft>Xe.maxX&&(Xe.maxX=ft),_t>Xe.maxY&&(Xe.maxY=_t)}return Xe}function pt(V,X,ee,pe){var xe=X.geometry,Be=X.type,Xe=[];if(Be==="Point"||Be==="MultiPoint")for(var Re=0;Re<xe.length;Re+=3)Xe.push(xe[Re]),Xe.push(xe[Re+1]),V.numPoints++,V.numSimplified++;else if(Be==="LineString")vt(Xe,xe,V,ee,!1,!1);else if(Be==="MultiLineString"||Be==="Polygon")for(Re=0;Re<xe.length;Re++)vt(Xe,xe[Re],V,ee,Be==="Polygon",Re===0);else if(Be==="MultiPolygon")for(var Le=0;Le<xe.length;Le++){var Ae=xe[Le];for(Re=0;Re<Ae.length;Re++)vt(Xe,Ae[Re],V,ee,!0,Re===0)}if(Xe.length){var ft=X.tags||null;if(Be==="LineString"&&pe.lineMetrics){for(var _t in ft={},X.tags)ft[_t]=X.tags[_t];ft.mapbox_clip_start=xe.start/xe.size,ft.mapbox_clip_end=xe.end/xe.size}var rt={geometry:Xe,type:Be==="Polygon"||Be==="MultiPolygon"?3:Be==="LineString"||Be==="MultiLineString"?2:1,tags:ft};X.id!==null&&(rt.id=X.id),V.features.push(rt)}}function vt(V,X,ee,pe,xe,Be){var Xe=pe*pe;if(pe>0&&X.size<(xe?Xe:pe))ee.numPoints+=X.length/3;else{for(var Re=[],Le=0;Le<X.length;Le+=3)(pe===0||X[Le+2]>Xe)&&(ee.numSimplified++,Re.push(X[Le]),Re.push(X[Le+1])),ee.numPoints++;xe&&function(Ae,ft){for(var _t=0,rt=0,Wt=Ae.length,Zt=Wt-2;rt<Wt;Zt=rt,rt+=2)_t+=(Ae[rt]-Ae[Zt])*(Ae[rt+1]+Ae[Zt+1]);if(_t>0===ft)for(rt=0,Wt=Ae.length;rt<Wt/2;rt+=2){var yi=Ae[rt],_i=Ae[rt+1];Ae[rt]=Ae[Wt-2-rt],Ae[rt+1]=Ae[Wt-1-rt],Ae[Wt-2-rt]=yi,Ae[Wt-1-rt]=_i}}(Re,Be),V.push(Re)}}function Pt(V,X){var ee=(X=this.options=function(xe,Be){for(var Xe in Be)xe[Xe]=Be[Xe];return xe}(Object.create(this.options),X)).debug;if(ee&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var pe=function(xe,Be){var Xe=[];if(xe.type==="FeatureCollection")for(var Re=0;Re<xe.features.length;Re++)ds(Xe,xe.features[Re],Be,Re);else xe.type==="Feature"?ds(Xe,xe,Be):ds(Xe,{geometry:xe},Be);return Xe}(V,X);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(pe=function(xe,Be){var Xe=Be.buffer/Be.extent,Re=xe,Le=Do(xe,1,-1-Xe,Xe,0,-1,2,Be),Ae=Do(xe,1,1-Xe,2+Xe,0,-1,2,Be);return(Le||Ae)&&(Re=Do(xe,1,-Xe,1+Xe,0,-1,2,Be)||[],Le&&(Re=De(Le,1).concat(Re)),Ae&&(Re=Re.concat(De(Ae,-1)))),Re}(pe,X)).length&&this.splitTile(pe,0,0,0),ee&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Et(V,X,ee){return 32*((1<<V)*ee+X)+V}function mi(V,X){var ee=V.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);var pe=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!pe)return X(null,null);var xe=new Wo(pe.features),Be=hs(xe);Be.byteOffset===0&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),X(null,{vectorTile:xe,rawData:Be.buffer})}vn.prototype.load=function(V){var X=this.options,ee=X.log,pe=X.minZoom,xe=X.maxZoom,Be=X.nodeSize;ee&&console.time("total time");var Xe="prepare "+V.length+" points";ee&&console.time(Xe),this.points=V;for(var Re=[],Le=0;Le<V.length;Le++)V[Le].geometry&&Re.push(va(V[Le],Le));this.trees[xe+1]=new Ps(Re,ks,ql,Be,Float32Array),ee&&console.timeEnd(Xe);for(var Ae=xe;Ae>=pe;Ae--){var ft=+Date.now();Re=this._cluster(Re,Ae),this.trees[Ae]=new Ps(Re,ks,ql,Be,Float32Array),ee&&console.log("z%d: %d clusters in %dms",Ae,Re.length,+Date.now()-ft)}return ee&&console.timeEnd("total time"),this},vn.prototype.getClusters=function(V,X){var ee=((V[0]+180)%360+360)%360-180,pe=Math.max(-90,Math.min(90,V[1])),xe=V[2]===180?180:((V[2]+180)%360+360)%360-180,Be=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ee=-180,xe=180;else if(ee>xe){var Xe=this.getClusters([ee,pe,180,Be],X),Re=this.getClusters([-180,pe,xe,Be],X);return Xe.concat(Re)}for(var Le=this.trees[this._limitZoom(X)],Ae=[],ft=0,_t=Le.range(Co(ee),Na(Be),Co(xe),Na(pe));ft<_t.length;ft+=1){var rt=_t[ft],Wt=Le.points[rt];Ae.push(Wt.numPoints?ko(Wt):this.points[Wt.index])}return Ae},vn.prototype.getChildren=function(V){var X=this._getOriginId(V),ee=this._getOriginZoom(V),pe="No cluster with the specified id.",xe=this.trees[ee];if(!xe)throw new Error(pe);var Be=xe.points[X];if(!Be)throw new Error(pe);for(var Xe=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),Re=[],Le=0,Ae=xe.within(Be.x,Be.y,Xe);Le<Ae.length;Le+=1){var ft=Ae[Le],_t=xe.points[ft];_t.parentId===V&&Re.push(_t.numPoints?ko(_t):this.points[_t.index])}if(Re.length===0)throw new Error(pe);return Re},vn.prototype.getLeaves=function(V,X,ee){X=X||10,ee=ee||0;var pe=[];return this._appendLeaves(pe,V,X,ee,0),pe},vn.prototype.getTile=function(V,X,ee){var pe=this.trees[this._limitZoom(V)],xe=Math.pow(2,V),Be=this.options,Xe=Be.extent,Re=Be.radius/Xe,Le=(ee-Re)/xe,Ae=(ee+1+Re)/xe,ft={features:[]};return this._addTileFeatures(pe.range((X-Re)/xe,Le,(X+1+Re)/xe,Ae),pe.points,X,ee,xe,ft),X===0&&this._addTileFeatures(pe.range(1-Re/xe,Le,1,Ae),pe.points,xe,ee,xe,ft),X===xe-1&&this._addTileFeatures(pe.range(0,Le,Re/xe,Ae),pe.points,-1,ee,xe,ft),ft.features.length?ft:null},vn.prototype.getClusterExpansionZoom=function(V){for(var X=this._getOriginZoom(V)-1;X<=this.options.maxZoom;){var ee=this.getChildren(V);if(X++,ee.length!==1)break;V=ee[0].properties.cluster_id}return X},vn.prototype._appendLeaves=function(V,X,ee,pe,xe){for(var Be=0,Xe=this.getChildren(X);Be<Xe.length;Be+=1){var Re=Xe[Be],Le=Re.properties;if(Le&&Le.cluster?xe+Le.point_count<=pe?xe+=Le.point_count:xe=this._appendLeaves(V,Le.cluster_id,ee,pe,xe):xe<pe?xe++:V.push(Re),V.length===ee)break}return xe},vn.prototype._addTileFeatures=function(V,X,ee,pe,xe,Be){for(var Xe=0,Re=V;Xe<Re.length;Xe+=1){var Le=X[Re[Xe]],Ae=Le.numPoints,ft={type:1,geometry:[[Math.round(this.options.extent*(Le.x*xe-ee)),Math.round(this.options.extent*(Le.y*xe-pe))]],tags:Ae?na(Le):this.points[Le.index].properties},_t=void 0;Ae?_t=Le.id:this.options.generateId?_t=Le.index:this.points[Le.index].id&&(_t=this.points[Le.index].id),_t!==void 0&&(ft.id=_t),Be.features.push(ft)}},vn.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(V,this.options.maxZoom+1))},vn.prototype._cluster=function(V,X){for(var ee=[],pe=this.options,xe=pe.radius,Be=pe.extent,Xe=pe.reduce,Re=xe/(Be*Math.pow(2,X)),Le=0;Le<V.length;Le++){var Ae=V[Le];if(!(Ae.zoom<=X)){Ae.zoom=X;for(var ft=this.trees[X+1],_t=ft.within(Ae.x,Ae.y,Re),rt=Ae.numPoints||1,Wt=Ae.x*rt,Zt=Ae.y*rt,yi=Xe&&rt>1?this._map(Ae,!0):null,_i=(Le<<5)+(X+1)+this.points.length,ri=0,Ti=_t;ri<Ti.length;ri+=1){var zi=Ti[ri],Ji=ft.points[zi];if(!(Ji.zoom<=X)){Ji.zoom=X;var ir=Ji.numPoints||1;Wt+=Ji.x*ir,Zt+=Ji.y*ir,rt+=ir,Ji.parentId=_i,Xe&&(yi||(yi=this._map(Ae,!0)),Xe(yi,this._map(Ji)))}}rt===1?ee.push(Ae):(Ae.parentId=_i,ee.push(Ma(Wt/rt,Zt/rt,_i,rt,yi)))}}return ee},vn.prototype._getOriginId=function(V){return V-this.points.length>>5},vn.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},vn.prototype._map=function(V,X){if(V.numPoints)return X?xa({},V.properties):V.properties;var ee=this.points[V.index].properties,pe=this.options.map(ee);return X&&pe===ee?xa({},pe):pe},Pt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Pt.prototype.splitTile=function(V,X,ee,pe,xe,Be,Xe){for(var Re=[V,X,ee,pe],Le=this.options,Ae=Le.debug;Re.length;){pe=Re.pop(),ee=Re.pop(),X=Re.pop(),V=Re.pop();var ft=1<<X,_t=Et(X,ee,pe),rt=this.tiles[_t];if(!rt&&(Ae>1&&console.time("creation"),rt=this.tiles[_t]=Ge(V,X,ee,pe,Le),this.tileCoords.push({z:X,x:ee,y:pe}),Ae)){Ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,ee,pe,rt.numFeatures,rt.numPoints,rt.numSimplified),console.timeEnd("creation"));var Wt="z"+X;this.stats[Wt]=(this.stats[Wt]||0)+1,this.total++}if(rt.source=V,xe){if(X===Le.maxZoom||X===xe)continue;var Zt=1<<xe-X;if(ee!==Math.floor(Be/Zt)||pe!==Math.floor(Xe/Zt))continue}else if(X===Le.indexMaxZoom||rt.numPoints<=Le.indexMaxPoints)continue;if(rt.source=null,V.length!==0){Ae>1&&console.time("clipping");var yi,_i,ri,Ti,zi,Ji,ir=.5*Le.buffer/Le.extent,zr=.5-ir,Ei=.5+ir,lt=1+ir;yi=_i=ri=Ti=null,zi=Do(V,ft,ee-ir,ee+Ei,0,rt.minX,rt.maxX,Le),Ji=Do(V,ft,ee+zr,ee+lt,0,rt.minX,rt.maxX,Le),V=null,zi&&(yi=Do(zi,ft,pe-ir,pe+Ei,1,rt.minY,rt.maxY,Le),_i=Do(zi,ft,pe+zr,pe+lt,1,rt.minY,rt.maxY,Le),zi=null),Ji&&(ri=Do(Ji,ft,pe-ir,pe+Ei,1,rt.minY,rt.maxY,Le),Ti=Do(Ji,ft,pe+zr,pe+lt,1,rt.minY,rt.maxY,Le),Ji=null),Ae>1&&console.timeEnd("clipping"),Re.push(yi||[],X+1,2*ee,2*pe),Re.push(_i||[],X+1,2*ee,2*pe+1),Re.push(ri||[],X+1,2*ee+1,2*pe),Re.push(Ti||[],X+1,2*ee+1,2*pe+1)}}},Pt.prototype.getTile=function(V,X,ee){var pe=this.options,xe=pe.extent,Be=pe.debug;if(V<0||V>24)return null;var Xe=1<<V,Re=Et(V,X=(X%Xe+Xe)%Xe,ee);if(this.tiles[Re])return tt(this.tiles[Re],xe);Be>1&&console.log("drilling down to z%d-%d-%d",V,X,ee);for(var Le,Ae=V,ft=X,_t=ee;!Le&&Ae>0;)Ae--,ft=Math.floor(ft/2),_t=Math.floor(_t/2),Le=this.tiles[Et(Ae,ft,_t)];return Le&&Le.source?(Be>1&&console.log("found parent tile z%d-%d-%d",Ae,ft,_t),Be>1&&console.time("drilling down"),this.splitTile(Le.source,Ae,ft,_t,V,X,ee),Be>1&&console.timeEnd("drilling down"),this.tiles[Re]?tt(this.tiles[Re],xe):null):null};var Li=function(V){function X(ee,pe,xe,Be){V.call(this,ee,pe,xe,mi),Be&&(this.loadGeoJSON=Be)}return V&&(X.__proto__=V),X.prototype=Object.create(V&&V.prototype),X.prototype.constructor=X,X.prototype.loadData=function(ee,pe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=pe,this._pendingLoadDataParams=ee,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},X.prototype._loadData=function(){var ee=this;if(this._pendingCallback&&this._pendingLoadDataParams){var pe=this._pendingCallback,xe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Be=!!(xe&&xe.request&&xe.request.collectResourceTiming)&&new T.RequestPerformance(xe.request);this.loadGeoJSON(xe,function(Xe,Re){if(Xe||!Re)return pe(Xe);if(typeof Re!="object")return pe(new Error("Input data given to '"+xe.source+"' is not a valid GeoJSON object."));to(Re,!0);try{ee._geoJSONIndex=xe.cluster?new vn(function(ft){var _t=ft.superclusterOptions,rt=ft.clusterProperties;if(!rt||!_t)return _t;for(var Wt={},Zt={},yi={accumulated:null,zoom:0},_i={properties:null},ri=Object.keys(rt),Ti=0,zi=ri;Ti<zi.length;Ti+=1){var Ji=zi[Ti],ir=rt[Ji],zr=ir[0],Ei=ir[1],lt=T.createExpression(Ei),dn=T.createExpression(typeof zr=="string"?[zr,["accumulated"],["get",Ji]]:zr);Wt[Ji]=lt.value,Zt[Ji]=dn.value}return _t.map=function(Qi){_i.properties=Qi;for(var _r={},ba=0,dr=ri;ba<dr.length;ba+=1){var Kr=dr[ba];_r[Kr]=Wt[Kr].evaluate(yi,_i)}return _r},_t.reduce=function(Qi,_r){_i.properties=_r;for(var ba=0,dr=ri;ba<dr.length;ba+=1){var Kr=dr[ba];yi.accumulated=Qi[Kr],Qi[Kr]=Zt[Kr].evaluate(yi,_i)}},_t}(xe)).load(Re.features):function(ft,_t){return new Pt(ft,_t)}(Re,xe.geojsonVtOptions)}catch(ft){return pe(ft)}ee.loaded={};var Le={};if(Be){var Ae=Be.finish();Ae&&(Le.resourceTiming={},Le.resourceTiming[xe.source]=JSON.parse(JSON.stringify(Ae)))}pe(null,Le)})}},X.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},X.prototype.reloadTile=function(ee,pe){var xe=this.loaded,Be=ee.uid;return xe&&xe[Be]?V.prototype.reloadTile.call(this,ee,pe):this.loadTile(ee,pe)},X.prototype.loadGeoJSON=function(ee,pe){if(ee.request)T.getJSON(ee.request,pe);else{if(typeof ee.data!="string")return pe(new Error("Input data given to '"+ee.source+"' is not a valid GeoJSON object."));try{return pe(null,JSON.parse(ee.data))}catch{return pe(new Error("Input data given to '"+ee.source+"' is not a valid GeoJSON object."))}}},X.prototype.removeSource=function(ee,pe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),pe()},X.prototype.getClusterExpansionZoom=function(ee,pe){try{pe(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(xe){pe(xe)}},X.prototype.getClusterChildren=function(ee,pe){try{pe(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(xe){pe(xe)}},X.prototype.getClusterLeaves=function(ee,pe){try{pe(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(xe){pe(xe)}},X}(Di),li=function(V){var X=this;this.self=V,this.actor=new T.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Di,geojson:Li},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ee,pe){if(X.workerSourceTypes[ee])throw new Error('Worker source with name "'+ee+'" already registered.');X.workerSourceTypes[ee]=pe},this.self.registerRTLTextPlugin=function(ee){if(T.plugin.isParsed())throw new Error("RTL text plugin already registered.");T.plugin.applyArabicShaping=ee.applyArabicShaping,T.plugin.processBidirectionalText=ee.processBidirectionalText,T.plugin.processStyledBidirectionalText=ee.processStyledBidirectionalText}};return li.prototype.setReferrer=function(V,X){this.referrer=X},li.prototype.setImages=function(V,X,ee){this.availableImages[V]=X,ee()},li.prototype.setLayers=function(V,X,ee){this.getLayerIndex(V).replace(X),ee()},li.prototype.updateLayers=function(V,X,ee){this.getLayerIndex(V).update(X.layers,X.removedIds),ee()},li.prototype.loadTile=function(V,X,ee){this.getWorkerSource(V,X.type,X.source).loadTile(X,ee)},li.prototype.loadDEMTile=function(V,X,ee){this.getDEMWorkerSource(V,X.source).loadTile(X,ee)},li.prototype.reloadTile=function(V,X,ee){this.getWorkerSource(V,X.type,X.source).reloadTile(X,ee)},li.prototype.abortTile=function(V,X,ee){this.getWorkerSource(V,X.type,X.source).abortTile(X,ee)},li.prototype.removeTile=function(V,X,ee){this.getWorkerSource(V,X.type,X.source).removeTile(X,ee)},li.prototype.removeDEMTile=function(V,X){this.getDEMWorkerSource(V,X.source).removeTile(X)},li.prototype.removeSource=function(V,X,ee){if(this.workerSources[V]&&this.workerSources[V][X.type]&&this.workerSources[V][X.type][X.source]){var pe=this.workerSources[V][X.type][X.source];delete this.workerSources[V][X.type][X.source],pe.removeSource!==void 0?pe.removeSource(X,ee):ee()}},li.prototype.loadWorkerSource=function(V,X,ee){try{this.self.importScripts(X.url),ee()}catch(pe){ee(pe.toString())}},li.prototype.syncRTLPluginState=function(V,X,ee){try{T.plugin.setState(X);var pe=T.plugin.getPluginURL();if(T.plugin.isLoaded()&&!T.plugin.isParsed()&&pe!=null){this.self.importScripts(pe);var xe=T.plugin.isParsed();ee(xe?void 0:new Error("RTL Text Plugin failed to import scripts from "+pe),xe)}}catch(Be){ee(Be.toString())}},li.prototype.getAvailableImages=function(V){var X=this.availableImages[V];return X||(X=[]),X},li.prototype.getLayerIndex=function(V){var X=this.layerIndexes[V];return X||(X=this.layerIndexes[V]=new st),X},li.prototype.getWorkerSource=function(V,X,ee){var pe=this;if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][X]||(this.workerSources[V][X]={}),!this.workerSources[V][X][ee]){var xe={send:function(Be,Xe,Re){pe.actor.send(Be,Xe,Re,V)}};this.workerSources[V][X][ee]=new this.workerSourceTypes[X](xe,this.getLayerIndex(V),this.getAvailableImages(V))}return this.workerSources[V][X][ee]},li.prototype.getDEMWorkerSource=function(V,X){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][X]||(this.demWorkerSources[V][X]=new tr),this.demWorkerSources[V][X]},li.prototype.enforceCacheSizeLimit=function(V,X){T.enforceCacheSizeLimit(X)},typeof WorkerGlobalScope<"u"&&T.window!==void 0&&T.window instanceof WorkerGlobalScope&&(T.window.worker=new li(T.window)),li}),rr(["./shared"],function(T){var Gi=T.createCommonjsModule(function(h){function d(y){return!!(typeof window<"u"&&typeof document<"u"&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var I,P,D=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(D);try{P=new Worker(O),I=!0}catch{I=!1}return P&&P.terminate(),URL.revokeObjectURL(O),I}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&function(I){return p[I]===void 0&&(p[I]=function(P){var D=document.createElement("canvas"),O=Object.create(d.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=P,D.probablySupportsContext?D.probablySupportsContext("webgl",O)||D.probablySupportsContext("experimental-webgl",O):D.supportsContext?D.supportsContext("webgl",O)||D.supportsContext("experimental-webgl",O):D.getContext("webgl",O)||D.getContext("experimental-webgl",O)}(I)),p[I]}(y&&y.failIfMajorPerformanceCaveat))}h.exports?h.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d);var p={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),c={create:function(h,d,p){var y=T.window.document.createElement(h);return d!==void 0&&(y.className=d),p&&p.appendChild(y),y},createNS:function(h,d){return T.window.document.createElementNS(h,d)}},st=T.window.document.documentElement.style;function Kt(h){if(!st)return h[0];for(var d=0;d<h.length;d++)if(h[d]in st)return h[d];return h[0]}var Zi,Gt=Kt(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);c.disableDrag=function(){st&&Gt&&(Zi=st[Gt],st[Gt]="none")},c.enableDrag=function(){st&&Gt&&(st[Gt]=Zi)};var di=Kt(["transform","WebkitTransform"]);c.setTransform=function(h,d){h.style[di]=d};var Di=!1;try{var nr=Object.defineProperty({},"passive",{get:function(){Di=!0}});T.window.addEventListener("test",nr,nr),T.window.removeEventListener("test",nr,nr)}catch{Di=!1}c.addEventListener=function(h,d,p,y){y===void 0&&(y={}),"passive"in y&&Di?h.addEventListener(d,p,y):h.addEventListener(d,p,y.capture)},c.removeEventListener=function(h,d,p,y){y===void 0&&(y={}),"passive"in y&&Di?h.removeEventListener(d,p,y):h.removeEventListener(d,p,y.capture)};var tr=function(h){h.preventDefault(),h.stopPropagation(),T.window.removeEventListener("click",tr,!0)};function Xn(h){var d=h.userImage;return d&&d.render&&d.render()?(h.data.replace(new Uint8Array(d.data.buffer)),!0):!1}c.suppressClick=function(){T.window.addEventListener("click",tr,!0),T.window.setTimeout(function(){T.window.removeEventListener("click",tr,!0)},0)},c.mousePos=function(h,d){var p=h.getBoundingClientRect(),y=T.window.TouchEvent&&d instanceof T.window.TouchEvent?d.touches[0]:d;return new T.Point(y.clientX-p.left-h.clientLeft,y.clientY-p.top-h.clientTop)},c.touchPos=function(h,d){for(var p=h.getBoundingClientRect(),y=[],I=d.type==="touchend"?d.changedTouches:d.touches,P=0;P<I.length;P++)y.push(new T.Point(I[P].clientX-p.left-h.clientLeft,I[P].clientY-p.top-h.clientTop));return y},c.mouseButton=function(h){return T.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&T.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},c.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};var Wn=function(h){function d(){h.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new T.RGBAImage({width:1,height:1}),this.dirty=!0}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(p){if(this.loaded!==p&&(this.loaded=p,p)){for(var y=0,I=this.requestors;y<I.length;y+=1){var P=I[y],D=P.ids,O=P.callback;this._notify(D,O)}this.requestors=[]}},d.prototype.getImage=function(p){return this.images[p]},d.prototype.addImage=function(p,y){this._validate(p,y)&&(this.images[p]=y)},d.prototype._validate=function(p,y){var I=!0;return this._validateStretch(y.stretchX,y.data&&y.data.width)||(this.fire(new T.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchX" value'))),I=!1),this._validateStretch(y.stretchY,y.data&&y.data.height)||(this.fire(new T.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchY" value'))),I=!1),this._validateContent(y.content,y)||(this.fire(new T.ErrorEvent(new Error('Image "'+p+'" has invalid "content" value'))),I=!1),I},d.prototype._validateStretch=function(p,y){if(!p)return!0;for(var I=0,P=0,D=p;P<D.length;P+=1){var O=D[P];if(O[0]<I||O[1]<O[0]||y<O[1])return!1;I=O[1]}return!0},d.prototype._validateContent=function(p,y){return!p||p.length===4&&!(p[0]<0||y.data.width<p[0])&&!(p[1]<0||y.data.height<p[1])&&!(p[2]<0||y.data.width<p[2])&&!(p[3]<0||y.data.height<p[3])&&!(p[2]<p[0])&&!(p[3]<p[1])},d.prototype.updateImage=function(p,y){var I=this.images[p];y.version=I.version+1,this.images[p]=y,this.updatedImages[p]=!0},d.prototype.removeImage=function(p){var y=this.images[p];delete this.images[p],delete this.patterns[p],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(p,y){var I=!0;if(!this.isLoaded())for(var P=0,D=p;P<D.length;P+=1){var O=D[P];this.images[O]||(I=!1)}this.isLoaded()||I?this._notify(p,y):this.requestors.push({ids:p,callback:y})},d.prototype._notify=function(p,y){for(var I={},P=0,D=p;P<D.length;P+=1){var O=D[P];this.images[O]||this.fire(new T.Event("styleimagemissing",{id:O}));var G=this.images[O];G?I[O]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:!!(G.userImage&&G.userImage.render)}:T.warnOnce('Image "'+O+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}y(null,I)},d.prototype.getPixelSize=function(){var p=this.atlasImage;return{width:p.width,height:p.height}},d.prototype.getPattern=function(p){var y=this.patterns[p],I=this.getImage(p);if(!I)return null;if(y&&y.position.version===I.version)return y.position;if(y)y.position.version=I.version;else{var P={w:I.data.width+2,h:I.data.height+2,x:0,y:0},D=new T.ImagePosition(P,I);this.patterns[p]={bin:P,position:D}}return this._updatePatternAtlas(),this.patterns[p].position},d.prototype.bind=function(p){var y=p.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new T.Texture(p,this.atlasImage,y.RGBA),this.atlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var p=[];for(var y in this.patterns)p.push(this.patterns[y].bin);var I=T.potpack(p),P=I.w,D=I.h,O=this.atlasImage;for(var G in O.resize({width:P||1,height:D||1}),this.patterns){var Q=this.patterns[G].bin,oe=Q.x+1,_e=Q.y+1,Se=this.images[G].data,Te=Se.width,ge=Se.height;T.RGBAImage.copy(Se,O,{x:0,y:0},{x:oe,y:_e},{width:Te,height:ge}),T.RGBAImage.copy(Se,O,{x:0,y:ge-1},{x:oe,y:_e-1},{width:Te,height:1}),T.RGBAImage.copy(Se,O,{x:0,y:0},{x:oe,y:_e+ge},{width:Te,height:1}),T.RGBAImage.copy(Se,O,{x:Te-1,y:0},{x:oe-1,y:_e},{width:1,height:ge}),T.RGBAImage.copy(Se,O,{x:0,y:0},{x:oe+Te,y:_e},{width:1,height:ge})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(p){for(var y=0,I=p;y<I.length;y+=1){var P=I[y];if(!this.callbackDispatchedThisFrame[P]){this.callbackDispatchedThisFrame[P]=!0;var D=this.images[P];Xn(D)&&this.updateImage(P,D)}}},d}(T.Evented),co=to,_o=to,Ao=1e20;function to(h,d,p,y,I,P){this.fontSize=h||24,this.buffer=d===void 0?3:d,this.cutoff=y||.25,this.fontFamily=I||"sans-serif",this.fontWeight=P||"normal",this.radius=p||8;var D=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=D,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.d=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Int16Array(D),this.middle=Math.round(D/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Mo(h,d,p,y,I,P,D){for(var O=0;O<d;O++){for(var G=0;G<p;G++)y[G]=h[G*d+O];for(ra(y,I,P,D,p),G=0;G<p;G++)h[G*d+O]=I[G]}for(G=0;G<p;G++){for(O=0;O<d;O++)y[O]=h[G*d+O];for(ra(y,I,P,D,d),O=0;O<d;O++)h[G*d+O]=Math.sqrt(I[O])}}function ra(h,d,p,y,I){p[0]=0,y[0]=-Ao,y[1]=+Ao;for(var P=1,D=0;P<I;P++){for(var O=(h[P]+P*P-(h[p[D]]+p[D]*p[D]))/(2*P-2*p[D]);O<=y[D];)D--,O=(h[P]+P*P-(h[p[D]]+p[D]*p[D]))/(2*P-2*p[D]);p[++D]=P,y[D]=O,y[D+1]=+Ao}for(P=0,D=0;P<I;P++){for(;y[D+1]<P;)D++;d[P]=(P-p[D])*(P-p[D])+h[p[D]]}}to.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(h,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),p=new Uint8ClampedArray(this.size*this.size),y=0;y<this.size*this.size;y++){var I=d.data[4*y+3]/255;this.gridOuter[y]=I===1?0:I===0?Ao:Math.pow(Math.max(0,.5-I),2),this.gridInner[y]=I===1?Ao:I===0?0:Math.pow(Math.max(0,I-.5),2)}for(Mo(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Mo(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),y=0;y<this.size*this.size;y++){var P=this.gridOuter[y]-this.gridInner[y];p[y]=Math.max(0,Math.min(255,Math.round(255-255*(P/this.radius+this.cutoff))))}return p},co.default=_o;var jr=function(h,d){this.requestManager=h,this.localIdeographFontFamily=d,this.entries={}};jr.prototype.setURL=function(h){this.url=h},jr.prototype.getGlyphs=function(h,d){var p=this,y=[];for(var I in h)for(var P=0,D=h[I];P<D.length;P+=1){var O=D[P];y.push({stack:I,id:O})}T.asyncAll(y,function(G,Q){var oe=G.stack,_e=G.id,Se=p.entries[oe];Se||(Se=p.entries[oe]={glyphs:{},requests:{}});var Te=Se.glyphs[_e];if(Te===void 0){if(Te=p._tinySDF(Se,oe,_e))return Se.glyphs[_e]=Te,void Q(null,{stack:oe,id:_e,glyph:Te});var ge=Math.floor(_e/256);if(256*ge>65535)Q(new Error("glyphs > 65535 not supported"));else{var be=Se.requests[ge];be||(be=Se.requests[ge]=[],jr.loadGlyphRange(oe,ge,p.url,p.requestManager,function(We,Ne){if(Ne)for(var et in Ne)p._doesCharSupportLocalGlyph(+et)||(Se.glyphs[+et]=Ne[+et]);for(var Je=0,ot=be;Je<ot.length;Je+=1)(0,ot[Je])(We,Ne);delete Se.requests[ge]})),be.push(function(We,Ne){We?Q(We):Ne&&Q(null,{stack:oe,id:_e,glyph:Ne[_e]||null})})}}else Q(null,{stack:oe,id:_e,glyph:Te})},function(G,Q){if(G)d(G);else if(Q){for(var oe={},_e=0,Se=Q;_e<Se.length;_e+=1){var Te=Se[_e],ge=Te.stack,be=Te.id,We=Te.glyph;(oe[ge]||(oe[ge]={}))[be]=We&&{id:We.id,bitmap:We.bitmap.clone(),metrics:We.metrics}}d(null,oe)}})},jr.prototype._doesCharSupportLocalGlyph=function(h){return!!this.localIdeographFontFamily&&(T.isChar["CJK Unified Ideographs"](h)||T.isChar["Hangul Syllables"](h)||T.isChar.Hiragana(h)||T.isChar.Katakana(h))},jr.prototype._tinySDF=function(h,d,p){var y=this.localIdeographFontFamily;if(y&&this._doesCharSupportLocalGlyph(p)){var I=h.tinySDF;if(!I){var P="400";/bold/i.test(d)?P="900":/medium/i.test(d)?P="500":/light/i.test(d)&&(P="200"),I=h.tinySDF=new jr.TinySDF(24,3,8,.25,y,P)}return{id:p,bitmap:new T.AlphaImage({width:30,height:30},I.draw(String.fromCharCode(p))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},jr.loadGlyphRange=function(h,d,p,y,I){var P=256*d,D=P+255,O=y.transformRequest(y.normalizeGlyphsURL(p).replace("{fontstack}",h).replace("{range}",P+"-"+D),T.ResourceType.Glyphs);T.getArrayBuffer(O,function(G,Q){if(G)I(G);else if(Q){for(var oe={},_e=0,Se=T.parseGlyphPBF(Q);_e<Se.length;_e+=1){var Te=Se[_e];oe[Te.id]=Te}I(null,oe)}})},jr.TinySDF=co;var Xt=function(){this.specification=T.styleSpec.light.position};Xt.prototype.possiblyEvaluate=function(h,d){return T.sphericalToCartesian(h.expression.evaluate(d))},Xt.prototype.interpolate=function(h,d,p){return{x:T.number(h.x,d.x,p),y:T.number(h.y,d.y,p),z:T.number(h.z,d.z,p)}};var En=new T.Properties({anchor:new T.DataConstantProperty(T.styleSpec.light.anchor),position:new Xt,color:new T.DataConstantProperty(T.styleSpec.light.color),intensity:new T.DataConstantProperty(T.styleSpec.light.intensity)}),Wo=function(h){function d(p){h.call(this),this._transitionable=new T.Transitionable(En),this.setLight(p),this._transitioning=this._transitionable.untransitioned()}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(p,y){if(y===void 0&&(y={}),!this._validate(T.validateLight,p,y))for(var I in p){var P=p[I];T.endsWith(I,"-transition")?this._transitionable.setTransition(I.slice(0,-11),P):this._transitionable.setValue(I,P)}},d.prototype.updateTransitions=function(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(p){this.properties=this._transitioning.possiblyEvaluate(p)},d.prototype._validate=function(p,y,I){return(!I||I.validate!==!1)&&T.emitValidationErrors(this,p.call(T.validateStyle,T.extend({value:y,style:{glyphs:!0,sprite:!0},styleSpec:T.styleSpec})))},d}(T.Evented),Ki=function(h,d){this.width=h,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ki.prototype.getDash=function(h,d){var p=h.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(h,d)),this.dashEntry[p]},Ki.prototype.getDashRanges=function(h,d,p){var y=[],I=h.length%2==1?-h[h.length-1]*p:0,P=h[0]*p,D=!0;y.push({left:I,right:P,isDash:D,zeroLength:h[0]===0});for(var O=h[0],G=1;G<h.length;G++){D=!D;var Q=h[G];I=O*p,P=(O+=Q)*p,y.push({left:I,right:P,isDash:D,zeroLength:Q===0})}return y},Ki.prototype.addRoundDash=function(h,d,p){for(var y=d/2,I=-p;I<=p;I++)for(var P=this.nextRow+p+I,D=this.width*P,O=0,G=h[O],Q=0;Q<this.width;Q++){Q/G.right>1&&(G=h[++O]);var oe=Math.abs(Q-G.left),_e=Math.abs(Q-G.right),Se=Math.min(oe,_e),Te=void 0,ge=I/p*(y+1);if(G.isDash){var be=y-Math.abs(ge);Te=Math.sqrt(Se*Se+be*be)}else Te=y-Math.sqrt(Se*Se+ge*ge);this.data[D+Q]=Math.max(0,Math.min(255,Te+128))}},Ki.prototype.addRegularDash=function(h){for(var d=h.length-1;d>=0;--d){var p=h[d],y=h[d+1];p.zeroLength?h.splice(d,1):y&&y.isDash===p.isDash&&(y.left=p.left,h.splice(d,1))}var I=h[0],P=h[h.length-1];I.isDash===P.isDash&&(I.left=P.left-this.width,P.right=I.right+this.width);for(var D=this.width*this.nextRow,O=0,G=h[O],Q=0;Q<this.width;Q++){Q/G.right>1&&(G=h[++O]);var oe=Math.abs(Q-G.left),_e=Math.abs(Q-G.right),Se=Math.min(oe,_e),Te=G.isDash?Se:-Se;this.data[D+Q]=Math.max(0,Math.min(255,Te+128))}},Ki.prototype.addDash=function(h,d){var p=d?7:0,y=2*p+1;if(this.nextRow+y>this.height)return T.warnOnce("LineAtlas out of space"),null;for(var I=0,P=0;P<h.length;P++)I+=h[P];var D=this.width/I,O=this.getDashRanges(h,this.width,D);d?this.addRoundDash(O,D,p):this.addRegularDash(O);var G={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:I};return this.nextRow+=y,this.dirty=!0,G},Ki.prototype.bind=function(h){var d=h.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var en=function h(d,p){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=T.uniqueId();for(var y=this.workerPool.acquire(this.id),I=0;I<y.length;I++){var P=y[I],D=new h.Actor(P,p,this.id);D.name="Worker "+I,this.actors.push(D)}};function us(h,d,p){var y=function(I,P){if(I)return p(I);if(P){var D=T.pick(T.extend(P,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(D.vectorLayers=P.vector_layers,D.vectorLayerIds=D.vectorLayers.map(function(O){return O.id})),D.tiles=d.canonicalizeTileset(D,h.url),p(null,D)}};return h.url?T.getJSON(d.transformRequest(d.normalizeSourceURL(h.url),T.ResourceType.Source),y):T.browser.frame(function(){return y(null,h)})}en.prototype.broadcast=function(h,d,p){p=p||function(){},T.asyncAll(this.actors,function(y,I){y.send(h,d,I)},p)},en.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},en.prototype.remove=function(){this.actors.forEach(function(h){h.remove()}),this.actors=[],this.workerPool.release(this.id)},en.Actor=T.Actor;var fa=function(h,d,p){this.bounds=T.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=d||0,this.maxzoom=p||24};fa.prototype.validateBounds=function(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]},fa.prototype.contains=function(h){var d=Math.pow(2,h.z),p=Math.floor(T.mercatorXfromLng(this.bounds.getWest())*d),y=Math.floor(T.mercatorYfromLat(this.bounds.getNorth())*d),I=Math.ceil(T.mercatorXfromLng(this.bounds.getEast())*d),P=Math.ceil(T.mercatorYfromLat(this.bounds.getSouth())*d);return h.x>=p&&h.x<I&&h.y>=y&&h.y<P};var hs=function(h){function d(p,y,I,P){if(h.call(this),this.id=p,this.dispatcher=I,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,T.extend(this,T.pick(y,["url","scheme","tileSize","promoteId"])),this._options=T.extend({type:"vector"},y),this._collectResourceTiming=y.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new T.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=us(this._options,this.map._requestManager,function(y,I){p._tileJSONRequest=null,p._loaded=!0,y?p.fire(new T.ErrorEvent(y)):I&&(T.extend(p,I),I.bounds&&(p.tileBounds=new fa(I.bounds,p.minzoom,p.maxzoom)),T.postTurnstileEvent(I.tiles,p.map._requestManager._customAccessToken),T.postMapLoadEvent(I.tiles,p.map._getMapId(),p.map._requestManager._skuToken,p.map._requestManager._customAccessToken),p.fire(new T.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new T.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return T.extend({},this._options)},d.prototype.loadTile=function(p,y){var I=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),P={request:this.map._requestManager.transformRequest(I,T.ResourceType.Tile),uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:T.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function D(O,G){return delete p.request,p.aborted?y(null):O&&O.status!==404?y(O):(G&&G.resourceTiming&&(p.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&p.setExpiryData(G),p.loadVectorData(G,this.map.painter),T.cacheEntryPossiblyAdded(this.dispatcher),y(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}P.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired"?p.state==="loading"?p.reloadCallback=y:p.request=p.actor.send("reloadTile",P,D.bind(this)):(p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",P,D.bind(this)))},d.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(T.Evented),gl=function(h){function d(p,y,I,P){h.call(this),this.id=p,this.dispatcher=I,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=T.extend({type:"raster"},y),T.extend(this,T.pick(y,["url","scheme","tileSize"]))}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new T.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=us(this._options,this.map._requestManager,function(y,I){p._tileJSONRequest=null,p._loaded=!0,y?p.fire(new T.ErrorEvent(y)):I&&(T.extend(p,I),I.bounds&&(p.tileBounds=new fa(I.bounds,p.minzoom,p.maxzoom)),T.postTurnstileEvent(I.tiles),T.postMapLoadEvent(I.tiles,p.map._getMapId(),p.map._requestManager._skuToken),p.fire(new T.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new T.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return T.extend({},this._options)},d.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},d.prototype.loadTile=function(p,y){var I=this,P=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);p.request=T.getImage(this.map._requestManager.transformRequest(P,T.ResourceType.Tile),function(D,O){if(delete p.request,p.aborted)p.state="unloaded",y(null);else if(D)p.state="errored",y(D);else if(O){I.map._refreshExpiredTiles&&p.setExpiryData(O),delete O.cacheControl,delete O.expires;var G=I.map.painter.context,Q=G.gl;p.texture=I.map.painter.getTileTexture(O.width),p.texture?p.texture.update(O,{useMipmap:!0}):(p.texture=new T.Texture(G,O,Q.RGBA,{useMipmap:!0}),p.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&Q.texParameterf(Q.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),p.state="loaded",T.cacheEntryPossiblyAdded(I.dispatcher),y(null)}})},d.prototype.abortTile=function(p,y){p.request&&(p.request.cancel(),delete p.request),y()},d.prototype.unloadTile=function(p,y){p.texture&&this.map.painter.saveTileTexture(p.texture),y()},d.prototype.hasTransition=function(){return!1},d}(T.Evented),or=function(h){function d(p,y,I,P){h.call(this,p,y,I,P),this.type="raster-dem",this.maxzoom=22,this._options=T.extend({type:"raster-dem"},y),this.encoding=y.encoding||"mapbox"}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(p,y){var I=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function P(D,O){D&&(p.state="errored",y(D)),O&&(p.dem=O,p.needsHillshadePrepare=!0,p.state="loaded",y(null))}p.request=T.getImage(this.map._requestManager.transformRequest(I,T.ResourceType.Tile),(function(D,O){if(delete p.request,p.aborted)p.state="unloaded",y(null);else if(D)p.state="errored",y(D);else if(O){this.map._refreshExpiredTiles&&p.setExpiryData(O),delete O.cacheControl,delete O.expires;var G=T.window.ImageBitmap&&O instanceof T.window.ImageBitmap&&T.offscreenCanvasSupported()?O:T.browser.getImageData(O,1),Q={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:G,encoding:this.encoding};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",Q,P.bind(this)))}}).bind(this)),p.neighboringTiles=this._getNeighboringTiles(p.tileID)},d.prototype._getNeighboringTiles=function(p){var y=p.canonical,I=Math.pow(2,y.z),P=(y.x-1+I)%I,D=y.x===0?p.wrap-1:p.wrap,O=(y.x+1+I)%I,G=y.x+1===I?p.wrap+1:p.wrap,Q={};return Q[new T.OverscaledTileID(p.overscaledZ,D,y.z,P,y.y).key]={backfilled:!1},Q[new T.OverscaledTileID(p.overscaledZ,G,y.z,O,y.y).key]={backfilled:!1},y.y>0&&(Q[new T.OverscaledTileID(p.overscaledZ,D,y.z,P,y.y-1).key]={backfilled:!1},Q[new T.OverscaledTileID(p.overscaledZ,p.wrap,y.z,y.x,y.y-1).key]={backfilled:!1},Q[new T.OverscaledTileID(p.overscaledZ,G,y.z,O,y.y-1).key]={backfilled:!1}),y.y+1<I&&(Q[new T.OverscaledTileID(p.overscaledZ,D,y.z,P,y.y+1).key]={backfilled:!1},Q[new T.OverscaledTileID(p.overscaledZ,p.wrap,y.z,y.x,y.y+1).key]={backfilled:!1},Q[new T.OverscaledTileID(p.overscaledZ,G,y.z,O,y.y+1).key]={backfilled:!1}),Q},d.prototype.unloadTile=function(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded",p.actor&&p.actor.send("removeDEMTile",{uid:p.uid,source:this.id})},d}(gl),Cs=function(h){function d(p,y,I,P){h.call(this),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=I.getActor(),this.setEventedParent(P),this._data=y.data,this._options=T.extend({},y),this._collectResourceTiming=y.collectResourceTiming,this._resourceTiming=[],y.maxzoom!==void 0&&(this.maxzoom=y.maxzoom),y.type&&(this.type=y.type),y.attribution&&(this.attribution=y.attribution),this.promoteId=y.promoteId;var D=T.EXTENT/this.tileSize;this.workerOptions=T.extend({source:this.id,cluster:y.cluster||!1,geojsonVtOptions:{buffer:(y.buffer!==void 0?y.buffer:128)*D,tolerance:(y.tolerance!==void 0?y.tolerance:.375)*D,extent:T.EXTENT,maxZoom:this.maxzoom,lineMetrics:y.lineMetrics||!1,generateId:y.generateId||!1},superclusterOptions:{maxZoom:y.clusterMaxZoom!==void 0?Math.min(y.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:T.EXTENT,radius:(y.clusterRadius||50)*D,log:!1,generateId:y.generateId||!1},clusterProperties:y.clusterProperties},y.workerOptions)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.load=function(){var p=this;this.fire(new T.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(y){if(y)p.fire(new T.ErrorEvent(y));else{var I={dataType:"source",sourceDataType:"metadata"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(I.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new T.Event("data",I))}})},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.setData=function(p){var y=this;return this._data=p,this.fire(new T.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(I){if(I)y.fire(new T.ErrorEvent(I));else{var P={dataType:"source",sourceDataType:"content"};y._collectResourceTiming&&y._resourceTiming&&y._resourceTiming.length>0&&(P.resourceTiming=y._resourceTiming,y._resourceTiming=[]),y.fire(new T.Event("data",P))}}),this},d.prototype.getClusterExpansionZoom=function(p,y){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},y),this},d.prototype.getClusterChildren=function(p,y){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},y),this},d.prototype.getClusterLeaves=function(p,y,I,P){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:y,offset:I},P),this},d.prototype._updateWorkerData=function(p){var y=this;this._loaded=!1;var I=T.extend({},this.workerOptions),P=this._data;typeof P=="string"?(I.request=this.map._requestManager.transformRequest(T.browser.resolveURL(P),T.ResourceType.Source),I.request.collectResourceTiming=this._collectResourceTiming):I.data=JSON.stringify(P),this.actor.send(this.type+".loadData",I,function(D,O){y._removed||O&&O.abandoned||(y._loaded=!0,O&&O.resourceTiming&&O.resourceTiming[y.id]&&(y._resourceTiming=O.resourceTiming[y.id].slice(0)),y.actor.send(y.type+".coalesce",{source:I.source},null),p(D))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(p,y){var I=this,P=p.actor?"reloadTile":"loadTile";p.actor=this.actor;var D={type:this.type,uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:T.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request=this.actor.send(P,D,function(O,G){return delete p.request,p.unloadVectorData(),p.aborted?y(null):O?y(O):(p.loadVectorData(G,I.map.painter,P==="reloadTile"),y(null))})},d.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0},d.prototype.unloadTile=function(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return T.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(T.Evented),tn=T.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),hn=function(h){function d(p,y,I,P){h.call(this),this.id=p,this.dispatcher=I,this.coordinates=y.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(P),this.options=y}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.load=function(p,y){var I=this;this._loaded=!1,this.fire(new T.Event("dataloading",{dataType:"source"})),this.url=this.options.url,T.getImage(this.map._requestManager.transformRequest(this.url,T.ResourceType.Image),function(P,D){I._loaded=!0,P?I.fire(new T.ErrorEvent(P)):D&&(I.image=D,p&&(I.coordinates=p),y&&y(),I._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(p){var y=this;return this.image&&p.url?(this.options.url=p.url,this.load(p.coordinates,function(){y.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new T.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.setCoordinates=function(p){var y=this;this.coordinates=p;var I=p.map(T.MercatorCoordinate.fromLngLat);this.tileID=function(D){for(var O=1/0,G=1/0,Q=-1/0,oe=-1/0,_e=0,Se=D;_e<Se.length;_e+=1){var Te=Se[_e];O=Math.min(O,Te.x),G=Math.min(G,Te.y),Q=Math.max(Q,Te.x),oe=Math.max(oe,Te.y)}var ge=Q-O,be=oe-G,We=Math.max(ge,be),Ne=Math.max(0,Math.floor(-Math.log(We)/Math.LN2)),et=Math.pow(2,Ne);return new T.CanonicalTileID(Ne,Math.floor((O+Q)/2*et),Math.floor((G+oe)/2*et))}(I),this.minzoom=this.maxzoom=this.tileID.z;var P=I.map(function(D){return y.tileID.getTilePoint(D)._round()});return this._boundsArray=new T.StructArrayLayout4i8,this._boundsArray.emplaceBack(P[0].x,P[0].y,0,0),this._boundsArray.emplaceBack(P[1].x,P[1].y,T.EXTENT,0),this._boundsArray.emplaceBack(P[3].x,P[3].y,0,T.EXTENT),this._boundsArray.emplaceBack(P[2].x,P[2].y,T.EXTENT,T.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new T.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var p=this.map.painter.context,y=p.gl;for(var I in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=T.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new T.Texture(p,this.image,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[I];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.loadTile=function(p,y){this.tileID&&this.tileID.equals(p.tileID.canonical)?(this.tiles[String(p.tileID.wrap)]=p,p.buckets={},y(null)):(p.state="errored",y(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(T.Evented),zs=function(h){function d(p,y,I,P){h.call(this,p,y,I,P),this.roundZoom=!0,this.type="video",this.options=y}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.load=function(){var p=this;this._loaded=!1;var y=this.options;this.urls=[];for(var I=0,P=y.urls;I<P.length;I+=1){var D=P[I];this.urls.push(this.map._requestManager.transformRequest(D,T.ResourceType.Source).url)}T.getVideo(this.urls,function(O,G){p._loaded=!0,O?p.fire(new T.ErrorEvent(O)):G&&(p.video=G,p.video.loop=!0,p.video.addEventListener("playing",function(){p.map.triggerRepaint()}),p.map&&p.video.play(),p._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(p){if(this.video){var y=this.video.seekable;p<y.start(0)||p>y.end(0)?this.fire(new T.ErrorEvent(new T.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+y.start(0)+" and "+y.end(0)+"-second mark."))):this.video.currentTime=p}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var p=this.map.painter.context,y=p.gl;for(var I in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=T.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.texSubImage2D(y.TEXTURE_2D,0,0,0,y.RGBA,y.UNSIGNED_BYTE,this.video)):(this.texture=new T.Texture(p,this.video,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[I];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(hn),Gn=function(h){function d(p,y,I,P){h.call(this,p,y,I,P),y.coordinates?Array.isArray(y.coordinates)&&y.coordinates.length===4&&!y.coordinates.some(function(D){return!Array.isArray(D)||D.length!==2||D.some(function(O){return typeof O!="number"})})||this.fire(new T.ErrorEvent(new T.ValidationError("sources."+p,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new T.ErrorEvent(new T.ValidationError("sources."+p,null,'missing required property "coordinates"'))),y.animate&&typeof y.animate!="boolean"&&this.fire(new T.ErrorEvent(new T.ValidationError("sources."+p,null,'optional "animate" property must be a boolean value'))),y.canvas?typeof y.canvas=="string"||y.canvas instanceof T.window.HTMLCanvasElement||this.fire(new T.ErrorEvent(new T.ValidationError("sources."+p,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new T.ErrorEvent(new T.ValidationError("sources."+p,null,'missing required property "canvas"'))),this.options=y,this.animate=y.animate===void 0||y.animate}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof T.window.HTMLCanvasElement?this.options.canvas:T.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new T.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var y=this.map.painter.context,I=y.gl;for(var P in this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=T.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new T.Texture(y,this.canvas,I.RGBA,{premultiply:!0}),this.tiles){var D=this.tiles[P];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var p=0,y=[this.canvas.width,this.canvas.height];p<y.length;p+=1){var I=y[p];if(isNaN(I)||I<=0)return!0}return!1},d}(hn),ma={vector:hs,raster:gl,"raster-dem":or,geojson:Cs,video:zs,image:hn,canvas:Gn},_a=function(h,d,p,y){var I=new ma[d.type](h,d,p,y);if(I.id!==h)throw new Error("Expected Source id to be "+h+" instead of "+I.id);return T.bindAll(["load","abort","unload","serialize","prepare"],I),I};function pn(h,d){var p=T.identity([]);return T.translate(p,p,[1,1,0]),T.scale(p,p,[.5*h.width,.5*h.height,1]),T.multiply(p,p,h.calculatePosMatrix(d.toUnwrapped()))}function ga(h,d,p,y,I){var P=function(ge,be,We){if(ge)for(var Ne=0,et=ge;Ne<et.length;Ne+=1){var Je=be[et[Ne]];if(Je&&Je.source===We&&Je.type==="fill-extrusion")return!0}else for(var ot in be){var gt=be[ot];if(gt.source===We&&gt.type==="fill-extrusion")return!0}return!1}(y&&y.layers,d,h.id),D=I.maxPitchScaleFactor(),O=h.tilesIn(p,D,P);O.sort(ps);for(var G=[],Q=0,oe=O;Q<oe.length;Q+=1){var _e=oe[Q];G.push({wrappedTileID:_e.tileID.wrapped().key,queryResults:_e.tile.queryRenderedFeatures(d,h._state,_e.queryGeometry,_e.cameraQueryGeometry,_e.scale,y,I,D,pn(h.transform,_e.tileID))})}var Se=function(ge){for(var be={},We={},Ne=0,et=ge;Ne<et.length;Ne+=1){var Je=et[Ne],ot=Je.queryResults,gt=Je.wrappedTileID,Ct=We[gt]=We[gt]||{};for(var Vt in ot)for(var fi=ot[Vt],ei=Ct[Vt]=Ct[Vt]||{},ni=be[Vt]=be[Vt]||[],Nt=0,Hi=fi;Nt<Hi.length;Nt+=1){var Ii=Hi[Nt];ei[Ii.featureIndex]||(ei[Ii.featureIndex]=!0,ni.push(Ii))}}return be}(G);for(var Te in Se)Se[Te].forEach(function(ge){var be=ge.feature,We=h.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=We});return Se}function ps(h,d){var p=h.tileID,y=d.tileID;return p.overscaledZ-y.overscaledZ||p.canonical.y-y.canonical.y||p.wrap-y.wrap||p.canonical.x-y.canonical.x}var Fn=function(h,d){this.max=h,this.onRemove=d,this.reset()};Fn.prototype.reset=function(){for(var h in this.data)for(var d=0,p=this.data[h];d<p.length;d+=1){var y=p[d];y.timeout&&clearTimeout(y.timeout),this.onRemove(y.value)}return this.data={},this.order=[],this},Fn.prototype.add=function(h,d,p){var y=this,I=h.wrapped().key;this.data[I]===void 0&&(this.data[I]=[]);var P={value:d,timeout:void 0};if(p!==void 0&&(P.timeout=setTimeout(function(){y.remove(h,P)},p)),this.data[I].push(P),this.order.push(I),this.order.length>this.max){var D=this._getAndRemoveByKey(this.order[0]);D&&this.onRemove(D)}return this},Fn.prototype.has=function(h){return h.wrapped().key in this.data},Fn.prototype.getAndRemove=function(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null},Fn.prototype._getAndRemoveByKey=function(h){var d=this.data[h].shift();return d.timeout&&clearTimeout(d.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),d.value},Fn.prototype.getByKey=function(h){var d=this.data[h];return d?d[0].value:null},Fn.prototype.get=function(h){return this.has(h)?this.data[h.wrapped().key][0].value:null},Fn.prototype.remove=function(h,d){if(!this.has(h))return this;var p=h.wrapped().key,y=d===void 0?0:this.data[p].indexOf(d),I=this.data[p][y];return this.data[p].splice(y,1),I.timeout&&clearTimeout(I.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(I.value),this.order.splice(this.order.indexOf(p),1),this},Fn.prototype.setMaxSize=function(h){for(this.max=h;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Fn.prototype.filter=function(h){var d=[];for(var p in this.data)for(var y=0,I=this.data[p];y<I.length;y+=1){var P=I[y];h(P.value)||d.push(P)}for(var D=0,O=d;D<O.length;D+=1){var G=O[D];this.remove(G.value.tileID,G)}};var ya=function(h,d,p){this.context=h;var y=h.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};ya.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ya.prototype.updateData=function(h){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)},ya.prototype.destroy=function(){var h=this.context.gl;this.buffer&&(h.deleteBuffer(this.buffer),delete this.buffer)};var cr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},On=function(h,d,p,y){this.length=d.length,this.attributes=p,this.itemSize=d.bytesPerElement,this.dynamicDraw=y,this.context=h;var I=h.gl;this.buffer=I.createBuffer(),h.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};On.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},On.prototype.updateData=function(h){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,h.arrayBuffer)},On.prototype.enableAttributes=function(h,d){for(var p=0;p<this.attributes.length;p++){var y=this.attributes[p],I=d.attributes[y.name];I!==void 0&&h.enableVertexAttribArray(I)}},On.prototype.setVertexAttribPointers=function(h,d,p){for(var y=0;y<this.attributes.length;y++){var I=this.attributes[y],P=d.attributes[I.name];P!==void 0&&h.vertexAttribPointer(P,I.components,h[cr[I.type]],!1,this.itemSize,I.offset+this.itemSize*(p||0))}},On.prototype.destroy=function(){var h=this.context.gl;this.buffer&&(h.deleteBuffer(this.buffer),delete this.buffer)};var Ui=function(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Ui.prototype.get=function(){return this.current},Ui.prototype.set=function(h){},Ui.prototype.getDefault=function(){return this.default},Ui.prototype.setDefault=function(){this.set(this.default)};var Ps=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return T.Color.transparent},d.prototype.set=function(p){var y=this.current;(p.r!==y.r||p.g!==y.g||p.b!==y.b||p.a!==y.a||this.dirty)&&(this.gl.clearColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},d}(Ui),Hr=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearDepth(p),this.current=p,this.dirty=!1)},d}(Ui),vn=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearStencil(p),this.current=p,this.dirty=!1)},d}(Ui),Ma=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||p[2]!==y[2]||p[3]!==y[3]||this.dirty)&&(this.gl.colorMask(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},d}(Ui),va=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthMask(p),this.current=p,this.dirty=!1)},d}(Ui),ko=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.stencilMask(p),this.current=p,this.dirty=!1)},d}(Ui),na=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(p){var y=this.current;(p.func!==y.func||p.ref!==y.ref||p.mask!==y.mask||this.dirty)&&(this.gl.stencilFunc(p.func,p.ref,p.mask),this.current=p,this.dirty=!1)},d}(Ui),Co=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){var p=this.gl;return[p.KEEP,p.KEEP,p.KEEP]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||p[2]!==y[2]||this.dirty)&&(this.gl.stencilOp(p[0],p[1],p[2]),this.current=p,this.dirty=!1)},d}(Ui),Na=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;p?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST),this.current=p,this.dirty=!1}},d}(Ui),xa=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||this.dirty)&&(this.gl.depthRange(p[0],p[1]),this.current=p,this.dirty=!1)},d}(Ui),ks=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;p?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST),this.current=p,this.dirty=!1}},d}(Ui),ql=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthFunc(p),this.current=p,this.dirty=!1)},d}(Ui),Gl=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;p?y.enable(y.BLEND):y.disable(y.BLEND),this.current=p,this.dirty=!1}},d}(Ui),zo=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){var p=this.gl;return[p.ONE,p.ZERO]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||this.dirty)&&(this.gl.blendFunc(p[0],p[1]),this.current=p,this.dirty=!1)},d}(Ui),Ca=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return T.Color.transparent},d.prototype.set=function(p){var y=this.current;(p.r!==y.r||p.g!==y.g||p.b!==y.b||p.a!==y.a||this.dirty)&&(this.gl.blendColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},d}(Ui),ds=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.blendEquation(p),this.current=p,this.dirty=!1)},d}(Ui),fs=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;p?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE),this.current=p,this.dirty=!1}},d}(Ui),Ds=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.cullFace(p),this.current=p,this.dirty=!1)},d}(Ui),ja=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.frontFace(p),this.current=p,this.dirty=!1)},d}(Ui),Ls=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)},d}(Ui),qa=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.activeTexture(p),this.current=p,this.dirty=!1)},d}(Ui),Do=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){var p=this.gl;return[0,0,p.drawingBufferWidth,p.drawingBufferHeight]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||p[2]!==y[2]||p[3]!==y[3]||this.dirty)&&(this.gl.viewport(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},d}(Ui),ms=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.bindFramebuffer(y.FRAMEBUFFER,p),this.current=p,this.dirty=!1}},d}(Ui),Rs=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.bindRenderbuffer(y.RENDERBUFFER,p),this.current=p,this.dirty=!1}},d}(Ui),yl=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.bindTexture(y.TEXTURE_2D,p),this.current=p,this.dirty=!1}},d}(Ui),Ce=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.bindBuffer(y.ARRAY_BUFFER,p),this.current=p,this.dirty=!1}},d}(Ui),te=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){var y=this.gl;y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,p),this.current=p,this.dirty=!1},d}(Ui),re=function(h){function d(p){h.call(this,p),this.vao=p.extVertexArrayObject}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){this.vao&&(p!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(p),this.current=p,this.dirty=!1)},d}(Ui),Ie=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_ALIGNMENT,p),this.current=p,this.dirty=!1}},d}(Ui),De=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),this.current=p,this.dirty=!1}},d}(Ui),Ze=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,p),this.current=p,this.dirty=!1}},d}(Ui),tt=function(h){function d(p,y){h.call(this,p),this.context=p,this.parent=y}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getDefault=function(){return null},d}(Ui),Qe=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var y=this.gl;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,p,0),this.current=p,this.dirty=!1}},d}(tt),Ge=function(h){function d(){h.apply(this,arguments)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var y=this.gl;y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,p),this.current=p,this.dirty=!1}},d}(tt),pt=function(h,d,p){this.context=h,this.width=d,this.height=p;var y=h.gl,I=this.framebuffer=y.createFramebuffer();this.colorAttachment=new Qe(h,I),this.depthAttachment=new Ge(h,I)};pt.prototype.destroy=function(){var h=this.context.gl,d=this.colorAttachment.get();d&&h.deleteTexture(d);var p=this.depthAttachment.get();p&&h.deleteRenderbuffer(p),h.deleteFramebuffer(this.framebuffer)};var vt=function(h,d,p){this.func=h,this.mask=d,this.range=p};vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);var Pt=function(h,d,p,y,I,P){this.test=h,this.ref=d,this.mask=p,this.fail=y,this.depthFail=I,this.pass=P};Pt.disabled=new Pt({func:519,mask:0},0,0,7680,7680,7680);var Et=function(h,d,p){this.blendFunction=h,this.blendColor=d,this.mask=p};Et.Replace=[1,0],Et.disabled=new Et(Et.Replace,T.Color.transparent,[!1,!1,!1,!1]),Et.unblended=new Et(Et.Replace,T.Color.transparent,[!0,!0,!0,!0]),Et.alphaBlended=new Et([1,771],T.Color.transparent,[!0,!0,!0,!0]);var mi=function(h,d,p){this.enable=h,this.mode=d,this.frontFace=p};mi.disabled=new mi(!1,1029,2305),mi.backCCW=new mi(!0,1029,2305);var Li=function(h){this.gl=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ps(this),this.clearDepth=new Hr(this),this.clearStencil=new vn(this),this.colorMask=new Ma(this),this.depthMask=new va(this),this.stencilMask=new ko(this),this.stencilFunc=new na(this),this.stencilOp=new Co(this),this.stencilTest=new Na(this),this.depthRange=new xa(this),this.depthTest=new ks(this),this.depthFunc=new ql(this),this.blend=new Gl(this),this.blendFunc=new zo(this),this.blendColor=new Ca(this),this.blendEquation=new ds(this),this.cullFace=new fs(this),this.cullFaceSide=new Ds(this),this.frontFace=new ja(this),this.program=new Ls(this),this.activeTexture=new qa(this),this.viewport=new Do(this),this.bindFramebuffer=new ms(this),this.bindRenderbuffer=new Rs(this),this.bindTexture=new yl(this),this.bindVertexBuffer=new Ce(this),this.bindElementBuffer=new te(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new re(this),this.pixelStoreUnpack=new Ie(this),this.pixelStoreUnpackPremultiplyAlpha=new De(this),this.pixelStoreUnpackFlipY=new Ze(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=h.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&h.getExtension("OES_texture_half_float_linear"),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query")};Li.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Li.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Li.prototype.createIndexBuffer=function(h,d){return new ya(this,h,d)},Li.prototype.createVertexBuffer=function(h,d,p){return new On(this,h,d,p)},Li.prototype.createRenderbuffer=function(h,d,p){var y=this.gl,I=y.createRenderbuffer();return this.bindRenderbuffer.set(I),y.renderbufferStorage(y.RENDERBUFFER,h,d,p),this.bindRenderbuffer.set(null),I},Li.prototype.createFramebuffer=function(h,d){return new pt(this,h,d)},Li.prototype.clear=function(h){var d=h.color,p=h.depth,y=this.gl,I=0;d&&(I|=y.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(I|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),y.clear(I)},Li.prototype.setCullFace=function(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))},Li.prototype.setDepthMode=function(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)},Li.prototype.setStencilMode=function(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)},Li.prototype.setColorMode=function(h){T.deepEqual(h.blendFunction,Et.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)},Li.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var li=function(h){function d(p,y,I){var P=this;h.call(this),this.id=p,this.dispatcher=I,this.on("data",function(D){D.dataType==="source"&&D.sourceDataType==="metadata"&&(P._sourceLoaded=!0),P._sourceLoaded&&!P._paused&&D.dataType==="source"&&D.sourceDataType==="content"&&(P.reload(),P.transform&&P.update(P.transform))}),this.on("error",function(){P._sourceErrored=!0}),this._source=_a(p,y,I,this),this._tiles={},this._cache=new Fn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new T.SourceFeatureState}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.onAdd=function(p){this.map=p,this._maxTileCacheSize=p?p._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(p)},d.prototype.onRemove=function(p){this._source&&this._source.onRemove&&this._source.onRemove(p)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var p in this._tiles){var y=this._tiles[p];if(y.state!=="loaded"&&y.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var p=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,p&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(p,y){return this._source.loadTile(p,y)},d.prototype._unloadTile=function(p){if(this._source.unloadTile)return this._source.unloadTile(p,function(){})},d.prototype._abortTile=function(p){if(this._source.abortTile)return this._source.abortTile(p,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(p){for(var y in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var I=this._tiles[y];I.upload(p),I.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return T.values(this._tiles).map(function(p){return p.tileID}).sort(V).map(function(p){return p.key})},d.prototype.getRenderableIds=function(p){var y=this,I=[];for(var P in this._tiles)this._isIdRenderable(P,p)&&I.push(this._tiles[P]);return p?I.sort(function(D,O){var G=D.tileID,Q=O.tileID,oe=new T.Point(G.canonical.x,G.canonical.y)._rotate(y.transform.angle),_e=new T.Point(Q.canonical.x,Q.canonical.y)._rotate(y.transform.angle);return G.overscaledZ-Q.overscaledZ||_e.y-oe.y||_e.x-oe.x}).map(function(D){return D.tileID.key}):I.map(function(D){return D.tileID}).sort(V).map(function(D){return D.key})},d.prototype.hasRenderableParent=function(p){var y=this.findLoadedParent(p,0);return!!y&&this._isIdRenderable(y.tileID.key)},d.prototype._isIdRenderable=function(p,y){return this._tiles[p]&&this._tiles[p].hasData()&&!this._coveredTiles[p]&&(y||!this._tiles[p].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var p in this._cache.reset(),this._tiles)this._tiles[p].state!=="errored"&&this._reloadTile(p,"reloading")},d.prototype._reloadTile=function(p,y){var I=this._tiles[p];I&&(I.state!=="loading"&&(I.state=y),this._loadTile(I,this._tileLoaded.bind(this,I,p,y)))},d.prototype._tileLoaded=function(p,y,I,P){if(P)return p.state="errored",void(P.status!==404?this._source.fire(new T.ErrorEvent(P,{tile:p})):this.update(this.transform));p.timeAdded=T.browser.now(),I==="expired"&&(p.refreshedUponExpiration=!0),this._setTileReloadTimer(y,p),this.getSource().type==="raster-dem"&&p.dem&&this._backfillDEM(p),this._state.initializeTileState(p,this.map?this.map.painter:null),this._source.fire(new T.Event("data",{dataType:"source",tile:p,coord:p.tileID}))},d.prototype._backfillDEM=function(p){for(var y=this.getRenderableIds(),I=0;I<y.length;I++){var P=y[I];if(p.neighboringTiles&&p.neighboringTiles[P]){var D=this.getTileByID(P);O(p,D),O(D,p)}}function O(G,Q){G.needsHillshadePrepare=!0;var oe=Q.tileID.canonical.x-G.tileID.canonical.x,_e=Q.tileID.canonical.y-G.tileID.canonical.y,Se=Math.pow(2,G.tileID.canonical.z),Te=Q.tileID.key;oe===0&&_e===0||Math.abs(_e)>1||(Math.abs(oe)>1&&(Math.abs(oe+Se)===1?oe+=Se:Math.abs(oe-Se)===1&&(oe-=Se)),Q.dem&&G.dem&&(G.dem.backfillBorder(Q.dem,oe,_e),G.neighboringTiles&&G.neighboringTiles[Te]&&(G.neighboringTiles[Te].backfilled=!0)))}},d.prototype.getTile=function(p){return this.getTileByID(p.key)},d.prototype.getTileByID=function(p){return this._tiles[p]},d.prototype._retainLoadedChildren=function(p,y,I,P){for(var D in this._tiles){var O=this._tiles[D];if(!(P[D]||!O.hasData()||O.tileID.overscaledZ<=y||O.tileID.overscaledZ>I)){for(var G=O.tileID;O&&O.tileID.overscaledZ>y+1;){var Q=O.tileID.scaledTo(O.tileID.overscaledZ-1);(O=this._tiles[Q.key])&&O.hasData()&&(G=Q)}for(var oe=G;oe.overscaledZ>y;)if(p[(oe=oe.scaledTo(oe.overscaledZ-1)).key]){P[G.key]=G;break}}}},d.prototype.findLoadedParent=function(p,y){if(p.key in this._loadedParentTiles){var I=this._loadedParentTiles[p.key];return I&&I.tileID.overscaledZ>=y?I:null}for(var P=p.overscaledZ-1;P>=y;P--){var D=p.scaledTo(P),O=this._getLoadedTile(D);if(O)return O}},d.prototype._getLoadedTile=function(p){var y=this._tiles[p.key];return y&&y.hasData()?y:this._cache.getByKey(p.wrapped().key)},d.prototype.updateCacheSize=function(p){var y=(Math.ceil(p.width/this._source.tileSize)+1)*(Math.ceil(p.height/this._source.tileSize)+1),I=Math.floor(5*y),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(P)},d.prototype.handleWrapJump=function(p){var y=(p-(this._prevLng===void 0?p:this._prevLng))/360,I=Math.round(y);if(this._prevLng=p,I){var P={};for(var D in this._tiles){var O=this._tiles[D];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+I),P[O.tileID.key]=O}for(var G in this._tiles=P,this._timers)clearTimeout(this._timers[G]),delete this._timers[G];for(var Q in this._tiles){var oe=this._tiles[Q];this._setTileReloadTimer(Q,oe)}}},d.prototype.update=function(p){var y=this;if(this.transform=p,this._sourceLoaded&&!this._paused){var I;this.updateCacheSize(p),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?I=p.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Vt){return new T.OverscaledTileID(Vt.canonical.z,Vt.wrap,Vt.canonical.z,Vt.canonical.x,Vt.canonical.y)}):(I=p.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(I=I.filter(function(Vt){return y._source.hasTile(Vt)}))):I=[];var P=p.coveringZoomLevel(this._source),D=Math.max(P-d.maxOverzooming,this._source.minzoom),O=Math.max(P+d.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(I,P);if(X(this._source.type)){for(var Q={},oe={},_e=0,Se=Object.keys(G);_e<Se.length;_e+=1){var Te=Se[_e],ge=G[Te],be=this._tiles[Te];if(be&&!(be.fadeEndTime&&be.fadeEndTime<=T.browser.now())){var We=this.findLoadedParent(ge,D);We&&(this._addTile(We.tileID),Q[We.tileID.key]=We.tileID),oe[Te]=ge}}for(var Ne in this._retainLoadedChildren(oe,P,O,G),Q)G[Ne]||(this._coveredTiles[Ne]=!0,G[Ne]=Q[Ne])}for(var et in G)this._tiles[et].clearFadeHold();for(var Je=0,ot=T.keysDifference(this._tiles,G);Je<ot.length;Je+=1){var gt=ot[Je],Ct=this._tiles[gt];Ct.hasSymbolBuckets&&!Ct.holdingForFade()?Ct.setHoldDuration(this.map._fadeDuration):Ct.hasSymbolBuckets&&!Ct.symbolFadeFinished()||this._removeTile(gt)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var p in this._tiles)this._tiles[p].holdingForFade()&&this._removeTile(p)},d.prototype._updateRetainedTiles=function(p,y){for(var I={},P={},D=Math.max(y-d.maxOverzooming,this._source.minzoom),O=Math.max(y+d.maxUnderzooming,this._source.minzoom),G={},Q=0,oe=p;Q<oe.length;Q+=1){var _e=oe[Q],Se=this._addTile(_e);I[_e.key]=_e,Se.hasData()||y<this._source.maxzoom&&(G[_e.key]=_e)}this._retainLoadedChildren(G,y,O,I);for(var Te=0,ge=p;Te<ge.length;Te+=1){var be=ge[Te],We=this._tiles[be.key];if(!We.hasData()){if(y+1>this._source.maxzoom){var Ne=be.children(this._source.maxzoom)[0],et=this.getTile(Ne);if(et&&et.hasData()){I[Ne.key]=Ne;continue}}else{var Je=be.children(this._source.maxzoom);if(I[Je[0].key]&&I[Je[1].key]&&I[Je[2].key]&&I[Je[3].key])continue}for(var ot=We.wasRequested(),gt=be.overscaledZ-1;gt>=D;--gt){var Ct=be.scaledTo(gt);if(P[Ct.key]||(P[Ct.key]=!0,!(We=this.getTile(Ct))&&ot&&(We=this._addTile(Ct)),We&&(I[Ct.key]=Ct,ot=We.wasRequested(),We.hasData())))break}}}return I},d.prototype._updateLoadedParentTileCache=function(){for(var p in this._loadedParentTiles={},this._tiles){for(var y=[],I=void 0,P=this._tiles[p].tileID;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){I=this._loadedParentTiles[P.key];break}y.push(P.key);var D=P.scaledTo(P.overscaledZ-1);if(I=this._getLoadedTile(D))break;P=D}for(var O=0,G=y;O<G.length;O+=1){var Q=G[O];this._loadedParentTiles[Q]=I}}},d.prototype._addTile=function(p){var y=this._tiles[p.key];if(y)return y;(y=this._cache.getAndRemove(p))&&(this._setTileReloadTimer(p.key,y),y.tileID=p,this._state.initializeTileState(y,this.map?this.map.painter:null),this._cacheTimers[p.key]&&(clearTimeout(this._cacheTimers[p.key]),delete this._cacheTimers[p.key],this._setTileReloadTimer(p.key,y)));var I=!!y;return I||(y=new T.Tile(p,this._source.tileSize*p.overscaleFactor()),this._loadTile(y,this._tileLoaded.bind(this,y,p.key,y.state))),y?(y.uses++,this._tiles[p.key]=y,I||this._source.fire(new T.Event("dataloading",{tile:y,coord:y.tileID,dataType:"source"})),y):null},d.prototype._setTileReloadTimer=function(p,y){var I=this;p in this._timers&&(clearTimeout(this._timers[p]),delete this._timers[p]);var P=y.getExpiryTimeout();P&&(this._timers[p]=setTimeout(function(){I._reloadTile(p,"expired"),delete I._timers[p]},P))},d.prototype._removeTile=function(p){var y=this._tiles[p];y&&(y.uses--,delete this._tiles[p],this._timers[p]&&(clearTimeout(this._timers[p]),delete this._timers[p]),y.uses>0||(y.hasData()&&y.state!=="reloading"?this._cache.add(y.tileID,y,y.getExpiryTimeout()):(y.aborted=!0,this._abortTile(y),this._unloadTile(y))))},d.prototype.clearTiles=function(){for(var p in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(p);this._cache.reset()},d.prototype.tilesIn=function(p,y,I){var P=this,D=[],O=this.transform;if(!O)return D;for(var G=I?O.getCameraQueryGeometry(p):p,Q=p.map(function(gt){return O.pointCoordinate(gt)}),oe=G.map(function(gt){return O.pointCoordinate(gt)}),_e=this.getIds(),Se=1/0,Te=1/0,ge=-1/0,be=-1/0,We=0,Ne=oe;We<Ne.length;We+=1){var et=Ne[We];Se=Math.min(Se,et.x),Te=Math.min(Te,et.y),ge=Math.max(ge,et.x),be=Math.max(be,et.y)}for(var Je=function(gt){var Ct=P._tiles[_e[gt]];if(!Ct.holdingForFade()){var Vt=Ct.tileID,fi=Math.pow(2,O.zoom-Ct.tileID.overscaledZ),ei=y*Ct.queryPadding*T.EXTENT/Ct.tileSize/fi,ni=[Vt.getTilePoint(new T.MercatorCoordinate(Se,Te)),Vt.getTilePoint(new T.MercatorCoordinate(ge,be))];if(ni[0].x-ei<T.EXTENT&&ni[0].y-ei<T.EXTENT&&ni[1].x+ei>=0&&ni[1].y+ei>=0){var Nt=Q.map(function(Ii){return Vt.getTilePoint(Ii)}),Hi=oe.map(function(Ii){return Vt.getTilePoint(Ii)});D.push({tile:Ct,tileID:Vt,queryGeometry:Nt,cameraQueryGeometry:Hi,scale:fi})}}},ot=0;ot<_e.length;ot++)Je(ot);return D},d.prototype.getVisibleCoordinates=function(p){for(var y=this,I=this.getRenderableIds(p).map(function(G){return y._tiles[G].tileID}),P=0,D=I;P<D.length;P+=1){var O=D[P];O.posMatrix=this.transform.calculatePosMatrix(O.toUnwrapped())}return I},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(X(this._source.type))for(var p in this._tiles){var y=this._tiles[p];if(y.fadeEndTime!==void 0&&y.fadeEndTime>=T.browser.now())return!0}return!1},d.prototype.setFeatureState=function(p,y,I){p=p||"_geojsonTileLayer",this._state.updateState(p,y,I)},d.prototype.removeFeatureState=function(p,y,I){p=p||"_geojsonTileLayer",this._state.removeFeatureState(p,y,I)},d.prototype.getFeatureState=function(p,y){return p=p||"_geojsonTileLayer",this._state.getState(p,y)},d.prototype.setDependencies=function(p,y,I){var P=this._tiles[p];P&&P.setDependencies(y,I)},d.prototype.reloadTilesForDependencies=function(p,y){for(var I in this._tiles)this._tiles[I].hasDependency(p,y)&&this._reloadTile(I,"reloading");this._cache.filter(function(P){return!P.hasDependency(p,y)})},d}(T.Evented);function V(h,d){var p=Math.abs(2*h.wrap)-+(h.wrap<0),y=Math.abs(2*d.wrap)-+(d.wrap<0);return h.overscaledZ-d.overscaledZ||y-p||d.canonical.y-h.canonical.y||d.canonical.x-h.canonical.x}function X(h){return h==="raster"||h==="image"||h==="video"}function ee(){return new T.window.Worker(kl.workerUrl)}li.maxOverzooming=10,li.maxUnderzooming=3;var pe=function(){this.active={}};pe.prototype.acquire=function(h){if(!this.workers)for(this.workers=[];this.workers.length<pe.workerCount;)this.workers.push(new ee);return this.active[h]=!0,this.workers.slice()},pe.prototype.release=function(h){delete this.active[h],Object.keys(this.active).length===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)};var xe,Be=Math.floor(T.browser.hardwareConcurrency/2);function Xe(h,d){var p={};for(var y in h)y!=="ref"&&(p[y]=h[y]);return T.refProperties.forEach(function(I){I in d&&(p[I]=d[I])}),p}function Re(h){h=h.slice();for(var d=Object.create(null),p=0;p<h.length;p++)d[h[p].id]=h[p];for(var y=0;y<h.length;y++)"ref"in h[y]&&(h[y]=Xe(h[y],d[h[y].ref]));return h}pe.workerCount=Math.max(Math.min(Be,6),1);var Le={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ae(h,d,p){p.push({command:Le.addSource,args:[h,d[h]]})}function ft(h,d,p){d.push({command:Le.removeSource,args:[h]}),p[h]=!0}function _t(h,d,p,y){ft(h,p,y),Ae(h,d,p)}function rt(h,d,p){var y;for(y in h[p])if(h[p].hasOwnProperty(y)&&y!=="data"&&!T.deepEqual(h[p][y],d[p][y]))return!1;for(y in d[p])if(d[p].hasOwnProperty(y)&&y!=="data"&&!T.deepEqual(h[p][y],d[p][y]))return!1;return!0}function Wt(h,d,p,y,I,P){var D;for(D in d=d||{},h=h||{})h.hasOwnProperty(D)&&(T.deepEqual(h[D],d[D])||p.push({command:P,args:[y,D,d[D],I]}));for(D in d)d.hasOwnProperty(D)&&!h.hasOwnProperty(D)&&(T.deepEqual(h[D],d[D])||p.push({command:P,args:[y,D,d[D],I]}))}function Zt(h){return h.id}function yi(h,d){return h[d.id]=d,h}function _i(h,d){if(!h)return[{command:Le.setStyle,args:[d]}];var p=[];try{if(!T.deepEqual(h.version,d.version))return[{command:Le.setStyle,args:[d]}];T.deepEqual(h.center,d.center)||p.push({command:Le.setCenter,args:[d.center]}),T.deepEqual(h.zoom,d.zoom)||p.push({command:Le.setZoom,args:[d.zoom]}),T.deepEqual(h.bearing,d.bearing)||p.push({command:Le.setBearing,args:[d.bearing]}),T.deepEqual(h.pitch,d.pitch)||p.push({command:Le.setPitch,args:[d.pitch]}),T.deepEqual(h.sprite,d.sprite)||p.push({command:Le.setSprite,args:[d.sprite]}),T.deepEqual(h.glyphs,d.glyphs)||p.push({command:Le.setGlyphs,args:[d.glyphs]}),T.deepEqual(h.transition,d.transition)||p.push({command:Le.setTransition,args:[d.transition]}),T.deepEqual(h.light,d.light)||p.push({command:Le.setLight,args:[d.light]});var y={},I=[];(function(D,O,G,Q){var oe;for(oe in O=O||{},D=D||{})D.hasOwnProperty(oe)&&(O.hasOwnProperty(oe)||ft(oe,G,Q));for(oe in O)O.hasOwnProperty(oe)&&(D.hasOwnProperty(oe)?T.deepEqual(D[oe],O[oe])||(D[oe].type==="geojson"&&O[oe].type==="geojson"&&rt(D,O,oe)?G.push({command:Le.setGeoJSONSourceData,args:[oe,O[oe].data]}):_t(oe,O,G,Q)):Ae(oe,O,G))})(h.sources,d.sources,I,y);var P=[];h.layers&&h.layers.forEach(function(D){y[D.source]?p.push({command:Le.removeLayer,args:[D.id]}):P.push(D)}),p=p.concat(I),function(D,O,G){O=O||[];var Q,oe,_e,Se,Te,ge,be,We=(D=D||[]).map(Zt),Ne=O.map(Zt),et=D.reduce(yi,{}),Je=O.reduce(yi,{}),ot=We.slice(),gt=Object.create(null);for(Q=0,oe=0;Q<We.length;Q++)_e=We[Q],Je.hasOwnProperty(_e)?oe++:(G.push({command:Le.removeLayer,args:[_e]}),ot.splice(ot.indexOf(_e,oe),1));for(Q=0,oe=0;Q<Ne.length;Q++)_e=Ne[Ne.length-1-Q],ot[ot.length-1-Q]!==_e&&(et.hasOwnProperty(_e)?(G.push({command:Le.removeLayer,args:[_e]}),ot.splice(ot.lastIndexOf(_e,ot.length-oe),1)):oe++,ge=ot[ot.length-Q],G.push({command:Le.addLayer,args:[Je[_e],ge]}),ot.splice(ot.length-Q,0,_e),gt[_e]=!0);for(Q=0;Q<Ne.length;Q++)if(Se=et[_e=Ne[Q]],Te=Je[_e],!gt[_e]&&!T.deepEqual(Se,Te))if(T.deepEqual(Se.source,Te.source)&&T.deepEqual(Se["source-layer"],Te["source-layer"])&&T.deepEqual(Se.type,Te.type)){for(be in Wt(Se.layout,Te.layout,G,_e,null,Le.setLayoutProperty),Wt(Se.paint,Te.paint,G,_e,null,Le.setPaintProperty),T.deepEqual(Se.filter,Te.filter)||G.push({command:Le.setFilter,args:[_e,Te.filter]}),T.deepEqual(Se.minzoom,Te.minzoom)&&T.deepEqual(Se.maxzoom,Te.maxzoom)||G.push({command:Le.setLayerZoomRange,args:[_e,Te.minzoom,Te.maxzoom]}),Se)Se.hasOwnProperty(be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Wt(Se[be],Te[be],G,_e,be.slice(6),Le.setPaintProperty):T.deepEqual(Se[be],Te[be])||G.push({command:Le.setLayerProperty,args:[_e,be,Te[be]]}));for(be in Te)Te.hasOwnProperty(be)&&!Se.hasOwnProperty(be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Wt(Se[be],Te[be],G,_e,be.slice(6),Le.setPaintProperty):T.deepEqual(Se[be],Te[be])||G.push({command:Le.setLayerProperty,args:[_e,be,Te[be]]}))}else G.push({command:Le.removeLayer,args:[_e]}),ge=ot[ot.lastIndexOf(_e)+1],G.push({command:Le.addLayer,args:[Te,ge]})}(P,d.layers,p)}catch(D){console.warn("Unable to compute style diff:",D),p=[{command:Le.setStyle,args:[d]}]}return p}var ri=function(h,d,p){var y=this.boxCells=[],I=this.circleCells=[];this.xCellCount=Math.ceil(h/p),this.yCellCount=Math.ceil(d/p);for(var P=0;P<this.xCellCount*this.yCellCount;P++)y.push([]),I.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=d,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function Ti(h,d,p,y,I){var P=T.create();return d?(T.scale(P,P,[1/I,1/I,1]),p||T.rotateZ(P,P,y.angle)):T.multiply(P,y.labelPlaneMatrix,h),P}function zi(h,d,p,y,I){if(d){var P=T.clone(h);return T.scale(P,P,[I,I,1]),p||T.rotateZ(P,P,-y.angle),P}return y.glCoordMatrix}function Ji(h,d){var p=[h.x,h.y,0,1];Kr(p,p,d);var y=p[3];return{point:new T.Point(p[0]/y,p[1]/y),signedDistanceFromCamera:y}}function ir(h,d){var p=h[0]/h[3],y=h[1]/h[3];return p>=-d[0]&&p<=d[0]&&y>=-d[1]&&y<=d[1]}function zr(h,d,p,y,I,P,D,O){var G=y?h.textSizeData:h.iconSizeData,Q=T.evaluateSizeForZoom(G,p.transform.zoom),oe=[256/p.width*2+1,256/p.height*2+1],_e=y?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;_e.clear();for(var Se=h.lineVertexArray,Te=y?h.text.placedSymbolArray:h.icon.placedSymbolArray,ge=p.transform.width/p.transform.height,be=!1,We=0;We<Te.length;We++){var Ne=Te.get(We);if(Ne.hidden||Ne.writingMode===T.WritingMode.vertical&&!be)dr(Ne.numGlyphs,_e);else{be=!1;var et=[Ne.anchorX,Ne.anchorY,0,1];if(T.transformMat4(et,et,d),ir(et,oe)){var Je=.5+et[3]/p.transform.cameraToCenterDistance*.5,ot=T.evaluateSizeForFeature(G,Q,Ne),gt=D?ot*Je:ot/Je,Ct=new T.Point(Ne.anchorX,Ne.anchorY),Vt=Ji(Ct,I);if(Vt.signedDistanceFromCamera<=0)dr(Ne.numGlyphs,_e);else{var fi=Vt.point,ei={},ni=dn(Ne,gt,!1,O,d,I,P,h.glyphOffsetArray,Se,_e,fi,Ct,ei,ge);be=ni.useVertical,(ni.notEnoughRoom||be||ni.needsFlipping&&dn(Ne,gt,!0,O,d,I,P,h.glyphOffsetArray,Se,_e,fi,Ct,ei,ge).notEnoughRoom)&&dr(Ne.numGlyphs,_e)}}else dr(Ne.numGlyphs,_e)}}y?h.text.dynamicLayoutVertexBuffer.updateData(_e):h.icon.dynamicLayoutVertexBuffer.updateData(_e)}function Ei(h,d,p,y,I,P,D,O,G,Q,oe,_e){var Se=O.glyphStartIndex+O.numGlyphs,Te=O.lineStartIndex,ge=O.lineStartIndex+O.lineLength,be=d.getoffsetX(O.glyphStartIndex),We=d.getoffsetX(Se-1),Ne=_r(h*be,p,y,I,P,D,O.segment,Te,ge,G,Q,oe,_e);if(!Ne)return null;var et=_r(h*We,p,y,I,P,D,O.segment,Te,ge,G,Q,oe,_e);return et?{first:Ne,last:et}:null}function lt(h,d,p,y){return h===T.WritingMode.horizontal&&Math.abs(p.y-d.y)>Math.abs(p.x-d.x)*y?{useVertical:!0}:(h===T.WritingMode.vertical?d.y<p.y:d.x>p.x)?{needsFlipping:!0}:null}function dn(h,d,p,y,I,P,D,O,G,Q,oe,_e,Se,Te){var ge,be=d/24,We=h.lineOffsetX*be,Ne=h.lineOffsetY*be;if(h.numGlyphs>1){var et=h.glyphStartIndex+h.numGlyphs,Je=h.lineStartIndex,ot=h.lineStartIndex+h.lineLength,gt=Ei(be,O,We,Ne,p,oe,_e,h,G,P,Se,!1);if(!gt)return{notEnoughRoom:!0};var Ct=Ji(gt.first.point,D).point,Vt=Ji(gt.last.point,D).point;if(y&&!p){var fi=lt(h.writingMode,Ct,Vt,Te);if(fi)return fi}ge=[gt.first];for(var ei=h.glyphStartIndex+1;ei<et-1;ei++)ge.push(_r(be*O.getoffsetX(ei),We,Ne,p,oe,_e,h.segment,Je,ot,G,P,Se,!1));ge.push(gt.last)}else{if(y&&!p){var ni=Ji(_e,I).point,Nt=h.lineStartIndex+h.segment+1,Hi=new T.Point(G.getx(Nt),G.gety(Nt)),Ii=Ji(Hi,I),Vi=Ii.signedDistanceFromCamera>0?Ii.point:Qi(_e,Hi,ni,1,I),Ni=lt(h.writingMode,ni,Vi,Te);if(Ni)return Ni}var Pi=_r(be*O.getoffsetX(h.glyphStartIndex),We,Ne,p,oe,_e,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,G,P,Se,!1);if(!Pi)return{notEnoughRoom:!0};ge=[Pi]}for(var ji=0,Dr=ge;ji<Dr.length;ji+=1){var Ri=Dr[ji];T.addDynamicAttributes(Q,Ri.point,Ri.angle)}return{}}function Qi(h,d,p,y,I){var P=Ji(h.add(h.sub(d)._unit()),I).point,D=p.sub(P);return p.add(D._mult(y/D.mag()))}function _r(h,d,p,y,I,P,D,O,G,Q,oe,_e,Se){var Te=y?h-d:h+d,ge=Te>0?1:-1,be=0;y&&(ge*=-1,be=Math.PI),ge<0&&(be+=Math.PI);for(var We=ge>0?O+D:O+D+1,Ne=We,et=I,Je=I,ot=0,gt=0,Ct=Math.abs(Te);ot+gt<=Ct;){if((We+=ge)<O||We>=G)return null;if(Je=et,(et=_e[We])===void 0){var Vt=new T.Point(Q.getx(We),Q.gety(We)),fi=Ji(Vt,oe);if(fi.signedDistanceFromCamera>0)et=_e[We]=fi.point;else{var ei=We-ge;et=Qi(ot===0?P:new T.Point(Q.getx(ei),Q.gety(ei)),Vt,Je,Ct-ot+1,oe)}}ot+=gt,gt=Je.dist(et)}var ni=(Ct-ot)/gt,Nt=et.sub(Je),Hi=Nt.mult(ni)._add(Je);return Hi._add(Nt._unit()._perp()._mult(p*ge)),{point:Hi,angle:be+Math.atan2(et.y-Je.y,et.x-Je.x),tileDistance:Se?{prevTileDistance:We-ge===Ne?0:Q.gettileUnitDistanceFromAnchor(We-ge),lastSegmentViewportDistance:Ct-ot}:null}}ri.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ri.prototype.insert=function(h,d,p,y,I){this._forEachCell(d,p,y,I,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(I)},ri.prototype.insertCircle=function(h,d,p,y){this._forEachCell(d-y,p-y,d+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(d),this.circles.push(p),this.circles.push(y)},ri.prototype._insertBoxCell=function(h,d,p,y,I,P){this.boxCells[I].push(P)},ri.prototype._insertCircleCell=function(h,d,p,y,I,P){this.circleCells[I].push(P)},ri.prototype._query=function(h,d,p,y,I,P){if(p<0||h>this.width||y<0||d>this.height)return!I&&[];var D=[];if(h<=0&&d<=0&&this.width<=p&&this.height<=y){if(I)return!0;for(var O=0;O<this.boxKeys.length;O++)D.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(var G=0;G<this.circleKeys.length;G++){var Q=this.circles[3*G],oe=this.circles[3*G+1],_e=this.circles[3*G+2];D.push({key:this.circleKeys[G],x1:Q-_e,y1:oe-_e,x2:Q+_e,y2:oe+_e})}return P?D.filter(P):D}var Se={hitTest:I,seenUids:{box:{},circle:{}}};return this._forEachCell(h,d,p,y,this._queryCell,D,Se,P),I?D.length>0:D},ri.prototype._queryCircle=function(h,d,p,y,I){var P=h-p,D=h+p,O=d-p,G=d+p;if(D<0||P>this.width||G<0||O>this.height)return!y&&[];var Q=[],oe={hitTest:y,circle:{x:h,y:d,radius:p},seenUids:{box:{},circle:{}}};return this._forEachCell(P,O,D,G,this._queryCellCircle,Q,oe,I),y?Q.length>0:Q},ri.prototype.query=function(h,d,p,y,I){return this._query(h,d,p,y,!1,I)},ri.prototype.hitTest=function(h,d,p,y,I){return this._query(h,d,p,y,!0,I)},ri.prototype.hitTestCircle=function(h,d,p,y){return this._queryCircle(h,d,p,!0,y)},ri.prototype._queryCell=function(h,d,p,y,I,P,D,O){var G=D.seenUids,Q=this.boxCells[I];if(Q!==null)for(var oe=this.bboxes,_e=0,Se=Q;_e<Se.length;_e+=1){var Te=Se[_e];if(!G.box[Te]){G.box[Te]=!0;var ge=4*Te;if(h<=oe[ge+2]&&d<=oe[ge+3]&&p>=oe[ge+0]&&y>=oe[ge+1]&&(!O||O(this.boxKeys[Te]))){if(D.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[Te],x1:oe[ge],y1:oe[ge+1],x2:oe[ge+2],y2:oe[ge+3]})}}}var be=this.circleCells[I];if(be!==null)for(var We=this.circles,Ne=0,et=be;Ne<et.length;Ne+=1){var Je=et[Ne];if(!G.circle[Je]){G.circle[Je]=!0;var ot=3*Je;if(this._circleAndRectCollide(We[ot],We[ot+1],We[ot+2],h,d,p,y)&&(!O||O(this.circleKeys[Je]))){if(D.hitTest)return P.push(!0),!0;var gt=We[ot],Ct=We[ot+1],Vt=We[ot+2];P.push({key:this.circleKeys[Je],x1:gt-Vt,y1:Ct-Vt,x2:gt+Vt,y2:Ct+Vt})}}}},ri.prototype._queryCellCircle=function(h,d,p,y,I,P,D,O){var G=D.circle,Q=D.seenUids,oe=this.boxCells[I];if(oe!==null)for(var _e=this.bboxes,Se=0,Te=oe;Se<Te.length;Se+=1){var ge=Te[Se];if(!Q.box[ge]){Q.box[ge]=!0;var be=4*ge;if(this._circleAndRectCollide(G.x,G.y,G.radius,_e[be+0],_e[be+1],_e[be+2],_e[be+3])&&(!O||O(this.boxKeys[ge])))return P.push(!0),!0}}var We=this.circleCells[I];if(We!==null)for(var Ne=this.circles,et=0,Je=We;et<Je.length;et+=1){var ot=Je[et];if(!Q.circle[ot]){Q.circle[ot]=!0;var gt=3*ot;if(this._circlesCollide(Ne[gt],Ne[gt+1],Ne[gt+2],G.x,G.y,G.radius)&&(!O||O(this.circleKeys[ot])))return P.push(!0),!0}}},ri.prototype._forEachCell=function(h,d,p,y,I,P,D,O){for(var G=this._convertToXCellCoord(h),Q=this._convertToYCellCoord(d),oe=this._convertToXCellCoord(p),_e=this._convertToYCellCoord(y),Se=G;Se<=oe;Se++)for(var Te=Q;Te<=_e;Te++){var ge=this.xCellCount*Te+Se;if(I.call(this,h,d,p,y,ge,P,D,O))return}},ri.prototype._convertToXCellCoord=function(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))},ri.prototype._convertToYCellCoord=function(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))},ri.prototype._circlesCollide=function(h,d,p,y,I,P){var D=y-h,O=I-d,G=p+P;return G*G>D*D+O*O},ri.prototype._circleAndRectCollide=function(h,d,p,y,I,P,D){var O=(P-y)/2,G=Math.abs(h-(y+O));if(G>O+p)return!1;var Q=(D-I)/2,oe=Math.abs(d-(I+Q));if(oe>Q+p)return!1;if(G<=O||oe<=Q)return!0;var _e=G-O,Se=oe-Q;return _e*_e+Se*Se<=p*p};var ba=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function dr(h,d){for(var p=0;p<h;p++){var y=d.length;d.resize(y+4),d.float32.set(ba,3*y)}}function Kr(h,d,p){var y=d[0],I=d[1];return h[0]=p[0]*y+p[4]*I+p[12],h[1]=p[1]*y+p[5]*I+p[13],h[3]=p[3]*y+p[7]*I+p[15],h}var Or=function(h,d,p){d===void 0&&(d=new ri(h.width+200,h.height+200,25)),p===void 0&&(p=new ri(h.width+200,h.height+200,25)),this.transform=h,this.grid=d,this.ignoredGrid=p,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+100,this.screenBottomBoundary=h.height+100,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200};function Un(h,d,p){h[d+4]=p?1:0}function Rt(h,d,p){return d*(T.EXTENT/(h.tileSize*Math.pow(2,p-h.tileID.overscaledZ)))}Or.prototype.placeCollisionBox=function(h,d,p,y,I){var P=this.projectAndGetPerspectiveRatio(y,h.anchorPointX,h.anchorPointY),D=p*P.perspectiveRatio,O=h.x1*D+P.point.x,G=h.y1*D+P.point.y,Q=h.x2*D+P.point.x,oe=h.y2*D+P.point.y;return!this.isInsideGrid(O,G,Q,oe)||!d&&this.grid.hitTest(O,G,Q,oe,I)?{box:[],offscreen:!1}:{box:[O,G,Q,oe],offscreen:this.isOffscreen(O,G,Q,oe)}},Or.prototype.approximateTileDistance=function(h,d,p,y,I){var P=I?1:y/this.pitchfactor,D=h.lastSegmentViewportDistance*p;return h.prevTileDistance+D+(P-1)*D*Math.abs(Math.sin(d))},Or.prototype.placeCollisionCircles=function(h,d,p,y,I,P,D,O,G,Q,oe,_e,Se){var Te=[],ge=this.projectAnchor(G,I.anchorX,I.anchorY),be=O/24,We=I.lineOffsetX*O,Ne=I.lineOffsetY*O,et=new T.Point(I.anchorX,I.anchorY),Je=Ei(be,D,We,Ne,!1,Ji(et,Q).point,et,I,P,Q,{},!0),ot=!1,gt=!1,Ct=!0,Vt=ge.perspectiveRatio*y,fi=1/(y*p),ei=0,ni=0;Je&&(ei=this.approximateTileDistance(Je.first.tileDistance,Je.first.angle,fi,ge.cameraDistance,_e),ni=this.approximateTileDistance(Je.last.tileDistance,Je.last.angle,fi,ge.cameraDistance,_e));for(var Nt=0;Nt<h.length;Nt+=5){var Hi=h[Nt],Ii=h[Nt+1],Vi=h[Nt+2],Ni=h[Nt+3];if(!Je||Ni<-ei||Ni>ni)Un(h,Nt,!1);else{var Pi=this.projectPoint(G,Hi,Ii),ji=Vi*Vt;if(Te.length>0){var Dr=Pi.x-Te[Te.length-4],Ri=Pi.y-Te[Te.length-3];if(ji*ji*2>Dr*Dr+Ri*Ri&&Nt+8<h.length){var gr=h[Nt+8];if(gr>-ei&&gr<ni){Un(h,Nt,!1);continue}}}var fr=Nt/5;Te.push(Pi.x,Pi.y,ji,fr),Un(h,Nt,!0);var xr=Pi.x-ji,Ft=Pi.y-ji,Vn=Pi.x+ji,Cn=Pi.y+ji;if(Ct=Ct&&this.isOffscreen(xr,Ft,Vn,Cn),gt=gt||this.isInsideGrid(xr,Ft,Vn,Cn),!d&&this.grid.hitTestCircle(Pi.x,Pi.y,ji,Se)){if(!oe)return{circles:[],offscreen:!1};ot=!0}}}return{circles:ot||!gt?[]:Te,offscreen:Ct}},Or.prototype.queryRenderedSymbols=function(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],p=1/0,y=1/0,I=-1/0,P=-1/0,D=0,O=h;D<O.length;D+=1){var G=O[D],Q=new T.Point(G.x+100,G.y+100);p=Math.min(p,Q.x),y=Math.min(y,Q.y),I=Math.max(I,Q.x),P=Math.max(P,Q.y),d.push(Q)}for(var oe={},_e={},Se=0,Te=this.grid.query(p,y,I,P).concat(this.ignoredGrid.query(p,y,I,P));Se<Te.length;Se+=1){var ge=Te[Se],be=ge.key;if(oe[be.bucketInstanceId]===void 0&&(oe[be.bucketInstanceId]={}),!oe[be.bucketInstanceId][be.featureIndex]){var We=[new T.Point(ge.x1,ge.y1),new T.Point(ge.x2,ge.y1),new T.Point(ge.x2,ge.y2),new T.Point(ge.x1,ge.y2)];T.polygonIntersectsPolygon(d,We)&&(oe[be.bucketInstanceId][be.featureIndex]=!0,_e[be.bucketInstanceId]===void 0&&(_e[be.bucketInstanceId]=[]),_e[be.bucketInstanceId].push(be.featureIndex))}}return _e},Or.prototype.insertCollisionBox=function(h,d,p,y,I){var P={bucketInstanceId:p,featureIndex:y,collisionGroupID:I};(d?this.ignoredGrid:this.grid).insert(P,h[0],h[1],h[2],h[3])},Or.prototype.insertCollisionCircles=function(h,d,p,y,I){for(var P=d?this.ignoredGrid:this.grid,D={bucketInstanceId:p,featureIndex:y,collisionGroupID:I},O=0;O<h.length;O+=4)P.insertCircle(D,h[O],h[O+1],h[O+2])},Or.prototype.projectAnchor=function(h,d,p){var y=[d,p,0,1];return Kr(y,y,h),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5,cameraDistance:y[3]}},Or.prototype.projectPoint=function(h,d,p){var y=[d,p,0,1];return Kr(y,y,h),new T.Point((y[0]/y[3]+1)/2*this.transform.width+100,(-y[1]/y[3]+1)/2*this.transform.height+100)},Or.prototype.projectAndGetPerspectiveRatio=function(h,d,p){var y=[d,p,0,1];return Kr(y,y,h),{point:new T.Point((y[0]/y[3]+1)/2*this.transform.width+100,(-y[1]/y[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}},Or.prototype.isOffscreen=function(h,d,p,y){return p<100||h>=this.screenRightBoundary||y<100||d>this.screenBottomBoundary},Or.prototype.isInsideGrid=function(h,d,p,y){return p>=0&&h<this.gridRightBoundary&&y>=0&&d<this.gridBottomBoundary};var Bi=function(h,d,p,y){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?d:-d))):y&&p?1:0,this.placed=p};Bi.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var qi=function(h,d,p,y,I){this.text=new Bi(h?h.text:null,d,p,I),this.icon=new Bi(h?h.icon:null,d,y,I)};qi.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var io=function(h,d,p){this.text=h,this.icon=d,this.skipFade=p},_s=function(h,d,p,y,I){this.bucketInstanceId=h,this.featureIndex=d,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=I},Xi=function(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}};function wa(h,d,p,y,I){var P=T.getAnchorAlignment(h),D=-(P.horizontalAlign-.5)*d,O=-(P.verticalAlign-.5)*p,G=T.evaluateVariableOffset(h,y);return new T.Point(D+G[0]*I,O+G[1]*I)}function Ga(h,d,p,y,I,P){var D=h.x1,O=h.x2,G=h.y1,Q=h.y2,oe=h.anchorPointX,_e=h.anchorPointY,Se=new T.Point(d,p);return y&&Se._rotate(I?P:-P),{x1:D+Se.x,y1:G+Se.y,x2:O+Se.x,y2:Q+Se.y,anchorPointX:oe,anchorPointY:_e}}Xi.prototype.get=function(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){var d=++this.maxGroupID;this.collisionGroups[h]={ID:d,predicate:function(p){return p.collisionGroupID===d}}}return this.collisionGroups[h]};var Mr=function(h,d,p,y){this.transform=h.clone(),this.collisionIndex=new Or(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Xi(p),this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}};function Zn(h,d,p,y,I){h.emplaceBack(d?1:0,p?1:0,y||0,I||0),h.emplaceBack(d?1:0,p?1:0,y||0,I||0),h.emplaceBack(d?1:0,p?1:0,y||0,I||0),h.emplaceBack(d?1:0,p?1:0,y||0,I||0)}Mr.prototype.getBucketParts=function(h,d,p,y){var I=p.getBucket(d),P=p.latestFeatureIndex;if(I&&P&&d.id===I.layerIds[0]){var D=p.collisionBoxArray,O=I.layers[0].layout,G=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),Q=p.tileSize/T.EXTENT,oe=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),_e=Ti(oe,O.get("text-pitch-alignment")==="map",O.get("text-rotation-alignment")==="map",this.transform,Rt(p,1,this.transform.zoom));this.retainedQueryData[I.bucketInstanceId]=new _s(I.bucketInstanceId,P,I.sourceLayerIndex,I.index,p.tileID);var Se={bucket:I,layout:O,posMatrix:oe,textLabelPlaneMatrix:_e,scale:G,textPixelRatio:Q,holdingForFade:p.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:T.evaluateSizeForZoom(I.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(I.sourceID)};if(y)for(var Te=0,ge=I.sortKeyRanges;Te<ge.length;Te+=1){var be=ge[Te],We=be.sortKey,Ne=be.symbolInstanceStart,et=be.symbolInstanceEnd;h.push({sortKey:We,symbolInstanceStart:Ne,symbolInstanceEnd:et,parameters:Se})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:Se})}},Mr.prototype.attemptAnchorPlacement=function(h,d,p,y,I,P,D,O,G,Q,oe,_e,Se,Te,ge){var be,We=[_e.textOffset0,_e.textOffset1],Ne=wa(h,p,y,We,I),et=this.collisionIndex.placeCollisionBox(Ga(d,Ne.x,Ne.y,P,D,this.transform.angle),oe,O,G,Q.predicate);if(!(ge&&this.collisionIndex.placeCollisionBox(Ga(ge,Ne.x,Ne.y,P,D,this.transform.angle),oe,O,G,Q.predicate).box.length===0)&&et.box.length>0)return this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(be=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),this.variableOffsets[_e.crossTileID]={textOffset:We,width:p,height:y,anchor:h,textBoxScale:I,prevAnchor:be},this.markUsedJustification(Se,h,_e,Te),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,Te,_e),this.placedOrientations[_e.crossTileID]=Te),{shift:Ne,placedGlyphBoxes:et}},Mr.prototype.placeLayerBucketPart=function(h,d,p){var y=this,I=h.parameters,P=I.bucket,D=I.layout,O=I.posMatrix,G=I.textLabelPlaneMatrix,Q=I.scale,oe=I.textPixelRatio,_e=I.holdingForFade,Se=I.collisionBoxArray,Te=I.partiallyEvaluatedTextSize,ge=I.collisionGroup,be=D.get("text-optional"),We=D.get("icon-optional"),Ne=D.get("text-allow-overlap"),et=D.get("icon-allow-overlap"),Je=D.get("text-rotation-alignment")==="map",ot=D.get("text-pitch-alignment")==="map",gt=D.get("icon-text-fit")!=="none",Ct=D.get("symbol-z-order")==="viewport-y",Vt=Ne&&(et||!P.hasIconData()||We),fi=et&&(Ne||!P.hasTextData()||be);!P.collisionArrays&&Se&&P.deserializeCollisionBoxes(Se);var ei=function(Vi,Ni){if(!d[Vi.crossTileID])if(_e)y.placements[Vi.crossTileID]=new io(!1,!1,!1);else{var Pi,ji=!1,Dr=!1,Ri=!0,gr=null,fr={box:null,offscreen:null},xr={box:null,offscreen:null},Ft=null,Vn=null,Cn=0,Fo=0,Lr=0;Ni.textFeatureIndex&&(Cn=Ni.textFeatureIndex),Ni.verticalTextFeatureIndex&&(Fo=Ni.verticalTextFeatureIndex);var $t=Ni.textBox;if($t){var qs=function(l){var g=T.WritingMode.horizontal;if(P.allowVerticalPlacement&&!l&&y.prevPlacement){var x=y.prevPlacement.placedOrientations[Vi.crossTileID];x&&(y.placedOrientations[Vi.crossTileID]=x,g=x,y.markUsedOrientation(P,g,Vi))}return g},tc=function(l,g){if(P.allowVerticalPlacement&&Vi.numVerticalGlyphVertices>0&&Ni.verticalTextBox)for(var x=0,E=P.writingModes;x<E.length&&(E[x]===T.WritingMode.vertical?(fr=g(),xr=fr):fr=l(),!(fr&&fr.box&&fr.box.length));x+=1);else fr=l()};if(D.get("text-variable-anchor")){var ha=D.get("text-variable-anchor");if(y.prevPlacement&&y.prevPlacement.variableOffsets[Vi.crossTileID]){var ul=y.prevPlacement.variableOffsets[Vi.crossTileID];ha.indexOf(ul.anchor)>0&&(ha=ha.filter(function(l){return l!==ul.anchor})).unshift(ul.anchor)}var ic=function(l,g,x){for(var E=l.x2-l.x1,z=l.y2-l.y1,k=Vi.textBoxScale,B=gt&&!et?g:null,q={box:[],offscreen:!1},N=Ne?2*ha.length:ha.length,H=0;H<N;++H){var ne=ha[H%ha.length],ce=H>=ha.length,fe=y.attemptAnchorPlacement(ne,l,E,z,k,Je,ot,oe,O,ge,ce,Vi,P,x,B);if(fe&&(q=fe.placedGlyphBoxes)&&q.box&&q.box.length){ji=!0,gr=fe.shift;break}}return q};tc(function(){return ic($t,Ni.iconBox,T.WritingMode.horizontal)},function(){var l=Ni.verticalTextBox,g=fr&&fr.box&&fr.box.length;return P.allowVerticalPlacement&&!g&&Vi.numVerticalGlyphVertices>0&&l?ic(l,Ni.verticalIconBox,T.WritingMode.vertical):{box:null,offscreen:null}}),fr&&(ji=fr.box,Ri=fr.offscreen);var rs=qs(fr&&fr.box);if(!ji&&y.prevPlacement){var Wc=y.prevPlacement.variableOffsets[Vi.crossTileID];Wc&&(y.variableOffsets[Vi.crossTileID]=Wc,y.markUsedJustification(P,Wc.anchor,Vi,rs))}}else{var Ic=function(l,g){var x=y.collisionIndex.placeCollisionBox(l,Ne,oe,O,ge.predicate);return x&&x.box&&x.box.length&&(y.markUsedOrientation(P,g,Vi),y.placedOrientations[Vi.crossTileID]=g),x};tc(function(){return Ic($t,T.WritingMode.horizontal)},function(){var l=Ni.verticalTextBox;return P.allowVerticalPlacement&&Vi.numVerticalGlyphVertices>0&&l?Ic(l,T.WritingMode.vertical):{box:null,offscreen:null}}),qs(fr&&fr.box&&fr.box.length)}}ji=(Pi=fr)&&Pi.box&&Pi.box.length>0,Ri=Pi&&Pi.offscreen;var ws=Ni.textCircles;if(ws){var Ba=P.text.placedSymbolArray.get(Vi.centerJustifiedTextSymbolIndex),Ac=T.evaluateSizeForFeature(P.textSizeData,Te,Ba);Ft=y.collisionIndex.placeCollisionCircles(ws,Ne,Q,oe,Ba,P.lineVertexArray,P.glyphOffsetArray,Ac,O,G,p,ot,ge.predicate),ji=Ne||Ft.circles.length>0,Ri=Ri&&Ft.offscreen}if(Ni.iconFeatureIndex&&(Lr=Ni.iconFeatureIndex),Ni.iconBox){var Fa=function(l){var g=gt&&gr?Ga(l,gr.x,gr.y,Je,ot,y.transform.angle):l;return y.collisionIndex.placeCollisionBox(g,et,oe,O,ge.predicate)};Dr=xr&&xr.box&&xr.box.length&&Ni.verticalIconBox?(Vn=Fa(Ni.verticalIconBox)).box.length>0:(Vn=Fa(Ni.iconBox)).box.length>0,Ri=Ri&&Vn.offscreen}var m=be||Vi.numHorizontalGlyphVertices===0&&Vi.numVerticalGlyphVertices===0,n=We||Vi.numIconVertices===0;m||n?n?m||(Dr=Dr&&ji):ji=Dr&&ji:Dr=ji=Dr&&ji,ji&&Pi&&Pi.box&&(xr&&xr.box&&Fo?y.collisionIndex.insertCollisionBox(Pi.box,D.get("text-ignore-placement"),P.bucketInstanceId,Fo,ge.ID):y.collisionIndex.insertCollisionBox(Pi.box,D.get("text-ignore-placement"),P.bucketInstanceId,Cn,ge.ID)),Dr&&Vn&&y.collisionIndex.insertCollisionBox(Vn.box,D.get("icon-ignore-placement"),P.bucketInstanceId,Lr,ge.ID),ji&&Ft&&y.collisionIndex.insertCollisionCircles(Ft.circles,D.get("text-ignore-placement"),P.bucketInstanceId,Cn,ge.ID),y.placements[Vi.crossTileID]=new io(ji||Vt,Dr||fi,Ri||P.justReloaded),d[Vi.crossTileID]=!0}};if(Ct)for(var ni=P.getSortedSymbolIndexes(this.transform.angle),Nt=ni.length-1;Nt>=0;--Nt){var Hi=ni[Nt];ei(P.symbolInstances.get(Hi),P.collisionArrays[Hi])}else for(var Ii=h.symbolInstanceStart;Ii<h.symbolInstanceEnd;Ii++)ei(P.symbolInstances.get(Ii),P.collisionArrays[Ii]);P.justReloaded=!1},Mr.prototype.markUsedJustification=function(h,d,p,y){var I,P={left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex};I=y===T.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:P[T.getAnchorJustification(d)];for(var D=0,O=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];D<O.length;D+=1){var G=O[D];G>=0&&(h.text.placedSymbolArray.get(G).crossTileID=I>=0&&G!==I?0:p.crossTileID)}},Mr.prototype.markUsedOrientation=function(h,d,p){for(var y=d===T.WritingMode.horizontal||d===T.WritingMode.horizontalOnly?d:0,I=d===T.WritingMode.vertical?d:0,P=0,D=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];P<D.length;P+=1){var O=D[P];h.text.placedSymbolArray.get(O).placedOrientation=y}p.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=I)},Mr.prototype.commit=function(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var y=d?d.symbolFadeChange(h):1,I=d?d.opacities:{},P=d?d.variableOffsets:{},D=d?d.placedOrientations:{};for(var O in this.placements){var G=this.placements[O],Q=I[O];Q?(this.opacities[O]=new qi(Q,y,G.text,G.icon),p=p||G.text!==Q.text.placed||G.icon!==Q.icon.placed):(this.opacities[O]=new qi(null,y,G.text,G.icon,G.skipFade),p=p||G.text||G.icon)}for(var oe in I){var _e=I[oe];if(!this.opacities[oe]){var Se=new qi(_e,y,!1,!1);Se.isHidden()||(this.opacities[oe]=Se,p=p||_e.text.placed||_e.icon.placed)}}for(var Te in P)this.variableOffsets[Te]||!this.opacities[Te]||this.opacities[Te].isHidden()||(this.variableOffsets[Te]=P[Te]);for(var ge in D)this.placedOrientations[ge]||!this.opacities[ge]||this.opacities[ge].isHidden()||(this.placedOrientations[ge]=D[ge]);p?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:h)},Mr.prototype.updateLayerOpacities=function(h,d){for(var p={},y=0,I=d;y<I.length;y+=1){var P=I[y],D=P.getBucket(h);D&&P.latestFeatureIndex&&h.id===D.layerIds[0]&&this.updateBucketOpacities(D,p,P.collisionBoxArray)}},Mr.prototype.updateBucketOpacities=function(h,d,p){var y=this;h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear(),h.hasIconCollisionCircleData()&&h.iconCollisionCircle.collisionVertexArray.clear(),h.hasTextCollisionCircleData()&&h.textCollisionCircle.collisionVertexArray.clear();var I=h.layers[0].layout,P=new qi(null,0,!1,!1,!0),D=I.get("text-allow-overlap"),O=I.get("icon-allow-overlap"),G=I.get("text-variable-anchor"),Q=I.get("text-rotation-alignment")==="map",oe=I.get("text-pitch-alignment")==="map",_e=I.get("icon-text-fit")!=="none",Se=new qi(null,0,D&&(O||!h.hasIconData()||I.get("icon-optional")),O&&(D||!h.hasTextData()||I.get("text-optional")),!0);!h.collisionArrays&&p&&(h.hasIconCollisionBoxData()||h.hasIconCollisionCircleData()||h.hasTextCollisionBoxData()||h.hasTextCollisionCircleData())&&h.deserializeCollisionBoxes(p);for(var Te=function(We,Ne,et){for(var Je=0;Je<Ne/4;Je++)We.opacityVertexArray.emplaceBack(et)},ge=function(We){var Ne=h.symbolInstances.get(We),et=Ne.numHorizontalGlyphVertices,Je=Ne.numVerticalGlyphVertices,ot=Ne.crossTileID,gt=d[ot],Ct=y.opacities[ot];gt?Ct=P:Ct||(Ct=Se,y.opacities[ot]=Ct),d[ot]=!0;var Vt=et>0||Je>0,fi=Ne.numIconVertices>0,ei=y.placedOrientations[Ne.crossTileID],ni=ei===T.WritingMode.vertical,Nt=ei===T.WritingMode.horizontal||ei===T.WritingMode.horizontalOnly;if(Vt){var Hi=Sn(Ct.text),Ii=ni?gs:Hi;Te(h.text,et,Ii);var Vi=Nt?gs:Hi;Te(h.text,Je,Vi);var Ni=Ct.text.isHidden();[Ne.rightJustifiedTextSymbolIndex,Ne.centerJustifiedTextSymbolIndex,Ne.leftJustifiedTextSymbolIndex].forEach(function(tc){tc>=0&&(h.text.placedSymbolArray.get(tc).hidden=Ni||ni?1:0)}),Ne.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(Ne.verticalPlacedTextSymbolIndex).hidden=Ni||Nt?1:0);var Pi=y.variableOffsets[Ne.crossTileID];Pi&&y.markUsedJustification(h,Pi.anchor,Ne,ei);var ji=y.placedOrientations[Ne.crossTileID];ji&&(y.markUsedJustification(h,"left",Ne,ji),y.markUsedOrientation(h,ji,Ne))}if(fi){var Dr=Sn(Ct.icon),Ri=!(_e&&Ne.verticalPlacedIconSymbolIndex&&ni);if(Ne.placedIconSymbolIndex>=0){var gr=Ri?Dr:gs;Te(h.icon,Ne.numIconVertices,gr),h.icon.placedSymbolArray.get(Ne.placedIconSymbolIndex).hidden=Ct.icon.isHidden()}if(Ne.verticalPlacedIconSymbolIndex>=0){var fr=Ri?gs:Dr;Te(h.icon,Ne.numVerticalIconVertices,fr),h.icon.placedSymbolArray.get(Ne.verticalPlacedIconSymbolIndex).hidden=Ct.icon.isHidden()}}if(h.hasIconCollisionBoxData()||h.hasIconCollisionCircleData()||h.hasTextCollisionBoxData()||h.hasTextCollisionCircleData()){var xr=h.collisionArrays[We];if(xr){var Ft=new T.Point(0,0);if(xr.textBox||xr.verticalTextBox){var Vn=!0;if(G){var Cn=y.variableOffsets[ot];Cn?(Ft=wa(Cn.anchor,Cn.width,Cn.height,Cn.textOffset,Cn.textBoxScale),Q&&Ft._rotate(oe?y.transform.angle:-y.transform.angle)):Vn=!1}xr.textBox&&Zn(h.textCollisionBox.collisionVertexArray,Ct.text.placed,!Vn||ni,Ft.x,Ft.y),xr.verticalTextBox&&Zn(h.textCollisionBox.collisionVertexArray,Ct.text.placed,!Vn||Nt,Ft.x,Ft.y)}var Fo=!!(!Nt&&xr.verticalIconBox);xr.iconBox&&Zn(h.iconCollisionBox.collisionVertexArray,Ct.icon.placed,Fo,_e?Ft.x:0,_e?Ft.y:0),xr.verticalIconBox&&Zn(h.iconCollisionBox.collisionVertexArray,Ct.icon.placed,!Fo,_e?Ft.x:0,_e?Ft.y:0);var Lr=xr.textCircles;if(Lr&&h.hasTextCollisionCircleData())for(var $t=0;$t<Lr.length;$t+=5){var qs=gt||Lr[$t+4]===0;Zn(h.textCollisionCircle.collisionVertexArray,Ct.text.placed,qs)}}}},be=0;be<h.symbolInstances.length;be++)ge(be);h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.hasIconCollisionCircleData()&&h.iconCollisionCircle.collisionVertexBuffer&&h.iconCollisionCircle.collisionVertexBuffer.updateData(h.iconCollisionCircle.collisionVertexArray),h.hasTextCollisionCircleData()&&h.textCollisionCircle.collisionVertexBuffer&&h.textCollisionCircle.collisionVertexBuffer.updateData(h.textCollisionCircle.collisionVertexArray)},Mr.prototype.symbolFadeChange=function(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Mr.prototype.zoomAdjustment=function(h){return Math.max(0,(this.transform.zoom-h)/1.5)},Mr.prototype.hasTransitions=function(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration},Mr.prototype.stillRecent=function(h,d){var p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>h},Mr.prototype.setStale=function(){this.stale=!0};var on=Math.pow(2,25),uc=Math.pow(2,24),Za=Math.pow(2,17),Xa=Math.pow(2,16),Wa=Math.pow(2,9),hc=Math.pow(2,8),el=Math.pow(2,1);function Sn(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;var d=h.placed?1:0,p=Math.floor(127*h.opacity);return p*on+d*uc+p*Za+d*Xa+p*Wa+d*hc+p*el+d}var gs=0,pc=function(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};pc.prototype.continuePlacement=function(h,d,p,y,I){for(var P=this._bucketParts;this._currentTileIndex<h.length;){var D=h[this._currentTileIndex];if(d.getBucketParts(P,y,D,this._sortAcrossTiles),this._currentTileIndex++,I())return!0}for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(function(G,Q){return G.sortKey-Q.sortKey}));this._currentPartIndex<P.length;){var O=P[this._currentPartIndex];if(d.placeLayerBucketPart(O,this._seenCrossTileIDs,p),this._currentPartIndex++,I())return!0}return!1};var Bs=function(h,d,p,y,I,P,D){this.placement=new Mr(h,I,P,D),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1};Bs.prototype.isDone=function(){return this._done},Bs.prototype.continuePlacement=function(h,d,p){for(var y=this,I=T.browser.now(),P=function(){var G=T.browser.now()-I;return!y._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var D=d[h[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=O)&&(!D.maxzoom||D.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new pc(D)),this._inProgressLayer.continuePlacement(p[D.source],this.placement,this._showCollisionBoxes,D,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Bs.prototype.commit=function(h){return this.placement.commit(h),this.placement};var oa=512/T.EXTENT/2,In=function(h,d,p){this.tileID=h,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(var y=0;y<d.length;y++){var I=d.get(y),P=I.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:I.crossTileID,coord:this.getScaledCoordinates(I,h)})}};In.prototype.getScaledCoordinates=function(h,d){var p=d.canonical.z-this.tileID.canonical.z,y=oa/Math.pow(2,p);return{x:Math.floor((d.canonical.x*T.EXTENT+h.anchorX)*y),y:Math.floor((d.canonical.y*T.EXTENT+h.anchorY)*y)}},In.prototype.findMatches=function(h,d,p){for(var y=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),I=0;I<h.length;I++){var P=h.get(I);if(!P.crossTileID){var D=this.indexedSymbolInstances[P.key];if(D)for(var O=this.getScaledCoordinates(P,d),G=0,Q=D;G<Q.length;G+=1){var oe=Q[G];if(Math.abs(oe.coord.x-O.x)<=y&&Math.abs(oe.coord.y-O.y)<=y&&!p[oe.crossTileID]){p[oe.crossTileID]=!0,P.crossTileID=oe.crossTileID;break}}}}};var tl=function(){this.maxCrossTileID=0};tl.prototype.generate=function(){return++this.maxCrossTileID};var vl=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};vl.prototype.handleWrapJump=function(h){var d=Math.round((h-this.lng)/360);if(d!==0)for(var p in this.indexes){var y=this.indexes[p],I={};for(var P in y){var D=y[P];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+d),I[D.tileID.key]=D}this.indexes[p]=I}this.lng=h},vl.prototype.addBucket=function(h,d,p){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(var y=0;y<d.symbolInstances.length;y++)d.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});var I=this.usedCrossTileIDs[h.overscaledZ];for(var P in this.indexes){var D=this.indexes[P];if(Number(P)>h.overscaledZ)for(var O in D){var G=D[O];G.tileID.isChildOf(h)&&G.findMatches(d.symbolInstances,h,I)}else{var Q=D[h.scaledTo(Number(P)).key];Q&&Q.findMatches(d.symbolInstances,h,I)}}for(var oe=0;oe<d.symbolInstances.length;oe++){var _e=d.symbolInstances.get(oe);_e.crossTileID||(_e.crossTileID=p.generate(),I[_e.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new In(h,d.symbolInstances,d.bucketInstanceId),!0},vl.prototype.removeBucketCrossTileIDs=function(h,d){for(var p in d.indexedSymbolInstances)for(var y=0,I=d.indexedSymbolInstances[p];y<I.length;y+=1){var P=I[y];delete this.usedCrossTileIDs[h][P.crossTileID]}},vl.prototype.removeStaleBuckets=function(h){var d=!1;for(var p in this.indexes){var y=this.indexes[p];for(var I in y)h[y[I].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[I]),delete y[I],d=!0)}return d};var Lo=function(){this.layerIndexes={},this.crossTileIDs=new tl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Lo.prototype.addLayer=function(h,d,p){var y=this.layerIndexes[h.id];y===void 0&&(y=this.layerIndexes[h.id]=new vl);var I=!1,P={};y.handleWrapJump(p);for(var D=0,O=d;D<O.length;D+=1){var G=O[D],Q=G.getBucket(h);Q&&h.id===Q.layerIds[0]&&(Q.bucketInstanceId||(Q.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(G.tileID,Q,this.crossTileIDs)&&(I=!0),P[Q.bucketInstanceId]=!0)}return y.removeStaleBuckets(P)&&(I=!0),I},Lo.prototype.pruneUnusedLayers=function(h){var d={};for(var p in h.forEach(function(y){d[y]=!0}),this.layerIndexes)d[p]||delete this.layerIndexes[p]};var aa=function(h,d){return T.emitValidationErrors(h,d&&d.filter(function(p){return p.identifier!=="source.canvas"}))},mh=T.pick(Le,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Zl=T.pick(Le,["setCenter","setZoom","setBearing","setPitch"]),An=function(){var h={},d=T.styleSpec.$version;for(var p in T.styleSpec.$root){var y=T.styleSpec.$root[p];if(y.required){var I=null;(I=p==="version"?d:y.type==="array"?[]:{})!=null&&(h[p]=I)}}return h}(),$a=function(h){function d(p,y){var I=this;y===void 0&&(y={}),h.call(this),this.map=p,this.dispatcher=new en((xe||(xe=new pe),xe),this),this.imageManager=new Wn,this.imageManager.setEventedParent(this),this.glyphManager=new jr(p._requestManager,y.localIdeographFontFamily),this.lineAtlas=new Ki(256,512),this.crossTileSymbolIndex=new Lo,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new T.ZoomHistory,this._loaded=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",T.getReferrer());var P=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(D){var O={pluginStatus:D.pluginStatus,pluginURL:D.pluginURL};P.dispatcher.broadcast("syncRTLPluginState",O,function(G,Q){if(T.triggerPluginCompletionEvent(G),Q&&Q.every(function(_e){return _e}))for(var oe in P.sourceCaches)P.sourceCaches[oe].reload()})}),this.on("data",function(D){if(D.dataType==="source"&&D.sourceDataType==="metadata"){var O=I.sourceCaches[D.sourceId];if(O){var G=O.getSource();if(G&&G.vectorLayerIds)for(var Q in I._layers){var oe=I._layers[Q];oe.source===G.id&&I._validateLayer(oe)}}}})}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.loadURL=function(p,y){var I=this;y===void 0&&(y={}),this.fire(new T.Event("dataloading",{dataType:"style"}));var P=typeof y.validate=="boolean"?y.validate:!T.isMapboxURL(p);p=this.map._requestManager.normalizeStyleURL(p,y.accessToken);var D=this.map._requestManager.transformRequest(p,T.ResourceType.Style);this._request=T.getJSON(D,function(O,G){I._request=null,O?I.fire(new T.ErrorEvent(O)):G&&I._load(G,P)})},d.prototype.loadJSON=function(p,y){var I=this;y===void 0&&(y={}),this.fire(new T.Event("dataloading",{dataType:"style"})),this._request=T.browser.frame(function(){I._request=null,I._load(p,y.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new T.Event("dataloading",{dataType:"style"})),this._load(An,!1)},d.prototype._load=function(p,y){if(!y||!aa(this,T.validateStyle(p))){for(var I in this._loaded=!0,this.stylesheet=p,p.sources)this.addSource(I,p.sources[I],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs);var P=Re(this.stylesheet.layers);this._order=P.map(function(Q){return Q.id}),this._layers={};for(var D=0,O=P;D<O.length;D+=1){var G=O[D];(G=T.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Wo(this.stylesheet.light),this.fire(new T.Event("data",{dataType:"style"})),this.fire(new T.Event("style.load"))}},d.prototype._loadSprite=function(p){var y=this;this._spriteRequest=function(I,P,D){var O,G,Q,oe=T.browser.devicePixelRatio>1?"@2x":"",_e=T.getJSON(P.transformRequest(P.normalizeSpriteURL(I,oe,".json"),T.ResourceType.SpriteJSON),function(ge,be){_e=null,Q||(Q=ge,O=be,Te())}),Se=T.getImage(P.transformRequest(P.normalizeSpriteURL(I,oe,".png"),T.ResourceType.SpriteImage),function(ge,be){Se=null,Q||(Q=ge,G=be,Te())});function Te(){if(Q)D(Q);else if(O&&G){var ge=T.browser.getImageData(G),be={};for(var We in O){var Ne=O[We],et=Ne.width,Je=Ne.height,ot=Ne.x,gt=Ne.y,Ct=Ne.sdf,Vt=Ne.pixelRatio,fi=Ne.stretchX,ei=Ne.stretchY,ni=Ne.content,Nt=new T.RGBAImage({width:et,height:Je});T.RGBAImage.copy(ge,Nt,{x:ot,y:gt},{x:0,y:0},{width:et,height:Je}),be[We]={data:Nt,pixelRatio:Vt,sdf:Ct,stretchX:fi,stretchY:ei,content:ni}}D(null,be)}}return{cancel:function(){_e&&(_e.cancel(),_e=null),Se&&(Se.cancel(),Se=null)}}}(p,this.map._requestManager,function(I,P){if(y._spriteRequest=null,I)y.fire(new T.ErrorEvent(I));else if(P)for(var D in P)y.imageManager.addImage(D,P[D]);y.imageManager.setLoaded(!0),y.dispatcher.broadcast("setImages",y.imageManager.listImages()),y.fire(new T.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(p){var y=this.sourceCaches[p.source];if(y){var I=p.sourceLayer;if(I){var P=y.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(I)===-1)&&this.fire(new T.ErrorEvent(new Error('Source layer "'+I+'" does not exist on source "'+P.id+'" as specified by style layer "'+p.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var p in this.sourceCaches)if(!this.sourceCaches[p].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(p){for(var y=[],I=0,P=p;I<P.length;I+=1){var D=P[I],O=this._layers[D];O.type!=="custom"&&y.push(O.serialize())}return y},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(var y in this._layers)if(this._layers[y].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(p){if(this._loaded){var y=this._changed;if(this._changed){var I=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);for(var D in(I.length||P.length)&&this._updateWorkerLayers(I,P),this._updatedSources){var O=this._updatedSources[D];O==="reload"?this._reloadSource(D):O==="clear"&&this._clearSource(D)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(p);this.light.updateTransitions(p),this._resetUpdates()}for(var Q in this.sourceCaches)this.sourceCaches[Q].used=!1;for(var oe=this.imageManager.listImages(),_e=0,Se=this._order;_e<Se.length;_e+=1){var Te=Se[_e],ge=this._layers[Te];ge.recalculate(p,oe),!ge.isHidden(p.zoom)&&ge.source&&(this.sourceCaches[ge.source].used=!0)}this.light.recalculate(p),this.z=p.zoom,y&&this.fire(new T.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var p=Object.keys(this._changedImages);if(p.length){for(var y in this.sourceCaches)this.sourceCaches[y].reloadTilesForDependencies(["icons","patterns"],p);this._changedImages={}}},d.prototype._updateWorkerLayers=function(p,y){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(p),removedIds:y})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(p){var y=this;if(this._checkLoaded(),aa(this,T.validateStyle(p)))return!1;(p=T.clone$1(p)).layers=Re(p.layers);var I=_i(this.serialize(),p).filter(function(D){return!(D.command in Zl)});if(I.length===0)return!1;var P=I.filter(function(D){return!(D.command in mh)});if(P.length>0)throw new Error("Unimplemented: "+P.map(function(D){return D.command}).join(", ")+".");return I.forEach(function(D){D.command!=="setTransition"&&y[D.command].apply(y,D.args)}),this.stylesheet=p,!0},d.prototype.addImage=function(p,y){if(this.getImage(p))return this.fire(new T.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(p,y),this._changedImages[p]=!0,this._changed=!0,this.fire(new T.Event("data",{dataType:"style"}))},d.prototype.updateImage=function(p,y){this.imageManager.updateImage(p,y)},d.prototype.getImage=function(p){return this.imageManager.getImage(p)},d.prototype.removeImage=function(p){if(!this.getImage(p))return this.fire(new T.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(p),this._changedImages[p]=!0,this._changed=!0,this.fire(new T.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(p,y,I){var P=this;if(I===void 0&&(I={}),this._checkLoaded(),this.sourceCaches[p]!==void 0)throw new Error("There is already a source with this ID");if(!y.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(y).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(y.type)>=0)||!this._validate(T.validateStyle.source,"sources."+p,y,null,I)){this.map&&this.map._collectResourceTiming&&(y.collectResourceTiming=!0);var D=this.sourceCaches[p]=new li(p,y,this.dispatcher);D.style=this,D.setEventedParent(this,function(){return{isSourceLoaded:P.loaded(),source:D.serialize(),sourceId:p}}),D.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(p){if(this._checkLoaded(),this.sourceCaches[p]===void 0)throw new Error("There is no source with this ID");for(var y in this._layers)if(this._layers[y].source===p)return this.fire(new T.ErrorEvent(new Error('Source "'+p+'" cannot be removed while layer "'+y+'" is using it.')));var I=this.sourceCaches[p];delete this.sourceCaches[p],delete this._updatedSources[p],I.fire(new T.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p})),I.setEventedParent(null),I.clearTiles(),I.onRemove&&I.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(p,y){this._checkLoaded(),this.sourceCaches[p].getSource().setData(y),this._changed=!0},d.prototype.getSource=function(p){return this.sourceCaches[p]&&this.sourceCaches[p].getSource()},d.prototype.addLayer=function(p,y,I){I===void 0&&(I={}),this._checkLoaded();var P=p.id;if(this.getLayer(P))this.fire(new T.ErrorEvent(new Error('Layer with id "'+P+'" already exists on this map')));else{var D;if(p.type==="custom"){if(aa(this,T.validateCustomStyleLayer(p)))return;D=T.createStyleLayer(p)}else{if(typeof p.source=="object"&&(this.addSource(P,p.source),p=T.clone$1(p),p=T.extend(p,{source:P})),this._validate(T.validateStyle.layer,"layers."+P,p,{arrayIndex:-1},I))return;D=T.createStyleLayer(p),this._validateLayer(D),D.setEventedParent(this,{layer:{id:P}})}var O=y?this._order.indexOf(y):this._order.length;if(y&&O===-1)this.fire(new T.ErrorEvent(new Error('Layer with id "'+y+'" does not exist on this map.')));else{if(this._order.splice(O,0,P),this._layerOrderChanged=!0,this._layers[P]=D,this._removedLayers[P]&&D.source&&D.type!=="custom"){var G=this._removedLayers[P];delete this._removedLayers[P],G.type!==D.type?this._updatedSources[D.source]="clear":(this._updatedSources[D.source]="reload",this.sourceCaches[D.source].pause())}this._updateLayer(D),D.onAdd&&D.onAdd(this.map)}}},d.prototype.moveLayer=function(p,y){if(this._checkLoaded(),this._changed=!0,this._layers[p]){if(p!==y){var I=this._order.indexOf(p);this._order.splice(I,1);var P=y?this._order.indexOf(y):this._order.length;y&&P===-1?this.fire(new T.ErrorEvent(new Error('Layer with id "'+y+'" does not exist on this map.'))):(this._order.splice(P,0,p),this._layerOrderChanged=!0)}}else this.fire(new T.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(p){this._checkLoaded();var y=this._layers[p];if(y){y.setEventedParent(null);var I=this._order.indexOf(p);this._order.splice(I,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[p]=y,delete this._layers[p],delete this._updatedLayers[p],delete this._updatedPaintProps[p],y.onRemove&&y.onRemove(this.map)}else this.fire(new T.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(p){return this._layers[p]},d.prototype.setLayerZoomRange=function(p,y,I){this._checkLoaded();var P=this.getLayer(p);P?P.minzoom===y&&P.maxzoom===I||(y!=null&&(P.minzoom=y),I!=null&&(P.maxzoom=I),this._updateLayer(P)):this.fire(new T.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(p,y,I){I===void 0&&(I={}),this._checkLoaded();var P=this.getLayer(p);if(P){if(!T.deepEqual(P.filter,y))return y==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(T.validateStyle.filter,"layers."+P.id+".filter",y,null,I)||(P.filter=T.clone$1(y),this._updateLayer(P)))}else this.fire(new T.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(p){return T.clone$1(this.getLayer(p).filter)},d.prototype.setLayoutProperty=function(p,y,I,P){P===void 0&&(P={}),this._checkLoaded();var D=this.getLayer(p);D?T.deepEqual(D.getLayoutProperty(y),I)||(D.setLayoutProperty(y,I,P),this._updateLayer(D)):this.fire(new T.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(p,y){var I=this.getLayer(p);if(I)return I.getLayoutProperty(y);this.fire(new T.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(p,y,I,P){P===void 0&&(P={}),this._checkLoaded();var D=this.getLayer(p);D?T.deepEqual(D.getPaintProperty(y),I)||(D.setPaintProperty(y,I,P)&&this._updateLayer(D),this._changed=!0,this._updatedPaintProps[p]=!0):this.fire(new T.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(p,y){return this.getLayer(p).getPaintProperty(y)},d.prototype.setFeatureState=function(p,y){this._checkLoaded();var I=p.source,P=p.sourceLayer,D=this.sourceCaches[I];if(D!==void 0){var O=D.getSource().type;O==="geojson"&&P?this.fire(new T.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):O!=="vector"||P?(p.id===void 0&&this.fire(new T.ErrorEvent(new Error("The feature id parameter must be provided."))),D.setFeatureState(P,p.id,y)):this.fire(new T.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new T.ErrorEvent(new Error("The source '"+I+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(p,y){this._checkLoaded();var I=p.source,P=this.sourceCaches[I];if(P!==void 0){var D=P.getSource().type,O=D==="vector"?p.sourceLayer:void 0;D!=="vector"||O?y&&typeof p.id!="string"&&typeof p.id!="number"?this.fire(new T.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):P.removeFeatureState(O,p.id,y):this.fire(new T.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new T.ErrorEvent(new Error("The source '"+I+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(p){this._checkLoaded();var y=p.source,I=p.sourceLayer,P=this.sourceCaches[y];if(P!==void 0){if(P.getSource().type!=="vector"||I)return p.id===void 0&&this.fire(new T.ErrorEvent(new Error("The feature id parameter must be provided."))),P.getFeatureState(I,p.id);this.fire(new T.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new T.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return T.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return T.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:T.mapObject(this.sourceCaches,function(p){return p.serialize()}),layers:this._serializeLayers(this._order)},function(p){return p!==void 0})},d.prototype._updateLayer=function(p){this._updatedLayers[p.id]=!0,p.source&&!this._updatedSources[p.source]&&this.sourceCaches[p.source].getSource().type!=="raster"&&(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(p){for(var y=this,I=function(ni){return y._layers[ni].type==="fill-extrusion"},P={},D=[],O=this._order.length-1;O>=0;O--){var G=this._order[O];if(I(G)){P[G]=O;for(var Q=0,oe=p;Q<oe.length;Q+=1){var _e=oe[Q][G];if(_e)for(var Se=0,Te=_e;Se<Te.length;Se+=1){var ge=Te[Se];D.push(ge)}}}}D.sort(function(ni,Nt){return Nt.intersectionZ-ni.intersectionZ});for(var be=[],We=this._order.length-1;We>=0;We--){var Ne=this._order[We];if(I(Ne))for(var et=D.length-1;et>=0;et--){var Je=D[et].feature;if(P[Je.layer.id]<We)break;be.push(Je),D.pop()}else for(var ot=0,gt=p;ot<gt.length;ot+=1){var Ct=gt[ot][Ne];if(Ct)for(var Vt=0,fi=Ct;Vt<fi.length;Vt+=1){var ei=fi[Vt];be.push(ei.feature)}}}return be},d.prototype.queryRenderedFeatures=function(p,y,I){y&&y.filter&&this._validate(T.validateStyle.filter,"queryRenderedFeatures.filter",y.filter,null,y);var P={};if(y&&y.layers){if(!Array.isArray(y.layers))return this.fire(new T.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var D=0,O=y.layers;D<O.length;D+=1){var G=O[D],Q=this._layers[G];if(!Q)return this.fire(new T.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];P[Q.source]=!0}}var oe=[];for(var _e in this.sourceCaches)y.layers&&!P[_e]||oe.push(ga(this.sourceCaches[_e],this._layers,p,y,I));return this.placement&&oe.push(function(Se,Te,ge,be,We,Ne){for(var et={},Je=We.queryRenderedSymbols(ge),ot=[],gt=0,Ct=Object.keys(Je).map(Number);gt<Ct.length;gt+=1){var Vt=Ct[gt];ot.push(Ne[Vt])}ot.sort(ps);for(var fi=function(){var Ii=ni[ei],Vi=Ii.featureIndex.lookupSymbolFeatures(Je[Ii.bucketInstanceId],Ii.bucketIndex,Ii.sourceLayerIndex,be.filter,be.layers,Se);for(var Ni in Vi){var Pi=et[Ni]=et[Ni]||[],ji=Vi[Ni];ji.sort(function(fr,xr){var Ft=Ii.featureSortOrder;if(Ft){var Vn=Ft.indexOf(fr.featureIndex);return Ft.indexOf(xr.featureIndex)-Vn}return xr.featureIndex-fr.featureIndex});for(var Dr=0,Ri=ji;Dr<Ri.length;Dr+=1){var gr=Ri[Dr];Pi.push(gr)}}},ei=0,ni=ot;ei<ni.length;ei+=1)fi();var Nt=function(Ii){et[Ii].forEach(function(Vi){var Ni=Vi.feature,Pi=Se[Ii],ji=Te[Pi.source].getFeatureState(Ni.layer["source-layer"],Ni.id);Ni.source=Ni.layer.source,Ni.layer["source-layer"]&&(Ni.sourceLayer=Ni.layer["source-layer"]),Ni.state=ji})};for(var Hi in et)Nt(Hi);return et}(this._layers,this.sourceCaches,p,y,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(oe)},d.prototype.querySourceFeatures=function(p,y){y&&y.filter&&this._validate(T.validateStyle.filter,"querySourceFeatures.filter",y.filter,null,y);var I=this.sourceCaches[p];return I?function(P,D){for(var O=P.getRenderableIds().map(function(Te){return P.getTileByID(Te)}),G=[],Q={},oe=0;oe<O.length;oe++){var _e=O[oe],Se=_e.tileID.canonical.key;Q[Se]||(Q[Se]=!0,_e.querySourceFeatures(G,D))}return G}(I,y):[]},d.prototype.addSourceType=function(p,y,I){return d.getSourceType(p)?I(new Error('A source type called "'+p+'" already exists.')):(d.setSourceType(p,y),y.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:p,url:y.workerSourceURL},I):I(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(p,y){y===void 0&&(y={}),this._checkLoaded();var I=this.light.getLight(),P=!1;for(var D in p)if(!T.deepEqual(p[D],I[D])){P=!0;break}if(P){var O={now:T.browser.now(),transition:T.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(p,y),this.light.updateTransitions(O)}},d.prototype._validate=function(p,y,I,P,D){return D===void 0&&(D={}),(!D||D.validate!==!1)&&aa(this,p.call(T.validateStyle,T.extend({key:y,style:this.serialize(),value:I,styleSpec:T.styleSpec},P)))},d.prototype._remove=function(){for(var p in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),T.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[p].setEventedParent(null);for(var y in this.sourceCaches)this.sourceCaches[y].clearTiles(),this.sourceCaches[y].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(p){this.sourceCaches[p].clearTiles()},d.prototype._reloadSource=function(p){this.sourceCaches[p].resume(),this.sourceCaches[p].reload()},d.prototype._updateSources=function(p){for(var y in this.sourceCaches)this.sourceCaches[y].update(p)},d.prototype._generateCollisionBoxes=function(){for(var p in this.sourceCaches)this._reloadSource(p)},d.prototype._updatePlacement=function(p,y,I,P,D){D===void 0&&(D=!1);for(var O=!1,G=!1,Q={},oe=0,_e=this._order;oe<_e.length;oe+=1){var Se=_e[oe],Te=this._layers[Se];if(Te.type==="symbol"){if(!Q[Te.source]){var ge=this.sourceCaches[Te.source];Q[Te.source]=ge.getRenderableIds(!0).map(function(ot){return ge.getTileByID(ot)}).sort(function(ot,gt){return gt.tileID.overscaledZ-ot.tileID.overscaledZ||(ot.tileID.isLessThan(gt.tileID)?-1:1)})}var be=this.crossTileSymbolIndex.addLayer(Te,Q[Te.source],p.center.lng);O=O||be}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((D=D||this._layerOrderChanged||I===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(T.browser.now(),p.zoom))&&(this.pauseablePlacement=new Bs(p,this._order,D,y,I,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(T.browser.now()),G=!0),O&&this.pauseablePlacement.placement.setStale()),G||O)for(var We=0,Ne=this._order;We<Ne.length;We+=1){var et=Ne[We],Je=this._layers[et];Je.type==="symbol"&&this.placement.updateLayerOpacities(Je,Q[Je.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(T.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var p in this.sourceCaches)this.sourceCaches[p].releaseSymbolFadeTiles()},d.prototype.getImages=function(p,y,I){this.imageManager.getImages(y.icons,I),this._updateTilesForChangedImages();var P=this.sourceCaches[y.source];P&&P.setDependencies(y.tileID.key,y.type,y.icons)},d.prototype.getGlyphs=function(p,y,I){this.glyphManager.getGlyphs(y.stacks,I)},d.prototype.getResource=function(p,y,I){return T.makeRequest(y,I)},d}(T.Evented);$a.getSourceType=function(h){return ma[h]},$a.setSourceType=function(h,d){ma[h]=d},$a.registerForPluginStateChange=T.registerForPluginStateChange;var xl=T.createLayout([{name:"a_pos",type:"Int16",components:2}]),Fs=an(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Po=an(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Fu=an(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Xl=an(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),za=an("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),il=an(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),ro=an(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ou=an("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Os=an("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {color=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}"),Pa=an("uniform highp vec4 u_color;void main() {gl_FragColor=u_color;}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),$o=an(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),rl=an(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ka=an(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),sa=an(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),dc=an(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Us=an(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec4 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),nl=an(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),fc=an(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Vc=an(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),_h=an(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define MAX_LINE_DISTANCE 32767.0
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),cu=an(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec4 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x,1.0);float x_b=mod(v_linesofar/pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_a.y+2.0)/2.0)/pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_b.y+2.0)/2.0)/pattern_size_b.y);vec2 pos_a=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}`),Uu=an(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Vu=an(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ha=an(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);gl_Position.z=mix(-1.1*gl_Position.w,gl_Position.z,float(projected_pos.w > 0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),wr=an(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;gl_Position.z=mix(-1.1*gl_Position.w,gl_Position.z,float(projected_pos.w > 0.0));vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),mc=an(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function an(h,d){var p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y={};return{fragmentSource:h=h.replace(p,function(I,P,D,O,G){return y[G]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_`+G+`
varying `+D+" "+O+" "+G+`;
#else
uniform `+D+" "+O+" u_"+G+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+G+`
    `+D+" "+O+" "+G+" = u_"+G+`;
#endif
`}),vertexSource:d=d.replace(p,function(I,P,D,O,G){var Q=O==="float"?"vec2":"vec4",oe=G.match(/color/)?"color":Q;return y[G]?P==="define"?`
#ifndef HAS_UNIFORM_u_`+G+`
uniform lowp float u_`+G+`_t;
attribute `+D+" "+Q+" a_"+G+`;
varying `+D+" "+O+" "+G+`;
#else
uniform `+D+" "+O+" u_"+G+`;
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+G+`
    `+G+" = a_"+G+`;
#else
    `+D+" "+O+" "+G+" = u_"+G+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+G+`
    `+G+" = unpack_mix_"+oe+"(a_"+G+", u_"+G+`_t);
#else
    `+D+" "+O+" "+G+" = u_"+G+`;
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_`+G+`
uniform lowp float u_`+G+`_t;
attribute `+D+" "+Q+" a_"+G+`;
#else
uniform `+D+" "+O+" u_"+G+`;
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+G+`
    `+D+" "+O+" "+G+" = a_"+G+`;
#else
    `+D+" "+O+" "+G+" = u_"+G+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+G+`
    `+D+" "+O+" "+G+" = unpack_mix_"+oe+"(a_"+G+", u_"+G+`_t);
#else
    `+D+" "+O+" "+G+" = u_"+G+`;
#endif
`})}}var Nu=Object.freeze({__proto__:null,prelude:Fs,background:Po,backgroundPattern:Fu,circle:Xl,clippingMask:za,heatmap:il,heatmapTexture:ro,collisionBox:Ou,collisionCircle:Os,debug:Pa,fill:$o,fillOutline:rl,fillOutlinePattern:ka,fillPattern:sa,fillExtrusion:dc,fillExtrusionPattern:Us,hillshadePrepare:nl,hillshade:fc,line:Vc,lineGradient:_h,linePattern:cu,lineSDF:Uu,raster:Vu,symbolIcon:Ha,symbolSDF:wr,symbolTextAndIcon:mc}),bl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};bl.prototype.bind=function(h,d,p,y,I,P,D,O){this.context=h;for(var G=this.boundPaintVertexBuffers.length!==y.length,Q=0;!G&&Q<y.length;Q++)this.boundPaintVertexBuffers[Q]!==y[Q]&&(G=!0);var oe=!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==p||G||this.boundIndexBuffer!==I||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==O;!h.extVertexArrayObject||oe?this.freshBind(d,p,y,I,P,D,O):(h.bindVertexArrayOES.set(this.vao),D&&D.bind(),I&&I.dynamicDraw&&I.bind(),O&&O.bind())},bl.prototype.freshBind=function(h,d,p,y,I,P,D){var O,G=h.numAttributes,Q=this.context,oe=Q.gl;if(Q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Q.extVertexArrayObject.createVertexArrayOES(),Q.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=h,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=I,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=D;else{O=Q.currentNumAttributes||0;for(var _e=G;_e<O;_e++)oe.disableVertexAttribArray(_e)}d.enableAttributes(oe,h);for(var Se=0,Te=p;Se<Te.length;Se+=1)Te[Se].enableAttributes(oe,h);P&&P.enableAttributes(oe,h),D&&D.enableAttributes(oe,h),d.bind(),d.setVertexAttribPointers(oe,h,I);for(var ge=0,be=p;ge<be.length;ge+=1){var We=be[ge];We.bind(),We.setVertexAttribPointers(oe,h,I)}P&&(P.bind(),P.setVertexAttribPointers(oe,h,I)),y&&y.bind(),D&&(D.bind(),D.setVertexAttribPointers(oe,h,I)),Q.currentNumAttributes=G},bl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var ol=function(h,d,p,y,I){var P=h.gl;this.program=P.createProgram();var D=p?p.defines():[];I&&D.push("#define OVERDRAW_INSPECTOR;");var O=D.concat(Fs.fragmentSource,d.fragmentSource).join(`
`),G=D.concat(Fs.vertexSource,d.vertexSource).join(`
`),Q=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Q,O),P.compileShader(Q),P.attachShader(this.program,Q);var oe=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(oe,G),P.compileShader(oe),P.attachShader(this.program,oe);for(var _e=p?p.layoutAttributes:[],Se=0;Se<_e.length;Se++)P.bindAttribLocation(this.program,Se,_e[Se].name);P.linkProgram(this.program),this.numAttributes=P.getProgramParameter(this.program,P.ACTIVE_ATTRIBUTES),this.attributes={};for(var Te={},ge=0;ge<this.numAttributes;ge++){var be=P.getActiveAttrib(this.program,ge);be&&(this.attributes[be.name]=P.getAttribLocation(this.program,be.name))}for(var We=P.getProgramParameter(this.program,P.ACTIVE_UNIFORMS),Ne=0;Ne<We;Ne++){var et=P.getActiveUniform(this.program,Ne);et&&(Te[et.name]=P.getUniformLocation(this.program,et.name))}this.fixedUniforms=y(h,Te),this.binderUniforms=p?p.getUniforms(h,Te):[]}}};function _c(h,d,p){var y=1/Rt(p,1,d.transform.tileZoom),I=Math.pow(2,p.tileID.overscaledZ),P=p.tileSize*Math.pow(2,d.transform.tileZoom)/I,D=P*(p.tileID.canonical.x+p.tileID.wrap*I),O=P*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[T.browser.devicePixelRatio,y,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[D>>16,O>>16],u_pixel_coord_lower:[65535&D,65535&O]}}ol.prototype.draw=function(h,d,p,y,I,P,D,O,G,Q,oe,_e,Se,Te,ge,be){var We,Ne=h.gl;if(!this.failedToCreate){for(var et in h.program.set(this.program),h.setDepthMode(p),h.setStencilMode(y),h.setColorMode(I),h.setCullFace(P),this.fixedUniforms)this.fixedUniforms[et].set(D[et]);Te&&Te.setUniforms(h,this.binderUniforms,_e,{zoom:Se});for(var Je=(We={},We[Ne.LINES]=2,We[Ne.TRIANGLES]=3,We[Ne.LINE_STRIP]=1,We)[d],ot=0,gt=oe.get();ot<gt.length;ot+=1){var Ct=gt[ot],Vt=Ct.vaos||(Ct.vaos={});(Vt[O]||(Vt[O]=new bl)).bind(h,this,G,Te?Te.getPaintVertexBuffers():[],Q,Ct.vertexOffset,ge,be),Ne.drawElements(d,Ct.primitiveLength*Je,Ne.UNSIGNED_SHORT,Ct.primitiveOffset*Je*2)}}};var Ka=function(h,d,p,y){var I=d.style.light,P=I.properties.get("position"),D=[P.x,P.y,P.z],O=T.create$1();I.properties.get("anchor")==="viewport"&&T.fromRotation(O,-d.transform.angle),T.transformMat3(D,D,O);var G=I.properties.get("color");return{u_matrix:h,u_lightpos:D,u_lightintensity:I.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+p,u_opacity:y}},al=function(h,d,p,y,I,P,D){return T.extend(Ka(h,d,p,y),_c(P,d,D),{u_height_factor:-Math.pow(2,I.overscaledZ)/D.tileSize/8})},wl=function(h){return{u_matrix:h}},Ya=function(h,d,p,y){return T.extend(wl(h),_c(p,d,y))},Pr=function(h,d){return{u_matrix:h,u_world:d}},Wl=function(h,d,p,y,I){return T.extend(Ya(h,d,p,y),{u_world:I})},gh=function(h,d,p,y){var I,P,D=h.transform;if(y.paint.get("circle-pitch-alignment")==="map"){var O=Rt(p,1,D.zoom);I=!0,P=[O,O]}else I=!1,P=D.pixelsToGLUnits;return{u_camera_to_center_distance:D.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(d.posMatrix,p,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+I,u_device_pixel_ratio:T.browser.devicePixelRatio,u_extrude_scale:P}},Vs=function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_camera_to_center_distance:new T.Uniform1f(h,d.u_camera_to_center_distance),u_pixels_to_tile_units:new T.Uniform1f(h,d.u_pixels_to_tile_units),u_extrude_scale:new T.Uniform2f(h,d.u_extrude_scale),u_overscale_factor:new T.Uniform1f(h,d.u_overscale_factor)}},ju=function(h,d,p){var y=Rt(p,1,d.zoom),I=Math.pow(2,d.zoom-p.tileID.overscaledZ),P=p.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[d.pixelsToGLUnits[0]/(y*I),d.pixelsToGLUnits[1]/(y*I)],u_overscale_factor:P}},Nc=function(h,d){return{u_matrix:h,u_color:d}},gc=function(h){return{u_matrix:h}},uu=function(h,d,p,y){return{u_matrix:h,u_extrude_scale:Rt(d,1,p),u_intensity:y}},$l=function(h,d,p,y){var I=T.create();T.ortho(I,0,h.width,h.height,0,0,1);var P=h.context.gl;return{u_matrix:I,u_world:[P.drawingBufferWidth,P.drawingBufferHeight],u_image:p,u_color_ramp:y,u_opacity:d.paint.get("heatmap-opacity")}},Tr=function(h,d,p){var y=p.paint.get("hillshade-shadow-color"),I=p.paint.get("hillshade-highlight-color"),P=p.paint.get("hillshade-accent-color"),D=p.paint.get("hillshade-illumination-direction")*(Math.PI/180);p.paint.get("hillshade-illumination-anchor")==="viewport"&&(D-=h.transform.angle);var O=!h.options.moving;return{u_matrix:h.transform.calculatePosMatrix(d.tileID.toUnwrapped(),O),u_image:0,u_latrange:yc(h,d.tileID),u_light:[p.paint.get("hillshade-exaggeration"),D],u_shadow:y,u_highlight:I,u_accent:P}},Tl=function(h,d,p){var y=d.stride,I=T.create();return T.ortho(I,0,T.EXTENT,-T.EXTENT,0,0,1),T.translate(I,I,[0,-T.EXTENT,0]),{u_matrix:I,u_image:1,u_dimension:[y,y],u_zoom:h.overscaledZ,u_maxzoom:p,u_unpack:d.getUnpackVector()}};function yc(h,d){var p=Math.pow(2,d.canonical.z),y=d.canonical.y;return[new T.MercatorCoordinate(0,y/p).toLngLat().lat,new T.MercatorCoordinate(0,(y+1)/p).toLngLat().lat]}var Ns=function(h,d,p){var y=h.transform;return{u_matrix:Zu(h,d,p),u_ratio:1/Rt(d,1,y.zoom),u_device_pixel_ratio:T.browser.devicePixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},qu=function(h,d,p){return T.extend(Ns(h,d,p),{u_image:0})},ys=function(h,d,p,y){var I=h.transform,P=Gu(d,I);return{u_matrix:Zu(h,d,p),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Rt(d,1,I.zoom),u_device_pixel_ratio:T.browser.devicePixelRatio,u_image:0,u_scale:[T.browser.devicePixelRatio,P,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]]}},Da=function(h,d,p,y,I){var P=h.transform,D=h.lineAtlas,O=Gu(d,P),G=p.layout.get("line-cap")==="round",Q=D.getDash(y.from,G),oe=D.getDash(y.to,G),_e=Q.width*I.fromScale,Se=oe.width*I.toScale;return T.extend(Ns(h,d,p),{u_patternscale_a:[O/_e,-Q.height/2],u_patternscale_b:[O/Se,-oe.height/2],u_sdfgamma:D.width/(256*Math.min(_e,Se)*T.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Q.y,u_tex_y_b:oe.y,u_mix:I.t})};function Gu(h,d){return 1/Rt(h,1,d.tileZoom)}function Zu(h,d,p){return h.translatePosMatrix(d.tileID.posMatrix,d,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}var yh=function(h,d,p,y,I){return{u_matrix:h,u_tl_parent:d,u_scale_parent:p,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:(D=I.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(P=I.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:El(I.paint.get("raster-hue-rotate"))};var P,D};function El(h){h*=Math.PI/180;var d=Math.sin(h),p=Math.cos(h);return[(2*p+1)/3,(-Math.sqrt(3)*d-p+1)/3,(Math.sqrt(3)*d-p+1)/3]}var Hl=function(h,d,p,y,I,P,D,O,G,Q){var oe=I.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:oe.width/oe.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:D,u_coord_matrix:O,u_is_text:+G,u_pitch_with_map:+y,u_texsize:Q,u_texture:0}},vc=function(h,d,p,y,I,P,D,O,G,Q,oe){var _e=I.transform;return T.extend(Hl(h,d,p,y,I,P,D,O,G,Q),{u_gamma_scale:y?Math.cos(_e._pitch)*_e.cameraToCenterDistance:1,u_device_pixel_ratio:T.browser.devicePixelRatio,u_is_halo:+oe})},hu=function(h,d,p,y,I,P,D,O,G,Q){return T.extend(vc(h,d,p,y,I,P,D,O,!0,G,!0),{u_texsize_icon:Q,u_texture_icon:1})},jc=function(h,d,p){return{u_matrix:h,u_opacity:d,u_color:p}},vh=function(h,d,p,y,I,P){return T.extend(function(D,O,G,Q){var oe=G.imageManager.getPattern(D.from.toString()),_e=G.imageManager.getPattern(D.to.toString()),Se=G.imageManager.getPixelSize(),Te=Se.width,ge=Se.height,be=Math.pow(2,Q.tileID.overscaledZ),We=Q.tileSize*Math.pow(2,G.transform.tileZoom)/be,Ne=We*(Q.tileID.canonical.x+Q.tileID.wrap*be),et=We*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:_e.tl,u_pattern_br_b:_e.br,u_texsize:[Te,ge],u_mix:O.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:_e.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/Rt(Q,1,G.transform.tileZoom),u_pixel_coord_upper:[Ne>>16,et>>16],u_pixel_coord_lower:[65535&Ne,65535&et]}}(y,P,p,I),{u_matrix:h,u_opacity:d})},pu={fillExtrusion:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_lightpos:new T.Uniform3f(h,d.u_lightpos),u_lightintensity:new T.Uniform1f(h,d.u_lightintensity),u_lightcolor:new T.Uniform3f(h,d.u_lightcolor),u_vertical_gradient:new T.Uniform1f(h,d.u_vertical_gradient),u_opacity:new T.Uniform1f(h,d.u_opacity)}},fillExtrusionPattern:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_lightpos:new T.Uniform3f(h,d.u_lightpos),u_lightintensity:new T.Uniform1f(h,d.u_lightintensity),u_lightcolor:new T.Uniform3f(h,d.u_lightcolor),u_vertical_gradient:new T.Uniform1f(h,d.u_vertical_gradient),u_height_factor:new T.Uniform1f(h,d.u_height_factor),u_image:new T.Uniform1i(h,d.u_image),u_texsize:new T.Uniform2f(h,d.u_texsize),u_pixel_coord_upper:new T.Uniform2f(h,d.u_pixel_coord_upper),u_pixel_coord_lower:new T.Uniform2f(h,d.u_pixel_coord_lower),u_scale:new T.Uniform4f(h,d.u_scale),u_fade:new T.Uniform1f(h,d.u_fade),u_opacity:new T.Uniform1f(h,d.u_opacity)}},fill:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix)}},fillPattern:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_image:new T.Uniform1i(h,d.u_image),u_texsize:new T.Uniform2f(h,d.u_texsize),u_pixel_coord_upper:new T.Uniform2f(h,d.u_pixel_coord_upper),u_pixel_coord_lower:new T.Uniform2f(h,d.u_pixel_coord_lower),u_scale:new T.Uniform4f(h,d.u_scale),u_fade:new T.Uniform1f(h,d.u_fade)}},fillOutline:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_world:new T.Uniform2f(h,d.u_world)}},fillOutlinePattern:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_world:new T.Uniform2f(h,d.u_world),u_image:new T.Uniform1i(h,d.u_image),u_texsize:new T.Uniform2f(h,d.u_texsize),u_pixel_coord_upper:new T.Uniform2f(h,d.u_pixel_coord_upper),u_pixel_coord_lower:new T.Uniform2f(h,d.u_pixel_coord_lower),u_scale:new T.Uniform4f(h,d.u_scale),u_fade:new T.Uniform1f(h,d.u_fade)}},circle:function(h,d){return{u_camera_to_center_distance:new T.Uniform1f(h,d.u_camera_to_center_distance),u_scale_with_map:new T.Uniform1i(h,d.u_scale_with_map),u_pitch_with_map:new T.Uniform1i(h,d.u_pitch_with_map),u_extrude_scale:new T.Uniform2f(h,d.u_extrude_scale),u_device_pixel_ratio:new T.Uniform1f(h,d.u_device_pixel_ratio),u_matrix:new T.UniformMatrix4f(h,d.u_matrix)}},collisionBox:Vs,collisionCircle:Vs,debug:function(h,d){return{u_color:new T.UniformColor(h,d.u_color),u_matrix:new T.UniformMatrix4f(h,d.u_matrix)}},clippingMask:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix)}},heatmap:function(h,d){return{u_extrude_scale:new T.Uniform1f(h,d.u_extrude_scale),u_intensity:new T.Uniform1f(h,d.u_intensity),u_matrix:new T.UniformMatrix4f(h,d.u_matrix)}},heatmapTexture:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_world:new T.Uniform2f(h,d.u_world),u_image:new T.Uniform1i(h,d.u_image),u_color_ramp:new T.Uniform1i(h,d.u_color_ramp),u_opacity:new T.Uniform1f(h,d.u_opacity)}},hillshade:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_image:new T.Uniform1i(h,d.u_image),u_latrange:new T.Uniform2f(h,d.u_latrange),u_light:new T.Uniform2f(h,d.u_light),u_shadow:new T.UniformColor(h,d.u_shadow),u_highlight:new T.UniformColor(h,d.u_highlight),u_accent:new T.UniformColor(h,d.u_accent)}},hillshadePrepare:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_image:new T.Uniform1i(h,d.u_image),u_dimension:new T.Uniform2f(h,d.u_dimension),u_zoom:new T.Uniform1f(h,d.u_zoom),u_maxzoom:new T.Uniform1f(h,d.u_maxzoom),u_unpack:new T.Uniform4f(h,d.u_unpack)}},line:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_ratio:new T.Uniform1f(h,d.u_ratio),u_device_pixel_ratio:new T.Uniform1f(h,d.u_device_pixel_ratio),u_units_to_pixels:new T.Uniform2f(h,d.u_units_to_pixels)}},lineGradient:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_ratio:new T.Uniform1f(h,d.u_ratio),u_device_pixel_ratio:new T.Uniform1f(h,d.u_device_pixel_ratio),u_units_to_pixels:new T.Uniform2f(h,d.u_units_to_pixels),u_image:new T.Uniform1i(h,d.u_image)}},linePattern:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_texsize:new T.Uniform2f(h,d.u_texsize),u_ratio:new T.Uniform1f(h,d.u_ratio),u_device_pixel_ratio:new T.Uniform1f(h,d.u_device_pixel_ratio),u_image:new T.Uniform1i(h,d.u_image),u_units_to_pixels:new T.Uniform2f(h,d.u_units_to_pixels),u_scale:new T.Uniform4f(h,d.u_scale),u_fade:new T.Uniform1f(h,d.u_fade)}},lineSDF:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_ratio:new T.Uniform1f(h,d.u_ratio),u_device_pixel_ratio:new T.Uniform1f(h,d.u_device_pixel_ratio),u_units_to_pixels:new T.Uniform2f(h,d.u_units_to_pixels),u_patternscale_a:new T.Uniform2f(h,d.u_patternscale_a),u_patternscale_b:new T.Uniform2f(h,d.u_patternscale_b),u_sdfgamma:new T.Uniform1f(h,d.u_sdfgamma),u_image:new T.Uniform1i(h,d.u_image),u_tex_y_a:new T.Uniform1f(h,d.u_tex_y_a),u_tex_y_b:new T.Uniform1f(h,d.u_tex_y_b),u_mix:new T.Uniform1f(h,d.u_mix)}},raster:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_tl_parent:new T.Uniform2f(h,d.u_tl_parent),u_scale_parent:new T.Uniform1f(h,d.u_scale_parent),u_buffer_scale:new T.Uniform1f(h,d.u_buffer_scale),u_fade_t:new T.Uniform1f(h,d.u_fade_t),u_opacity:new T.Uniform1f(h,d.u_opacity),u_image0:new T.Uniform1i(h,d.u_image0),u_image1:new T.Uniform1i(h,d.u_image1),u_brightness_low:new T.Uniform1f(h,d.u_brightness_low),u_brightness_high:new T.Uniform1f(h,d.u_brightness_high),u_saturation_factor:new T.Uniform1f(h,d.u_saturation_factor),u_contrast_factor:new T.Uniform1f(h,d.u_contrast_factor),u_spin_weights:new T.Uniform3f(h,d.u_spin_weights)}},symbolIcon:function(h,d){return{u_is_size_zoom_constant:new T.Uniform1i(h,d.u_is_size_zoom_constant),u_is_size_feature_constant:new T.Uniform1i(h,d.u_is_size_feature_constant),u_size_t:new T.Uniform1f(h,d.u_size_t),u_size:new T.Uniform1f(h,d.u_size),u_camera_to_center_distance:new T.Uniform1f(h,d.u_camera_to_center_distance),u_pitch:new T.Uniform1f(h,d.u_pitch),u_rotate_symbol:new T.Uniform1i(h,d.u_rotate_symbol),u_aspect_ratio:new T.Uniform1f(h,d.u_aspect_ratio),u_fade_change:new T.Uniform1f(h,d.u_fade_change),u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_label_plane_matrix:new T.UniformMatrix4f(h,d.u_label_plane_matrix),u_coord_matrix:new T.UniformMatrix4f(h,d.u_coord_matrix),u_is_text:new T.Uniform1f(h,d.u_is_text),u_pitch_with_map:new T.Uniform1i(h,d.u_pitch_with_map),u_texsize:new T.Uniform2f(h,d.u_texsize),u_texture:new T.Uniform1i(h,d.u_texture)}},symbolSDF:function(h,d){return{u_is_size_zoom_constant:new T.Uniform1i(h,d.u_is_size_zoom_constant),u_is_size_feature_constant:new T.Uniform1i(h,d.u_is_size_feature_constant),u_size_t:new T.Uniform1f(h,d.u_size_t),u_size:new T.Uniform1f(h,d.u_size),u_camera_to_center_distance:new T.Uniform1f(h,d.u_camera_to_center_distance),u_pitch:new T.Uniform1f(h,d.u_pitch),u_rotate_symbol:new T.Uniform1i(h,d.u_rotate_symbol),u_aspect_ratio:new T.Uniform1f(h,d.u_aspect_ratio),u_fade_change:new T.Uniform1f(h,d.u_fade_change),u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_label_plane_matrix:new T.UniformMatrix4f(h,d.u_label_plane_matrix),u_coord_matrix:new T.UniformMatrix4f(h,d.u_coord_matrix),u_is_text:new T.Uniform1f(h,d.u_is_text),u_pitch_with_map:new T.Uniform1i(h,d.u_pitch_with_map),u_texsize:new T.Uniform2f(h,d.u_texsize),u_texture:new T.Uniform1i(h,d.u_texture),u_gamma_scale:new T.Uniform1f(h,d.u_gamma_scale),u_device_pixel_ratio:new T.Uniform1f(h,d.u_device_pixel_ratio),u_is_halo:new T.Uniform1f(h,d.u_is_halo)}},symbolTextAndIcon:function(h,d){return{u_is_size_zoom_constant:new T.Uniform1i(h,d.u_is_size_zoom_constant),u_is_size_feature_constant:new T.Uniform1i(h,d.u_is_size_feature_constant),u_size_t:new T.Uniform1f(h,d.u_size_t),u_size:new T.Uniform1f(h,d.u_size),u_camera_to_center_distance:new T.Uniform1f(h,d.u_camera_to_center_distance),u_pitch:new T.Uniform1f(h,d.u_pitch),u_rotate_symbol:new T.Uniform1i(h,d.u_rotate_symbol),u_aspect_ratio:new T.Uniform1f(h,d.u_aspect_ratio),u_fade_change:new T.Uniform1f(h,d.u_fade_change),u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_label_plane_matrix:new T.UniformMatrix4f(h,d.u_label_plane_matrix),u_coord_matrix:new T.UniformMatrix4f(h,d.u_coord_matrix),u_is_text:new T.Uniform1f(h,d.u_is_text),u_pitch_with_map:new T.Uniform1i(h,d.u_pitch_with_map),u_texsize:new T.Uniform2f(h,d.u_texsize),u_texsize_icon:new T.Uniform2f(h,d.u_texsize_icon),u_texture:new T.Uniform1i(h,d.u_texture),u_texture_icon:new T.Uniform1i(h,d.u_texture_icon),u_gamma_scale:new T.Uniform1f(h,d.u_gamma_scale),u_device_pixel_ratio:new T.Uniform1f(h,d.u_device_pixel_ratio),u_is_halo:new T.Uniform1f(h,d.u_is_halo)}},background:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_opacity:new T.Uniform1f(h,d.u_opacity),u_color:new T.UniformColor(h,d.u_color)}},backgroundPattern:function(h,d){return{u_matrix:new T.UniformMatrix4f(h,d.u_matrix),u_opacity:new T.Uniform1f(h,d.u_opacity),u_image:new T.Uniform1i(h,d.u_image),u_pattern_tl_a:new T.Uniform2f(h,d.u_pattern_tl_a),u_pattern_br_a:new T.Uniform2f(h,d.u_pattern_br_a),u_pattern_tl_b:new T.Uniform2f(h,d.u_pattern_tl_b),u_pattern_br_b:new T.Uniform2f(h,d.u_pattern_br_b),u_texsize:new T.Uniform2f(h,d.u_texsize),u_mix:new T.Uniform1f(h,d.u_mix),u_pattern_size_a:new T.Uniform2f(h,d.u_pattern_size_a),u_pattern_size_b:new T.Uniform2f(h,d.u_pattern_size_b),u_scale_a:new T.Uniform1f(h,d.u_scale_a),u_scale_b:new T.Uniform1f(h,d.u_scale_b),u_pixel_coord_upper:new T.Uniform2f(h,d.u_pixel_coord_upper),u_pixel_coord_lower:new T.Uniform2f(h,d.u_pixel_coord_lower),u_tile_units_to_pixels:new T.Uniform1f(h,d.u_tile_units_to_pixels)}}};function Sl(h,d,p,y,I,P,D,O){for(var G=h.context,Q=G.gl,oe=I?h.useProgram("collisionCircle"):h.useProgram("collisionBox"),_e=0;_e<y.length;_e++){var Se=y[_e],Te=d.getTile(Se),ge=Te.getBucket(p);if(ge){var be=I?O?ge.textCollisionCircle:ge.iconCollisionCircle:O?ge.textCollisionBox:ge.iconCollisionBox;if(be){var We=Se.posMatrix;P[0]===0&&P[1]===0||(We=h.translatePosMatrix(Se.posMatrix,Te,P,D)),oe.draw(G,I?Q.TRIANGLES:Q.LINES,vt.disabled,Pt.disabled,h.colorModeForRenderPass(),mi.disabled,ju(We,h.transform,Te),p.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,h.transform.zoom,null,null,be.collisionVertexBuffer)}}}}function Il(h,d,p,y,I,P,D){Sl(h,d,p,y,!1,I,P,D),Sl(h,d,p,y,!0,I,P,D)}var du=T.identity(new Float32Array(16));function Al(h,d,p,y,I,P){var D=T.getAnchorAlignment(h),O=-(D.horizontalAlign-.5)*d,G=-(D.verticalAlign-.5)*p,Q=T.evaluateVariableOffset(h,y);return new T.Point((O/I+Q[0])*P,(G/I+Q[1])*P)}function qc(h,d,p,y,I,P,D,O,G,Q,oe){var _e=h.text.placedSymbolArray,Se=h.text.dynamicLayoutVertexArray,Te=h.icon.dynamicLayoutVertexArray,ge={};Se.clear();for(var be=0;be<_e.length;be++){var We=_e.get(be),Ne=h.allowVerticalPlacement&&!We.placedOrientation,et=We.hidden||!We.crossTileID||Ne?null:y[We.crossTileID];if(et){var Je=new T.Point(We.anchorX,We.anchorY),ot=Ji(Je,p?O:D),gt=.5+P.cameraToCenterDistance/ot.signedDistanceFromCamera*.5,Ct=I.evaluateSizeForFeature(h.textSizeData,Q,We)*gt/T.ONE_EM;p&&(Ct*=h.tilePixelRatio/G);for(var Vt=et.width,fi=et.height,ei=Al(et.anchor,Vt,fi,et.textOffset,et.textBoxScale,Ct),ni=p?Ji(Je.add(ei),D).point:ot.point.add(d?ei.rotate(-P.angle):ei),Nt=h.allowVerticalPlacement&&We.placedOrientation===T.WritingMode.vertical?Math.PI/2:0,Hi=0;Hi<We.numGlyphs;Hi++)T.addDynamicAttributes(Se,ni,Nt);oe&&We.associatedIconIndex>=0&&(ge[We.associatedIconIndex]={shiftedAnchor:ni,angle:Nt})}else dr(We.numGlyphs,Se)}if(oe){Te.clear();for(var Ii=h.icon.placedSymbolArray,Vi=0;Vi<Ii.length;Vi++){var Ni=Ii.get(Vi);if(Ni.hidden)dr(Ni.numGlyphs,Te);else{var Pi=ge[Vi];if(Pi)for(var ji=0;ji<Ni.numGlyphs;ji++)T.addDynamicAttributes(Te,Pi.shiftedAnchor,Pi.angle);else dr(Ni.numGlyphs,Te)}}h.icon.dynamicLayoutVertexBuffer.updateData(Te)}h.text.dynamicLayoutVertexBuffer.updateData(Se)}function vs(h,d,p){return p.iconsInText&&d?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function xc(h,d,p,y,I,P,D,O,G,Q,oe,_e){for(var Se,Te,ge=h.context,be=ge.gl,We=h.transform,Ne=O==="map",et=G==="map",Je=Ne&&p.layout.get("symbol-placement")!=="point",ot=Ne&&!et&&!Je,gt=p.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ct=h.depthModeForSublayer(0,vt.ReadOnly),Vt=p.layout.get("text-variable-anchor"),fi=[],ei=0,ni=y;ei<ni.length;ei+=1){var Nt=ni[ei],Hi=d.getTile(Nt),Ii=Hi.getBucket(p);if(Ii){var Vi=I?Ii.text:Ii.icon;if(Vi&&Vi.segments.get().length){var Ni=Vi.programConfigurations.get(p.id),Pi=I||Ii.sdfIcons,ji=I?Ii.textSizeData:Ii.iconSizeData,Dr=et||We.pitch!==0;Se||(Se=h.useProgram(vs(Pi,I,Ii),Ni),Te=T.evaluateSizeForZoom(ji,We.zoom));var Ri=void 0,gr=[0,0],fr=void 0,xr=void 0,Ft=null,Vn=void 0;if(I){if(fr=Hi.glyphAtlasTexture,xr=be.LINEAR,Ri=Hi.glyphAtlasTexture.size,Ii.iconsInText){gr=Hi.imageAtlasTexture.size,Ft=Hi.imageAtlasTexture;var Cn=ji.kind==="composite"||ji.kind==="camera";Vn=Dr||h.options.rotating||h.options.zooming||Cn?be.LINEAR:be.NEAREST}}else{var Fo=p.layout.get("icon-size").constantOr(0)!==1||Ii.iconsNeedLinear;fr=Hi.imageAtlasTexture,xr=Pi||h.options.rotating||h.options.zooming||Fo||Dr?be.LINEAR:be.NEAREST,Ri=Hi.imageAtlasTexture.size}var Lr=Rt(Hi,1,h.transform.zoom),$t=Ti(Nt.posMatrix,et,Ne,h.transform,Lr),qs=zi(Nt.posMatrix,et,Ne,h.transform,Lr),tc=Vt&&Ii.hasTextData(),ha=p.layout.get("icon-text-fit")!=="none"&&tc&&Ii.hasIconData();Je&&zr(Ii,Nt.posMatrix,h,I,$t,qs,et,Q);var ul=h.translatePosMatrix(Nt.posMatrix,Hi,P,D),ic=Je||I&&Vt||ha?du:$t,rs=h.translatePosMatrix(qs,Hi,P,D,!0),Wc=Pi&&p.paint.get(I?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ic={program:Se,buffers:Vi,uniformValues:Pi?Ii.iconsInText?hu(ji.kind,Te,ot,et,h,ul,ic,rs,Ri,gr):vc(ji.kind,Te,ot,et,h,ul,ic,rs,I,Ri,!0):Hl(ji.kind,Te,ot,et,h,ul,ic,rs,I,Ri),atlasTexture:fr,atlasTextureIcon:Ft,atlasInterpolation:xr,atlasInterpolationIcon:Vn,isSDF:Pi,hasHalo:Wc};if(gt)for(var ws=0,Ba=Vi.segments.get();ws<Ba.length;ws+=1){var Ac=Ba[ws];fi.push({segments:new T.SegmentVector([Ac]),sortKey:Ac.sortKey,state:Ic})}else fi.push({segments:Vi.segments,sortKey:0,state:Ic})}}}gt&&fi.sort(function(x,E){return x.sortKey-E.sortKey});for(var Fa=0,m=fi;Fa<m.length;Fa+=1){var n=m[Fa],l=n.state;if(ge.activeTexture.set(be.TEXTURE0),l.atlasTexture.bind(l.atlasInterpolation,be.CLAMP_TO_EDGE),l.atlasTextureIcon&&(ge.activeTexture.set(be.TEXTURE1),l.atlasTextureIcon&&l.atlasTextureIcon.bind(l.atlasInterpolationIcon,be.CLAMP_TO_EDGE)),l.isSDF){var g=l.uniformValues;l.hasHalo&&(g.u_is_halo=1,Gc(l.buffers,n.segments,p,h,l.program,Ct,oe,_e,g)),g.u_is_halo=0}Gc(l.buffers,n.segments,p,h,l.program,Ct,oe,_e,l.uniformValues)}}function Gc(h,d,p,y,I,P,D,O,G){var Q=y.context,oe=Q.gl;I.draw(Q,oe.TRIANGLES,P,D,O,mi.disabled,G,p.id,h.layoutVertexBuffer,h.indexBuffer,d,p.paint,y.transform.zoom,h.programConfigurations.get(p.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function bc(h,d,p,y,I,P,D){var O,G,Q,oe,_e,Se=h.context.gl,Te=p.paint.get("fill-pattern"),ge=Te&&Te.constantOr(1),be=p.getCrossfadeParameters();D?(G=ge&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=Se.LINES):(G=ge?"fillPattern":"fill",O=Se.TRIANGLES);for(var We=0,Ne=y;We<Ne.length;We+=1){var et=Ne[We],Je=d.getTile(et);if(!ge||Je.patternsLoaded()){var ot=Je.getBucket(p);if(ot){var gt=ot.programConfigurations.get(p.id),Ct=h.useProgram(G,gt);ge&&(h.context.activeTexture.set(Se.TEXTURE0),Je.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),gt.updatePaintBuffers(be));var Vt=Te.constantOr(null);if(Vt&&Je.imageAtlas){var fi=Je.imageAtlas,ei=fi.patternPositions[Vt.to.toString()],ni=fi.patternPositions[Vt.from.toString()];ei&&ni&&gt.setConstantPatternPositions(ei,ni)}var Nt=h.translatePosMatrix(et.posMatrix,Je,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(D){oe=ot.indexBuffer2,_e=ot.segments2;var Hi=[Se.drawingBufferWidth,Se.drawingBufferHeight];Q=G==="fillOutlinePattern"&&ge?Wl(Nt,h,be,Je,Hi):Pr(Nt,Hi)}else oe=ot.indexBuffer,_e=ot.segments,Q=ge?Ya(Nt,h,be,Je):wl(Nt);Ct.draw(h.context,O,I,h.stencilModeForClipping(et),P,mi.disabled,Q,p.id,ot.layoutVertexBuffer,oe,_e,p.paint,h.transform.zoom,gt)}}}}function sl(h,d,p,y,I,P,D){for(var O=h.context,G=O.gl,Q=p.paint.get("fill-extrusion-pattern"),oe=Q.constantOr(1),_e=p.getCrossfadeParameters(),Se=p.paint.get("fill-extrusion-opacity"),Te=0,ge=y;Te<ge.length;Te+=1){var be=ge[Te],We=d.getTile(be),Ne=We.getBucket(p);if(Ne){var et=Ne.programConfigurations.get(p.id),Je=h.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",et);oe&&(h.context.activeTexture.set(G.TEXTURE0),We.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),et.updatePaintBuffers(_e));var ot=Q.constantOr(null);if(ot&&We.imageAtlas){var gt=We.imageAtlas,Ct=gt.patternPositions[ot.to.toString()],Vt=gt.patternPositions[ot.from.toString()];Ct&&Vt&&et.setConstantPatternPositions(Ct,Vt)}var fi=h.translatePosMatrix(be.posMatrix,We,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),ei=p.paint.get("fill-extrusion-vertical-gradient"),ni=oe?al(fi,h,ei,Se,be,_e,We):Ka(fi,h,ei,Se);Je.draw(O,O.gl.TRIANGLES,I,P,D,mi.backCCW,ni,p.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,p.paint,h.transform.zoom,et)}}}function fu(h,d,p,y,I,P){var D=h.context,O=D.gl,G=d.fbo;if(G){var Q=h.useProgram("hillshade");D.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,G.colorAttachment.get());var oe=Tr(h,d,p);Q.draw(D,O.TRIANGLES,y,I,P,mi.disabled,oe,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}}function xh(h,d,p,y,I,P,D){var O=h.context,G=O.gl,Q=d.dem;if(Q&&Q.data){var oe=Q.dim,_e=Q.stride,Se=Q.getPixels();if(O.activeTexture.set(G.TEXTURE1),O.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||h.getTileTexture(_e),d.demTexture){var Te=d.demTexture;Te.update(Se,{premultiply:!1}),Te.bind(G.NEAREST,G.CLAMP_TO_EDGE)}else d.demTexture=new T.Texture(O,Se,G.RGBA,{premultiply:!1}),d.demTexture.bind(G.NEAREST,G.CLAMP_TO_EDGE);O.activeTexture.set(G.TEXTURE0);var ge=d.fbo;if(!ge){var be=new T.Texture(O,{width:oe,height:oe,data:null},G.RGBA);be.bind(G.LINEAR,G.CLAMP_TO_EDGE),(ge=d.fbo=O.createFramebuffer(oe,oe)).colorAttachment.set(be.texture)}O.bindFramebuffer.set(ge.framebuffer),O.viewport.set([0,0,oe,oe]),h.useProgram("hillshadePrepare").draw(O,G.TRIANGLES,I,P,D,mi.disabled,Tl(d.tileID,Q,y),p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function mu(h,d,p,y,I){var P=y.paint.get("raster-fade-duration");if(P>0){var D=T.browser.now(),O=(D-h.timeAdded)/P,G=d?(D-d.timeAdded)/P:-1,Q=p.getSource(),oe=I.coveringZoomLevel({tileSize:Q.tileSize,roundZoom:Q.roundZoom}),_e=!d||Math.abs(d.tileID.overscaledZ-oe)>Math.abs(h.tileID.overscaledZ-oe),Se=_e&&h.refreshedUponExpiration?1:T.clamp(_e?O:1-G,0,1);return h.refreshedUponExpiration&&O>=1&&(h.refreshedUponExpiration=!1),d?{opacity:1,mix:1-Se}:{opacity:Se,mix:0}}return{opacity:1,mix:0}}function Zc(h,d,p){var y=h.context,I=y.gl,P=p.posMatrix,D=h.useProgram("debug"),O=vt.disabled,G=Pt.disabled,Q=h.colorModeForRenderPass(),oe="$debug";D.draw(y,I.LINE_STRIP,O,G,Q,mi.disabled,Nc(P,T.Color.red),oe,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);var _e=d.getTileByID(p.key).latestRawTileData,Se=_e&&_e.byteLength||0,Te=Math.floor(Se/1024),ge=d.getTile(p).tileSize,be=512/Math.min(ge,512),We=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(We+=" => "+p.overscaledZ);for(var Ne=function(Vi,Ni,Pi,ji){ji=ji||1;var Dr,Ri,gr,fr,xr,Ft,Vn,Cn,Fo=[];for(Dr=0,Ri=Vi.length;Dr<Ri;Dr++)if(xr=la[Vi[Dr]]){for(Cn=null,gr=0,fr=xr[1].length;gr<fr;gr+=2)xr[1][gr]===-1&&xr[1][gr+1]===-1?Cn=null:(Ft=Ni+xr[1][gr]*ji,Vn=Pi-xr[1][gr+1]*ji,Cn&&Fo.push(Cn.x,Cn.y,Ft,Vn),Cn={x:Ft,y:Vn});Ni+=xr[0]*ji}return Fo}(We+" "+Te+"kb",50,200*be,5*be),et=new T.StructArrayLayout2i4,Je=new T.StructArrayLayout2ui4,ot=0;ot<Ne.length;ot+=2)et.emplaceBack(Ne[ot],Ne[ot+1]),Je.emplaceBack(ot,ot+1);for(var gt=y.createVertexBuffer(et,xl.members),Ct=y.createIndexBuffer(Je),Vt=T.SegmentVector.simpleSegment(0,0,et.length/2,et.length/2),fi=T.EXTENT/(Math.pow(2,h.transform.zoom-p.overscaledZ)*ge*be),ei=[],ni=-1;ni<=1;ni++)for(var Nt=-1;Nt<=1&&(ni!==0||Nt!==0);Nt++)ei.push([ni,Nt]);for(var Hi=0;Hi<ei.length;Hi++){var Ii=ei[Hi];D.draw(y,I.LINES,O,G,Q,mi.disabled,Nc(T.translate([],P,[fi*Ii[0],fi*Ii[1],0]),T.Color.white),oe,gt,Ct,Vt)}D.draw(y,I.LINES,O,G,Q,mi.disabled,Nc(P,T.Color.black),oe,gt,Ct,Vt),gt.destroy(),Ct.destroy(),Vt.destroy()}var la={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]},Xu={symbol:function(h,d,p,y,I){if(h.renderPass==="translucent"){var P=Pt.disabled,D=h.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(O,G,Q,oe,_e,Se,Te){for(var ge=G.transform,be=_e==="map",We=Se==="map",Ne=0,et=O;Ne<et.length;Ne+=1){var Je=et[Ne],ot=oe.getTile(Je),gt=ot.getBucket(Q);if(gt&&gt.text&&gt.text.segments.get().length){var Ct=gt.textSizeData,Vt=T.evaluateSizeForZoom(Ct,ge.zoom),fi=Rt(ot,1,G.transform.zoom),ei=Ti(Je.posMatrix,We,be,G.transform,fi),ni=Q.layout.get("icon-text-fit")!=="none"&&gt.hasIconData();if(Vt){var Nt=Math.pow(2,ge.zoom-ot.tileID.overscaledZ);qc(gt,be,We,Te,T.symbolSize,ge,ei,Je.posMatrix,Nt,Vt,ni)}}}}(y,h,p,d,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),I),p.paint.get("icon-opacity").constantOr(1)!==0&&xc(h,d,p,y,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),P,D),p.paint.get("text-opacity").constantOr(1)!==0&&xc(h,d,p,y,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),P,D),d.map.showCollisionBoxes&&(Il(h,d,p,y,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),Il(h,d,p,y,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))}},circle:function(h,d,p,y){if(h.renderPass==="translucent"){var I=p.paint.get("circle-opacity"),P=p.paint.get("circle-stroke-width"),D=p.paint.get("circle-stroke-opacity"),O=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(I.constantOr(1)!==0||P.constantOr(1)!==0&&D.constantOr(1)!==0){for(var G=h.context,Q=G.gl,oe=h.depthModeForSublayer(0,vt.ReadOnly),_e=Pt.disabled,Se=h.colorModeForRenderPass(),Te=[],ge=0;ge<y.length;ge++){var be=y[ge],We=d.getTile(be),Ne=We.getBucket(p);if(Ne){var et=Ne.programConfigurations.get(p.id),Je={programConfiguration:et,program:h.useProgram("circle",et),layoutVertexBuffer:Ne.layoutVertexBuffer,indexBuffer:Ne.indexBuffer,uniformValues:gh(h,be,We,p)};if(O)for(var ot=0,gt=Ne.segments.get();ot<gt.length;ot+=1){var Ct=gt[ot];Te.push({segments:new T.SegmentVector([Ct]),sortKey:Ct.sortKey,state:Je})}else Te.push({segments:Ne.segments,sortKey:0,state:Je})}}O&&Te.sort(function(ji,Dr){return ji.sortKey-Dr.sortKey});for(var Vt=0,fi=Te;Vt<fi.length;Vt+=1){var ei=fi[Vt],ni=ei.state,Nt=ni.programConfiguration,Hi=ni.program,Ii=ni.layoutVertexBuffer,Vi=ni.indexBuffer,Ni=ni.uniformValues,Pi=ei.segments;Hi.draw(G,Q.TRIANGLES,oe,_e,Se,mi.disabled,Ni,p.id,Ii,Vi,Pi,p.paint,h.transform.zoom,Nt)}}}},heatmap:function(h,d,p,y){if(p.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){var I=h.context,P=I.gl,D=h.depthModeForSublayer(0,vt.ReadOnly),O=Pt.disabled,G=new Et([P.ONE,P.ONE],T.Color.transparent,[!0,!0,!0,!0]);(function(We,Ne,et){var Je=We.gl;We.activeTexture.set(Je.TEXTURE1),We.viewport.set([0,0,Ne.width/4,Ne.height/4]);var ot=et.heatmapFbo;if(ot)Je.bindTexture(Je.TEXTURE_2D,ot.colorAttachment.get()),We.bindFramebuffer.set(ot.framebuffer);else{var gt=Je.createTexture();Je.bindTexture(Je.TEXTURE_2D,gt),Je.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_WRAP_S,Je.CLAMP_TO_EDGE),Je.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_WRAP_T,Je.CLAMP_TO_EDGE),Je.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_MIN_FILTER,Je.LINEAR),Je.texParameteri(Je.TEXTURE_2D,Je.TEXTURE_MAG_FILTER,Je.LINEAR),ot=et.heatmapFbo=We.createFramebuffer(Ne.width/4,Ne.height/4),function Ct(Vt,fi,ei,ni){var Nt=Vt.gl;Nt.texImage2D(Nt.TEXTURE_2D,0,Nt.RGBA,fi.width/4,fi.height/4,0,Nt.RGBA,Vt.extTextureHalfFloat?Vt.extTextureHalfFloat.HALF_FLOAT_OES:Nt.UNSIGNED_BYTE,null),ni.colorAttachment.set(ei),Vt.extTextureHalfFloat&&Nt.checkFramebufferStatus(Nt.FRAMEBUFFER)!==Nt.FRAMEBUFFER_COMPLETE&&(Vt.extTextureHalfFloat=null,ni.colorAttachment.setDirty(),Ct(Vt,fi,ei,ni))}(We,Ne,gt,ot)}})(I,h,p),I.clear({color:T.Color.transparent});for(var Q=0;Q<y.length;Q++){var oe=y[Q];if(!d.hasRenderableParent(oe)){var _e=d.getTile(oe),Se=_e.getBucket(p);if(Se){var Te=Se.programConfigurations.get(p.id),ge=h.useProgram("heatmap",Te),be=h.transform.zoom;ge.draw(I,P.TRIANGLES,D,O,G,mi.disabled,uu(oe.posMatrix,_e,be,p.paint.get("heatmap-intensity")),p.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,p.paint,h.transform.zoom,Te)}}}I.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(We,Ne){var et=We.context,Je=et.gl,ot=Ne.heatmapFbo;if(ot){et.activeTexture.set(Je.TEXTURE0),Je.bindTexture(Je.TEXTURE_2D,ot.colorAttachment.get()),et.activeTexture.set(Je.TEXTURE1);var gt=Ne.colorRampTexture;gt||(gt=Ne.colorRampTexture=new T.Texture(et,Ne.colorRamp,Je.RGBA)),gt.bind(Je.LINEAR,Je.CLAMP_TO_EDGE),We.useProgram("heatmapTexture").draw(et,Je.TRIANGLES,vt.disabled,Pt.disabled,We.colorModeForRenderPass(),mi.disabled,$l(We,Ne,0,1),Ne.id,We.viewportBuffer,We.quadTriangleIndexBuffer,We.viewportSegments,Ne.paint,We.transform.zoom)}}(h,p))},line:function(h,d,p,y){if(h.renderPass==="translucent"){var I=p.paint.get("line-opacity"),P=p.paint.get("line-width");if(I.constantOr(1)!==0&&P.constantOr(1)!==0){var D=h.depthModeForSublayer(0,vt.ReadOnly),O=h.colorModeForRenderPass(),G=p.paint.get("line-dasharray"),Q=p.paint.get("line-pattern"),oe=Q.constantOr(1),_e=p.paint.get("line-gradient"),Se=p.getCrossfadeParameters(),Te=oe?"linePattern":G?"lineSDF":_e?"lineGradient":"line",ge=h.context,be=ge.gl,We=!0;if(_e){ge.activeTexture.set(be.TEXTURE0);var Ne=p.gradientTexture;if(!p.gradient)return;Ne||(Ne=p.gradientTexture=new T.Texture(ge,p.gradient,be.RGBA)),Ne.bind(be.LINEAR,be.CLAMP_TO_EDGE)}for(var et=0,Je=y;et<Je.length;et+=1){var ot=Je[et],gt=d.getTile(ot);if(!oe||gt.patternsLoaded()){var Ct=gt.getBucket(p);if(Ct){var Vt=Ct.programConfigurations.get(p.id),fi=h.context.program.get(),ei=h.useProgram(Te,Vt),ni=We||ei.program!==fi,Nt=Q.constantOr(null);if(Nt&&gt.imageAtlas){var Hi=gt.imageAtlas,Ii=Hi.patternPositions[Nt.to.toString()],Vi=Hi.patternPositions[Nt.from.toString()];Ii&&Vi&&Vt.setConstantPatternPositions(Ii,Vi)}var Ni=oe?ys(h,gt,p,Se):G?Da(h,gt,p,G,Se):_e?qu(h,gt,p):Ns(h,gt,p);oe?(ge.activeTexture.set(be.TEXTURE0),gt.imageAtlasTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Vt.updatePaintBuffers(Se)):G&&(ni||h.lineAtlas.dirty)&&(ge.activeTexture.set(be.TEXTURE0),h.lineAtlas.bind(ge)),ei.draw(ge,be.TRIANGLES,D,h.stencilModeForClipping(ot),O,mi.disabled,Ni,p.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,p.paint,h.transform.zoom,Vt),We=!1}}}}}},fill:function(h,d,p,y){var I=p.paint.get("fill-color"),P=p.paint.get("fill-opacity");if(P.constantOr(1)!==0){var D=h.colorModeForRenderPass(),O=p.paint.get("fill-pattern"),G=h.opaquePassEnabledForLayer()&&!O.constantOr(1)&&I.constantOr(T.Color.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===G){var Q=h.depthModeForSublayer(1,h.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);bc(h,d,p,y,Q,D,!1)}if(h.renderPass==="translucent"&&p.paint.get("fill-antialias")){var oe=h.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);bc(h,d,p,y,oe,D,!0)}}},"fill-extrusion":function(h,d,p,y){var I=p.paint.get("fill-extrusion-opacity");if(I!==0&&h.renderPass==="translucent"){var P=new vt(h.context.gl.LEQUAL,vt.ReadWrite,h.depthRangeFor3D);if(I!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))sl(h,d,p,y,P,Pt.disabled,Et.disabled),sl(h,d,p,y,P,h.stencilModeFor3D(),h.colorModeForRenderPass());else{var D=h.colorModeForRenderPass();sl(h,d,p,y,P,Pt.disabled,D)}}},hillshade:function(h,d,p,y){if(h.renderPass==="offscreen"||h.renderPass==="translucent"){for(var I=h.context,P=d.getSource().maxzoom,D=h.depthModeForSublayer(0,vt.ReadOnly),O=h.colorModeForRenderPass(),G=h.renderPass==="translucent"?h.stencilConfigForOverlap(y):[{},y],Q=G[0],oe=0,_e=G[1];oe<_e.length;oe+=1){var Se=_e[oe],Te=d.getTile(Se);Te.needsHillshadePrepare&&h.renderPass==="offscreen"?xh(h,Te,p,P,D,Pt.disabled,O):h.renderPass==="translucent"&&fu(h,Te,p,D,Q[Se.overscaledZ],O)}I.viewport.set([0,0,h.width,h.height])}},raster:function(h,d,p,y){if(h.renderPass==="translucent"&&p.paint.get("raster-opacity")!==0&&y.length)for(var I=h.context,P=I.gl,D=d.getSource(),O=h.useProgram("raster"),G=h.colorModeForRenderPass(),Q=D instanceof hn?[{},y]:h.stencilConfigForOverlap(y),oe=Q[0],_e=Q[1],Se=_e[_e.length-1].overscaledZ,Te=!h.options.moving,ge=0,be=_e;ge<be.length;ge+=1){var We=be[ge],Ne=h.depthModeForSublayer(We.overscaledZ-Se,p.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,P.LESS),et=d.getTile(We),Je=h.transform.calculatePosMatrix(We.toUnwrapped(),Te);et.registerFadeDuration(p.paint.get("raster-fade-duration"));var ot=d.findLoadedParent(We,0),gt=mu(et,ot,d,p,h.transform),Ct=void 0,Vt=void 0,fi=p.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;I.activeTexture.set(P.TEXTURE0),et.texture.bind(fi,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(P.TEXTURE1),ot?(ot.texture.bind(fi,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Ct=Math.pow(2,ot.tileID.overscaledZ-et.tileID.overscaledZ),Vt=[et.tileID.canonical.x*Ct%1,et.tileID.canonical.y*Ct%1]):et.texture.bind(fi,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);var ei=yh(Je,Vt||[0,0],Ct||1,gt,p);D instanceof hn?O.draw(I,P.TRIANGLES,Ne,Pt.disabled,G,mi.disabled,ei,p.id,D.boundsBuffer,h.quadTriangleIndexBuffer,D.boundsSegments):O.draw(I,P.TRIANGLES,Ne,oe[We.overscaledZ],G,mi.disabled,ei,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,d,p){var y=p.paint.get("background-color"),I=p.paint.get("background-opacity");if(I!==0){var P=h.context,D=P.gl,O=h.transform,G=O.tileSize,Q=p.paint.get("background-pattern");if(!h.isPatternMissing(Q)){var oe=!Q&&y.a===1&&I===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass===oe){var _e=Pt.disabled,Se=h.depthModeForSublayer(0,oe==="opaque"?vt.ReadWrite:vt.ReadOnly),Te=h.colorModeForRenderPass(),ge=h.useProgram(Q?"backgroundPattern":"background"),be=O.coveringTiles({tileSize:G});Q&&(P.activeTexture.set(D.TEXTURE0),h.imageManager.bind(h.context));for(var We=p.getCrossfadeParameters(),Ne=0,et=be;Ne<et.length;Ne+=1){var Je=et[Ne],ot=h.transform.calculatePosMatrix(Je.toUnwrapped()),gt=Q?vh(ot,I,h,Q,{tileID:Je,tileSize:G},We):jc(ot,I,y);ge.draw(P,D.TRIANGLES,Se,_e,Te,mi.disabled,gt,p.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}}}},debug:function(h,d,p){for(var y=0;y<p.length;y++)Zc(h,d,p[y])},custom:function(h,d,p){var y=h.context,I=p.implementation;if(h.renderPass==="offscreen"){var P=I.prerender;P&&(h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),P.call(I,y.gl,h.transform.customLayerMatrix()),y.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),y.setStencilMode(Pt.disabled);var D=I.renderingMode==="3d"?new vt(h.context.gl.LEQUAL,vt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,vt.ReadOnly);y.setDepthMode(D),I.render(y.gl,h.transform.customLayerMatrix()),y.setDirty(),h.setBaseState(),y.bindFramebuffer.set(null)}}},Ur=function(h,d){this.context=new Li(h),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=li.maxUnderzooming+li.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.crossTileSymbolIndex=new Lo,this.gpuTimers={}};Ur.prototype.resize=function(h,d){var p=this.context.gl;if(this.width=h*T.browser.devicePixelRatio,this.height=d*T.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var y=0,I=this.style._order;y<I.length;y+=1){var P=I[y];this.style._layers[P].resize()}this.depthRbo&&(p.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},Ur.prototype.setup=function(){var h=this.context,d=new T.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(T.EXTENT,0),d.emplaceBack(0,T.EXTENT),d.emplaceBack(T.EXTENT,T.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(d,xl.members),this.tileExtentSegments=T.SegmentVector.simpleSegment(0,0,4,2);var p=new T.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(T.EXTENT,0),p.emplaceBack(0,T.EXTENT),p.emplaceBack(T.EXTENT,T.EXTENT),this.debugBuffer=h.createVertexBuffer(p,xl.members),this.debugSegments=T.SegmentVector.simpleSegment(0,0,4,5);var y=new T.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(T.EXTENT,0,T.EXTENT,0),y.emplaceBack(0,T.EXTENT,0,T.EXTENT),y.emplaceBack(T.EXTENT,T.EXTENT,T.EXTENT,T.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(y,tn.members),this.rasterBoundsSegments=T.SegmentVector.simpleSegment(0,0,4,2);var I=new T.StructArrayLayout2i4;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(I,xl.members),this.viewportSegments=T.SegmentVector.simpleSegment(0,0,4,2);var P=new T.StructArrayLayout1ui2;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(P);var D=new T.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(D);var O=this.context.gl;this.stencilClearMode=new Pt({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO)},Ur.prototype.clearStencil=function(){var h=this.context,d=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var p=T.create();T.ortho(p,0,this.width,this.height,0,0,1),T.scale(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,d.TRIANGLES,vt.disabled,this.stencilClearMode,Et.disabled,mi.disabled,gc(p),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ur.prototype._renderTileClippingMasks=function(h,d){if(this.currentStencilSource!==h.source&&h.isTileClipped()&&d&&d.length){this.currentStencilSource=h.source;var p=this.context,y=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(Et.disabled),p.setDepthMode(vt.disabled);var I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var P=0,D=d;P<D.length;P+=1){var O=D[P],G=this._tileClippingMaskIDs[O.key]=this.nextStencilID++;I.draw(p,y.TRIANGLES,vt.disabled,new Pt({func:y.ALWAYS,mask:0},G,255,y.KEEP,y.KEEP,y.REPLACE),Et.disabled,mi.disabled,gc(O.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ur.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var h=this.nextStencilID++,d=this.context.gl;return new Pt({func:d.NOTEQUAL,mask:255},h,255,d.KEEP,d.KEEP,d.REPLACE)},Ur.prototype.stencilModeForClipping=function(h){var d=this.context.gl;return new Pt({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,d.KEEP,d.KEEP,d.REPLACE)},Ur.prototype.stencilConfigForOverlap=function(h){var d,p=this.context.gl,y=h.sort(function(G,Q){return Q.overscaledZ-G.overscaledZ}),I=y[y.length-1].overscaledZ,P=y[0].overscaledZ-I+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();for(var D={},O=0;O<P;O++)D[O+I]=new Pt({func:p.GEQUAL,mask:255},O+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=P,[D,y]}return[(d={},d[I]=Pt.disabled,d),y]},Ur.prototype.colorModeForRenderPass=function(){var h=this.context.gl;return this._showOverdrawInspector?new Et([h.CONSTANT_COLOR,h.ONE],new T.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Et.unblended:Et.alphaBlended},Ur.prototype.depthModeForSublayer=function(h,d,p){if(!this.opaquePassEnabledForLayer())return vt.disabled;var y=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new vt(p||this.context.gl.LEQUAL,d,[y,y])},Ur.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ur.prototype.render=function(h,d){var p=this;this.style=h,this.options=d,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(T.browser.now()),this.imageManager.beginFrame();var y=this.style._order,I=this.style.sourceCaches;for(var P in I){var D=I[P];D.used&&D.prepare(this.context)}var O,G,Q={},oe={},_e={};for(var Se in I){var Te=I[Se];Q[Se]=Te.getVisibleCoordinates(),oe[Se]=Q[Se].slice().reverse(),_e[Se]=Te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var ge=0;ge<y.length;ge++){var be=y[ge];if(this.style._layers[be].is3D()){this.opaquePassCutoff=ge;break}}this.renderPass="offscreen",this.depthRboNeedsClear=!0;for(var We=0,Ne=y;We<Ne.length;We+=1){var et=Ne[We],Je=this.style._layers[et];if(Je.hasOffscreenPass()&&!Je.isHidden(this.transform.zoom)){var ot=oe[Je.source];(Je.type==="custom"||ot.length)&&this.renderLayer(this,I[Je.source],Je,ot)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?T.Color.black:T.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){var gt=this.style._layers[y[this.currentLayer]],Ct=I[gt.source],Vt=Q[gt.source];this._renderTileClippingMasks(gt,Vt),this.renderLayer(this,Ct,gt,Vt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){var fi=this.style._layers[y[this.currentLayer]],ei=I[fi.source],ni=(fi.type==="symbol"?_e:oe)[fi.source];this._renderTileClippingMasks(fi,Q[fi.source]),this.renderLayer(this,ei,fi,ni)}this.options.showTileBoundaries&&(T.values(this.style._layers).forEach(function(Nt){Nt.source&&!Nt.isHidden(p.transform.zoom)&&(Nt.source!==(G&&G.id)&&(G=p.style.sourceCaches[Nt.source]),(!O||O.getSource().maxzoom<G.getSource().maxzoom)&&(O=G))}),O&&Xu.debug(this,O,O.getVisibleCoordinates())),this.context.setDefault()},Ur.prototype.setupOffscreenDepthRenderbuffer=function(){var h=this.context;this.depthRbo||(this.depthRbo=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,this.width,this.height))},Ur.prototype.renderLayer=function(h,d,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||y.length)&&(this.id=p.id,this.gpuTimingStart(p),Xu[p.type](h,d,p,y,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ur.prototype.gpuTimingStart=function(h){if(this.options.gpuTiming){var d=this.context.extTimerQuery,p=this.gpuTimers[h.id];p||(p=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),p.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,p.query)}},Ur.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}},Ur.prototype.collectGpuTimers=function(){var h=this.gpuTimers;return this.gpuTimers={},h},Ur.prototype.queryGpuTimers=function(h){var d={};for(var p in h){var y=h[p],I=this.context.extTimerQuery,P=I.getQueryObjectEXT(y.query,I.QUERY_RESULT_EXT)/1e6;I.deleteQueryEXT(y.query),d[p]=P}return d},Ur.prototype.translatePosMatrix=function(h,d,p,y,I){if(!p[0]&&!p[1])return h;var P=I?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(P){var D=Math.sin(P),O=Math.cos(P);p=[p[0]*O-p[1]*D,p[0]*D+p[1]*O]}var G=[I?p[0]:Rt(d,p[0],this.transform.zoom),I?p[1]:Rt(d,p[1],this.transform.zoom),0],Q=new Float32Array(16);return T.translate(Q,h,G),Q},Ur.prototype.saveTileTexture=function(h){var d=this._tileTextures[h.size[0]];d?d.push(h):this._tileTextures[h.size[0]]=[h]},Ur.prototype.getTileTexture=function(h){var d=this._tileTextures[h];return d&&d.length>0?d.pop():null},Ur.prototype.isPatternMissing=function(h){if(!h)return!1;var d=this.imageManager.getPattern(h.from.toString()),p=this.imageManager.getPattern(h.to.toString());return!d||!p},Ur.prototype.useProgram=function(h,d){this.cache=this.cache||{};var p=""+h+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[p]||(this.cache[p]=new ol(this.context,Nu[h],d,pu[h],this._showOverdrawInspector)),this.cache[p]},Ur.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ur.prototype.setBaseState=function(){var h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)};var _u=function(h,d){this.points=h,this.planes=d};_u.fromInvProjectionMatrix=function(h,d,p){var y=Math.pow(2,p),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(D){return T.transformMat4([],D,h)}).map(function(D){return T.scale$1([],D,1/D[3]/d*y)}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(D){var O=T.sub([],I[D[0]],I[D[1]]),G=T.sub([],I[D[2]],I[D[1]]),Q=T.normalize([],T.cross([],O,G)),oe=-T.dot(Q,I[D[1]]);return Q.concat(oe)});return new _u(I,P)};var La=function(h,d){this.min=h,this.max=d,this.center=T.scale$2([],T.add([],this.min,this.max),.5)};La.prototype.quadrant=function(h){for(var d=[h%2==0,h<2],p=T.clone$2(this.min),y=T.clone$2(this.max),I=0;I<d.length;I++)p[I]=d[I]?this.min[I]:this.center[I],y[I]=d[I]?this.center[I]:this.max[I];return y[2]=this.max[2],new La(p,y)},La.prototype.distanceX=function(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]},La.prototype.distanceY=function(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]},La.prototype.intersects=function(h){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],p=!0,y=0;y<h.planes.length;y++){for(var I=h.planes[y],P=0,D=0;D<d.length;D++)P+=T.dot$1(I,d[D])>=0;if(P===0)return 0;P!==d.length&&(p=!1)}if(p)return 2;for(var O=0;O<3;O++){for(var G=Number.MAX_VALUE,Q=-Number.MAX_VALUE,oe=0;oe<h.points.length;oe++){var _e=h.points[oe][O]-this.min[O];G=Math.min(G,_e),Q=Math.max(Q,_e)}if(Q<0||G>this.max[O]-this.min[O])return 0}return 1};var kr=function(h,d,p,y,I){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=I===void 0||I,this._minZoom=h||0,this._maxZoom=d||22,this._minPitch=p??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new T.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},rn={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};kr.prototype.clone=function(){var h=new kr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.tileSize=this.tileSize,h.latRange=this.latRange,h.width=this.width,h.height=this.height,h._center=this._center,h.zoom=this.zoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._unmodified=this._unmodified,h._calcMatrices(),h},rn.minZoom.get=function(){return this._minZoom},rn.minZoom.set=function(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))},rn.maxZoom.get=function(){return this._maxZoom},rn.maxZoom.set=function(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))},rn.minPitch.get=function(){return this._minPitch},rn.minPitch.set=function(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))},rn.maxPitch.get=function(){return this._maxPitch},rn.maxPitch.set=function(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))},rn.renderWorldCopies.get=function(){return this._renderWorldCopies},rn.renderWorldCopies.set=function(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h},rn.worldSize.get=function(){return this.tileSize*this.scale},rn.centerPoint.get=function(){return this.size._div(2)},rn.size.get=function(){return new T.Point(this.width,this.height)},rn.bearing.get=function(){return-this.angle/Math.PI*180},rn.bearing.set=function(h){var d=-T.wrap(h,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=T.create$2(),T.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},rn.pitch.get=function(){return this._pitch/Math.PI*180},rn.pitch.set=function(h){var d=T.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},rn.fov.get=function(){return this._fov/Math.PI*180},rn.fov.set=function(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())},rn.zoom.get=function(){return this._zoom},rn.zoom.set=function(h){var d=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},rn.center.get=function(){return this._center},rn.center.set=function(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())},kr.prototype.coveringZoomLevel=function(h){var d=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,d)},kr.prototype.getVisibleUnwrappedCoordinates=function(h){var d=[new T.UnwrappedTileID(0,h)];if(this._renderWorldCopies)for(var p=this.pointCoordinate(new T.Point(0,0)),y=this.pointCoordinate(new T.Point(this.width,0)),I=this.pointCoordinate(new T.Point(this.width,this.height)),P=this.pointCoordinate(new T.Point(0,this.height)),D=Math.floor(Math.min(p.x,y.x,I.x,P.x)),O=Math.floor(Math.max(p.x,y.x,I.x,P.x)),G=D-1;G<=O+1;G++)G!==0&&d.push(new T.UnwrappedTileID(G,h));return d},kr.prototype.coveringTiles=function(h){var d=this.coveringZoomLevel(h),p=d;if(h.minzoom!==void 0&&d<h.minzoom)return[];h.maxzoom!==void 0&&d>h.maxzoom&&(d=h.maxzoom);var y=T.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,d),P=[I*y.x,I*y.y,0],D=_u.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),O=h.minzoom||0;this.pitch<=60&&(O=d);var G=function(ni){return{aabb:new La([ni*I,0,0],[(ni+1)*I,I,0]),zoom:0,x:0,y:0,wrap:ni,fullyVisible:!1}},Q=[],oe=[],_e=d,Se=h.reparseOverscaled?p:d;if(this._renderWorldCopies)for(var Te=1;Te<=3;Te++)Q.push(G(-Te)),Q.push(G(Te));for(Q.push(G(0));Q.length>0;){var ge=Q.pop(),be=ge.x,We=ge.y,Ne=ge.fullyVisible;if(!Ne){var et=ge.aabb.intersects(D);if(et===0)continue;Ne=et===2}var Je=ge.aabb.distanceX(P),ot=ge.aabb.distanceY(P),gt=Math.max(Math.abs(Je),Math.abs(ot)),Ct=3+(1<<_e-ge.zoom)-2;if(ge.zoom===_e||gt>Ct&&ge.zoom>=O)oe.push({tileID:new T.OverscaledTileID(ge.zoom===_e?Se:ge.zoom,ge.wrap,ge.zoom,be,We),distanceSq:T.sqrLen([P[0]-.5-be,P[1]-.5-We])});else for(var Vt=0;Vt<4;Vt++){var fi=(be<<1)+Vt%2,ei=(We<<1)+(Vt>>1);Q.push({aabb:ge.aabb.quadrant(Vt),zoom:ge.zoom+1,x:fi,y:ei,wrap:ge.wrap,fullyVisible:Ne})}}return oe.sort(function(ni,Nt){return ni.distanceSq-Nt.distanceSq}).map(function(ni){return ni.tileID})},kr.prototype.resize=function(h,d){this.width=h,this.height=d,this.pixelsToGLUnits=[2/h,-2/d],this._constrain(),this._calcMatrices()},rn.unmodified.get=function(){return this._unmodified},kr.prototype.zoomScale=function(h){return Math.pow(2,h)},kr.prototype.scaleZoom=function(h){return Math.log(h)/Math.LN2},kr.prototype.project=function(h){var d=T.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new T.Point(T.mercatorXfromLng(h.lng)*this.worldSize,T.mercatorYfromLat(d)*this.worldSize)},kr.prototype.unproject=function(h){return new T.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()},rn.point.get=function(){return this.project(this.center)},kr.prototype.setLocationAtPoint=function(h,d){var p=this.pointCoordinate(d),y=this.pointCoordinate(this.centerPoint),I=this.locationCoordinate(h),P=new T.MercatorCoordinate(I.x-(p.x-y.x),I.y-(p.y-y.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())},kr.prototype.locationPoint=function(h){return this.coordinatePoint(this.locationCoordinate(h))},kr.prototype.pointLocation=function(h){return this.coordinateLocation(this.pointCoordinate(h))},kr.prototype.locationCoordinate=function(h){return T.MercatorCoordinate.fromLngLat(h)},kr.prototype.coordinateLocation=function(h){return h.toLngLat()},kr.prototype.pointCoordinate=function(h){var d=[h.x,h.y,0,1],p=[h.x,h.y,1,1];T.transformMat4(d,d,this.pixelMatrixInverse),T.transformMat4(p,p,this.pixelMatrixInverse);var y=d[3],I=p[3],P=d[0]/y,D=p[0]/I,O=d[1]/y,G=p[1]/I,Q=d[2]/y,oe=p[2]/I,_e=Q===oe?0:(0-Q)/(oe-Q);return new T.MercatorCoordinate(T.number(P,D,_e)/this.worldSize,T.number(O,G,_e)/this.worldSize)},kr.prototype.coordinatePoint=function(h){var d=[h.x*this.worldSize,h.y*this.worldSize,0,1];return T.transformMat4(d,d,this.pixelMatrix),new T.Point(d[0]/d[3],d[1]/d[3])},kr.prototype.getBounds=function(){return new T.LngLatBounds().extend(this.pointLocation(new T.Point(0,0))).extend(this.pointLocation(new T.Point(this.width,0))).extend(this.pointLocation(new T.Point(this.width,this.height))).extend(this.pointLocation(new T.Point(0,this.height)))},kr.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new T.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},kr.prototype.setMaxBounds=function(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},kr.prototype.calculatePosMatrix=function(h,d){d===void 0&&(d=!1);var p=h.key,y=d?this._alignedPosMatrixCache:this._posMatrixCache;if(y[p])return y[p];var I=h.canonical,P=this.worldSize/this.zoomScale(I.z),D=I.x+Math.pow(2,I.z)*h.wrap,O=T.identity(new Float64Array(16));return T.translate(O,O,[D*P,I.y*P,0]),T.scale(O,O,[P/T.EXTENT,P/T.EXTENT,1]),T.multiply(O,d?this.alignedProjMatrix:this.projMatrix,O),y[p]=new Float32Array(O),y[p]},kr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},kr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var h,d,p,y,I=-90,P=90,D=-180,O=180,G=this.size,Q=this._unmodified;if(this.latRange){var oe=this.latRange;I=T.mercatorYfromLat(oe[1])*this.worldSize,h=(P=T.mercatorYfromLat(oe[0])*this.worldSize)-I<G.y?G.y/(P-I):0}if(this.lngRange){var _e=this.lngRange;D=T.mercatorXfromLng(_e[0])*this.worldSize,d=(O=T.mercatorXfromLng(_e[1])*this.worldSize)-D<G.x?G.x/(O-D):0}var Se=this.point,Te=Math.max(d||0,h||0);if(Te)return this.center=this.unproject(new T.Point(d?(O+D)/2:Se.x,h?(P+I)/2:Se.y)),this.zoom+=this.scaleZoom(Te),this._unmodified=Q,void(this._constraining=!1);if(this.latRange){var ge=Se.y,be=G.y/2;ge-be<I&&(y=I+be),ge+be>P&&(y=P-be)}if(this.lngRange){var We=Se.x,Ne=G.x/2;We-Ne<D&&(p=D+Ne),We+Ne>O&&(p=O-Ne)}p===void 0&&y===void 0||(this.center=this.unproject(new T.Point(p!==void 0?p:Se.x,y!==void 0?y:Se.y))),this._unmodified=Q,this._constraining=!1}},kr.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=this._fov/2,d=Math.PI/2+this._pitch,p=Math.sin(h)*this.cameraToCenterDistance/Math.sin(T.clamp(Math.PI-d-h,.01,Math.PI-.01)),y=this.point,I=y.x,P=y.y,D=1.01*(Math.cos(Math.PI/2-this._pitch)*p+this.cameraToCenterDistance),O=this.height/50,G=new Float64Array(16);T.perspective(G,this._fov,this.width/this.height,O,D),T.scale(G,G,[1,-1,1]),T.translate(G,G,[0,0,-this.cameraToCenterDistance]),T.rotateX(G,G,this._pitch),T.rotateZ(G,G,this.angle),T.translate(G,G,[-I,-P,0]),this.mercatorMatrix=T.scale([],G,[this.worldSize,this.worldSize,this.worldSize]),T.scale(G,G,[1,1,T.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=G,this.invProjMatrix=T.invert([],this.projMatrix);var Q=this.width%2/2,oe=this.height%2/2,_e=Math.cos(this.angle),Se=Math.sin(this.angle),Te=I-Math.round(I)+_e*Q+Se*oe,ge=P-Math.round(P)+_e*oe+Se*Q,be=new Float64Array(G);if(T.translate(be,be,[Te>.5?Te-1:Te,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=be,G=T.create(),T.scale(G,G,[this.width/2,-this.height/2,1]),T.translate(G,G,[1,-1,0]),this.labelPlaneMatrix=G,G=T.create(),T.scale(G,G,[1,-1,1]),T.translate(G,G,[-1,-1,0]),T.scale(G,G,[2/this.width,2/this.height,1]),this.glCoordMatrix=G,this.pixelMatrix=T.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(G=T.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=G,this._posMatrixCache={},this._alignedPosMatrixCache={}}},kr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var h=this.pointCoordinate(new T.Point(0,0)),d=[h.x*this.worldSize,h.y*this.worldSize,0,1];return T.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},kr.prototype.getCameraPoint=function(){var h=this._pitch,d=Math.tan(h)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new T.Point(0,d))},kr.prototype.getCameraQueryGeometry=function(h){var d=this.getCameraPoint();if(h.length===1)return[h[0],d];for(var p=d.x,y=d.y,I=d.x,P=d.y,D=0,O=h;D<O.length;D+=1){var G=O[D];p=Math.min(p,G.x),y=Math.min(y,G.y),I=Math.max(I,G.x),P=Math.max(P,G.y)}return[new T.Point(p,y),new T.Point(I,y),new T.Point(I,P),new T.Point(p,P),new T.Point(p,y)]},Object.defineProperties(kr.prototype,rn);var Ml=function(h){var d,p,y,I,P;this._hashName=h&&encodeURIComponent(h),T.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),p=300,y=!1,I=null,P=function(){I=null,y&&(d(),I=setTimeout(P,p),y=!1)},function(){return y=!0,I||P(),I})};Ml.prototype.addTo=function(h){return this._map=h,T.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ml.prototype.remove=function(){return T.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ml.prototype.getHashString=function(h){var d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,y),P=Math.round(d.lng*I)/I,D=Math.round(d.lat*I)/I,O=this._map.getBearing(),G=this._map.getPitch(),Q="";if(Q+=h?"/"+P+"/"+D+"/"+p:p+"/"+D+"/"+P,(O||G)&&(Q+="/"+Math.round(10*O)/10),G&&(Q+="/"+Math.round(G)),this._hashName){var oe=this._hashName,_e=!1,Se=T.window.location.hash.slice(1).split("&").map(function(Te){var ge=Te.split("=")[0];return ge===oe?(_e=!0,ge+"="+Q):Te}).filter(function(Te){return Te});return _e||Se.push(oe+"="+Q),"#"+Se.join("&")}return"#"+Q},Ml.prototype._getCurrentHash=function(){var h,d=this,p=T.window.location.hash.replace("#","");return this._hashName?(p.split("&").map(function(y){return y.split("=")}).forEach(function(y){y[0]===d._hashName&&(h=y)}),(h&&h[1]||"").split("/")):p.split("/")},Ml.prototype._onHashChange=function(){var h=this._getCurrentHash();if(h.length>=3&&!h.some(function(p){return isNaN(p)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:d,pitch:+(h[4]||0)}),!0}return!1},Ml.prototype._updateHashUnthrottled=function(){var h=this.getHashString();try{T.window.history.replaceState(T.window.history.state,"",h)}catch{}};var ca=function(h){function d(y,I,P,D){D===void 0&&(D={});var O=c.mousePos(I.getCanvasContainer(),P),G=I.unproject(O);h.call(this,y,T.extend({point:O,lngLat:G,originalEvent:P},D)),this._defaultPrevented=!1,this.target=I}h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d;var p={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,p),d}(T.Event),wc=function(h){function d(y,I,P){var D=c.touchPos(I.getCanvasContainer(),P),O=D.map(function(oe){return I.unproject(oe)}),G=D.reduce(function(oe,_e,Se,Te){return oe.add(_e.div(Te.length))},new T.Point(0,0)),Q=I.unproject(G);h.call(this,y,{points:D,point:G,lngLats:O,lngLat:Q,originalEvent:P}),this._defaultPrevented=!1}h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d;var p={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,p),d}(T.Event),xs=function(h){function d(y,I,P){h.call(this,y,{originalEvent:P}),this._defaultPrevented=!1}h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d;var p={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,p),d}(T.Event),uo=function(h){this._map=h,this._el=h.getCanvasContainer(),this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,T.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};uo.prototype.setZoomRate=function(h){this._defaultZoomRate=h},uo.prototype.setWheelZoomRate=function(h){this._wheelZoomRate=h},uo.prototype.isEnabled=function(){return!!this._enabled},uo.prototype.isActive=function(){return!!this._active},uo.prototype.isZooming=function(){return!!this._zooming},uo.prototype.enable=function(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=h&&h.around==="center")},uo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},uo.prototype.onWheel=function(h){if(this.isEnabled()){var d=h.deltaMode===T.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,p=T.browser.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(y*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),h.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=h,this._delta-=d,this.isActive()||this._start(h)),h.preventDefault()}},uo.prototype._onTimeout=function(h){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(h)},uo.prototype._start=function(h){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0,this._map.fire(new T.Event("movestart",{originalEvent:h})),this._map.fire(new T.Event("zoomstart",{originalEvent:h}))),this._finishTimeout&&clearTimeout(this._finishTimeout);var d=c.mousePos(this._el,h);this._around=T.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},uo.prototype._onScrollFrame=function(){var h=this;if(this._frameId=null,this.isActive()){var d=this._map.transform;if(this._delta!==0){var p=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,y=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&y!==0&&(y=1/y);var I=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(I*y))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var P=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,D=this._startZoom,O=this._easing,G=!1;if(this._type==="wheel"&&D&&O){var Q=Math.min((T.browser.now()-this._lastWheelEventTime)/200,1),oe=O(Q);d.zoom=T.number(D,P,oe),Q<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):G=!0}else d.zoom=P,G=!0;d.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new T.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new T.Event("zoom",{originalEvent:this._lastWheelEvent})),G&&(this._active=!1,this._finishTimeout=setTimeout(function(){h._zooming=!1,h._map.fire(new T.Event("zoomend",{originalEvent:h._lastWheelEvent})),h._map.fire(new T.Event("moveend",{originalEvent:h._lastWheelEvent})),delete h._targetZoom},200))}},uo.prototype._smoothOutEasing=function(h){var d=T.ease;if(this._prevEase){var p=this._prevEase,y=(T.browser.now()-p.start)/p.duration,I=p.easing(y+.01)-p.easing(y),P=.27/Math.sqrt(I*I+1e-4)*.01,D=Math.sqrt(.0729-P*P);d=T.bezier(P,D,.25,1)}return this._prevEase={start:T.browser.now(),duration:h,easing:d},d};var ho=function(h,d){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=d.clickTolerance||1,T.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)};ho.prototype.isEnabled=function(){return!!this._enabled},ho.prototype.isActive=function(){return!!this._active},ho.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ho.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ho.prototype.onMouseDown=function(h){this.isEnabled()&&h.shiftKey&&h.button===0&&(T.window.document.addEventListener("mousemove",this._onMouseMove,!1),T.window.document.addEventListener("keydown",this._onKeyDown,!1),T.window.document.addEventListener("mouseup",this._onMouseUp,!1),c.disableDrag(),this._startPos=this._lastPos=c.mousePos(this._el,h),this._active=!0)},ho.prototype._onMouseMove=function(h){var d=c.mousePos(this._el,h);if(!(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)){var p=this._startPos;this._lastPos=d,this._box||(this._box=c.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));var y=Math.min(p.x,d.x),I=Math.max(p.x,d.x),P=Math.min(p.y,d.y),D=Math.max(p.y,d.y);c.setTransform(this._box,"translate("+y+"px,"+P+"px)"),this._box.style.width=I-y+"px",this._box.style.height=D-P+"px"}},ho.prototype._onMouseUp=function(h){if(h.button===0){var d=this._startPos,p=c.mousePos(this._el,h);this._finish(),c.suppressClick(),d.x===p.x&&d.y===p.y?this._fireEvent("boxzoomcancel",h):this._map.fitScreenCoordinates(d,p,this._map.getBearing(),{linear:!0}).fire(new T.Event("boxzoomend",{originalEvent:h}))}},ho.prototype._onKeyDown=function(h){h.keyCode===27&&(this._finish(),this._fireEvent("boxzoomcancel",h))},ho.prototype._finish=function(){this._active=!1,T.window.document.removeEventListener("mousemove",this._onMouseMove,!1),T.window.document.removeEventListener("keydown",this._onKeyDown,!1),T.window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(c.remove(this._box),this._box=null),c.enableDrag(),delete this._startPos,delete this._lastPos},ho.prototype._fireEvent=function(h,d){return this._map.fire(new T.Event(h,{originalEvent:d}))};var bh=T.bezier(0,0,.25,1),Ro=function(h,d){this._map=h,this._el=d.element||h.getCanvasContainer(),this._state="disabled",this._button=d.button||"right",this._bearingSnap=d.bearingSnap||0,this._pitchWithRotate=d.pitchWithRotate!==!1,this._clickTolerance=d.clickTolerance||1,T.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)};Ro.prototype.isEnabled=function(){return this._state!=="disabled"},Ro.prototype.isActive=function(){return this._state==="active"},Ro.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},Ro.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},Ro.prototype.onMouseDown=function(h){if(this._state==="enabled"){var d=h.type==="touchstart";if(d)this._startTime=Date.now();else if(this._button==="right"){if(this._eventButton=c.mouseButton(h),h.altKey||h.metaKey||this._eventButton!==(h.ctrlKey?0:2))return}else{if(h.ctrlKey||c.mouseButton(h)!==0)return;this._eventButton=0}c.disableDrag(),d?(T.window.document.addEventListener("touchmove",this._onMouseMove,{capture:!0}),T.window.document.addEventListener("touchend",this._onMouseUp)):(T.window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),T.window.document.addEventListener("mouseup",this._onMouseUp)),T.window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[T.browser.now(),this._map.getBearing()]],this._startPos=this._prevPos=this._lastPos=c.mousePos(this._el,h),this._center=this._map.transform.centerPoint,h.preventDefault()}},Ro.prototype._onMouseMove=function(h){var d=c.mousePos(this._el,h);this._lastPos.equals(d)||this._state==="pending"&&d.dist(this._startPos)<this._clickTolerance||(this._lastMoveEvent=h,this._lastPos=d,this._state==="pending"&&(this._state="active",this._fireEvent("rotatestart",h),this._fireEvent("movestart",h),this._pitchWithRotate&&this._fireEvent("pitchstart",h)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},Ro.prototype._onDragFrame=function(){this._frameId=null;var h=this._lastMoveEvent;if(h){var d=this._map.transform,p=this._prevPos,y=this._lastPos,I=.8*(p.x-y.x),P=-.5*(p.y-y.y),D=d.bearing-I,O=d.pitch-P,G=this._inertia,Q=G[G.length-1];this._drainInertiaBuffer(),G.push([T.browser.now(),this._map._normalizeBearing(D,Q[1])]);var oe=d.bearing;if(d.bearing=D,this._pitchWithRotate){var _e=d.pitch;d.pitch=O,d.pitch!==_e&&this._fireEvent("pitch",h)}d.bearing!==oe&&this._fireEvent("rotate",h),this._fireEvent("move",h),delete this._lastMoveEvent,this._prevPos=this._lastPos}},Ro.prototype._onMouseUp=function(h){var d=h.type==="touchend";if(d&&this._startPos===this._lastPos&&Date.now()-this._startTime<300&&this._el.click(),d||c.mouseButton(h)===this._eventButton)switch(this._state){case"active":this._state="enabled",c.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(h);break;case"pending":this._state="enabled",this._unbind()}},Ro.prototype._onBlur=function(h){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",h),this._pitchWithRotate&&this._fireEvent("pitchend",h),this._fireEvent("moveend",h);break;case"pending":this._state="enabled",this._unbind()}},Ro.prototype._unbind=function(){T.window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),T.window.document.removeEventListener("mouseup",this._onMouseUp),T.window.document.removeEventListener("touchmove",this._onMouseMove,{capture:!0}),T.window.document.removeEventListener("touchend",this._onMouseUp),T.window.removeEventListener("blur",this._onBlur),c.enableDrag()},Ro.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._lastPos},Ro.prototype._inertialRotate=function(h){var d=this;this._fireEvent("rotateend",h),this._drainInertiaBuffer();var p=this._map,y=p.getBearing(),I=this._inertia,P=function(){Math.abs(y)<d._bearingSnap?p.resetNorth({noMoveStart:!0},{originalEvent:h}):d._fireEvent("moveend",h),d._pitchWithRotate&&d._fireEvent("pitchend",h)};if(I.length<2)P();else{var D=I[0],O=I[I.length-1],G=I[I.length-2],Q=p._normalizeBearing(y,G[1]),oe=O[1]-D[1],_e=oe<0?-1:1,Se=(O[0]-D[0])/1e3;if(oe!==0&&Se!==0){var Te=Math.abs(oe*(.25/Se));Te>180&&(Te=180);var ge=Te/180;Q+=_e*Te*(ge/2),Math.abs(p._normalizeBearing(Q,0))<this._bearingSnap&&(Q=p._normalizeBearing(0,Q)),p.rotateTo(Q,{duration:1e3*ge,easing:bh,noMoveStart:!0},{originalEvent:h})}else P()}},Ro.prototype._fireEvent=function(h,d){return this._map.fire(new T.Event(h,d?{originalEvent:d}:{}))},Ro.prototype._drainInertiaBuffer=function(){for(var h=this._inertia,d=T.browser.now();h.length>0&&d-h[0][0]>160;)h.shift()};var Tc={linearity:.3,easing:T.bezier(0,0,.3,1),maxSpeed:1400,deceleration:2500},Jt=function(h,d){this._map=h,this._el=h.getCanvasContainer(),this._state="disabled",this._clickTolerance=d.clickTolerance||1,this._inertiaOptions=Tc,T.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)};Jt.prototype.isEnabled=function(){return this._state!=="disabled"},Jt.prototype.isActive=function(){return this._state==="active"},Jt.prototype.enable=function(h){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled",this._inertiaOptions=T.extend(Tc,h))},Jt.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},Jt.prototype.onMouseDown=function(h){this._state==="enabled"&&(h.ctrlKey||c.mouseButton(h)!==0||(c.addEventListener(T.window.document,"mousemove",this._onMove,{capture:!0}),c.addEventListener(T.window.document,"mouseup",this._onMouseUp),this._start(h)))},Jt.prototype.onTouchStart=function(h){this.isEnabled()&&(h.touches&&h.touches.length>1&&(this._state==="pending"||this._state==="active")||(c.addEventListener(T.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),c.addEventListener(T.window.document,"touchend",this._onTouchEnd),this._start(h)))},Jt.prototype._start=function(h){T.window.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._prevPos=this._lastPos=c.mousePos(this._el,h),this._startTouch=this._lastTouch=T.window.TouchEvent&&h instanceof T.window.TouchEvent?c.touchPos(this._el,h):null,this._inertia=[[T.browser.now(),this._startPos]]},Jt.prototype._touchesMatch=function(h,d){return!(!h||!d||h.length!==d.length)&&h.every(function(p,y){return d[y]===p})},Jt.prototype._onMove=function(h){h.preventDefault();var d=T.window.TouchEvent&&h instanceof T.window.TouchEvent?c.touchPos(this._el,h):null,p=c.mousePos(this._el,h);(d?this._touchesMatch(this._lastTouch,d):this._lastPos.equals(p))||this._state==="pending"&&p.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=h,this._lastPos=p,this._lastTouch=d,this._drainInertiaBuffer(),this._inertia.push([T.browser.now(),this._lastPos]),this._state==="pending"&&(this._state="active",this._shouldStart=!0),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},Jt.prototype._onDragFrame=function(){this._frameId=null;var h=this._lastMoveEvent;if(h){if(this._map.touchZoomRotate.isActive())this._abort(h);else if(this._shouldStart&&(this._fireEvent("dragstart",h),this._fireEvent("movestart",h),this._shouldStart=!1),this.isActive()){var d=this._map.transform;d.setLocationAtPoint(d.pointLocation(this._prevPos),this._lastPos),this._fireEvent("drag",h),this._fireEvent("move",h),this._prevPos=this._lastPos,delete this._lastMoveEvent}}},Jt.prototype._onMouseUp=function(h){if(c.mouseButton(h)===0)switch(this._state){case"active":this._state="enabled",c.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(h);break;case"pending":this._state="enabled",this._unbind()}},Jt.prototype._onTouchEnd=function(h){if(h.touches&&h.touches.length!==0)switch(this._state){case"pending":case"active":break;case"enabled":this.onTouchStart(h)}else switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(h);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind()}},Jt.prototype._abort=function(h){switch(this._state){case"active":this._state="enabled",this._shouldStart||(this._fireEvent("dragend",h),this._fireEvent("moveend",h)),this._unbind(),this._deactivate(),T.window.TouchEvent&&h instanceof T.window.TouchEvent&&h.touches.length>1&&c.addEventListener(T.window.document,"touchend",this._onTouchEnd);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind()}},Jt.prototype._onBlur=function(h){this._abort(h)},Jt.prototype._unbind=function(){c.removeEventListener(T.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),c.removeEventListener(T.window.document,"touchend",this._onTouchEnd),c.removeEventListener(T.window.document,"mousemove",this._onMove,{capture:!0}),c.removeEventListener(T.window.document,"mouseup",this._onMouseUp),c.removeEventListener(T.window,"blur",this._onBlur)},Jt.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._mouseDownPos,delete this._lastPos,delete this._startTouch,delete this._lastTouch,delete this._shouldStart},Jt.prototype._inertialPan=function(h){this._fireEvent("dragend",h),this._drainInertiaBuffer();var d=this._inertia;if(d.length<2)this._fireEvent("moveend",h);else{var p=d[d.length-1],y=d[0],I=p[1].sub(y[1]),P=(p[0]-y[0])/1e3;if(P===0||p[1].equals(y[1]))this._fireEvent("moveend",h);else{var D=this._inertiaOptions,O=D.linearity,G=D.easing,Q=D.maxSpeed,oe=D.deceleration,_e=I.mult(O/P),Se=_e.mag();Se>Q&&(Se=Q,_e._unit()._mult(Se));var Te=Se/(oe*O),ge=_e.mult(-Te/2);this._map.panBy(ge,{duration:1e3*Te,easing:G,noMoveStart:!0},{originalEvent:h})}}},Jt.prototype._fireEvent=function(h,d){return this._map.fire(new T.Event(h,d?{originalEvent:d}:{}))},Jt.prototype._drainInertiaBuffer=function(){for(var h=this._inertia,d=T.browser.now();h.length>0&&d-h[0][0]>160;)h.shift()};var js=function(h){this._map=h,this._el=h.getCanvasContainer(),T.bindAll(["_onKeyDown"],this)};function Kl(h){return h*(2-h)}js.prototype.isEnabled=function(){return!!this._enabled},js.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},js.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},js.prototype._onKeyDown=function(h){if(!(h.altKey||h.ctrlKey||h.metaKey)){var d=0,p=0,y=0,I=0,P=0;switch(h.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:h.shiftKey?p=-1:(h.preventDefault(),I=-1);break;case 39:h.shiftKey?p=1:(h.preventDefault(),I=1);break;case 38:h.shiftKey?y=1:(h.preventDefault(),P=-1);break;case 40:h.shiftKey?y=-1:(P=1,h.preventDefault());break;default:return}var D=this._map,O=D.getZoom(),G={duration:300,delayEndEvents:500,easing:Kl,zoom:d?Math.round(O)+d*(h.shiftKey?2:1):O,bearing:D.getBearing()+15*p,pitch:D.getPitch()+10*y,offset:[100*-I,100*-P],center:D.getCenter()};D.easeTo(G,{originalEvent:h})}};var Ja=function(h){this._map=h,T.bindAll(["_onDblClick","_onZoomEnd"],this)};Ja.prototype.isEnabled=function(){return!!this._enabled},Ja.prototype.isActive=function(){return!!this._active},Ja.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ja.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ja.prototype.onTouchStart=function(h){var d=this;if(this.isEnabled()&&!(h.points.length>1))if(this._tapped){var p=h.points[0],y=this._tappedPoint;if(y&&y.dist(p)<=30){h.originalEvent.preventDefault();var I=function(){d._tapped&&d._zoom(h),d._map.off("touchcancel",P),d._resetTapped()},P=function(){d._map.off("touchend",I),d._resetTapped()};this._map.once("touchend",I),this._map.once("touchcancel",P)}else this._resetTapped()}else this._tappedPoint=h.points[0],this._tapped=setTimeout(function(){d._tapped=null,d._tappedPoint=null},300)},Ja.prototype._resetTapped=function(){clearTimeout(this._tapped),this._tapped=null,this._tappedPoint=null},Ja.prototype.onDblClick=function(h){this.isEnabled()&&(h.originalEvent.preventDefault(),this._zoom(h))},Ja.prototype._zoom=function(h){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(h.originalEvent.shiftKey?-1:1),{around:h.lngLat},h)},Ja.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};var Ec=T.bezier(0,0,.15,1),Mn=function(h){this._map=h,this._el=h.getCanvasContainer(),T.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)};Mn.prototype.isEnabled=function(){return!!this._enabled},Mn.prototype.enable=function(h){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!h&&h.around==="center")},Mn.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1)},Mn.prototype.disableRotation=function(){this._rotationDisabled=!0},Mn.prototype.enableRotation=function(){this._rotationDisabled=!1},Mn.prototype.isActive=function(){return this.isEnabled()&&!!this._gestureIntent},Mn.prototype.onStart=function(h){if(this.isEnabled()&&h.touches.length===2){var d=c.mousePos(this._el,h.touches[0]),p=c.mousePos(this._el,h.touches[1]),y=d.add(p).div(2);this._startVec=d.sub(p),this._startAround=this._map.transform.pointLocation(y),this._gestureIntent=void 0,this._inertia=[],c.addEventListener(T.window.document,"touchmove",this._onMove,{passive:!1}),c.addEventListener(T.window.document,"touchend",this._onEnd)}},Mn.prototype._getTouchEventData=function(h){var d=c.mousePos(this._el,h.touches[0]),p=c.mousePos(this._el,h.touches[1]),y=d.sub(p);return{vec:y,center:d.add(p).div(2),scale:y.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*y.angleWith(this._startVec)/Math.PI}},Mn.prototype._onMove=function(h){if(h.touches.length===2){var d=this._getTouchEventData(h),p=d.vec,y=d.scale,I=d.bearing;if(!this._gestureIntent){var P=this._rotationDisabled&&y!==1||Math.abs(1-y)>.15;Math.abs(I)>10?this._gestureIntent="rotate":P&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new T.Event(this._gestureIntent+"start",{originalEvent:h})),this._map.fire(new T.Event("movestart",{originalEvent:h})),this._startVec=p)}this._lastTouchEvent=h,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),h.preventDefault()}},Mn.prototype._onTouchFrame=function(){this._frameId=null;var h=this._gestureIntent;if(h){var d=this._map.transform;this._startScale||(this._startScale=d.scale,this._startBearing=d.bearing);var p=this._getTouchEventData(this._lastTouchEvent),y=p.center,I=p.bearing,P=p.scale,D=d.pointLocation(y),O=d.locationPoint(D);h==="rotate"&&(d.bearing=this._startBearing+I),d.zoom=d.scaleZoom(this._startScale*P),d.setLocationAtPoint(this._startAround,O),this._map.fire(new T.Event(h,{originalEvent:this._lastTouchEvent})),this._map.fire(new T.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([T.browser.now(),P,y])}},Mn.prototype._onEnd=function(h){c.removeEventListener(T.window.document,"touchmove",this._onMove,{passive:!1}),c.removeEventListener(T.window.document,"touchend",this._onEnd);var d=this._gestureIntent,p=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,d){this._map.fire(new T.Event(d+"end",{originalEvent:h})),this._drainInertiaBuffer();var y=this._inertia,I=this._map;if(y.length<2)I.snapToNorth({},{originalEvent:h});else{var P=y[y.length-1],D=y[0],O=I.transform.scaleZoom(p*P[1]),G=I.transform.scaleZoom(p*D[1]),Q=O-G,oe=(P[0]-D[0])/1e3,_e=P[2];if(oe!==0&&O!==G){var Se=.15*Q/oe;Math.abs(Se)>2.5&&(Se=Se>0?2.5:-2.5);var Te=1e3*Math.abs(Se/(12*.15)),ge=O+Se*Te/2e3;I.easeTo({zoom:ge,duration:Te,easing:Ec,around:this._aroundCenter?I.getCenter():I.unproject(_e),noMoveStart:!0},{originalEvent:h})}else I.snapToNorth({},{originalEvent:h})}}},Mn.prototype._drainInertiaBuffer=function(){for(var h=this._inertia,d=T.browser.now();h.length>2&&d-h[0][0]>160;)h.shift()};var Yl={scrollZoom:uo,boxZoom:ho,dragRotate:Ro,dragPan:Jt,keyboard:js,doubleClickZoom:Ja,touchZoomRotate:Mn},Yt=function(h){function d(p,y){h.call(this),this._moving=!1,this._zooming=!1,this.transform=p,this._bearingSnap=y.bearingSnap,T.bindAll(["_renderFrameCallback"],this)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.getCenter=function(){return new T.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(p,y){return this.jumpTo({center:p},y)},d.prototype.panBy=function(p,y,I){return p=T.Point.convert(p).mult(-1),this.panTo(this.transform.center,T.extend({offset:p},y),I)},d.prototype.panTo=function(p,y,I){return this.easeTo(T.extend({center:p},y),I)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(p,y){return this.jumpTo({zoom:p},y),this},d.prototype.zoomTo=function(p,y,I){return this.easeTo(T.extend({zoom:p},y),I)},d.prototype.zoomIn=function(p,y){return this.zoomTo(this.getZoom()+1,p,y),this},d.prototype.zoomOut=function(p,y){return this.zoomTo(this.getZoom()-1,p,y),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(p,y){return this.jumpTo({bearing:p},y),this},d.prototype.rotateTo=function(p,y,I){return this.easeTo(T.extend({bearing:p},y),I)},d.prototype.resetNorth=function(p,y){return this.rotateTo(0,T.extend({duration:1e3},p),y),this},d.prototype.resetNorthPitch=function(p,y){return this.easeTo(T.extend({bearing:0,pitch:0,duration:1e3},p),y),this},d.prototype.snapToNorth=function(p,y){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(p,y):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(p,y){return this.jumpTo({pitch:p},y),this},d.prototype.cameraForBounds=function(p,y){return p=T.LngLatBounds.convert(p),this._cameraForBoxAndBearing(p.getNorthWest(),p.getSouthEast(),0,y)},d.prototype._cameraForBoxAndBearing=function(p,y,I,P){if(typeof(P=T.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},P)).padding=="number"){var D=P.padding;P.padding={top:D,bottom:D,right:D,left:D}}if(T.deepEqual(Object.keys(P.padding).sort(function(Ct,Vt){return Ct<Vt?-1:Ct>Vt?1:0}),["bottom","left","right","top"])){var O=this.transform,G=O.project(T.LngLat.convert(p)),Q=O.project(T.LngLat.convert(y)),oe=G.rotate(-I*Math.PI/180),_e=Q.rotate(-I*Math.PI/180),Se=new T.Point(Math.max(oe.x,_e.x),Math.max(oe.y,_e.y)),Te=new T.Point(Math.min(oe.x,_e.x),Math.min(oe.y,_e.y)),ge=Se.sub(Te),be=(O.width-P.padding.left-P.padding.right)/ge.x,We=(O.height-P.padding.top-P.padding.bottom)/ge.y;if(!(We<0||be<0)){var Ne=Math.min(O.scaleZoom(O.scale*Math.min(be,We)),P.maxZoom),et=T.Point.convert(P.offset),Je=(P.padding.left-P.padding.right)/2,ot=(P.padding.top-P.padding.bottom)/2,gt=new T.Point(et.x+Je,et.y+ot).mult(O.scale/O.zoomScale(Ne));return{center:O.unproject(G.add(Q).div(2).sub(gt)),zoom:Ne,bearing:I}}T.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}else T.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'")},d.prototype.fitBounds=function(p,y,I){return this._fitInternal(this.cameraForBounds(p,y),y,I)},d.prototype.fitScreenCoordinates=function(p,y,I,P,D){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(T.Point.convert(p)),this.transform.pointLocation(T.Point.convert(y)),I,P),P,D)},d.prototype._fitInternal=function(p,y,I){return p?(y=T.extend(p,y)).linear?this.easeTo(y,I):this.flyTo(y,I):this},d.prototype.jumpTo=function(p,y){this.stop();var I=this.transform,P=!1,D=!1,O=!1;return"zoom"in p&&I.zoom!==+p.zoom&&(P=!0,I.zoom=+p.zoom),p.center!==void 0&&(I.center=T.LngLat.convert(p.center)),"bearing"in p&&I.bearing!==+p.bearing&&(D=!0,I.bearing=+p.bearing),"pitch"in p&&I.pitch!==+p.pitch&&(O=!0,I.pitch=+p.pitch),this.fire(new T.Event("movestart",y)).fire(new T.Event("move",y)),P&&this.fire(new T.Event("zoomstart",y)).fire(new T.Event("zoom",y)).fire(new T.Event("zoomend",y)),D&&this.fire(new T.Event("rotatestart",y)).fire(new T.Event("rotate",y)).fire(new T.Event("rotateend",y)),O&&this.fire(new T.Event("pitchstart",y)).fire(new T.Event("pitch",y)).fire(new T.Event("pitchend",y)),this.fire(new T.Event("moveend",y))},d.prototype.easeTo=function(p,y){var I=this;this.stop(),((p=T.extend({offset:[0,0],duration:500,easing:T.ease},p)).animate===!1||!p.essential&&T.browser.prefersReducedMotion)&&(p.duration=0);var P=this.transform,D=this.getZoom(),O=this.getBearing(),G=this.getPitch(),Q="zoom"in p?+p.zoom:D,oe="bearing"in p?this._normalizeBearing(p.bearing,O):O,_e="pitch"in p?+p.pitch:G,Se=P.centerPoint.add(T.Point.convert(p.offset)),Te=P.pointLocation(Se),ge=T.LngLat.convert(p.center||Te);this._normalizeCenter(ge);var be,We,Ne=P.project(Te),et=P.project(ge).sub(Ne),Je=P.zoomScale(Q-D);return p.around&&(be=T.LngLat.convert(p.around),We=P.locationPoint(be)),this._zooming=Q!==D,this._rotating=O!==oe,this._pitching=_e!==G,this._prepareEase(y,p.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(ot){if(I._zooming&&(P.zoom=T.number(D,Q,ot)),I._rotating&&(P.bearing=T.number(O,oe,ot)),I._pitching&&(P.pitch=T.number(G,_e,ot)),be)P.setLocationAtPoint(be,We);else{var gt=P.zoomScale(P.zoom-D),Ct=Q>D?Math.min(2,Je):Math.max(.5,Je),Vt=Math.pow(Ct,1-ot),fi=P.unproject(Ne.add(et.mult(ot*Vt)).mult(gt));P.setLocationAtPoint(P.renderWorldCopies?fi.wrap():fi,Se)}I._fireMoveEvents(y)},function(){p.delayEndEvents?I._easeEndTimeoutID=setTimeout(function(){return I._afterEase(y)},p.delayEndEvents):I._afterEase(y)},p),this},d.prototype._prepareEase=function(p,y){this._moving=!0,y||this.fire(new T.Event("movestart",p)),this._zooming&&this.fire(new T.Event("zoomstart",p)),this._rotating&&this.fire(new T.Event("rotatestart",p)),this._pitching&&this.fire(new T.Event("pitchstart",p))},d.prototype._fireMoveEvents=function(p){this.fire(new T.Event("move",p)),this._zooming&&this.fire(new T.Event("zoom",p)),this._rotating&&this.fire(new T.Event("rotate",p)),this._pitching&&this.fire(new T.Event("pitch",p))},d.prototype._afterEase=function(p){var y=this._zooming,I=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,y&&this.fire(new T.Event("zoomend",p)),I&&this.fire(new T.Event("rotateend",p)),P&&this.fire(new T.Event("pitchend",p)),this.fire(new T.Event("moveend",p))},d.prototype.flyTo=function(p,y){var I=this;if(!p.essential&&T.browser.prefersReducedMotion){var P=T.pick(p,["center","zoom","bearing","pitch","around"]);return this.jumpTo(P,y)}this.stop(),p=T.extend({offset:[0,0],speed:1.2,curve:1.42,easing:T.ease},p);var D=this.transform,O=this.getZoom(),G=this.getBearing(),Q=this.getPitch(),oe="zoom"in p?T.clamp(+p.zoom,D.minZoom,D.maxZoom):O,_e="bearing"in p?this._normalizeBearing(p.bearing,G):G,Se="pitch"in p?+p.pitch:Q,Te=D.zoomScale(oe-O),ge=D.centerPoint.add(T.Point.convert(p.offset)),be=D.pointLocation(ge),We=T.LngLat.convert(p.center||be);this._normalizeCenter(We);var Ne=D.project(be),et=D.project(We).sub(Ne),Je=p.curve,ot=Math.max(D.width,D.height),gt=ot/Te,Ct=et.mag();if("minZoom"in p){var Vt=T.clamp(Math.min(p.minZoom,O,oe),D.minZoom,D.maxZoom),fi=ot/D.zoomScale(Vt-O);Je=Math.sqrt(fi/Ct*2)}var ei=Je*Je;function ni(Ri){var gr=(gt*gt-ot*ot+(Ri?-1:1)*ei*ei*Ct*Ct)/(2*(Ri?gt:ot)*ei*Ct);return Math.log(Math.sqrt(gr*gr+1)-gr)}function Nt(Ri){return(Math.exp(Ri)-Math.exp(-Ri))/2}function Hi(Ri){return(Math.exp(Ri)+Math.exp(-Ri))/2}var Ii=ni(0),Vi=function(Ri){return Hi(Ii)/Hi(Ii+Je*Ri)},Ni=function(Ri){return ot*((Hi(Ii)*(Nt(gr=Ii+Je*Ri)/Hi(gr))-Nt(Ii))/ei)/Ct;var gr},Pi=(ni(1)-Ii)/Je;if(Math.abs(Ct)<1e-6||!isFinite(Pi)){if(Math.abs(ot-gt)<1e-6)return this.easeTo(p,y);var ji=gt<ot?-1:1;Pi=Math.abs(Math.log(gt/ot))/Je,Ni=function(){return 0},Vi=function(Ri){return Math.exp(ji*Je*Ri)}}if("duration"in p)p.duration=+p.duration;else{var Dr="screenSpeed"in p?+p.screenSpeed/Je:+p.speed;p.duration=1e3*Pi/Dr}return p.maxDuration&&p.duration>p.maxDuration&&(p.duration=0),this._zooming=!0,this._rotating=G!==_e,this._pitching=Se!==Q,this._prepareEase(y,!1),this._ease(function(Ri){var gr=Ri*Pi,fr=1/Vi(gr);D.zoom=Ri===1?oe:O+D.scaleZoom(fr),I._rotating&&(D.bearing=T.number(G,_e,Ri)),I._pitching&&(D.pitch=T.number(Q,Se,Ri));var xr=Ri===1?We:D.unproject(Ne.add(et.mult(Ni(gr))).mult(fr));D.setLocationAtPoint(D.renderWorldCopies?xr.wrap():xr,ge),I._fireMoveEvents(y)},function(){return I._afterEase(y)},p),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var p=this._onEaseEnd;delete this._onEaseEnd,p.call(this)}return this},d.prototype._ease=function(p,y,I){I.animate===!1||I.duration===0?(p(1),y()):(this._easeStart=T.browser.now(),this._easeOptions=I,this._onEaseFrame=p,this._onEaseEnd=y,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var p=Math.min((T.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(p,y){p=T.wrap(p,-180,180);var I=Math.abs(p-y);return Math.abs(p-360-y)<I&&(p-=360),Math.abs(p+360-y)<I&&(p+=360),p},d.prototype._normalizeCenter=function(p){var y=this.transform;if(y.renderWorldCopies&&!y.lngRange){var I=p.lng-y.center.lng;p.lng+=I>180?-360:I<-180?360:0}},d}(T.Evented),ua=function(h){h===void 0&&(h={}),this.options=h,T.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};ua.prototype.getDefaultPosition=function(){return"bottom-right"},ua.prototype.onAdd=function(h){var d=this.options&&this.options.compact;return this._map=h,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=c.create("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ua.prototype.onRemove=function(){c.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ua.prototype._updateEditLink=function(){var h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||T.config.ACCESS_TOKEN}];if(h){var p=d.reduce(function(y,I,P){return I.value&&(y+=I.key+"="+I.value+(P<d.length-1?"&":"")),y},"?");h.href=T.config.FEEDBACK_URL+"/"+p+(this._map._hash?this._map._hash.getHashString(!0):""),h.rel="noopener nofollow"}},ua.prototype._updateData=function(h){!h||h.sourceDataType!=="metadata"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ua.prototype._updateAttributions=function(){if(this._map.style){var h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(function(O){return typeof O!="string"?"":O})):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var p=this._map.style.sourceCaches;for(var y in p){var I=p[y];if(I.used){var P=I.getSource();P.attribution&&h.indexOf(P.attribution)<0&&h.push(P.attribution)}}h.sort(function(O,G){return O.length-G.length});var D=(h=h.filter(function(O,G){for(var Q=G+1;Q<h.length;Q++)if(h[Q].indexOf(O)>=0)return!1;return!0})).join(" | ");D!==this._attribHTML&&(this._attribHTML=D,h.length?(this._innerContainer.innerHTML=D,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ua.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var Cl=function(){T.bindAll(["_updateLogo"],this),T.bindAll(["_updateCompact"],this)};Cl.prototype.onAdd=function(h){this._map=h,this._container=c.create("div","mapboxgl-ctrl");var d=c.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Cl.prototype.onRemove=function(){c.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Cl.prototype.getDefaultPosition=function(){return"bottom-left"},Cl.prototype._updateLogo=function(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Cl.prototype._logoRequired=function(){if(this._map.style){var h=this._map.style.sourceCaches;for(var d in h)if(h[d].getSource().mapbox_logo)return!0;return!1}},Cl.prototype._updateCompact=function(){var h=this._container.children;if(h.length){var d=h[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var Ra=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ra.prototype.add=function(h){var d=++this._id;return this._queue.push({callback:h,id:d,cancelled:!1}),d},Ra.prototype.remove=function(h){for(var d=this._currentlyRunning,p=0,y=d?this._queue.concat(d):this._queue;p<y.length;p+=1){var I=y[p];if(I.id===h)return void(I.cancelled=!0)}},Ra.prototype.run=function(){var h=this._currentlyRunning=this._queue;this._queue=[];for(var d=0,p=h;d<p.length;d+=1){var y=p[d];if(!y.cancelled&&(y.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ra.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Jl={"FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ql=T.window.HTMLImageElement,gu=T.window.HTMLElement,vr=T.window.ImageBitmap,Ta=0,ll=60,Sc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:Ta,maxPitch:ll,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},zl=function(h){function d(y){var I=this;if((y=T.extend({},Sc,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<Ta)throw new Error("minPitch must be greater than or equal to "+Ta);if(y.maxPitch!=null&&y.maxPitch>ll)throw new Error("maxPitch must be less than or equal to "+ll);var P=new kr(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies);if(h.call(this,P,y),this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Ra,this._controls=[],this._mapId=T.uniqueId(),this._locale=T.extend({},Jl,y.locale),this._requestManager=new T.RequestManager(y.transformRequest,y.accessToken),typeof y.container=="string"){if(this._container=T.window.document.getElementById(y.container),!this._container)throw new Error("Container '"+y.container+"' not found.")}else{if(!(y.container instanceof gu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),T.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return I._update(!1)}),this.on("moveend",function(){return I._update(!1)}),this.on("zoom",function(){return I._update(!0)}),T.window!==void 0&&(T.window.addEventListener("online",this._onWindowOnline,!1),T.window.addEventListener("resize",this._onWindowResize,!1)),function(O,G){var Q=O.getCanvasContainer(),oe=null,_e=!1,Se=null;for(var Te in Yl)O[Te]=new Yl[Te](O,G),G.interactive&&G[Te]&&O[Te].enable(G[Te]);c.addEventListener(Q,"mouseout",function(ge){O.fire(new ca("mouseout",O,ge))}),c.addEventListener(Q,"mousedown",function(ge){_e=!0,Se=c.mousePos(Q,ge);var be=new ca("mousedown",O,ge);O.fire(be),!be.defaultPrevented&&(G.interactive&&!O.doubleClickZoom.isActive()&&O.stop(),O.boxZoom.onMouseDown(ge),O.boxZoom.isActive()||O.dragPan.isActive()||O.dragRotate.onMouseDown(ge),O.boxZoom.isActive()||O.dragRotate.isActive()||O.dragPan.onMouseDown(ge))}),c.addEventListener(Q,"mouseup",function(ge){var be=O.dragRotate.isActive();oe&&!be&&O.fire(new ca("contextmenu",O,oe)),oe=null,_e=!1,O.fire(new ca("mouseup",O,ge))}),c.addEventListener(Q,"mousemove",function(ge){if(!O.dragPan.isActive()&&!O.dragRotate.isActive()){for(var be=ge.target;be&&be!==Q;)be=be.parentNode;be===Q&&O.fire(new ca("mousemove",O,ge))}}),c.addEventListener(Q,"mouseover",function(ge){for(var be=ge.target;be&&be!==Q;)be=be.parentNode;be===Q&&O.fire(new ca("mouseover",O,ge))}),c.addEventListener(Q,"touchstart",function(ge){var be=new wc("touchstart",O,ge);O.fire(be),!be.defaultPrevented&&(G.interactive&&O.stop(),O.boxZoom.isActive()||O.dragRotate.isActive()||O.dragPan.onTouchStart(ge),O.touchZoomRotate.onStart(ge),O.doubleClickZoom.onTouchStart(be))},{passive:!1}),c.addEventListener(Q,"touchmove",function(ge){O.fire(new wc("touchmove",O,ge))},{passive:!1}),c.addEventListener(Q,"touchend",function(ge){O.fire(new wc("touchend",O,ge))}),c.addEventListener(Q,"touchcancel",function(ge){O.fire(new wc("touchcancel",O,ge))}),c.addEventListener(Q,"click",function(ge){var be=c.mousePos(Q,ge);(!Se||be.equals(Se)||be.dist(Se)<G.clickTolerance)&&O.fire(new ca("click",O,ge))}),c.addEventListener(Q,"dblclick",function(ge){var be=new ca("dblclick",O,ge);O.fire(be),!be.defaultPrevented&&O.doubleClickZoom.onDblClick(be)}),c.addEventListener(Q,"contextmenu",function(ge){var be=O.dragRotate.isActive();_e||be?_e&&(oe=ge):O.fire(new ca("contextmenu",O,ge)),(O.dragRotate.isEnabled()||O.listens("contextmenu"))&&ge.preventDefault()}),c.addEventListener(Q,"wheel",function(ge){G.interactive&&O.stop();var be=new xs("wheel",O,ge);O.fire(be),!be.defaultPrevented&&O.scrollZoom.onWheel(ge)},{passive:!1})}(this,y);var D=typeof y.hash=="string"&&y.hash||void 0;this._hash=y.hash&&new Ml(D).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,T.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new ua({customAttribution:y.customAttribution})),this.addControl(new Cl,y.logoPosition),this.on("style.load",function(){I.transform.unmodified&&I.jumpTo(I.style.stylesheet)}),this.on("data",function(O){I._update(O.dataType==="style"),I.fire(new T.Event(O.dataType+"data",O))}),this.on("dataloading",function(O){I.fire(new T.Event(O.dataType+"dataloading",O))})}h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d;var p={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(y,I){if(I===void 0&&y.getDefaultPosition&&(I=y.getDefaultPosition()),I===void 0&&(I="top-right"),!y||!y.onAdd)return this.fire(new T.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var P=y.onAdd(this);this._controls.push(y);var D=this._controlPositions[I];return I.indexOf("bottom")!==-1?D.insertBefore(P,D.firstChild):D.appendChild(P),this},d.prototype.removeControl=function(y){if(!y||!y.onRemove)return this.fire(new T.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var I=this._controls.indexOf(y);return I>-1&&this._controls.splice(I,1),y.onRemove(this),this},d.prototype.resize=function(y){var I=this._containerDimensions(),P=I[0],D=I[1];return this._resizeCanvas(P,D),this.transform.resize(P,D),this.painter.resize(P,D),this.fire(new T.Event("movestart",y)).fire(new T.Event("move",y)).fire(new T.Event("resize",y)).fire(new T.Event("moveend",y)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(y){return this.transform.setMaxBounds(T.LngLatBounds.convert(y)),this._update()},d.prototype.setMinZoom=function(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(y){if((y=y??Ta)<Ta)throw new Error("minPitch must be greater than or equal to "+Ta);if(y>=Ta&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between "+Ta+" and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(y){if((y=y??ll)>ll)throw new Error("maxPitch must be less than or equal to "+ll);if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(y){return this.transform.renderWorldCopies=y,this._update()},d.prototype.project=function(y){return this.transform.locationPoint(T.LngLat.convert(y))},d.prototype.unproject=function(y){return this.transform.pointLocation(T.Point.convert(y))},d.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},d.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},d.prototype._createDelegatedListener=function(y,I,P){var D,O=this;if(y==="mouseenter"||y==="mouseover"){var G=!1;return{layer:I,listener:P,delegates:{mousemove:function(oe){var _e=O.getLayer(I)?O.queryRenderedFeatures(oe.point,{layers:[I]}):[];_e.length?G||(G=!0,P.call(O,new ca(y,O,oe.originalEvent,{features:_e}))):G=!1},mouseout:function(){G=!1}}}}if(y==="mouseleave"||y==="mouseout"){var Q=!1;return{layer:I,listener:P,delegates:{mousemove:function(oe){(O.getLayer(I)?O.queryRenderedFeatures(oe.point,{layers:[I]}):[]).length?Q=!0:Q&&(Q=!1,P.call(O,new ca(y,O,oe.originalEvent)))},mouseout:function(oe){Q&&(Q=!1,P.call(O,new ca(y,O,oe.originalEvent)))}}}}return{layer:I,listener:P,delegates:(D={},D[y]=function(oe){var _e=O.getLayer(I)?O.queryRenderedFeatures(oe.point,{layers:[I]}):[];_e.length&&(oe.features=_e,P.call(O,oe),delete oe.features)},D)}},d.prototype.on=function(y,I,P){if(P===void 0)return h.prototype.on.call(this,y,I);var D=this._createDelegatedListener(y,I,P);for(var O in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(D),D.delegates)this.on(O,D.delegates[O]);return this},d.prototype.once=function(y,I,P){if(P===void 0)return h.prototype.once.call(this,y,I);var D=this._createDelegatedListener(y,I,P);for(var O in D.delegates)this.once(O,D.delegates[O]);return this},d.prototype.off=function(y,I,P){var D=this;return P===void 0?h.prototype.off.call(this,y,I):(this._delegatedListeners&&this._delegatedListeners[y]&&function(O){for(var G=O[y],Q=0;Q<G.length;Q++){var oe=G[Q];if(oe.layer===I&&oe.listener===P){for(var _e in oe.delegates)D.off(_e,oe.delegates[_e]);return G.splice(Q,1),D}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(y,I){if(!this.style)return[];var P;if(I!==void 0||y===void 0||y instanceof T.Point||Array.isArray(y)||(I=y,y=void 0),I=I||{},(y=y||[[0,0],[this.transform.width,this.transform.height]])instanceof T.Point||typeof y[0]=="number")P=[T.Point.convert(y)];else{var D=T.Point.convert(y[0]),O=T.Point.convert(y[1]);P=[D,new T.Point(O.x,D.y),O,new T.Point(D.x,O.y),D]}return this.style.queryRenderedFeatures(P,I,this.transform)},d.prototype.querySourceFeatures=function(y,I){return this.style.querySourceFeatures(y,I)},d.prototype.setStyle=function(y,I){return(I=T.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},I)).diff!==!1&&I.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,I),this):(this._localIdeographFontFamily=I.localIdeographFontFamily,this._updateStyle(y,I))},d.prototype._getUIString=function(y){var I=this._locale[y];if(I==null)throw new Error("Missing UI string '"+y+"'");return I},d.prototype._updateStyle=function(y,I){return this.style&&(this.style.setEventedParent(null),this.style._remove()),y?(this.style=new $a(this,I||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new $a(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(y,I){var P=this;if(typeof y=="string"){var D=this._requestManager.normalizeStyleURL(y),O=this._requestManager.transformRequest(D,T.ResourceType.Style);T.getJSON(O,function(G,Q){G?P.fire(new T.ErrorEvent(G)):Q&&P._updateDiff(Q,I)})}else typeof y=="object"&&this._updateDiff(y,I)},d.prototype._updateDiff=function(y,I){try{this.style.setState(y)&&this._update(!0)}catch(P){T.warnOnce("Unable to perform style diff: "+(P.message||P.error||P)+".  Rebuilding the style from scratch."),this._updateStyle(y,I)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():T.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(y,I){return this._lazyInitEmptyStyle(),this.style.addSource(y,I),this._update(!0)},d.prototype.isSourceLoaded=function(y){var I=this.style&&this.style.sourceCaches[y];if(I!==void 0)return I.loaded();this.fire(new T.ErrorEvent(new Error("There is no source with ID '"+y+"'")))},d.prototype.areTilesLoaded=function(){var y=this.style&&this.style.sourceCaches;for(var I in y){var P=y[I]._tiles;for(var D in P){var O=P[D];if(O.state!=="loaded"&&O.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(y,I,P){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,I,P)},d.prototype.removeSource=function(y){return this.style.removeSource(y),this._update(!0)},d.prototype.getSource=function(y){return this.style.getSource(y)},d.prototype.addImage=function(y,I,P){P===void 0&&(P={});var D=P.pixelRatio;D===void 0&&(D=1);var O=P.sdf;O===void 0&&(O=!1);var G=P.stretchX,Q=P.stretchY,oe=P.content;if(this._lazyInitEmptyStyle(),I instanceof Ql||vr&&I instanceof vr){var _e=T.browser.getImageData(I),Se=_e.width,Te=_e.height,ge=_e.data;this.style.addImage(y,{data:new T.RGBAImage({width:Se,height:Te},ge),pixelRatio:D,stretchX:G,stretchY:Q,content:oe,sdf:O,version:0})}else{if(I.width===void 0||I.height===void 0)return this.fire(new T.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var be=I.width,We=I.height,Ne=I.data,et=I;this.style.addImage(y,{data:new T.RGBAImage({width:be,height:We},new Uint8Array(Ne)),pixelRatio:D,stretchX:G,stretchY:Q,content:oe,sdf:O,version:0,userImage:et}),et.onAdd&&et.onAdd(this,y)}},d.prototype.updateImage=function(y,I){var P=this.style.getImage(y);if(!P)return this.fire(new T.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var D=I instanceof Ql||vr&&I instanceof vr?T.browser.getImageData(I):I,O=D.width,G=D.height,Q=D.data;if(O===void 0||G===void 0)return this.fire(new T.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(O!==P.data.width||G!==P.data.height)return this.fire(new T.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));var oe=!(I instanceof Ql||vr&&I instanceof vr);P.data.replace(Q,oe),this.style.updateImage(y,P)},d.prototype.hasImage=function(y){return y?!!this.style.getImage(y):(this.fire(new T.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(y){this.style.removeImage(y)},d.prototype.loadImage=function(y,I){T.getImage(this._requestManager.transformRequest(y,T.ResourceType.Image),I)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(y,I){return this._lazyInitEmptyStyle(),this.style.addLayer(y,I),this._update(!0)},d.prototype.moveLayer=function(y,I){return this.style.moveLayer(y,I),this._update(!0)},d.prototype.removeLayer=function(y){return this.style.removeLayer(y),this._update(!0)},d.prototype.getLayer=function(y){return this.style.getLayer(y)},d.prototype.setLayerZoomRange=function(y,I,P){return this.style.setLayerZoomRange(y,I,P),this._update(!0)},d.prototype.setFilter=function(y,I,P){return P===void 0&&(P={}),this.style.setFilter(y,I,P),this._update(!0)},d.prototype.getFilter=function(y){return this.style.getFilter(y)},d.prototype.setPaintProperty=function(y,I,P,D){return D===void 0&&(D={}),this.style.setPaintProperty(y,I,P,D),this._update(!0)},d.prototype.getPaintProperty=function(y,I){return this.style.getPaintProperty(y,I)},d.prototype.setLayoutProperty=function(y,I,P,D){return D===void 0&&(D={}),this.style.setLayoutProperty(y,I,P,D),this._update(!0)},d.prototype.getLayoutProperty=function(y,I){return this.style.getLayoutProperty(y,I)},d.prototype.setLight=function(y,I){return I===void 0&&(I={}),this._lazyInitEmptyStyle(),this.style.setLight(y,I),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(y,I){return this.style.setFeatureState(y,I),this._update()},d.prototype.removeFeatureState=function(y,I){return this.style.removeFeatureState(y,I),this._update()},d.prototype.getFeatureState=function(y){return this.style.getFeatureState(y)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var y=0,I=0;return this._container&&(y=this._container.clientWidth||400,I=this._container.clientHeight||300),[y,I]},d.prototype._detectMissingCSS=function(){T.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&T.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=c.create("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();var I=this._canvasContainer=c.create("div","mapboxgl-canvas-container",y);this._interactive&&I.classList.add("mapboxgl-interactive"),this._canvas=c.create("canvas","mapboxgl-canvas",I),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var P=this._containerDimensions();this._resizeCanvas(P[0],P[1]);var D=this._controlContainer=c.create("div","mapboxgl-control-container",y),O=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){O[G]=c.create("div","mapboxgl-ctrl-"+G,D)})},d.prototype._resizeCanvas=function(y,I){var P=T.browser.devicePixelRatio||1;this._canvas.width=P*y,this._canvas.height=P*I,this._canvas.style.width=y+"px",this._canvas.style.height=I+"px"},d.prototype._setupPainter=function(){var y=T.extend({},Gi.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),I=this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);I?(this.painter=new Ur(I,this.transform),T.webpSupported.testSupport(I)):this.fire(new T.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new T.Event("webglcontextlost",{originalEvent:y}))},d.prototype._contextRestored=function(y){this._setupPainter(),this.resize(),this._update(),this.fire(new T.Event("webglcontextrestored",{originalEvent:y}))},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(y){return this._update(),this._renderTaskQueue.add(y)},d.prototype._cancelRenderFrame=function(y){this._renderTaskQueue.remove(y)},d.prototype._render=function(){var y,I=this,P=0,D=this.painter.context.extTimerQuery;this.listens("gpu-timing-frame")&&(y=D.createQueryEXT(),D.beginQueryEXT(D.TIME_ELAPSED_EXT,y),P=T.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var O=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var G=this.transform.zoom,Q=T.browser.now();this.style.zoomHistory.update(G,Q);var oe=new T.EvaluationParameters(G,{now:Q,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_e=oe.crossFadingFactor();_e===1&&_e===this._crossFadingFactor||(O=!0,this._crossFadingFactor=_e),this.style.update(oe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),gpuTiming:!!this.listens("gpu-timing-layer"),fadeDuration:this._fadeDuration}),this.fire(new T.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new T.Event("load"))),this.style&&(this.style.hasTransitions()||O)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Se=T.browser.now()-P;D.endQueryEXT(D.TIME_ELAPSED_EXT,y),setTimeout(function(){var ge=D.getQueryObjectEXT(y,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(y),I.fire(new T.Event("gpu-timing-frame",{cpuTime:Se,gpuTime:ge}))},50)}if(this.listens("gpu-timing-layer")){var Te=this.painter.collectGpuTimers();setTimeout(function(){var ge=I.painter.queryGpuTimers(Te);I.fire(new T.Event("gpu-timing-layer",{layerTimes:ge}))},50)}return this._sourcesDirty||this._styleDirty||this._placementDirty||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&(this._fullyLoaded||(this._fullyLoaded=!0),this.fire(new T.Event("idle"))),this},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var y=0,I=this._controls;y<I.length;y+=1)I[y].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.setStyle(null),T.window!==void 0&&(T.window.removeEventListener("resize",this._onWindowResize,!1),T.window.removeEventListener("online",this._onWindowOnline,!1));var P=this.painter.context.gl.getExtension("WEBGL_lose_context");P&&P.loseContext(),Ho(this._canvasContainer),Ho(this._controlContainer),Ho(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this.fire(new T.Event("remove"))},d.prototype.triggerRepaint=function(){var y=this;this.style&&!this._frame&&(this._frame=T.browser.frame(function(I){y._frame=null,y._render()}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(y){this._trackResize&&this.resize({originalEvent:y})._update()},p.showTileBoundaries.get=function(){return!!this._showTileBoundaries},p.showTileBoundaries.set=function(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())},p.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},p.showCollisionBoxes.set=function(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())},p.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},p.showOverdrawInspector.set=function(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())},p.repaint.get=function(){return!!this._repaint},p.repaint.set=function(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())},p.vertices.get=function(){return!!this._vertices},p.vertices.set=function(y){this._vertices=y,this._update()},d.prototype._setCacheLimits=function(y,I){T.setCacheLimits(y,I)},p.version.get=function(){return T.version},Object.defineProperties(d.prototype,p),d}(Yt);function Ho(h){h.parentNode&&h.parentNode.removeChild(h)}var bs={showCompass:!0,showZoom:!0,visualizePitch:!1},Ko=function(h){var d=this;this.options=T.extend({},bs,h),this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(p){return p.preventDefault()}),this.options.showZoom&&(T.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(p){return d._map.zoomIn({},{originalEvent:p})}),c.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(p){return d._map.zoomOut({},{originalEvent:p})}),c.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(T.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(p){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:p}):d._map.resetNorth({},{originalEvent:p})}),this._compassIcon=c.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};function Xc(h,d,p){if(h=new T.LngLat(h.lng,h.lat),d){var y=new T.LngLat(h.lng-360,h.lat),I=new T.LngLat(h.lng+360,h.lat),P=p.locationPoint(h).distSqr(d);p.locationPoint(y).distSqr(d)<P?h=y:p.locationPoint(I).distSqr(d)<P&&(h=I)}for(;Math.abs(h.lng-p.center.lng)>180;){var D=p.locationPoint(h);if(D.x>=0&&D.y>=0&&D.x<=p.width&&D.y<=p.height)break;h.lng>p.center.lng?h.lng-=360:h.lng+=360}return h}Ko.prototype._updateZoomButtons=function(){var h=this._map.getZoom();this._zoomInButton.disabled=h===this._map.getMaxZoom(),this._zoomOutButton.disabled=h===this._map.getMinZoom()},Ko.prototype._rotateCompassArrow=function(){var h=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=h},Ko.prototype.onAdd=function(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ro(h,{button:"left",element:this._compass,clickTolerance:h.dragRotate._clickTolerance}),c.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),c.addEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.enable()),this._container},Ko.prototype.onRemove=function(){c.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),c.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),c.removeEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.disable(),delete this._handler),delete this._map},Ko.prototype._createButton=function(h,d){var p=c.create("button",h,this._container);return p.type="button",p.addEventListener("click",d),p},Ko.prototype._setButtonTitle=function(h,d){var p=this._map._getUIString("NavigationControl."+d);h.title=p,h.setAttribute("aria-label",p)};var Pl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function cl(h,d,p){var y=h.classList;for(var I in Pl)y.remove("mapboxgl-"+p+"-anchor-"+I);y.add("mapboxgl-"+p+"-anchor-"+d)}var Qa,Bo=function(h){function d(p,y){var I=this;if(h.call(this),(p instanceof T.window.HTMLElement||y)&&(p=T.extend({element:p},y)),T.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=p&&p.anchor||"center",this._color=p&&p.color||"#3FB1CE",this._draggable=p&&p.draggable||!1,this._state="inactive",this._rotation=p&&p.rotation||0,this._rotationAlignment=p&&p.rotationAlignment||"auto",this._pitchAlignment=p&&p.pitchAlignment&&p.pitchAlignment!=="auto"?p.pitchAlignment:this._rotationAlignment,p&&p.element)this._element=p.element,this._offset=T.Point.convert(p&&p.offset||[0,0]);else{this._defaultMarker=!0,this._element=c.create("div"),this._element.setAttribute("aria-label","Map marker");var P=c.createNS("http://www.w3.org/2000/svg","svg");P.setAttributeNS(null,"display","block"),P.setAttributeNS(null,"height","41px"),P.setAttributeNS(null,"width","27px"),P.setAttributeNS(null,"viewBox","0 0 27 41");var D=c.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"stroke","none"),D.setAttributeNS(null,"stroke-width","1"),D.setAttributeNS(null,"fill","none"),D.setAttributeNS(null,"fill-rule","evenodd");var O=c.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill-rule","nonzero");var G=c.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(3.0, 29.0)"),G.setAttributeNS(null,"fill","#000000");for(var Q=0,oe=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Q<oe.length;Q+=1){var _e=oe[Q],Se=c.createNS("http://www.w3.org/2000/svg","ellipse");Se.setAttributeNS(null,"opacity","0.04"),Se.setAttributeNS(null,"cx","10.5"),Se.setAttributeNS(null,"cy","5.80029008"),Se.setAttributeNS(null,"rx",_e.rx),Se.setAttributeNS(null,"ry",_e.ry),G.appendChild(Se)}var Te=c.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"fill",this._color);var ge=c.createNS("http://www.w3.org/2000/svg","path");ge.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Te.appendChild(ge);var be=c.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"fill","#000000");var We=c.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),be.appendChild(We);var Ne=c.createNS("http://www.w3.org/2000/svg","g");Ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ne.setAttributeNS(null,"fill","#FFFFFF");var et=c.createNS("http://www.w3.org/2000/svg","g");et.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Je=c.createNS("http://www.w3.org/2000/svg","circle");Je.setAttributeNS(null,"fill","#000000"),Je.setAttributeNS(null,"opacity","0.25"),Je.setAttributeNS(null,"cx","5.5"),Je.setAttributeNS(null,"cy","5.5"),Je.setAttributeNS(null,"r","5.4999962");var ot=c.createNS("http://www.w3.org/2000/svg","circle");ot.setAttributeNS(null,"fill","#FFFFFF"),ot.setAttributeNS(null,"cx","5.5"),ot.setAttributeNS(null,"cy","5.5"),ot.setAttributeNS(null,"r","5.4999962"),et.appendChild(Je),et.appendChild(ot),O.appendChild(G),O.appendChild(Te),O.appendChild(be),O.appendChild(Ne),O.appendChild(et),P.appendChild(O),this._element.appendChild(P),this._offset=T.Point.convert(p&&p.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(gt){gt.preventDefault()}),this._element.addEventListener("mousedown",function(gt){gt.preventDefault()}),this._element.addEventListener("focus",function(){var gt=I._map.getContainer();gt.scrollTop=0,gt.scrollLeft=0}),cl(this._element,this._anchor,"marker"),this._popup=null}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.addTo=function(p){return this.remove(),this._map=p,p.getCanvasContainer().appendChild(this._element),p.on("move",this._update),p.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),c.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(p){return this._lngLat=T.LngLat.convert(p),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(p){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),p){if(!("offset"in p.options)){var y=Math.sqrt(Math.pow(13.5,2)/2);p.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=p,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(p){var y=p.code,I=p.charCode||p.keyCode;y!=="Space"&&y!=="Enter"&&I!==32&&I!==13||this.togglePopup()},d.prototype._onMapClick=function(p){var y=p.originalEvent.target,I=this._element;this._popup&&(y===I||I.contains(y))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var p=this._popup;return p?(p.isOpen()?p.remove():p.addTo(this._map),this):this},d.prototype._update=function(p){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Xc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(y="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I="rotateX("+this._map.getPitch()+"deg)"),p&&p.type!=="moveend"||(this._pos=this._pos.round()),c.setTransform(this._element,Pl[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+I+" "+y)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(p){return this._offset=T.Point.convert(p),this._update(),this},d.prototype._onMove=function(p){this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new T.Event("dragstart"))),this.fire(new T.Event("drag"))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new T.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(p){this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(p){return this._draggable=!!p,this._map&&(p?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(p){return this._rotation=p||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(p){return this._rotationAlignment=p||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(p){return this._pitchAlignment=p&&p!=="auto"?p:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(T.Evented),qr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},es=0,ts=!1,is=function(h){function d(p){h.call(this),this.options=T.extend({},qr,p),T.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.onAdd=function(p){var y;return this._map=p,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),y=this._setupUI,Qa!==void 0?y(Qa):T.window.navigator.permissions!==void 0?T.window.navigator.permissions.query({name:"geolocation"}).then(function(I){Qa=I.state!=="denied",y(Qa)}):(Qa=!!T.window.navigator.geolocation,y(Qa)),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(T.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),c.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,es=0,ts=!1},d.prototype._isOutOfMapMaxBounds=function(p){var y=this._map.getMaxBounds(),I=p.coords;return y&&(I.longitude<y.getWest()||I.longitude>y.getEast()||I.latitude<y.getSouth()||I.latitude>y.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new T.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new T.Event("geolocate",p)),this._finish()}},d.prototype._updateCamera=function(p){var y=new T.LngLat(p.coords.longitude,p.coords.latitude),I=p.coords.accuracy,P=this._map.getBearing(),D=T.extend({bearing:P},this.options.fitBoundsOptions);this._map.fitBounds(y.toBounds(I),D,{geolocateSource:!0})},d.prototype._updateMarker=function(p){if(p){var y=new T.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var p=this._map._container.clientHeight/2,y=this._map.unproject([0,p]),I=this._map.unproject([1,p]),P=y.distanceTo(I),D=Math.ceil(2*this._accuracy/P);this._circleElement.style.width=D+"px",this._circleElement.style.height=D+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&ts)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new T.Event("error",p)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(p){var y=this;if(this._container.addEventListener("contextmenu",function(D){return D.preventDefault()}),this._geolocateButton=c.create("button","mapboxgl-ctrl-geolocate",this._container),c.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",p===!1){T.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var I=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=I,this._geolocateButton.setAttribute("aria-label",I)}else{var P=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=P,this._geolocateButton.setAttribute("aria-label",P)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=c.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Bo(this._dotElement),this._circleElement=c.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(D){var O=D.originalEvent&&D.originalEvent.type==="resize";D.geolocateSource||y._watchState!=="ACTIVE_LOCK"||O||(y._watchState="BACKGROUND",y._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),y._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),y.fire(new T.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return T.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new T.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":es--,ts=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new T.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new T.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++es>1?(p={maximumAge:6e5,timeout:0},ts=!0):(p=this.options.positionOptions,ts=!1),this._geolocationWatchID=T.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else T.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){T.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(T.Evented),ti={maxWidth:100,unit:"metric"},go=function(h){this.options=T.extend({},ti,h),T.bindAll(["_onMove","setUnit"],this)};function ec(h,d,p){var y=p&&p.maxWidth||100,I=h._container.clientHeight/2,P=h.unproject([0,I]),D=h.unproject([y,I]),O=P.distanceTo(D);if(p&&p.unit==="imperial"){var G=3.2808*O;G>5280?$n(d,y,G/5280,h._getUIString("ScaleControl.Miles")):$n(d,y,G,h._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?$n(d,y,O/1852,h._getUIString("ScaleControl.NauticalMiles")):O>=1e3?$n(d,y,O/1e3,h._getUIString("ScaleControl.Kilometers")):$n(d,y,O,h._getUIString("ScaleControl.Meters"))}function $n(h,d,p,y){var I,P,D,O=(I=p,P=Math.pow(10,(""+Math.floor(I)).length-1),D=(D=I/P)>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(Q){var oe=Math.pow(10,Math.ceil(-Math.log(Q)/Math.LN10));return Math.round(Q*oe)/oe}(D),P*D),G=O/p;h.style.width=d*G+"px",h.innerHTML=O+"&nbsp;"+y}go.prototype.getDefaultPosition=function(){return"bottom-left"},go.prototype._onMove=function(){ec(this._map,this._container,this.options)},go.prototype.onAdd=function(h){return this._map=h,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},go.prototype.onRemove=function(){c.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},go.prototype.setUnit=function(h){this.options.unit=h,ec(this._map,this._container,this.options)};var Yo=function(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof T.window.HTMLElement?this._container=h.container:T.warnOnce("Full screen control 'container' must be a DOM element.")),T.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in T.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in T.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in T.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in T.window.document&&(this._fullscreenchange="MSFullscreenChange")};Yo.prototype.onAdd=function(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",T.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Yo.prototype.onRemove=function(){c.remove(this._controlContainer),this._map=null,T.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Yo.prototype._checkFullscreenSupport=function(){return!!(T.window.document.fullscreenEnabled||T.window.document.mozFullScreenEnabled||T.window.document.msFullscreenEnabled||T.window.document.webkitFullscreenEnabled)},Yo.prototype._setupUI=function(){var h=this._fullscreenButton=c.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);c.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),T.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Yo.prototype._updateTitle=function(){var h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h},Yo.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Yo.prototype._isFullscreen=function(){return this._fullscreen},Yo.prototype._changeIcon=function(){(T.window.document.fullscreenElement||T.window.document.mozFullScreenElement||T.window.document.webkitFullscreenElement||T.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Yo.prototype._onClickFullscreen=function(){this._isFullscreen()?T.window.document.exitFullscreen?T.window.document.exitFullscreen():T.window.document.mozCancelFullScreen?T.window.document.mozCancelFullScreen():T.window.document.msExitFullscreen?T.window.document.msExitFullscreen():T.window.document.webkitCancelFullScreen&&T.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ai={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},Mi=function(h){function d(p){h.call(this),this.options=T.extend(Object.create(ai),p),T.bindAll(["_update","_onClose","remove"],this)}return h&&(d.__proto__=h),d.prototype=Object.create(h&&h.prototype),d.prototype.constructor=d,d.prototype.addTo=function(p){var y=this;return this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._trackPointer?(this._map.on("mousemove",function(I){y._update(I.point)}),this._map.on("mouseup",function(I){y._update(I.point)}),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new T.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&c.remove(this._content),this._container&&(c.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove"),delete this._map),this.fire(new T.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(p){return this._lngLat=T.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove"),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){var p=this;return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",function(y){p._update(y.point)}),this._map.on("drag",function(y){p._update(y.point)}),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(p){return this.setDOMContent(T.window.document.createTextNode(p))},d.prototype.setHTML=function(p){var y,I=T.window.document.createDocumentFragment(),P=T.window.document.createElement("body");for(P.innerHTML=p;y=P.firstChild;)I.appendChild(y);return this.setDOMContent(I)},d.prototype.getMaxWidth=function(){return this._container.style.maxWidth},d.prototype.setMaxWidth=function(p){return this.options.maxWidth=p,this._update(),this},d.prototype.setDOMContent=function(p){return this._createContent(),this._content.appendChild(p),this._update(),this},d.prototype.addClassName=function(p){this._container.classList.add(p)},d.prototype.removeClassName=function(p){this._container.classList.remove(p)},d.prototype.toggleClassName=function(p){return this._container.classList.toggle(p)},d.prototype._createContent=function(){this._content&&c.remove(this._content),this._content=c.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=c.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._update=function(p){var y=this,I=this._lngLat||this._trackPointer;if(this._map&&I&&this._content&&(this._container||(this._container=c.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=c.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Se){return y._container.classList.add(Se)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p)){var P=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),D=this.options.anchor,O=function Se(Te){if(Te){if(typeof Te=="number"){var ge=Math.round(Math.sqrt(.5*Math.pow(Te,2)));return{center:new T.Point(0,0),top:new T.Point(0,Te),"top-left":new T.Point(ge,ge),"top-right":new T.Point(-ge,ge),bottom:new T.Point(0,-Te),"bottom-left":new T.Point(ge,-ge),"bottom-right":new T.Point(-ge,-ge),left:new T.Point(Te,0),right:new T.Point(-Te,0)}}if(Te instanceof T.Point||Array.isArray(Te)){var be=T.Point.convert(Te);return{center:be,top:be,"top-left":be,"top-right":be,bottom:be,"bottom-left":be,"bottom-right":be,left:be,right:be}}return{center:T.Point.convert(Te.center||[0,0]),top:T.Point.convert(Te.top||[0,0]),"top-left":T.Point.convert(Te["top-left"]||[0,0]),"top-right":T.Point.convert(Te["top-right"]||[0,0]),bottom:T.Point.convert(Te.bottom||[0,0]),"bottom-left":T.Point.convert(Te["bottom-left"]||[0,0]),"bottom-right":T.Point.convert(Te["bottom-right"]||[0,0]),left:T.Point.convert(Te.left||[0,0]),right:T.Point.convert(Te.right||[0,0])}}return Se(new T.Point(0,0))}(this.options.offset);if(!D){var G,Q=this._container.offsetWidth,oe=this._container.offsetHeight;G=P.y+O.bottom.y<oe?["top"]:P.y>this._map.transform.height-oe?["bottom"]:[],P.x<Q/2?G.push("left"):P.x>this._map.transform.width-Q/2&&G.push("right"),D=G.length===0?"bottom":G.join("-")}var _e=P.add(O[D]).round();c.setTransform(this._container,Pl[D]+" translate("+_e.x+"px,"+_e.y+"px)"),cl(this._container,D,"popup")}},d.prototype._onClose=function(){this.remove()},d}(T.Evented),kl={version:T.version,supported:Gi,setRTLTextPlugin:T.setRTLTextPlugin,getRTLTextPluginStatus:T.getRTLTextPluginStatus,Map:zl,NavigationControl:Ko,GeolocateControl:is,AttributionControl:ua,ScaleControl:go,FullscreenControl:Yo,Popup:Mi,Marker:Bo,Style:$a,LngLat:T.LngLat,LngLatBounds:T.LngLatBounds,Point:T.Point,MercatorCoordinate:T.MercatorCoordinate,Evented:T.Evented,config:T.config,get accessToken(){return T.config.ACCESS_TOKEN},set accessToken(h){T.config.ACCESS_TOKEN=h},get baseApiUrl(){return T.config.API_URL},set baseApiUrl(h){T.config.API_URL=h},get workerCount(){return pe.workerCount},set workerCount(h){pe.workerCount=h},get maxParallelImageRequests(){return T.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){T.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage:function(h){T.clearTileCache(h)},workerUrl:""};return kl}),ci})})(K_);var Ng=K_.exports;const Uc=W_(Ng),jg=63710088e-1,qg=2*Math.PI*jg;function Gg(Ar){return qg*Math.cos(Ar*Math.PI/180)}function Zg(Ar,gi){return Ar/Gg(gi)}function G_(Ar,gi=0){return Ar*360-180+gi*360}function Z_(Ar){const gi=180-Ar*360;return 360/Math.PI*Math.atan(Math.exp(gi*Math.PI/180))-90}function Xg(Ar){let gi=1/0,Oi=1/0,$i=-1/0,ci=-1/0;for(const Kt of Ar)gi=Math.min(gi,Kt.x),Oi=Math.min(Oi,Kt.y),$i=Math.max($i,Kt.x),ci=Math.max(ci,Kt.y);const rr=$i-gi,T=ci-Oi,Gi=Math.max(rr,T),c=Math.max(0,Math.floor(-Math.log(Gi)/Math.LN2)),st=Math.pow(2,c);return{z:c,x:Math.floor((gi+$i)/2*st),y:Math.floor((Oi+ci)/2*st),extent:[gi,Oi,$i,ci]}}const{degToRad:e_,radToDeg:Wg,clamp:$g}=i_;zg(!0);function Hg(Ar,gi){Ar=Ar.split("."),gi=gi.split(".");const Oi=Math.max(Ar.length,gi.length);for(;Ar.length<Oi;)Ar.push("0");for(;gi.length<Oi;)gi.push("0");for(let $i=0;$i<Oi;$i++){const ci=parseInt(Ar[$i]),rr=parseInt(gi[$i]);if(ci>rr)return 1;if(ci<rr)return-1}return 0}class Kg{constructor(gi,Oi,$i){this.worldMatrix=new jl,this.mercatorMatrix=new jl,this.labelPlaneMatrix=new jl,this.glCoordMatrix=new jl;const{width:ci,height:rr}=gi.transform,T=Wg(Math.atan(3/4)),Gi=.1,c=1e21;this.map=gi,this.scene=$i,this.scene.matrixAutoUpdate=!1,this.scene.worldMatrixNeedsUpdate=!0,this.camera=Oi==="orthographic"?new t_(-ci/2,ci/2,rr/2,-rr/2,Gi,c):new Fg(T,ci/rr,Gi,c),this.camera.matrixAutoUpdate=!1,this.camera.position.z=600,this.setup()}setup(){const{width:gi,height:Oi}=this.map.transform,$i=e_(this.map.transform.maxPitch);this.camera.aspect=gi/Oi,this.halfFov=this.map.transform.fov/2,this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*Oi,this.acuteAngle=Math.PI/2-$i,this.update()}update(){const{width:gi,height:Oi,worldSize:$i,elevation:ci,_camera:rr,_horizonShift:T}=this.map.transform,Gi=this.map.getCenter(),c=this.map.getPitch(),st=e_(c),Kt=this.map.getBearing(),Zi=this.map.transform._fov,Gt=Zi/2,di=Math.cos(Math.PI/2-st),Di=Math.PI/2+st;this.cameraToCenterDistance=.5/Math.tan(Gt)*Oi;const nr=this.map.transform.project(Gi),tr=new jl().fromRotationZ(Math.PI),Xn=new jl().fromScale(new Rp(-$i,$i,$i)),Wn=new jl().fromTranslation(new Rp(-nr.x,nr.y,0)),co=Oi/50,_o=Math.max(co*di,co),Ao=Zi*(.5+this.map.transform.centerOffset.y/Oi);let to=Math.sin(Ao)*this.cameraToCenterDistance/Math.sin($g(Math.PI-Di-Ao,.01,Math.PI-.01)),Mo;const ra=Zg(1,Gi.lat)*$i||1;if(Hg(this.map.version,"2.0.0")>=0){const Wo=ci?ci.getMinElevationBelowMSL()*ra:0,Ki=(rr.position[2]*$i-Wo)/Math.cos(st);to=Math.sin(Ao)*Ki/Math.sin(i_.clamp(Math.PI-Di-Ao,.01,Math.PI-.01));const en=di*to+Ki,us=Ki*(1/T);Mo=Math.min(en*1.01,us)}else Mo=(di*to+this.cameraToCenterDistance)*1.01;this.mercatorMatrix=new jl().scale(new Rp($i,$i,$i/ra));const jr=new jl().fromTranslation(new Rp(0,0,this.cameraToCenterDistance));this.labelPlaneMatrix=new jl;const Xt=new jl;Xt.scale(new Rp(1,-1,1)),Xt.translate(new Rp(-1,-1,0)),Xt.scale(new Rp(2/gi,2/Oi,1)),this.glCoordMatrix=Xt,this.camera.aspect=gi/Oi,this.cameraTranslateZ=this.cameraToCenterDistance,this.camera instanceof t_?this.camera.projectionMatrix.orthographic(-gi/2,gi/2,Oi/2,-Oi/2,_o,Mo):this.camera.projectionMatrix.perspective(Zi,gi/Oi,_o,Mo);const En=new jl().premultiply(jr).premultiply(new jl().fromRotationX(st)).premultiply(new jl().fromRotationZ(-e_(Kt)));ci&&(En.elements[14]=rr.position[2]*$i),this.camera.worldMatrix.copy(En),this.camera.updateMatrixWorld(),this.scene&&(this.scene.localMatrix=new Og().premultiply(tr).premultiply(Xn).premultiply(Wn))}}function gm(Ar){const gi=1<<Ar.z;return{left:Ar.wrapedX/gi,top:Ar.wrapedY/gi,right:(Ar.wrapedX+1)/gi,bottom:(Ar.wrapedY+1)/gi}}function ym(Ar){const{z:gi,x:Oi,y:$i}=Ar,ci=Ar.wrap,rr=1<<gi,T=G_(Oi/rr,ci),Gi=G_((Oi+1)/rr,ci),c=Z_($i/rr),st=Z_(($i+1)/rr);return[T,st,Gi,c]}function Yg(Ar,gi){return gi.minX<Ar.maxX&&gi.minY<Ar.maxY&&gi.maxX>Ar.minX&&gi.maxY>Ar.minY}function Jg(Ar){if(!Ar||Ar.length===0)return[];const gi=new Map,Oi=new Ug(9);for(let T=0;T<Ar.length;T++){const Gi=Ar[T],{z:c,wrapedX:st,wrapedY:Kt}=Gi,Zi=gi.get(c);Zi?gi.set(c,[...Zi,Gi]):gi.set(c,[Gi])}const $i={};for(const[T,Gi]of gi){let c=1/0,st=1/0,Kt=-1/0,Zi=-1/0,Gt=1/0;for(let Di=0;Di<Gi.length;Di++){const nr=Gi[Di],tr={minX:nr.wrapedX,minY:nr.wrapedY,maxX:nr.wrapedX+1,maxY:nr.wrapedY+1,tileKey:nr.tileKey};Oi.insert(tr),c=Math.min(tr.minX,c),Kt=Math.max(tr.maxX,Kt),st=Math.min(tr.minY,st),Zi=Math.max(tr.maxY,Zi),Gt=Math.min(nr.wrap,Gt)}let di=Gi.find(Di=>Di.wrapedX===c&&Di.wrapedY===st&&Di.z===T);if(!di){const Di=Math.pow(2,T);di=new Bp(T,Gt,T,c-Di*Gt,st,Gi[0].options)}$i[T]={baseTileID:di,config:[c,st,Kt,Zi]}}const ci=Object.keys($i).sort().reverse().map(Number),rr=[];for(let T=0;T<ci.length;T++){const{config:Gi,baseTileID:c}=$i[ci[T]],st=Gi[2]-Gi[0],Kt=Gi[3]-Gi[1];for(let Zi=0;Zi<st;Zi++)for(let Gt=0;Gt<Kt;Gt++){const di=c.neighbor(Zi,Gt);Ar.find(Di=>Di.tileKey===di.tileKey)||Oi.collides({minX:di.wrapedX,minY:di.wrapedY,maxX:di.wrapedX+1,maxY:di.wrapedY+1},{intersects:Yg})||rr.push(di)}}return rr}class ry{constructor(gi,Oi,$i){this.id=gi,this.type="custom",this.renderingMode=($i==null?void 0:$i.renderingMode)||"2d",this.options={...$i||{}},this.source=Oi,this.update=this.update.bind(this),this.moveStart=this.moveStart.bind(this),this.moveEnd=this.moveEnd.bind(this),this.handleZoom=this.handleZoom.bind(this),this.handleResize=this.handleResize.bind(this)}get camera(){return this.sync.camera}update(){this.sync.update(),this.layer&&this.layer.update()}moveStart(){this.layer&&this.layer.moveStart()}moveEnd(){this.layer&&this.layer.moveEnd()}handleResize(){if(this.renderer&&this.gl){const{width:gi,height:Oi}=this.map.painter;this.renderer.setSize(gi,Oi),this.layer&&this.layer.resize(gi,Oi),this.update()}}handleZoom(){this.layer&&this.layer.handleZoom()}updateOptions(gi){this.options={...this.options,...gi||{}},this.layer&&this.layer.updateOptions(gi)}getMask(){return this.options.mask}processMask(){if(this.options.mask){const gi=this.options.mask,Oi=gi.data;Pg(Oi,!0);const $i=c=>{const st=[];for(let Kt=0;Kt<c.length;Kt++){const Zi=c[Kt],Gt=Uc.MercatorCoordinate.fromLngLat(Zi);st.push([Gt.x,Gt.y])}return st},ci=Oi.features,rr=ci.length;let T=0;const Gi=[];for(;T<rr;T++){const c=ci[T],st=c.geometry.coordinates,Kt=c.geometry.type;if(Kt==="Polygon")Gi.push({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:c.geometry.coordinates.map(Zi=>$i(Zi))}});else if(Kt==="MultiPolygon"){const Zi=[];for(let Gt=0;Gt<st.length;Gt++){const di=st[Gt],Di=[];for(let nr=0;nr<di.length;nr++)Di.push($i(st[Gt][nr]));Zi.push(Di)}Gi.push({type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:Zi}})}}return{data:kg(Gi),type:gi.type}}}setMask(gi){this.options.mask=Object.assign({},this.options.mask,gi),this.layer&&this.layer.setMask(this.processMask())}onAdd(gi,Oi){this.gl=Oi,this.map=gi;const $i=gi.getCanvas();this.renderer=new Dg(Oi,{autoClear:!1,extensions:["OES_texture_float","OES_texture_float_linear","WEBGL_color_buffer_float","EXT_color_buffer_float"]}),this.scene=new Lg,this.sync=new Kg(this.map,"perspective",this.scene),this.planeCamera=new t_(0,1,1,0,0,1),this.layer=new Rg(this.source,{renderer:this.renderer,scene:this.scene},{renderType:this.options.renderType,renderFrom:this.options.renderFrom,styleSpec:this.options.styleSpec,displayRange:this.options.displayRange,widthSegments:this.options.widthSegments,heightSegments:this.options.heightSegments,wireframe:this.options.wireframe,picking:this.options.picking,mask:this.processMask(),getZoom:()=>{var ci;return(ci=this.map)==null?void 0:ci.getZoom()},triggerRepaint:()=>{var ci;(ci=this.map)==null||ci.triggerRepaint()},getTileProjSize:ci=>{const rr=1/Math.pow(2,ci);return[rr,rr]},getPixelsToUnits:()=>{const rr=$i.clientHeight/2-.5,T=$i.clientWidth/2-1/2,Gi=Uc.MercatorCoordinate.fromLngLat(gi.unproject([T,rr])),c=Uc.MercatorCoordinate.fromLngLat(gi.unproject([T+1,rr+1]));return[Math.abs(c.x-Gi.x),Math.abs(Gi.y-c.y)]},getPixelsToProjUnit:()=>{var ci,rr;return[(ci=this.map)==null?void 0:ci.transform.pixelsPerMeter,(rr=this.map)==null?void 0:rr.transform.pixelsPerMeter]},getViewTiles:(ci,rr)=>{var Kt;let{type:T}=ci;T=T!==Qm.timeline?T:ci.privateType;const Gi=this.map;if(!Gi)return[];const{transform:c}=Gi,st=[];if(T===Qm.image){const Zi=ci.coordinates.map(di=>Uc.MercatorCoordinate.fromLngLat(di)),Gt=Xg(Zi);if(ci.wrapX)c.getVisibleUnwrappedCoordinates(Gt).forEach(di=>{const{canonical:Di,wrap:nr}=di,{x:tr,y:Xn,z:Wn}=Di;st.push(new Bp(Wn,nr,Wn,tr,Xn,{getTileBounds:()=>[ci.coordinates[0][0],ci.coordinates[2][1],ci.coordinates[1][0],ci.coordinates[0][1]],getTileProjBounds:()=>({left:Gt.extent[0]+nr,top:Gt.extent[1],right:Gt.extent[2]+nr,bottom:Gt.extent[3]})}))});else{const di=Gt.x,Di=Gt.y,nr=Gt.z,tr=0;st.push(new Bp(nr,tr,nr,di,Di,{getTileBounds:()=>[ci.coordinates[0][0],ci.coordinates[2][1],ci.coordinates[1][0],ci.coordinates[0][1]],getTileProjBounds:()=>({left:Gt.extent[0]+tr,top:Gt.extent[1],right:Gt.extent[2]+tr,bottom:Gt.extent[3]})}))}}else if(T===Qm.tile){const Zi={tileSize:i_.isNumber(this.source.tileSize)?ci.tileSize:((Kt=ci.tileSize)==null?void 0:Kt[0])||512,minzoom:ci.minZoom,maxzoom:ci.maxZoom,roundZoom:ci.roundZoom},Gt=c.coveringTiles(Zi);for(let di=0;di<Gt.length;di++){const Di=Gt[di],{canonical:nr,wrap:tr}=Di,{x:Xn,y:Wn,z:co}=nr;ci.wrapX?st.push(new Bp(co,tr,co,Xn,Wn,{getTileBounds:ym,getTileProjBounds:gm})):Di.wrap===0&&st.push(new Bp(co,tr,co,Xn,Wn,{getTileBounds:ym,getTileProjBounds:gm}))}rr===Bg.particles&&st.push(...Jg(st))}return st},getExtent:()=>{const ci=this.map,rr=ci==null?void 0:ci.getBounds().toArray(),T=rr[0][0],Gi=rr[0][1],c=rr[1][0],st=rr[1][1],Kt=Math.max(Gi,ci.transform.latRange?ci.transform.latRange[0]:ci.transform.minLat),Zi=Math.min(st,ci.transform.latRange?ci.transform.latRange[1]:ci.transform.maxLat),Gt=Uc.MercatorCoordinate.fromLngLat(new Uc.LngLat(T,Zi)),di=Uc.MercatorCoordinate.fromLngLat(new Uc.LngLat(c,Kt));return[Gt.x,Gt.y,di.x,di.y]},getGridTiles:ci=>{const rr=ci.tileSize,T=ci.wrapX,Gi=this.map;if(!Gi)return[];const{transform:c}=Gi,st={tileSize:rr??256,minzoom:Gi.getMinZoom(),maxzoom:Gi.getMaxZoom(),roundZoom:!1},Kt=c.coveringTiles(st),Zi=[];for(let Gt=0;Gt<Kt.length;Gt++){const di=Kt[Gt],{canonical:Di,wrap:nr}=di,{x:tr,y:Xn,z:Wn}=Di;T?Zi.push(new Bp(Wn,nr,Wn,tr,Xn,{getTileBounds:ym,getTileProjBounds:gm})):di.wrap===0&&Zi.push(new Bp(Wn,nr,Wn,tr,Xn,{getTileBounds:ym,getTileProjBounds:gm}))}return Zi}}),this.map.on("movestart",this.moveStart),this.map.on("move",this.update),this.map.on("moveend",this.moveEnd),this.map.on("zoom",this.handleZoom),this.map.on("zoomend",this.handleZoom),this.map.on("resize",this.handleResize),this.handleResize(),this.update()}calcWrappedWorlds(){var Oi;const gi=[0];if((Oi=this.source)!=null&&Oi.wrapX){const{width:$i,height:ci}=this.map.transform,rr=this.map.transform.pointCoordinate(new Uc.Point(0,0)),T=this.map.transform.pointCoordinate(new Uc.Point($i,0)),Gi=this.map.transform.pointCoordinate(new Uc.Point($i,ci)),c=this.map.transform.pointCoordinate(new Uc.Point(0,ci)),st=Math.floor(Math.min(rr.x,T.x,Gi.x,c.x)),Kt=Math.floor(Math.max(rr.x,T.x,Gi.x,c.x)),Zi=0;for(let Gt=st-Zi;Gt<=Kt+Zi;Gt++)Gt!==0&&gi.push(Gt)}return gi}onRemove(){var gi,Oi,$i,ci,rr,T;this.layer&&(this.layer.destroy(),this.layer=null),(gi=this.map)==null||gi.off("zoom",this.handleZoom),(Oi=this.map)==null||Oi.off("zoomend",this.handleZoom),($i=this.map)==null||$i.off("movestart",this.moveStart),(ci=this.map)==null||ci.off("move",this.update),(rr=this.map)==null||rr.off("moveend",this.moveEnd),(T=this.map)==null||T.off("resize",this.handleResize),this.map=null,this.gl=null}prerender(){var Oi;this.scene.worldMatrixNeedsUpdate=!0,this.scene.updateMatrixWorld(),this.camera.updateMatrixWorld();const gi=this.calcWrappedWorlds();(Oi=this.layer)==null||Oi.prerender({worlds:gi,camera:this.camera,planeCamera:this.planeCamera})}async picker(gi){if(!this.options.picking)return console.warn("[Layer]: please enable picking options!"),null;if(!this.layer||!gi||!this.map)return console.warn("[Layer]: layer not initialized!"),null;const Oi=this.map.project(gi);return this.layer.picker([Oi.x,Oi.y])}render(){var Oi;this.scene.worldMatrixNeedsUpdate=!0,this.scene.updateMatrixWorld(),this.camera.updateMatrixWorld();const gi=this.calcWrappedWorlds();(Oi=this.layer)==null||Oi.render({worlds:gi,camera:this.camera,planeCamera:this.planeCamera})}}export{ry as L,iy as m};
